***************索引檔建立作業****************
CLOSE ALL
CLEAR 
FLG='0'
FCH=''
CHK=''
R=0
AREA1='A20'
AREA2='A21'
IF !USED('A01')
   SELE 0
   USE A01 INDE A01
ELSE
   SELE A01
ENDIF      
SET ORDER TO A01
IF !USED('A03')
   SELE 0
   USE A03
ELSE 
   SELE A03
ENDIF
SET ORDER TO A03
IF !USED('A02')
   SELE 0
   USE A02 INDE A02
ELSE 
   SELE A02
ENDIF
SET ORDER TO A021
SEEK SYS_OPER+'A21'
SET RELA TO F03 INTO A03
IF !USED('A20')
   SELE 0
   USE A20 INDE A20
ELSE 
   SELE A20
ENDIF
SET ORDER TO A20
IF !USED('A21')
   SELE 0
   USE A21 INDE A21
ELSE 
   SELE A21
ENDIF
SET ORDER TO A211
*************************建立表單A20FORM*************************         
A21FORM=CREATEOBJECT("TKA21")
A21FORM.SHOW  
DEFINE CLASS TKA21 AS FORM
  CAPTION='A21.索引檔建立作業'
*!*	  AUTOCENTER=.T.
  CONTROLBOX=.F.
  BORDERSTYLE=1
  MAXBUTTON=.F.
  MINBUTTON=.F.
  MOVABLE=.F.
  CLOSABLE=.F.
  CONTROLCOUNT=57
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*550
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WIDTH=INT_015*791
  WINDOWTYPE=1
  NAME='TKA21'
  ADD OBJECT SHAPE1 AS SHAPE1 WITH; 
      AUTOCENTER=.T.
  ADD OBJECT SHAPE2 AS SHAPE2 WITH; 
      AUTOCENTER=.T.
  ADD OBJECT SHAPE3 AS SHAPE3 WITH; 
      AUTOCENTER=.T.
**************************************************
  ADD OBJECT PAGEFRAME1 AS PAGEFRAME WITH;
      LEFT=INT_015*236,;
      WIDTH=INT_015*540,;
      HEIGHT=INT_015*200,;
      FONTSIZE=INT_015*9,;      
      PAGECOUNT=2,;
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\harrow.cur',;              
      TABSTRETCH=1,;
      ACTIVEPAGE=1,;
      VISIBLE=.T.,;
      PAGE1.NAME='PAGE1',;
      PAGE1.VISIBLE=.T.,;
      PAGE1.CAPTION='資料庫檔名',;
      PAGE2.NAME='PAGE2',;
      PAGE2.VISIBLE=.T.,;
      PAGE2.CAPTION='索引鍵值內容'   
  ADD OBJECT KEY_LIST AS KEY_LIST WITH; &&目前資料排序
      AUTOCENTER=.T.
  ADD OBJECT GRID1 AS GRID1 WITH;
      COLUMNCOUNT=2,;            
      RECORDSOURCE='A20',;
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2'
  ADD OBJECT GRID2 AS GRID2 WITH;
      COLUMNCOUNT=4,;            
      RECORDSOURCE='A21',;
      LINKMASTER='A20',;
      RELATIONALEXPR='F01',;
      CHILDORDER='A211',; 
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;
      COLUMN3.NAME='COLUMN3',;
      COLUMN4.NAME='COLUMN4'
  ADD OBJECT CMDGROUP AS CMDGROUP WITH; 
      AUTOSIZE=.T.
  ADD OBJECT ORPGROUP AS ORPGROUP WITH;  
      AUTOSIZE=.T.
  ADD OBJECT SHRGROUP AS SHRGROUP WITH; 
      TOP=INT_015*165,;
      LEFT=INT_015*640 
*************************設定PAGE1***************************                
  PROCEDURE PAGEFRAME1.PAGE1.INIT   
  THIS.ADDOBJECT('LBLF01','LABEL') 
     WITH THIS.LBLF01
          .VISIBLE=.T.
          .LEFT=INT_015*15
          .TOP=INT_015*25
          .WIDTH=INT_015*50
          .CAPTION='資料檔名'           
     ENDWITH
  THIS.ADDOBJECT('TXTF01','TEXTBOX')      
     WITH THIS.TXTF01
          .VISIBLE=.T.
          .LEFT=INT_015*66
          .TOP=INT_015*19
          .WIDTH=INT_015*35
          .HEIGHT=INT_015*20
          .MAXLENGTH=3          
     ENDWITH  
  THIS.ADDOBJECT('LBLF07','LABEL')  
     WITH THIS.LBLF07
          .VISIBLE=.T.
          .LEFT=INT_015*15
          .TOP=INT_015*51
          .WIDTH=INT_015*50
          .CAPTION='用途描述'    
     ENDWITH     
  THIS.ADDOBJECT('TXTF07','TEXTBOX')     
     WITH THIS.TXTF07
          .VISIBLE=.T.
          .LEFT=INT_015*66
          .TOP=INT_015*45
          .WIDTH=INT_015*200
          .HEIGHT=INT_015*20
          .MAXLENGTH=40       
     ENDWITH  
  THIS.ADDOBJECT('LBLF02','LABEL') 
     WITH THIS.LBLF02
          .VISIBLE=.T.
          .LEFT=INT_015*15
          .TOP=INT_015*77
          .WIDTH=INT_015*50
          .CAPTION='檔案類別'    
     ENDWITH
 THIS.ADDOBJECT('TXTF02','TEXTBOX')      
     WITH THIS.TXTF02
          .VISIBLE=.T.
          .LEFT=INT_015*66
          .TOP=INT_015*71
          .WIDTH=INT_015*50
          .HEIGHT=INT_015*20
   ENDWITH
 THIS.ADDOBJECT('LBLF03','LABEL')  
     WITH THIS.LBLF03
          .VISIBLE=.T.
          .LEFT=INT_015*15
          .TOP=INT_015*103
          .WIDTH=INT_015*50
          .CAPTION='備註說明'    
     ENDWITH
 THIS.ADDOBJECT('TXTF03','TEXTBOX')      
     WITH THIS.TXTF03
          .VISIBLE=.T.
          .LEFT=INT_015*66
          .TOP=INT_015*97
          .WIDTH=INT_015*200
          .HEIGHT=INT_015*20
          .MAXLENGTH=30
   ENDWITH   
 THIS.ADDOBJECT('LBLF11','LABEL')  
     WITH THIS.LBLF11
          .VISIBLE=.T.
          .LEFT=INT_015*300
          .TOP=INT_015*25
          .WIDTH=INT_015*75
          .CAPTION='欄  位  數  目'   
     ENDWITH
   THIS.ADDOBJECT('TXTF11','TEXTBOX')     
     WITH THIS.TXTF11
          .VISIBLE=.T.
          .LEFT=INT_015*376
          .TOP=INT_015*19
          .WIDTH=INT_015*50
          .HEIGHT=INT_015*20
          .MAXLENGTH=2       
     ENDWITH  
  THIS.ADDOBJECT('LBLF12','LABEL')  
     WITH THIS.LBLF12
          .VISIBLE=.T.
          .LEFT=INT_015*300
          .TOP=INT_015*51
          .WIDTH=INT_015*75
          .CAPTION='RECORD長度'    
     ENDWITH
   THIS.ADDOBJECT('TXTF12','TEXTBOX')      
     WITH THIS.TXTF12
          .VISIBLE=.T.
          .LEFT=INT_015*376
          .TOP=INT_015*45
          .WIDTH=INT_015*50
          .HEIGHT=INT_015*20
          .MAXLENGTH=3         
     ENDWITH  
  THIS.ADDOBJECT('LBLF13','LABEL')  
     WITH THIS.LBLF13
          .VISIBLE=.T.
          .LEFT=INT_015*300
          .TOP=INT_015*103
          .WIDTH=INT_015*55
          .CAPTION='安全資料'    
     ENDWITH     
  THIS.ADDOBJECT('LBLF131','LABEL')    
     WITH THIS.LBLF131
          .VISIBLE=.T.
          .LEFT=INT_015*360
          .TOP=INT_015*103
          .AUTOSIZE=.T.
          .CAPTION=''
     ENDWITH             
  ENDPROC
********************************設定PAGE2***************************    
  PROCEDURE PAGEFRAME1.PAGE2.INIT
 THIS.ADDOBJECT('LBLF02','LABEL') 
    WITH THIS.LBLF02
         .LEFT=INT_015*15
         .TOP=INT_015*25
         .CAPTION='索引名稱'
         .WIDTH=INT_015*50
         .VISIBLE=.T.
    ENDWITH
  THIS.ADDOBJECT('TXTF02','TEXTBOX') 
    WITH THIS.TXTF02
         .LEFT=INT_015*66
         .TOP=INT_015*19
         .WIDTH=INT_015*70      
         .HEIGHT=INT_015*20
         .MAXLENGTH=11
         .VISIBLE=.T.
     ENDWITH
  THIS.ADDOBJECT('LBLF03','LABEL') 
    WITH THIS.LBLF03
         .LEFT=INT_015*15
         .TOP=INT_015*51
         .CAPTION='索引內容'
         .WIDTH=INT_015*50
         .VISIBLE=.T.
     ENDWITH
  THIS.ADDOBJECT('TXTF03','TEXTBOX') 
    WITH THIS.TXTF03
         .LEFT=INT_015*66
         .TOP=INT_015*45
         .WIDTH=INT_015*350    
         .HEIGHT=INT_015*20
         .MAXLENGTH=80
         .VISIBLE=.T.
     ENDWITH
THIS.ADDOBJECT('LBLF04','LABEL') 
    WITH THIS.LBLF04
         .LEFT=INT_015*15
         .TOP=INT_015*77
         .CAPTION='排序方式'
         .WIDTH=INT_015*50
         .VISIBLE=.T.
    ENDWITH
  THIS.ADDOBJECT('OPTIONGROUP04','OPTIONGROUP')
     WITH THIS.OPTIONGROUP04
          .VISIBLE=.T.
          .LEFT=INT_015*66
          .TOP=INT_015*71
	  .HEIGHT=INT_015*25
	  .WIDTH=INT_015*160
	  .BUTTONCOUNT=2
	  .VALUE=1
	  .ENABLED=.F.
	  .NAME='OPTIONGROUP04'
	  .OPTION1.CAPTION='順向排序'
	  .OPTION1.TOP=INT_015*5
	  .OPTION1.FONTSIZE=INT_015*9	  
	  .OPTION1.AUTOSIZE=.T.
	  .OPTION1.LEFT=INT_015*5
	  .OPTION1.NAME='OPTION1'
	  .OPTION2.CAPTION='逆向排序'
	  .OPTION2.TOP=INT_015*5
	  .OPTION2.FONTSIZE=INT_015*9	  
	  .OPTION2.AUTOSIZE=.T.
	  .OPTION2.LEFT=INT_015*85
	  .OPTION2.NAME='OPTION2'           
     ENDWITH              
  THIS.ADDOBJECT('LBLF99','LABEL') 
    WITH THIS.LBLF99
         .VISIBLE=.T.           
         .LEFT=INT_015*15
         .TOP=INT_015*110
         .WIDTH=INT_015*55
         .CAPTION='安全資料'          
         .VISIBLE=.T.
    ENDWITH     
   THIS.ADDOBJECT('LBLF991','LABEL') 
    WITH THIS.LBLF991
         .LEFT=INT_015*66
         .TOP=INT_015*110
         .AUTOSIZE=.T.    
         .VISIBLE=.T.
         .CAPTION=''   
    ENDWITH  
  ENDPROC
******************
PROC INIT
       SELECT A20
       GO TOP
       THISFORM.PAGEFRAME1.PAGE1.FONTITALIC=.T.
       THISFORM.PAGEFRAME1.PAGE1.FORECOLOR=RGB(0,0,255)                   
       THISFORM.PAGEFRAME1.PAGE1.FONTSIZE=INT_015*10
       THISFORM.PAGEFRAME1.PAGE2.FONTSIZE=INT_015*10       
       THISFORM.SETALL('HEIGHT',INT_015*25,'TEXTBOX')
       THISFORM.SETALL('HEIGHT',INT_015*17,'LABEL')
       THISFORM.SETALL('FONTSIZE',INT_015*9,'TEXTBOX')
       THISFORM.SETALL('FONTSIZE',INT_015*9,'LABEL')        
       THISFORM.SETALL('READONLY',.T.,'TEXTBOX')
       THISFORM.SHRGROUP.VISIBLE=.F.
       THISFORM.SHRGROUP.ENABLED=.F.
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'COLUMN')
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'HEADER')
       THISFORM.GRID1.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)
       THISFORM.GRID2.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)
       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*50
       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*150
       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='資料檔名'
       THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='用途描述'
       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='A20.F01'
       THISFORM.GRID1.COLUMN2.CONTROLSOURCE='A20.F07'
       THISFORM.GRID2.SETALL("DYNAMICBACKCOLOR","IIF(A21.F04<>'1',RGB(255,0,0),'')","COLUMN")         
       THISFORM.GRID2.SETALL('FONTSIZE',INT_015*9,'COLUMN')
       THISFORM.GRID2.SETALL('FONTSIZE',INT_015*9,'HEADER')
       THISFORM.GRID2.COLUMN1.HEADER1.CAPTION='索引檔名稱'                                         
       THISFORM.GRID2.COLUMN2.HEADER1.CAPTION='索引檔內容'
       THISFORM.GRID2.COLUMN3.HEADER1.CAPTION='排序方式'
       THISFORM.GRID2.COLUMN4.HEADER1.CAPTION='安全資料' 
       THISFORM.GRID2.COLUMN1.CONTROLSOURCE='A21.F02'
       THISFORM.GRID2.COLUMN2.CONTROLSOURCE='A21.F03'
       THISFORM.GRID2.COLUMN3.CONTROLSOURCE="IIF(A21.F04='1','順向排序','逆向排序')"
       THISFORM.GRID2.COLUMN4.CONTROLSOURCE='A21.F99'
       THISFORM.GRID2.COLUMN1.WIDTH=INT_015*80
       THISFORM.GRID2.COLUMN2.WIDTH=INT_015*250
       THISFORM.GRID2.COLUMN3.WIDTH=INT_015*55
       THISFORM.GRID2.COLUMN4.WIDTH=INT_015*110
       THISFORM.GRID1.READONLY=.T.       
       THISFORM.GRID2.READONLY=.T.          
       THISFORM.GRID1.SETFOCUS
       IF THISFORM.GRID1.ACTIVEROW=0
           THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
	   THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
	   THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
	   THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
	   THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
	   THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
          THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
       ELSE  
           THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
	   THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
	   THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
	   THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
	   THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.        
	   THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.) AND IIF(SEEK(A20.F01,'A21'),.T.,.F.)   &&判斷有無刪除的權限  
           THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限 
       ENDIF     
       THISFORM.ORPGROUP.NEW_BOTT.ENABLED=.F.    
       THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
       JK='資料檔名'       
  ENDPROC     
******************設定PAGE1之動態動作******************        
  PROCEDURE PAGEFRAME1.PAGE1.ACTIVATE
     SELECT  A20
     R=0
    THISFORM.KEY_LIST.ENABLED=.T.
    THISFORM.GRID1.ENABLED=.T.   
    THISFORM.GRID1.SETFOCUS 
    THISFORM.PAGEFRAME1.PAGE1.FONTITALIC=.T.
    THISFORM.PAGEFRAME1.PAGE1.FORECOLOR=RGB(0,0,255)
    THISFORM.PAGEFRAME1.PAGE2.FONTITALIC=.F.
    THISFORM.PAGEFRAME1.PAGE2.FORECOLOR=RGB(0,0,0)  
    THISFORM.ORPGROUP.NEW_BOTT.ENABLED=.F.
     IF THISFORM.GRID1.ACTIVEROW=0 .AND. THISFORM.SHRGROUP.ENABLED=.F.
         THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
         THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
         THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
         THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
         THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
         THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F. 
         THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
         THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=''
         THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE=''
         THISFORM.PAGEFRAME1.PAGE1.TXTF03.VALUE=''
         THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE=''
         THISFORM.PAGEFRAME1.PAGE1.TXTF11.VALUE=''
         THISFORM.PAGEFRAME1.PAGE1.TXTF12.VALUE=''
         THISFORM.PAGEFRAME1.PAGE1.LBLF131.CAPTION=''
     ELSE
         THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
         THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
         THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
         THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
         THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.
         THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.) AND IIF(SEEK(A20.F01,'A21'),.T.,.F.)  &&判斷有無刪除的權限  
         THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限
     ENDIF
     THISFORM.ORPGROUP.NEW_BOTT.ENABLED=.F.    
     THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
   ENDPROC
*****************設定PAGE2之動態動作***********
PROCEDURE PAGEFRAME1.PAGE2.ACTIVATE
    SELECT  A21
    IF THISFORM.SHRGROUP.ENABLED=.F.
        THISFORM.GRID2.READONLY=.T.   
	THISFORM.GRID2.SETFOCUS         
    ENDIF 
    THISFORM.KEY_LIST.ENABLED=.F.   
    THISFORM.PAGEFRAME1.PAGE1.FONTITALIC=.F.
    THISFORM.PAGEFRAME1.PAGE1.FORECOLOR=RGB(0,0,0)
    THISFORM.PAGEFRAME1.PAGE2.FONTITALIC=.T.
    THISFORM.PAGEFRAME1.PAGE2.FORECOLOR=RGB(0,0,255)  
    IF THISFORM.GRID2.ACTIVEROW=0 .AND. THISFORM.SHRGROUP.ENABLED=.F.
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
        THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
        THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
        THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE=''
        THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=''
        THISFORM.PAGEFRAME1.PAGE2.LBLF991.CAPTION=''
    ELSE
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.
        THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  &&判斷有無修改的權限
        THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)   &&判斷有無刪除的權限 
    ENDIF 
	R=RECNO('&AREA1')  
	THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(RECNO('&AREA1')=R,RGB(255,255,0),'')","COLUMN")
        THISFORM.GRID1.ENABLED=.F.     
        THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.)   &&判斷有無新增的權限      
ENDPROC 
***************GRID1動態改變*********        
  PROC GRID1.AFTERROWCOLCHANGE
       LPARAMETERS NCOLINDEX
          SELECT A20
          THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=A20.F01
          THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE=A20.F07
          THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE=BILL(A20.F02)
          THISFORM.PAGEFRAME1.PAGE1.TXTF03.VALUE=A20.F03
          THISFORM.PAGEFRAME1.PAGE1.TXTF11.VALUE=A20.F11
          THISFORM.PAGEFRAME1.PAGE1.TXTF12.VALUE=A20.F12
          THISFORM.PAGEFRAME1.PAGE1.LBLF131.CAPTION=A20.F13
          THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.) AND IIF(SEEK(A20.F01,'A21'),.T.,.F.)   &&判斷有無刪除的權限    
          FCH=THISFORM.ACTIVECONTROL.NAME
          JK=THIS.COLUMN1.HEADER1.CAPTION  
          IF THIS.ACTIVEROW=0
              THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
          ELSE
             THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.
          ENDIF   
          CHK=''     
*!*	      THISFORM.REFRESH
  ENDPROC  
***************GRID2動態改變***************       
  PROC GRID2.AFTERROWCOLCHANGE
       LPARAMETERS NCOLINDEX        
       SELECT A21            
       THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE=A21.F02
       THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=A21.F03
       THISFORM.PAGEFRAME1.PAGE2.OPTIONGROUP04.VALUE=VAL(A21.F04)
       THISFORM.PAGEFRAME1.PAGE2.LBLF991.CAPTION=A21.F99
       FCH=THISFORM.ACTIVECONTROL.NAME
       JK=THIS.COLUMN1.HEADER1.CAPTION
       CHK=THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
       IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
       ENDIF  
*!*	       THISFORM.REFRESH
  ENDPROC
  ********************************************      
  PROC KEY_LIST.INIT 
       WITH THIS 
           .ADDITEM('依資料檔名排列')
           .VALUE=1
       ENDWITH      
  ENDPROC
**************新增鍵******************  
PROCEDURE ORPGROUP.NEW_BOTT.CLICK    
     THISFORM.KEY_LIST.ENABLED=.F.
     THISFORM.GRID1.ENABLED=.F.   
     THISFORM.GRID2.ENABLED=.F.  
     IF THISFORM.PAGEFRAME1.ACTIVEPAGE=2 &&處理表身新增
         THISFORM.PAGEFRAME1.PAGE1.ENABLED=.F.	
         THISFORM.PAGEFRAME1.PAGE2.OPTIONGROUP04.ENABLED=.T.
         THISFORM.PAGEFRAME1.PAGE2.SETALL('READONLY',.F.,'TEXTBOX')  
         THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE='' 
         THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=''
         THISFORM.PAGEFRAME1.PAGE2.OPTIONGROUP04.VALUE=1
         THISFORM.PAGEFRAME1.PAGE2.LBLF991.CAPTION=''
         THISFORM.PAGEFRAME1.PAGE2.TXTF02.SETFOCUS         
      ENDIF
   ENDPROC
***********************新增之確認******************** 
PROCEDURE SHRGROUP.SHURE1_BOTT.CLICK
  IF THISFORM.PAGEFRAME1.ACTIVEPAGE=2  &&表身確認
       SELECT  A21
       COD=SYS(21)
       IF EMPTY(THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE)     
           =MESSAGEBOX('索引名稱不得空白!',0+64,'提示視窗')
      	   THISFORM.PAGEFRAME1.PAGE2.TXTF02.SETFOCUS
      	   SET ORDER TO &COD
           RETURN
       ENDIF    
       IF (ASC(LEFT(THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE,1))>=65 AND ASC(LEFT(THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE,1))<=95)=.F.
           IF (ASC(LEFT(THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE,1))>=97 AND ASC(LEFT(THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE,1))<=122)=.F.   
                =MESSAGEBOX('索引名稱1碼須為英文字母!',0+64,'提示視窗')
                THISFORM.PAGEFRAME1.PAGE2.TXTF02.SETFOCUS
                SET ORDER TO &COD
                RETURN
           ENDIF 
       ENDIF  
       IF A20.F02='1' AND  LEN(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE))>5
     	    =MESSAGEBOX('此資料檔之檔案類別為月份檔,故索引名稱不得超過5各字元,請重新輸入!',0+64,'提示視窗')
            THISFORM.PAGEFRAME1.PAGE2.TXTF02.SETFOCUS
            RETURN    
            SET ORDER TO &COD          
       ENDIF
       IF  IIF(SEEK(ALLTRIM(THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE)+SPACE(8-LEN(ALLTRIM(THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE)))+THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE,'A21'),.T.,.F.)
     	    =MESSAGEBOX('此索引名稱已存在,請重新輸入!',0+64,'提示視窗')
            THISFORM.PAGEFRAME1.PAGE2.TXTF02.SETFOCUS
            RETURN    
            SET ORDER TO &COD   
       ENDIF
       IF EMPTY(THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE)     
           =MESSAGEBOX('索引內容不得空白!',0+64,'提示視窗')
      	   THISFORM.PAGEFRAME1.PAGE2.TXTF03.SETFOCUS
      	   SET ORDER TO &COD
           RETURN
       ENDIF           
       SELECT  A21
       APPEND BLANK
       LOCK()
       IF RLOCK()
           REPLACE F01 WITH ALLTRIM(THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE)
           REPLACE F02 WITH ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE)
           REPLACE F03 WITH ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE)
           REPLACE F04 WITH ALLTRIM(STR(THISFORM.PAGEFRAME1.PAGE2.OPTIONGROUP04.VALUE))
           REPLACE F99 WITH IIF(INT_012=1,PADL(ALLTRIM(STR(YEAR(DATE())-1911)),3,' ')+RIGHT(DTOC(DATE()),6),dtoc(DATE())+' ')+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
       ENDIF 
       UNLOCK
       THISFORM.ORPGROUP.NEW_BOTT.CLICK
       THISFORM.REFRESH  
   ENDIF       
ENDPROC
*****************修改***********
PROCEDURE ORPGROUP.EDIT_BOTT.CLICK
   THISFORM.KEY_LIST.ENABLED=.F. 
   THISFORM.PAGEFRAME1.PAGE1.ENABLED=.F.
   THISFORM.GRID1.ENABLED=.F. 
   THISFORM.GRID2.ENABLED=.F. 
   IF THISFORM.PAGEFRAME1.ACTIVEPAGE=2 
        THISFORM.PAGEFRAME1.PAGE2.SETALL('READONLY',.F.,'TEXTBOX')
        THISFORM.PAGEFRAME1.PAGE2.TXTF02.READONLY=.T. 
        THISFORM.PAGEFRAME1.PAGE2.OPTIONGROUP04.ENABLED=.T.
        THISFORM.PAGEFRAME1.PAGE2.LBLF991.CAPTION=''
        THISFORM.PAGEFRAME1.PAGE2.TXTF02.SETFOCUS           
         SELECT A21
         LOCK()    
         IF !RLOCK()   
             DO FILE_IMPACT 
             UNLOCK ALL 
         ENDIF            
   ENDIF
 ENDPROC
*****************修改之確認***********
 PROCEDURE SHRGROUP.SHURE2_BOTT.CLICK
  IF THISFORM.PAGEFRAME1.ACTIVEPAGE=2    
       IF EMPTY(THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE)     
           =MESSAGEBOX('索引內容不得空白!',0+64,'提示視窗')
      	   THISFORM.PAGEFRAME1.PAGE2.TXTF03.SETFOCUS
      	   SET ORDER TO &COD
           RETURN
       ENDIF                    
  	   SELECT  A21    
  	   IF  RLOCK()  
           	REPLACE F03 WITH ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE) 
           	REPLACE F04 WITH ALLTRIM(STR(THISFORM.PAGEFRAME1.PAGE2.OPTIONGROUP04.VALUE))    
           	REPLACE F99 WITH IIF(INT_012=1,PADL(ALLTRIM(STR(YEAR(DATE())-1911)),3,' ')+RIGHT(DTOC(DATE()),6),dtoc(DATE())+' ')+IIF(SEEK(sys_oper,'A01'),A01.F03,'')  
           ELSE
      	        DO FILE_IMPACT
                RETURN   
           ENDIF 
    ENDIF
    THISFORM.SHRGROUP.ABANDON_BOTT.CLICK
ENDPROC    
 *****************刪除***********
PROCEDURE ORPGROUP.DEL_BOTT.CLICK     
   IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
        IF MESSAGEBOX('是否確定要刪除此筆資料檔之所有索引名稱資料',4+32+256,'請確認')=6
             SELECT  RECNO() FROM A21 WHERE ALLTRIM(A21.F01)=ALLTRIM(THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE) INTO ARRAY BK1              
             JJ1=''                
             IF _TALLY>0   
                 FOR I= 1 TO ALEN(BK1)
                         JJ1=JJ1+ALLTRIM(STR(BK1(I)))+','
                 ENDFOR    
                 KK1=STUFF(JJ1,RAT(',',JJ1,1),1,'')              
                 RLOCK(KK1,'A21')
                 LL1=RLOCK(KK1,'A21')
             ELSE
                 LL1=.T.   
             ENDIF     
             IF LL1 AND LEN(ALLTRIM(JJ1))>0 
                 SELECT  A21
                 FOR I= 1 TO ALEN(BK1)
                         GO BK1(I) 
                         SELECT  A21 
                         DELETE
                  ENDFOR
              ENDIF 
              =MESSAGEBOX('此筆資料檔之所有索引名稱資料已刪除成功!',0+64,'提示視窗')
              RELEASE ALL LIKE BK*         
              THISFORM.REFRESH                    
              THISFORM.SHRGROUP.ABANDON_BOTT.CLICK
        ENDIF  
   ELSE
        IF MESSAGEBOX('是否確定要刪除此索引名稱之資料',4+32+256,'請確認')=6  
             SELECT  A21  
             LOCK()
             IF  RLOCK()
                  DELETE 
                  UNLOCK
                  SKIP -1
                  IF  BOF()
                       GO TOP
                  ENDIF   
                  THISFORM.GRID2.SETFOCUS
		  IF THISFORM.GRID2.ACTIVEROW=0 
		       THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
		       THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
		       THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
		       THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
		       THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
		       THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
		       THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
		       THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE=''
		       THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=''
		       THISFORM.PAGEFRAME1.PAGE2.LBLF991.CAPTION=''
		   ELSE
		       THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
		       THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
		       THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
		       THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
		       THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.
		       THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  &&判斷有無修改的權限
		       THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)   &&判斷有無刪除的權限
		    ENDIF 
		     =MESSAGEBOX('此筆索引名稱之資料已刪除成功!',0+64,'提示視窗')
		    THISFORM.SHRGROUP.ABANDON_BOTT.CLICK 
             ELSE
                    DO FILE_IMPACT 
                    RETURN    
             ENDIF 
        ENDIF           
    ENDIF  
  ENDPROC  
************************************
PROCEDURE SHRGROUP.ABANDON_BOTT.CLICK
      THISFORM.SHRGROUP.ENABLED=.F.
      THISFORM.SHRGROUP.VISIBLE=.F.      
      THISFORM.ORPGROUP.ENABLED=.T.
      THISFORM.ORPGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
      THISFORM.CMDGROUP.ENABLED=.T.
      THISFORM.CMDGROUP.SETALL('ENABLED',.T.,'COMMANDBUTTON')
      THISFORM.CMDGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
      THISFORM.PAGEFRAME1.PAGE1.SETALL('READONLY',.T.,'TEXTBOX')
      THISFORM.PAGEFRAME1.PAGE2.SETALL('READONLY',.T.,'TEXTBOX')
      THISFORM.PAGEFRAME1.PAGE2.OPTIONGROUP04.ENABLED=.F.
      THISFORM.PAGEFRAME1.PAGE1.ENABLED=.T.
      THISFORM.PAGEFRAME1.PAGE2.ENABLED=.T.
       IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
            THISFORM.GRID1.ENABLED=.T.
            THISFORM.GRID2.ENABLED=.T.
            THISFORM.GRID1.SETFOCUS
	     IF THISFORM.GRID1.ACTIVEROW=0 
	         THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
	         THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
	         THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
	         THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
	         THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
	         THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F. 
	         THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
	         THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=''
	         THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE=''
	         THISFORM.PAGEFRAME1.PAGE1.TXTF03.VALUE=''
	         THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE=''
	         THISFORM.PAGEFRAME1.PAGE1.TXTF11.VALUE=''
	         THISFORM.PAGEFRAME1.PAGE1.TXTF12.VALUE=''
	         THISFORM.PAGEFRAME1.PAGE1.LBLF131.CAPTION=''
	     ELSE
	         THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
	         THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
	         THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
	         THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
	         THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.
	         THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.) AND IIF(SEEK(A20.F01,'A21'),.T.,.F.)  &&判斷有無刪除的權限  
	         THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限
	     ENDIF
             THISFORM.ORPGROUP.NEW_BOTT.ENABLED=.F.    
             THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.  
       ELSE      
             THISFORM.GRID1.ENABLED=.F.
             THISFORM.GRID2.ENABLED=.T.
             THISFORM.GRID2.SETFOCUS    
	      IF THISFORM.GRID2.ACTIVEROW=0 
	          THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
	          THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
	          THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
	          THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
	          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
	          THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
	          THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
	          THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE=''
	          THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=''
	          THISFORM.PAGEFRAME1.PAGE2.LBLF991.CAPTION=''
	      ELSE
	          THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
	          THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
	          THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
	          THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
	          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.
	          THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  &&判斷有無修改的權限
	          THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)   &&判斷有無刪除的權限
	      ENDIF  
              THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.)   &&判斷有無新增的權限
       ENDIF               
      UNLOCK ALL
  ENDPROC
  ********************************  
  PROCEDURE SHRGROUP.FINISH_BOTT.CLICK
      SELECT  A21
      THISFORM.SHRGROUP.ABANDON_BOTT.CLICK
  ENDPROC
ENDDEFINE 
 ***********************************************列印程序
 PROCEDURE PNT_PRC  
       PO_NO=A20.F01
*!*	       SELECT  ORDER BY A22.F01 FROM A20,A22 WHERE A22.F05=PO_NO AND A20.F01=PO_NO NOWAIT
*!*	       REPORT FORM ALLTRIM(INT_116)+'A21' TO PRINT PROMPT PREVIEW
*!*	       CLEAR
 ENDPROC
********************
FUNC BILL
     PARA JUK
     JO=''
     DO CASE
        CASE JUK='0'
             JO='基本檔'
        CASE JUK='1'
             JO='月份檔'
        CASE JUK='3'
             JO='奇月檔'             
        CASE JUK='z'
             JO='系統檔'
        CASE JUK='9'
             JO='暫存檔'
        CASE JUK='C'
             JO='字元'
        CASE JUK='D'  
             JO='日期' 
        CASE JUK='T'  
             JO='時間日期'         
        CASE JUK='N'  
             JO='數值'
        CASE JUK='F'  
             JO='浮點數' 
        CASE JUK='I'  
             JO='整數'  
        CASE JUK='B'  
             JO='倍精準數'  
       CASE JUK='Y'  
             JO='貨幣'                                    
        CASE JUK='L'  
             JO='邏輯' 
        CASE JUK='M'  
             JO='備註'       
        CASE JUK='G'  
             JO='通用'      
     ENDCASE
     RETURN JO          