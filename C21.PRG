**程式名稱:客戶報價單
CLOSE ALL
CLEAR 
FLG='0'
FCH=''
CHK=''
UKEF=''
CHK_STR=''
R=0
HD1='C021 '
QTY=0
TQTY=0
AREA1='C26'
AREA2='C27'
IF !USED('D10')
   SELECT 0
   USE D10
ELSE 
   SELECT D10
ENDIF
SET ORDER TO D104      
IF !USED('C00')
   SELE 0
   USE C00
ELSE
   SELE C00
ENDIF
SET ORDER TO C001
IF ! USED('A01')
   SELE 0
   USE A01 INDE A01
ELSE
   SELE A01
ENDIF      
SET ORDER TO A01
IF !USED('A02')
   SELE 0
   USE A02 INDE A02
ELSE
   SELE A02
ENDIF
SET ORDER TO A021    
SEEK SYS_OPER+'C21'  
IF !USED('A34')
   SELE 0
   USE A34 INDE A34
ELSE
   SELE A34
ENDIF
SET ORDER TO A343
IF !USED('B01')
   SELE 0
   USE B01 INDE B01
ELSE
   SELE B01
ENDIF
SET ORDER TO B011      
IF !USED('C01')
   SELE 0
   USE C01 
ELSE
   SELE C01
ENDIF
SET ORDER TO C011
IF !USED('C02')
   SELE 0
   USE C02 INDE C02
ELSE
   SELE C02
ENDIF
SET ORDER TO C023
IF !USED('C20')
   SELE 0
   USE C20
ELSE
   SELE C20
ENDIF
SET ORDER TO C201     
IF !USED('C21')
   SELE 0
   USE C21
ELSE
   SELE C21
ENDIF
SET ORDER TO C212
IF !USED('C26')
   SELE 0
   USE C26 INDE C26
ELSE
   SELE C26
ENDIF
SET ORDER TO C261
SET RELATION TO F03 INTO C01 
SET RELATION TO F06 INTO A01 ADDI
SET RELATION TO F14 INTO C00 ADDI
GO BOTTOM 
IF !USED('C27')
   SELE 0
   USE C27 INDE C27
ELSE
   SELE C27
ENDIF
SET ORDER TO C271      
SET RELA TO F02 INTO B01
C21FORM=CREATEOBJECT("TKC21")
C21FORM.SHOW  
DEFINE CLASS TKC21 AS FORM
  CAPTION='C21.客戶報價單'
*!*	  AUTOCENTER=.T.
  CONTROLBOX=.F.
  BORDERSTYLE=1 
  MAXBUTTON=.F.
  MINBUTTON=.F.
  MOVABLE=.F.
  CLOSABLE=.F.
  CONTROLCOUNT=57
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*550
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WIDTH=INT_015*793
  WINDOWTYPE=1
  NAME='TKC21'
  ADD OBJECT SHAPE1 AS SHAPE1 WITH;
      AUTOCENTER=.T.
  ADD OBJECT LBL_REC AS LBL_REC WITH;
      AUTOCENTER =.T.
  ADD OBJECT REC_COUNT AS REC_COUNT  WITH;
      CAPTION=STR(RECCOUNT())        
  ADD OBJECT SHAPE2 AS SHAPE2 WITH;
      AUTOCENTER=.T.
  ADD OBJECT SHAPE3 AS SHAPE3 WITH;
      AUTOCENTER=.T.
  ADD OBJECT PAGEFRAME1 AS PAGEFRAME WITH;
      LEFT=INT_015*236,;
      WIDTH=INT_015*540,;
      HEIGHT=INT_015*240,;
      FONTSIZE=INT_015*9,;
      PAGECOUNT=2,;
      TABSTRETCH=1,;
      ACTIVEPAGE=1,;
      VISIBLE=.T.,;
      PAGE1.NAME='PAGE1',;
      PAGE1.VISIBLE=.T.,;
      PAGE1.CAPTION='表頭資料',;
      PAGE2.NAME='PAGE2',;
      PAGE2.VISIBLE=.T.,;
      PAGE2.CAPTION='表身詳細資料內容'   
  ADD OBJECT KEY_LIST AS KEY_LIST WITH;
      AUTOCENTER=.T.
  ADD OBJECT GRID1 AS GRID1 WITH;
      COLUMNCOUNT=3,;            
      RECORDSOURCE='C26',;
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;      
      COLUMN3.NAME='COLUMN3'      
  ADD OBJECT GRID2 AS GRID2 WITH;
      TOP=INT_015*242,;
      HEIGHT=INT_015*278,;
      COLUMNCOUNT=8,;            
      RECORDSOURCE='C27',;
      LINKMASTER='C26',;
      RELATIONALEXPR='F01',;
      CHILDORDER='C271',;
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;
      COLUMN3.NAME='COLUMN3',;
      COLUMN4.NAME='COLUMN4',;
      COLUMN5.NAME='COLUMN5',;
      COLUMN6.NAME='COLUMN6',;
      COLUMN7.NAME='COLUMN7',;
      COLUMN8.NAME='COLUMN8'       
  ADD OBJECT CMDGROUP AS CMDGROUP WITH;
      AUTOSIZE=.T.              
  ADD OBJECT ORPGROUP AS ORPGROUP WITH;    
      AUTOSIZE=.T.              
  ADD OBJECT SHRGROUP AS SHRGROUP WITH;
      TOP=INT_015*208,;
      LEFT=INT_015*578          
  ADD OBJECT ANS_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*490,;
      LEFT=INT_015*8,;
      HEIGHT=INT_015*25,;
      FONTSIZE=INT_015*9,;
      WIDTH=INT_015*40,;
      CAPTION='\<A.確認',;
      NAME='ANS_BOTT'    
  ADD OBJECT CPC_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*490,;
      LEFT=INT_015*51,;
      HEIGHT=INT_015*25,;
      FONTSIZE=INT_015*9,;
      WIDTH=INT_015*40,;
      CAPTION='\<C.複製',;
      NAME='CPC_BOTT'          
  ADD OBJECT APPRAISE_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*490,;
      LEFT=INT_015*93,;
      HEIGHT=INT_015*25,;
      FONTSIZE=INT_015*9,;
      WIDTH=INT_015*80,;
      CAPTION='\<G.未回覆估價',;
      NAME='APPRAISE_BOTT'                
  ADD OBJECT EXCL_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*490,;
      LEFT=INT_015*175,;
      HEIGHT=INT_015*25,;
      FONTSIZE=INT_015*9,;
      WIDTH=INT_015*50,;
      CAPTION='\<L.EXCL',;
      NAME='EXCL_BOTT'                         
  PROCEDURE PAGEFRAME1.PAGE1.INIT     
     THIS.ADDOBJECT('LBLF01','LABEL')
     WITH THIS.LBLF01
          .VISIBLE=.T.
          .LEFT=INT_015*14
          .TOP=INT_015*13
          .WIDTH=INT_015*50
          .CAPTION='報價單號'          
     ENDWITH
     THIS.ADDOBJECT('LBLF03','LABEL')
     WITH THIS.LBLF03
         .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*38
         .WIDTH=INT_015*50
         .CAPTION='客戶編號'
     ENDWITH
     THIS.ADDOBJECT('LBLF031','LABEL')
     WITH THIS.LBLF031
         .VISIBLE=.T.
         .LEFT=INT_015*115
         .TOP=INT_015*38
         .AUTOSIZE=.T.
     ENDWITH
     THIS.ADDOBJECT('LBLF07','LABEL')
     WITH THIS.LBLF07
         .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*63
         .WIDTH=INT_015*50
         .CAPTION='聯  絡  人'
     ENDWITH             
     THIS.ADDOBJECT('LBLF18','LABEL')
     WITH THIS.LBLF18
         .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*88
         .WIDTH=INT_015*50
         .CAPTION='機  種  別'
     ENDWITH                  
     THIS.ADDOBJECT('LBLF02','LABEL')
     WITH THIS.LBLF02
         .VISIBLE=.T.
         .LEFT=INT_015*162
         .TOP=INT_015*13
         .WIDTH=INT_015*50
         .CAPTION='報價日期'
     ENDWITH
     THIS.ADDOBJECT('LBLF19','LABEL')
     WITH THIS.LBLF19
         .VISIBLE=.T.
         .LEFT=INT_015*300
         .TOP=INT_015*13
         .WIDTH=INT_015*50
         .CAPTION='生效日期'
     ENDWITH     
     THIS.ADDOBJECT('LBLF14','LABEL')
     WITH THIS.LBLF14
         .VISIBLE=.T.
         .LEFT=INT_015*447
         .TOP=INT_015*13
         .WIDTH=INT_015*25
         .CAPTION='幣別'
     ENDWITH         
     THIS.ADDOBJECT('LBLF06','LABEL')
     WITH THIS.LBLF06
         .VISIBLE=.T.
         .LEFT=INT_015*312
         .TOP=INT_015*38
         .WIDTH=INT_015*50
         .CAPTION='業  務  員'
     ENDWITH         
     THIS.ADDOBJECT('LBLF061','LABEL')
     WITH THIS.LBLF061
         .VISIBLE=.T.
         .LEFT=INT_015*422
         .TOP=INT_015*38
         .AUTOSIZE=.T.        
     ENDWITH     
     THIS.ADDOBJECT('LBLF15','LABEL')
     WITH THIS.LBLF15
          .VISIBLE=.T.
          .LEFT=INT_015*312
          .TOP=INT_015*63
          .WIDTH=INT_015*50
          .CAPTION='對方文號'          
     ENDWITH              
     THIS.ADDOBJECT('LBLF16','LABEL')
     WITH THIS.LBLF16
          .VISIBLE=.T.
          .LEFT=INT_015*312
          .TOP=INT_015*88
          .WIDTH=INT_015*50
          .CAPTION='己方文號'          
     ENDWITH                  
     THIS.ADDOBJECT('LBLF09','LABEL')
     WITH THIS.LBLF09
         .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*113
         .WIDTH=INT_015*50
         .CAPTION='交貨方式'         
     ENDWITH                   
     THIS.ADDOBJECT('LBLF10','LABEL')
     WITH THIS.LBLF10
         .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*138
         .WIDTH=INT_015*50
         .CAPTION='付款方式'         
     ENDWITH                   
     THIS.ADDOBJECT('LBLF11','LABEL')
     WITH THIS.LBLF11
         .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*163
         .WIDTH=INT_015*50
         .CAPTION='備        註'         
     ENDWITH            
     THIS.ADDOBJECT('LBLF05','LABEL')
     WITH THIS.LBLF05
         .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*190
         .WIDTH=INT_015*50
         .CAPTION='最後修改'
     ENDWITH              
     THIS.ADDOBJECT('LBLF051','LABEL')
     WITH THIS.LBLF051
         .VISIBLE=.T.
         .LEFT=INT_015*65
         .TOP=INT_015*190
         .AUTOSIZE=.T.
     ENDWITH                              
     THIS.ADDOBJECT('LBLF90','LABEL')
     WITH THIS.LBLF90
         .VISIBLE=.T.
         .LEFT=INT_015*194
         .TOP=INT_015*190
         .WIDTH=INT_015*50
         .CAPTION='確認人員'         
     ENDWITH               
     THIS.ADDOBJECT('LBLF901','LABEL')
     WITH THIS.LBLF901
         .VISIBLE=.T.
         .LEFT=INT_015*245
         .TOP=INT_015*190
         .AUTOSIZE=.T.
         .CAPTION=''         
     ENDWITH                 
     THIS.ADDOBJECT('LBLF17','LABEL')
     WITH THIS.LBLF17
         .VISIBLE=.T.
         .LEFT=INT_015*394
         .TOP=INT_015*190
         .WIDTH=INT_015*100
         .CAPTION='估價單已列印次數'         
     ENDWITH               
     THIS.ADDOBJECT('LBLF171','LABEL')
     WITH THIS.LBLF171
         .VISIBLE=.T.
         .LEFT=INT_015*495
         .TOP=INT_015*190
         .AUTOSIZE=.T.
         .CAPTION=''         
     ENDWITH                      
     THIS.ADDOBJECT('TXTF01','TEXTBOX')          
     WITH THIS.TXTF01
          .VISIBLE=.T.
          .LEFT=INT_015*64
          .TOP=INT_015*9
          .WIDTH=INT_015*81
          .HEIGHT=INT_015*25
          .MAXLENGTH=10
     ENDWITH        
     THIS.ADDOBJECT('TXTF03','TXTF03')          
     WITH THIS.TXTF03
          .VISIBLE=.T.
          .LEFT=INT_015*64
          .TOP=INT_015*34
          .WIDTH=INT_015*49
          .HEIGHT=INT_015*25
          .MAXLENGTH=5      
     ENDWITH        
     THIS.ADDOBJECT('TXTF07','TEXTBOX')          
     WITH THIS.TXTF07
          .VISIBLE=.T.
          .LEFT=INT_015*64
          .TOP=INT_015*59
          .WIDTH=INT_015*149
          .HEIGHT=INT_015*25
          .MAXLENGTH=20
     ENDWITH             
     THIS.ADDOBJECT('TXTF18','TEXTBOX')          
     WITH THIS.TXTF18
          .VISIBLE=.T.
          .LEFT=INT_015*64
          .TOP=INT_015*84
          .WIDTH=INT_015*149
          .HEIGHT=INT_015*25
          .MAXLENGTH=20
     ENDWITH                  
     THIS.ADDOBJECT('TXTF02','TEXTBOX')          
     WITH THIS.TXTF02
          .VISIBLE=.T.
          .LEFT=INT_015*212
          .TOP=INT_015*9
          .WIDTH=INT_015*73
          .HEIGHT=INT_015*25
     ENDWITH        
     THIS.ADDOBJECT('TXTF19','TEXTBOX')          
     WITH THIS.TXTF19
          .VISIBLE=.T.
          .LEFT=INT_015*351
          .TOP=INT_015*9
          .WIDTH=INT_015*73
          .HEIGHT=INT_015*25
     ENDWITH             
     THIS.ADDOBJECT('TXTF14','TEXTBOX')          
     WITH THIS.TXTF14
          .VISIBLE=.T.
          .LEFT=INT_015*474
          .TOP=INT_015*9
          .WIDTH=INT_015*38
          .HEIGHT=INT_015*25
          .MAXLENGTH=4
     ENDWITH        
     THIS.ADDOBJECT('CRCY','CRCY')     
     THIS.ADDOBJECT('TXTF06','TXTF06')          
     WITH THIS.TXTF06
          .VISIBLE=.T.
          .LEFT=INT_015*362
          .TOP=INT_015*34
          .WIDTH=INT_015*49
          .HEIGHT=INT_015*25          
          .MAXLENGTH=5      
     ENDWITH             
     THIS.ADDOBJECT('TXTF15','TEXTBOX')          
     WITH THIS.TXTF15
          .VISIBLE=.T.
          .LEFT=INT_015*362
          .TOP=INT_015*59
          .WIDTH=INT_015*85
          .HEIGHT=INT_015*25
          .MAXLENGTH=20
     ENDWITH             
     THIS.ADDOBJECT('TXTF16','TEXTBOX')          
     WITH THIS.TXTF16
          .VISIBLE=.T.
          .LEFT=INT_015*362
          .TOP=INT_015*84
          .WIDTH=INT_015*149
          .HEIGHT=INT_015*25
          .MAXLENGTH=20
     ENDWITH                  
     THIS.ADDOBJECT('TXTF09','TEXTBOX')          
     WITH THIS.TXTF09
          .VISIBLE=.T.
          .LEFT=INT_015*64
          .TOP=INT_015*109
          .WIDTH=INT_015*447
          .HEIGHT=INT_015*25
          .MAXLENGTH=60
     ENDWITH                  
     THIS.ADDOBJECT('TXTF10','TEXTBOX')          
     WITH THIS.TXTF10
          .VISIBLE=.T.
          .LEFT=INT_015*64
          .TOP=INT_015*134
          .WIDTH=INT_015*447
          .HEIGHT=INT_015*25
          .MAXLENGTH=60
     ENDWITH                  
     THIS.ADDOBJECT('TXTF11','TEXTBOX')          
     WITH THIS.TXTF11
          .VISIBLE=.T.
          .LEFT=INT_015*64
          .TOP=INT_015*159
          .WIDTH=INT_015*447
          .HEIGHT=INT_015*25
          .MAXLENGTH=60
     ENDWITH                  
  ENDPROC   
  PROCEDURE PAGEFRAME1.PAGE2.INIT
	THIS.ADDOBJECT('LBLF02','LABEL')
	WITH THIS.LBLF02  
	     .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*13
	     .WIDTH=INT_015*50
         .CAPTION='料號品名'
    ENDWITH  
    THIS.ADDOBJECT('LBLF021','LABEL')
    WITH THIS.LBLF021
         .VISIBLE=.T.
         .LEFT=INT_015*337
	     .TOP=INT_015*13
	     .AUTOSIZE=.T.
	ENDWITH     
    THIS.ADDOBJECT('LBLF05','LABEL')
    WITH THIS.LBLF05
         .VISIBLE=.T.
	     .LEFT=INT_015*14
	     .TOP=INT_015*38
	     .WIDTH=INT_015*50
	     .CAPTION='客戶品號'
	ENDWITH     
    THIS.ADDOBJECT('LBLF03','LABEL')
    WITH THIS.LBLF03
         .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*63
         .WIDTH=INT_015*50
         .CAPTION='報價數量'         
    ENDWITH     
    THIS.ADDOBJECT('LBLF14','LABEL')
    WITH THIS.LBLF14
         .VISIBLE=.T.
         .LEFT=INT_015*164
         .TOP=INT_015*63
         .WIDTH=INT_015*50
         .CAPTION='前置天數'         
    ENDWITH         
    THIS.ADDOBJECT('LBLF04','LABEL')      
    WITH THIS.LBLF04
         .VISIBLE=.T.       
         .LEFT=INT_015*14
         .TOP=INT_015*88
         .WIDTH=INT_015*50
         .CAPTION='本次報價'
    ENDWITH  
    THIS.ADDOBJECT('LBLF041','LABEL')      
    WITH THIS.LBLF041
         .VISIBLE=.T.       
         .LEFT=INT_015*150
         .TOP=INT_015*88
         .BACKCOLOR=RGB(255,255,0)
         .AUTOSIZE=.T.
         .CAPTION=''
    ENDWITH    
    THIS.ADDOBJECT('LBLTTL','LABEL')
    WITH THIS.LBLTTL
         .VISIBLE=.T.           
         .LEFT=INT_015*14
         .TOP=INT_015*113
         .WIDTH=INT_015*50
         .CAPTION='金額小計'
    ENDWITH  
    THIS.ADDOBJECT('LBLTTL1','LABEL')    
    WITH THIS.LBLTTL1
         .VISIBLE=.T.           
         .LEFT=INT_015*66
         .TOP=INT_015*113
         .AUTOSIZE=.T.
    ENDWITH         
    THIS.ADDOBJECT('LBLTRAT','LABEL')
    WITH THIS.LBLTRAT
         .VISIBLE=.T.  
         .LEFT=INT_015*128
         .TOP=INT_015*113
         .WIDTH=INT_015*50
         .CAPTION=IIF(A02.F11='*','毛利率%','')
    ENDWITH  
    THIS.ADDOBJECT('LBLTRAT1','LABEL')    
    WITH THIS.LBLTRAT1
         .VISIBLE=.T.         
         .LEFT=INT_015*179
         .TOP=INT_015*113         
         .AUTOSIZE=.T.
    ENDWITH             
    THIS.ADDOBJECT('LBLF10','LABEL')
    WITH THIS.LBLF10
         .VISIBLE=.T.           
         .LEFT=INT_015*14
         .TOP=INT_015*138
         .WIDTH=INT_015*50
         .CAPTION='是否特價'      
      ENDWITH         
    THIS.ADDOBJECT('LBLF11','LABEL')
    WITH THIS.LBLF11
         .VISIBLE=.T.           
         .LEFT=INT_015*95
         .TOP=INT_015*138
         .WIDTH=INT_015*50
         .CAPTION='特價原因'      
      ENDWITH               
    THIS.ADDOBJECT('LBLF08','LABEL')
    WITH THIS.LBLF08
         .VISIBLE=.T.           
         .LEFT=INT_015*14
         .TOP=INT_015*163
         .WIDTH=INT_015*50
         .CAPTION='其他備註'      
      ENDWITH     
    THIS.ADDOBJECT('LBLF99','LABEL')
    WITH THIS.LBLF99
         .VISIBLE=.T.           
         .LEFT=INT_015*164
         .TOP=INT_015*188
         .WIDTH=INT_015*50
         .CAPTION='安全資料'        
      ENDWITH          
    THIS.ADDOBJECT('LBLF991','LABEL')
    WITH THIS.LBLF991
         .VISIBLE=.T.           
         .LEFT=INT_015*215
         .TOP=INT_015*188
         .AUTOSIZE=.T.
         .CAPTION=''      
      ENDWITH              
      THIS.ADDOBJECT('LBLLST','LABEL')
      WITH THIS.LBLLST
         .VISIBLE=.T.           
         .LEFT=INT_015*414
         .TOP=INT_015*188
         .WIDTH=INT_015*60
         .CAPTION='最後進貨日'        
      ENDWITH          
    THIS.ADDOBJECT('LBLLST1','LABEL')
    WITH THIS.LBLLST1
         .VISIBLE=.T.           
         .LEFT=INT_015*477
         .TOP=INT_015*188
         .AUTOSIZE=.T.
         .CAPTION=''      
      ENDWITH              
    THIS.ADDOBJECT('LBLTPE','LABEL')
    WITH THIS.LBLTPE
         .VISIBLE=.T.           
         .LEFT=INT_015*310
         .TOP=INT_015*188
         .AUTOSIZE=.T.
         .CAPTION=''      
      ENDWITH                    
    THIS.ADDOBJECT('LBLF09','LABEL')
    WITH THIS.LBLF09
         .VISIBLE=.T.           
         .LEFT=INT_015*328
         .TOP=INT_015*38
         .WIDTH=INT_015*50
         .CAPTION='包裝方式'                           
    ENDWITH         
    THIS.ADDOBJECT('LBLF06','LABEL')
    WITH THIS.LBLF06
        .VISIBLE=.T.           
        .LEFT=INT_015*328
        .TOP=INT_015*63
        .WIDTH=INT_015*50
        .CAPTION='包裝基量'         
    ENDWITH   
    THIS.ADDOBJECT('LBLF12','LABEL')
    WITH THIS.LBLF12
         .VISIBLE=.T.           
         .LEFT=INT_015*328
         .TOP=INT_015*88
         .WIDTH=INT_015*50
         .CAPTION='包裝數量'
    ENDWITH  
    THIS.ADDOBJECT('LBLF07','LABEL')
    WITH THIS.LBLF07
         .VISIBLE=.T.           
         .LEFT=INT_015*328
         .TOP=INT_015*113
         .WIDTH=INT_015*50
         .CAPTION='最少採購'
    ENDWITH            
    THIS.ADDOBJECT('LBLF15','LABEL')
    WITH THIS.LBLF15
         .VISIBLE=.T.           
         .LEFT=INT_015*358
         .TOP=INT_015*138
         .WIDTH=INT_015*50
         .CAPTION='有效期限'
    ENDWITH                
    THIS.ADDOBJECT('LBLF17','LABEL')
    WITH THIS.LBLF17
         .VISIBLE=.T.           
         .LEFT=INT_015*14
         .TOP=INT_015*188
         .WIDTH=INT_015*50
         .CAPTION='生效日期'
    ENDWITH                
	THIS.ADDOBJECT('TXTF02','TXTF02')	
	WITH THIS.TXTF02      
	     .VISIBLE=.T.
	     .LEFT=INT_015*65
	     .TOP=INT_015*9
	     .WIDTH=INT_015*261
	     .HEIGHT=INT_015*25
	     .MAXLENGTH=43
	     .NAME='TXTF02'       
	ENDWITH     
	THIS.ADDOBJECT('TXTF16','TEXTBOX')	
	WITH THIS.TXTF16     
	     .VISIBLE=.T.
	     .LEFT=INT_015*328
	     .TOP=INT_015*9
	     .WIDTH=INT_015*200
	     .HEIGHT=INT_015*25
	     .MAXLENGTH=40
	     .NAME='TXTF16'       
	ENDWITH     
	THIS.ADDOBJECT('TXTF05','TEXTBOX')
	WITH THIS.TXTF05
	     .VISIBLE=.T.
	     .LEFT=INT_015*65
	     .TOP=INT_015*34
	     .WIDTH=INT_015*261
	     .HEIGHT=INT_015*25
	     .MAXLENGTH=30
	     .NAME='TXTF05'	    
	ENDWITH     	
    THIS.ADDOBJECT('TXTF03','TEXTBOX')
    WITH THIS.TXTF03
         .VISIBLE=.T.           
         .LEFT=INT_015*65
         .TOP=INT_015*59
         .WIDTH=INT_015*80
         .INPUTMASK='99999999999'
         .NAME='TXTF03'
    ENDWITH     	
    THIS.ADDOBJECT('TXTF14','TEXTBOX')
    WITH THIS.TXTF14
         .VISIBLE=.T.           
         .LEFT=INT_015*215
         .TOP=INT_015*59
         .WIDTH=INT_015*30
         .INPUTMASK='999'
         .NAME='TXTF14'
    ENDWITH     	    
    THIS.ADDOBJECT('TXTF04','TEXTBOX')
    WITH THIS.TXTF04     
         .VISIBLE=.T.           
         .LEFT=INT_015*65
         .TOP=INT_015*84
         .WIDTH=INT_015*80
         .INPUTMASK='9999999.999999'
         .NAME='TXTF04'
    ENDWITH 
    THIS.ADDOBJECT('TXTF10','TXTF10')
    WITH THIS.TXTF10     
         .VISIBLE=.T.           
         .LEFT=INT_015*65
         .TOP=INT_015*134
         .WIDTH=INT_015*20
         .MAXLENGTH=1
         .NAME='TXTF10'
    ENDWITH             
    THIS.ADDOBJECT('TXTF11','TEXTBOX')
    WITH THIS.TXTF11 
         .VISIBLE=.T.
         .LEFT=INT_015*145
         .TOP=INT_015*134
         .WIDTH=INT_015*200
         .MAXLENGTH=30
         .NAME='TXTF11'
    ENDWITH                 
    THIS.ADDOBJECT('CMB1','CMB1')
    WITH THIS.CMB1
         .LEFT=INT_015*344
         .TOP=INT_015*134
         .HEIGHT=INT_015*25
         .NAME='CMB1'
    ENDWITH            
    THIS.ADDOBJECT('TXTF08','TEXTBOX')
    WITH THIS.TXTF08     
         .VISIBLE=.T.           
         .LEFT=INT_015*65
         .TOP=INT_015*159
         .WIDTH=INT_015*465
         .MAXLENGTH=80
         .NAME='TXTF08'
    ENDWITH                
    THIS.ADDOBJECT('TXTF09','TEXTBOX')
    WITH THIS.TXTF09     
         .VISIBLE=.T.           
         .LEFT=INT_015*378
         .TOP=INT_015*34
         .WIDTH=INT_015*60
         .MAXLENGTH=8
         .NAME='TXTF09'
    ENDWITH                    
    THIS.ADDOBJECT('TXTF06','TEXTBOX')
    WITH THIS.TXTF06     
         .VISIBLE=.T.           
         .LEFT=INT_015*378
         .TOP=INT_015*59
         .WIDTH=INT_015*80
         .INPUTMASK='9999999'
         .NAME='TXTF06'
    ENDWITH    
    THIS.ADDOBJECT('TXTF12','TEXTBOX')
    WITH THIS.TXTF12     
         .VISIBLE=.T.           
         .LEFT=INT_015*378
         .TOP=INT_015*84
         .WIDTH=INT_015*80
         .INPUTMASK='99999999999'
         .NAME='TXTF12'
    ENDWITH 
    THIS.ADDOBJECT('TXTF07','TEXTBOX')
    WITH THIS.TXTF07     
         .VISIBLE=.T.           
         .LEFT=INT_015*378
         .TOP=INT_015*109
         .WIDTH=INT_015*80
         .INPUTMASK='99999999999'
         .NAME='TXTF07'
    ENDWITH            
    THIS.ADDOBJECT('TXTF15','TEXTBOX')
    WITH THIS.TXTF15    
         .VISIBLE=.T.           
         .LEFT=INT_015*408
         .TOP=INT_015*134
         .WIDTH=INT_015*73
         .NAME='TXTF15'
    ENDWITH            
    THIS.ADDOBJECT('TXTF17','TEXTBOX')
    WITH THIS.TXTF17   
         .VISIBLE=.T.           
         .LEFT=INT_015*65
         .TOP=INT_015*184
         .WIDTH=INT_015*73
         .NAME='TXTF17'
    ENDWITH                
  ENDPROC       
  PROCEDURE PAGEFRAME1.PAGE1.ACTIVATE
     R=0
     SELE C26   
     IF THISFORM.SHRGROUP.VISIBLE=.F.
        THISFORM.GRID1.ENABLED=.T.   
        THISFORM.GRID1.SETFOCUS 
        THISFORM.KEY_LIST.ENABLED=.T.
        THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(C26.F04<>'00',RGB(255,0,0),'')","COLUMN")                 
     ELSE
       THISFORM.KEY_LIST.ENABLED=.F.   
     ENDIF               
    IF THISFORM.GRID1.ACTIVEROW=0 .AND. THISFORM.SHRGROUP.ENABLED=.F.
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
        THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
        THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
        THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
        THISFORM.APPRAISE_BOTT.ENABLED=.F.
        THISFORM.ANS_BOTT.ENABLED=.F.
       
        THISFORM.EXCL_BOTT.ENABLED=.F.
        THISFORM.PAGEFRAME1.PAGE1.SETALL('VALUE','','TEXTBOX')                
        THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=''
        THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE=''
        THISFORM.PAGEFRAME1.PAGE1.TXTF19.VALUE=''
        THISFORM.PAGEFRAME1.PAGE1.TXTF03.VALUE=''
        THISFORM.PAGEFRAME1.PAGE1.TXTF06.VALUE=''
        THISFORM.PAGEFRAME1.PAGE1.TXTF14.VALUE=''
        THISFORM.PAGEFRAME1.PAGE1.TXTF09.VALUE=''
        THISFORM.PAGEFRAME1.PAGE1.TXTF10.VALUE=''
        THISFORM.PAGEFRAME1.PAGE1.TXTF11.VALUE=''    
        THISFORM.PAGEFRAME1.PAGE1.TXTF15.VALUE=''           
        THISFORM.PAGEFRAME1.PAGE1.TXTF16.VALUE=''                   
        THISFORM.PAGEFRAME1.PAGE1.LBLF031.CAPTION=''
        THISFORM.PAGEFRAME1.PAGE1.LBLF061.CAPTION=''
        THISFORM.PAGEFRAME1.PAGE1.LBLF051.CAPTION=''          
        THISFORM.PAGEFRAME1.PAGE1.LBLF901.CAPTION=''   
        THISFORM.PAGEFRAME1.PAGE2.ENABLED=.F.      
     ELSE
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.
        THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.) .AND. IIF(C26.F04='00',.F.,.T.)&&判斷有無修改的權限
        THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)  .AND. IIF(C26.F04='00',.F.,.T.) &&判斷有無刪除的權限
        THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限        
        THISFORM.APPRAISE_BOTT.ENABLED=IIF(A02.F10='*',.T.,.F.) 
        THISFORM.ANS_BOTT.ENABLED=IIF(C26.F04='00',.F.,.T.) AND (A02.F12='*')
        THISFORM.CPC_BOTT.ENABLED=.T.
        THISFORM.EXCL_BOTT.ENABLED=.T.
        THISFORM.PAGEFRAME1.PAGE2.ENABLED=.T.
     ENDIF   
     THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.)     
  ENDPROC
  PROCEDURE PAGEFRAME1.PAGE2.ACTIVATE
     SELE C27    
     IF THISFORM.SHRGROUP.ENABLED=.F.
        THISFORM.GRID2.READONLY=.T.       
        THISFORM.GRID2.SETFOCUS   
     ENDIF
     IF THISFORM.GRID2.ACTIVEROW=0 .AND. THISFORM.SHRGROUP.ENABLED=.F.
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
        THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
        THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
        THISFORM.PAGEFRAME1.PAGE2.SETALL('VALUE','','TEXTBOX')
        THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE=''
        THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE=''
        THISFORM.PAGEFRAME1.PAGE2.LBLF991.CAPTION=''   
        THISFORM.PAGEFRAME1.PAGE2.LBLLST1.CAPTION='' 
        THISFORM.PAGEFRAME1.PAGE2.LBLTTL1.CAPTION='0'
        THISFORM.PAGEFRAME1.PAGE2.LBLTRAT1.CAPTION=IIF(A02.F11='*','0','')
        THISFORM.PAGEFRAME1.PAGE2.LBLF041.CAPTION=''       
        THISFORM.APPRAISE_BOTT.ENABLED=.F.
        THISFORM.ANS_BOTT.ENABLED=.F.                
     ELSE
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.
        THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.) .AND. IIF(C27.F13<>'2',.T.,.F.) .AND. IIF(C26.F04<>'00',.T.,.F.) &&判斷有無修改的權限
        THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)  .AND. IIF(C27.F13<>'2',.T.,.F.) .AND. IIF(C26.F04<>'00',.T.,.F.) &&判斷有無刪除的權限
        THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限  
        THISFORM.ANS_BOTT.ENABLED=IIF(C27.F13<>'2',.T.,.F.) .AND. IIF(C26.F04<>'00',.T.,.F.)  AND (A02.F12='*')                   
        THISFORM.APPRAISE_BOTT.ENABLED=IIF(A02.F10='*',.T.,.F.)         
        
     ENDIF   
     THISFORM.EXCL_BOTT.ENABLED=.F.
     THISFORM.CPC_BOTT.ENABLED=.F.
     R=RECNO('&AREA1')
     THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(RECNO('&AREA1')=R,RGB(255,255,0),'')","COLUMN")
     THISFORM.GRID1.ENABLED=.F.     
     THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.) .AND. IIF(C26.F04<>'00',.T.,.F.)  &&判斷有無新增的權限
     THISFORM.KEY_LIST.ENABLED=.F.     
  ENDPROC   
  PROC INIT       
       THISFORM.PAGEFRAME1.PAGE1.FONTSIZE=INT_015*9
       THISFORM.PAGEFRAME1.PAGE2.FONTSIZE=INT_015*9   
       THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.)   &&判斷有無新增的權限
       THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限  
       THISFORM.SETALL('HEIGHT',INT_015*25,'TEXTBOX')
       THISFORM.SETALL('HEIGHT',INT_015*17,'LABEL')
       THISFORM.SETALL('FONTSIZE',INT_015*9,'TEXTBOX')
       THISFORM.SETALL('FONTSIZE',INT_015*9,'LABEL')       
       THISFORM.SETALL('READONLY',.T.,'TEXTBOX')
       THISFORM.SHRGROUP.VISIBLE=.F.
       THISFORM.SHRGROUP.ENABLED=.F.
       THISFORM.GRID1.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)
       THISFORM.GRID2.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)  
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'COLUMN')
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'HEADER')         
       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='報價單號'
       THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='客戶編號'
       THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='客戶簡稱'
       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='C26.F01'
       THISFORM.GRID1.COLUMN2.CONTROLSOURCE='C26.F03'
       THISFORM.GRID1.COLUMN3.CONTROLSOURCE='C01.F05'
       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*81
       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*49
       THISFORM.GRID1.COLUMN3.WIDTH=INT_015*68
       THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(C26.F04<>'00',RGB(255,0,0),'')","COLUMN")          
       IF A02.F11='*'
*           THISFORM.GRID2.SETALL("DYNAMICBACKCOLOR","IIF(C27.F04*IIF(SEEK(C26.F14,'C00'),C00.F02,1)-B01.F38<0,RGB(255,0,0),'')","COLUMN")        
           THISFORM.GRID2.SETALL("DYNAMICBACKCOLOR","IIF((C27.F04*C00.F02-B01.F38)/(C27.F04*C00.F02)<0.08,RGB(255,0,0),'')","COLUMN")   
       ELSE         
           THISFORM.GRID2.SETALL("DYNAMICBACKCOLOR","IIF(C27.F13<>'2',RGB(255,0,0),'')","COLUMN")    
        ENDIF                       
       THISFORM.GRID2.SETALL('FONTSIZE',INT_015*9,'COLUMN')
       THISFORM.GRID2.SETALL('FONTSIZE',INT_015*9,'HEADER')       
       THISFORM.GRID2.COLUMN1.HEADER1.CAPTION='料品編號'
       THISFORM.GRID2.COLUMN2.HEADER1.CAPTION='品名規格'
	   THISFORM.GRID2.COLUMN3.HEADER1.CAPTION='報價數量'
	   THISFORM.GRID2.COLUMN4.HEADER1.CAPTION='本次報價'
	   THISFORM.GRID2.COLUMN5.HEADER1.CAPTION='客戶品號'
	   THISFORM.GRID2.COLUMN6.HEADER1.CAPTION='包裝基量'
	   THISFORM.GRID2.COLUMN7.HEADER1.CAPTION='包裝數量'
	   THISFORM.GRID2.COLUMN8.HEADER1.CAPTION='最少採購'
	   THISFORM.GRID2.COLUMN1.CONTROLSOURCE='C27.F02'
	   THISFORM.GRID2.COLUMN2.CONTROLSOURCE='C27.F16'
	   THISFORM.GRID2.COLUMN3.CONTROLSOURCE='C27.F03'
	   THISFORM.GRID2.COLUMN4.CONTROLSOURCE='C27.F04'
	   THISFORM.GRID2.COLUMN5.CONTROLSOURCE='C27.F05'
	   THISFORM.GRID2.COLUMN6.CONTROLSOURCE='C27.F06'
	   THISFORM.GRID2.COLUMN7.CONTROLSOURCE='C27.F12'
	   THISFORM.GRID2.COLUMN8.CONTROLSOURCE='C27.F07'
	   THISFORM.GRID2.COLUMN1.WIDTH=INT_015*149
	   THISFORM.GRID2.COLUMN2.WIDTH=INT_015*100
       THISFORM.GRID2.COLUMN3.WIDTH=INT_015*55
       THISFORM.GRID2.COLUMN4.WIDTH=INT_015*55
       THISFORM.GRID2.COLUMN5.WIDTH=INT_015*80
       THISFORM.GRID2.COLUMN6.WIDTH=INT_015*55
       THISFORM.GRID2.COLUMN7.WIDTH=INT_015*55
       THISFORM.GRID2.COLUMN8.WIDTH=INT_015*55 
       THISFORM.GRID1.READONLY=.T.       
       THISFORM.GRID2.READONLY=.T.    
       THISFORM.GRID1.SETFOCUS
       IF THISFORM.GRID1.ACTIVEROW=0
          THISFORM.CMDGROUP.ENABLED=.F.
          THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
          THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
          THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
          THISFORM.APPRAISE_BOTT.ENABLED=.F. 
          THISFORM.ANS_BOTT.ENABLED=.F.
          THISFORM.CPC_BOTT.ENABLED=.F.
          THISFORM.EXCL_BOTT.ENABLED=.F.
       ELSE
          THISFORM.CMDGROUP.ENABLED=.T.      
          THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  .AND. IIF(C26.F04='00',.F.,.T.)&&判斷有無修改的權限
          THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)   .AND. IIF(C26.F04='00',.F.,.T.)&&判斷有無刪除的權限
          THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限          
          THISFORM.APPRAISE_BOTT.ENABLED=IIF(A02.F10='*',.T.,.F.)
          THISFORM.ANS_BOTT.ENABLED=IIF(C26.F04='00',.F.,.T.)  AND (A02.F12='*')     
          THISFORM.CPC_BOTT.ENABLED=.T.   
          THISFORM.EXCL_BOTT.ENABLED=.T.    
       ENDIF          
  
       THISFORM.KEY_LIST.DISPLAYVALUE='依報價單號排列'       
       JK='報價單號'
       SELE C26
       THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=C26.F01
  ENDPROC               
  PROC KEY_LIST.INIT 
       WITH THIS 
           .ADDITEM('依報價單號排列')
           .ADDITEM('依客戶編號排列')
       ENDWITH      
  ENDPROC 
  PROC KEY_LIST.INTERACTIVECHANGE                 
       SELE C26 
       DO CASE
          CASE THIS.DISPLAYVALUE='依報價單號排列'
               SET ORDER TO C261 
               THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='報價單號'
               THISFORM.GRID1.COLUMN1.CONTROLSOURCE='C26.F01'
               THISFORM.GRID1.COLUMN1.WIDTH=INT_015*81
               THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='客戶編號'
               THISFORM.GRID1.COLUMN2.CONTROLSOURCE='C26.F03'
               THISFORM.GRID1.COLUMN2.WIDTH=INT_015*49
               THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='客戶簡稱'
               THISFORM.GRID1.COLUMN3.CONTROLSOURCE='C01.F05'
               THISFORM.GRID1.COLUMN3.WIDTH=INT_015*68
          CASE THIS.DISPLAYVALUE='依客戶編號排列'
               SET ORDER TO C262
               THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='客戶編號'
               THISFORM.GRID1.COLUMN1.CONTROLSOURCE='C26.F03'
               THISFORM.GRID1.COLUMN1.WIDTH=INT_015*49
               THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='客戶簡稱'
               THISFORM.GRID1.COLUMN2.CONTROLSOURCE='C01.F05'
               THISFORM.GRID1.COLUMN2.WIDTH=INT_015*68
               THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='報價單號'
               THISFORM.GRID1.COLUMN3.CONTROLSOURCE='C26.F02'
               THISFORM.GRID1.COLUMN3.WIDTH=INT_015*81                                                                
       ENDCASE 
        *SELE &AREA1
        THISFORM.GRID1.SETFOCUS
  ENDPROC      
  PROC GRID1.AFTERROWCOLCHANGE
       LPARAMETERS NCOLINDEX
       THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=C26.F01
       THISFORM.PAGEFRAME1.PAGE1.TXTF15.VALUE=C26.F15
       THISFORM.PAGEFRAME1.PAGE1.TXTF16.VALUE=C26.F16       
       THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE=C26.F02
       THISFORM.PAGEFRAME1.PAGE1.TXTF19.VALUE=C26.F19
       THISFORM.PAGEFRAME1.PAGE1.TXTF03.VALUE=C26.F03
       THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE=C26.F07
       THISFORM.PAGEFRAME1.PAGE1.TXTF18.VALUE=C26.F18      
       THISFORM.PAGEFRAME1.PAGE1.LBLF031.CAPTION=C01.F04
       THISFORM.PAGEFRAME1.PAGE1.TXTF06.VALUE=C26.F06
       THISFORM.PAGEFRAME1.PAGE1.LBLF061.CAPTION=C26.F08
       THISFORM.PAGEFRAME1.PAGE1.TXTF14.VALUE=C26.F14
       THISFORM.PAGEFRAME1.PAGE1.TXTF09.VALUE=C26.F09
       THISFORM.PAGEFRAME1.PAGE1.TXTF10.VALUE=C26.F10
       THISFORM.PAGEFRAME1.PAGE1.TXTF11.VALUE=C26.F11
       THISFORM.PAGEFRAME1.PAGE1.LBLF051.CAPTION=C26.F05
       THISFORM.PAGEFRAME1.PAGE1.LBLF901.CAPTION=C26.F90
       THISFORM.PAGEFRAME1.PAGE1.LBLF171.CAPTION=TRANSFORM(C26.F17,'@R 999')
       THISFORM.APPRAISE_BOTT.ENABLED=IIF(A02.F10='*',.T.,.F.)
       THISFORM.ANS_BOTT.ENABLED=IIF(C26.F04='00',.F.,.T.) AND (A02.F12='*')   
       THISFORM.CPC_BOTT.ENABLED=.T.  
       THISFORM.EXCL_BOTT.ENABLED=.T.
       THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  .AND. IIF(C26.F04='00',.F.,.T.)&&判斷有無修改的權限
       THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)   .AND. IIF(C26.F04='00',.F.,.T.)&&判斷有無刪除的權限        
       FCH=THISFORM.ACTIVECONTROL.NAME
       JK=THIS.COLUMN1.HEADER1.CAPTION  
       IF THIS.ACTIVEROW=0
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
       ELSE
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.
       ENDIF   
       CHK=''     
*       THISFORM.REFRESH
  ENDPROC     
  PROC GRID2.AFTERROWCOLCHANGE
       LPARAMETERS NCOLINDEX
       THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE=C27.F02  
       *THISFORM.PAGEFRAME1.PAGE2.LBLF021.CAPTION=B01.F02       
       THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=C27.F03
       THISFORM.PAGEFRAME1.PAGE2.TXTF14.VALUE=C27.F14
       THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE=C27.F04
       THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE=C27.F05
       THISFORM.PAGEFRAME1.PAGE2.TXTF06.VALUE=C27.F06
       THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE=C27.F07
       THISFORM.PAGEFRAME1.PAGE2.TXTF08.VALUE=C27.F08                                   
       THISFORM.PAGEFRAME1.PAGE2.TXTF09.VALUE=C27.F09                       
       THISFORM.PAGEFRAME1.PAGE2.TXTF10.VALUE=C27.F10          
       THISFORM.PAGEFRAME1.PAGE2.TXTF11.VISIBLE=IIF(C27.F10$'Yy',.T.,.F.)                           
       THISFORM.PAGEFRAME1.PAGE2.TXTF11.VALUE=C27.F11
       THISFORM.PAGEFRAME1.PAGE2.LBLF11.VISIBLE=IIF(C27.F10$'Yy',.T.,.F.)  
       THISFORM.PAGEFRAME1.PAGE2.TXTF12.VALUE=C27.F12      
       THISFORM.PAGEFRAME1.PAGE2.TXTF15.VALUE=C27.F15         
       THISFORM.PAGEFRAME1.PAGE2.TXTF16.VALUE=C27.F16  
       THISFORM.PAGEFRAME1.PAGE2.TXTF17.VALUE=C27.F17 
       THISFORM.PAGEFRAME1.PAGE2.LBLF991.CAPTION=C27.F99                          
       THISFORM.PAGEFRAME1.PAGE2.LBLLST1.CAPTION=IIF(SEEK(C27.F02,'D10'),DTCX(D10.F03),'')         
       THISFORM.PAGEFRAME1.PAGE2.LBLF041.CAPTION= IIF(SEEK(C26.F03 +C27.F02+C26.F14+IIF(SEEK(C26.F03 +C27.F02+C26.F14+C27.F11,'C21','C212'),C21.F04,SPACE(1)),'C02','C023'),'目前售價：' + DTCX(C02.F15) + SPACE(1) + ALLTRIM(C02.F06) + SPACE(1) + ALLTRIM(TRANSFORM(C02.F07,'9999999.999999')),'無目前售價')
       THISFORM.PAGEFRAME1.PAGE2.LBLTTL1.CAPTION=ALLTRIM(TRANSFORM(C27.F03*C27.F04,'999999999.99'))
       THISFORM.PAGEFRAME1.PAGE2.LBLTRAT1.CAPTION=IIF(A02.F11='*',TRANSFORM(ROUND(100*(C27.F04*IIF(SEEK(C26.F14,'C00'),C00.F02,1)-B01.F38)/(C27.F04*IIF(SEEK(C26.F14,'C00'),C00.F02,1)),4),'@R 9999.9999'),IIF(C27.F04*IIF(SEEK(C26.F14,'C00'),C00.F02,1)-B01.F38>0,'','本次報價虧損'))
       THISFORM.PAGEFRAME1.PAGE2.LBLTRAT1.BACKCOLOR=IIF((C27.F04*IIF(SEEK(C26.F14,'C00'),C00.F02,1)-B01.F38<0) AND C27.F04>0,255,12632256)
       THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.) .AND. IIF(C27.F13<>'2',.T.,.F.) .AND. IIF(C26.F04<>'00',.T.,.F.) &&判斷有無修改的權限
       THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)  .AND. IIF(C27.F13<>'2',.T.,.F.) .AND. IIF(C26.F04<>'00',.T.,.F.) &&判斷有無刪除的權限
       THISFORM.ANS_BOTT.ENABLED=IIF(C27.F13<>'2',.T.,.F.) .AND. IIF(C26.F04<>'00',.T.,.F.) AND (A02.F12='*')  
       
       THISFORM.PAGEFRAME1.PAGE2.LBLTPE.CAPTION=IIF(C27.F13='2','已轉入報價紀錄','未轉入報價紀錄')
       THISFORM.PAGEFRAME1.PAGE2.LBLTPE.BACKCOLOR=IIF(C27.F13<>'2',RGB(255,255,0),RGB(0,255,0))
       FCH=THISFORM.ACTIVECONTROL.NAME
       JK=THIS.COLUMN1.HEADER1.CAPTION
       CHK=THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
       IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
          THISFORM. CMDGROUP.SEEK_BOTT.ENABLED=.F.
       ENDIF   
*       THISFORM.REFRESH
  ENDPROC 
  ************
  PROCEDURE ORPGROUP.NEW_BOTT.CLICK    
    THISFORM.KEY_LIST.ENABLED=.F. 
    IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1       
       THISFORM.GRID2.RECORDSOURCE=''
       THISFORM.GRID2.CHILDORDER=''
       THISFORM.PAGEFRAME1.PAGE1.SETALL('READONLY',.F.,'TEXTBOX')     &&處理表頭新增
       THISFORM.PAGEFRAME1.PAGE1.SETALL('VALUE','','TEXTBOX')
       THISFORM.APPRAISE_BOTT.ENABLED=.F.
       THISFORM.ANS_BOTT.ENABLED=.F.
       THISFORM.CPC_BOTT.ENABLED=.F.
       THISFORM.EXCL_BOTT.ENABLED=.F.
       THISFORM.GRID1.ENABLED=.F.   
       THISFORM.GRID2.ENABLED=.F.   
       IF INT_013=.T.
          HD='C021 '+SUBSTR(DTOS(DATE()),3,4)
          HD1='C021 '
          HD2='CC'
          HD3='客戶報價單'
          IF !USED('A09')
             SELE 0
             USE A09
          ELSE
             SELE A09
          ENDIF
          SET ORDER TO A091
          A24='A24'+LEFT(DTOS(DATE()),6)
          IF !USED('&A24')
             SELE 0
             USE (A24) ALIA A24
          ELSE
            SELE A24
          ENDIF
          SET ORDER TO 1      
          DO ODR_CRT    &&執行主程式中之單據新增 
          SELECT A24
          USE
          SELECT A09
          USE
          THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=PO_NO
          THISFORM.PAGEFRAME1.PAGE1.TXTF01.REFRESH
          THISFORM.PAGEFRAME1.PAGE1.TXTF01.READONLY=.T.
          THISFORM.PAGEFRAME1.PAGE1.TXTF03.SETFOCUS
       ELSE
          THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=''
          THISFORM.PAGEFRAME1.PAGE1.TXTF01.SETFOCUS   
       ENDIF           
        THISFORM.PAGEFRAME1.PAGE2.ENABLED=.F.
        THISFORM.PAGEFRAME1.PAGE1.TXTF03.READONLY=.F.
        THISFORM.PAGEFRAME1.PAGE1.TXTF06.READONLY=.F.        
        THISFORM.PAGEFRAME1.PAGE1.CRCY.VISIBLE=.T.
        THISFORM.PAGEFRAME1.PAGE1.CRCY.DISPLAYVALUE=INT_011
        THISFORM.PAGEFRAME1.PAGE1.TXTF14.VALUE=''    
        THISFORM.PAGEFRAME1.PAGE1.TXTF15.VALUE=''    
        THISFORM.PAGEFRAME1.PAGE1.TXTF16.VALUE=''    
        THISFORM.PAGEFRAME1.PAGE1.TXTF03.VALUE=''
        THISFORM.PAGEFRAME1.PAGE1.TXTF06.VALUE=''
        THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE=''
        THISFORM.PAGEFRAME1.PAGE1.TXTF18.VALUE=''
        THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE=DATE()        
        THISFORM.PAGEFRAME1.PAGE1.TXTF19.VALUE=DATE() 
        THISFORM.PAGEFRAME1.PAGE1.TXTF14.VALUE=THISFORM.PAGEFRAME1.PAGE1.CRCY.DISPLAYVALUE 
        THISFORM.PAGEFRAME1.PAGE1.TXTF09.VALUE=''
        THISFORM.PAGEFRAME1.PAGE1.TXTF10.VALUE='' 
        THISFORM.PAGEFRAME1.PAGE1.TXTF11.VALUE=INT_130
        THISFORM.PAGEFRAME1.PAGE1.LBLF031.CAPTION=''
        THISFORM.PAGEFRAME1.PAGE1.LBLF051.CAPTION=''
        THISFORM.PAGEFRAME1.PAGE1.LBLF061.CAPTION=''        
        THISFORM.PAGEFRAME1.PAGE1.LBLF901.CAPTION=''   
     ELSE
        THISFORM.PAGEFRAME1.PAGE1.ENABLED=.F.              &&處理表身新增
        THISFORM.GRID2.ENABLED=.F.   
        THISFORM.APPRAISE_BOTT.ENABLED=.F.
        THISFORM.ANS_BOTT.ENABLED=.F.
        THISFORM.CPC_BOTT.ENABLED=.F.
        THISFORM.EXCL_BOTT.ENABLED=.F.
        THISFORM.PAGEFRAME1.PAGE2.CMB1.VISIBLE=.F.                 
        THISFORM.PAGEFRAME1.PAGE2.SETALL('READONLY',.F.,'TEXTBOX')        
        THISFORM.PAGEFRAME1.PAGE2.SETALL('VALUE','','TEXTBOX')        
        THISFORM.PAGEFRAME1.PAGE2.TXTF02.READONLY=.F.
        THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE=''
        THISFORM.PAGEFRAME1.PAGE2.TXTF02.SETFOCUS
        THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=1
        THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE=0          
        THISFORM.PAGEFRAME1.PAGE2.TXTF06.VALUE=0        
          
        THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE=0 
                    
        THISFORM.PAGEFRAME1.PAGE2.TXTF09.VALUE=''          
        THISFORM.PAGEFRAME1.PAGE2.TXTF10.VALUE='N'                  
        THISFORM.PAGEFRAME1.PAGE2.TXTF10.READONLY=.F.
        THISFORM.PAGEFRAME1.PAGE2.TXTF11.VALUE=SPACE(30)
        THISFORM.PAGEFRAME1.PAGE2.TXTF11.VISIBLE=.F.  
        THISFORM.PAGEFRAME1.PAGE2.TXTF12.VALUE=0      
         
        THISFORM.PAGEFRAME1.PAGE2.TXTF15.VALUE=C26.F02+INT_126      
        THISFORM.PAGEFRAME1.PAGE2.TXTF17.VALUE=THISFORM.PAGEFRAME1.PAGE1.TXTF19.VALUE
        THISFORM.PAGEFRAME1.PAGE2.LBLF021.CAPTION=''          
        THISFORM.PAGEFRAME1.PAGE2.LBLF11.VISIBLE=.F.                  
        THISFORM.PAGEFRAME1.PAGE2.LBLF991.CAPTION='' 
        THISFORM.PAGEFRAME1.PAGE2.LBLLST1.CAPTION=''   
        THISFORM.PAGEFRAME1.PAGE2.LBLF041.CAPTION=''
        THISFORM.PAGEFRAME1.PAGE2.LBLTTL1.CAPTION=TRANSFORM(0,'999999999999')
        THISFORM.PAGEFRAME1.PAGE2.LBLTRAT1.CAPTION=TRANSFORM(0,'9999.9999')
     ENDIF   
  ENDPROC 
***************   
  PROCEDURE ORPGROUP.EDIT_BOTT.CLICK
     THISFORM.KEY_LIST.ENABLED=.F. 
     THISFORM.GRID1.ENABLED=.F.   
     THISFORM.GRID2.ENABLED=.F.   
     THISFORM.APPRAISE_BOTT.ENABLED=.F.
     THISFORM.ANS_BOTT.ENABLED=.F.  
     THISFORM.CPC_BOTT.ENABLED=.F.  
     THISFORM.EXCL_BOTT.ENABLED=.F.
     IF C26.F04='00'
        =MESSAGEBOX('此張報價單已轉入報價紀錄無法修改',0+64,'提示訊息視窗')
        THISFORM.SHRGROUP.ABANDON_BOTT.CLICK        
        RETURN
     ENDIF   
     IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
        SELE C26
        LOCK()
        IF !RLOCK()
           DO FILE_IMPACT
           THISFORM.SHRGROUP.ABANDON_BOTT.CLICK
*           RETURN
        ELSE
           THISFORM.PAGEFRAME1.PAGE1.SETALL('READONLY',.F.,'TEXTBOX')     &&處理表頭修改
           THISFORM.PAGEFRAME1.PAGE1.TXTF01.READONLY=.T.
           THISFORM.PAGEFRAME1.PAGE1.TXTF03.READONLY=.F.
           THISFORM.PAGEFRAME1.PAGE1.TXTF06.READONLY=.F.
           THISFORM.PAGEFRAME1.PAGE1.CRCY.DISPLAYVALUE=THISFORM.PAGEFRAME1.PAGE1.TXTF14.VALUE
           THISFORM.PAGEFRAME1.PAGE1.CRCY.VISIBLE=.T.
           THISFORM.PAGEFRAME1.PAGE2.ENABLED=.F.
           THISFORM.PAGEFRAME1.PAGE1.TXTF15.SETFOCUS
        ENDIF   
     ELSE                                                                &&處理表身修改
        IF C26.F04='00'
           =MESSAGEBOX('此張單據已轉入報價紀錄,不能修改!',0+64,'提示訊息視窗')
           THISFORM.SHRGROUP.ABANDON_BOTT.CLICK
           RETURN
        ENDIF   
        SELE C27        
        LOCK()
        IF !RLOCK()
           DO FILE_IMPACT 
           THISFORM.SHRGROUP.ABANDON_BOTT.CLICK
        ELSE  
           THISFORM.PAGEFRAME1.PAGE2.CMB1.VISIBLE=SEEK(C26.F03+C27.F02+C26.F14,'C21') AND (C27.F10='Y')         
           THISFORM.PAGEFRAME1.PAGE2.SETALL('READONLY',.F.,'TEXTBOX')       
           THISFORM.PAGEFRAME1.PAGE2.TXTF10.READONLY=.F. 
           THISFORM.PAGEFRAME1.PAGE2.TXTF02.READONLY=.F.
*!*	           IF AT('JST ',THISFORM.PAGEFRAME1.PAGE2.TXTF16.VALUE)>0
*!*	              THISFORM.PAGEFRAME1.PAGE2.TXTF06.READONLY=.T.
*!*	              THISFORM.PAGEFRAME1.PAGE2.TXTF07.READONLY=.T.
*!*	              THISFORM.PAGEFRAME1.PAGE2.TXTF12.READONLY=.T.
*!*	           ENDIF
           THISFORM.PAGEFRAME1.PAGE2.TXTF02.SETFOCUS 
       ENDIF        
     ENDIF   
  ENDPROC
  **************    
  PROC ORPGROUP.DEL_BOTT.CLICK                    &&刪除資料程序
       IF MESSAGEBOX('是否確定要刪除此筆資料',4+32+256,'請確認') = 6	        
          IF ALIA()='C26'           &&刪除整張訂單
             SELE C26
             IF F04='00'
                =MESSAGEBOX('此報單已轉入報價紀錄無法刪除!',0+64,'提示訊息視窗')              
                RETURN
             ELSE
                PO_NO=C26.F01
                SELE RECNO() FROM C27 WHERE C27.F01=C26.F01  INTO ARRAY BK1              
                JJ1=''                
                IF _TALLY>0   
                   FOR I= 1 TO ALEN(BK1)
                       JJ1=JJ1+ALLTRIM(STR(BK1(I)))+','
                   ENDFOR    
                   KK1=STUFF(JJ1,RAT(',',JJ1,1),1,'')              
                   RLOCK(KK1,'C27')
                   LL1=RLOCK(KK1,'C27')
                ELSE
                   LL1=.T.   
                ENDIF   
                IF RLOCK('C26') .AND. LL1=.T.
                   DELE FROM C27 WHERE C27.F01=C26.F01
                   SELE C26
                   DELE
                   UNLOCK ALL             
                   IF INT_013=.T. .AND. SUBSTR(PO_NO,3,4)=SUBSTR(DTOS(DATE()),3,4)
                        HD='C021 '+SUBSTR(DTOS(DATE()),3,4)+PO_NO
                        HD2='CC'
                        HD3='客戶報價單'
                        A24='A24'+LEFT(DTOS(DATE()),6)
                        IF !USED('&A24')
                           SELE 0
                           USE (A24) ALIA A24
                        ELSE
                           SELE A24
                        ENDIF
                        SET ORDER TO 1                              
                        DO ODR_RJT
                        SELECT A24
                        USE
                  ENDIF     
                ELSE
                   DO FILE_IMPACT                  
                ENDIF
             ENDIF          
             THISFORM.GRID1.SETFOCUS
             IF THISFORM.GRID1.ACTIVEROW=0
                THISFORM.CMDGROUP.ENABLED=.F.
                THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
                THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.               
                THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
                THISFORM.ANS_BOTT.ENABLED=.F.
                THISFORM.CPC_BOTT.ENABLED=.F.  
                THISFORM.EXCL_BOTT.ENABLED=.F.
             ELSE      
                THISFORM.CMDGROUP.ENABLED=.T.
                THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  .AND. IIF(C26.F04='00',.F.,.T.)&&判斷有無修改的權限
                THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)   .AND. IIF(C26.F04='00',.F.,.T.)&&判斷有無刪除的權限
                THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限
                THISFORM.APPRAISE_BOTT.ENABLED=IIF(A02.F10='*',.T.,.F.)
                THISFORM.ANS_BOTT.ENABLED=IIF(C26.F04='00',.F.,.T.)  AND (A02.F12='*')      
                THISFORM.CPC_BOTT.ENABLED=.T.       
                THISFORM.EXCL_BOTT.ENABLED=.T.
             ENDIF     
          ELSE        
              SELE C27                                                      &&刪除單筆資料
              IF  C26.F04='00'
                =MESSAGEBOX('此筆記錄已轉入報價單無法刪除!',0+64,'提示訊息視窗')
                RETURN
              ELSE           
                 IF RLOCK('C26')  AND RLOCK('C27')
                    SELECT C26
                    REPLACE F04 WITH PADL(ALLTRIM(STR(VAL(F04)+(-1))),2,'0')
                    SELE C27
                    DELE
                    SKIP -1
                    IF BOF()
                       GO TOP
                    ENDIF   
                 ELSE
                    DO FILE_IMPACT                  
                 ENDIF     
              ENDIF       
              THISFORM.GRID2.SETFOCUS
              IF THISFORM.GRID2.ACTIVEROW=0
                 SELE C26
                 PO_NO=C26.F01
                 DELE
                 SKIP -1
                 IF BOF()
                    GO TOP
                 ENDIF
                 IF INT_013=.T. .AND. SUBSTR(PO_NO,3,4)=SUBSTR(DTOS(DATE()),3,4)
                      A24='A24'+LEFT(DTOS(DATE()),6)
                      IF !USED('&A24')
                         SELE 0
                         USE (A24) ALIA A24
                      ELSE
                         SELE A24
                      ENDIF
                      SET ORDER TO 1                           
                      SEEK 'C021 '+SUBSTR(DTOS(DATE()),3,4)+PO_NO
                      IF !FOUND()
                          APPEND BLANK
                          LOCK()
                          REPLACE  F01 WITH 'C021 '
                          REPLACE  F02 WITH SUBSTR(DTOS(DATE()),3,4)
		                  REPLACE  F05 WITH 'CC'+F02
                          REPLACE  F06 WITH '客戶報價單'
                          REPLACE  F08 WITH PO_NO
                          UNLOCK                 
                      ENDIF    
                      SELECT A24
                      USE
                 ENDIF
                 THISFORM.PAGEFRAME1.ACTIVEPAGE=1 
                 THISFORM.REFRESH          
              ENDIF
          ENDIF
       ENDIF  
       UNLOCK ALL
       RELEASE ALL LIKE BK* 
  ENDPROC  
  **************
  PROCEDURE SHRGROUP.SHURE1_BOTT.CLICK               &&新增確認
    IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
       THISFORM.GRID2.RECORDSOURCE='C27'
       THISFORM.GRID2.CHILDORDER='C271'
	   THISFORM.GRID2.COLUMN1.CONTROLSOURCE='C27.F02'
	   THISFORM.GRID2.COLUMN2.CONTROLSOURCE='C27.F16'
	   THISFORM.GRID2.COLUMN3.CONTROLSOURCE='C27.F03'
	   THISFORM.GRID2.COLUMN4.CONTROLSOURCE='C27.F04'
	   THISFORM.GRID2.COLUMN5.CONTROLSOURCE='C27.F05'
	   THISFORM.GRID2.COLUMN6.CONTROLSOURCE='C27.F06'
	   THISFORM.GRID2.COLUMN7.CONTROLSOURCE='C27.F12'
	   THISFORM.GRID2.COLUMN8.CONTROLSOURCE='C27.F07'       
       SELE C26 
       COD=SYS(21)
       SET ORDER TO C261
       IF SEEK(THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE,'C26')=.T.    &&如果單號重覆
          IF INT_013=.T.
                SELECT MAX(F01) FROM C26 WHERE SUBSTR(F01,3,4)=SUBSTR(DTOS(DATE()),3,4) INTO ARRAY GB NOWAIT                
                HD='C021 '+SUBSTR(DTOS(DATE()),3,4)+THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
                HD1='C021 '
                HD2='CC'
                HD3='客戶報價單'
                IF !USED('A09')
                    SELECT 0
                    USE A09
                ELSE
                    SELECT A09
                ENDIF
                SET ORDER TO 1        
                A24='A24'+LEFT(DTOS(DATE()),6)
                IF !USED('&A24')
                   SELE 0
                   USE (A24) ALIA A24
                ELSE
                   SELE A24
                ENDIF
                SET ORDER TO 1      
                DO ODR_RPT   &&執行主程式中單據編號重複程序
                SELECT A24
                USE 
                SELECT A09
                USE
		       THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=PO_NO
		      THISFORM.PAGEFRAME1.PAGE1.TXTF01.REFRESH               
          ELSE
             =MESSAGEBOX('報價單號重複!',0+64,'提示訊息視窗')
             THISFORM.PAGEFRAME1.PAGE1.TXTF01.SETFOCUS
             SET ORDER TO &COD
             RETURN
          ENDIF   
       ENDIF
       IF !(IIF(SEEK(THISFORM.PAGEFRAME1.PAGE1.TXTF03.VALUE,'C01'),C01.F45,'')=THISFORM.PAGEFRAME1.PAGE1.TXTF03.VALUE) .OR. EMPTY(THISFORM.PAGEFRAME1.PAGE1.TXTF03.VALUE)
           =MESSAGEBOX(IIF(EMPTY(C01.F45),'客戶基本主檔中無此編號','必須以統制客戶編號'+C01.F45+'報價!'),0+64,'提示訊息視窗')
          THISFORM.PAGEFRAME1.PAGE1.TXTF03.SETFOCUS
          SET ORDER TO &COD
          RETURN            
       ENDIF
       IF SEEK(THISFORM.PAGEFRAME1.PAGE1.TXTF06.VALUE,'A01')=.F.
          =MESSAGEBOX('無此人員編號請重新輸入!',0+64,'提示訊息視窗')
          THISFORM.PAGEFRAME1.PAGE1.TXTF06.SETFOCUS
          SET ORDER TO &COD          
          RETURN
       ENDIF   
       IF SEEK (THISFORM.PAGEFRAME1.PAGE1.TXTF14.VALUE,'C00')=.F.
          =MESSAGEBOX('無此幣別!',0+48,'提示訊息視窗')
          THISFORM.PAGEFRAME1.PAGE1.TXTF14.SETFOCUS
          RETURN
       ENDIF    
       IF EMPTY(THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE)
          =MESSAGEBOX('報價日期不得空白!',0+48,'提示訊息視窗') 
          THISFORM.PAGEFRAME1.PAGE1.TXTF02.SETFOCUS
          SET ORDER TO &COD          
          RETURN
       ENDIF   
       IF EMPTY(THISFORM.PAGEFRAME1.PAGE1.TXTF19.VALUE)
          =MESSAGEBOX('生效日期不得空白!',0+48,'提示訊息視窗') 
          THISFORM.PAGEFRAME1.PAGE1.TXTF19.VALUE=THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE
          THISFORM.PAGEFRAME1.PAGE1.TXTF19.SETFOCUS
          SET ORDER TO &COD          
          RETURN
       ENDIF          
       IF EMPTY(THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE)
          =MESSAGEBOX('聯絡人不得通白!',0+64,'提示訊息視窗')
          THISFORM.PAGEFRAME1.PAGE1.TXTF07.SETFOCUS
          SET ORDER TO &COD          
          RETURN
       ENDIF  
       IF EMPTY(THISFORM.PAGEFRAME1.PAGE1.TXTF09.VALUE)
          =MESSAGEBOX('交貨方式不得通白!',0+64,'提示訊息視窗')
          THISFORM.PAGEFRAME1.PAGE1.TXTF09.SETFOCUS
          SET ORDER TO &COD          
          RETURN
       ENDIF  
        IF EMPTY(THISFORM.PAGEFRAME1.PAGE1.TXTF10.VALUE)
          =MESSAGEBOX('付款方式不得通白!',0+64,'提示訊息視窗')
          THISFORM.PAGEFRAME1.PAGE1.TXTF10.SETFOCUS
          SET ORDER TO &COD          
          RETURN
       ENDIF 
       SELE C26          
       APPEND BLANK
       LOCK()
       IF RLOCK()
          REPLACE F01 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
          REPLACE F15 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF15.VALUE
          REPLACE F16 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF16.VALUE
          REPLACE F03 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF03.VALUE
          REPLACE F02 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE
          REPLACE F19 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF19.VALUE
          REPLACE F05 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')          
          REPLACE F06 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF06.VALUE
          REPLACE F07 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE
          REPLACE F18 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF18.VALUE
          REPLACE F08 WITH IIF(SEEK(THISFORM.PAGEFRAME1.PAGE1.TXTF06.VALUE,'A01'),A01.F03,'')          
          REPLACE F14 WITH THISFORM.PAGEFRAME1.PAGE1.CRCY.DISPLAYVALUE
          REPLACE F09 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF09.VALUE
          REPLACE F10 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF10.VALUE
          REPLACE F11 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF11.VALUE                              
       ENDIF
*       UNLOCK
       SEEK THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
       SET ORDER TO &COD
       THISFORM.PAGEFRAME1.PAGE1.ENABLED=.F.
       THISFORM.PAGEFRAME1.PAGE2.ENABLED=.T.  
       THISFORM.PAGEFRAME1.ACTIVEPAGE=2
       THISFORM.ORPGROUP.NEW_BOTT.CLICK
       THISFORM.REFRESH
    ELSE
       IF INDEXSEEK(THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE,.F.,'B01','B011')=.F.
          =MESSAGEBOX('物料基本主檔中無此料號!',0+48,'提示訊息視窗')
          THISFORM.PAGEFRAME1.PAGE2.TXTF02.SETFOCUS
          RETURN
       ENDIF   
       IF SEEK(THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE,'C27')=.T. 
          =MESSAGEBOX('此料號在此張報價單重複!',0+48,'提示訊息視窗')
          THISFORM.PAGEFRAME1.PAGE2.TXTF02.SETFOCUS
          RETURN            
       ENDIF            
       IF THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE<=0
          =MESSAGEBOX('報價數量不得小於等於 0',0+48,'提示訊息式窗')
          THISFORM.PAGEFRAME1.PAGE2.TXTF03.SETFOCUS
          RETURN
       ENDIF   
       IF THISFORM.PAGEFRAME1.PAGE2.TXTF06.VALUE<=0
          =MESSAGEBOX('包裝基量不得小於等於 0',0+48,'提示訊息式窗')
          THISFORM.PAGEFRAME1.PAGE2.TXTF06.SETFOCUS
          RETURN
       ENDIF
       IF THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE<=0
          =MESSAGEBOX('最少採購量不得小於等於 0',0+48,'提示訊息式窗')
          THISFORM.PAGEFRAME1.PAGE2.TXTF07.SETFOCUS
          RETURN
       ENDIF
       IF THISFORM.PAGEFRAME1.PAGE2.TXTF10.VALUE='Y' AND EMPTY(THISFORM.PAGEFRAME1.PAGE2.TXTF11.VALUE)
          =MESSAGEBOX('特價原因描述不得空白!',0+48,'提示訊息視窗')
          THISFORM.PAGEFRAME1.PAGE2.TXTF11.SETFOCUS
          RETURN
       ENDIF
       IF THISFORM.PAGEFRAME1.PAGE2.TXTF15.VALUE<C26.F02 OR THISFORM.PAGEFRAME1.PAGE2.TXTF15.VALUE>C26.F02+INT_126
          =MESSAGEBOX('不合規定的有效期限',0+48,'提示訊息視窗')
          THISFORM.PAGEFRAME1.PAGE2.TXTF15.VALUE=C26.F02+INT_126
          THISFORM.PAGEFRAME1.PAGE2.TXTF15.SETFOCUS
          RETURN
       ENDIF
       IF THISFORM.PAGEFRAME1.PAGE2.TXTF17.VALUE>THISFORM.PAGEFRAME1.PAGE2.TXTF15.VALUE OR EMPTY(THISFORM.PAGEFRAME1.PAGE2.TXTF17.VALUE)
           =MESSAGEBOX('不合規定的生效日期',0+48,'提示訊息視窗')
          THISFORM.PAGEFRAME1.PAGE2.TXTF17.VALUE=C26.F19
          THISFORM.PAGEFRAME1.PAGE2.TXTF17.SETFOCUS
          RETURN 
       ENDIF
       IF EMPTY(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF16.VALUE))
          =MESSAGEBOX('品名規格不得空白',0+48,'提示訊息視窗')
          THISFORM.PAGEFRAME1.PAGE2.TXTF16.SETFOCUS
          RETURN
       ENDIF
       IF VAL(C26.F04)+1>99
          =MESSAGEBOX("請物超過99筆!",0+48,"提視訊息視窗")
          RETURN
       ENDIF
       SELE C27
       APPEND BLANK
       LOCK()
       IF RLOCK()
          REPLACE F01 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
          REPLACE F03 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE
          REPLACE F02 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE
          REPLACE F14 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF14.VALUE
          REPLACE F04 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE
          REPLACE F05 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE
          REPLACE F06 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF06.VALUE
          REPLACE F07 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE
          REPLACE F08 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF08.VALUE
          REPLACE F09 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF09.VALUE    
          REPLACE F10 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF10.VALUE              
          REPLACE F11 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF11.VALUE  
          REPLACE F12 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF12.VALUE            
          REPLACE F15 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF15.VALUE           
          REPLACE F16 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF16.VALUE   
          REPLACE F17 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF17.VALUE   
          REPLACE F99 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')       
          REPLACE C26.F04 WITH PADL(ALLTRIM(STR(VAL(C26.F04)+1)),2,'0')
      ENDIF
      UNLOCK ALL         
      SEEK THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE                  
      THISFORM.GRID2.ENABLED=.T.
      THISFORM.GRID2.SETFOCUS            
      THISFORM.ORPGROUP.NEW_BOTT.CLICK      
    ENDIF               
  ENDPROC
  *********ANS
  PROCEDURE SHRGROUP.SHURE2_BOTT.CLICK                          &&修改確認
     IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1                        &&表頭修改
        IF SEEK(THISFORM.PAGEFRAME1.PAGE1.TXTF06.VALUE,'A01')=.F.
           =MESSAGEBOX('無此人員編號請重新輸入!',0+48,'提示訊息視窗')
           THISFORM.PAGEFRAME1.PAGE1.TXTF06.SETFOCUS
           RETURN
        ENDIF        
       IF SEEK (THISFORM.PAGEFRAME1.PAGE1.TXTF14.VALUE,'C00')=.F.
          =MESSAGEBOX('無此幣別!',0+48,'提示訊息視窗')
          THISFORM.PAGEFRAME1.PAGE1.TXTF14.SETFOCUS
          RETURN
       ENDIF            
        IF EMPTY(THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE)
           =MESSAGEBOX('報價日期不得空白!',0+48,'提示訊息視窗') 
           THISFORM.PAGEFRAME1.PAGE1.TXTF02.SETFOCUS
           RETURN
        ENDIF   
        IF EMPTY(THISFORM.PAGEFRAME1.PAGE1.TXTF19.VALUE)
           =MESSAGEBOX('生效日期不得空白!',0+48,'提示訊息視窗') 
           THISFORM.PAGEFRAME1.PAGE1.TXTF19.VALUE=THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE
           THISFORM.PAGEFRAME1.PAGE1.TXTF19.SETFOCUS
           RETURN
        ENDIF           
       IF EMPTY(THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE)
          =MESSAGEBOX('聯絡人不得通白!',0+64,'提示訊息視窗')
          THISFORM.PAGEFRAME1.PAGE1.TXTF07.SETFOCUS      
          RETURN
       ENDIF  
       IF EMPTY(THISFORM.PAGEFRAME1.PAGE1.TXTF09.VALUE)
          =MESSAGEBOX('交貨方式不得通白!',0+64,'提示訊息視窗')
          THISFORM.PAGEFRAME1.PAGE1.TXTF09.SETFOCUS         
          RETURN
       ENDIF  
        IF EMPTY(THISFORM.PAGEFRAME1.PAGE1.TXTF10.VALUE)
          =MESSAGEBOX('付款方式不得通白!',0+64,'提示訊息視窗')
          THISFORM.PAGEFRAME1.PAGE1.TXTF10.SETFOCUS        
          RETURN
       ENDIF 
        IF !(IIF(SEEK(THISFORM.PAGEFRAME1.PAGE1.TXTF03.VALUE,'C01'),C01.F45,'')=THISFORM.PAGEFRAME1.PAGE1.TXTF03.VALUE) .OR. EMPTY(THISFORM.PAGEFRAME1.PAGE1.TXTF03.VALUE)
          =MESSAGEBOX(IIF(EMPTY(C01.F45),'客戶基本主檔中無此編號','必須以統制客戶編號'+C01.F45+'報價!'),0+64,'提示訊息視窗')
          THISFORM.PAGEFRAME1.PAGE1.TXTF03.SETFOCUS
          RETURN            
       ENDIF
        SELE C26
        IF RLOCK() 
           IF F19<>THISFORM.PAGEFRAME1.PAGE1.TXTF19.VALUE
              SELECT C27
              SEEK C26.F01
              IF FOUND()
                 DO WHILE F01=C26.F01
                    REPLACE F17 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF19.VALUE
                    SKIP
                 ENDDO
              ENDIF
                  
           ENDIF
           SELECT C26
           REPL F15 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF15.VALUE       
           REPL F16 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF16.VALUE 
           REPL F02 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE
           REPL F19 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF19.VALUE
           REPL F03 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF03.VALUE
           REPL F14 WITH THISFORM.PAGEFRAME1.PAGE1.CRCY.DISPLAYVALUE
           REPL F06 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF06.VALUE
           REPL F07 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE
           REPL F18 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF18.VALUE
           REPL F05 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
           REPL F08 WITH IIF(SEEK(THISFORM.PAGEFRAME1.PAGE1.TXTF06.VALUE,'A01'),A01.F03,'')
           REPLACE F09 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF09.VALUE
           REPLACE F10 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF10.VALUE
           REPLACE F11 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF11.VALUE        
           
           UNLOCK ALL
        ELSE
           DO FILE_IMPACT
          RETURN   
       ENDIF    
     ELSE  
       IF THISFORM.PAGEFRAME1.PAGE2.TXTF06.VALUE<=0
          =MESSAGEBOX('包裝基量不得小於等於 0',0+48,'提示訊息式窗')
          THISFORM.PAGEFRAME1.PAGE2.TXTF06.SETFOCUS
          RETURN
       ENDIF
       IF THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE<=0
          =MESSAGEBOX('最少採購量不得小於等於 0',0+48,'提示訊息式窗')
          THISFORM.PAGEFRAME1.PAGE2.TXTF07.SETFOCUS
          RETURN
       ENDIF
        IF THISFORM.PAGEFRAME1.PAGE2.TXTF10.VALUE='Y' AND EMPTY(THISFORM.PAGEFRAME1.PAGE2.TXTF11.VALUE)
           =MESSAGEBOX('特價原因描述不得空白!',0+48,'提示訊息視窗')
           THISFORM.PAGEFRAME1.PAGE2.TXTF11.SETFOCUS
           RETURN
        ENDIF     
        IF EMPTY(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF16.VALUE))
          =MESSAGEBOX('品名規格不得空白',0+48,'提示訊息視窗')
          THISFORM.PAGEFRAME1.PAGE2.TXTF16.SETFOCUS
          RETURN
        ENDIF
        IF THISFORM.PAGEFRAME1.PAGE2.TXTF15.VALUE<C26.F02 OR THISFORM.PAGEFRAME1.PAGE2.TXTF15.VALUE>C26.F02+INT_126
          =MESSAGEBOX('不合規定的有效期限',0+48,'提示訊息視窗')
          THISFORM.PAGEFRAME1.PAGE2.TXTF15.VALUE=C26.F02+INT_126
          THISFORM.PAGEFRAME1.PAGE2.TXTF15.SETFOCUS
          RETURN
       ENDIF
       IF THISFORM.PAGEFRAME1.PAGE2.TXTF17.VALUE>THISFORM.PAGEFRAME1.PAGE2.TXTF15.VALUE OR EMPTY(THISFORM.PAGEFRAME1.PAGE2.TXTF17.VALUE)
           =MESSAGEBOX('不合規定的生效日期',0+48,'提示訊息視窗')
          THISFORM.PAGEFRAME1.PAGE2.TXTF17.VALUE=C26.F19
          THISFORM.PAGEFRAME1.PAGE2.TXTF17.SETFOCUS
          RETURN 
       ENDIF
        IF RLOCK('C26') AND RLOCK('C27')
           SELE C26
           REPL F05 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
           SELE C27                                   
           REPLACE F02 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE
           REPLACE F03 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE
           REPLACE F14 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF14.VALUE
           REPLACE F04 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE
           REPLACE F05 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE
           REPLACE F06 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF06.VALUE
           REPLACE F07 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE
           REPLACE F08 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF08.VALUE
           REPLACE F09 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF09.VALUE 
           REPLACE F10 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF10.VALUE              
           REPLACE F11 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF11.VALUE
           REPLACE F12 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF12.VALUE              
           REPLACE F15 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF15.VALUE             
           REPLACE F16 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF16.VALUE     
           REPLACE F17 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF17.VALUE            
           REPLACE F99 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
           UNLOCK ALL
       ELSE
         DO FILE_IMPACT
          RETURN   
       ENDIF   
    ENDIF   
    THISFORM.SHRGROUP.ABANDON_BOTT.CLICK    
  ENDPROC   
  PROCEDURE SHRGROUP.ABANDON_BOTT.CLICK
      THISFORM.SHRGROUP.ENABLED=.F.
      THISFORM.SHRGROUP.VISIBLE=.F.      
      THISFORM.ORPGROUP.ENABLED=.T.
      THISFORM.ORPGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
      THISFORM.CMDGROUP.ENABLED=.T.
      THISFORM.CMDGROUP.SETALL('ENABLED',.T.,'COMMANDBUTTON')
      THISFORM.CMDGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
      THISFORM.SETALL('READONLY',.T.,'TEXTBOX')  
      THISFORM.PAGEFRAME1.PAGE1.SETALL('READONLY',.T.,'TEXTBOX')  
      THISFORM.PAGEFRAME1.PAGE2.SETALL('READONLY',.T.,'TEXTBOX')  
      THISFORM.PAGEFRAME1.PAGE1.TXTF03.READONLY=.T.
      THISFORM.PAGEFRAME1.PAGE1.TXTF06.READONLY=.T.
      THISFORM.PAGEFRAME1.PAGE2.TXTF02.READONLY=.T.
      THISFORM.PAGEFRAME1.PAGE2.TXTF10.READONLY=.T.      
      THISFORM.PAGEFRAME1.PAGE2.CMB1.VISIBLE=.F.            
      THISFORM.PAGEFRAME1.PAGE1.CRCY.VISIBLE=.F.
      THISFORM.PAGEFRAME1.PAGE1.ENABLED=.T.
      THISFORM.PAGEFRAME1.PAGE2.ENABLED=.T.
      THISFORM.APPRAISE_BOTT.ENABLED=IIF(A02.F10='*',.T.,.F.)
      THISFORM.ANS_BOTT.ENABLED=IIF(C26.F04='00',.F.,.T.) AND (A02.F12='*')

      IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1   
          THISFORM.GRID1.ENABLED=.T.
         THISFORM.GRID2.ENABLED=.T.    
         THISFORM.GRID1.SETFOCUS
         THISFORM.KEY_LIST.ENABLED=.T.
         THISFORM.CPC_BOTT.ENABLED=.T.
         THISFORM.EXCL_BOTT.ENABLED=.T.
      ELSE
         THISFORM.CPC_BOTT.ENABLED=.F.
         THISFORM.EXCL_BOTT.ENABLED=.F.
         THISFORM.GRID1.ENABLED=.F.
         THISFORM.GRID2.ENABLED=.T.        
         THISFORM.GRID2.SETFOCUS
         IF THISFORM.GRID2.ACTIVEROW=0
            IF INT_013            
               IF SUBSTR(PO_NO,3,4)=SUBSTR(DTOS(DATE()),3,4)
                  HD='C021 '+SUBSTR(DTOS(DATE()),3,4)+PO_NO
                  HD2='CC'
                  HD3='客戶報價單'
                  A24='A24'+LEFT(DTOS(DATE()),6)
                  IF !USED('&A24')
                     SELE 0
                     USE (A24) ALIA A24
                  ELSE
                     SELE A24
                  ENDIF
                  SET ORDER TO 1                        
                  DO ODR_RJT   &&執行主程式單據編號重用程序 
                  SELECT A24
                  USE
               ENDIF   
            ENDIF   
            SELE C26
            DELE
            SKIP -1
            IF BOF()
               GO TOP
            ENDIF               
            THISFORM.PAGEFRAME1.ACTIVEPAGE=1
            THISFORM.REFRESH
         ENDIF   
      ENDIF       
      UNLOCK ALL
  ENDPROC
  PROCEDURE SHRGROUP.FINISH_BOTT.CLICK
      IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
         IF THISFORM.GRID2.RECORDSOURCE<>'C27'
            THISFORM.GRID2.RECORDSOURCE='C27'
            THISFORM.GRID2.CHILDORDER='C271'
            THISFORM.GRID2.COLUMN1.CONTROLSOURCE='C27.F02'
	        THISFORM.GRID2.COLUMN2.CONTROLSOURCE='C27.F16'
	        THISFORM.GRID2.COLUMN3.CONTROLSOURCE='C27.F03'
	        THISFORM.GRID2.COLUMN4.CONTROLSOURCE='C27.F04'
	        THISFORM.GRID2.COLUMN5.CONTROLSOURCE='C27.F05'
	        THISFORM.GRID2.COLUMN6.CONTROLSOURCE='C27.F06'
	        THISFORM.GRID2.COLUMN7.CONTROLSOURCE='C27.F12'
	        THISFORM.GRID2.COLUMN8.CONTROLSOURCE='C27.F07'         
	     ENDIF   
	     IF INT_013=.T.
	        IF SUBSTR(PO_NO,3,4)=SUBSTR(DTOS(DATE()),3,4)
               HD='C021 '+SUBSTR(DTOS(DATE()),3,4)+PO_NO
               HD2='CC'
               HD3='客戶報價單'
               A24='A24'+LEFT(DTOS(DATE()),6)
               IF !USED('&A24')
                  SELE 0
                  USE (A24) ALIA A24
               ELSE
                  SELE A24
               ENDIF
               SET ORDER TO 1      
               DO ODR_RJT   &&執行主程式單據編號重用程序
               SELECT A24
               USE
            ENDIF  
         ENDIF           
         SELE C26
         DO CASE 
            CASE THISFORM.KEY_LIST.DISPLAYVALUE='依報價單號排列'
                 SET ORDER TO C261
            CASE THISFORM.KEY_LIST.DISPLAYVALUE='依客戶編號排列'
                 SET ORDER TO C262
         ENDCASE   
       ENDIF  
       THISFORM.SHRGROUP.ABANDON_BOTT.CLICK
  ENDPROC     
  PROC ANS_BOTT.CLICK     &&轉入報價紀錄程序
     IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1    &&若是整張轉入
        SELECT C27
        SEEK C26.F01
           IF FOUND()
              UIK=0
              DO WHILE F01=C26.F01
                 IF F04<=0
                    UIK=UIK+1
                 ENDIF
                 SELECT B01
                 SEEK C27.F02
                 IF !FOUND()
                     UIK=UIK+1
                 ENDIF    
                 IF EMPTY(C27.F16)
                    UIK=UIK+1
                 ENDIF
                 IF EMPTY(C27.F15)
                    UIK=UIK+1
                 ENDIF
                  IF EMPTY(C27.F17)
                    UIK=UIK+1
                 ENDIF
                 SELECT C27
                 SKIP
              ENDDO
           ENDIF
           IF UIK>0
             =MESSAGEBOX('此張報價單有本次報價為 0 或B01無此基本料號或有效生效日空白者!請修正後再轉入報價紀錄!',0+48,'提示訊息視窗')
             THISFORM.GRID1.SETFOCUS  
             RETURN
       ENDIF  
       IF MESSAGEBOX('是否確認資料無誤可以轉入C02.報價資料?',4+32+256,'請確認')= 6	     
          IF !USED('C0B')
             SELECT 0
             USE C0B
          ELSE
             SELECT C0B
          ENDIF   
          SET ORDER TO 1
           SELE C27
           SEEK C26.F01
           IF FOUND()
              DO WHILE F01=C26.F01
                 IF F13<>'2'   &&若是單筆未轉入紀錄
                    IF !EMPTY(C27.F11)   &&如果有特價將統制報價相關編號都要寫進C21
                      
                             SELECT C21
                             SET ORDER TO C211
                             SEEK C26.F03+C27.F02+C26.F14
                             IF !FOUND()
                                APPEND BLANK
                                REPLACE F01 WITH C26.F03
                                REPLACE F02 WITH C27.F02
                                REPLACE F03 WITH C26.F14                          
                                REPLACE F04 WITH IIF(VAL(LEFT(C27.F11,AT('%',C27.F11)))>0,CHR(33),CHR(48))
                                REPLACE F05 WITH C27.F11
                                REPLACE F06 WITH C26.F01
                             ELSE
                                HK=ASC(C21.F04)
                                SET ORDER TO C212
                                SEEK C01.F01+C27.F02+C26.F14+C27.F11
                                IF !FOUND()
                                   APPEND BLANK
                                   REPLACE F01 WITH C26.F03
                                   REPLACE F02 WITH C27.F02
                                   REPLACE F03 WITH C26.F14                             
                                   REPLACE F04 WITH IIF(VAL(LEFT(C27.F11,AT('%',C27.F11)))>0,CHR(HK+1),CHR(IIF(HK=57,65,HK+1)))
                                   REPLACE F05 WITH C27.F11
                                   REPLACE F06 WITH C26.F01
                                ENDIF
                                SET ORDER TO C211
                             ENDIF
                             
                          
                    ENDIF                              
                    IF !EMPTY(C27.F05) 
	                   SELE A34
	                   SEEK C27.F05+C26.F03
  	                   IF FOUND()     
  	                      IF F02<>C27.F02         &&判斷對應料號是否有變
  	                         REPLACE F02 WITH C27.F02   
  	                         REPLACE F04 WITH C27.F08
  	                         REPLACE F05 WITH C26.F01
  	                      ENDIF	                      
	                   ELSE                 &&若不在客戶品號對照表才寫入A34
	                      APPEND BLANK	                      
	                      REPLACE F01 WITH C26.F03
	                      REPLACE F02 WITH C27.F02
	                      REPLACE F03 WITH C27.F05
	                      REPLACE F04 WITH C27.F08
	                      REPLACE F05 WITH C26.F01   
	                   ENDIF   
	                   
                    ENDIF  
                    IF C27.F17<=DATE()                      
                       SELE C02
                    ELSE
                       SELECT C0B
                    ENDIF      
                    APPEND BLANK
                    REPL F01 WITH C26.F03
                    REPL F02 WITH C27.F17
                    REPL F03 WITH C27.F02
                    REPL F04 WITH C27.F05
                    REPL F05 WITH B01.F04
                    REPL F06 WITH C26.F14
                    REPL F07 WITH C27.F04
                    REPL F08 WITH C27.F07
                    REPL F09 WITH C27.F14
                    REPL F10 WITH C27.F08
                    REPL F11 WITH C27.F01
                    REPLACE F12 WITH IIF(SEEK(C26.F03+C27.F02+C26.F14+C27.F11,'C21','C212'),C21.F04,SPACE(1))             
                    REPL F13 WITH C27.F06
                    REPL F14 WITH C27.F12
                    REPLACE F15 WITH C27.F15
                    REPLACE F16 WITH C27.F16                    
                    REPLACE F99 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')    
                    SELE C27
                    REPLACE F13 WITH '2'
                 ENDIF   
                 SELECT C27
                 SKIP
              ENDDO   
           ENDIF
           SELECT C21
           SET ORDER TO C212
           SELECT C01
           SEEK C26.F03
           IF FOUND()
              IF F19<C26.F02
                 REPLACE F19 WITH C26.F02
              ENDIF   
           ENDIF
           SELECT C0B
           USE
           SELECT  C26
           REPLACE F04 WITH '00'       
           REPLACE F90 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
           =MESSAGEBOX('此張報價單已成功轉入',0+64,'提示訊息視窗')
         ENDIF 
         THISFORM.PAGEFRAME1.ACTIVEPAGE=1
      ELSE     &&單筆轉入
         
         IF MESSAGEBOX('是否確認資料無誤可以轉入C02.報價資料?',4+32+256,'請確認')= 6	
            SELECT C27
            IF F04<=0
               =MESSAGEBOX('單價為零者不得轉入報價紀錄!',0+48,'提示訊息視窗')
               THISFORM.GRID2.SETFOCUS
               RETURN
            ENDIF
            IF SEEK(THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE,'B01')=.F.
               =MESSAGEBOX('B01基本主檔無此料號!',0+48,'提示訊息視窗')
               THISFORM.GRID2.SETFOCUS
               RETURN
            ENDIF
            IF EMPTY(F16)
               =MESSAGEBOX('品名規格不得空白!',0+48,'提示訊息視窗')
               THISFORM.GRID2.SETFOCUS
               RETURN
            ENDIF
         
            IF EMPTY(THISFORM.PAGEFRAME1.PAGE2.TXTF15.VALUE)
               =MESSAGEBOX('有效日不得空白!',0+48,'提示訊息視窗')
               THISFORM.GRID2.SETFOCUS
               RETURN
            ENDIF
            IF EMPTY(THISFORM.PAGEFRAME1.PAGE2.TXTF17.VALUE)
               =MESSAGEBOX('生效日不得空白!',0+48,'提示訊息視窗')
               THISFORM.GRID2.SETFOCUS
               RETURN
            ENDIF 
            IF THISFORM.PAGEFRAME1.PAGE2.TXTF15.VALUE<THISFORM.PAGEFRAME1.PAGE2.TXTF17.VALUE
               =MESSAGEBOX('有效日期不得小於生效日!',0+48,'提示訊息視窗')
               THISFORM.GRID2.SETFOCUS
               RETURN
            ENDIF
            IF !USED('C0B')
               SELECT 0
               USE C0B
            ELSE
               SELECT C0B
            ENDIF
            SET ORDER TO 1      
                 SELECT C27
                IF !EMPTY(F11)
                    SELECT C21
                    SET ORDER TO C211
                    SEEK C26.F03+C27.F02+C26.F14
                    IF !FOUND()
                       APPEND BLANK
                       REPLACE F01 WITH C26.F03
                       REPLACE F02 WITH C27.F02
                       REPLACE F03 WITH C26.F14
                       REPLACE F04 WITH IIF(VAL(LEFT(C27.F11,AT('%',C27.F11)))>0,CHR(33),CHR(48))
                       REPLACE F05 WITH C27.F11
                       REPLACE F06 WITH C26.F01
                    ELSE
                       HK=ASC(C21.F04)
                       SET ORDER TO C212
                       SEEK C26.F03+C27.F02+C26.F14+C27.F11
                       IF !FOUND()
                          APPEND BLANK
                          REPLACE F01 WITH C26.F03
                          REPLACE F02 WITH C27.F02
                          REPLACE F03 WITH C26.F14
                          REPLACE F04 WITH IIF(VAL(LEFT(C27.F11,AT('%',C27.F11)))>0,CHR(HK+1),CHR(IIF(HK=57,65,HK+1)))
                          REPLACE F05 WITH C27.F11
                          REPLACE F06 WITH C26.F01
                       ENDIF
                       SET ORDER TO C211
                    ENDIF
                 ENDIF                           
                 IF !EMPTY(C27.F05) 
	                SELE A34
	                SEEK C27.F05+C26.F03
  	                IF FOUND()      	                    
	                   IF F02<>C27.F02        &&判斷對應料號是否有變
	                      REPLACE F02 WITH C27.F02
	                      REPLACE F04 WITH C27.F08
	                      REPLACE F05 WITH C26.F01
	                   ENDIF   	             	                  	                   
	                ELSE        
	                   APPEND BLANK	                    &&若不在客戶品號對照表，則新增至A34 
	                   REPLACE F01 WITH C26.F03
	                   REPLACE F02 WITH C27.F02
	                   REPLACE F03 WITH C27.F05
	                   REPLACE F04 WITH C27.F08
	                   REPLACE F05 WITH C26.F01 
	                ENDIF   
                 ENDIF          
                 IF C27.F17<=DATE()              
                    SELE C02
                 ELSE
                    SELECT C0B
                 ENDIF   
                 APPEND BLANK
                 REPL F01 WITH C26.F03
                 REPL F02 WITH C27.F17
                 REPL F03 WITH C27.F02
                 REPL F04 WITH C27.F05
                 REPL F05 WITH B01.F04
                 REPL F06 WITH C26.F14
                 REPL F07 WITH C27.F04
                 REPL F08 WITH C27.F07
                 REPL F09 WITH C27.F14
                 REPL F10 WITH C27.F08
                 REPL F11 WITH C27.F01
                 REPLACE F12 WITH IIF(SEEK(C26.F03+C27.F02+C26.F14+C27.F11,'C21','C212'),C21.F04,SPACE(1))             
                 REPL F13 WITH C27.F06
                 REPL F14 WITH C27.F12
                 REPLACE F15 WITH C27.F15
                 REPLACE F16 WITH C27.F16                 
                 REPLACE F99 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')   
                 REPLACE C26.F04 WITH PADL(ALLTRIM(STR(VAL(C26.F04)-1)),2,'0')
                 IF C26.F04='00'
                    REPLACE C26.F90 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
                    =MESSAGEBOX('此張報價單已全部轉入報價紀錄',0+64,'提示訊息視窗')
                    THISFORM.ORPGROUP.NEW_BOTT.ENABLED=.F.  
                 ELSE
                    =MESSAGEBOX('此筆紀錄已成功轉入報價紀錄',0+64,'提示訊息視窗')   
                 ENDIF   
                 SELECT C0B
                 USE
                 SELECT C27
                 REPLACE F13 WITH '2'      
         ENDIF        
         THISFORM.GRID2.SETFOCUS            
      ENDIF   

  ENDPROC 
  PROCEDURE CPC_BOTT.CLICK   &&複製本張報價單
     IF MESSAGEBOX('是否確定要複製此張報價單?',4+32+256,'請確認')= 6
        FTR_STR=C26.F01   
        CPC_SEEK=CREATEOBJECT("CPC_SEEK")  
		CPC_SEEK.SHOW         
     ENDIF	       
     THISFORM.PAGEFRAME1.ACTIVEPAGE=1
  ENDPROC
***********************未回覆之估價單
PROC APPRAISE_BOTT.CLICK     
     SELECT F01,F02,F03,F05 FROM C26 WHERE F04<>'00' INTO CURSOR C26_TEMP
     SELECT  C26_TEMP.*,C27.F02,C27.F03,C27.F04 FROM C26_TEMP,C27 WHERE C26_TEMP.F01=C27.F01 ORDER BY C27.F01 INTO CURSOR C27_TEMP READWRITE 
     ALTER TABLE C27_TEMP ADD CustName  C(8)	&&客戶簡稱
     ALTER TABLE C27_TEMP ADD UserNO  C(5)	&&安全資料人員編號
     ALTER TABLE C27_TEMP ADD UserName  C(8)	&&安全資料人員姓名
     INDE ON F01 TAG C27_TEMP1
     INDE ON F02_A TAG C27_TEMP2
     INDE ON F03_A TAG C27_TEMP3
     INDE ON UserNO+UserName  TAG C27_TEMP4
     SELECT C26_TEMP
     USE
     SELECT C27_TEMP 
     SET ORDER TO C27_TEMP1
     GO TOP
     DO WHILE !EOF()
            SELECT A01
            REPLACE C27_TEMP.UserName  WITH ALLTRIM(RIGHT(C27_TEMP.F05,8))
            LOCATE FOR ALLTRIM(A01.F03) = ALLTRIM(RIGHT(C27_TEMP.F05,8))
            IF FOUND()
                REPLACE C27_TEMP.UserNO WITH A01.F01
                REPLACE C27_TEMP.UserName  WITH A01.F03
            ENDIF
            SELECT C01
            SET ORDER TO C011   && F01
            SEEK C27_TEMP.F03_A
            IF FOUND()
                REPLACE C27_TEMP.CustName  WITH C01.F05
            ENDIF
            SELECT C27_TEMP
            SKIP
     ENDDO
     SELECT C27_TEMP
     GO TOP
     IF _TALLY >0    
          APPRAISE_CHK=CREATEOBJECT("APPRAISE_CHK")  
          APPRAISE_CHK.SHOW
     ELSE
          =MESSAGEBOX('無未回覆之估價單之資料',0+48,'警示')             
      ENDIF    
      SELECT C27_TEMP
      USE
      AREA1='C26'
      IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1   
           THISFORM.GRID1.SETFOCUS
      ELSE
           THISFORM.GRID2.SETFOCUS
      ENDIF      
  ENDPROC

  PROC EXCL_BOTT.CLICK     &&轉入EXCEL程序
       LKK=C26.F01
       SELECT C26.F01 報價單號,C26.F03 客戶編號,C01.F05 客戶簡稱,C26.F09 交貨方式,C26.F10 付款方式,C26.F11 備註,C26.F14 幣別,C27.F02 料號,C27.F03 數量,C27.F04 單價,C27.F05 客戶品號,C27.F14 前置天數,C27.F06 包裝基量,C27.F07 最少採購,C27.F08 其他備註,C27.F09 包裝方式,;       
       C27.F10 是否特價,C27.F11 特價描述,C27.F12 包裝數量,IIF(C27.F13='2','Y','N') 轉入紀錄,C27.F15 有效日期,;        
       IIF(SEEK(C26.F03 +C27.F02+C26.F14+IIF(SEEK(C26.F03 +C27.F02+C26.F14+C27.F11,'C21','C212'),C21.F04,SPACE(1)),'C02','C023'),C02.F02,CTOD('')) 最後報價,;     
       IIF(SEEK(C26.F03 +C27.F02+C26.F14+IIF(SEEK(C26.F03 +C27.F02+C26.F14+C27.F11,'C21','C212'),C21.F04,SPACE(1)),'C02','C023'),ROUND(C02.F07,6),ROUND(0,6)) 目前售價;     
       FROM C26,C27,C01 WHERE C26.F01=LKK AND C27.F01=LKK AND C01.F01=C26.F03 ORDER BY C27.F02 NOWAIT        
       IF _TALLY>0
          GCDELIMFILE=PUTFILE('儲存路徑',LKK,'XLS') 
	      IF EMPTY(GCDELIMFILE)  && ESC PRESSED
	
	         RETURN
	      ELSE
	         ON ERROR DO FILE_IMPACT
	         IF _TALLY >0
	            COPY TO (GCDELIMFILE) TYPE XL5
	            =MESSAGEBOX('儲存成功',0+64,'提示訊息視窗')
	         ENDIF                             

          ENDIF   
  
       ENDIF
  
      IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1   
           THISFORM.GRID1.SETFOCUS
      ELSE
           THISFORM.GRID2.SETFOCUS
      ENDIF            
  ENDPROC
ENDDEFINE
*****************未回覆之估價單搜尋畫面
DEFINE CLASS APPRAISE_CHK AS FORM
*!*	  AUTOCENTER=.T.
  CAPTION='未回覆之估價單一覽表'
  TOP=INT_015*120
  LEFT=INT_015*30      
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*300
  WIDTH=INT_015*740
  MAXBUTTON=.F.
  MINBUTTON=.F.  
*!*	  MOVABLE=.F.
  CLOSABLE=.F.
  CONTROLBOX=.F.
  BORDERSTYLE=2
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WINDOWTYPE=1
  NAME='APPRAISE_CHK'
  ADD OBJECT CMDGROUP AS CMDGROUP WITH;
      TOP=INT_015*0,;
      LEFT=INT_015*170
  ADD OBJECT GRID1 AS GRID WITH;     
      AUTOCENTER=.T.,;
      HIGHLIGHTROWLINEWIDTH=4,;
      TOP=INT_015*35,;
      WIDTH=INT_015*740,;      
      HEIGHT=INT_015*260,;      
      ROWHEIGHT=INT_015*18,;
      HEADERHEIGHT=INT_015*19,;
      DELETEMARK=.F.,;
      READONLY=.T.,;
      RECORDSOURCETYPE=1,;
      COLUMNCOUNT=9,;            
      RECORDSOURCE='C27_TEMP',;    
      NAME='GRID1',;
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;  
      COLUMN3.NAME='COLUMN3',; 
      COLUMN4.NAME='COLUMN4',; 
      COLUMN5.NAME='COLUMN5',;  
      COLUMN6.NAME='COLUMN6',; 
      COLUMN7.NAME='COLUMN7',;      
      COLUMN8.NAME='COLUMN8',;      
      COLUMN9.NAME='COLUMN9' 
  ADD OBJECT KEY_LIST AS KEY_LIST WITH;
      LEFT=INT_015*5,;    
      TOP=INT_015*5,;
      WIDTH=INT_015*150         
  ADD OBJECT CMND1 AS COMMANDBUTTON WITH;
      LEFT=INT_015*385,;    
      HEIGHT=INT_015*25,;   
      TOP=INT_015*5,;        
      WIDTH=INT_015*65,;    
      FONTSIZE=INT_015*9,;
      CAPTION='\<E.轉EXCEL',;
      TOOLTIPTEXT='選擇游標所指的紀錄!快速鍵->ALT+S'
      NAME='CMND1'
  ADD OBJECT CMND2 AS COMMANDBUTTON WITH;
      LEFT=INT_015*453,;
      TOP=INT_015*5,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*55,;     
      FONTSIZE=INT_015*9,;      
      CAPTION='\<X.離開',;
      TOOLTIPTEXT='取消此搜尋畫面!快速鍵->ALT+X'
      NAME='CMND2'           
 PROCEDURE INIT     
         AREA1='C27_TEMP'   
         THISFORM.KEY_LIST.DISPLAYVALUE='依報價單號排列'     
         THISFORM.SETALL('MOUSEPOINTER',99,'COMMANDBUTTON')
         THISFORM.SETALL('MOUSEICON','BMPS\harrow.cur','COMMANDBUTTON')                
         THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'COLUMN') 
         THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'HEADER')
         THISFORM.SETALL('MOVABLE',.F.,'COLUMN')   
         THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='報價單號'
         THISFORM.GRID1.COLUMN1.WIDTH=INT_015*70
         THISFORM.GRID1.COLUMN1.CONTROLSOURCE='C27_TEMP.F01'
         THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='報價日期'
         THISFORM.GRID1.COLUMN2.WIDTH=INT_015*60
         THISFORM.GRID1.COLUMN2.CONTROLSOURCE='C27_TEMP.F02_A'
         THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='報價對象'
         THISFORM.GRID1.COLUMN3.WIDTH=INT_015*50
         THISFORM.GRID1.COLUMN3.CONTROLSOURCE='C27_TEMP.F03_A'
         THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='對象名稱'
         THISFORM.GRID1.COLUMN4.WIDTH=INT_015*70
         THISFORM.GRID1.COLUMN4.CONTROLSOURCE='C27_TEMP.CUSTNAME'        
         THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='報價料號'
         THISFORM.GRID1.COLUMN5.WIDTH=INT_015*240
         THISFORM.GRID1.COLUMN5.CONTROLSOURCE='C27_TEMP.F02_B'        
         THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='報價數量'
         THISFORM.GRID1.COLUMN6.WIDTH=INT_015*50
         THISFORM.GRID1.COLUMN6.CONTROLSOURCE='C27_TEMP.F03_B'
         THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='單價'
         THISFORM.GRID1.COLUMN7.WIDTH=INT_015*65
         THISFORM.GRID1.COLUMN7.CONTROLSOURCE='C27_TEMP.F04'
         THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='報價人員'
         THISFORM.GRID1.COLUMN8.WIDTH=INT_015*50
         THISFORM.GRID1.COLUMN8.CONTROLSOURCE='C27_TEMP.UserNO'
         THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='人員姓名'
         THISFORM.GRID1.COLUMN9.WIDTH=INT_015*60
         THISFORM.GRID1.COLUMN9.CONTROLSOURCE='C27_TEMP.UserName'         
         THISFORM.GRID1.SETFOCUS                  
 ENDPROC 
  PROC GRID1.AFTERROWCOLCHANGE
       LPARAMETERS NCOLINDEX
*!*	       THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(INV.EXP_1=1,RGB(255,255,128),'')","COLUMN")
       FCH=THISFORM.ACTIVECONTROL.NAME
       JK=THIS.COLUMN1.HEADER1.CAPTION  
       CHK=''   
   ENDPROC 
  PROC KEY_LIST.INIT 
       WITH THIS 
           .ADDITEM('依報價單號排列')
           .ADDITEM('依報價日期排列')
           .ADDITEM('依報價對象排列')
           .ADDITEM('依報價人員排列')
       ENDWITH      
  ENDPROC    
  PROC KEY_LIST.INTERACTIVECHANGE                 
       SELE C27_TEMP
       DO CASE
              CASE THIS.DISPLAYVALUE='依報價單號排列'  
              		  SET ORDER TO C27_TEMP1
		         THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='報價單號'
		         THISFORM.GRID1.COLUMN1.WIDTH=INT_015*70
		         THISFORM.GRID1.COLUMN1.CONTROLSOURCE='C27_TEMP.F01'
		         THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='報價日期'
		         THISFORM.GRID1.COLUMN2.WIDTH=INT_015*60
		         THISFORM.GRID1.COLUMN2.CONTROLSOURCE='C27_TEMP.F02_A'
		         THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='報價對象'
		         THISFORM.GRID1.COLUMN3.WIDTH=INT_015*50
		         THISFORM.GRID1.COLUMN3.CONTROLSOURCE='C27_TEMP.F03_A'
		         THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='對象名稱'
		         THISFORM.GRID1.COLUMN4.WIDTH=INT_015*70
		         THISFORM.GRID1.COLUMN4.CONTROLSOURCE='C27_TEMP.CUSTNAME'        
		         THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='報價料號'
		         THISFORM.GRID1.COLUMN5.WIDTH=INT_015*240
		         THISFORM.GRID1.COLUMN5.CONTROLSOURCE='C27_TEMP.F02_B'        
		         THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='報價數量'
		         THISFORM.GRID1.COLUMN6.WIDTH=INT_015*50
		         THISFORM.GRID1.COLUMN6.CONTROLSOURCE='C27_TEMP.F03_B'
		         THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='單價'
		         THISFORM.GRID1.COLUMN7.WIDTH=INT_015*65
		         THISFORM.GRID1.COLUMN7.CONTROLSOURCE='C27_TEMP.F04'
		         THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='報價人員'
		         THISFORM.GRID1.COLUMN8.WIDTH=INT_015*50
		         THISFORM.GRID1.COLUMN8.CONTROLSOURCE='C27_TEMP.UserNO'
		         THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='人員姓名'
		         THISFORM.GRID1.COLUMN9.WIDTH=INT_015*60
		         THISFORM.GRID1.COLUMN9.CONTROLSOURCE='C27_TEMP.UserName'              		  
              CASE THIS.DISPLAYVALUE='依報價日期排列'  
              		  SET ORDER TO C27_TEMP2              
		         THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='報價日期'
		         THISFORM.GRID1.COLUMN1.WIDTH=INT_015*60
		         THISFORM.GRID1.COLUMN1.CONTROLSOURCE='C27_TEMP.F02_A'
		         THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='報價單號'
		         THISFORM.GRID1.COLUMN2.WIDTH=INT_015*70
		         THISFORM.GRID1.COLUMN2.CONTROLSOURCE='C27_TEMP.F01'		         
		         THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='報價對象'
		         THISFORM.GRID1.COLUMN3.WIDTH=INT_015*50
		         THISFORM.GRID1.COLUMN3.CONTROLSOURCE='C27_TEMP.F03_A'
		         THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='對象名稱'
		         THISFORM.GRID1.COLUMN4.WIDTH=INT_015*70
		         THISFORM.GRID1.COLUMN4.CONTROLSOURCE='C27_TEMP.CUSTNAME'        
		         THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='報價料號'
		         THISFORM.GRID1.COLUMN5.WIDTH=INT_015*240
		         THISFORM.GRID1.COLUMN5.CONTROLSOURCE='C27_TEMP.F02_B'        
		         THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='報價數量'
		         THISFORM.GRID1.COLUMN6.WIDTH=INT_015*50
		         THISFORM.GRID1.COLUMN6.CONTROLSOURCE='C27_TEMP.F03_B'
		         THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='單價'
		         THISFORM.GRID1.COLUMN7.WIDTH=INT_015*65
		         THISFORM.GRID1.COLUMN7.CONTROLSOURCE='C27_TEMP.F04'
		         THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='報價人員'
		         THISFORM.GRID1.COLUMN8.WIDTH=INT_015*50
		         THISFORM.GRID1.COLUMN8.CONTROLSOURCE='C27_TEMP.UserNO'
		         THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='人員姓名'
		         THISFORM.GRID1.COLUMN9.WIDTH=INT_015*60
		         THISFORM.GRID1.COLUMN9.CONTROLSOURCE='C27_TEMP.UserName'                         		  
              CASE THIS.DISPLAYVALUE='依報價對象排列'         
              		  SET ORDER TO C27_TEMP3                              
		         THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='報價對象'
		         THISFORM.GRID1.COLUMN1.WIDTH=INT_015*50
		         THISFORM.GRID1.COLUMN1.CONTROLSOURCE='C27_TEMP.F03_A'            
		         THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='對象名稱'
		         THISFORM.GRID1.COLUMN2.WIDTH=INT_015*70
		         THISFORM.GRID1.COLUMN2.CONTROLSOURCE='C27_TEMP.CUSTNAME'        		           		  
		         THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='報價單號'
		         THISFORM.GRID1.COLUMN3.WIDTH=INT_015*70
		         THISFORM.GRID1.COLUMN3.CONTROLSOURCE='C27_TEMP.F01'
		         THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='報價日期'
		         THISFORM.GRID1.COLUMN4.WIDTH=INT_015*60
		         THISFORM.GRID1.COLUMN4.CONTROLSOURCE='C27_TEMP.F02_A'
		         THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='報價料號'
		         THISFORM.GRID1.COLUMN5.WIDTH=INT_015*240
		         THISFORM.GRID1.COLUMN5.CONTROLSOURCE='C27_TEMP.F02_B'        
		         THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='報價數量'
		         THISFORM.GRID1.COLUMN6.WIDTH=INT_015*50
		         THISFORM.GRID1.COLUMN6.CONTROLSOURCE='C27_TEMP.F03_B'
		         THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='單價'
		         THISFORM.GRID1.COLUMN7.WIDTH=INT_015*65
		         THISFORM.GRID1.COLUMN7.CONTROLSOURCE='C27_TEMP.F04'
		         THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='報價人員'
		         THISFORM.GRID1.COLUMN8.WIDTH=INT_015*50
		         THISFORM.GRID1.COLUMN8.CONTROLSOURCE='C27_TEMP.UserNO'
		         THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='人員姓名'
		         THISFORM.GRID1.COLUMN9.WIDTH=INT_015*60
		         THISFORM.GRID1.COLUMN9.CONTROLSOURCE='C27_TEMP.UserName'                  		       
              CASE THIS.DISPLAYVALUE='依報價人員排列'  
              		  SET ORDER TO C27_TEMP4             
		         THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='報價人員'
		         THISFORM.GRID1.COLUMN1.WIDTH=INT_015*50
		         THISFORM.GRID1.COLUMN1.CONTROLSOURCE='C27_TEMP.UserNO'
		         THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='人員姓名'
		         THISFORM.GRID1.COLUMN2.WIDTH=INT_015*60
		         THISFORM.GRID1.COLUMN2.CONTROLSOURCE='C27_TEMP.UserName'                           		  
		         THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='報價單號'
		         THISFORM.GRID1.COLUMN3.WIDTH=INT_015*70
		         THISFORM.GRID1.COLUMN3.CONTROLSOURCE='C27_TEMP.F01'
		         THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='報價日期'
		         THISFORM.GRID1.COLUMN4.WIDTH=INT_015*60
		         THISFORM.GRID1.COLUMN4.CONTROLSOURCE='C27_TEMP.F02_A'
		         THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='報價對象'
		         THISFORM.GRID1.COLUMN5.WIDTH=INT_015*50
		         THISFORM.GRID1.COLUMN5.CONTROLSOURCE='C27_TEMP.F03_A'
		         THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='對象名稱'
		         THISFORM.GRID1.COLUMN6.WIDTH=INT_015*70
		         THISFORM.GRID1.COLUMN6.CONTROLSOURCE='C27_TEMP.CUSTNAME'        
		         THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='報價料號'
		         THISFORM.GRID1.COLUMN7.WIDTH=INT_015*240
		         THISFORM.GRID1.COLUMN7.CONTROLSOURCE='C27_TEMP.F02_B'        
		         THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='報價數量'
		         THISFORM.GRID1.COLUMN8.WIDTH=INT_015*50
		         THISFORM.GRID1.COLUMN8.CONTROLSOURCE='C27_TEMP.F03_B'
		         THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='單價'
		         THISFORM.GRID1.COLUMN9.WIDTH=INT_015*65
		         THISFORM.GRID1.COLUMN9.CONTROLSOURCE='C27_TEMP.F04'               		   
       ENDCASE            
       THISFORM.GRID1.SETFOCUS             
  ENDPROC              
   **
 PROCEDURE CMND1.CLICK
   FLG='0'
   SELECT  C27_TEMP
   APPRAISE_RANGE=CREATEOBJECT("APPRAISE_RANGE")  
   APPRAISE_RANGE.SHOW    
   IF FLG<>'1'
       =MESSAGEBOX('無此範圍資料',0+48,'警示')
   ENDIF   
   FLG='0'     
   THISFORM.GRID1.SETFOCUS  
 ENDPROC  
 ****
 PROCEDURE CMND2.CLICK
*!*	      SELECT C27_TEMP
*!*	      USE      
      THISFORM.RELEASE
 ENDPROC   
 ENDDEFINE 
***********************************************列印範圍選定
DEFINE CLASS APPRAISE_RANGE AS FORM
  AUTOCENTER=.T.
  CAPTION='請輸入轉EXCEL資料範圍'
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*190
  WIDTH=INT_015*480
  FONTSIZE=INT_015*9
  CLOSABLE=.F.
  CONTROLBOX=.F.
  BORDERSTYLE=2
  MAXBUTTON=.F.
  MINBUTTON=.F.    
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WINDOWTYPE=1
  NAME='APPRAISE_RANGE'
  ADD OBJECT LABEL1 AS LABEL WITH;
      AUTOSIZE=.T.,;
      HEIGHT=INT_015*25,;
      LEFT=INT_015*28,;
      TOP=INT_015*75,;
      NAME='LABEL1'
  ADD OBJECT LABEL2 AS LABEL WITH;
      AUTOSIZE=.T.,;
      HEIGHT=INT_015*25,;
      LEFT=INT_015*250,;
      TOP=INT_015*75,;
      NAME='LABEL2'
  ADD OBJECT TEXT1 AS TEXTBOX WITH;
      AUTOSIZE=.T.,;
      TOP=INT_015*70,;
      LEFT=INT_015*105,;
      HEIGHT=INT_015*25,; 
      NAME='TEXT1'
  ADD OBJECT TEXT2 AS TEXTBOX WITH;
      AUTOSIZE=.T.,;
      TOP=INT_015*70,;
      LEFT=INT_015*330,;
      HEIGHT=INT_015*25,;         
      NAME='TEXT2'    
  ADD OBJECT CMND1 AS COMMANDBUTTON WITH;
      AUTOSIZE=.T.,;
      LEFT=INT_015*100,;    
      HEIGHT=INT_015*25,;   
      TOP=INT_015*144,;  
      WIDTH=INT_015*80,;
      CAPTION='\<Y.執行',;
      TOOLTIPTEXT='確認所輸入的範圍鍵值!快速鍵->ALT+Y',;
      NAME='CMND1'
  ADD OBJECT CMND2 AS COMMANDBUTTON WITH;
      AUTOSIZE=.T.,;
      LEFT=INT_015*300,;
      TOP=INT_015*144,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*80,;
      CAPTION='\<C.取消',;
      TOOLTIPTEXT='取消作業!快速鍵->ALT+C',;
      NAME='CMND2'
  PROCEDURE INIT 
      THISFORM.SETALL('FONTSIZE',INT_015*9,'TEXTBOX')
      THISFORM.SETALL('FONTSIZE',INT_015*9,'LABEL')      
      THISFORM.SETALL('FONTSIZE',INT_015*9,'COMMANDBUTTON')            
      DO CASE
         CASE KEY()='F01'    
              THISFORM.LABEL1.CAPTION='起始報價單號'
              THISFORM.LABEL2.CAPTION='截止報價單號'
              THISFORM.TEXT1.WIDTH=INT_015*75
              THISFORM.TEXT2.WIDTH=INT_015*75   
              THISFORM.TEXT1.MAXLENGTH=10           
              THISFORM.TEXT2.MAXLENGTH=10                                       
              THISFORM.TEXT1.VALUE=C27_TEMP.F01
              THISFORM.TEXT2.VALUE=C27_TEMP.F01              
         CASE KEY()='F02_A'
              THISFORM.LABEL1.CAPTION='起始報價日期'
              THISFORM.LABEL2.CAPTION='截止報價日期'
              THISFORM.TEXT1.WIDTH=INT_015*75
              THISFORM.TEXT2.WIDTH=INT_015*75 
              THISFORM.TEXT1.MAXLENGTH=10
              THISFORM.TEXT2.MAXLENGTH=10
              THISFORM.TEXT1.VALUE=C27_TEMP.F02_A
              THISFORM.TEXT2.VALUE=C27_TEMP.F02_A          
         CASE KEY()='F03_A'       
              THISFORM.LABEL1.CAPTION='起始報價對象'
              THISFORM.LABEL2.CAPTION='截止報價對象'
              THISFORM.TEXT1.WIDTH=INT_015*60
              THISFORM.TEXT2.WIDTH=INT_015*60   
              THISFORM.TEXT1.MAXLENGTH=5             
              THISFORM.TEXT2.MAXLENGTH=5                                       
              THISFORM.TEXT1.VALUE=C27_TEMP.F03_A
              THISFORM.TEXT2.VALUE=C27_TEMP.F03_A
*!*	         CASE KEY()='UserNO+UserNam'      
         OTHERWISE
              THISFORM.LABEL1.CAPTION='起始報價人員'
              THISFORM.LABEL2.CAPTION='截止報價人員'
              THISFORM.TEXT1.WIDTH=INT_015*60
              THISFORM.TEXT2.WIDTH=INT_015*60              
              THISFORM.TEXT1.MAXLENGTH=5            
              THISFORM.TEXT2.MAXLENGTH=5                            
              THISFORM.TEXT1.VALUE=C27_TEMP.UserNO
              THISFORM.TEXT2.VALUE=C27_TEMP.UserNO
      ENDCASE   
  ENDPROC    
  PROCEDURE CMND1.CLICK      
     FILENAME="未回覆之估價單一覽表"
     DO CASE 
           CASE KEY()='F01'   
                      SELECT F01 報價單號,F02_A 報價日期,F03_A 報價對象,custname 對象名稱,F02_B 料號,F03_B 報價數量,F04 單價,userno 報價人員,username 人員姓名;
                      FROM C27_TEMP WHERE  C27_TEMP.F01 >= THISFORM.TEXT1.VALUE AND C27_TEMP.F01 <= THISFORM.TEXT2.VALUE ORDER BY C27_TEMP.F01 NOWAIT
                      IF _TALLY >0
	                   FLG='1' 
			   GCDELIMFILE=PUTFILE('儲存路徑',FILENAME,'XLS')
			   IF !EMPTY(GCDELIMFILE) 
			        ON ERROR DO FILE_IMPACT
			   	COPY TO (GCDELIMFILE) TYPE XL5     
			        =MESSAGEBOX('儲存成功',0+64,'提示訊息視窗') 
			   ENDIF    	                   
	              ENDIF  
           CASE KEY()='F02_A'   
                      SELECT F02_A 報價日期,F01 報價單號,F03_A 報價對象,custname 對象名稱,F02_B 料號,F03_B 報價數量,F04 單價,userno 報價人員,username 人員姓名;
                      FROM C27_TEMP WHERE  C27_TEMP.F02_A >= THISFORM.TEXT1.VALUE AND C27_TEMP.F02_A <= THISFORM.TEXT2.VALUE ORDER BY C27_TEMP.F02_A NOWAIT
                      IF _TALLY >0
	                   FLG='1' 
			   GCDELIMFILE=PUTFILE('儲存路徑',FILENAME,'XLS')
			   IF !EMPTY(GCDELIMFILE) 
			        ON ERROR DO FILE_IMPACT
			   	COPY TO (GCDELIMFILE) TYPE XL5     
			        =MESSAGEBOX('儲存成功',0+64,'提示訊息視窗') 
			   ENDIF    	                   
	              ENDIF             
           CASE KEY()='F03_A'   
                      SELECT F03_A 報價對象,custname 對象名稱,F01 報價單號,F02_A 報價日期,F02_B 料號,F03_B 報價數量,F04 單價,userno 報價人員,username 人員姓名;
                      FROM C27_TEMP WHERE  C27_TEMP.F03_A >= THISFORM.TEXT1.VALUE AND C27_TEMP.F03_A <= THISFORM.TEXT2.VALUE ORDER BY C27_TEMP.F03_A NOWAIT
                      IF _TALLY >0
	                   FLG='1' 
			   GCDELIMFILE=PUTFILE('儲存路徑',FILENAME,'XLS')
			   IF !EMPTY(GCDELIMFILE) 
			        ON ERROR DO FILE_IMPACT
			   	COPY TO (GCDELIMFILE) TYPE XL5     
			        =MESSAGEBOX('儲存成功',0+64,'提示訊息視窗') 
			   ENDIF    	                   
	              ENDIF             
*!*	           CASE KEY()='UserNO+UserNam   
	    OTHERWISE
                      SELECT userno 報價人員,username 人員姓名,F01 報價單號,F02_A 報價日期,F03_A 報價對象,custname 對象名稱,F02_B 料號,F03_B 報價數量,F04 單價;
                      FROM C27_TEMP WHERE  C27_TEMP.userno >= THISFORM.TEXT1.VALUE AND C27_TEMP.userno <= THISFORM.TEXT2.VALUE ORDER BY C27_TEMP.userno NOWAIT
                      IF _TALLY >0
	                   FLG='1' 
			   GCDELIMFILE=PUTFILE('儲存路徑',FILENAME,'XLS')
			   IF !EMPTY(GCDELIMFILE) 
			        ON ERROR DO FILE_IMPACT
			   	COPY TO (GCDELIMFILE) TYPE XL5     
			        =MESSAGEBOX('儲存成功',0+64,'提示訊息視窗') 
			   ENDIF    	                   
	              ENDIF  
      ENDCASE     
     THISFORM.RELEASE    
  ENDPROC
  PROCEDURE CMND2.CLICK
      FLG='1'   
      THISFORM.RELEASE
  ENDPROC        
ENDDEFINE   
 ***********        
***********************************************列印程序
PROCEDURE PNT_PRC  
     LK=C26.F01
     PNT_CHK=CREATEOBJECT("PNT_CHK")  
     PNT_CHK.SHOW    
ENDPROC
********************************************************
DEFINE CLASS PNT_CHK AS FORM
  AUTOCENTER=.T.
  CAPTION='請選擇列印內容'
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*110
  WIDTH=INT_015*245
  FONTSIZE=INT_015*9
  CLOSABLE=.F.
  CONTROLBOX=.F.
  MAXBUTTON=.F.
  MINBUTTON=.F.    
  BORDERSTYLE=2
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WINDOWTYPE=1
  NAME='PNT_CHK'
ADD OBJECT DATA_OPTION AS OPTIONGROUP WITH;
      LEFT=INT_015*17,;
      TOP=INT_015*20,;
      AUTOSIZE=.T.,;
      FONTSIZE=INT_015*12,;
      BUTTONCOUNT=2,;
      OPTION1.CAPTION='列印客戶報價單',;
      OPTION1.TOP=INT_015*0,;
      OPTION1.FONTSIZE=INT_015*9,;
      OPTION1.AUTOSIZE=.T.,;
      OPTION2.CAPTION='列印估價申請單',;
      OPTION2.TOP=INT_015*40,;
      OPTION2.FONTSIZE=INT_015*9,;
      OPTION2.AUTOSIZE=.T.,; 
      NAME='DATA_OPTION'   
  ADD OBJECT CMND1 AS COMMANDBUTTON WITH;
      LEFT=INT_015*175,;     
      TOP=INT_015*23,;  
      HEIGHT=INT_015*25,;    
      WIDTH=INT_015*50,;
      FONTSIZE=INT_015*10,;
      CAPTION='\<Y.確定',;
      TOOLTIPTEXT='確認所選擇的鍵值!快速鍵->ALT+Y',;
      NAME='CMND1'
  ADD OBJECT CMND2 AS COMMANDBUTTON WITH;
      LEFT=INT_015*175,;
      TOP=INT_015*61,;
      HEIGHT=INT_015*25,;    
      WIDTH=INT_015*50,;
      FONTSIZE=INT_015*10,;
      CAPTION='\<C.取消',;
      TOOLTIPTEXT='取消作業!快速鍵->ALT+C',;
      NAME='CMND2'     
  *****      
 PROC INIT  
       IF IIF(C26.F04='00',.F.,.T.)
           THISFORM.DATA_OPTION.ENABLED=.T. 
           THISFORM.DATA_OPTION.OPTION2.FONTSTRIKETHRU=.F.
       ELSE
            THISFORM.DATA_OPTION.ENABLED=.F. 
            THISFORM.DATA_OPTION.OPTION2.FONTSTRIKETHRU=.T.
       ENDIF    
 ENDPROC  
 PROCEDURE CMND1.CLICK     
     DO CASE
  	  CASE THISFORM.DATA_OPTION.VALUE=1   
*!*	                     if messagebox('列印單價是否含稅?',4+32+256,'請確認')=6     
*!*	                        UKEF='1'
*!*	                      ELSE
*!*	                         UKEF='' 
*!*	                     ENDIF
                     if messagebox('是否列印產地?',4+32+0,'請確認')=6	        
                        CHK_STR='1'
                      ELSE
                         CHK_STR='' 
                     ENDIF
    		     SELECT C27.F01,;
	             C27.F02,;
	             C27.F03,;
	             C27.F14,;
	             C27.F04,;
	             C27.F05,;
	             C27.F06,;                    
	             C27.F07,;                    
	             C27.F08,;      
	             C27.F09,;
	             C27.F11,;
	             C27.F15,;
	             C27.F16,;
	             C26.F02,;
	             C26.F03,;
	             C26.F06,;
	             C26.F07,;
	             C26.F08,;
	             C26.F09,;
	             C26.F10,;
	             C26.F11,;
	             C26.F14,;
	             C26.F15,;  
	             C26.F16,;
	             B01.F04,; 
	             C01.F04,;
		         C01.F12,;
	             C01.F13,;
	             C01.F14,; 
	             C01.F23;
		     FROM C27,C26,C01,B01 WHERE C26.F01=LK AND B01.F01=C27.F02 AND C26.F01=C27.F01;
		     AND C01.F01=C26.F03  ORDER BY C27.F02 NOWAIT
		     IF _TALLY >0
		         REPORT FORM ALLTRIM(INT_116)+'C21' TO PRINT PROMPT PREVIEW        
		     ELSE
		        =MESSAGEBOX('資料有誤請洽系統管理人員',0+48,'警示')             
		     ENDIF    	  
          CASE THISFORM.DATA_OPTION.VALUE=2
		     CREATE CURSOR C21A;
		     (F01 C(10),F02_A D(8),F03_A C(5),F09 C(60),F10 C(60),F11 C(80),F02_B C(43),F05_A C(20),F08 C(80),F03_B C(1),F05_B C(8),F14_B N(3),F18 C(20),F06 C(4),F07_A N(14,6),F07_B N(11),F02_C D(8),F14_A C(4),F15 D(8),F16 C(20),F23 C(5))
		     INDE ON F02_B TAG C21A1
		     SELECT C26.F01,C26.F02,C26.F03,C26.F09,C26.F10,C26.F11,C26.F14,C26.F18,C27.F02,C27.F05,C27.F07,C27.F08,C27.F11,C27.F14,C27.F16,C01.F03,C01.F05,C01.F23 FROM C26,C27,C01;
		     WHERE C26.F01=LK AND C01.F01=C26.F03 AND  C27.F01=LK ORDER BY C27.F02 INTO CURSOR C21B
		     SELECT C21B
		     GO TOP
		     DO WHILE !EOF()
			    SELECT C21A
			    APPEND BLANK
			    REPLACE F01 	  WITH C21B.F01
			    REPLACE F02_A WITH C21B.F02_A	
			    REPLACE F03_A WITH C21B.F03_A
			    REPLACE F09 	  WITH C21B.F09
			    REPLACE F10 	  WITH C21B.F10
			    REPLACE F11 	  WITH C21B.F11_A
			    REPLACE F02_B  WITH C21B.F02_B
		   	    REPLACE F05_A  WITH C21B.F05_A
			    REPLACE F08	   WITH IIF(!EMPTY(C21B.F11_B),'『','')+ALLTRIM(C21B.F11_B)+IIF(!EMPTY(C21B.F11_B),'』','')+C21B.F08
			    REPLACE F03_B  WITH C21B.F03_B
			    REPLACE F05_B  WITH C21B.F05_B
			    REPLACE F14_B WITH C21B.F14_B
			    REPLACE F18 WITH C21B.F18
			    REPLACE F06      WITH IIF(SEEK(F03_A+F02_B,'C02'),C02.F06,'')
			    REPLACE F07_A  WITH IIF(SEEK(F03_A+F02_B+C21B.F14_A+IIF(SEEK(F03_A+F02_B+C21B.F14_A+C21B.F11_B,'C21','C212'),C21.F04,SPACE(1)),'C02'),C02.F07,0)			    
			    REPLACE F02_C  WITH IIF(SEEK(F03_A+F02_B+C21B.F14_A+IIF(SEEK(F03_A+F02_B+C21B.F14_A+C21B.F11_B,'C21','C212'),C21.F04,SPACE(1)),'C02'),C02.F02,CTOD(''))
			    REPLACE F07_B  WITH C21B.F07	
			    REPLACE F14_A	  WITH C21B.F14_A
			    REPLACE F23 	  WITH C21B.F23				    
			    REPLACE F15 WITH IIF(SEEK(F03_A+F02_B+C21B.F14_A+IIF(SEEK(F03_A+F02_B+C21B.F14_A+C21B.F11_B,'C21','C212'),C21.F04,SPACE(1)),'C02'),C02.F15,CTOD(''))
			    REPLACE F16 WITH C21B.F16
			    SELECT C21B
			    SKIP
	             ENDDO
		     SELECT C21B
		     USE
		     SELECT C21A
		     SET ORDER TO 1
		     IF _TALLY >0
			    REPORT FORM ALLTRIM(INT_116)+'C21A' TO PRINT PROMPT &&PREVIEW  
			    SELECT C21A
			    USE       
			    SELECT C26
			    REPLACE C26.F17 WITH C26.F17+1
		     ELSE
		         =MESSAGEBOX('資料有誤請洽系統管理人員',0+48,'警示')             
		     ENDIF           
     ENDCASE    
     THISFORM.RELEASE  
 ENDPROC   
 ***** 
  PROCEDURE CMND2.CLICK
      THISFORM.RELEASE
  ENDPROC      
ENDDEFINE 
************************************************特殊輸入欄位的設定----料號
DEFINE CLASS TXTF02 AS TEXTBOX
  READONLY=.T.
  MAXLENGTH=43
  FONTSIZE=INT_015*9
  PROCEDURE INTERACTIVECHANGE
    IF AT('?',ALLTRIM(THIS.VALUE))<>0
       IF AT('?',ALLTRIM(THIS.VALUE))>1             
          SELECT F01,F02 FROM B01 INTO CURSOR MTR ORDER BY F01 WHERE LEFT(F01,AT('?',THIS.VALUE)-1)=LEFT(THIS.VALUE,AT('?',THIS.VALUE)-1) AND LEFT(F42,6)<>"不報價"  
       ELSE
          SELECT F01,F02 FROM B01 INTO CURSOR MTR ORDER BY F01 WHERE LEFT(F42,6)<>"不報價"   
       ENDIF 
       IF _TALLY>0  
          MAN_SEEK=CREATEOBJECT("MTR_SEEK")  
          MAN_SEEK.SHOW    
          THIS.VALUE=FLG
          THIS.REFRESH
          FLG='0'        
       ENDIF    
    ELSE
       IF IIF(SEEK(THIS.VALUE,'B01'),LEFT(B01.F42,6),'')="不報價"
          =MESSAGEBOX("此料號"+THIS.Value+"已不再報價!",0+48,"提示訊息式窗")
          THIS.Value=""
          THIS.SetFocus
          RETURN
       ENDIF
    ENDIF  
       *THISFORM.PAGEFRAME1.PAGE2.LBLF021.CAPTION=IIF(SEEK(THIS.VALUE,'B01'),B01.F02,'') 
       THISFORM.PAGEFRAME1.PAGE2.TXTF16.VALUE=IIF(SEEK(THIS.VALUE,'B01'),B01.F02,'')
       THISFORM.PAGEFRAME1.PAGE2.TXTF14.VALUE=IIF(SEEK(THIS.VALUE,'B01'),B01.F28+B01.F31,0) 
       THISFORM.PAGEFRAME1.PAGE2.TXTF09.VALUE=IIF(SEEK(THIS.VALUE,'C20'),C20.F02,'BAG')        
       THISFORM.PAGEFRAME1.PAGE2.TXTF06.VALUE=IIF(SEEK(THIS.VALUE,'C20'),VAL(C20.F03),IIF(B01.F97 = 'Y',1000,1))
       THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE=IIF(SEEK(THIS.VALUE,'C20'),C20.F15,1)
*!*	       THISFORM.PAGEFRAME1.PAGE2.TXTF08.VALUE=IIF(SEEK(THIS.VALUE,'C20'),ALLTRIM(C20.F04),THISFORM.PAGEFRAME1.PAGE2.TXTF08.VALUE)   &&不再自動帶產地
       THISFORM.PAGEFRAME1.PAGE2.TXTF12.VALUE=IIF(SEEK(THIS.VALUE,'C20'),C20.F11,1)
*!*	       THISFORM.PAGEFRAME1.PAGE2.TXTF12.VALUE=IIF(SEEK(THIS.VALUE,'C20'),IIF(C20.F11=0,THISFORM.PAGEFRAME1.PAGE2.TXTF06.VALUE,C20.F11),THISFORM.PAGEFRAME1.PAGE2.TXTF06.VALUE)
       THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE=IIF(SEEK(C26.F03+THIS.VALUE+C26.F14+IIF(SEEK(C26.F03 +THIS.VALUE+C26.F14+THISFORM.PAGEFRAME1.PAGE2.TXTF11.VALUE;
       ,'C21','C212'),C21.F04,SPACE(1)),'C02','C023'),C02.F04,THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE)
       THISFORM.PAGEFRAME1.PAGE2.TXTF16.VALUE=IIF(SEEK(C26.F03+THIS.VALUE+C26.F14+IIF(SEEK(C26.F03 +THIS.VALUE+C26.F14+THISFORM.PAGEFRAME1.PAGE2.TXTF11.VALUE;
       ,'C21','C212'),C21.F04,SPACE(1)),'C02','C023'),C02.F16,THISFORM.PAGEFRAME1.PAGE2.TXTF16.VALUE)
       THISFORM.PAGEFRAME1.PAGE2.LBLF041.CAPTION= IIF(SEEK(C26.F03+THIS.VALUE+C26.F14+IIF(SEEK(C26.F03 +THIS.VALUE+C26.F14+THISFORM.PAGEFRAME1.PAGE2.TXTF11.VALUE;
       ,'C21','C212'),C21.F04,SPACE(1)),'C02','C023'),'目前售價：' + DTCX(C02.F15) + SPACE(1) + ALLTRIM(C02.F06) + SPACE(1) + ALLTRIM(TRANSFORM(C02.F07,'9999999.999999')),'無目前售價')
       IF THISFORM.PAGEFRAME1.PAGE2.TXTF10.VALUE='Y'
          THISFORM.PAGEFRAME1.PAGE2.CMB1.VISIBLE=SEEK(C26.F03+THIS.VALUE+C26.F14,'C21')       
       ENDIF
*!*	       IF AT('JST ',THISFORM.PAGEFRAME1.PAGE2.TXTF16.VALUE)>0
*!*	          THISFORM.PAGEFRAME1.PAGE2.TXTF06.READONLY=.T.
*!*	          THISFORM.PAGEFRAME1.PAGE2.TXTF07.READONLY=.T.
*!*	          THISFORM.PAGEFRAME1.PAGE2.TXTF12.READONLY=.T.
*!*	       ENDIF
  ENDPROC
ENDDEFINE
***************************************************特殊輸入欄位設定-----------客戶
DEFINE CLASS TXTF03 AS TEXTBOX
  READONLY=.T.
  MAXLENGTH=5
  FONTSIZE=INT_015*9   
  PROCEDURE INTERACTIVECHANGE
    IF AT('?',ALLTRIM(THIS.VALUE))<>0 
       IF AT('?',ALLTRIM(THIS.VALUE))>1             
          SELECT F02,F01,F04 FROM C01 INTO CURSOR VDR ORDER BY F02 WHERE F01=F45 AND LEFT(F02,AT('?',THIS.VALUE)-1)=LEFT(THIS.VALUE,AT('?',THIS.VALUE)-1)
       ELSE
          SELECT F02,F01,F04 FROM C01 INTO CURSOR VDR ORDER BY F02 WHERE F01=F45
       ENDIF          
       VDR_SEEK=CREATEOBJECT("VDR_SEEK")  
       VDR_SEEK.SHOW    
       THIS.VALUE=FLG
       THIS.REFRESH
       FLG='0'        
    ELSE
       IF LEN(ALLTRIM(THIS.VALUE))=4
          SELECT F02,F01,F04 FROM C01 INTO CURSOR VDR ORDER BY F02 WHERE F02=ALLTRIM(THIS.VALUE)
          DO CASE
             CASE _TALLY=1
                  THIS.VALUE=VDR.F01
                  THIS.REFRESH
             CASE _TALLY>1
                  VDR_SEEK=CREATEOBJECT("VDR_SEEK")  
                  VDR_SEEK.SHOW    
                  THIS.VALUE=FLG
                  THIS.REFRESH
                  FLG='0'        
          ENDCASE      
       ENDIF
    
    ENDIF      
       THISFORM.PAGEFRAME1.PAGE1.LBLF031.CAPTION=IIF(SEEK(THIS.VALUE,'C01'),C01.F04,'')  
       THISFORM.PAGEFRAME1.PAGE1.TXTF10.VALUE=IIF(SEEK(THIS.VALUE,'C01'),C01.F24,INT_129)  
       THISFORM.PAGEFRAME1.PAGE1.TXTF06.VALUE=IIF(SEEK(THIS.VALUE,'C01'),C01.F33,'')   
       THISFORM.PAGEFRAME1.PAGE1.TXTF06.REFRESH
       THISFORM.PAGEFRAME1.PAGE1.LBLF061.CAPTION=IIF(SEEK(THISFORM.PAGEFRAME1.PAGE1.TXTF06.VALUE,'A01'),A01.F03,'')    
       THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE=IIF(SEEK(THIS.VALUE,'C01'),C01.F12,'')   
       THISFORM.PAGEFRAME1.PAGE1.TXTF07.REFRESH
*!*	       THISFORM.PAGEFRAME1.PAGE1.CRCY.DISPLAYVALUE=IIF(SEEK(THIS.VALUE,'C02'),C02.F06,INT_011)
       THISFORM.PAGEFRAME1.PAGE1.CRCY.DISPLAYVALUE=IIF(SEEK(THIS.VALUE,'C01'),C01.F39,INT_011) 
       THISFORM.PAGEFRAME1.PAGE1.TXTF10.VALUE=IIF(SEEK(THISFORM.PAGEFRAME1.PAGE1.TXTF03.VALUE,'C01'),C01.F24,'')
       THISFORM.PAGEFRAME1.PAGE1.TXTF09.VALUE=IIF(SEEK(THISFORM.PAGEFRAME1.PAGE1.TXTF03.VALUE,'C01'),C01.F31,'')
       THISFORM.PAGEFRAME1.PAGE1.TXTF14.VALUE=THISFORM.PAGEFRAME1.PAGE1.CRCY.DISPLAYVALUE
       THISFORM.PAGEFRAME1.PAGE1.CRCY.REFRESH
       THISFORM.PAGEFRAME1.PAGE1.TXTF14.REFRESH     
       THISFORM.PAGEFRAME1.PAGE1.TXTF10.REFRESH     
  ENDPROC
ENDDEFINE
***************************************************特殊輸入欄位設定-----------業務員
DEFINE CLASS TXTF06 AS TEXTBOX
   READONLY=.T.
   MAXLENGTH=5
  FONTSIZE=INT_015*9   
   PROCEDURE INTERACTIVECHANGE
     IF AT('?',ALLTRIM(THIS.VALUE))<>0
        IF AT('?',ALLTRIM(THIS.VALUE))>1             
           SELECT F01,F03 FROM A01 INTO CURSOR MAN ORDER BY F01 WHERE LEFT(F01,AT('?',THIS.VALUE)-1)=LEFT(THIS.VALUE,AT('?',THIS.VALUE)-1)
        ELSE
           SELECT F01,F03 FROM A01 INTO CURSOR MAN ORDER BY F01    
        ENDIF   
        MAN_SEEK=CREATEOBJECT("MAN_SEEK")  
        MAN_SEEK.SHOW    
        THIS.VALUE=FLG
        THIS.REFRESH
        FLG='0'        
     ENDIF  
      THISFORM.PAGEFRAME1.PAGE1.LBLF061.CAPTION=IIF(SEEK(THIS.VALUE,'A01'),A01.F03,'')  
  ENDPROC
ENDDEFINE
***************************************************幣別設定
DEFINE CLASS CRCY AS COMBOBOX
  HEIGHT=INT_015*25
  FONTSIZE=INT_015*9     
  AUTOSIZE=.T.
  TOP=INT_015*9
  LEFT=INT_015*474
  BOUNDCOLUMN=1
  COLUMNCOUNT=1
  WIDTH=INT_015*60
  ROWSOURCETYPE=1
  STYLE=2
  NAME='CRCY'
  PROCEDURE INIT
    SELECT C00
    GO TOP 
    DO WHILE .NOT. EOF()
       L=4-LEN(ALLTRIM(F01))
       THIS.ADDITEM(F01)
       SKIP
    ENDDO
  ENDPROC
  PROCEDURE INTERACTIVECHANGE
    THISFORM.PAGEFRAME1.PAGE1.TXTF14.VALUE=THIS.DISPLAYVALUE
    THISFORM.PAGEFRAME1.PAGE1.TXTF14.REFRESH
  ENDPROC
ENDDEFINE  
************************************************特殊輸入欄位的設定----是否特價
DEFINE CLASS TXTF10 AS TEXTBOX
  READONLY=.T.
  HEIGHT=INT_015*25
  FONTSIZE=INT_015*9
  MAXLENGTH=1
  INPUTMASK='Y'
  PROCEDURE INTERACTIVECHANGE
       IF THIS.Value$'Yy'
          THISFORM.PAGEFRAME1.PAGE2.TXTF11.VISIBLE=.T.
          THISFORM.PAGEFRAME1.PAGE2.LBLF11.VISIBLE=.T.          
          THISFORM.PAGEFRAME1.PAGE2.CMB1.VISIBLE=SEEK(C26.F03+THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE+C26.F14,'C21')
       ELSE
       THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE=IIF(SEEK(C26.F03+THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE+C26.F14+SPACE(1),'C02','C023'),C02.F04,THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE)
       THISFORM.PAGEFRAME1.PAGE2.LBLF041.CAPTION= IIF(SEEK(C26.F03+THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE+C26.F14+SPACE(1),'C02','C023'),'目前售價：' + DTCX(C02.F15) + SPACE(1) + ALLTRIM(C02.F06) + SPACE(1) + ALLTRIM(TRANSFORM(C02.F07,'9999999.999999')),'無目前售價')              
          THISFORM.PAGEFRAME1.PAGE2.TXTF11.VALUE=SPACE(30)
          THISFORM.PAGEFRAME1.PAGE2.TXTF11.VISIBLE=.F.     
          THISFORM.PAGEFRAME1.PAGE2.LBLF11.VISIBLE=.F.               
          THISFORM.PAGEFRAME1.PAGE2.CMB1.VISIBLE=.F.     
       ENDIF

  ENDPROC
ENDDEFINE
*******************查看特價紀錄
DEFINE CLASS CMB1 AS COMMANDBUTTON
   HEIGHT=INT_015*25
   WIDTH=INT_015*35
   TOP=INT_015*108
   LEFT=INT_015*165
   FONTSIZE=INT_015*9
   NAME='CMB1'
   CAPTION='紀錄'
   TOOLTIPTEXT='查看有那些特價紀錄資料'
   PROC CLICK
        SELE C21
        
        GF=THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE

             SPC_SEEK=createobject("SPC_SEEK")  
             SPC_SEEK.SHOW    
             IF !EMPTY(FLG)
                THISFORM.PAGEFRAME1.PAGE2.TXTF11.VALUE=FLG
                THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE=IIF(SEEK(C26.F03+THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE+C26.F14+IIF(SEEK(C26.F03 +THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE+C26.F14+FLG;
                ,'C21','C212'),C21.F04,SPACE(1)),'C02','C023'),C02.F04,THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE)
                THISFORM.PAGEFRAME1.PAGE2.LBLF041.CAPTION= IIF(SEEK(C26.F03+THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE+C26.F14+IIF(SEEK(C26.F03 +THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE+C26.F14+FLG;
               ,'C21','C212'),C21.F04,SPACE(1)),'C02','C023'),'目前售價：' + DTCX(C02.F15) + SPACE(1) + ALLTRIM(C02.F06) + SPACE(1) + ALLTRIM(TRANSFORM(C02.F07,'9999999.999999')),'無目前售價')                                
             ENDIF               
             FLG=''                    
             AREA1='C26'
             SELE C27
*          endif 
  ENDPROC     
ENDDEFINE      
*******************************************************特價描述紀錄
DEFINE CLASS SPC_SEEK AS FORM
  AUTOCENTER=.T.
  CAPTION='特價描述紀錄'
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*340
  WIDTH=INT_015*336
  FONTSIZE=INT_015*9
  CONTROLBOX=.F.
  BORDERSTYLE=2
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WINDOWTYPE=1
  NAME='SPC_SEEK'
  ADD OBJECT GRID1 AS GRID WITH;          
      AUTOCENTER=.T.,;
      ALLOWCELLSELECTION=.F.,;
      TOP=INT_015*0,;
      WIDTH=INT_015*336,;      
      HEIGHT=INT_015*310,;      
      ROWHEIGHT=INT_015*18,;
      HEADERHEIGHT=INT_015*19,;
      DELETEMARK=.F.,;
      READONLY=.T.,;
      RECORDSOURCETYPE=1,;
      COLUMNCOUNT=2,;            
      NAME='GRID1',;
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2'
  ADD OBJECT CMDGROUP AS CMDGROUP WITH;      
      TOP=INT_015*310,;
      LEFT=INT_015*30,;
      VISIBLE=.T.      
  ADD OBJECT CMND1 AS COMMANDBUTTON WITH;
      LEFT=INT_015*203,;    
      HEIGHT=INT_015*25,;   
      TOP=INT_015*315,;  
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;
      CAPTION='\<S.選取',;
      TOOLTIPTEXT='選擇游標所指的紀錄!快速鍵->ALT+S'
      NAME='CMND1'
  ADD OBJECT CMND2 AS COMMANDBUTTON WITH;
      LEFT=INT_015*245,;
      TOP=INT_015*315,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;      
      CAPTION='\<C.取消',;
      TOOLTIPTEXT='取消此搜尋畫面!快速鍵->ALT+C'
      NAME='CMND2'
      PROCEDURE INIT 
        AREA1='C21' 
        SELE C21
        SET FILTER TO F01=C26.F03 .AND. F02=GF .AND. F03=C26.F14
         SEEK C26.F03+GF+C26.F14
         THISFORM.GRID1.READONLY=.T. 
         THISFORM.GRID1.RECORDSOURCE='C21'         
         THISFORM.CMDGROUP.SEEK_BOTT.VISIBLE=.F.
         THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'COLUMN')
         THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'HEADER')         
         THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='描述說明'
         THISFORM.GRID1.COLUMN1.WIDTH=INT_015*210
         THISFORM.GRID1.COLUMN1.CONTROLSOURCE='C21.F05'
         THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='首次報價'
         THISFORM.GRID1.COLUMN2.CONTROLSOURCE='C21.F06'
         THISFORM.GRID1.COLUMN2.WIDTH=INT_015*80
         THISFORM.GRID1.SETFOCUS
         IF THISFORM.GRID1.ACTIVEROW<>0
              THISFORM.GRID1.AFTERROWCOLCHANGE 
         ENDIF         
      ENDPROC
      PROC GRID1.AFTERROWCOLCHANGE
       LPARAMETERS XCOLINDEX     
         FCH=THISFORM.ACTIVECONTROL.NAME  
         FLG=C21.F05
      ENDPROC 
      PROCEDURE CMND1.CLICK  
          THISFORM.RELEASE                
          SET FILTER TO                                   
      ENDPROC
      PROCEDURE CMND2.CLICK
          FLG=''   
          THISFORM.RELEASE
          SET FILTER TO
      ENDPROC      
ENDDEFINE          
****************************
*********************************************************************轉正式訂單輸入畫面
define class CPC_SEEK as form
  autocenter=.t. 
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*136
  WIDTH=INT_015*430
  FONTSIZE=INT_015*9
  CONTROLBOX=.F.
  BORDERSTYLE=2
  SHOWTIPS=.T.
  showwindow=1
  windowtype=1
  name='CPC_SEEK'
  ADD OBJECT SHAPE1 AS SHAPE1 WITH;
      LEFT=INT_015*3,;
      WIDTH=INT_015*423,;
      HEIGHT=INT_015*35
  ADD OBJECT SHAPE3 AS SHAPE3 WITH;
      LEFT=INT_015*3,;
      TOP=INT_015*100,;
      WIDTH=INT_015*423,;
      HEIGHT=INT_015*35    
  ADD OBJECT LBLF03 AS LABEL WITH;
      TOP=INT_015*8,;
      LEFT=INT_015*5,;
      WIDTH=INT_015*50,;
      CAPTION='報價日期'
  ADD OBJECT LBLF04 AS LABEL WITH;
      TOP=INT_015*8,;
      LEFT=INT_015*150,;
      WIDTH=INT_015*50,;
      CAPTION='客戶編號'
  ADD OBJECT LBLF041 AS LABEL WITH;
      TOP=INT_015*8,;
      LEFT=INT_015*253,;
      AUTOSIZE=.T.,;
      CAPTION=''      
  ADD OBJECT LBLF01 AS LABEL WITH;
      TOP=INT_015*48,;
      LEFT=INT_015*5,;
      WIDTH=INT_015*50,;
      CAPTION='轉入單號'      
  ADD OBJECT TXTF03 AS TEXTBOX WITH;
      TOP=INT_015*4,;
      LEFT=INT_015*56,;
      WIDTH=INT_015*73,;
      HEIGHT=INT_015*25,;
      NAME='TXTF03'
  ADD OBJECT TXTF04 AS TEXTBOX WITH;
      TOP=INT_015*4,;
      LEFT=INT_015*201,;
      WIDTH=INT_015*50,;
      HEIGHT=INT_015*25,;
      MAXLENGTH=5,;
      NAME='TXTF04'      
  ADD OBJECT TXTF01 AS TEXTBOX WITH;
      TOP=INT_015*44,;
      LEFT=INT_015*56,;
      WIDTH=INT_015*80,;
      HEIGHT=INT_015*25,;
      MAXLENGTH=10,;
      READONLY=INT_013,;
      NAME='TXTF01'            
   add object cmnd1 as commandbutton with;
      LEFT=INT_015*150,;
      TOP=INT_015*105,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;
      caption='\<S.確認',;
      TOOLTIPTEXT='取消此作業畫面!快速鍵->ALT+X'
      name='cmnd2'
  add object cmnd2 as commandbutton with;
      LEFT=INT_015*191,;
      TOP=INT_015*105,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;
      caption='\<X.離開',;
      TOOLTIPTEXT='取消此作業畫面!快速鍵->ALT+X'
      name='cmnd2'
      procedure init 
         THISFORM.caption='複製報價單'+FTR_STR
         THISFORM.SETALL('FONTSIZE',INT_015*9,'TEXTBOX') 
         THISFORM.SETALL('FONTSIZE',INT_015*9,'LABEL')      
         
         THISFORM.TXTF03.VALUE=DATE()
         THISFORM.TXTF04.VALUE=''       
      ENDPROC
      procedure cmnd1.click      
          IF EMPTY(THISFORM.TXTF04.VALUE)
             =MESSAGEBOX('客戶編號不得空白',0+48,'提示訊息視窗')
             THISFORM.TXTF04.SETFOCUS
             RETURN
          ENDIF
          IF !SEEK(THISFORM.TXTF04.VALUE,'C01')
              =MESSAGEBOX('無此客戶編號',0+48,'提示訊息視窗')
             THISFORM.TXTF04.SETFOCUS
             RETURN
          ENDIF
          IF INT_013=.T.
             HD='C021 '+SUBSTR(DTOS(DATE()),3,4)
             HD1='C021 '
             HD2='CC'
             HD3='客戶報價單'
             IF !USED('A09')
                SELE 0
                USE A09
             ELSE
                SELE A09
             ENDIF
             SET ORDER TO A091
             A24='A24'+LEFT(DTOS(DATE()),6)
             IF !USED('&A24')
                SELE 0
                USE (A24) ALIA A24
             ELSE
               SELE A24
             ENDIF
             SET ORDER TO 1      
             DO ODR_CRT    &&執行主程式中之單據新增 
             SELECT A24
             USE
             SELECT A09
             USE
             THISFORM.TXTF01.VALUE=PO_NO
          ELSE
             THISFORM.TXTF01.VALUE=''   
          ENDIF
          IF EMPTY(THISFORM.TXTF01.VALUE)
             =MESSAGEBOX('轉入單號不得空白',0+48,'提示訊息視窗')
             THISFORM.TXTF01.SETFOCUS
             RETURN          
          ENDIF
          IF SEEK(THISFORM.TXTF01.VALUE,'C26')
             =MESSAGEBOX('轉入單號重複',0+48,'提示訊息視窗')
             THISFORM.TXTF01.SETFOCUS
             RETURN          
          ENDIF
          SELECT * FROM C27 WHERE F01=FTR_STR INTO CURSOR C27TMP NOWAIT ORDER BY F02
          IF _TALLY>0
             SK=0
             SELECT C27TMP
             GO TOP
             DO WHILE !EOF()
                SK=SK+1
                IF SK>99
                   =MESSAGEBOX('只能轉99筆!',0+48,'提示訊息視窗')
                   SK=99
                   EXIT
                ENDIF   
                SELECT C27
                APPEND BLANK
                REPLACE F01 WITH THISFORM.TXTF01.VALUE
                REPLACE F02 WITH C27TMP.F02
                REPLACE F03 WITH C27TMP.F03
                REPLACE F04 WITH C27TMP.F04
                REPLACE F05 WITH C27TMP.F05
                REPLACE F06 WITH C27TMP.F06
                REPLACE F07 WITH C27TMP.F07
                REPLACE F08 WITH C27TMP.F08
                REPLACE F09 WITH C27TMP.F09
                REPLACE F10 WITH C27TMP.F10
                REPLACE F11 WITH C27TMP.F11
                REPLACE F12 WITH C27TMP.F12
                REPLACE F14 WITH IIF(SEEK(C27TMP.F02,'B01'),B01.F28+B01.F31,0)
                REPLACE F15 WITH C27TMP.F15
                REPLACE F16 WITH C27TMP.F16
                REPLACE F99 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
                SELECT C27TMP                
                SKIP
             ENDDO
             SELECT * FROM C26 WHERE F01=FTR_STR INTO CURSOR C26TMP NOWAIT
             IF _TALLY>0
                SELECT C26
                APPEND BLANK
                REPLACE F01 WITH THISFORM.TXTF01.VALUE
                REPLACE F02 WITH THISFORM.TXTF03.VALUE
                REPLACE F03 WITH THISFORM.TXTF04.VALUE
                REPLACE F04 WITH PADL(ALLTRIM(STR(SK)),2,'0')
                REPLACE F05 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
                REPLACE F06 WITH IIF(SEEK(F03,'C01'),C01.F33,'')
                REPLACE F07 WITH IIF(SEEK(F03,'C01'),C01.F12,'')
                REPLACE F08 WITH IIF(SEEK(F06,'A01'),A01.F03,'')
                REPLACE F09 WITH IIF(SEEK(F03,'C01'),C01.F31,'')
                REPLACE F10 WITH IIF(SEEK(F03,'C01'),C01.F24,'')
                REPLACE F11 WITH C26TMP.F11
                REPLACE F12 WITH C26TMP.F12
                REPLACE F13 WITH C26TMP.F13
                REPLACE F14 WITH C26TMP.F14
             ENDIF
          ENDIF
          =MESSAGEBOX('已轉入單號'+THISFORM.TXTF01.VALUE,0+48,'請至該單號再確認')
          THISFORM.CMND2.CLICK        
      endproc          
       procedure cmnd2.click      
          SELECT C26
          SEEK FTR_STR     
          
         thisform.release         
      endproc          
      
      PROCEDURE TXTF04.INTERACTIVECHANGE
              IF AT('?',ALLTRIM(THIS.VALUE))<>0 
                 IF AT('?',ALLTRIM(THIS.VALUE))>1             
                    SELECT F02,F01,F04 FROM C01 INTO CURSOR VDR ORDER BY F02 WHERE LEFT(F02,AT('?',THIS.VALUE)-1)=LEFT(THIS.VALUE,AT('?',THIS.VALUE)-1)
                 ELSE
                    SELECT F02,F01,F04 FROM C01 INTO CURSOR VDR ORDER BY F02 
                 ENDIF          
                 VDR_SEEK=CREATEOBJECT("VDR_SEEK")  
                 VDR_SEEK.SHOW    
                 THIS.VALUE=FLG
                 THIS.REFRESH
                 FLG='0'        
              ELSE
                 IF LEN(ALLTRIM(THIS.VALUE))=4
                    SELECT F02,F01,F04 FROM C01 INTO CURSOR VDR ORDER BY F02 WHERE F02=ALLTRIM(THIS.VALUE)
                    DO CASE
                      CASE _TALLY=1
                           THIS.VALUE=VDR.F01
                           THIS.REFRESH
                      CASE _TALLY>1
                          VDR_SEEK=CREATEOBJECT("VDR_SEEK")  
                          VDR_SEEK.SHOW    
                          THIS.VALUE=FLG
                          THIS.REFRESH
                          FLG='0'        
                    ENDCASE      
                ENDIF    
             ENDIF
             THISFORM.LBLF041.CAPTION=IIF(SEEK(THIS.VALUE,'C01'),C01.F05,'')  
   ENDPROC
      
      
      
ENDDEFINE      

*IIF(SEEK(C26.F03 +C27.F02+C26.F14+IIF(SEEK(C26.F03 +C27.F02+C26.F14+C27.F11,'C21','C212'),C21.F04,SPACE(1)),'C02','C023'),C02.F07,0) 前次報價;     