**程式名稱:S03.健保費表
SET EXCL OFF
CLOSE ALL
CLEAR 
AREA1='S03'
FLG='0'
FCH=''
CHK=''
R=0
IF !USED('A01')	&&操作人員資料設定
   SELE 0
   USE A01
ELSE 
   SELE A01
ENDIF
SET ORDER TO A01      
IF !USED('A02')	&&權限設定檔
   SELE 0
   USE A02 INDE A02
ELSE
   SELE A02
ENDIF
SET ORDER TO A021      
SEEK SYS_OPER+'S03'                 
IF !USED('S03')	&&健保費表
   SELE 0
   USE S03 
ELSE
   SELE S03
ENDIF
SET ORDER TO S031
IF !USED('S01')	&&薪資資料設定
   SELE 0
   USE S01 
ELSE
   SELE S01
ENDIF
SET ORDER TO S011   
SET FILTER TO F01='B'       &&健保費率資料類別編號B
GO TOP
******
S03FORM=CREATEOBJECT("TKS03")
S03FORM.SHOW  
DEFINE CLASS TKS03 AS FORM
  CAPTION='S03.健保費表'
*!*	  AUTOCENTER=.T.
  CONTROLBOX=.F.
  BORDERSTYLE=1  
  MAXBUTTON=.F.
  MINBUTTON=.F.
  MOVABLE=.F.
  CLOSABLE=.F.
  CONTROLCOUNT=57
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*550
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WIDTH=INT_015*791
  WINDOWTYPE=1
 ADD OBJECT SHAPE_GIRD AS SHAPE WITH;
       TOP=INT_015*150,;
       LEFT=INT_015*5,;
       HEIGHT=INT_015*380,;
       WIDTH=INT_015*780,;
       SPECIALEFFECT=0,;
       TOOLTIPTEXT='保險費率明細'     
       NAME='SHAPE_GIRD'       
  ADD OBJECT GRID1 AS GRID1 WITH;
      LEFT=INT_015*13,;
      TOP=INT_015*156,;
      HEIGHT=INT_015*370,;     
      WIDTH=INT_015*765,;  
      READONLY=.F.,;  
      SCROLLBARS=2,;
      COLUMNCOUNT=11,;            
      RECORDSOURCE='S03'
 ADD OBJECT CMDGROUP AS CMDGROUP WITH;
      VISIBLE=.F.        
 ADD OBJECT KEY_LIST AS KEY_LIST WITH; 
      VISIBLE=.F.     
ADD OBJECT SHAPEA AS SHAPE WITH;
       TOP=INT_015*3,;
       LEFT=INT_015*5,;
       HEIGHT=INT_015*145,;
       WIDTH=INT_015*300,;
       SPECIALEFFECT=0,;
       TOOLTIPTEXT='設定健保費率'     
       NAME='SHAPEA'   
  ADD OBJECT LBLF01 AS LABEL WITH;
      TOP=INT_015*15,;
      LEFT=INT_015*15,;
      HEIGHT=INT_015*23,;      
      WIDTH=INT_015*280,;
      CAPTION='全民健康保險費率：                                                 ％'      
  ADD OBJECT SPINNER1 AS SPINNER WITH;
      TOP=INT_015*8,;
      LEFT=INT_015*200,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*70,;
      VALUE=S01.F02,;
      KEYBOARDLOWVALUE=0,;
      KEYBOARDHIGHVALUE=100,;
      SPINNERLOWVALUE=0,;
      SPINNERHIGHVALUE=100,;
      INPUTMASK='999.99'
   ADD OBJECT LBLF02 AS LABEL WITH;
      TOP=INT_015*40,;
      LEFT=INT_015*15,;
      HEIGHT=INT_015*23,;      
      WIDTH=INT_015*280,;
      CAPTION='被保險人及眷屬月負擔金額比率：                         ％'    
   ADD OBJECT SPINNER2 AS SPINNER WITH;
      TOP=INT_015*33,;
      LEFT=INT_015*200,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*70,;
      VALUE=S01.F03,;
      KEYBOARDLOWVALUE=0,;
      KEYBOARDHIGHVALUE=100,;
      SPINNERLOWVALUE=0,;
      SPINNERHIGHVALUE=100,;
      INPUTMASK='999.99'   
   ADD OBJECT LBLF03 AS LABEL WITH;
      TOP=INT_015*65,;
      LEFT=INT_015*15,;
      HEIGHT=INT_015*23,;      
      WIDTH=INT_015*280,;
      CAPTION='投保單位負擔金額比率：                                         ％'    
  ADD OBJECT SPINNER3 AS SPINNER WITH;
      TOP=INT_015*58,;
      LEFT=INT_015*200,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*70,;
      VALUE=S01.F04,;
      KEYBOARDLOWVALUE=0,;
      KEYBOARDHIGHVALUE=100,;
      SPINNERLOWVALUE=0,;
      SPINNERHIGHVALUE=100,;
      INPUTMASK='999.99'       
   ADD OBJECT LBLF04 AS LABEL WITH;
      TOP=INT_015*90,;
      LEFT=INT_015*15,;
      HEIGHT=INT_015*23,;      
      WIDTH=INT_015*280,;
      CAPTION='政府補助金額比率：                                                 ％'   
  ADD OBJECT SPINNER4 AS SPINNER WITH;
      TOP=INT_015*83,;
      LEFT=INT_015*200,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*70,;
      VALUE=S01.F05,;
      KEYBOARDLOWVALUE=0,;
      KEYBOARDHIGHVALUE=100,;
      SPINNERLOWVALUE=0,;
      SPINNERHIGHVALUE=100,;
      INPUTMASK='999.99'  
   ADD OBJECT LBLF08 AS LABEL WITH;
      TOP=INT_015*115,;
      LEFT=INT_015*15,;
      HEIGHT=INT_015*23,;      
      WIDTH=INT_015*280,;
      CAPTION='不扣款之眷口數(含以上)：                                       人' 
  ADD OBJECT SPINNER8 AS SPINNER WITH;
      TOP=INT_015*108,;
      LEFT=INT_015*200,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*70,;
      VALUE=S01.F06,;
      KEYBOARDLOWVALUE=0,;
      KEYBOARDHIGHVALUE=99,;
      SPINNERLOWVALUE=0,;
      SPINNERHIGHVALUE=99,;
      INPUTMASK='99'        
  ADD OBJECT SHAPEB AS SHAPE WITH;
       TOP=INT_015*3,;
       LEFT=INT_015*310,;
       HEIGHT=INT_015*145,;
       WIDTH=INT_015*255,;
       SPECIALEFFECT=0,;
       TOOLTIPTEXT='設定殘障費率'     
       NAME='SHAPEB'         
  ADD OBJECT LBLF10 AS LABEL WITH;
      TOP=INT_015*15,;
      LEFT=INT_015*315,;
      HEIGHT=INT_015*23,;      
      WIDTH=INT_015*240,;
      CAPTION='眷口重度殘障補助比率：                            ％' 
  ADD OBJECT SPINNER10 AS SPINNER WITH;
      TOP=INT_015*8,;
      LEFT=INT_015*460,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*70,;
      VALUE=S01.F02,;
      KEYBOARDLOWVALUE=0,;
      KEYBOARDHIGHVALUE=100,;
      SPINNERLOWVALUE=0,;
      SPINNERHIGHVALUE=100,;
      INPUTMASK='999.99'       
   ADD OBJECT LBLF11 AS LABEL WITH;
      TOP=INT_015*40,;
      LEFT=INT_015*315,;
      HEIGHT=INT_015*23,;      
      WIDTH=INT_015*240,;
      CAPTION='眷口中度殘障補助比率：                            ％'   
   ADD OBJECT SPINNER11 AS SPINNER WITH;
      TOP=INT_015*33,;
      LEFT=INT_015*460,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*70,;
      VALUE=S01.F03,;
      KEYBOARDLOWVALUE=0,;
      KEYBOARDHIGHVALUE=100,;
      SPINNERLOWVALUE=0,;
      SPINNERHIGHVALUE=100,;
      INPUTMASK='999.99'   
   ADD OBJECT LBLF12 AS LABEL WITH;
      TOP=INT_015*65,;
      LEFT=INT_015*315,;
      HEIGHT=INT_015*23,;      
      WIDTH=INT_015*240,;
      CAPTION='眷口輕度殘障補助比率：                            ％'   
  ADD OBJECT SPINNER12 AS SPINNER WITH;
      TOP=INT_015*58,;
      LEFT=INT_015*460,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*70,;
      VALUE=S01.F04,;
      KEYBOARDLOWVALUE=0,;
      KEYBOARDHIGHVALUE=100,;
      SPINNERLOWVALUE=0,;
      SPINNERHIGHVALUE=100,;
      INPUTMASK='999.99'    
   ADD OBJECT LBLF09 AS LABEL WITH;
      TOP=INT_015*90,;
      LEFT=INT_015*315,;
      HEIGHT=INT_015*23,;      
      WIDTH=INT_015*240,;
      CAPTION='補助眷口65歲(含)以上 ：                            元' 
  ADD OBJECT SPINNER9 AS SPINNER WITH;
      TOP=INT_015*83,;
      LEFT=INT_015*460,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*70,;
      VALUE=S01.F08,;
      KEYBOARDLOWVALUE=0,;
      KEYBOARDHIGHVALUE=9999,;
      SPINNERLOWVALUE=0,;
      SPINNERHIGHVALUE=9999,;
      INPUTMASK='9999'       
  ADD OBJECT SUBSIDY_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*115,;
      LEFT=INT_015*460,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*90,;      
      FONTSIZE=INT_015*9,;
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\harrow.cur',;     
      CAPTION='\<U.補助眷口縣市',;
      NAME='SUBSIDY_BOTT'          
   ADD OBJECT LBLF05 AS LABEL WITH;
      TOP=INT_015*15,;
      LEFT=INT_015*572,;
      HEIGHT=INT_015*23,; 
      WIDTH=INT_015*30,;
      CAPTION='等級' 
  ADD OBJECT TXTF05 AS TEXTBOX WITH;
      TOP=INT_015*9,;
      LEFT=INT_015*600,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*30,;
      MAXLENGTH=2,;
      INPUTMASK='99' 
    ADD OBJECT LBLF06 AS LABEL WITH;
      TOP=INT_015*15,;
      LEFT=INT_015*647,;
      HEIGHT=INT_015*23,; 
      WIDTH=INT_015*70,;
       CAPTION='月投保金額'     
   ADD OBJECT TXTF06 AS TEXTBOX WITH;
      TOP=INT_015*9,;
      LEFT=INT_015*720,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*55,;
      MAXLENGTH=7,;
      INPUTMASK='9999999'      
 ADD OBJECT LBLF99 AS LABEL WITH;
      TOP=INT_015*60,;
      LEFT=INT_015*573,;
      HEIGHT=INT_015*23,; 
      WIDTH=INT_015*50,;
      CAPTION='安全資料'   
 ADD OBJECT LBLF991 AS LABEL WITH;
      TOP=INT_015*60,;
      LEFT=INT_015*633,;
      AUTOSIZE=.T.,;
      CAPTION=''     
 ADD OBJECT SHRGROUP AS SHRGROUP WITH;
      TOP=INT_015*58,;
      LEFT=INT_015*695      
 ADD OBJECT ORPGROUP AS ORPGROUP WITH;      
      TOP=INT_015*85,;
      LEFT=INT_015*570                              
 ******     
  PROCEDURE INIT
       SELECT S03
       GO TOP
       THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.) 
       THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.) 
       THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.) 
       THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限  
       THISFORM.SUBSIDY_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.) OR IIF(A02.F05='*',.T.,.F.)
       THISFORM.SHRGROUP.VISIBLE=.F.
       THISFORM.SHRGROUP.ENABLED=.F.
       THISFORM.SETALL('FONTSIZE',INT_015*9,'TEXTBOX')
       THISFORM.SETALL('FONTSIZE',INT_015*9,'LABEL')  
       THISFORM.SETALL('FONTSIZE',INT_015*9,'SPINNER') 
       THISFORM.SETALL('READONLY',.T.,'TEXTBOX') 
       THISFORM.SETALL('READONLY',.T.,'SPINNER')
       THISFORM.SPINNER1.VALUE=S01.F02
       THISFORM.SPINNER2.VALUE=S01.F03
       THISFORM.SPINNER3.VALUE=S01.F04
       THISFORM.SPINNER4.VALUE=S01.F05
       THISFORM.SPINNER8.VALUE=S01.F06
       THISFORM.SPINNER9.VALUE=S01.F08     
       THISFORM.SPINNER10.VALUE=S01.F09 
       THISFORM.SPINNER11.VALUE=S01.F10 
       THISFORM.SPINNER12.VALUE=S01.F11   
       THISFORM.GRID1.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'COLUMN')
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'HEADER')
       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*25
       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*70
       THISFORM.GRID1.COLUMN3.WIDTH=INT_015*65
       THISFORM.GRID1.COLUMN4.WIDTH=INT_015*65
       THISFORM.GRID1.COLUMN5.WIDTH=INT_015*65
       THISFORM.GRID1.COLUMN6.WIDTH=INT_015*65
       THISFORM.GRID1.COLUMN7.WIDTH=INT_015*65
       THISFORM.GRID1.COLUMN8.WIDTH=INT_015*65
       THISFORM.GRID1.COLUMN9.WIDTH=INT_015*80 
       THISFORM.GRID1.COLUMN10.WIDTH=INT_015*80  
       THISFORM.GRID1.COLUMN11.WIDTH=INT_015*100
       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='等級'
	   THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='月投保金額'
	   THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='本人'
	   THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='本人+1眷口'	   
  	   THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='本人+2眷口'
  	   THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='本人+3眷口'  	   
  	   THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='本人+4眷口'
  	   THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='本人+5眷口'
  	   THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='單位負擔金額'
  	   THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='政府補助金額' 	 
  	   THISFORM.GRID1.COLUMN11.HEADER1.CAPTION=''  
	   THISFORM.GRID1.COLUMN1.CONTROLSOURCE='S03.F01'
	   THISFORM.GRID1.COLUMN2.CONTROLSOURCE='S03.F02'
	   THISFORM.GRID1.COLUMN3.CONTROLSOURCE='S03.F03'
	   THISFORM.GRID1.COLUMN4.CONTROLSOURCE='S03.F04'
	   THISFORM.GRID1.COLUMN5.CONTROLSOURCE='S03.F05'
	   THISFORM.GRID1.COLUMN6.CONTROLSOURCE='S03.F06'
	   THISFORM.GRID1.COLUMN7.CONTROLSOURCE='S03.F07'
  	   THISFORM.GRID1.COLUMN8.CONTROLSOURCE='S03.F08'
	   THISFORM.GRID1.COLUMN9.CONTROLSOURCE='S03.F09'
	   THISFORM.GRID1.COLUMN10.CONTROLSOURCE='S03.F10'  
	   THISFORM.GRID1.COLUMN11.CONTROLSOURCE=''
       THISFORM.GRID1.READONLY=.T.       
       THISFORM.GRID1.SETFOCUS
       IF THISFORM.GRID1.ACTIVEROW=0 
       	   THISFORM.TXTF05.VALUE=''
           THISFORM.TXTF06.VALUE=''
   	   THISFORM.LBLF991.CAPTION=''
           THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
           THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
           THISFORM.SUBSIDY_BOTT.ENABLED=.F.
       ELSE
           THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.) 
       	   THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)  
       	   THISFORM.SUBSIDY_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.) OR IIF(A02.F05='*',.T.,.F.)
       ENDIF
       JK='等級'
  ENDPROC     
*********       
  PROC GRID1.AFTERROWCOLCHANGE
       LPARAMETERS NCOLINDEX
       THISFORM.TXTF05.VALUE=S03.F01
       THISFORM.TXTF06.VALUE=S03.F02
       THISFORM.LBLF991.CAPTION=S03.F99
       JK=THISFORM.GRID1.COLUMN1.HEADER1.CAPTION
       FCH=THISFORM.ACTIVECONTROL.NAME
       CHK=''
       THISFORM.REFRESH
       IF THISFORM.GRID1.ACTIVEROW=0 
       	   THISFORM.TXTF05.VALUE=''
           THISFORM.TXTF06.VALUE=''
           THISFORM.LBLF991.CAPTION=''
           THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
           THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
           THISFORM.SUBSIDY_BOTT.ENABLED=.F.
       ELSE
           THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.) 
       	   THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)  
       	   THISFORM.SUBSIDY_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.) OR IIF(A02.F05='*',.T.,.F.)
       ENDIF
  ENDPROC  
**********
PROCEDURE ORPGROUP.NEW_BOTT.CLICK 
	THISFORM.GRID1.ENABLED=.F. 
	THISFORM.SUBSIDY_BOTT.ENABLED=.F.
	THISFORM.SETALL('READONLY',.F.,'TEXTBOX') 
	THISFORM.TXTF05.VALUE=''
	THISFORM.TXTF06.VALUE=0
	THISFORM.LBLF991.CAPTION=''
	THISFORM.TXTF05.SETFOCUS
ENDPROC
********
PROCEDURE SHRGROUP.SHURE1_BOTT.CLICK
   DO CASE	 
      CASE EMPTY(THISFORM.TXTF05.VALUE)     
           =MESSAGEBOX('等級不得為零!',0+64,'提示視窗')
           THISFORM.TXTF05.SETFOCUS
           RETURN
      CASE IIF(SEEK(THISFORM.TXTF05.VALUE,'S03'),.T.,.F.)     
           =MESSAGEBOX('您輸入的等級已在健保費表中重複,請重新輸入!',0+64,'提示視窗')
      	   THISFORM.TXTF05.SETFOCUS
           RETURN            
      CASE EMPTY(THISFORM.TXTF06.VALUE)     
           =MESSAGEBOX('月投保金額不得為零!',0+64,'提示視窗')
      	   THISFORM.TXTF06.SETFOCUS
           RETURN                  
   ENDCASE  
   SELECT S03
   APPEND BLANK  
   LOCK()
   IF RLOCK()   
      REPLACE F01 WITH ABS(VAL(THISFORM.TXTF05.VALUE))
      REPLACE F02 WITH ABS(THISFORM.TXTF06.VALUE)
      REPLACE F03 WITH ROUND(S03.F02*(S01.F02/100)*(S01.F03/100),0)		&&ROUND(月投保金額*全民健康保險費率*被保險人及眷屬月負擔金額比率,0)*(本人+眷口數)
      REPLACE F04 WITH ROUND(S03.F02*(S01.F02/100)*(S01.F03/100),0)*2
      REPLACE F05 WITH ROUND(S03.F02*(S01.F02/100)*(S01.F03/100),0)*3
      REPLACE F06 WITH ROUND(S03.F02*(S01.F02/100)*(S01.F03/100),0)*4
      REPLACE F07 WITH ROUND(S03.F02*(S01.F02/100)*(S01.F03/100),0)*5
      REPLACE F08 WITH ROUND(S03.F02*(S01.F02/100)*(S01.F03/100),0)*6
      REPLACE F09 WITH ROUND(S03.F02*(S01.F02/100)*(S01.F04/100)*1.78,0)
      REPLACE F10 WITH ROUND(S03.F02*(S01.F02/100)*(S01.F05/100)*1.78,0)
      REPLACE F99 WITH DTOC(DATE())+' '+IIF(SEEK(SYS_OPER,'A01'),A01.F03,'')
   ENDIF 
   UNLOCK
   THISFORM.ORPGROUP.NEW_BOTT.CLICK
   THISFORM.REFRESH       
ENDPROC
**********
PROCEDURE ORPGROUP.EDIT_BOTT.CLICK
   THISFORM.GRID1.ENABLED=.F. 
   THISFORM.SUBSIDY_BOTT.ENABLED=.F.
   R=RECNO('&AREA1')
   THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(RECNO('&AREA1')=R,RGB(255,255,0),'')","COLUMN")
   THISFORM.SETALL('READONLY',.F.,'SPINNER')
   THISFORM.SETALL('READONLY',.F.,'TEXTBOX') 
   THISFORM.LBLF991.CAPTION=''
   THISFORM.TXTF05.READONLY=.T.
   THISFORM.TXTF06.SETFOCUS
   LOCK()
   IF !RLOCK()
      DO FILE_IMPACT
      RETURN
   ENDIF   
ENDPROC
*******
PROCEDURE SHRGROUP.SHURE2_BOTT.CLICK
    IF THISFORM.SPINNER2.VALUE+THISFORM.SPINNER3.VALUE+THISFORM.SPINNER4.VALUE<>100
       =MESSAGEBOX('投保負擔比率加總不等於100％!,請重新輸入',0+16,'錯誤訊息')
       RETURN   
    ENDIF
    IF THISFORM.SPINNER8.VALUE<=0
       =MESSAGEBOX('不扣款之眷口數不得為零,請重新輸入!',0+16,'錯誤訊息')
       RETURN   
    ENDIF    
    IF THISFORM.SPINNER1.VALUE<>S01.F02 OR THISFORM.SPINNER2.VALUE<>S01.F03 OR;
       THISFORM.SPINNER3.VALUE<>S01.F04 OR THISFORM.SPINNER4.VALUE<>S01.F05 OR;
       THISFORM.SPINNER8.VALUE<>S01.F06 OR THISFORM.SPINNER9.VALUE<>S01.F08 OR;
	   THISFORM.SPINNER10.VALUE<>S01.F09 OR THISFORM.SPINNER11.VALUE<>S01.F10 OR THISFORM.SPINNER12.VALUE<>S01.F11       
	   SELECT S01
	   SEEK 'B'
	   IF !FOUND()
		  SELECT S01
		  APPEND BLANK 
		  REPLACE F01 WITH 'B'    
	   ENDIF
	   REPLACE F02 WITH THISFORM.SPINNER1.VALUE
	   REPLACE F03 WITH THISFORM.SPINNER2.VALUE
	   REPLACE F04 WITH THISFORM.SPINNER3.VALUE
	   REPLACE F05 WITH THISFORM.SPINNER4.VALUE
	   REPLACE F06 WITH THISFORM.SPINNER8.VALUE
	   REPLACE F08 WITH THISFORM.SPINNER9.VALUE
	   REPLACE F09 WITH THISFORM.SPINNER10.VALUE
	   REPLACE F10 WITH THISFORM.SPINNER11.VALUE
	   REPLACE F11 WITH THISFORM.SPINNER12.VALUE
	   REPLACE F99 WITH DTOC(DATE())+' '+IIF(SEEK(SYS_OPER,'A01'),A01.F03,'')	   
	   SELECT S03
	   GO TOP
	   DO WHILE !EOF() 
	   	  REPLACE F02 WITH IIF(S03.F01=THISFORM.TXTF05.VALUE,ABS(THISFORM.TXTF06.VALUE),S03.F02)
	      REPLACE F03 WITH ROUND(S03.F02*(S01.F02/100)*(S01.F03/100),0)				&&ROUND(月投保金額*全民健康保險費率*被保險人及眷屬月負擔金額比率,0)*(本人+眷口數)
          REPLACE F04 WITH ROUND(S03.F02*(S01.F02/100)*(S01.F03/100),0)*2
          REPLACE F05 WITH ROUND(S03.F02*(S01.F02/100)*(S01.F03/100),0)*3
          REPLACE F06 WITH ROUND(S03.F02*(S01.F02/100)*(S01.F03/100),0)*4
          REPLACE F07 WITH ROUND(S03.F02*(S01.F02/100)*(S01.F03/100),0)*5
          REPLACE F08 WITH ROUND(S03.F02*(S01.F02/100)*(S01.F03/100),0)*6
          REPLACE F09 WITH ROUND(S03.F02*(S01.F02/100)*(S01.F04/100)*1.78,0)
          REPLACE F10 WITH ROUND(S03.F02*(S01.F02/100)*(S01.F05/100)*1.78,0)
          REPLACE F99 WITH DTOC(DATE())+' '+IIF(SEEK(SYS_OPER,'A01'),A01.F03,'')
	      SELECT S03
	      SKIP
	    ENDDO      
	    SEEK THISFORM.TXTF05.VALUE
     ELSE  
	    SELECT S03
	    IF RLOCK()
	        REPLACE F02 WITH ABS(THISFORM.TXTF06.VALUE)
	        REPLACE F03 WITH ROUND(S03.F02*(S01.F02/100)*(S01.F03/100),0)				&&ROUND(月投保金額*全民健康保險費率*被保險人及眷屬月負擔金額比率,0)*(本人+眷口數)
	        REPLACE F04 WITH ROUND(S03.F02*(S01.F02/100)*(S01.F03/100),0)*2
	        REPLACE F05 WITH ROUND(S03.F02*(S01.F02/100)*(S01.F03/100),0)*3
	        REPLACE F06 WITH ROUND(S03.F02*(S01.F02/100)*(S01.F03/100),0)*4
	        REPLACE F07 WITH ROUND(S03.F02*(S01.F02/100)*(S01.F03/100),0)*5
	        REPLACE F08 WITH ROUND(S03.F02*(S01.F02/100)*(S01.F03/100),0)*6
            REPLACE F09 WITH ROUND(S03.F02*(S01.F02/100)*(S01.F04/100)*1.78,0)
            REPLACE F10 WITH ROUND(S03.F02*(S01.F02/100)*(S01.F05/100)*1.78,0)
	        REPLACE F99 WITH DTOC(DATE())+' '+IIF(SEEK(SYS_OPER,'A01'),A01.F03,'')
	    ELSE
	        DO FILE_IMPACT
	        RETURN   
	   ENDIF   
   ENDIF  
   THISFORM.SHRGROUP.ABANDON_BOTT.CLICK 
ENDPROC
****
PROCEDURE ORPGROUP.DEL_BOTT.CLICK  
IF  MESSAGEBOX('是否確定要刪除此筆資料',4+32+256,'請確認')=6 
    SELE S03
    LOCK()
    IF  RLOCK()
         DELE
         UNLOCK
         SKIP -1
         IF BOF()
              GO TOP
         ENDIF   
    ELSE
         DO FILE_IMPACT
    ENDIF         
 ENDIF 
    THISFORM.GRID1.SETFOCUS
ENDPROC
*******
PROCEDURE SHRGROUP.ABANDON_BOTT.CLICK
      THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","","COLUMN") 
      THISFORM.SHRGROUP.ENABLED=.F.
      THISFORM.SHRGROUP.VISIBLE=.F.      
      THISFORM.ORPGROUP.ENABLED=.T.
      THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.)   &&判斷有無新增的權限      
      THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  &&判斷有無修改的權限
      THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)   &&判斷有無刪除的權限
      THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限    
      THISFORM.SUBSIDY_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.) OR IIF(A02.F05='*',.T.,.F.)  
      THISFORM.ORPGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
      THISFORM.CMDGROUP.ENABLED=.T.
      THISFORM.CMDGROUP.SETALL('ENABLED',.T.,'COMMANDBUTTON')
      THISFORM.CMDGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
      THISFORM.SETALL('READONLY',.T.,'TEXTBOX') 
      THISFORM.SETALL('READONLY',.T.,'SPINNER')
      THISFORM.SPINNER1.VALUE=S01.F02
      THISFORM.SPINNER2.VALUE=S01.F03
      THISFORM.SPINNER3.VALUE=S01.F04
      THISFORM.SPINNER4.VALUE=S01.F05
      THISFORM.SPINNER8.VALUE=S01.F06
      THISFORM.SPINNER9.VALUE=S01.F08
      THISFORM.SPINNER10.VALUE=S01.F09
      THISFORM.SPINNER11.VALUE=S01.F10
      THISFORM.SPINNER12.VALUE=S01.F11
      THISFORM.GRID1.ENABLED=.T.
      THISFORM.GRID1.SETFOCUS
       IF THISFORM.GRID1.ACTIVEROW=0 
       	   THISFORM.TXTF05.VALUE=''
           THISFORM.TXTF06.VALUE=''
   	   THISFORM.LBLF991.CAPTION=''
           THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
           THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
           THISFORM.SUBSIDY_BOTT.ENABLED=.F.
       ELSE
           THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.) 
       	   THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)  
       	   THISFORM.SUBSIDY_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.) OR IIF(A02.F05='*',.T.,.F.)
       ENDIF
      UNLOCK ALL
  ENDPROC   
**********   
  PROCEDURE SHRGROUP.FINISH_BOTT.CLICK
      SELE S03
      THISFORM.SHRGROUP.ABANDON_BOTT.CLICK
  ENDPROC
 ***** 
 PROCEDURE SUBSIDY_BOTT.CLICK
	SELECT S01
	SET FILTER TO 
	SELECT S01.F07,S01.F15 FROM S01 WHERE S01.F01 = 'Y' ORDER BY S01.F07 INTO CURSOR S01_TEMP READWRITE 
 	INDEX ON S01_TEMP.F07 TAG S01_TEMP1	
	SELECT S01_TEMP
	SET ORDER TO S01_TEMP1
	GO TOP
    SUBSIDY_LIST = CREATEOBJECT("SUBSIDY_LIST")  
    SUBSIDY_LIST.SHOW
    SELECT S01
	SET FILTER TO F01='B'       &&健保費率資料類別編號B    
    SELECT S03
    THISFORM.GRID1.SETFOCUS 
 ENDPROC  
ENDDEFINE     
*********      
 PROCEDURE PNT_PRC  
 
 ENDPROC
 *********    
**********************************補助眷口縣市
DEFINE CLASS SUBSIDY_LIST AS FORM
*!*	  AUTOCENTER=.T.
  TOP=INT_015*100
  LEFT=INT_015*260 
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*320
  WIDTH=INT_015*215
  FONTSIZE=INT_015*9
  MAXBUTTON=.F.
  MINBUTTON=.F.  
*!*	  MOVABLE=.F.  
  CONTROLBOX=.F.
  BORDERSTYLE=2
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WINDOWTYPE=1
  CAPTION = '補助眷口縣市清單'
  NAME='SUBSIDY_LIST'        
  ADD OBJECT GRID1 AS GRID WITH;          
      AUTOCENTER=.T.,;
      HIGHLIGHTROWLINEWIDTH=4,;
      TOP=INT_015*5,;
      WIDTH=INT_015*210,;      
      HEIGHT=INT_015*280,;  
      ROWHEIGHT=INT_015*18,;
      HEADERHEIGHT=INT_015*18,;          
      DELETEMARK=.F.,;
      READONLY=.T.,;
      RECORDSOURCETYPE=1,;
      COLUMNCOUNT=2,;  
      RECORDSOURCE='S01_TEMP',;           
      NAME='GRID1',;
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2'
  ADD OBJECT CMND1 AS COMMANDBUTTON WITH;
      LEFT=INT_015*165,;
      TOP=INT_015*290,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;
      CAPTION='\<X.離開',;
      TOOLTIPTEXT='離開此畫面!快速鍵->ALT+X' 
      NAME='CMND1'                                                                      
 PROCEDURE INIT    
      THISFORM.SETALL('MOUSEPOINTER',99,'COMMANDBUTTON')
      THISFORM.SETALL('MOUSEICON','BMPS\harrow.cur','COMMANDBUTTON') 
      THISFORM.SETALL('MOVABLE',.F.,'COLUMN')          
      THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'COLUMN')
      THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'HEADER')
      THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='縣市名稱'
      THISFORM.GRID1.COLUMN1.CONTROLSOURCE='S01_TEMP.F07'
      THISFORM.GRID1.COLUMN1.WIDTH=INT_015*120
      THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='是否補助'
      THISFORM.GRID1.COLUMN2.CONTROLSOURCE='S01_TEMP.F15'
      THISFORM.GRID1.COLUMN2.WIDTH=INT_015*60        
      THISFORM.GRID1.SETFOCUS
	  IF THISFORM.GRID1.ACTIVEROW<>0
	     THISFORM.GRID1.AFTERROWCOLCHANGE  
	  ENDIF 
 ENDPROC
 PROCEDURE GRID1.INIT 
	THISFORM.GRID1.COLUMN1.READONLY=.T.
	THISFORM.GRID1.COLUMN2.READONLY=.F. 
	THISFORM.GRID1.COLUMN2.removeobject("TEXT1")
	THISFORM.GRID1.COLUMN2.AddObject("CheckBox1","CheckBox1") 
	THISFORM.GRID1.COLUMN2.CurrentControl="CheckBox1" 
	THISFORM.GRID1.COLUMN2.Sparse=.F.	
	THISFORM.GRID1.COLUMN2.CheckBox1.Visible=.T.
	THISFORM.GRID1.COLUMN2.CheckBox1.CAPTION=''
	THISFORM.GRID1.COLUMN2.CheckBox1.AUTOSIZE=.T.
	THISFORM.GRID1.COLUMN2.CheckBox1.CENTERED=.T.
	THISFORM.GRID1.COLUMN2.CheckBox1.BACKSTYLE=0
	THISFORM.GRID1.COLUMN2.CheckBox1.LEFT=5	
 ENDPROC  
 PROCEDURE CMND1.CLICK  
  	THISFORM.RELEASE
 ENDPROC        
ENDDEFINE  
*********     
DEFINE CLASS CheckBox1 AS CheckBox
      PROCEDURE CLICK
	     SELECT S01
	     SET ORDER TO S011
	     SEEK 'Y' + S01_TEMP.F07
	     IF FOUND()
	        REPLACE S01.F15 WITH THIS.VALUE
	     ENDIF
	     SELECT S01_TEMP
	     REPLACE S01_TEMP.F15 WITH THIS.VALUE
         THISFORM.GRID1.SETFOCUS     
   ENDPROC 
ENDDEFINE 