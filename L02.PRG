CLOSE ALL
CLEAR 
FLG='0'
FCH=''
CHK=''
R=0
AREA1='L01'
AREA2='L02'
IF !USED('L00')
   SELE 0
   USE L00
ELSE
   SELE L00
ENDIF
SET ORDER TO 1
IF ! USED('A01')
   SELE 0
   USE A01 INDE A01
ELSE
   SELE A01
ENDIF      
SET ORDER TO A01
IF ! USED('A09')
   SELE 0
   USE A09 INDE A09
ELSE
   SELE A09
ENDIF      
SET ORDER TO 1
A24='A24'+LEFT(DTOS(DATE()),6)     &&單號暫存檔
IF !USED('&A24')
   SELE 0
   USE (A24) ALIA A24
ELSE
   SELE A24
ENDIF
SET ORDER TO 1      
IF !USED('A02')
   SELE 0
   USE A02 INDE A02
ELSE
   SELE A02
ENDIF
SET ORDER TO A021      
SEEK SYS_OPER+'L02'
IF !USED('L01')
   SELE 0
   USE L01 INDE L01
ELSE
   SELE L01
ENDIF
SET ORDER TO 1
IF !USED('L02')
   SELE 0
   USE L02
ELSE
   SELE L02
ENDIF
SET ORDER TO L021      
L02FORM=CREATEOBJECT("TKL02")
L02FORM.SHOW  
DEFINE CLASS TKL02 AS FORM
  CAPTION='L02.財產改良異動'
*!*	  AUTOCENTER=.T.
  CONTROLBOX=.F.
  BORDERSTYLE=1
  MAXBUTTON=.F.
  MINBUTTON=.F.
  MOVABLE=.F.
  CLOSABLE=.F.
  CONTROLCOUNT=57
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*550
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WIDTH=INT_015*789
  WINDOWTYPE=1
  NAME='TKL02'
  ADD OBJECT SHAPE1 AS SHAPE1 WITH;
      AUTOCENTER=.T.
  ADD OBJECT LBL_REC AS LBL_REC WITH;
      AUTOCENTER =.T.
  ADD OBJECT REC_COUNT AS REC_COUNT  WITH;
      CAPTION=STR(RECCOUNT())        
  ADD OBJECT SHAPE2 AS SHAPE2 WITH;
      AUTOCENTER=.T.
  ADD OBJECT SHAPE3 AS SHAPE3 WITH;
      AUTOCENTER=.T.
  ADD OBJECT PAGEFRAME1 AS PAGEFRAME WITH;
      LEFT=INT_015*236,;
      WIDTH=INT_015*540,;
      HEIGHT=INT_015*200,;
      FONTSIZE=INT_015*9,;
      PAGECOUNT=2,;
      TABSTRETCH=1,;
      ACTIVEPAGE=1,;
      VISIBLE=.T.,;
      PAGE1.NAME='PAGE1',;
      PAGE1.VISIBLE=.T.,;
      PAGE1.CAPTION='依照財產編號搜尋',;
      PAGE2.NAME='PAGE2',;
      PAGE2.VISIBLE=.T.,;
      PAGE2.CAPTION='詳細資料內容'   
  ADD OBJECT KEY_LIST AS KEY_LIST WITH;
      AUTOCENTER=.T.
  ADD OBJECT GRID1 AS GRID1 WITH;
      COLUMNCOUNT=2,;            
      RECORDSOURCE='L01',;
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2'      
  ADD OBJECT GRID2 AS GRID2 WITH;
      COLUMNCOUNT=8,;            
      RECORDSOURCE='L02',;
      LINKMASTER='L01',;
      RELATIONALEXPR='F01',;
      CHILDORDER='L021',;      
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;
      COLUMN3.NAME='COLUMN3',;
      COLUMN4.NAME='COLUMN4',;
      COLUMN5.NAME='COLUMN5',;
      COLUMN6.NAME='COLUMN6',;
      COLUMN7.NAME='COLUMN7',;
      COLUMN8.NAME='COLUMN8'
  ADD OBJECT CMDGROUP AS CMDGROUP WITH;
      TOP=INT_015*415,;
      LEFT=INT_015*10,;
      ENABLED=.T.,;
      VISIBLE=.T.                    
  ADD OBJECT ORPGROUP AS ORPGROUP WITH;    
      TOP=INT_015*455,;
      LEFT=INT_015*10
  ADD OBJECT SHRGROUP AS SHRGROUP WITH;
      TOP=INT_015*173,;
      LEFT=INT_015*558          
  ADD OBJECT ANS_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*490,;
      LEFT=INT_015*15,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*40,;      
      FONTSIZE=INT_015*9,;
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\harrow.cur',;         
      TOOLTIPTEXT='將資料過入財產基本主檔中!快速鍵->ALT+A',;
      CAPTION='\<A.確認',;
      NAME='ANS_BOTT'       
  PROCEDURE PAGEFRAME1.PAGE1.INIT     
     THIS.ADDOBJECT('LBLF01','LABEL')
     WITH THIS.LBLF01
          .VISIBLE=.T.
          .LEFT=INT_015*14
          .TOP=INT_015*27
          .WIDTH=INT_015*50
          .CAPTION='財產編號'          
     ENDWITH
     THIS.ADDOBJECT('LBLF02','LABEL')     
     WITH THIS.LBLF02
          .VISIBLE=.T.
          .LEFT=INT_015*200
          .TOP=INT_015*27
          .AUTOSIZE=.T.  
     ENDWITH            
     THIS.ADDOBJECT('TXTF01','TEXTBOX')     
     WITH THIS.TXTF01
          .VISIBLE=.T.
          .LEFT=INT_015*64
          .TOP=INT_015*23
          .WIDTH=INT_015*129
          .HEIGHT=INT_015*25
          .MAXLENGTH=15
     ENDWITH        
  ENDPROC   
***************  
  PROCEDURE PAGEFRAME1.PAGE2.INIT
    THIS.ADDOBJECT('LBLF08','LABEL')
    WITH THIS.LBLF08
         .VISIBLE=.T.
	     .LEFT=INT_015*14
	     .TOP=INT_015*8
	     .WIDTH=INT_015*50
	     .CAPTION='識別編號'
	ENDWITH     
    THIS.ADDOBJECT('LBLF02','LABEL')
    WITH THIS.LBLF02
         .VISIBLE=.T.    
         .LEFT=INT_015*14
         .TOP=INT_015*33
         .WIDTH=INT_015*50
         .CAPTION='改良日期'       
    ENDWITH     
    THIS.ADDOBJECT('LBLF03','LABEL')      
    WITH THIS.LBLF03
         .VISIBLE=.T.       
         .LEFT=INT_015*14
         .TOP=INT_015*58
         .WIDTH=INT_015*50
         .CAPTION='改良金額'
    ENDWITH     
    THIS.ADDOBJECT('LBLF06','LABEL')
    WITH THIS.LBLF06
         .VISIBLE=.T.           
         .LEFT=INT_015*14
         .TOP=INT_015*83
         .WIDTH=INT_015*50
         .CAPTION='預留殘值'               
    ENDWITH      
    THIS.ADDOBJECT('LBLF07','LABEL')
    WITH THIS.LBLF07
        .VISIBLE=.T.           
        .LEFT=INT_015*14
        .TOP=INT_015*108
        .WIDTH=INT_015*50
        .CAPTION='起始月份'         
    ENDWITH        
    THIS.ADDOBJECT('LBLF04','LABEL')
    WITH THIS.LBLF04
         .VISIBLE=.T.           
         .LEFT=INT_015*328
         .TOP=INT_015*8
         .WIDTH=INT_015*50
         .CAPTION='每月攤提'
    ENDWITH     
    THIS.ADDOBJECT('LBLF09','LABEL')
    WITH THIS.LBLF09
         .VISIBLE=.T.           
         .LEFT=INT_015*328
         .TOP=INT_015*33
         .WIDTH=INT_015*50
         .CAPTION='已攤年月'                  
    ENDWITH     
    THIS.ADDOBJECT('LBLF05','LABEL')
    WITH THIS.LBLF05
         .VISIBLE=.T.           
         .LEFT=INT_015*328
         .TOP=INT_015*58
         .WIDTH=INT_015*50
         .CAPTION='目前殘值'
    ENDWITH         
    THIS.ADDOBJECT('LBLF10','LABEL')
    WITH THIS.LBLF10
         .VISIBLE=.T.           
         .LEFT=INT_015*328
         .TOP=INT_015*83
         .WIDTH=INT_015*50
         .CAPTION='是否確認'
    ENDWITH             
    THIS.ADDOBJECT('LBLF101','LABEL')
    WITH THIS.LBLF101
         .VISIBLE=.T.           
         .LEFT=INT_015*379
         .TOP=INT_015*83
         .WIDTH=INT_015*50
         .CAPTION=''
    ENDWITH                 
    THIS.ADDOBJECT('LBLF11','LABEL')
    WITH THIS.LBLF11
         .VISIBLE=.T.           
         .LEFT=INT_015*14
         .TOP=INT_015*133
         .WIDTH=INT_015*50
         .CAPTION='備註說明'         
    ENDWITH     

    THIS.ADDOBJECT('LBLF12','LABEL')
    WITH THIS.LBLF12
         .VISIBLE=.T.           
         .LEFT=INT_015*14
         .TOP=INT_015*158
         .WIDTH=INT_015*50
         .CAPTION='安全資料'          
    ENDWITH     
    THIS.ADDOBJECT('LBLF121','LABEL')
    WITH THIS.LBLF121
         .VISIBLE=.T.           
         .LEFT=INT_015*65
         .TOP=INT_015*158
         .AUTOSIZE=.T.          
    ENDWITH     
    THIS.ADDOBJECT('TXTF04','TEXTBOX')
    WITH THIS.TXTF04
         .VISIBLE=.T.           
         .LEFT=INT_015*379
         .TOP=INT_015*4
         .WIDTH=INT_015*100
         .HEIGHT=INT_015*25
         .INPUTMASK='999999999.999'
         .NAME='TXTF04'                            
    ENDWITH     
    THIS.ADDOBJECT('TXTF09','TEXTBOX')
    WITH THIS.TXTF09
         .VISIBLE=.T.           
         .LEFT=INT_015*379
         .TOP=INT_015*29
         .WIDTH=INT_015*60      
         .INPUTMASK='9999/99'
         .NAME='TXTF09'                   
    ENDWITH
    THIS.ADDOBJECT('TXTF05','TEXTBOX')
    WITH THIS.TXTF05     
         .VISIBLE=.T.           
         .LEFT=INT_015*379
         .TOP=INT_015*54
         .WIDTH=INT_015*100
         .INPUTMASK='999999999.999'
         .NAME='TXTF05'
    ENDWITH             
	THIS.ADDOBJECT('TXTF08','TEXTBOX')
	WITH THIS.TXTF08     
	     .VISIBLE=.T.
	     .LEFT=INT_015*65
	     .TOP=INT_015*4
	     .WIDTH=INT_015*80
	     .HEIGHT=INT_015*25
	     .MAXLENGTH=10
	     .NAME='TXTF08'  
	ENDWITH     
	THIS.ADDOBJECT('TXTF02','TEXTBOX')
	WITH THIS.TXTF02
	     .VISIBLE=.T.
	     .LEFT=INT_015*65
	     .TOP=INT_015*29
	     .WIDTH=INT_015*70
	     .HEIGHT=INT_015*25
	     .NAME='TXTF02'	    
	ENDWITH     
    THIS.ADDOBJECT('TXTF03','TXTF03')
    WITH THIS.TXTF03
         .VISIBLE=.T.           
         .LEFT=INT_015*65
         .TOP=INT_015*54
         .WIDTH=INT_015*100
         .INPUTMASK='999999999.999'
         .NAME='TXTF03'
    ENDWITH     
    THIS.ADDOBJECT('TXTF06','TXTF06')
    WITH THIS.TXTF06
         .VISIBLE=.T.           
         .LEFT=INT_015*65
         .TOP=INT_015*79
         .WIDTH=INT_015*100
         .INPUTMASK='999999999.999'
         .NAME='TXTF06'                 
    ENDWITH         
    THIS.ADDOBJECT('TXTF07','TXTF07')
    WITH THIS.TXTF07
         .VISIBLE=.T.           
         .LEFT=INT_015*65
         .TOP=INT_015*104
         .WIDTH=INT_015*60
         .INPUTMASK='9999/99'
         .NAME='TXTF07'                       
    ENDWITH         

    THIS.ADDOBJECT('TXTF11','TEXTBOX')
    WITH THIS.TXTF11
         .VISIBLE=.T.           
         .LEFT=INT_015*65
         .TOP=INT_015*129
         .WIDTH=INT_015*249        
         .MAXLENGTH=50
         .NAME='TXTF11'                   
    ENDWITH    
  ENDPROC       
  PROCEDURE PAGEFRAME1.PAGE1.ACTIVATE
     R=0
     SELECT L01
     SEEK THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE                
     THISFORM.GRID1.ENABLED=.T.          
     THISFORM.GRID1.SETFOCUS     
     IF THISFORM.GRID1.ACTIVEROW=0
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
        THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=''
        THISFORM.PAGEFRAME1.PAGE1.LBLF02.CAPTION=''
     ELSE
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.
     ENDIF   
     THISFORM.ORPGROUP.NEW_BOTT.ENABLED=.F. 
     THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
     THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
     THISFORM.ANS_BOTT.ENABLED=.F.
     THISFORM.KEY_LIST.ENABLED=.T.
  ENDPROC
  PROCEDURE PAGEFRAME1.PAGE2.ACTIVATE
       SELE L02
     IF THISFORM.SHRGROUP.ENABLED=.F.
        THISFORM.GRID2.READONLY=.T.   
        THISFORM.GRID2.SETFOCUS      
     ENDIF 
     IF THISFORM.GRID2.ACTIVEROW=0 .AND. THISFORM.SHRGROUP.ENABLED=.F.
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
        THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
        THISFORM.ANS_BOTT.ENABLED=.F.        
        THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
        THISFORM.PAGEFRAME1.PAGE2.SETALL('VALUE','','TEXTBOX')
        THISFORM.PAGEFRAME1.PAGE2.LBLF121.CAPTION=''
        THISFORM.PAGEFRAME1.PAGE2.LBLF101.CAPTION=''                         
     ELSE
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.
        THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.) .AND. L02.F10<>'2' &&判斷有無修改的權限
        THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)  .AND. L02.F10<>'2' &&判斷有無刪除的權限
        THISFORM.ANS_BOTT.ENABLED=IIF(A02.F11='*',.T.,.F.)  .AND. L02.F10<>'2' &&判斷有無刪除的權限        
        THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限  
     ENDIF   
     R=RECNO('&AREA1')
     THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(RECNO('&AREA1')=R,RGB(255,255,0),'')","COLUMN")
     THISFORM.GRID1.ENABLED=.F.     
     THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.)   &&判斷有無新增的權限
     THISFORM.KEY_LIST.ENABLED=.F.     
  ENDPROC   
  PROC INIT       
       THISFORM.PAGEFRAME1.PAGE1.FONTSIZE=INT_015*9
       THISFORM.PAGEFRAME1.PAGE2.FONTSIZE=INT_015*9    
       THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限  
       THISFORM.SETALL('HEIGHT',INT_015*25,'TEXTBOX')
       THISFORM.SETALL('HEIGHT',INT_015*17,'LABEL')
       THISFORM.SETALL('FONTSIZE',INT_015*9,'TEXTBOX')
       THISFORM.SETALL('FONTSIZE',INT_015*9,'LABEL')       
       THISFORM.SETALL('READONLY',.T.,'TEXTBOX')
       THISFORM.SHRGROUP.VISIBLE=.F.
       THISFORM.SHRGROUP.ENABLED=.F.
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'COLUMN')
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'HEADER')      
       THISFORM.GRID1.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)
       THISFORM.GRID2.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)   
       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*120
       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*120
       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='財產編號'
       THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='規格說明'
       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='L01.F01'
       THISFORM.GRID1.COLUMN2.CONTROLSOURCE='L01.F02'
       THISFORM.GRID2.SETALL('FONTSIZE',INT_015*9,'COLUMN')
       THISFORM.GRID2.SETALL('FONTSIZE',INT_015*9,'HEADER')       
       THISFORM.GRID2.SETALL("DYNAMICBACKCOLOR","IIF(L02.F10<>'2',RGB(255,0,0),'')","COLUMN")                
       THISFORM.GRID2.COLUMN1.HEADER1.CAPTION='識別編號'
       THISFORM.GRID2.COLUMN2.HEADER1.CAPTION='改良日期'
	   THISFORM.GRID2.COLUMN3.HEADER1.CAPTION='改良金額'
	   THISFORM.GRID2.COLUMN4.HEADER1.CAPTION='預留殘值'	   
	   THISFORM.GRID2.COLUMN5.HEADER1.CAPTION='每月攤提'
	   THISFORM.GRID2.COLUMN6.HEADER1.CAPTION='目前殘值'
	   THISFORM.GRID2.COLUMN7.HEADER1.CAPTION='起始月份'	   	   
	   THISFORM.GRID2.COLUMN8.HEADER1.CAPTION='已攤年月'
	   THISFORM.GRID2.COLUMN1.CONTROLSOURCE='L02.F08'
	   THISFORM.GRID2.COLUMN2.CONTROLSOURCE='L02.F02'
	   THISFORM.GRID2.COLUMN3.CONTROLSOURCE='L02.F03'
	   THISFORM.GRID2.COLUMN4.CONTROLSOURCE='L02.F06'	   
	   THISFORM.GRID2.COLUMN5.CONTROLSOURCE='L02.F04'
	   THISFORM.GRID2.COLUMN6.CONTROLSOURCE='L02.F05'
	   THISFORM.GRID2.COLUMN7.CONTROLSOURCE='L02.F07'	   	   
	   THISFORM.GRID2.COLUMN8.CONTROLSOURCE="L02.F09"
	   THISFORM.GRID2.COLUMN1.WIDTH=INT_015*80
	   THISFORM.GRID2.COLUMN2.WIDTH=INT_015*65
       THISFORM.GRID2.COLUMN3.WIDTH=INT_015*80
       THISFORM.GRID2.COLUMN4.WIDTH=INT_015*80
       THISFORM.GRID2.COLUMN5.WIDTH=INT_015*80
       THISFORM.GRID2.COLUMN6.WIDTH=INT_015*80
       THISFORM.GRID2.COLUMN7.WIDTH=INT_015*60              
       THISFORM.GRID2.COLUMN8.WIDTH=INT_015*50
       THISFORM.GRID1.READONLY=.T.    
       THISFORM.GRID2.READONLY=.T.       
       THISFORM.GRID1.SETFOCUS
       IF THISFORM.GRID1.ACTIVEROW=0
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
       ELSE
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.      
       ENDIF          
       THISFORM.KEY_LIST.DISPLAYVALUE='依財產編號排列'       
       JK='財產編號'
       SELE L01
       GO TOP

  ENDPROC         
  PROC KEY_LIST.INIT 
       WITH THIS 
           .ADDITEM('依財產編號排列')
       ENDWITH      
  ENDPROC 
  PROC GRID1.AFTERROWCOLCHANGE
       LPARAMETERS NCOLINDEX
          THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=L01.F01
          THISFORM.PAGEFRAME1.PAGE1.LBLF02.CAPTION=L01.F02
       FCH=THISFORM.ACTIVECONTROL.NAME
       JK=THIS.COLUMN1.HEADER1.CAPTION  
       IF THIS.ACTIVEROW=0
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
       ELSE
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.
       ENDIF   
       CHK=''     
       THISFORM.REFRESH
  ENDPROC     
  PROC GRID2.AFTERROWCOLCHANGE
       LPARAMETERS NCOLINDEX
	       THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE=L02.F02
	       THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=L02.F03
	       THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE=L02.F04
	       THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE=L02.F05
	       THISFORM.PAGEFRAME1.PAGE2.TXTF06.VALUE=L02.F06
	       THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE=L02.F07
	       THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE=L02.F05
	       THISFORM.PAGEFRAME1.PAGE2.TXTF08.VALUE=L02.F08
	       THISFORM.PAGEFRAME1.PAGE2.TXTF09.VALUE=L02.F09
	       THISFORM.PAGEFRAME1.PAGE2.TXTF11.VALUE=L02.F11
	       THISFORM.PAGEFRAME1.PAGE2.LBLF121.CAPTION=L02.F12
	       THISFORM.PAGEFRAME1.PAGE2.LBLF101.CAPTION=IIF(F10='2','是','否')
      	   THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.) .AND. L02.F10<>'2' &&判斷有無修改的權限
           THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)  .AND. L02.F10<>'2' &&判斷有無刪除的權限
           THISFORM.ANS_BOTT.ENABLED=IIF(A02.F11='*',.T.,.F.)  .AND. L02.F10<>'2' &&判斷有無刪除的權限        
          	FCH=THISFORM.ACTIVECONTROL.NAME
       	  JK=THIS.COLUMN1.HEADER1.CAPTION
          CHK=THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
       IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
       ENDIF   
  ENDPROC
  ****************新增 
  PROCEDURE ORPGROUP.NEW_BOTT.CLICK    
     THISFORM.SETALL('READONLY',.F.,'TEXTBOX')       
     THISFORM.PAGEFRAME1.PAGE1.ENABLED=.F.
     THISFORM.GRID2.ENABLED=.F. 
          H='L001 '+SUBSTR(DTOS(DATE()),3,4)
          SELE A24   
          SET ORDER TO 1
          SEEK H           
          IF FOUND() 
               PO_NO=F08
               RLOCK()
               DELE 
               UNLOCK
          ELSE
             SELE A09
             SEEK H            
             IF !FOUND()                                                  &&如果為本月第一張訂單則重頭開始編號
	         APPEND BLANK                                                
		     REPLACE  F01 WITH 'L001 '
	         REPLACE  F02 WITH  SUBSTR(DTOS(DATE()),3,4)
	         REPLACE  F05 WITH 'LA'+F02
	         REPLACE  F06 WITH '出貨單'
		     REPLACE  F08 WITH ALLTRIM(F05)+'0000'
		     ENDIF
           ENDIF
	       LOCK()
	       HX=VAL(RIGHT(F08,4))+1
	       PO_NO=LEFT(F08,6)+PADL(ALLTRIM(STR(HX)),4,'0')
	       REPLACE  F08 WITH PO_NO                                             &&記錄本訂單號碼,本月份後續的訂單號碼將以此往下編
	       UNLOCK          
     THISFORM.PAGEFRAME1.PAGE2.TXTF08.VALUE=PO_NO
     THISFORM.PAGEFRAME1.PAGE2.TXTF08.READONLY=.T.
     THISFORM.PAGEFRAME1.PAGE2.TXTF09.READONLY=.T.
     THISFORM.PAGEFRAME1.PAGE2.TXTF04.READONLY=.T.               
     THISFORM.PAGEFRAME1.PAGE2.TXTF05.READONLY=.T.          
     THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE=DATE()
     THISFORM.PAGEFRAME1.PAGE2.TXTF02.SETFOCUS          
     THISFORM.PAGEFRAME1.PAGE2.TXTF03.READONLY=.F.     
     THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=0
     THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE=0
     THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE=0
     THISFORM.PAGEFRAME1.PAGE2.TXTF06.READONLY=.F.               
     THISFORM.PAGEFRAME1.PAGE2.TXTF06.VALUE=0
     THISFORM.PAGEFRAME1.PAGE2.TXTF07.READONLY=.F.               
     THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE=IIF(INT_012=2,TRANSFORM(LEFT(DTOS(DATE()),6),'@R ####/##'),TRANSFORM(PADL(ALLTRIM(STR(YEAR(DATE())-1911)),4,'0')+SUBSTR(DTOS(DATE()),5,2),'@R ####/##'))
     THISFORM.PAGEFRAME1.PAGE2.TXTF09.VALUE=L01.F19
     THISFORM.PAGEFRAME1.PAGE2.TXTF11.VALUE=''
     THISFORM.PAGEFRAME1.PAGE2.LBLF121.CAPTION=''
     THISFORM.PAGEFRAME1.PAGE2.LBLF101.CAPTION=''          
  ENDPROC  
  *********修改
  PROCEDURE ORPGROUP.EDIT_BOTT.CLICK
     THISFORM.PAGEFRAME1.PAGE1.ENABLED=.F.
     THISFORM.GRID2.ENABLED=.F.
     THISFORM.PAGEFRAME1.PAGE2.TXTF08.READONLY=.T.
     THISFORM.PAGEFRAME1.PAGE2.TXTF04.READONLY=.T.     
     THISFORM.PAGEFRAME1.PAGE2.TXTF05.READONLY=.T.
     THISFORM.PAGEFRAME1.PAGE2.TXTF09.READONLY=.T.     
     THISFORM.PAGEFRAME1.PAGE2.TXTF03.READONLY=.F. 
     THISFORM.PAGEFRAME1.PAGE2.TXTF06.READONLY=.F.          
     THISFORM.PAGEFRAME1.PAGE2.TXTF07.READONLY=.F.                        
     SELECT L02
     THISFORM.PAGEFRAME1.PAGE2.TXTF02.SETFOCUS
     LOCK()
     IF !RLOCK()
        DO FILE_IMPACT
        RETURN
     ENDIF
  ENDPROC    
  ******刪除  
  PROCEDURE ORPGROUP.DEL_BOTT.CLICK
     IF MESSAGEBOX('是否確定要刪除此筆資料',4+32+256,'請確認') = 6	      
        SELE L02
        LOCK()
        IF RLOCK()
           DELE
           UNLOCK
           SKIP -1
           IF BOF()
              GO TOP
           ENDIF   
           THISFORM.GRID2.SETFOCUS
           IF THISFORM.GRID2.ACTIVEROW=0
              THISFORM.PAGEFRAME1.PAGE2.SETALL('VALUE','','TEXTBOX')
              THISFORM.PAGEFRAME1.PAGE2.TXTF08.VALUE=''
              THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE=CTOD('')              
              THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=0
              THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE=0
              THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE=0              
              THISFORM.PAGEFRAME1.PAGE2.TXTF06.VALUE=0              
              THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE=''
              THISFORM.PAGEFRAME1.PAGE2.TXTF09.VALUE=''              
              THISFORM.PAGEFRAME1.PAGE2.TXTF11.VALUE=''                            
              THISFORM.PAGEFRAME1.PAGE2.LBLF012.CAPTION=''
              THISFORM.CMDGROUP.ENABLED=.F.
              THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
              THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
              THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
              THISFORM.ANS_BOTT.ENABLED=.F.
           ELSE
              THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.) .AND. L02.F10<>'2' &&判斷有無修改的權限
              THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.) .AND. L02.F10<>'2'  &&判斷有無刪除的權限
              THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限             
              THISFORM.ANS_BOTT.ENABLED=IIF(A02.F11='*',.T.,.F.)  .AND. L02.F10<>'2' &&判斷有無刪除的權限                       
           ENDIF
        ELSE
          DO FILE_IMPACT    
        ENDIF      
     ENDIF
  ENDPROC
  *******新增確認
  PROCEDURE SHRGROUP.SHURE1_BOTT.CLICK
    IF THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE<=0
       =MESSAGEBOX('改良金額不得小於等於 0',0+48,'提示訊息視窗')
       THISFORM.PAGEFRAME1.PAGE2.TXTF03.SETFOCUS
       RETURN
    ENDIF           
    SELE L02
    APPEND BLANK
    LOCK()
    IF RLOCK()
       REPLACE F01 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
       REPLACE F02 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE
       REPLACE F03 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE
       REPLACE F04 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE
       REPLACE F05 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE
       REPLACE F06 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF06.VALUE       
       REPLACE F07 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE
       REPLACE F08 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF08.VALUE   
       REPLACE F09 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF09.VALUE           
       REPLACE F11 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF11.VALUE       
       REPLACE F12 WITH IIF(INT_012=1,PADL(ALLTRIM(STR(YEAR(DATE())-1911)),3,' ')+RIGHT(DTOC(DATE()),6),dtoc(DATE())+' ')+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
    ENDIF
    UNLOCK

       SEEK THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF08.VALUE

    THISFORM.GRID2.ENABLED=.T.    
    THISFORM.GRID2.SETFOCUS        
    THISFORM.ORPGROUP.NEW_BOTT.CLICK            
  ENDPROC
  ******修改確認
  PROCEDURE SHRGROUP.SHURE2_BOTT.CLICK
    IF THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE<=0
       =MESSAGEBOX('改良金額不得小於等於 0',0+48,'提示訊息視窗')
       THISFORM.PAGEFRAME1.PAGE2.TXTF03.SETFOCUS
       RETURN
    ENDIF             
    SELE L02
    IF RLOCK()  
       REPLACE F02 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE
       REPLACE F03 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE
       REPLACE F04 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE
       REPLACE F05 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE
       REPLACE F06 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF06.VALUE       
       REPLACE F07 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE
       REPLACE F09 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF09.VALUE           
       REPLACE F11 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF11.VALUE       
       REPLACE F12 WITH IIF(INT_012=1,PADL(ALLTRIM(STR(YEAR(DATE())-1911)),3,' ')+RIGHT(DTOC(DATE()),6),dtoc(DATE())+' ')+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
    ELSE
      DO FILE_IMPACT
      RETURN   
    ENDIF   
    THISFORM.SHRGROUP.ABANDON_BOTT.CLICK    
  ENDPROC   
  *****放棄
  PROCEDURE SHRGROUP.ABANDON_BOTT.CLICK
      THISFORM.SHRGROUP.ENABLED=.F.
      THISFORM.SHRGROUP.VISIBLE=.F.      
      THISFORM.ORPGROUP.ENABLED=.T.
      THISFORM.ORPGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
      THISFORM.CMDGROUP.ENABLED=.T.
      THISFORM.CMDGROUP.SETALL('ENABLED',.T.,'COMMANDBUTTON')
      THISFORM.CMDGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
      THISFORM.SETALL('READONLY',.T.,'TEXTBOX')  
      THISFORM.PAGEFRAME1.PAGE2.TXTF03.READONLY=.T.      
      THISFORM.PAGEFRAME1.PAGE2.TXTF06.READONLY=.T.      
      THISFORM.PAGEFRAME1.PAGE2.TXTF07.READONLY=.T.                 
      UNLOCK ALL
      SELE L02
      THISFORM.PAGEFRAME1.PAGE1.ENABLED=.T.
      THISFORM.GRID2.ENABLED=.T.
      THISFORM.GRID2.SETFOCUS
      UNLOCK ALL
  ENDPROC
  PROCEDURE ANS_BOTT.CLICK
      IF MESSAGEBOX('是否確認資料無誤可以過帳?',4+32+256,'請確認') = 6	          
          SELECT L02
          RLOCK()
          IF RLOCK()<>.T.
             DO FILE_IMPACT
                RETURN
          ENDIF  
      	SELECT L01
      	RLOCK()
      	IF RLOCK()<>.T.
        	 DO FILE_IMPACT
         	RETURN
      	ENDIF
      	REPLACE F07 WITH F07+L02.F03
      	REPLACE F18 WITH F18+L02.F04
      	REPLACE F25 WITH F25+L02.F05
      	REPLACE F26 WITH F26+L02.F06
      	REPLACE F29 WITH F29+L02.F05
      	REPLACE F30 WITH F30+L02.F06
      	SELECT L02
	      REPLACE F10 WITH '2'
	      UNLOCK ALL
	      THIS.Enabled=.F.
	      THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
	      THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
	      THISFORM.GRID2.SETFOCUS
	      THISFORM.GRID2.REFRESH
	   ENDIF   
  ENDPROC
  ******完成
  PROCEDURE SHRGROUP.FINISH_BOTT.CLICK
       SELE L02
       THISFORM.SHRGROUP.ABANDON_BOTT.CLICK
  ENDPROC     
ENDDEFINE    
***********************************************列印程序
PROCEDURE PNT_PRC  
   LK=L02.F01
   SELECT L02.F08,L02.F02,L02.F03,L02.F06,L02.F07,L02.F04,L02.F09,L02.F05,L02.F11,L01.F01,L01.F02,L01.F27 FROM L02,L01 WHERE L02.F01=LK AND L01.F01=LK
          
     IF _TALLY >0
        REPORT FORM ALLTRIM(INT_116)+'L02' TO PRINT PROMPT PREVIEW        
     ELSE
       =MESSAGEBOX('此財產無改良異動紀錄！',0+48,'提示訊息視窗')
     ENDIF
ENDPROC
***********************************************列印範圍選定
DEFINE CLASS ANS_RANGE AS FORM
       AUTOCENTER=.T.
       CAPTION='請輸入列印日期範圍'
       FONTSIZE=INT_015*9
       HEIGHT=INT_015*160
       WIDTH=INT_015*480
       FONTSIZE=INT_015*9
       CONTROLBOX=.F.
       BORDERSTYLE=2
       SHOWTIPS=.T.
       SHOWWINDOW=1
       WINDOWTYPE=1
       NAME='ANS_RANGE'
       ADD OBJECT LABEL1 AS LABEL WITH;
           AUTOSIZE=.T.,;
           HEIGHT=INT_015*25,;
           LEFT=INT_015*30,;
           TOP=INT_015*35,;
           NAME='LABEL1'    
       ADD OBJECT LABEL2 AS LABEL WITH;
           AUTOSIZE=.T.,;
           HEIGHT=INT_015*25,;
           LEFT=INT_015*250,;
           TOP=INT_015*35,;
           NAME='LABEL2'       
       ADD OBJECT TEXT1 AS TEXTBOX WITH;
           AUTOSIZE=.T.,;
           TOP=INT_015*30,;
           LEFT=INT_015*80,;
           HEIGHT=INT_015*25,; 
           NAME='TEXT1'
       ADD OBJECT TEXT2 AS TEXTBOX WITH;
           AUTOSIZE=.T.,;
           TOP=INT_015*30,;
           LEFT=INT_015*300,;
           HEIGHT=INT_015*25,;         
           NAME='TEXT2'    
       ADD OBJECT CMND1 AS COMMANDBUTTON WITH;
           AUTOSIZE=.T.,;
           LEFT=INT_015*120,;    
           HEIGHT=INT_015*25,;   
           TOP=INT_015*114,;  
           WIDTH=INT_015*80,;
           CAPTION='\<Y.執行',;
           TOOLTIPTEXT='確認所輸入的範圍鍵值!快速鍵->ALT+Y',;
           NAME='CMND1'
       ADD OBJECT CMND2 AS COMMANDBUTTON WITH;
           AUTOSIZE=.T.,;
           LEFT=INT_015*260,;
           TOP=INT_015*114,;
           HEIGHT=INT_015*25,;
           WIDTH=INT_015*80,;
           CAPTION='\<C.取消',;
           TOOLTIPTEXT='取消作業!快速鍵->ALT+C',;
           NAME='CMND2'
 *************          
  PROCEDURE INIT 
      THISFORM.SETALL('FONTSIZE',INT_015*9,'TEXTBOX')
      THISFORM.SETALL('FONTSIZE',INT_015*9,'LABEL')      
      THISFORM.SETALL('FONTSIZE',INT_015*9,'COMMANDBUTTON')            
      THISFORM.LABEL1.CAPTION='起始日期'
      THISFORM.LABEL2.CAPTION='截止日期'
      THISFORM.TEXT1.WIDTH=INT_015*70
      THISFORM.TEXT2.WIDTH=INT_015*70   
      THISFORM.TEXT1.MAXLENGTH=5              
      THISFORM.TEXT2.MAXLENGTH=5                                       
      THISFORM.TEXT1.VALUE=L02.F01
      THISFORM.TEXT2.VALUE=L02.F01
  ENDPROC    
  PROCEDURE CMND1.CLICK 
  IF AREA1='C01'  
     LK=C01.F01   
     SELECT C19.F01,;
            C19.F02,;
            C19.F03,;          
            C19.F05,;
            C19.F06,;       
            C19.F08,;
            C19.F09,;
            C19.F10,;                       
            C19.F13,;
            (C19.F08*IIF(SEEK(C19.F06,'D00'),D00.F02,1)-B01.F38)/B01.F38*100,;
            B01.F02,;
            C01.F04;
     FROM C19,B01,C01;
     WHERE C19.F01=LK AND B01.F01=C19.F03  AND C01.F01=C19.F01 .AND.  C19.F02>=THISFORM.TEXT1.VALUE .AND. C19.F02<=THISFORM.TEXT2.VALUE ORDER BY C19.F02 NOWAIT
     IF _TALLY >0
        REPORT FORM ALLTRIM(INT_116)+'C03A' TO PRINT PROMPT PREVIEW
        FLG='1'
     ENDIF
  ELSE
     LK=B01.F01   
     SELECT C19.F01,;
            C19.F02,;
            C19.F03,;          
            C19.F05,;
            C19.F06,;       
            C19.F08,;
            C19.F09,;
            C19.F10,;                       
            C19.F13,;
            (C19.F08*IIF(SEEK(C19.F06,'D00'),D00.F02,1)-B01.F38)/B01.F38*100,;
            B01.F02,;
            C01.F04;
     FROM C19,B01,C01;
     WHERE C19.F03=LK AND B01.F01=C19.F03  AND C01.F01=C19.F01 .AND. C19.F02>=THISFORM.TEXT1.VALUE .AND. C19.F02<=THISFORM.TEXT2.VALUE ORDER BY C01.F01 NOWAIT
     IF _TALLY >0
        REPORT FORM ALLTRIM(INT_116)+'C03B' TO PRINT PROMPT PREVIEW
        FLG='1'   
     ENDIF  
  ENDIF         
       THISFORM.RELEASE                     
  ENDPROC
  PROCEDURE CMND2.CLICK
      FLG='1'   
      THISFORM.RELEASE
  ENDPROC      
ENDDEFINE    

************************************************特殊輸入欄位的設定----改良金額
DEFINE CLASS TXTF03 AS TEXTBOX
  READONLY=.T.
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*25
  PROCEDURE INTERACTIVECHANGE
       THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE=ROUND((THIS.Value-THISFORM.PAGEFRAME1.PAGE2.TXTF06.VALUE)/(VAL(LEFT(L01.F14,4))*12+VAL(RIGHT(L01.F14,2))-VAL(LEFT(THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE,4))*12-VAL(RIGHT(THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE,2))),2)
       THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE=THIS.VALUE-THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE*(VAL(LEFT(THISFORM.PAGEFRAME1.PAGE2.TXTF09.VALUE,4))*12+VAL(RIGHT(THISFORM.PAGEFRAME1.PAGE2.TXTF09.VALUE,2))-VAL(LEFT(THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE,4))*12-VAL(RIGHT(THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE,2)))
  ENDPROC
ENDDEFINE
************************************************特殊輸入欄位的設定----預留殘值
DEFINE CLASS TXTF06 AS TEXTBOX
  READONLY=.T.
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*25
  PROCEDURE INTERACTIVECHANGE
       THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE=ROUND((THISFORM.PAGEFRAME1.PAGE2.TXTF03.Value-THIS.VALUE)/(VAL(LEFT(L01.F14,4))*12+VAL(RIGHT(L01.F14,2))-VAL(LEFT(THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE,4))*12-VAL(RIGHT(THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE,2))),2)
       THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE=THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE-THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE*(VAL(LEFT(THISFORM.PAGEFRAME1.PAGE2.TXTF09.VALUE,4))*12+VAL(RIGHT(THISFORM.PAGEFRAME1.PAGE2.TXTF09.VALUE,2))-VAL(LEFT(THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE,4))*12-VAL(RIGHT(THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE,2)))       
  ENDPROC
ENDDEFINE
************************************************特殊輸入欄位的設定----起始月份
DEFINE CLASS TXTF07 AS TEXTBOX
  READONLY=.T.
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*25
  PROCEDURE INTERACTIVECHANGE
       THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE=ROUND((THISFORM.PAGEFRAME1.PAGE2.TXTF03.Value-THISFORM.PAGEFRAME1.PAGE2.TXTF06.VALUE)/(VAL(LEFT(L01.F14,4))*12+VAL(RIGHT(L01.F14,2))-VAL(LEFT(THIS.VALUE,4))*12-VAL(RIGHT(THIS.VALUE,2))),2)
       THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE=THISFORM.PAGEFRAME1.PAGE2.TXTF03.Value-THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE*(VAL(LEFT(THISFORM.PAGEFRAME1.PAGE2.TXTF09.VALUE,4))*12+VAL(RIGHT(THISFORM.PAGEFRAME1.PAGE2.TXTF09.VALUE,2))-VAL(LEFT(THIS.VALUE,4))*12-VAL(RIGHT(THIS.VALUE,2)))
  ENDPROC
  PROCEDURE VALID
    LPARAMETERS  NINDEX
    IF (VAL(RIGHT(ALLTRIM(THIS.VALUE),2))<=12 AND VAL(RIGHT(ALLTRIM(THIS.VALUE),2))>0 AND VAL(LEFT(ALLTRIM(THIS.VALUE),4))>0) AND THIS.Value>=L01.F13
       NINDEX=.T.
    ELSE
       =MESSAGEBOX("月份資料錯誤",0+48,"提示視窗")    
       NINDEX=.F.
    ENDIF
    RETURN NINDEX
  ENDPROC                
ENDDEFINE
