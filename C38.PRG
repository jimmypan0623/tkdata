***程式名稱:C38.樣品領用單
close all
clear 
PO_NO=''
FLG='0'
FCH=''
CHK=''
CHK_STR=''
R=0
QTY=0
TQTY=0
HD1='C038 '
HD2='CZ'
HD3='樣品領用單'
AREA1='C38_1'
AREA2='C38'
IF !USED('A09')
   SELE 0
   USE A09
ELSE
   SELE A09
ENDIF
SET ORDER TO 1
IF !USED('A23')
    SELE 0
    USE A23
ELSE 
   SELE A23
ENDIF
SET ORDER TO 1         
A24='A24'+LEFT(DTOS(DATE()),6)     &&單號暫存檔
IF !USED('&A24')
   SELE 0
   USE (A24) ALIA A24
ELSE
   SELE A24
ENDIF
SET ORDER TO 1      
B25='B25'+LEFT(DTOS(DATE()),6)    &&部門別月報表
IF !USED('&B25')
   SELE 0
   USE (B25) ALIA B25
ELSE
   SELE B25
ENDIF
SET ORDER TO 1      
B26='B26'+LEFT(DTOS(DATE()),6)   &&庫存異動記錄
IF !USED('&B26')
   SELE 0
   USE (B26) ALIA B26
ELSE
   SELE B26
ENDIF
SET ORDER TO 1      
B39='B39'+LEFT(DTOS(DATE()),6)   &&未過帳單據查詢檔
IF !USED('&B39')
   SELE 0
   USE (B39) ALIA B39
ELSE
   SELE B39
ENDIF
SET ORDER TO 1      
SELE A23
SET ORDER TO 1
SEEK LEFT(DTOS(DATE()),6)+'01'
IF ! USED('A01')
   SELE 0
   USE A01 INDE A01
ELSE
   SELE A01
ENDIF      
SET ORDER TO A01
IF !USED('A02')
   SELE 0
   USE A02 INDE A02
ELSE
   SELE A02
ENDIF
SET ORDER TO A021      
SEEK sys_oper+'C38'
IF !USED('A14')
   SELE 0
   USE A14
ELSE 
   SELE A14
ENDIF
*!*	SET FILTER TO F04='*'
SET ORDER TO A141   
IF !USED('C01')
   SELE 0
   USE C01
ELSE 
   SELE C01
ENDIF
SET ORDER TO C011     
IF !USED('C20')
   SELE 0
   USE C20
ELSE 
   SELE C20
ENDIF
SET ORDER TO C201  
IF !USED('B01')
   SELE 0
   USE B01 INDE B01
ELSE
   SELE B01
ENDIF
SET ORDER TO B011   
*!*	set filter to !EMPTY(F98)  
IF !USED('B11')
   SELE 0
   USE B11 
ELSE
   SELE B11
ENDIF
SET ORDER TO B111  
IF !USED('C39')         &&樣品領用紀錄
   SELE 0
   USE C39
ELSE
   SELE C39
ENDIF
SET ORDER TO 1      
C38='C38'+LEFT(DTOS(DATE()),6)
C381='C381'+LEFT(DTOS(DATE()),6)
IF !USED('&C38')
   SELE 0
   USE (C38) ALIA C38
ELSE
   SELE C38
ENDIF
SET ORDER TO 1      
SET RELA TO F03 INTO B01
SET RELATION TO F05 INTO A14 ADDI
SET RELATION TO F05+F79+SPACE(5) INTO B11 ADDITIVE 
CREATE CURSOR C38_1;
(F01 C(10),F02 C(2),F07 C(1),F10 C(5),F15 C(17),F90 C(17))
INDE ON F01 TAG C38_11
INDE ON F10 TAG C38_12
SELE F01,F02,F07,F10,F15,F90 FROM C38 GROUP BY F01 ORDER BY F01 INTO CURSOR C38_2
SELE C38_2
GO TOP
DO WHILE !EOF()
   SELE C38_1
   APPEND BLANK
   REPL F01 WITH C38_2.F01
   REPL F02 WITH C38_2.F02
   REPL F07 WITH C38_2.F07
   REPL F10 WITH C38_2.F10
   REPL F15 WITH C38_2.F15
   REPL F90 WITH C38_2.F90
   SELE C38_2
   SKIP   
ENDDO
SELE C38_2
USE   
SELE C38_1
SET ORDER TO 1
SET RELA TO F10 INTO C01 
C38form=createobject("tkC38")
C38form.show  
define class tkC38 as form
  caption='C38.樣品領用單'
  autocenter=.t.
  controlbox=.F.
  BORDERSTYLE=3  
  MAXBUTTON=.F.
  MINBUTTON=.F.
  MOVABLE=.F.
  CLOSABLE=.F.
  controlcount=57
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*550
  showtips=.t.
  showwindow=1
  WIDTH=INT_015*789
  windowtype=1
  NAME='TKC38'
  add object shape1 as shape1 with;
      autocenter=.t.
  ADD OBJECT LBL_REC AS LBL_REC WITH;
      AUTOCENTER =.T.
  ADD OBJECT REC_COUNT AS REC_COUNT  with;
      caption=str(reccount())        
  add object shape2 as shape2 with;
      autocenter=.t.
  add object shape3 as shape3 with;
      autocenter=.t.
  ADD OBJECT PAGEFRAME1 AS PAGEFRAME WITH;
      LEFT=INT_015*236,;
      WIDTH=INT_015*540,;
      HEIGHT=INT_015*200,;
      FONTSIZE=INT_015*9,;
      PAGECOUNT=2,;
      TABSTRETCH=1,;
      ACTIVEPAGE=1,;
      VISIBLE=.T.,;
      PAGE1.NAME='PAGE1',;
      PAGE1.VISIBLE=.T.,;
      PAGE1.CAPTION='表頭資料',;
      PAGE2.NAME='PAGE2',;
      PAGE2.VISIBLE=.T.,;
      PAGE2.CAPTION='表身詳細資料內容'   
  ADD OBJECT KEY_LIST AS KEY_LIST WITH;
      autocenter=.t.,;
      WIDTH=INT_015*130
  ADD OBJECT MTH_LIST AS MTH_LIST WITH;
      autocenter=.t.
  ADD OBJECT grid1 AS grid1 WITH;
      columncount=4,;            
      RECORDSOURCE='C38_1',;      
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;      
      COLUMN3.NAME='COLUMN3'     
  ADD OBJECT grid2 AS grid2 WITH;
      columncount=6,;            
      RECORDSOURCE='C38',; 
      LINKMASTER='C38_1',;
      RELATIONALEXPR='F01',;
      childorder=C381,;  
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;
      COLUMN3.NAME='COLUMN3',;
      COLUMN4.NAME='COLUMN4',;
      COLUMN5.NAME='COLUMN5',;
      COLUMN6.NAME='COLUMN6'
  ADD OBJECT CMDGROUP AS CMDGROUP WITH;
      AUTOSIZE=.T.              
  ADD OBJECT ORPGROUP AS ORPGROUP WITH;    
      AUTOSIZE=.T.              
  ADD OBJECT SHRGROUP AS SHRGROUP WITH;
      TOP=INT_015*173,;
      LEFT=INT_015*558          
  ADD OBJECT ANS_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*490,;
      LEFT=INT_015*15,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*40,;      
      FONTSIZE=INT_015*9,;
      CAPTION='\<A.過帳',;
      NAME='ANS_BOTT' 
  ADD OBJECT VRT_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*490,;
      LEFT=INT_015*57,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*55,;      
      FONTSIZE=INT_015*9,;
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\harrow.cur',;   
      TOOLTIPTEXT='將已過入庫存及帳款之資料轉回未過帳狀態!快速鍵->ALT+V',;      
      CAPTION='\<V.反過帳',;
      NAME='VRT_BOTT'             
  ADD OBJECT EXCEL_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*490,;
      LEFT=INT_015*158,;
      HEIGHT=INT_015*25,;
      FONTSIZE=INT_015*9,;
      WIDTH=INT_015*65,;
      CAPTION='\<T.轉EXCEL',;
      NAME='EXCEL_BOTT'                           
  PROCEDURE PAGEFRAME1.PAGE1.INIT     
     THIS.ADDOBJECT('LBLF01','LABEL')
     WITH THIS.LBLF01
          .VISIBLE=.T.
          .LEFT=INT_015*14
          .TOP=INT_015*13
          .WIDTH=INT_015*50
          .CAPTION='領用單號'          
     ENDWITH             
     THIS.ADDOBJECT('LBLF10','LABEL')
     WITH THIS.LBLF10
         .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*88
         .WIDTH=INT_015*50
         .CAPTION='領用客戶'
     ENDWITH    
     THIS.ADDOBJECT('LBLF101','LABEL')
     WITH THIS.LBLF101
         .VISIBLE=.T.
         .LEFT=INT_015*115
         .TOP=INT_015*88
         .AUTOSIZE=.T. 
     ENDWITH    
     THIS.ADDOBJECT('LBLF02','LABEL')
     WITH THIS.LBLF02
         .VISIBLE=.T.
         .LEFT=INT_015*368
         .TOP=INT_015*13
         .WIDTH=INT_015*50
         .CAPTION='領用日期'
     ENDWITH    
     THIS.ADDOBJECT('LBLF07','LABEL')
     WITH THIS.LBLF07
         .VISIBLE=.T.
         .LEFT=INT_015*368
         .TOP=INT_015*38
         .WIDTH=INT_015*50
         .CAPTION='過  帳  碼'
     ENDWITH    
     THIS.ADDOBJECT('LBLF071','LABEL')
     WITH THIS.LBLF071
         .VISIBLE=.T.
         .LEFT=INT_015*419
         .TOP=INT_015*38
         .AUTOSIZE=.T.
     ENDWITH    
     THIS.ADDOBJECT('LBLF15','LABEL')
     WITH THIS.LBLF15
         .VISIBLE=.T.
         .LEFT=INT_015*368
         .TOP=INT_015*63
         .WIDTH=INT_015*50
         .CAPTION='安全資料'
     ENDWITH    
     THIS.ADDOBJECT('LBLF151','LABEL')
     WITH THIS.LBLF151
         .VISIBLE=.T.
         .LEFT=INT_015*419
         .TOP=INT_015*63
         .AUTOSIZE=.T.
     ENDWITH    
     THIS.ADDOBJECT('LBLF90','LABEL')
     WITH THIS.LBLF90
         .VISIBLE=.T.
         .LEFT=INT_015*368
         .TOP=INT_015*88
         .WIDTH=INT_015*50
         .CAPTION='確認人員'
     ENDWITH    
     THIS.ADDOBJECT('LBLF901','LABEL')
     WITH THIS.LBLF901
         .VISIBLE=.T.
         .LEFT=INT_015*419
         .TOP=INT_015*88
         .AUTOSIZE=.T.
     ENDWITH         
     THIS.ADDOBJECT('TXTF01','TEXTBOX')          
     WITH THIS.TXTF01
          .VISIBLE=.T.
          .LEFT=INT_015*64
          .TOP=INT_015*9
          .WIDTH=INT_015*81
          .HEIGHT=INT_015*25
          .MAXLENGTH=10
     ENDWITH             
     THIS.ADDOBJECT('TXTF10','TXTF10')          
     WITH THIS.TXTF10
          .VISIBLE=.T.
          .LEFT=INT_015*64
          .TOP=INT_015*84
          .WIDTH=INT_015*49
          .HEIGHT=INT_015*25
          .MAXLENGTH=5
     ENDWITH                                
     THIS.ADDOBJECT('TXTF02','TEXTBOX')          
     WITH THIS.TXTF02
          .VISIBLE=.T.
          .LEFT=INT_015*418
          .TOP=INT_015*9
          .WIDTH=INT_015*40
          .HEIGHT=INT_015*25
          .MAXLENGTH=2
     ENDWITH        
  ENDPROC   
  PROCEDURE PAGEFRAME1.PAGE2.INIT
	THIS.ADDOBJECT('LBLF03','LABEL')
	WITH THIS.LBLF03  
	     .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*18
	     .WIDTH=INT_015*50
         .CAPTION='料品編號'
    ENDWITH  
    THIS.ADDOBJECT('LBLF031','LABEL')
    WITH THIS.LBLF031
         .VISIBLE=.T.
         .LEFT=INT_015*327
	     .TOP=INT_015*18
	     .AUTOSIZE=.T.
	ENDWITH  
     THIS.ADDOBJECT('LBLF05','LABEL')     
     WITH THIS.LBLF05
          .VISIBLE=.T.
          .LEFT=INT_015*14
          .TOP=INT_015*63
          .WIDTH=INT_015*50  
          .CAPTION='發料部門'
     ENDWITH            
     THIS.ADDOBJECT('LBLF051','LABEL')     
     WITH THIS.LBLF051
          .VISIBLE=.T.
          .LEFT=INT_015*115
          .TOP=INT_015*63
          .AUTOSIZE=.T.
     ENDWITH 	 
    THIS.ADDOBJECT('LBLF04','Label')
    WITH THIS.LBLF04
         .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*88
         .WIDTH=INT_015*50
         .CAPTION='領用數量'         
    ENDWITH     
     THIS.ADDOBJECT('LBLF08','LABEL')
     WITH THIS.LBLF08
         .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*113
         .WIDTH=INT_015*50
         .CAPTION='備註說明'
     ENDWITH      
     THIS.ADDOBJECT('LBLF79','LABEL')
     WITH THIS.LBLF79
         .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*138
         .WIDTH=INT_015*50
         .CAPTION='實際料號'
     ENDWITH           
     THIS.ADDOBJECT('LBLF7911','LABEL')
    WITH THIS.LBLF7911
         .VISIBLE=INT_029       
         .LEFT=INT_015*354
         .TOP=INT_015*138
         .AUTOSIZE=.T.
         .CAPTION='在庫數量'
    ENDWITH                 
    THIS.ADDOBJECT('LBLF15','LABEL')
    WITH THIS.LBLF15
        .VISIBLE=.T.           
        .LEFT=INT_015*354
        .TOP=INT_015*118
        .WIDTH=INT_015*50
        .CAPTION='安全資料'         
    ENDWITH    
    THIS.ADDOBJECT('LBLF151','LABEL')
    WITH THIS.LBLF151
        .VISIBLE=.T.           
        .LEFT=INT_015*406
        .TOP=INT_015*118
        .AUTOSIZE=.T.
    ENDWITH    
	THIS.ADDOBJECT('TXTF03','TXTF03')
	WITH THIS.TXTF03      
	     .VISIBLE=.T.
	     .LEFT=INT_015*65
	     .TOP=INT_015*14
	     .WIDTH=INT_015*261
	     .HEIGHT=INT_015*25
	     .MAXLENGTH=43
	     .NAME='TXTF03'  
	ENDWITH     
    THIS.ADDOBJECT('TXTF05','TXTF05')          
     WITH THIS.TXTF05
          .VISIBLE=.T.
          .LEFT=INT_015*65
          .TOP=INT_015*59
          .WIDTH=INT_015*49
          .HEIGHT=INT_015*25
          .MAXLENGTH=5
     ENDWITH	
	THIS.ADDOBJECT('TXTF04','TEXTBOX')
	WITH THIS.TXTF04
	     .VISIBLE=.T.
	     .LEFT=INT_015*65
	     .TOP=INT_015*84
	     .WIDTH=INT_015*100
	     .HEIGHT=INT_015*25
	     .INPUTMASK='99999999.99'
	     .NAME='TXTF04'	    
	ENDWITH     
     THIS.ADDOBJECT('TXTF08','TEXTBOX')          
     WITH THIS.TXTF08
          .VISIBLE=.T.
          .LEFT=INT_015*64
          .TOP=INT_015*109
          .WIDTH=INT_015*250
          .HEIGHT=INT_015*25
          .MAXLENGTH=80
     ENDWITH 	
     THIS.ADDOBJECT('TXTF79','TXTF79')
	WITH THIS.TXTF79    
	     .VISIBLE=.T.
	     .LEFT=INT_015*65
	     .TOP=INT_015*134
	     .WIDTH=INT_015*261
	     .HEIGHT=INT_015*25
	     .MAXLENGTH=43
	     .NAME='TXTF79'  
	ENDWITH     
  ENDPROC       
  PROCEDURE PAGEFRAME1.PAGE1.activate
     R=0
     SELE C38_1
     IF THISFORM.SHRGROUP.VISIBLE=.F.
        THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(C38_1.F07<>'2',RGB(255,0,0),'')","COLUMN")         
        THISFORM.GRID1.ENABLED=.T.   
        THISFORM.GRID1.SETFOCUS   
        THISFORM.KEY_LIST.ENABLED=.T.
        THISFORM.MTH_LIST.ENABLED=.T.
     ELSE
       THISFORM.KEY_LIST.ENABLED=.F.   
       THISFORM.MTH_LIST.ENABLED=.F.   
     ENDIF   
        THISFORM.PAGEFRAME1.PAGE1.FONTITALIC=.T.
        THISFORM.PAGEFRAME1.PAGE1.FORECOLOR=RGB(0,0,255)
        THISFORM.PAGEFRAME1.PAGE2.FONTITALIC=.F.
        THISFORM.PAGEFRAME1.PAGE2.FORECOLOR=RGB(0,0,0)            
    IF THISFORM.GRID1.ACTIVEROW=0 .AND. thisform.SHRGROUP.ENABLED=.F.
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
        THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
        THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
        THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
        THISFORM.ANS_BOTT.ENABLED=.F.
        THISFORM.VRT_BOTT.ENABLED=.F.
        THISFORM.EXCEL_BOTT.ENABLED=.F.        
        THISFORM.PAGEFRAME1.PAGE1.SETALL('VALUE','','TEXTBOX')        
        THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=''
        THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE=''
        THISFORM.PAGEFRAME1.PAGE1.TXTF10.VALUE=''       
        THISFORM.PAGEFRAME1.PAGE1.LBLF101.CAPTION=''
        THISFORM.PAGEFRAME1.PAGE1.LBLF071.CAPTION=''
        THISFORM.PAGEFRAME1.PAGE1.LBLF151.CAPTION=''        
        THISFORM.PAGEFRAME1.PAGE1.LBLF901.CAPTION=''             
        THISFORM.PAGEFRAME1.PAGE2.ENABLED=.F.      
     ELSE
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.
        THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  .AND. C38_1.F07<>'2' &&判斷有無修改的權限
        THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)   .AND. C38_1.F07<>'2' &&判斷有無刪除的權限
        THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)    &&判斷有無列印的權限  
        THISFORM.ANS_BOTT.ENABLED=IIF(C38_1.F07='2',.F.,.T.) .AND. IIF(A02.F11='*',.T.,.F.) .AND. !THISFORM.SHRGROUP.ENABLED
        THISFORM.VRT_BOTT.ENABLED=IIF(EMPTY(C38_1.F07),.F.,.T.) .AND. IIF(A02.F12='*',.T.,.F.) .AND. !THISFORM.SHRGROUP.ENABLED .AND.!IIF(SEEK(DTOS(CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/01')),'A23','A231'),A23.F07,.F.)
        THISFORM.EXCEL_BOTT.ENABLED=IIF(A02.F10='*',.T.,.F.)             
        THISFORM.PAGEFRAME1.PAGE2.ENABLED=.T.
     ENDIF   
     THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.);
     .AND. !IIF(SEEK(DTOS(CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/01')),'A23','A231'),A23.F07,.F.)
  ENDPROC
  PROCEDURE PAGEFRAME1.PAGE2.activate
     SELE C38
     IF THISFORM.SHRGROUP.ENABLED=.F.
        THISFORM.GRID2.READONLY=.T.   
        THISFORM.GRID2.SETFOCUS   
     ENDIF   
        THISFORM.PAGEFRAME1.PAGE1.FONTITALIC=.F.
        THISFORM.PAGEFRAME1.PAGE1.FORECOLOR=RGB(0,0,0)
        THISFORM.PAGEFRAME1.PAGE2.FONTITALIC=.T.
        THISFORM.PAGEFRAME1.PAGE2.FORECOLOR=RGB(0,0,255)  
     IF THISFORM.GRID2.ACTIVEROW=0 .and. thisform.SHRGROUP.ENABLED=.F.
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
        THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
        THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
        THISFORM.ANS_BOTT.ENABLED=.F.
        THISFORM.VRT_BOTT.ENABLED=.F.
        THISFORM.PAGEFRAME1.PAGE2.SETALL('VALUE','','TEXTBOX')
        THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE=''
        THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=''
        THISFORM.PAGEFRAME1.PAGE2.TXTF08.VALUE=''
        THISFORM.PAGEFRAME1.PAGE2.TXTF79.VALUE=''
        THISFORM.PAGEFRAME1.PAGE2.LBLF051.CAPTION=''
        THISFORM.PAGEFRAME1.PAGE2.LBLF031.CAPTION=''         
     ELSE
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.
        THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.) .AND. C38.F07<>'2'  &&判斷有無修改的權限
        THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)  .AND. C38.F07<>'2' &&判斷有無刪除的權限
        THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)  &&&&判斷有無列印的權限  
        THISFORM.ANS_BOTT.ENABLED=IIF(C38.F07='2',.F.,.T.) .AND. IIF(A02.F11='*',.T.,.F.) .AND. !THISFORM.SHRGROUP.ENABLED
        THISFORM.VRT_BOTT.ENABLED=IIF(EMPTY(C38.F07),.F.,.T.) .AND. IIF(A02.F12='*',.T.,.F.) .AND. !THISFORM.SHRGROUP.ENABLED .AND.!IIF(SEEK(DTOS(CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/01')),'A23','A231'),A23.F07,.F.)
         
     ENDIF   
     R=RECNO('&AREA1')
     THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(RECNO('&AREA1')=R,RGB(255,255,0),'')","COLUMN")
     THISFORM.GRID1.ENABLED=.F.     
     THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.)  .AND. C38_1.F07<>'2' &&判斷有無新增的權限
     THISFORM.KEY_LIST.ENABLED=.F.     
     THISFORM.MTH_LIST.ENABLED=.F.     
      THISFORM.EXCEL_BOTT.ENABLED=.F.
  ENDPROC     
  PROC INIT     
       THISFORM.PAGEFRAME1.PAGE1.FONTITALIC=.T.
       THISFORM.PAGEFRAME1.PAGE1.FORECOLOR=RGB(0,0,255)      
       THISFORM.PAGEFRAME1.PAGE1.FONTSIZE=INT_015*10
       THISFORM.PAGEFRAME1.PAGE2.FONTSIZE=INT_015*10  
       THISFORM.SETALL('HEIGHT',INT_015*25,'TEXTBOX')
       THISFORM.SETALL('HEIGHT',INT_015*17,'LABEL')     
       THISFORM.SETALL('FONTSIZE',INT_015*9,'TEXTBOX')
       THISFORM.SETALL('FONTSIZE',INT_015*9,'LABEL')         
       THISFORM.SETALL('READONLY',.T.,'TEXTBOX')
       THISFORM.SHRGROUP.VISIBLE=.F.
       THISFORM.SHRGROUP.ENABLED=.F.
       THISFORM.GRID1.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)
       THISFORM.GRID2.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)
       thisform.GRID1.setall('FONTSIZE',INT_015*9,'COLUMN')
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'HEADER')         
       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='領用單號'
       THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='領用客戶編號'
       THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='領用客戶簡稱'
       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='C38_1.F01'
       THISFORM.GRID1.COLUMN2.CONTROLSOURCE='C38_1.F10'
       THISFORM.GRID1.COLUMN3.CONTROLSOURCE='C01.F05'
       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*81
       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*49
       THISFORM.GRID1.COLUMN3.WIDTH=INT_015*80
       THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(C38_1.F07<>'2',RGB(255,0,0),'')","COLUMN")         
       THISFORM.GRID2.SETALL('FONTSIZE',INT_015*9,'COLUMN')
       THISFORM.GRID2.SETALL('FONTSIZE',INT_015*9,'HEADER')       
       THISFORM.GRID2.COLUMN1.HEADER1.CAPTION='料品編號'    
       THISFORM.GRID2.COLUMN2.HEADER1.CAPTION=IIF(INT_029,'實際料號','品名規格')          
       THISFORM.GRID2.COLUMN3.HEADER1.CAPTION='發料部門'
       THISFORM.GRID2.COLUMN4.HEADER1.CAPTION='領用數量'
       THISFORM.GRID2.COLUMN5.HEADER1.CAPTION='在庫數量'
	   THISFORM.GRID2.COLUMN6.HEADER1.CAPTION='安全資料'
	   THISFORM.GRID2.LINKMASTER='C38_1'
       THISFORM.GRID2.RELATIONALEXPR='F01'
	   THISFORM.GRID2.COLUMN1.CONTROLSOURCE='C38.F03'
	    THISFORM.GRID2.COLUMN2.CONTROLSOURCE="IIF(INT_029,C38.F79,B01.F02)"
	   THISFORM.GRID2.COLUMN3.CONTROLSOURCE='A14.F02'  
	   THISFORM.GRID2.COLUMN4.CONTROLSOURCE='C38.F04'
	   THISFORM.GRID2.COLUMN5.CONTROLSOURCE='B11.F04'
	   THISFORM.GRID2.COLUMN6.CONTROLSOURCE='C38.F15'
	   THISFORM.GRID2.COLUMN1.WIDTH=INT_015*185
	   THISFORM.GRID2.COLUMN2.WIDTH=INT_015*165
	   THISFORM.GRID2.COLUMN3.WIDTH=INT_015*55
       THISFORM.GRID2.COLUMN4.WIDTH=INT_015*55
       THISFORM.GRID2.COLUMN5.WIDTH=INT_015*80
       THISFORM.GRID2.COLUMN6.WIDTH=INT_015*135
       THISFORM.GRID2.SETALL("DYNAMICBACKCOLOR","IIF(C38.F03!=C38.F79,RGB(107,79,175),IIF(B11.F04-C38.F04<0 AND EMPTY(C38_1.F07),RGB(255,255,0),''))","COLUMN")
       THISFORM.GRID1.READONLY=.T.      
       THISFORM.GRID2.READONLY=.T.            
       THISFORM.GRID1.SETFOCUS
       IF THISFORM.GRID1.ACTIVEROW=0
          THISFORM.CMDGROUP.ENABLED=.F.
          THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
          THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
          THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
          THISFORM.ANS_BOTT.ENABLED=.F.
          THISFORM.VRT_BOTT.ENABLED=.F.
          THISFORM.EXCEL_BOTT.ENABLED=.F.          
       ELSE
          THISFORM.CMDGROUP.ENABLED=.T.      
          THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.) .AND. C38_1.F07<>'2'  &&判斷有無修改的權限
          THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)  .AND. C38_1.F07<>'2' &&判斷有無刪除的權限
          THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限       
          THISFORM.ANS_BOTT.ENABLED=IIF(C38_1.F07='2',.F.,.T.)  .AND. IIF(A02.F11='*',.T.,.F.) .AND. !THISFORM.SHRGROUP.ENABLED
          THISFORM.VRT_BOTT.ENABLED=IIF(EMPTY(C38_1.F07),.F.,.T.)  .AND. IIF(A02.F12='*',.T.,.F.) .AND. !THISFORM.SHRGROUP.ENABLED 
          THISFORM.EXCEL_BOTT.ENABLED=IIF(A02.F10='*',.T.,.F.)                 
       ENDIF          
*       THISFORM.KEY_LIST.DISPLAYVALUE='依領用單號排列'      
       JK='領用單號'
       SELE C38_1
       THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=C38_1.F01
  ENDPROC               
  PROC KEY_LIST.INIT 
       with this 
           .additem('依領用單號排列')
           .additem('依領用客戶排列')
           .VALUE=1
       endwith             
  ENDPROC 
  PROC KEY_LIST.INTERACTIVECHANGE                 
       SELE C38_1 
       DO CASE
          CASE THIS.DISPLAYVALUE='依領用單號排列'
               set order to 1 
               THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='領用單號'
               THISFORM.GRID1.COLUMN1.CONTROLSOURCE='C38_1.F01'
               THISFORM.GRID1.COLUMN1.WIDTH=INT_015*81
               THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='領用客戶編號'
               THISFORM.GRID1.COLUMN2.CONTROLSOURCE='C38_1.F10'
               THISFORM.GRID1.COLUMN2.WIDTH=INT_015*49               
               THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='領用客戶簡稱'
               THISFORM.GRID1.COLUMN3.CONTROLSOURCE='C01.F05'
               THISFORM.GRID1.COLUMN3.WIDTH=INT_015*80                                                
          CASE THIS.DISPLAYVALUE='依領用客戶排列'
               set order to 2
               THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='領用客戶編號'
               THISFORM.GRID1.COLUMN1.CONTROLSOURCE='C38_1.F10'
               THISFORM.GRID1.COLUMN1.WIDTH=INT_015*49
               THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='領用客戶簡稱'
               THISFORM.GRID1.COLUMN2.CONTROLSOURCE='C01.F05'
               THISFORM.GRID1.COLUMN2.WIDTH=INT_015*80
               THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='領用單號'
               THISFORM.GRID1.COLUMN3.CONTROLSOURCE='C38_1.F01'
               THISFORM.GRID1.COLUMN3.WIDTH=INT_015*81                                                                         
       ENDCASE 
        THISFORM.grid1.SETFOCUS
  ENDPROC      
  PROC MTH_LIST.INTERACTIVECHANGE
       THISFORM.GRID1.RECORDSOURCE=''
       THISFORM.GRID2.RECORDSOURCE=''
       THISFORM.GRID2.LINKMASTER=''
       THISFORM.GRID2.RELATIONALEXPR=''
       THISFORM.GRID2.childorder=''
       SELE A24
       USE
       SELECT A23
       SEEK DTOS(CTOD(THIS.DISPLAYVALUE+'/01'))
       A24='A24'+LEFT(DTOS(CTOD(THIS.DISPLAYVALUE+'/01')),6)
       IF !USED('&A24')
          SELE 0
          USE (A24) ALIA A24
       ELSE
          SELE A24
       ENDIF
       SET ORDER TO 1             
       SELE B25
       USE
       B25='B25'+LEFT(DTOS(CTOD(THIS.DISPLAYVALUE+'/01')),6)
       IF !USED('&B25')
          SELE 0
          USE (B25) ALIA B25
       ELSE
          SELE B25
       ENDIF
       SET ORDER TO 1                    
       SELE B26
       USE
       B26='B26'+LEFT(DTOS(CTOD(THIS.DISPLAYVALUE+'/01')),6)
       IF !USED('&B26')
          SELE 0
          USE (B26) ALIA B26
       ELSE
          SELE B26
       ENDIF
       SET ORDER TO 1                           
       SELE B39
       USE
       B39='B39'+LEFT(DTOS(CTOD(THIS.DISPLAYVALUE+'/01')),6)
       IF !USED('&B39')
          SELE 0
          USE (B39) ALIA B39
       ELSE
          SELE B39
       ENDIF
       SET ORDER TO 1                                  
       SELE C38
       SET RELATION OFF INTO A14
       set rela off into B01
       SET RELA OFF INTO C38_1
       SET RELATION OFF INTO B11
       USE
       SELE C38_1
       SET RELATION OFF INTO C01
       USE
       C38='C38'+LEFT(DTOS(CTOD(THIS.DISPLAYVALUE+'/01')),6)
       C381='C381'+LEFT(DTOS(CTOD(THIS.DISPLAYVALUE+'/01')),6)
       IF !USED('&C38')
          SELE 0
          USE (C38) ALIA C38
       ELSE
          SELE C38
       ENDIF
       SET ORDER TO 1      
       SET RELA TO F03 INTO B01      
       SET RELATION TO F05 INTO A14 ADDI
       SET RELATION TO F05+F79+SPACE(5) INTO B11 ADDITIVE 
       CREATE CURSOR C38_1;
       (F01 C(10),F02 C(2),F07 C(1),F10 C(5),F15 C(17),F90 C(17))
       INDE ON F01 TAG C38_11
       INDE ON F10 TAG C38_12
       SELE F01,F02,F07,F10,F15,F90 FROM C38 GROUP BY F01 ORDER BY F01 INTO CURSOR C38_2
       SELE C38_2
       GO TOP
       DO WHILE !EOF()
          SELE C38_1
          APPEND BLANK
          REPL F01 WITH C38_2.F01
          REPL F02 WITH C38_2.F02
          REPL F07 WITH C38_2.F07
          REPL F10 WITH C38_2.F10
          REPL F15 WITH C38_2.F15
          REPL F90 WITH C38_2.F90
          SELE C38_2
          SKIP
       ENDDO
       SELE C38_2
       USE   
       SELE C38_1
       SET RELATION TO F10 INTO C01
       SET ORDER TO 1
       THISFORM.GRID1.RECORDSOURCE='C38_1'
       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='C38_1.F01'     
       THISFORM.GRID1.COLUMN2.CONTROLSOURCE='C38_1.F10'              
       THISFORM.GRID1.COLUMN3.CONTROLSOURCE="C01.F05"       
       THISFORM.GRID2.RECORDSOURCE='C38'
	   THISFORM.GRID2.LINKMASTER='C38_1'
       THISFORM.GRID2.RELATIONALEXPR='F01'      
       THISFORM.GRID2.CHILDORDER=C381  
	   THISFORM.grid2.COLUMN1.CONTROLSOURCE='C38.F03'
	   THISFORM.GRID2.COLUMN2.CONTROLSOURCE="IIF(INT_029,C38.F79,B01.F02)"	   
	   THISFORM.grid2.COLUMN3.CONTROLSOURCE='A14.F02' 
	   THISFORM.grid2.COLUMN4.CONTROLSOURCE='C38.F04'
	   THISFORM.grid2.COLUMN5.CONTROLSOURCE='B11.F04'
	   THISFORM.grid2.COLUMN6.CONTROLSOURCE='C38.F15'            
       THISFORM.KEY_LIST.INTERACTIVECHANGE
	   THISFORM.PAGEFRAME1.ACTIVEPAGE=1
	   THISFORM.REFRESH
	   THISFORM.GRID1.SETFOCUS        
       IF THISFORM.GRID1.ACTIVEROW=0
          THISFORM.CMDGROUP.ENABLED=.F.
          THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
          THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
          THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
          THISFORM.ANS_BOTT.ENABLED=.F.
          THISFORM.VRT_BOTT.ENABLED=.F.
          THISFORM.EXCEL_BOTT.ENABLED=.F.
       ELSE
          THISFORM.CMDGROUP.ENABLED=.T.      
          THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.) .AND. C38_1.F07<>'2'  &&判斷有無修改的權限
          THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)  .AND. C38_1.F07<>'2' &&判斷有無刪除的權限
          THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限    
          THISFORM.ANS_BOTT.ENABLED=IIF(C38_1.F07='2',.F.,.T.)  .AND. IIF(A02.F11='*',.T.,.F.) .AND. !THISFORM.SHRGROUP.ENABLED 
          THISFORM.VRT_BOTT.ENABLED=IIF(EMPTY(C38_1.F07),.F.,.T.) .AND. IIF(A02.F12='*',.T.,.F.)  .AND. !THISFORM.SHRGROUP.ENABLED .AND.!IIF(SEEK(DTOS(CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/01')),'A23','A231'),A23.F07,.F.)           
          THISFORM.EXCEL_BOTT.ENABLED=IIF(A02.F10='*',.T.,.F.) 
       ENDIF          
     THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.);
     .AND. !IIF(SEEK(DTOS(CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/01')),'A23','A231'),A23.F07,.F.)       
  ENDPROC
  PROC grid1.AFTERROWCOLCHANGE
       LPARAMETERS nColIndex
       THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=C38_1.F01
       THISFORM.PAGEFRAME1.PAGE1.TXTF10.VALUE=C38_1.F10
       THISFORM.PAGEFRAME1.PAGE1.LBLF101.CAPTION=C01.F04
       THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE=C38_1.F02
       THISFORM.PAGEFRAME1.PAGE1.LBLF071.CAPTION=C38_1.F07
       THISFORM.PAGEFRAME1.PAGE1.LBLF151.CAPTION=C38_1.F15
       THISFORM.PAGEFRAME1.PAGE1.LBLF901.CAPTION=C38_1.F90
       THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.) .AND. C38_1.F07<>'2'  &&判斷有無修改的權限
       THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)  .AND. C38_1.F07<>'2' &&判斷有無刪除的權限
       THISFORM.ANS_BOTT.ENABLED=IIF(C38_1.F07='2',.F.,.T.) .AND. IIF(A02.F11='*',.T.,.F.) .AND. !THISFORM.SHRGROUP.ENABLED 
       THISFORM.VRT_BOTT.ENABLED=IIF(EMPTY(C38_1.F07),.F.,.T.) .AND. IIF(A02.F12='*',.T.,.F.)  .AND. !THISFORM.SHRGROUP.ENABLED .AND.!IIF(SEEK(DTOS(CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/01')),'A23','A231'),A23.F07,.F.)     
       FCH=THISFORM.ACTIVECONTROL.NAME
       JK=THIS.COLUMN1.HEADER1.CAPTION  
       IF THIS.ACTIVEROW=0
          THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
          THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
          THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
          THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.       
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
          THISFORM.ORPGROUP.NEW_BOTT.ENABLED=.F.
          THISFORM.EXCEL_BOTT.ENABLED=.F.
       ELSE
          THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
          THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
          THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
          THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.       
    	  THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.
    	  THISFORM.EXCEL_BOTT.ENABLED=IIF(A02.F10='*',.T.,.F.) 
    	 THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.);
    	 .AND. !IIF(SEEK(DTOS(CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/01')),'A23','A231'),A23.F07,.F.)   
       ENDIF   
       CHK=''     
*       thisform.refresh
  ENDPROC     
  PROC grid2.AFTERROWCOLCHANGE
       LPARAMETERS nColIndex
       THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=C38.F03
       THISFORM.PAGEFRAME1.PAGE2.LBLF031.CAPTION=B01.F02
       THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE=C38.F05
       THISFORM.PAGEFRAME1.PAGE2.LBLF051.CAPTION=IIF(SEEK(C38.F05,'A14'),A14.F02,'')
       THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE=C38.F04      
       THISFORM.PAGEFRAME1.PAGE2.TXTF08.VALUE=C38.F08
       THISFORM.PAGEFRAME1.PAGE2.TXTF79.VALUE=C38.F79
       THISFORM.PAGEFRAME1.PAGE2.LBLF151.CAPTION=C38.F15
       THISFORM.PAGEFRAME1.PAGE2.LBLF7911.CAPTION='在庫數量:'+TRANSFORM(B11.F04,'@R 99999999999.99')
       FCH=THISFORM.ACTIVECONTROL.NAME
       JK=THIS.COLUMN1.HEADER1.CAPTION
       CHK=C38_1.F01
*       CHK=THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
       IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
         THISFORM.ORPGROUP.NEW_BOTT.ENABLED=.F.
       ENDIF   
*       THISFORM.REFRESH
  ENDPROC 
  PROCEDURE ORPGROUP.NEW_BOTT.CLICK    
    THISFORM.KEY_LIST.ENABLED=.F. 
    THISFORM.MTH_LIST.ENABLED=.F. 
    THISFORM.ANS_BOTT.ENABLED=.F.
    IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1       
       THISFORM.GRID2.RECORDSOURCE=''
       THISFORM.GRID2.CHILDORDER=''
       THISFORM.PAGEFRAME1.PAGE1.SETALL('READONLY',.F.,'TEXTBOX')     &&處理表頭新增
       THISFORM.GRID1.ENABLED=.F.   
       THISFORM.GRID2.ENABLED=.F.   
          HD=HD1+SUBSTR(DTOS(CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/01')),3,4)
          DO ODR_CRT
          THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=PO_NO
          THISFORM.PAGEFRAME1.PAGE1.TXTF01.REFRESH
          thisform.PAGEFRAME1.PAGE1.txtf01.readonly=.t.
          THISFORM.PAGEFRAME1.PAGE1.TXTF10.SETFOCUS
          THISFORM.PAGEFRAME1.PAGE2.ENABLED=.F.
          THISFORM.PAGEFRAME1.PAGE1.TXTF10.READONLY=.F.    
          THISFORM.PAGEFRAME1.PAGE1.TXTF10.VALUE=''                
          THISFORM.PAGEFRAME1.PAGE1.LBLF101.CAPTION=''        
          THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE=RIGHT(DTOS(DATE()),2)
          THISFORM.PAGEFRAME1.PAGE1.LBLF151.CAPTION=''
          THISFORM.PAGEFRAME1.PAGE1.LBLF071.CAPTION=''              
          THISFORM.PAGEFRAME1.PAGE1.LBLF901.CAPTION=''    
     ELSE
        THISFORM.PAGEFRAME1.PAGE1.ENABLED=.F.              &&處理表身新增
        THISFORM.GRID2.ENABLED=.F.   
        THISFORM.PAGEFRAME1.PAGE2.SETALL('READONLY',.F.,'TEXTBOX')     
        THISFORM.PAGEFRAME1.PAGE2.TXTF03.READONLY=.F.
        THISFORM.PAGEFRAME1.PAGE2.TXTF05.READONLY=.F.
        THISFORM.PAGEFRAME1.PAGE2.TXTF03.SETFOCUS
        THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=''          
        THISFORM.PAGEFRAME1.PAGE2.lblF031.caption='' 
        THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE=''
        THISFORM.PAGEFRAME1.PAGE2.LBLF051.CAPTION=''                 
        THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE=0
        THISFORM.PAGEFRAME1.PAGE2.TXTF08.VALUE=''
        THISFORM.PAGEFRAME1.PAGE2.TXTF79.VALUE=''
        THISFORM.PAGEFRAME1.PAGE2.LBLF151.CAPTION=''               
     ENDIF   

  ENDPROC  
  PROCEDURE ORPGROUP.EDIT_BOTT.CLICK
     THISFORM.KEY_LIST.ENABLED=.F. 
     THISFORM.MTH_LIST.ENABLED=.F. 
     THISFORM.ANS_BOTT.ENABLED=.F.
     THISFORM.GRID1.ENABLED=.F.   
     THISFORM.GRID2.ENABLED=.F.   
     IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
        SELE C38_1
        PO_NO=C38_1.F01
        SELE RECNO() FROM C38 WHERE C38.F01=PO_NO AND F07<>'2' INTO ARRAY BK1
        JJ1=''                
        IF _TALLY>0                   
           FOR I= 1 TO ALEN(BK1)
               JJ1=JJ1+ALLTRIM(STR(BK1(I)))+','
           ENDFOR  
           KK1=STUFF(JJ1,RAT(',',JJ1,1),1,'')
           RLOCK(KK1,'C38')
           LL1=RLOCK(KK1,'C38')
        ELSE 
           =MESSAGEBOX('此單據已由別的工作站過帳中無法修改!',0+64,'提示訊息視窗')
           SELE C38_1           
           UNLOCK ALL
           REPL F07 WITH '2'
           THISFORM.SHRGROUP.ABANDON_BOTT.CLICK   
        ENDIF   
        IF LL1 =.T.
           THISFORM.PAGEFRAME1.PAGE1.SETALL('READONLY',.F.,'TEXTBOX')     &&處理表頭修改
           THISFORM.PAGEFRAME1.PAGE1.TXTF01.READONLY=.T.
           THISFORM.PAGEFRAME1.PAGE1.TXTF10.READONLY=.F.
           THISFORM.PAGEFRAME1.PAGE2.ENABLED=.F.
           THISFORM.PAGEFRAME1.PAGE1.TXTF10.SETFOCUS
        ELSE 
           DO file_impact
           UNLOCK ALL
           THISFORM.SHRGROUP.ABANDON_BOTT.CLICK
        endif   
     ELSE                         
        SELE C38                                                      &&處理表身修改
        IF RLOCK('C38') 
           THISFORM.PAGEFRAME1.PAGE2.SETALL('READONLY',.F.,'TEXTBOX') 
           THISFORM.PAGEFRAME1.PAGE2.TXTF03.READONLY=.T.
           THISFORM.PAGEFRAME1.PAGE2.TXTF05.READONLY=.F.
           THISFORM.PAGEFRAME1.PAGE2.TXTF79.READONLY=.F.
           THISFORM.PAGEFRAME1.PAGE2.TXTF05.SETFOCUS
        ELSE  
           DO file_impact 
           unlock all
           THISFORM.SHRGROUP.ABANDON_BOTT.CLICK           
       endif        
     ENDIF   
     RELEASE ALL LIKE BK*
  ENDPROC    
  PROC ORPGROUP.DEL_BOTT.CLICK                    &&刪除資料程序
       IF messagebox('是否確定要刪除此筆資料',4+32+256,'請確認') = 6	        
          if ALIA()='C38_1'           &&刪除整張訂單
             SELE C38_1             
                PO_NO=C38_1.F01
                SELE RECNO() FROM C38 WHERE C38.F01=PO_NO  AND C38.F07<>'2' INTO ARRAY BK1              
                JJ1=''                
                IF _TALLY>0   
                   FOR I= 1 TO ALEN(BK1)
                       JJ1=JJ1+ALLTRIM(STR(BK1(I)))+','
                   ENDFOR    
                   KK1=STUFF(JJ1,RAT(',',JJ1,1),1,'')              
                   RLOCK(KK1,'C38')
                   LL1=RLOCK(KK1,'C38')
                ELSE
                   LL1=.T.   
                ENDIF                   
                IF LL1=.T. AND RLOCK('C38_1')       
                   DELE FROM C38 WHERE C38.F01=PO_NO
                   SELE B39                     &&刪除未過帳單據紀錄
                   SEEK A02.F03+C38_1.F01                   
                   IF FOUND()
                      DELE
                   ENDIF   
                   SELE C38_1
                   DELE
                   UNLOCK ALL
                   IF INT_099=.T. .AND. SUBSTR(PO_NO,3,4)=SUBSTR(DTOS(CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/01')),3,4)
                      HD=HD1+SUBSTR(DTOS(CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/01')),3,4)+PO_NO
                      DO ODR_RJT
                   ENDIF  
                ELSE
                   DO file_impact                  
                ENDIF             
             THISFORM.GRID1.SETFOCUS
             IF THISFORM.GRID1.ACTIVEROW=0
                THISFORM.CMDGROUP.ENABLED=.F.
                THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
                THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.               
                THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
                THISFORM.ANS_BOTT.ENABLED=.F.
             ELSE      
                THISFORM.CMDGROUP.ENABLED=.T.
                THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  .AND. C38_1.F07>'2' &&判斷有無修改的權限
                THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)   .AND. C38_1.F07<>'2' &&判斷有無刪除的權限
                THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限
             ENDIF 
                THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.);
    	 	  .AND. !IIF(SEEK(DTOS(CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/01')),'A23','A231'),A23.F07,.F.)        
          ELSE        
              SELE C38                                                      &&刪除單筆資料  
              IF RLOCK('C38')       
                  SELE C38
                  DELE
                  SKIP -1
                  IF BOF()
                     GO TOP
                  ENDIF   
              ELSE
                 DO file_impact                  
              ENDIF     
              THISFORM.GRID2.SETFOCUS
              IF THISFORM.GRID2.ACTIVEROW=0         &&如果單身被刪空
                 SELE B39                           &&刪除未過帳單據紀錄       
                 SEEK A02.F03+C38_1.F01
                 IF FOUND()
                    DELE
                 ENDIF                    
                 SELE C38_1                        
                 PO_NO=C38_1.F01                    
                 DELE                               &&連表頭也要刪除
                 IF INT_099=.T. .AND. SUBSTR(PO_NO,3,4)=SUBSTR(DTOS(CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/01')),3,4)
                    HD=HD1+SUBSTR(DTOS(CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/01')),3,4)+PO_NO
                    DO ODR_RJT
                 ENDIF
                 SELE C38_1
                 SKIP -1
                 IF BOF()
                    GO TOP
                 ENDIF   
                 THISFORM.PAGEFRAME1.ACTIVEPAGE=1 
                 THISFORM.REFRESH          
              ENDIF
          ENDIF
       ENDIF
       RELEASE ALL LIKE BK*   
  ENDPROC  
  PROCEDURE SHRGROUP.SHURE1_BOTT.CLICK               &&新增確認
    IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
       THISFORM.GRID2.RECORDSOURCE='C38'
       THISFORM.GRID2.CHILDORDER=C381
	   THISFORM.grid2.COLUMN1.CONTROLSOURCE='C38.F03'	   
	   THISFORM.GRID2.COLUMN2.CONTROLSOURCE="IIF(INT_029,C38.F79,B01.F02)"
	   THISFORM.grid2.COLUMN3.CONTROLSOURCE="IIF(SEEK(C38.F05,'A14'),A14.F02,'')"
	   THISFORM.grid2.COLUMN4.CONTROLSOURCE='C38.F04'
	   THISFORM.grid2.COLUMN5.CONTROLSOURCE='B11.F04'
	   THISFORM.grid2.COLUMN6.CONTROLSOURCE='C38.F15'       
       SELE C38_1 
       COD=SYS(21)
       SET ORDER TO 1
       IF SEEK(THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE,'C38')=.T.     &&如果單據編號重複 
          SELECT MAX(F01) FROM C38 INTO ARRAY GB NOWAIT
          HD=HD1+SUBSTR(DTOS(CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/01')),3,4)+THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
          DO ODR_RPT
          THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=PO_NO
	      THISFORM.PAGEFRAME1.PAGE1.TXTF01.REFRESH               
       ENDIF
       IF SEEK(THISFORM.PAGEFRAME1.PAGE1.TXTF10.VALUE,'C01')=.F. .OR. EMPTY(THISFORM.PAGEFRAME1.PAGE1.TXTF10.VALUE)
          =MESSAGEBOX('無此客戶編號請先建立!',0+64,'提示訊息視窗')
          THISFORM.PAGEFRAME1.PAGE1.TXTF10.SETFOCUS
          SET ORDER TO &COD
          RETURN            
       ENDIF       
       IF EMPTY(CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/'+THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE))                    
          =MESSAGEBOX('領用日期輸入錯誤!',0+64,'提示訊息視窗') 
          THISFORM.PAGEFRAME1.PAGE1.TXTF02.SETFOCUS
          SET ORDER TO &COD          
          RETURN
       ENDIF   
       IF LEN(ALLTRIM(THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE))<>2
          =MESSAGEBOX('領用日期輸入錯誤!',0+64,'提示訊息視窗') 
          THISFORM.PAGEFRAME1.PAGE1.TXTF02.SETFOCUS
          SET ORDER TO &COD          
          RETURN       
       ENDIF
       SELE C38_1          
       APPEND BLANK
       LOCK()
       IF RLOCK()
          REPLACE F01 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
          REPLACE F02 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE
          REPLACE F10 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF10.VALUE
          REPLACE F15 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
       ENDIF   
*       UNLOCK
       SEEK THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
       SET ORDER TO &COD
       SELE B39
       APPEND BLANK
       REPL F01 WITH A02.F03
       REPL F02 WITH C38_1.F01
       REPL F03 WITH C38_1.F02
       REPL F04 WITH C38_1.F10
       THISFORM.PAGEFRAME1.PAGE1.ENABLED=.F.
       THISFORM.PAGEFRAME1.PAGE2.ENABLED=.T.  
       THISFORM.PAGEFRAME1.ACTIVEPAGE=2
       THISFORM.ORPGROUP.NEW_BOTT.CLICK
       THISFORM.REFRESH
    ELSE
       IF SEEK(THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE,'B01')=.F. OR EMPTY(THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE)
          =MESSAGEBOX('物料基本主檔中無此料號!',0+48,'提示訊息視窗')          
          THISFORM.PAGEFRAME1.PAGE2.TXTF03.SETFOCUS
          RETURN
       ENDIF        
       IF SEEK(THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE,'C38')=.T.           
          =MESSAGEBOX('此料號在此張領用單重複!',0+48,'提示訊息視窗')
          THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=''
          THISFORM.PAGEFRAME1.PAGE2.TXTF03.REFRESH
          THISFORM.PAGEFRAME1.PAGE2.TXTF03.SETFOCUS
          RETURN            
       ENDIF 
       IF SEEK(THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE,'A14')=.F. .OR. EMPTY(THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE)
          =MESSAGEBOX('工作部門主檔中無此編號請先建立!',0+64,'提示訊息視窗')
          THISFORM.PAGEFRAME1.PAGE2.TXTF05.SETFOCUS
          RETURN            
       ENDIF      
       IF THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE <= 0
          =MESSAGEBOX('領用數量不得小於等於零!',0+48,'提示訊息視窗')          
          THISFORM.PAGEFRAME1.PAGE2.TXTF04.SETFOCUS
          RETURN
       ENDIF 
       IF (THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE * IIF(SEEK(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE),'B01'),B01.F37,0)) >= INT_213 AND INT_213 > 0
          =MESSAGEBOX('此料品之領用數量已超過系統設定之金額 '+ ALLTRIM(STR(INT_213)) +' 元!',0+48,'提示訊息視窗')    
          IF INT_213 >= 0
             THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE = 0
          ENDIF      
          THISFORM.PAGEFRAME1.PAGE2.TXTF04.SETFOCUS
          RETURN
       ENDIF 
       IF EMPTY(THISFORM.PAGEFRAME1.PAGE2.TXTF08.VALUE)
          =MESSAGEBOX('備註說明不得為空白',0+48,'提示訊息視窗')           
          THISFORM.PAGEFRAME1.PAGE2.TXTF08.SETFOCUS
          RETURN
       ENDIF 
       SELE B39
       SEEK 'C38' + THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
       IF FOUND()                
          REPLACE B39.F05 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE
          REPLACE B39.F06 WITH ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.LBLF051.CAPTION)
       ENDIF
       SELE C38
       APPEND BLANK
       LOCK()
       IF RLOCK()
          REPLACE F01 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
          REPLACE F02 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE
          REPLACE F03 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE
          REPLACE F04 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE
          REPLACE F05 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE
          REPLACE F08 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF08.VALUE
          REPLACE F10 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF10.VALUE
          REPLACE F15 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
          REPLACE F79 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF79.VALUE
       ENDIF
       UNLOCK ALL         
       SEEK THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE
       THISFORM.GRID2.ENABLED=.T.
       THISFORM.GRID2.SETFOCUS  
       THISFORM.ORPGROUP.NEW_BOTT.CLICK      
    ENDIF  
  ENDPROC
  PROCEDURE SHRGROUP.SHURE2_BOTT.CLICK                          &&修改確認
     IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
       IF EMPTY(CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/'+THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE))          
          =MESSAGEBOX('領用日期輸入錯誤!',0+64,'提示訊息視窗') 
          THISFORM.PAGEFRAME1.PAGE1.TXTF02.SETFOCUS
          RETURN
        ENDIF           
       
       IF LEN(ALLTRIM(THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE))<>2
          =MESSAGEBOX('領用日期輸入錯誤!',0+64,'提示訊息視窗') 
          THISFORM.PAGEFRAME1.PAGE1.TXTF02.SETFOCUS
                 
          RETURN       
       ENDIF
           SELE C38
           SEEK C38_1.F01
           IF FOUND()
              DO WHILE F01=C38_1.F01
                 REPL F02 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE
                 REPL F15 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')                 
                 REPL F10 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF10.VALUE
                 SKIP
              ENDDO    
           ENDIF        
        SELE C38_1
           REPL F02 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE
           REPL F10 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF10.VALUE
           REPL F15 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
           UNLOCK ALL
     ELSE                                                        &&表身修改確認     
       IF SEEK(THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE,'A14')=.F. .OR. EMPTY(THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE)
          =MESSAGEBOX('工作部門主檔中無此編號請先建立!',0+64,'提示訊息視窗')
          THISFORM.PAGEFRAME1.PAGE2.TXTF05.SETFOCUS
          RETURN            
       ENDIF    
       IF THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE = 0
          =MESSAGEBOX('領用數量不得小於等於零!',0+48,'提示訊息視窗')           
          THISFORM.PAGEFRAME1.PAGE2.TXTF04.SETFOCUS
          RETURN
       ENDIF    
       IF (THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE * IIF(SEEK(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE),'B01'),B01.F37,0)) >= INT_213 AND INT_213 > 0
          =MESSAGEBOX('此料品之領用數量已超過系統設定之金額 '+ ALLTRIM(STR(INT_213)) +' 元!',0+48,'提示訊息視窗')    
          IF INT_213 >= 0
             THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE = 0
          ENDIF      
          THISFORM.PAGEFRAME1.PAGE2.TXTF04.SETFOCUS
          RETURN
       ENDIF  
       IF EMPTY(THISFORM.PAGEFRAME1.PAGE2.TXTF08.VALUE)
          =MESSAGEBOX('備註說明不得為空白',0+48,'提示訊息視窗')           
          THISFORM.PAGEFRAME1.PAGE2.TXTF08.SETFOCUS
          RETURN
       ENDIF        
       IF THISFORM.PAGEFRAME1.PAGE2.TXTF79.VALUE<>THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE   &&如果單上料號與實際料號不同再做料號正確與否判斷
          IF !SEEK(THISFORM.PAGEFRAME1.PAGE2.TXTF79.VALUE,'B01') 
              =MESSAGEBOX('物料主檔中無此編號請重新輸入或維持原料號!',0+48,'提示訊息視窗')
             THISFORM.PAGEFRAME1.PAGE2.TXTF79.SETFOCUS
             RETURN            
          ENDIF
       ENDIF
       SELE C38                    
       REPLACE F03 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE
       REPLACE F04 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE  
       REPLACE F05 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE    
       REPLACE F08 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF08.VALUE
       REPLACE F15 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')  
       REPLACE F79 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF79.VALUE                    
       UNLOCK ALL
    ENDIF   
    THISFORM.SHRGROUP.ABANDON_BOTT.CLICK    
  ENDPROC   
  PROCEDURE SHRGROUP.ABANDON_BOTT.CLICK
      THISFORM.SHRGROUP.ENABLED=.F.
      THISFORM.SHRGROUP.VISIBLE=.F.      
      THISFORM.ORPGROUP.ENABLED=.T.
      THISFORM.ORPGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
      THISFORM.CMDGROUP.ENABLED=.T.
      THISFORM.CMDGROUP.SETALL('ENABLED',.T.,'COMMANDBUTTON')
      THISFORM.CMDGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
      THISFORM.SETALL('READONLY',.T.,'TEXTBOX')  
      THISFORM.PAGEFRAME1.PAGE1.SETALL('READONLY',.T.,'TEXTBOX')  
      THISFORM.PAGEFRAME1.PAGE2.SETALL('READONLY',.T.,'TEXTBOX')  
      THISFORM.PAGEFRAME1.PAGE2.TXTF05.READONLY=.T.
      THISFORM.PAGEFRAME1.PAGE1.TXTF10.READONLY=.T.  
      THISFORM.PAGEFRAME1.PAGE2.TXTF03.READONLY=.T.   
      THISFORM.PAGEFRAME1.PAGE2.TXTF79.READONLY=.T.
      THISFORM.PAGEFRAME1.PAGE1.ENABLED=.T.
      THISFORM.PAGEFRAME1.PAGE2.ENABLED=.T.
      IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1         
         THISFORM.grid1.ENABLED=.T.
         THISFORM.grid2.ENABLED=.T.
         THISFORM.GRID1.SETFOCUS
         THISFORM.KEY_LIST.ENABLED=.T.
         THISFORM.MTH_LIST.ENABLED=.T.      
      ELSE
         THISFORM.GRID1.ENABLED=.F.
         THISFORM.GRID2.ENABLED=.T.
         THISFORM.GRID2.SETFOCUS
         IF THISFORM.GRID2.ACTIVEROW=0         
            HD=HD1+SUBSTR(DTOS(CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/01')),3,4)+PO_NO
            DO ODR_RJT              
            SELE B39
            SEEK A02.F03+C38_1.F01
            SET ORDER TO 1
            IF FOUND()
               DELE            
            ENDIF   
            SELE C38_1
            DELE
            THISFORM.PAGEFRAME1.ACTIVEPAGE=1
            THISFORM.REFRESH  
         ENDIF   
      ENDIF       
      UNLOCK ALL
  ENDPROC
  PROCEDURE SHRGROUP.FINISH_BOTT.CLICK
      IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
         IF THISFORM.GRID2.RECORDSOURCE<>'C38'
            THISFORM.GRID2.RECORDSOURCE='C38'
            THISFORM.GRID2.CHILDORDER=C381
  	        THISFORM.grid2.COLUMN1.CONTROLSOURCE='C38.F03'
	        THISFORM.grid2.COLUMN2.CONTROLSOURCE="IIF(SEEK(ALLTRIM(C38.F03),'B01'),B01.F02,'')"
	        THISFORM.grid2.COLUMN3.CONTROLSOURCE="IIF(SEEK(C38.F05,'A14'),A14.F02,'')"
	        THISFORM.grid2.COLUMN4.CONTROLSOURCE='C38.F04'
	        THISFORM.grid2.COLUMN5.CONTROLSOURCE='B11.F04'
	        THISFORM.grid2.COLUMN6.CONTROLSOURCE='C38.F15'         
	     ENDIF   
	     IF INT_099=.T.
            HD=HD1+SUBSTR(DTOS(CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/01')),3,4)+PO_NO
            DO ODR_RJT
         ENDIF   
         SELE C38_1
         DO CASE 
            CASE THISFORM.KEY_LIST.DISPLAYVALUE='依領用單號排列'
                 SET ORDER TO 1
            CASE THISFORM.KEY_LIST.DISPLAYVALUE='依領用客戶排列'
                 SET ORDER TO 2
         ENDCASE   
       ENDIF  
       THISFORM.SHRGROUP.ABANDON_BOTT.CLICK
  ENDPROC     
  PROC ANS_BOTT.CLICK     &&過帳程序
       IF MESSAGEBOX('是否確認資料無誤可以過帳?',4+32+256,'請確認') = 6	 
          SELE RECNO() FROM C38 WHERE C38.F01=C38_1.F01  AND F07<>'2' INTO ARRAY BK1              
          JJ1=''                
          IF _TALLY>0   
             FOR I= 1 TO ALEN(BK1)
                 JJ1=JJ1+ALLTRIM(STR(BK1(I)))+','
             ENDFOR    
             KK1=STUFF(JJ1,RAT(',',JJ1,1),1,'')              
             RLOCK(KK1,'C38')
             LL1=RLOCK(KK1,'C38')
          ELSE
             LL1=.T.   
          ENDIF  
          IF LL1=.T. 
             IF LEN(ALLTRIM(JJ1))>0 
                SELE C38
                FOR I= 1 TO ALEN(BK1)                      
                    GO BK1(I) 
                    SELE B11                                            &&部門庫存明細檔 
                    SEEK C38.F05+C38.F79+IIF(INT_028,C38.F10,SPACE(5))                                 &&轉出部門庫存明細 
                    IF FOUND()
                       REPL F04 WITH F04+(C38.F04)*(-1)
                       IF F04=0
                          DELE
                       ELSE   
                          IF F05<CTOD((THISFORM.MTH_LIST.DISPLAYVALUE+'/'+C38.F02))
                             REPL F05 WITH CTOD((THISFORM.MTH_LIST.DISPLAYVALUE+'/'+C38.F02))
                          ENDIF
                       ENDIF   
                    ELSE
                       APPEND BLANK
                       REPL F01 WITH C38.F05
                       REPL F03 WITH C38.F79
                       REPL F04 WITH (C38.F04)*(-1)
                       REPL F05 WITH CTOD((THISFORM.MTH_LIST.DISPLAYVALUE+'/'+C38.F02))
                       IF INT_028
                          REPLACE F08 WITH C38.F10
                       ENDIF
                    ENDIF   
                    *******
                    SELE B25                                             &&分部門庫存月報表 
                    SEEK C38.F05+C38.F79
                    IF FOUND()                                                     &&轉出部門報表
                       REPL F17 WITH F17+C38.F04
                       REPL F15 WITH F15+(C38.F04)*(-1)
                    ELSE
                       APPEND BLANK
                       REPL F01 WITH C38.F05
                       REPL F02 WITH C38.F79
                       REPL F17 WITH C38.F04
                       REPL F15 WITH (C38.F04)*(-1)                                                  
                    ENDIF   
                    SELE B26                                            &&庫存異動紀錄
                    APPEND BLANK                                               &&轉出  
                    REPL F01 WITH C38.F79                             
                    REPL F02 WITH C38.F05
                    REPL F03 WITH C38.F02
                    REPL F04 WITH C38.F04*(-1)
                    REPL F06 WITH 'Z'
                    REPL F07 WITH C38.F01           
                    REPL F08 WITH C38.F10+SPACE(2)+IIF(SEEK(C38.F10,'C01'),C01.F05,'')                             
                    SELE C39                                         &&樣品領用紀錄檔
                    APPEND BLANK
                    REPL F01 WITH C38.F10
                    REPL F02 WITH C38.F79
                    REPL F03 WITH CTOD((THISFORM.MTH_LIST.DISPLAYVALUE+'/'+C38.F02))
                    REPL F04 WITH C38.F01
                    REPL F05 WITH C38.F04  
                    REPL F06 WITH IIF(SEEK(C38.F10,'C01'),IIF(INT_209 = 'A',C01.F18,C01.F33),'') 
                    REPL F07 WITH C38.F08 
                    REPL F08 WITH C38.F08 
                    REPL F09 WITH C38.F05
                    REPL F10 WITH IIF(SEEK(C38.F10,'C01'),C01.F23,'')
                    REPL F99 WITH C38.F15                                                
                    SELE C38
                    REPL F07 WITH '2'
                    REPL F90 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
                 ENDFOR   
                 SELE B39                    &&未過帳庫存單據查詢檔
                 SEEK A02.F03+C38_1.F01
                  IF FOUND()
                     DELE
                  ENDIF                                             
                  SELE C38_1
                  REPL F07 WITH '2'
                  REPL F90 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
             ELSE
                =MESSAGEBOX('此單據已由別的工作站過帳完成',0+64,'提示訊息視窗')
                SELE C38_1
                REPL F07 WITH '2'
             ENDIF           
             THIS.ENABLED=.F.
             THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
             THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.             
             UNLOCK ALL
             IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
                THISFORM.GRID1.SETFOCUS
             ELSE
                 THISFORM.GRID2.SETFOCUS
                 THISFORM.ORPGROUP.NEW_BOTT.ENABLED=.F.
             ENDIF
             THISFORM.REFRESH
          ELSE
            DO file_impact
            unlock all
            return
          ENDIF   
          unlock all
         RELEASE ALL LIKE BK*
      ENDIF      
  ENDPROC
 ************************************反過帳
   PROC VRT_BOTT.CLICK     &&反過帳程序
       IF MESSAGEBOX('是否確認資料無誤可以反過帳?',4+32+256,'請確認') = 6	 
          SELE RECNO() FROM C38 WHERE C38.F01=C38_1.F01  AND F07='2' INTO ARRAY BK1              
          JJ1=''                
          IF _TALLY>0   
             FOR I= 1 TO ALEN(BK1)
                 JJ1=JJ1+ALLTRIM(STR(BK1(I)))+','
             ENDFOR    
             KK1=STUFF(JJ1,RAT(',',JJ1,1),1,'')              
             RLOCK(KK1,'C38')
             LL1=RLOCK(KK1,'C38')
          ELSE
             LL1=.T.   
          ENDIF  
          IF LL1=.T. 
             IF LEN(ALLTRIM(JJ1))>0 
                SELE C38
                FOR I= 1 TO ALEN(BK1)                      
                    GO BK1(I) 
                    SELE B11                                            &&部門庫存明細檔 
                    SEEK C38.F05+C38.F79+IIF(INT_028,C38.F10,SPACE(5))                                 &&轉出部門庫存明細 
                    IF FOUND()
                       REPL F04 WITH F04+(C38.F04)
                       IF F04=0
                          DELE
                       ELSE   
                          IF F05<CTOD((THISFORM.MTH_LIST.DISPLAYVALUE+'/'+C38.F02))
                             REPL F05 WITH CTOD((THISFORM.MTH_LIST.DISPLAYVALUE+'/'+C38.F02))
                          ENDIF
                       ENDIF   
                    ELSE
                       APPEND BLANK
                       REPL F01 WITH C38.F05
                       REPL F03 WITH C38.F79
                       REPL F04 WITH (C38.F04)
                       REPL F05 WITH CTOD((THISFORM.MTH_LIST.DISPLAYVALUE+'/'+C38.F02))
                       IF INT_028
                          REPLACE F08 WITH C38.F10
                       ENDIF
                    ENDIF   
                    *******
                    SELE B25                                             &&分部門庫存月報表 
                    SEEK C38.F05+C38.F79
                    IF FOUND()                                                     &&轉出部門報表
                       REPL F17 WITH F17+C38.F04*(-1)
                       REPL F15 WITH F15+(C38.F04)
                    ELSE
                       APPEND BLANK
                       REPL F01 WITH C38.F05
                       REPL F02 WITH C38.F79
                       REPL F17 WITH C38.F04*(-1)
                       REPL F15 WITH (C38.F04)                                                 
                    ENDIF   
                 
                    SELE C38
                    REPL F07 WITH ''
                    REPL F90 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
                 ENDFOR   
                 SELECT B26
                 DELETE FROM B26 WHERE F07=C38_1.F01
                 SELE C39                                         &&樣品領用紀錄檔
                 DELETE FROM C39 WHERE F04=C38_1.F01
                 SELE B39                    &&未過帳庫存單據查詢檔
                 APPEND BLANK
                 REPLACE F01 WITH 'C38'
                 REPLACE F02 WITH C38_1.F01
                 REPLACE F03 WITH C38_1.F02
                 REPLACE F04 WITH C38_1.F10
                 REPLACE F05 WITH C38.F05
                 REPLACE F06 WITH IIF(SEEK(F05,'A14'),A14.F02,'')
                 REPLACE F10 WITH '反過帳'         
                  SELE C38_1
                  REPL F07 WITH ''
                  REPL F90 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
             ELSE
                =MESSAGEBOX('此單據已由別的工作站過帳完成',0+64,'提示訊息視窗')
                SELE C38_1
                REPL F07 WITH ''
             ENDIF           
             THIS.ENABLED=.F.
             THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
             THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.             
             UNLOCK ALL
             IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
                THISFORM.GRID1.SETFOCUS
             ELSE
                 THISFORM.GRID2.SETFOCUS
                 THISFORM.ORPGROUP.NEW_BOTT.ENABLED=.F.
             ENDIF
             THISFORM.REFRESH
          ELSE
            DO file_impact
            unlock all
            return
          ENDIF   
          unlock all
         RELEASE ALL LIKE BK*
      ENDIF      
  ENDPROC

 ***********************************
  PROC EXCEL_BOTT.CLICK
       PO_NO=C38_1.F01
       EXL_OPT=CREATEOBJECT("EXL_OPT")  
       EXL_OPT.SHOW          
       SELECT C38_1                        
       THISFORM.GRID1.SETFOCUS
  ENDPROC     
enddefine    
**************************************************
DEFINE CLASS EXL_OPT AS FORM
  AUTOCENTER=.T.
  CAPTION='請選擇列印內容'
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*105
  WIDTH=INT_015*230
  FONTSIZE=INT_015*9
  MAXBUTTON=.F.
  MINBUTTON=.F.
  MOVABLE=.F.
  CLOSABLE=.F.    
  CONTROLBOX=.F.
  BORDERSTYLE=2
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WINDOWTYPE=1
  NAME='ANS_CHK'
  ADD OBJECT DATA_OPTION AS OPTIONGROUP WITH;
      LEFT=INT_015*17,;
      TOP=INT_015*20,;
      AUTOSIZE=.T.,;
      FONTSIZE=INT_015*12,;
      BUTTONCOUNT=3,;
      OPTION1.CAPTION='目前紀錄',;
      OPTION1.TOP=INT_015*0,;
      OPTION1.FONTSIZE=INT_015*9,;
      OPTION1.AUTOSIZE=.T.,;
      OPTION2.CAPTION='未過帳紀錄',;
      OPTION2.TOP=INT_015*20,;
      OPTION2.FONTSIZE=INT_015*9,;
      OPTION2.AUTOSIZE=.T.,;      
      OPTION3.CAPTION='已過帳紀錄',;
      OPTION3.TOP=INT_015*40,;
      OPTION3.FONTSIZE=INT_015*9,;
      OPTION3.AUTOSIZE=.T.,;
      NAME='DATA_OPTION'   
  ADD OBJECT CMND1 AS COMMANDBUTTON WITH;
      LEFT=INT_015*165,;     
      TOP=INT_015*20,;  
      HEIGHT=INT_015*25,;    
      WIDTH=INT_015*50,;
      FONTSIZE=INT_015*9,;
      CAPTION='\<Y.確定',;
      TOOLTIPTEXT='確認所選擇的鍵值!快速鍵->ALT+Y',;
      NAME='CMND1'
  ADD OBJECT CMND2 AS COMMANDBUTTON WITH;
      LEFT=INT_015*165,;
      TOP=INT_015*60,;
      HEIGHT=INT_015*25,;    
      WIDTH=INT_015*50,;
      FONTSIZE=INT_015*9,;
      CAPTION='\<C.取消',;
      TOOLTIPTEXT='取消作業!快速鍵->ALT+C',;
      NAME='CMND2'     
  *****   
  PROCEDURE CMND1.CLICK   
        IF THISFORM.DATA_OPTION.VALUE=1
           FILENAME=PO_NO
           SELECT C38.F01 領用單號,C38.F02 領用日期,C38.F05 發料單位,C38.F10 客戶編號,C01.F05 客戶簡稱,;
           C38.F79 領用料號,C38.F04 領用數量,B01.F37 成本單價;
           FROM C38,C01,B01 WHERE C38.F01=PO_NO AND C01.F01=C38.F10 AND B01.F01=C38.F79 ;
           INTO CURSOR C38_K ORDER BY C38.F01,C38.F79 NOWAIT
        ELSE
           FILENAME='20'+SUBSTR(PO_NO,3,4)+'樣品領用單'+IIF(THISFORM.DATA_OPTION.VALUE=2,'未過帳','已過帳')
           SELECT C38.F01 領用單號,C38.F02 領用日期,C38.F05 發料單位,C38.F10 客戶編號,C01.F05 客戶簡稱,;
           C38.F79 領用料號,C38.F04 領用數量,B01.F37 成本單價;
           FROM C38,C01,B01 WHERE C38.F07=IIF(THISFORM.DATA_OPTION.VALUE=3,'2',SPACE(1)) AND C01.F01=C38.F10 AND B01.F01=C38.F79 ;
           INTO CURSOR C38_K ORDER BY C38.F01,C38.F79 NOWAIT
        ENDIF
        IF _TALLY>0
		   GCDELIMFILE=PUTFILE('儲存路徑',FILENAME,'XLS')
		   IF !EMPTY(GCDELIMFILE) 
		      ON ERROR DO FILE_IMPACT
		      COPY TO (GCDELIMFILE) TYPE XL5     
		       =MESSAGEBOX('儲存成功',0+48,'提示訊息視窗') 
		   ENDIF     
        ELSE
              =MESSAGEBOX('無此範圍資料!',0+48,'提示訊息視窗')
        ENDIF		  
        SELECT C38_K
        USE
        THISFORM.CMND2.CLICK                        
  ENDPROC  
******
  PROCEDURE CMND2.CLICK
      THISFORM.RELEASE
  ENDPROC      
ENDDEFINE  
***********************************************列印程序
PROCEDURE PNT_PRC  
     LK=C38_1.F01     
     HK=IIF(INT_012=1,ALLTRIM(STR(YEAR(A23.F01)-1911))+SUBSTR(DTOC(A23.F01),3,3),LEFT(dtoc(A23.F01),5))
     SELECT C38.F01,;
            C38.F02,;
            C38.F03,;
            C38.F04,;                    
            C38.F05,;
            C38.F08,;
            C38.F10,;
            B01.F02,;            
            A14.F02,;
            C01.F04;
     FROM C38,B01,A14,C01 WHERE C38.F01=LK AND B01.F01=C38.F03 AND A14.F01=C38.F05 AND C01.F01=C38.F10 ORDER BY C38.F03 NOWAIT
     IF _tally >0
*        REPORT FORM C38 PREVIEW to print prompt 
         report form ALLTRIM(INT_116)+'C38' TO PRINT PROMPT 
     ENDIF  
     CLEAR
ENDPROC
************************************************特殊輸入欄位的設定----料號
DEFINE CLASS TXTF03 AS TEXTBOX
  READONLY=.T.
  MAXLENGTH=43
  FONTSIZE=INT_015*9
  PROCEDURE INTERACTIVECHANGE
    IF AT('?',ALLTRIM(THIS.VALUE))<>0
       IF AT('?',ALLTRIM(THIS.VALUE))>1             
          SELECT F01,F02 FROM B01 INTO CURSOR MTR ORDER BY F01 WHERE !EMPTY(F98) AND LEFT(F01,AT('?',THIS.VALUE)-1)=LEFT(THIS.VALUE,AT('?',THIS.VALUE)-1)    
       ELSE
          SELECT F01,F02 FROM B01 INTO CURSOR MTR ORDER BY F01 WHERE !EMPTY(F98)   
       ENDIF        
       IF _TALLY>0
          MTR_SEEK=createobject("MTR_SEEK")  
          MTR_SEEK.SHOW    
          THIS.VALUE=FLG
          THIS.REFRESH
          FLG='0'     
       ENDIF          
    ENDIF  
       THISFORM.PAGEFRAME1.PAGE2.LBLF031.CAPTION=IIF(SEEK(THIS.VALUE,'B01'),B01.F02,'')  
       THISFORM.PAGEFRAME1.PAGE2.TXTF79.VALUE=THIS.VALUE
       IF !EMPTY(THISFORM.PAGEFRAME1.PAGE2.LBLF031.CAPTION) AND !EMPTY(THIS.VALUE)
           THISFORM.PAGEFRAME1.PAGE2.TXTF05.SETFOCUS
       ENDIF 
  ENDPROC
ENDDEFINE 
***************************************************特殊輸入欄位設定-----------客戶
DEFINE CLASS TXTF10 AS TEXTBOX
  READONLY=.T.
  MAXLENGTH=5
  FONTSIZE=INT_015*9
  PROCEDURE INTERACTIVECHANGE
    IF AT('?',ALLTRIM(THIS.VALUE))<>0 
       IF AT('?',ALLTRIM(THIS.VALUE))>1             
          SELECT F02,F01,F04 FROM C01 INTO CURSOR VDR ORDER BY F02 WHERE LEFT(F02,AT('?',THIS.VALUE)-1)=LEFT(THIS.VALUE,AT('?',THIS.VALUE)-1)
       ELSE
          SELECT F02,F01,F04 FROM C01 INTO CURSOR VDR ORDER BY F02 
       ENDIF
       IF _TALLY>0          
          VDR_SEEK=createobject("VDR_SEEK")  
          VDR_SEEK.SHOW    
          THIS.VALUE=FLG
          THIS.REFRESH
          FLG='0'        
       ENDIF   
    ELSE
       IF LEN(ALLTRIM(THIS.VALUE))=4
          SELECT F02,F01,F04 FROM C01 INTO CURSOR VDR ORDER BY F02 WHERE F02=ALLTRIM(THIS.VALUE)
          DO CASE
             CASE _TALLY=1
                  THIS.VALUE=VDR.F01
                  THIS.REFRESH
             CASE _TALLY>1
                  VDR_SEEK=createobject("VDR_SEEK")  
                  VDR_SEEK.SHOW    
                  THIS.VALUE=FLG
                  THIS.REFRESH
                  FLG='0'        
          ENDCASE      
       ENDIF    
    ENDIF      
       THISFORM.PAGEFRAME1.PAGE1.LBLF101.CAPTION=IIF(SEEK(THIS.VALUE,'C01'),C01.F04,'')  

  ENDPROC
ENDDEFINE
****************************************************  &&實際料號
DEFINE CLASS TXTF79 AS TEXTBOX
      READONLY=.T.
      MAXLENGTH=43
  FONTSIZE=INT_015*9
       PROCEDURE INTERACTIVECHANGE     
       IF AT('?',ALLTRIM(THIS.VALUE))<>0
          IF AT('?',ALLTRIM(THIS.VALUE))>1             
             SELECT F01,F02 FROM B01 INTO CURSOR MTR ORDER BY F01 WHERE !EMPTY(F98) AND LEFT(F01,AT('?',THIS.VALUE)-1)=LEFT(THIS.VALUE,AT('?',THIS.VALUE)-1)    
          ELSE
             SELECT F01,F02 FROM B01 INTO CURSOR MTR ORDER BY F01 WHERE !EMPTY(F98)   
          ENDIF        
          IF _TALLY>0
            
             MTR_SEEK=createobject("MTR_SEEK")  
             MTR_SEEK.SHOW                  
             THIS.VALUE=FLG
             THIS.REFRESH
             FLG='0'
                          
          ENDIF                                     
       ENDIF       
   ENDPROC  
ENDDEFINE   
***************************************************特殊欄位------------------轉出部門
DEFINE CLASS TXTF05 AS TEXTBOX
  READONLY=.T.
  MAXLENGTH=5 
  FONTSIZE=INT_015*9  
  PROCEDURE INTERACTIVECHANGE
    IF AT('?',ALLTRIM(THIS.VALUE))<>0
       IF AT('?',ALLTRIM(THIS.VALUE))>1  
          SELECT A14.F01,A14.F02 FROM A14 ORDER BY F01 WHERE LEFT(F01,AT('?',THIS.VALUE)-1)=LEFT(THIS.VALUE,AT('?',THIS.VALUE)-1) AND LEN(ALLTRIM(F01))=4 AND F04='*' INTO CURSOR DEPART READWRITE
       ELSE
          SELECT A14.F01,A14.F02 FROM A14 ORDER BY F01 WHERE LEN(ALLTRIM(F01))=4 AND F04='*' INTO CURSOR DEPART READWRITE
       ENDIF  
       ALTER TABLE DEPART ADD F4 N(14,4)
       ALTER TABLE DEPART ADD C20F03 C(30)
       SELECT B11.F01,B11.F04 FROM B11 WHERE B11.F03 = THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE ORDER BY B11.F01 INTO CURSOR INV 
       SELECT DEPART 
       INDE ON F01+ALLTRIM(STR(F4)) TAG DEPART1
       INDE ON ALLTRIM(STR(F4)) DESC TAG DEPART2
       SET ORDER TO DEPART1
       SELECT INV 
       GO TOP
       DO WHILE !EOF()
       	  SELECT DEPART 
       	  SEEK INV.F01
          IF FOUND()
             REPLACE DEPART.F4 WITH INV.F04
             REPLACE DEPART.C20F03 WITH IIF(SEEK(THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE,'C20'),C20.F03,'0')
          ENDIF
          SELECT INV
          SKIP   
       ENDDO
       SELECT INV
       USE
       SELECT DEPART
       SET ORDER TO DEPART2
       GO TOP
       IF _TALLY>0
          DEP_SEEK=createobject("DEP_SEEK")  
          DEP_SEEK.SHOW    
          THIS.VALUE=FLG
          THIS.REFRESH
          FLG='0'
       ENDIF 
       SELECT DEPART
       USE  
    ENDIF   
       THISFORM.PAGEFRAME1.PAGE2.LBLF051.CAPTION=IIF(SEEK(THIS.VALUE,'A14'),A14.F02,'')  
       IF !EMPTY(THISFORM.PAGEFRAME1.PAGE2.LBLF051.CAPTION) AND !EMPTY(THIS.VALUE)
           THISFORM.PAGEFRAME1.PAGE2.TXTF04.SETFOCUS
       ENDIF     
  ENDPROC
ENDDEFINE 
*************************************************************部門 
DEFINE CLASS DEP_SEEK AS FORM
*!*	  AUTOCENTER=.T.
  CAPTION='       查詢各部門庫存明細'
  TOP=INT_015*150
  LEFT=INT_015*200     
  HEIGHT=INT_015*250
  WIDTH=INT_015*300
  FONTSIZE=INT_015*9
  MOVABLE=.T.
  MAXBUTTON=.F.
  MINBUTTON=.F.     
  CONTROLBOX=.F.
  BORDERSTYLE=2
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WINDOWTYPE=1
  NAME='DEP_SEEK'
  ADD OBJECT GRID1 AS GRID WITH;          
      HIGHLIGHTROWLINEWIDTH=4,; 
      AUTOCENTER=.T.,;
      TOP=INT_015*0,;
      WIDTH=INT_015*300,;      
      HEIGHT=INT_015*220,;  
      ROWHEIGHT=INT_015*18,;
      HEADERHEIGHT=INT_015*18,;
      DELETEMARK=.F.,;
      READONLY=.T.,;
      RECORDSOURCETYPE=1,;
      COLUMNCOUNT=4,;            
      NAME='GRID1',;
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;  
      COLUMN3.NAME='COLUMN3',;    
      COLUMN4.NAME='COLUMN4'    
  ADD OBJECT CMND1 AS COMMANDBUTTON WITH;
      LEFT=INT_015*88,;
      TOP=INT_015*225,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;          
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\harrow.cur',;          
      CAPTION='\<S.選取',;
      TOOLTIPTEXT='選擇游標所指的紀錄!快速鍵->ALT+S'
      NAME='CMND1'         
  ADD OBJECT CMND2 AS COMMANDBUTTON WITH;
      LEFT=INT_015*128,;
      TOP=INT_015*225,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;          
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\harrow.cur',;          
      CAPTION='\<X.離開',;
      TOOLTIPTEXT='取消此搜尋畫面!快速鍵->ALT+X'
      NAME='CMND2'
      PROCEDURE INIT 
         THISFORM.GRID1.READONLY=.T. 
         THISFORM.GRID1.RECORDSOURCE='DEPART'
         THISFORM.SETALL('FONTSIZE',INT_015*9,'COLUMN')
         THISFORM.SETALL('FONTSIZE',INT_015*9,'HEADER')
         THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='部門編號'
         THISFORM.GRID1.COLUMN1.WIDTH=INT_015*56
         THISFORM.GRID1.COLUMN1.CONTROLSOURCE='DEPART.F01'
         THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='部門名稱'
         THISFORM.GRID1.COLUMN2.CONTROLSOURCE='DEPART.F02'
         THISFORM.GRID1.COLUMN2.WIDTH=INT_015*65
         THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='庫存數量'
         THISFORM.GRID1.COLUMN3.CONTROLSOURCE="IIF(!EMPTY(DEPART.F4),DEPART.F4,0)"
         THISFORM.GRID1.COLUMN3.WIDTH=INT_015*90     
         THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='包裝基量'
         THISFORM.GRID1.COLUMN4.CONTROLSOURCE="IIF(!EMPTY(DEPART.C20F03),DEPART.C20F03,'0')"
         THISFORM.GRID1.COLUMN4.WIDTH=INT_015*60           
         THISFORM.GRID1.SETFOCUS
         IF THISFORM.GRID1.ACTIVEROW<>0
              THISFORM.GRID1.AFTERROWCOLCHANGE 
         ENDIF         
      ENDPROC
      PROC GRID1.AFTERROWCOLCHANGE
       LPARAMETERS XCOLINDEX     
         FLG=DEPART.F01 
      ENDPROC 
      PROCEDURE CMND1.CLICK
         THISFORM.RELEASE
      ENDPROC
      PROCEDURE CMND2.CLICK
         FLG=''
         THISFORM.RELEASE
      ENDPROC      
ENDDEFINE 