**程式名稱:C05.出貨計劃
SET EXCL OFF
CLOSE ALL
CLEAR 
AREA1='C05'
FLG='0'
FCH=''
CHK=''
KF = ''
KF1 = ''
IF !USED('A01')
   SELE 0
   USE A01
ELSE 
   SELE A01
ENDIF
SET ORDER TO A01      
IF !USED('A02')
   SELE 0
   USE A02 INDE A02
ELSE
   SELE A02
ENDIF
SET ORDER TO A021      
CHA = IIF(SEEK(SYS_OPER+'C66','A02'),.T.,.F.)
SEEK SYS_OPER+'C05'   
IF !USED('A14')
   SELE 0
   USE A14
ELSE 
   SELE A14
ENDIF
SET ORDER TO A141         
IF !USED('B11')
   SELE 0
   USE B11
ELSE 
   SELE B11
ENDIF
SET ORDER TO B112      
IF !USED('C20')
   SELE 0
   USE C20
ELSE 
   SELE C20
ENDIF
SET ORDER TO 1      
IF !USED ('B01')
   SELE 0
   USE B01 
ELSE 
   SELE B01
ENDIF
SET ORDER TO B011
SET RELATION  TO F01+F07 INTO B11
IF !USED('E06')
     SELECT 0
     USE E06
ELSE
     SELECT E06
ENDIF
SET ORDER TO E061
IF !USED('E16')
     SELECT 0
     USE E16
ELSE
     SELECT E16
ENDIF
SET ORDER TO 1    
IF !USED('D00')
   SELE 0
   USE D00 
ELSE 
   SELE D00 
ENDIF
SET ORDER TO 1                
IF !USED('D01')
   SELE 0
   USE D01 
ELSE 
   SELE D01 
ENDIF
SET ORDER TO D011
IF !USED('C00')
   SELE 0
   USE C00 
ELSE 
   SELE C00 
ENDIF
SET ORDER TO 1
IF !USED('C01')
   SELE 0
   USE C01 
ELSE 
   SELE C01 
ENDIF
SET ORDER TO C011
IF !USED('C04')
   SELE 0
   USE C04 
ELSE 
   SELE C04 
ENDIF
SET ORDER TO C041
IF !USED('C03')
   SELE 0
   USE C03 
ELSE 
   SELE C03 
ENDIF
SET ORDER TO C031
IF !USED('C66')
   SELECT 0
   USE C66
ELSE 
   SELECT C66
ENDIF
SET ORDER TO C661
IF !USED('D07')
   SELE 0
   USE D07
ELSE
   SELE D07
ENDIF
SET ORDER TO D071

IF !USED('P05')
   SELE 0
   USE P05
ELSE 
   SELE P05
ENDIF
SET ORDER TO P051
IF !USED('D04')
   SELE 0
   USE D04
ELSE
   SELE D04
ENDIF
SET ORDER TO D041 
IF !USED('P04')
   SELE 0
   USE P04
ELSE
   SELE P04
ENDIF
SET ORDER TO P041                     
IF !USED('C05')
   SELE 0
   USE C05 
ELSE
   SELE C05
ENDIF

SET ORDER TO C055
SELECT C05.F06,IIF(SEEK(C05.F06,'C01'),C01.F05,IIF(SEEK(C05.F06,'D01'),D01.F04,IIF(SEEK(C05.F06,'A14'),A14.F02,'')));
FROM C05  GROUP BY C05.F06 ORDER BY C05.F06 INTO CURSOR C05_1 READWRITE 
INDE ON F06 TAG C05_11
SET ORDER TO C05_11              
SELE F01,F02,F03,F04 FROM D07 INTO CURSOR TKE081 WHERE F02= ANY(SELE F02 FROM C05) ORDER BY F02,F03,F01
SELE F01,F02,F03,F04 FROM C05 WHERE !EMPTY(C05.F15) INTO CURSOR TKE082 ORDER BY F02,F03,F01                   
SELE F01,F02,F03,F04 FROM E06 INTO CURSOR TKE083 WHERE F02= ANY(SELE F02 FROM C05) ORDER BY F02,F03,F01
SELE F01,F02,F03,F04 FROM E16 INTO CURSOR TKE084 WHERE F02= ANY(SELE F02 FROM C05) ORDER BY F02,F03,F01
CREATE CURSOR TKE08 (F01 C(12),F02 C(43),F03 D(8),F04 N(13,4))
INDEX ON F02+DTOS(F03)+F01 TAG TKE08
SET ORDER TO 1
SELECT  TKE081
GO TOP
IDEN=0
DO WHILE !EOF()
   SELE TKE08
   APPEND BLANK
   REPLACE  F01 WITH ALLTRIM(TKE081.F01)+IIF(IDEN>0,CHR(IDEN),'')
   REPLACE  F02 WITH TKE081.F02
   REPLACE  F03 WITH TKE081.F03
   REPLACE  F04 WITH TKE081.F04
   SELECT  TKE081
   SKIP
   IF LEFT(TKE08.F01,10)=F01
      IDEN=IDEN+1
   ELSE
      IDEN=0
   ENDIF
ENDDO
SELECT  TKE081
USE
SELECT  TKE082
GO TOP
DO WHILE !EOF()
       SELECT  TKE08
       APPEND BLANK
       REPLACE  F01 WITH TKE082.F01
       REPLACE  F02 WITH TKE082.F02
       REPLACE  F03 WITH TKE082.F03
       REPLACE  F04 WITH TKE082.F04*(-1)
       SELECT  TKE082
       SKIP
ENDDO             
SELE TKE082
USE
SELECT  TKE083
GO TOP
DO WHILE !EOF()
       SELECT  TKE08
       APPEND BLANK
       REPLACE  F01 WITH TKE083.F01
       REPLACE  F02 WITH TKE083.F02
       REPLACE  F03 WITH TKE083.F03
       REPLACE  F04 WITH TKE083.F04
       SELECT  TKE083
       SKIP
ENDDO             
SELE TKE083
USE
SELECT  TKE084
GO TOP
DO WHILE !EOF()
       SELECT  TKE08
       APPEND BLANK
       REPLACE  F01 WITH TKE084.F01
       REPLACE  F02 WITH TKE084.F02
       REPLACE  F03 WITH TKE084.F03
       REPLACE  F04 WITH TKE084.F04*(-1)
       SELECT  TKE084
       SKIP
ENDDO             
SELE TKE084
USE
SELE C05         
SET RELA TO F02 INTO B01 ADDI
SET RELA TO F06 INTO C05_1 ADDI
SET RELA TO F01+F02 INTO C04 ADDI
GO TOP
*******
C05FORM=CREATEOBJECT("TKC05")
C05FORM.SHOW  
DEFINE CLASS TKC05 AS FORM
  CAPTION='C05.出貨計劃'
*!*	  AUTOCENTER=.T.
  CONTROLBOX=.F.
  BORDERSTYLE=1  
  MAXBUTTON=.F.
  MINBUTTON=.F.
  MOVABLE=.F.
  CLOSABLE=.F.
  CONTROLCOUNT=57
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*550
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WIDTH=INT_015*800
  WINDOWSTATE = 2
  WINDOWTYPE=1
  ADD OBJECT LBL_REC AS LBL_REC WITH;
      CAPTION='總庫存量：',;
      BACKCOLOR=RGB(255,255,0),; 
      AUTOSIZE=.T.,;
      LEFT=INT_015*660,;
      TOP=INT_015*10
  ADD OBJECT KEY_LIST AS KEY_LIST WITH;
      AUTOCENTER=.T.,;
      WIDTH=INT_015*170
  ADD OBJECT GRID1 AS GRID1 WITH;
      COLUMNCOUNT=13,;            
      RECORDSOURCE='C05',; 
      TOP=INT_015*61,;  
      HEIGHT=INT_015*465,;     
      WIDTH=INT_015*789,;      
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;
      COLUMN3.NAME='COLUMN3',; 
      COLUMN4.NAME='COLUMN4',; 
      COLUMN5.NAME='COLUMN5',;             
      COLUMN6.NAME='COLUMN6',;       
      COLUMN7.NAME='COLUMN7',;       
      COLUMN8.NAME='COLUMN8',;
      COLUMN9.NAME='COLUMN9',;
      COLUMN10.NAME='COLUMN10',;
      COLUMN11.NAME='COLUMN11',;
      COLUMN12.NAME='COLUMN12',;
      COLUMN13.NAME='COLUMN13'
  ADD OBJECT ORPGROUP AS ORPGROUP WITH;      
      TOP=INT_015*0,;
      LEFT=INT_015*440             
  ADD OBJECT CMDGROUP AS CMDGROUP WITH;
      TOP=INT_015*0,;
      LEFT=INT_015*180,;
      ENABLED=.T.,;
     VISIBLE=.T.      
    ADD OBJECT BACK_BOT AS COMMANDBUTTON WITH;
      TOP=INT_015*33,;
      LEFT=INT_015*8,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;
      CAPTION='\<B.備料'            
    ADD OBJECT  INV_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*33,;
      LEFT=INT_015*50,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;
      CAPTION='\<V.庫存'  
  ADD OBJECT INSCH AS COMMANDBUTTON WITH;
      TOP=INT_015*33,;
      LEFT=INT_015*93,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*65,;
      FONTSIZE=INT_015*9,;
      CAPTION='\<A.進貨計劃'          
  ADD OBJECT IODT_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*5,;
      LEFT=INT_015*395,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*65,;
      FONTSIZE=INT_015*9,;
      CAPTION='\<Z.預期異動'          
  ADD OBJECT OUMNY AS COMMANDBUTTON WITH;
      TOP=INT_015*5,;
      LEFT=INT_015*462,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*65,;
      FONTSIZE=INT_015*9,;
      CAPTION='\<F.銷售預估'            
  ADD OBJECT REPLY_REMARK AS COMMANDBUTTON WITH;
      TOP=INT_015*5,;
      LEFT=INT_015*529,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;
      CAPTION='\<E.修改'           
   ADD OBJECT LBLF01 AS LABEL WITH;
      TOP=INT_015*38,;
      LEFT=INT_015*173,;
      HEIGHT=INT_015*17,;      
      AUTOSIZE=.T.,;
      FONTSIZE=INT_015*9,;
       CAPTION='出貨日期'            
  ADD OBJECT TXTF01 AS TEXTBOX WITH;
      TOP=INT_015*33,;
      LEFT=INT_015*240,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*65,;
      MAXLENGTH=8,;
      FONTSIZE=INT_015*9
  ADD OBJECT LBLF02 AS LABEL WITH;
      TOP=INT_015*38,;
      LEFT=INT_015*310,;
      HEIGHT=INT_015*23,;      
      WIDTH=INT_015*30,;
      FONTSIZE=INT_015*9,;
      CAPTION='備 註'     
  ADD OBJECT TXTF02 AS TEXTBOX WITH;
      TOP=INT_015*33,;
      LEFT=INT_015*340,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*315,;
      MAXLENGTH=60,;
      FONTSIZE=INT_015*9
  ADD OBJECT YES AS COMMANDBUTTON WITH;
      TOP=INT_015*33,;
      LEFT=INT_015*660,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;
      CAPTION='\<Y.確定'
  ADD OBJECT NO AS COMMANDBUTTON WITH;
      TOP=INT_015*33,;
      LEFT=INT_015*702,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;
      CAPTION='\<N.取消' 
  ADD OBJECT LBLF071 AS LABEL WITH;
      TOP=INT_015*39,;
      LEFT=INT_015*680,;
      FONTSIZE=INT_015*9,;
      VISIBLE=.T.,;
      AUTOSIZE=.T.,;
      CAPTION=''                                        
   PROCEDURE INIT
       THISFORM.ORPGROUP.NEW_BOTT.VISIBLE=.F.
       THISFORM.ORPGROUP.EDIT_BOTT.VISIBLE=.F.
       THISFORM.ORPGROUP.DEL_BOTT.VISIBLE=.F.
       THISFORM.YES.VISIBLE=.F.
       THISFORM.NO.VISIBLE=.F.
       THISFORM.GRID1.LOCKCOLUMNS=2
       THISFORM.SETALL('MOUSEPOINTER',99,'COMMANDBUTTON')        
       THISFORM.SETALL('MOUSEICON','BMPS\HAND.CUR','COMMANDBUTTON')               
       THISFORM.SETALL('READONLY',.T.,'TEXTBOX') 
       THISFORM.GRID1.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'COLUMN')
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'HEADER')         
       THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(C05.F15>'1',RGB(139,146,212),IIF(EMPTY(C05.F10),IIF(DATE()-CTOD(LEFT(C05.F07,9))>=VAL(INT_205) .AND. DATE()-CTOD(LEFT(C05.F07,9))>=-VAL(INT_205),RGB(255,255,0),''),IIF(DATE()-C05.F10>=VAL(INT_206),RGB(255,0,0),IIF(C05.F10>DATE(),'',RGB(0,255,255)))))","COLUMN")    
       THISFORM.GRID1.SETALL("DYNAMICFORECOLOR","IIF(EMPTY(C05.F15) AND LEFT(C05.F01,8)<>'備料紀錄',RGB(205,102,29),IIF(C05.F15='3',RGB(71,60,139),''))",'COLUMN')
       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='料        號'
       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='C05.F02'   
       THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='客戶品號'	                   
       THISFORM.GRID1.COLUMN2.CONTROLSOURCE='C04.F17'                      
       THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='希望交期'
       THISFORM.GRID1.COLUMN3.CONTROLSOURCE='C05.F03'             
       THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='訂單編號'
       THISFORM.GRID1.COLUMN4.CONTROLSOURCE='C05.F01'          
	   THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='出貨數量'        	   
	   THISFORM.GRID1.COLUMN5.CONTROLSOURCE='C05.F04'        
       THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='客戶編號'
       THISFORM.GRID1.COLUMN6.CONTROLSOURCE='C05.F06'	        	   	                  
       THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='客戶簡稱'
       THISFORM.GRID1.COLUMN7.CONTROLSOURCE='C05_1.EXP_2'    
	   THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='客戶單號'  	           	   
	   THISFORM.GRID1.COLUMN8.CONTROLSOURCE='C05.F09'	           	                                                 
  	   THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='出貨日期'  	           	   
	   THISFORM.GRID1.COLUMN9.CONTROLSOURCE='C05.F10'
  	   THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='開單未出'        	   	                   	   
	   THISFORM.GRID1.COLUMN10.CONTROLSOURCE='C05.F05'
	   THISFORM.GRID1.COLUMN11.HEADER1.CAPTION='預期結餘'        	   	           
	   THISFORM.GRID1.COLUMN11.CONTROLSOURCE="IIF(ALLTRIM(C05.F01) = '備料紀錄',0,TRANSFORM(ALTT(C05.F02,'1')+MRP_QTY(C05.F02,C05.F03,C05.F01),'@R 9999999999.99'))"  
	   THISFORM.GRID1.COLUMN11.ALIGNMENT=5
	   THISFORM.GRID1.COLUMN12.HEADER1.CAPTION='業務員' + ALLTRIM(INT_209)        	   	           
	   THISFORM.GRID1.COLUMN12.CONTROLSOURCE="IIF(SEEK(C05.F08,'A01'),A01.F03,'')"
	   THISFORM.GRID1.COLUMN13.HEADER1.CAPTION='業務助理'      	   	           
	   THISFORM.GRID1.COLUMN13.CONTROLSOURCE="IIF(SEEK(C05.F13,'A01'),A01.F03,'')"      	           	         	   
       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*149
       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*90
       THISFORM.GRID1.COLUMN3.WIDTH=INT_015*60
       THISFORM.GRID1.COLUMN4.WIDTH=INT_015*80
       THISFORM.GRID1.COLUMN5.WIDTH=INT_015*70
       THISFORM.GRID1.COLUMN6.WIDTH=INT_015*55
       THISFORM.GRID1.COLUMN7.WIDTH=INT_015*55
       THISFORM.GRID1.COLUMN8.WIDTH=INT_015*70
       THISFORM.GRID1.COLUMN9.WIDTH=INT_015*60 
       THISFORM.GRID1.COLUMN10.WIDTH=INT_015*60
       THISFORM.GRID1.COLUMN11.WIDTH=INT_015*70
       THISFORM.GRID1.COLUMN12.WIDTH=INT_015*55
       THISFORM.GRID1.COLUMN13.WIDTH=INT_015*55     
       THISFORM.GRID1.READONLY=.T.       
       THISFORM.GRID1.SETFOCUS
       IF  THISFORM.GRID1.ACTIVEROW=0 
              THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
	      THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
	      THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
	      THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.    
	      THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.	        
	      THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.   
              THISFORM.OUMNY.ENABLED=.F.
              THISFORM.INV_BOTT.ENABLED=.F. 
              THISFORM.INSCH.ENABLED=.F.
              THISFORM.IODT_BOTT.ENABLED=.F.
              THISFORM.REPLY_REMARK.ENABLED=.F.
              THISFORM.BACK_BOT.ENABLED=.F.
        ELSE
              THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
	      THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
	      THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
	      THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.    
	      THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.	        
              THISFORM.INV_BOTT.ENABLED=.T. 
              THISFORM.INSCH.ENABLED=.T.
              THISFORM.IODT_BOTT.ENABLED=.T.	      
              THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限    
              THISFORM.OUMNY.ENABLED=IIF(A02.F10='*',.T.,.F.)   &&判斷有無查看預估銷售金額的權限  
              THISFORM.REPLY_REMARK.ENABLED=IIF(A02.F05='*',.T.,.F.) AND A02.F09 = '*' OR IIF(SEEK(C05.F06,'C01'),C01.F18 = SYS_OPER OR C01.F23 = SYS_OPER OR C01.F33 = SYS_OPER,.F.) OR LEFT(ALLTRIM(C05.F06),1)='V' &&判斷有無修改回覆交期與備註的權限
              THISFORM.BACK_BOT.ENABLED=.T.
        ENDIF         
        JK='料        號'
  ENDPROC        
  PROC KEY_LIST.INIT 
       WITH THIS 
           .ADDITEM('依訂單編號+希望交期排列')
           .ADDITEM('依希望交期+訂單編號排列')
           .ADDITEM('依客戶編號+客戶單號排列')           
           .ADDITEM('依訂單編號+料品編號排列')           
           .ADDITEM('依料品編號+希望交期排列')  
           .ADDITEM('依客戶單號+料品編號排列')
           .ADDITEM('依客戶編號+希望交期排列') 
           .ADDITEM('依出貨日期+客戶編號排列') 
           .ADDITEM('依業務'+ALLTRIM(INT_209)+'編號+客戶編號排列')
           .ADDITEM('依業助編號+客戶編號排列')
           .VALUE=5          
       ENDWITH      
  ENDPROC 
  PROC KEY_LIST.INTERACTIVECHANGE                 
       SELECT  C05
       DO CASE
              CASE THIS.DISPLAYVALUE='依訂單編號+希望交期排列'
                         SET ORDER TO C051 
	                 THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='訂單編號'
	                 THISFORM.GRID1.COLUMN1.CONTROLSOURCE='C05.F01'
	                 THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='希望交期'
	                 THISFORM.GRID1.COLUMN2.CONTROLSOURCE='C05.F03'      
	                 THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='料        號'	                   
	                 THISFORM.GRID1.COLUMN3.CONTROLSOURCE='C05.F02'
	                 THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='客戶品號'	                   
	                 THISFORM.GRID1.COLUMN4.CONTROLSOURCE='C04.F17'
	        	 THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='出貨數量'        	   
	        	 THISFORM.GRID1.COLUMN5.CONTROLSOURCE='C05.F04'        	   
	        	 THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='客戶編號'  	           	   
	        	 THISFORM.GRID1.COLUMN6.CONTROLSOURCE='C05.F06'
	        	 THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='客戶簡稱'
		         THISFORM.GRID1.COLUMN7.CONTROLSOURCE='C05_1.EXP_2'
	        	 THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='客戶單號'  	           	   
	        	 THISFORM.GRID1.COLUMN8.CONTROLSOURCE='C05.F09'	           	   
	  	         THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='出貨日期'  	           	   
	        	 THISFORM.GRID1.COLUMN9.CONTROLSOURCE='C05.F10'
	  	         THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='開單未出'        	   	                   	   
	        	 THISFORM.GRID1.COLUMN10.CONTROLSOURCE='C05.F05'
	        	 THISFORM.GRID1.COLUMN11.HEADER1.CAPTION='預期結餘'        	   	           
	        	 THISFORM.GRID1.COLUMN11.CONTROLSOURCE="IIF(ALLTRIM(C05.F01) = '備料紀錄',0,TRANSFORM(ALTT(C05.F02,'1')+MRP_QTY(C05.F02,C05.F03,C05.F01),'@R 9999999999.99'))"  
				   THISFORM.GRID1.COLUMN12.HEADER1.CAPTION='業務員' + ALLTRIM(INT_209)        	   	           
				   THISFORM.GRID1.COLUMN12.CONTROLSOURCE="IIF(SEEK(C05.F08,'A01'),A01.F03,'')"
				   THISFORM.GRID1.COLUMN13.HEADER1.CAPTION='業務助理'      	   	           
				   THISFORM.GRID1.COLUMN13.CONTROLSOURCE="IIF(SEEK(C05.F13,'A01'),A01.F03,'')"  	           	   
	                 THISFORM.GRID1.COLUMN1.WIDTH=INT_015*80
	                 THISFORM.GRID1.COLUMN2.WIDTH=INT_015*60
	                 THISFORM.GRID1.COLUMN3.WIDTH=INT_015*149
	                 THISFORM.GRID1.COLUMN4.WIDTH=INT_015*90
	                 THISFORM.GRID1.COLUMN5.WIDTH=INT_015*70
	                 THISFORM.GRID1.COLUMN6.WIDTH=INT_015*55
	                 THISFORM.GRID1.COLUMN7.WIDTH=INT_015*55
	                 THISFORM.GRID1.COLUMN8.WIDTH=INT_015*70
	                 THISFORM.GRID1.COLUMN9.WIDTH=INT_015*60    	
	                 THISFORM.GRID1.COLUMN10.WIDTH=INT_015*60
	                 THISFORM.GRID1.COLUMN11.WIDTH=INT_015*70                
	                 THISFORM.GRID1.COLUMN12.WIDTH=INT_015*55
	                 THISFORM.GRID1.COLUMN13.WIDTH=INT_015*55                             
              CASE THIS.DISPLAYVALUE='依希望交期+訂單編號排列'
                         SET ORDER TO C052          
	                 THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='希望交期'
	                 THISFORM.GRID1.COLUMN1.CONTROLSOURCE='C05.F03'
	                 THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='訂單編號'
	                 THISFORM.GRID1.COLUMN2.CONTROLSOURCE='C05.F01'                  
	                 THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='料        號'	                   
	                 THISFORM.GRID1.COLUMN3.CONTROLSOURCE='C05.F02'
	                 THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='客戶品號'	                   
	                 THISFORM.GRID1.COLUMN4.CONTROLSOURCE='C04.F17'
	        	 THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='出貨數量'        	   
	        	 THISFORM.GRID1.COLUMN5.CONTROLSOURCE='C05.F04'        	   
	        	 THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='客戶編號'  	           	   
	        	 THISFORM.GRID1.COLUMN6.CONTROLSOURCE='C05.F06'
	        	 THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='客戶簡稱'
		         THISFORM.GRID1.COLUMN7.CONTROLSOURCE='C05_1.EXP_2'
	        	 THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='客戶單號'  	           	   
	        	 THISFORM.GRID1.COLUMN8.CONTROLSOURCE='C05.F09'	           	           
	  	         THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='出貨日期'  	           	   
	        	 THISFORM.GRID1.COLUMN9.CONTROLSOURCE='C05.F10'
	  	         THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='開單未出'
	        	 THISFORM.GRID1.COLUMN10.CONTROLSOURCE='C05.F05'
	        	 THISFORM.GRID1.COLUMN11.HEADER1.CAPTION='預期結餘'        	   	           
	        	 THISFORM.GRID1.COLUMN11.CONTROLSOURCE="IIF(ALLTRIM(C05.F01) = '備料紀錄',0,TRANSFORM(ALTT(C05.F02,'1')+MRP_QTY(C05.F02,C05.F03,C05.F01),'@R 9999999999.99'))"    
			   THISFORM.GRID1.COLUMN12.HEADER1.CAPTION='業務員' + ALLTRIM(INT_209)        	   	           
			   THISFORM.GRID1.COLUMN12.CONTROLSOURCE="IIF(SEEK(C05.F08,'A01'),A01.F03,'')"
			   THISFORM.GRID1.COLUMN13.HEADER1.CAPTION='業務助理'      	   	           
			   THISFORM.GRID1.COLUMN13.CONTROLSOURCE="IIF(SEEK(C05.F13,'A01'),A01.F03,'')"
	                 THISFORM.GRID1.COLUMN1.WIDTH=INT_015*60
	                 THISFORM.GRID1.COLUMN2.WIDTH=INT_015*80 
	                 THISFORM.GRID1.COLUMN3.WIDTH=INT_015*149
	                 THISFORM.GRID1.COLUMN4.WIDTH=INT_015*90
	                 THISFORM.GRID1.COLUMN5.WIDTH=INT_015*70
	                 THISFORM.GRID1.COLUMN6.WIDTH=INT_015*55               
	                 THISFORM.GRID1.COLUMN7.WIDTH=INT_015*55
	                 THISFORM.GRID1.COLUMN8.WIDTH=INT_015*70
	                 THISFORM.GRID1.COLUMN9.WIDTH=INT_015*60            
	                 THISFORM.GRID1.COLUMN10.WIDTH=INT_015*60 
	                 THISFORM.GRID1.COLUMN11.WIDTH=INT_015*70 
	                 THISFORM.GRID1.COLUMN12.WIDTH=INT_015*55
	                 THISFORM.GRID1.COLUMN13.WIDTH=INT_015*55                                                                       
	      CASE THIS.DISPLAYVALUE='依客戶編號+客戶單號排列'
	                 SET ORDER TO C053                                     	                                       
	                 THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='客戶編號'
	                 THISFORM.GRID1.COLUMN1.CONTROLSOURCE='C05.F06'
	                 THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='客戶簡稱'
	                 THISFORM.GRID1.COLUMN2.CONTROLSOURCE='C05_1.EXP_2'             
	                 THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='希望交期'
	                 THISFORM.GRID1.COLUMN3.CONTROLSOURCE='C05.F03'         
	                 THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='訂單編號'
	                 THISFORM.GRID1.COLUMN4.CONTROLSOURCE='C05.F01'	   
	        	 THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='料        號'	                  
	        	 THISFORM.GRID1.COLUMN5.CONTROLSOURCE='C05.F02'   
	        	 THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='客戶品號'	                   
	                 THISFORM.GRID1.COLUMN6.CONTROLSOURCE='C04.F17'                                                             
	        	 THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='出貨數量'        	   
	        	 THISFORM.GRID1.COLUMN7.CONTROLSOURCE='C05.F04'        
	        	 THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='客戶單號'  	           	   
	        	 THISFORM.GRID1.COLUMN8.CONTROLSOURCE='C05.F09'	           	               	   	   	   
	  	         THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='出貨日期'  	           	   
	        	 THISFORM.GRID1.COLUMN9.CONTROLSOURCE='C05.F10'
	  	         THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='開單未出'        	   	                   	   
	        	 THISFORM.GRID1.COLUMN10.CONTROLSOURCE='C05.F05'
	        	 THISFORM.GRID1.COLUMN11.HEADER1.CAPTION='預期結餘'        	   	           
	        	 THISFORM.GRID1.COLUMN11.CONTROLSOURCE="IIF(ALLTRIM(C05.F01) = '備料紀錄',0,TRANSFORM(ALTT(C05.F02,'1')+MRP_QTY(C05.F02,C05.F03,C05.F01),'@R 9999999999.99'))"       
			   THISFORM.GRID1.COLUMN12.HEADER1.CAPTION='業務員' + ALLTRIM(INT_209)        	   	           
			   THISFORM.GRID1.COLUMN12.CONTROLSOURCE="IIF(SEEK(C05.F08,'A01'),A01.F03,'')"
			   THISFORM.GRID1.COLUMN13.HEADER1.CAPTION='業務助理'      	   	           
			   THISFORM.GRID1.COLUMN13.CONTROLSOURCE="IIF(SEEK(C05.F13,'A01'),A01.F03,'')"     	           	           	    	   
	                 THISFORM.GRID1.COLUMN1.WIDTH=INT_015*55
	                 THISFORM.GRID1.COLUMN2.WIDTH=INT_015*55 
	                 THISFORM.GRID1.COLUMN3.WIDTH=INT_015*60
	                 THISFORM.GRID1.COLUMN4.WIDTH=INT_015*80
	                 THISFORM.GRID1.COLUMN5.WIDTH=INT_015*149
	                 THISFORM.GRID1.COLUMN6.WIDTH=INT_015*90
	                 THISFORM.GRID1.COLUMN7.WIDTH=INT_015*70
	                 THISFORM.GRID1.COLUMN8.WIDTH=INT_015*70
	                 THISFORM.GRID1.COLUMN9.WIDTH=INT_015*60          
	                 THISFORM.GRID1.COLUMN10.WIDTH=INT_015*60 
	                 THISFORM.GRID1.COLUMN11.WIDTH=INT_015*70  
	                 THISFORM.GRID1.COLUMN12.WIDTH=INT_015*55
	                 THISFORM.GRID1.COLUMN13.WIDTH=INT_015*55                                                                                                   
	      CASE THIS.DISPLAYVALUE='依訂單編號+料品編號排列'
	                 SET ORDER TO C054          
	                 THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='訂單編號'
	                 THISFORM.GRID1.COLUMN1.CONTROLSOURCE='C05.F01'          
	                 THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='料        號'
	                 THISFORM.GRID1.COLUMN2.CONTROLSOURCE='C05.F02'   
	                 THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='客戶品號'	                   
	                 THISFORM.GRID1.COLUMN3.CONTROLSOURCE='C04.F17'          
	        	 THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='出貨數量'        	   
	        	 THISFORM.GRID1.COLUMN4.CONTROLSOURCE='C05.F04'        
	                 THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='客戶編號'
	                 THISFORM.GRID1.COLUMN5.CONTROLSOURCE='C05.F06'	        	   	                  
	                 THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='客戶簡稱'
	                 THISFORM.GRID1.COLUMN6.CONTROLSOURCE='C05_1.EXP_2'             
	                 THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='希望交期'
	                 THISFORM.GRID1.COLUMN7.CONTROLSOURCE='C05.F03'    
	        	 THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='客戶單號'  	           	   
	        	 THISFORM.GRID1.COLUMN8.CONTROLSOURCE='C05.F09'	           	                                             
	  	         THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='出貨日期'  	           	   
	        	 THISFORM.GRID1.COLUMN9.CONTROLSOURCE='C05.F10'
	  	         THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='開單未出'        	   	                   	   
	        	 THISFORM.GRID1.COLUMN10.CONTROLSOURCE='C05.F05'
	        	 THISFORM.GRID1.COLUMN11.HEADER1.CAPTION='預期結餘'        	   	           
	        	 THISFORM.GRID1.COLUMN11.CONTROLSOURCE="IIF(ALLTRIM(C05.F01) = '備料紀錄',0,TRANSFORM(ALTT(C05.F02,'1')+MRP_QTY(C05.F02,C05.F03,C05.F01),'@R 9999999999.99'))"   
				   THISFORM.GRID1.COLUMN12.HEADER1.CAPTION='業務員' + ALLTRIM(INT_209)        	   	           
				   THISFORM.GRID1.COLUMN12.CONTROLSOURCE="IIF(SEEK(C05.F08,'A01'),A01.F03,'')"
				   THISFORM.GRID1.COLUMN13.HEADER1.CAPTION='業務助理'      	   	           
				   THISFORM.GRID1.COLUMN13.CONTROLSOURCE="IIF(SEEK(C05.F13,'A01'),A01.F03,'')"  
	                 THISFORM.GRID1.COLUMN1.WIDTH=INT_015*80
	                 THISFORM.GRID1.COLUMN2.WIDTH=INT_015*149 
	                 THISFORM.GRID1.COLUMN3.WIDTH=INT_015*90
	                 THISFORM.GRID1.COLUMN4.WIDTH=INT_015*70
	                 THISFORM.GRID1.COLUMN5.WIDTH=INT_015*55
	                 THISFORM.GRID1.COLUMN6.WIDTH=INT_015*55
	                 THISFORM.GRID1.COLUMN7.WIDTH=INT_015*60
	                 THISFORM.GRID1.COLUMN8.WIDTH=INT_015*70
	                 THISFORM.GRID1.COLUMN9.WIDTH=INT_015*60     	
	                 THISFORM.GRID1.COLUMN10.WIDTH=INT_015*60
	                 THISFORM.GRID1.COLUMN11.WIDTH=INT_015*70                  
	                 THISFORM.GRID1.COLUMN12.WIDTH=INT_015*55
	                 THISFORM.GRID1.COLUMN13.WIDTH=INT_015*55                                 
	      CASE THIS.DISPLAYVALUE='依料品編號+希望交期排列'
	                 SET ORDER TO C055                         
	                 THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='料        號'
	                 THISFORM.GRID1.COLUMN1.CONTROLSOURCE='C05.F02'   
	                 THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='客戶品號'	                   
	                 THISFORM.GRID1.COLUMN2.CONTROLSOURCE='C04.F17'                      
	                 THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='希望交期'
	                 THISFORM.GRID1.COLUMN3.CONTROLSOURCE='C05.F03'             
	                 THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='訂單編號'
	                 THISFORM.GRID1.COLUMN4.CONTROLSOURCE='C05.F01'          
	        	 THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='出貨數量'        	   
	        	 THISFORM.GRID1.COLUMN5.CONTROLSOURCE='C05.F04'        
	                 THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='客戶編號'
	                 THISFORM.GRID1.COLUMN6.CONTROLSOURCE='C05.F06'	        	   	                  
	                 THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='客戶簡稱'
	                 THISFORM.GRID1.COLUMN7.CONTROLSOURCE='C05_1.EXP_2'    
	        	 THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='客戶單號'  	           	   
	        	 THISFORM.GRID1.COLUMN8.CONTROLSOURCE='C05.F09'	           	                                                 
	  	         THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='出貨日期'  	           	   
	        	 THISFORM.GRID1.COLUMN9.CONTROLSOURCE='C05.F10'
	  	         THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='開單未出'        	   	                   	   
	        	 THISFORM.GRID1.COLUMN10.CONTROLSOURCE='C05.F05'
	        	 THISFORM.GRID1.COLUMN11.HEADER1.CAPTION='預期結餘'        	   	           
	        	 THISFORM.GRID1.COLUMN11.CONTROLSOURCE="IIF(ALLTRIM(C05.F01) = '備料紀錄',0,TRANSFORM(ALTT(C05.F02,'1')+MRP_QTY(C05.F02,C05.F03,C05.F01),'@R 9999999999.99'))"  
				   THISFORM.GRID1.COLUMN12.HEADER1.CAPTION='業務員' + ALLTRIM(INT_209)        	   	           
				   THISFORM.GRID1.COLUMN12.CONTROLSOURCE="IIF(SEEK(C05.F08,'A01'),A01.F03,'')"
				   THISFORM.GRID1.COLUMN13.HEADER1.CAPTION='業務助理'      	   	           
				   THISFORM.GRID1.COLUMN13.CONTROLSOURCE="IIF(SEEK(C05.F13,'A01'),A01.F03,'')"  	           	           	         	   
	                 THISFORM.GRID1.COLUMN1.WIDTH=INT_015*149
	                 THISFORM.GRID1.COLUMN2.WIDTH=INT_015*90
	                 THISFORM.GRID1.COLUMN3.WIDTH=INT_015*60
	                 THISFORM.GRID1.COLUMN4.WIDTH=INT_015*80
	                 THISFORM.GRID1.COLUMN5.WIDTH=INT_015*70
	                 THISFORM.GRID1.COLUMN6.WIDTH=INT_015*55
	                 THISFORM.GRID1.COLUMN7.WIDTH=INT_015*55
	                 THISFORM.GRID1.COLUMN8.WIDTH=INT_015*70
	                 THISFORM.GRID1.COLUMN9.WIDTH=INT_015*60
	                 THISFORM.GRID1.COLUMN10.WIDTH=INT_015*60
	                 THISFORM.GRID1.COLUMN11.WIDTH=INT_015*70
	                 THISFORM.GRID1.COLUMN12.WIDTH=INT_015*55
	                 THISFORM.GRID1.COLUMN13.WIDTH=INT_015*55     
	      CASE THIS.DISPLAYVALUE='依客戶單號+料品編號排列'
	                 SET ORDER TO C058          
	                 THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='客戶單號'
	                 THISFORM.GRID1.COLUMN1.CONTROLSOURCE='C05.F09'          
	                 THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='料        號'
	                 THISFORM.GRID1.COLUMN2.CONTROLSOURCE='C05.F02' 
	                 THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='客戶品號'	                   
	                 THISFORM.GRID1.COLUMN3.CONTROLSOURCE='C04.F17'            
	        	 THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='出貨數量'        	   
	        	 THISFORM.GRID1.COLUMN4.CONTROLSOURCE='C05.F04'        
	                 THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='客戶編號'
	                 THISFORM.GRID1.COLUMN5.CONTROLSOURCE='C05.F06'        	   	                  
	                 THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='客戶簡稱'
	                 THISFORM.GRID1.COLUMN6.CONTROLSOURCE='C05_1.EXP_2'            
	                 THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='希望交期'
	                 THISFORM.GRID1.COLUMN7.CONTROLSOURCE='C05.F03' 
	        	 THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='訂單編號'
	        	 THISFORM.GRID1.COLUMN8.CONTROLSOURCE='C05.F01'           	                                 
	  	         THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='出貨日期'
	        	 THISFORM.GRID1.COLUMN9.CONTROLSOURCE='C05.F10' 
	  	         THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='開單未出'
	        	 THISFORM.GRID1.COLUMN10.CONTROLSOURCE='C05.F05'
	        	 THISFORM.GRID1.COLUMN11.HEADER1.CAPTION='預期結餘'
	        	 THISFORM.GRID1.COLUMN11.CONTROLSOURCE="IIF(ALLTRIM(C05.F01) = '備料紀錄',0,TRANSFORM(ALTT(C05.F02,'1')+MRP_QTY(C05.F02,C05.F03,C05.F01),'@R 9999999999.99'))"  
			   THISFORM.GRID1.COLUMN12.HEADER1.CAPTION='業務員' + ALLTRIM(INT_209)        	   	           
			   THISFORM.GRID1.COLUMN12.CONTROLSOURCE="IIF(SEEK(C05.F08,'A01'),A01.F03,'')"
			   THISFORM.GRID1.COLUMN13.HEADER1.CAPTION='業務助理'      	   	           
			   THISFORM.GRID1.COLUMN13.CONTROLSOURCE="IIF(SEEK(C05.F13,'A01'),A01.F03,'')"   
	                 THISFORM.GRID1.COLUMN1.WIDTH=INT_015*70
	                 THISFORM.GRID1.COLUMN2.WIDTH=INT_015*149
	                 THISFORM.GRID1.COLUMN3.WIDTH=INT_015*90
	                 THISFORM.GRID1.COLUMN4.WIDTH=INT_015*70
	                 THISFORM.GRID1.COLUMN5.WIDTH=INT_015*55
	                 THISFORM.GRID1.COLUMN6.WIDTH=INT_015*55
	                 THISFORM.GRID1.COLUMN7.WIDTH=INT_015*60
	                 THISFORM.GRID1.COLUMN8.WIDTH=INT_015*80
	                 THISFORM.GRID1.COLUMN9.WIDTH=INT_015*60
	                 THISFORM.GRID1.COLUMN10.WIDTH=INT_015*60
	                 THISFORM.GRID1.COLUMN11.WIDTH=INT_015*70               
	                 THISFORM.GRID1.COLUMN12.WIDTH=INT_015*55
	                 THISFORM.GRID1.COLUMN13.WIDTH=INT_015*55
	      CASE THIS.DISPLAYVALUE='依客戶編號+希望交期排列'
	                 SET ORDER TO C059                                     	                                       
	                 THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='客戶編號'
	                 THISFORM.GRID1.COLUMN1.CONTROLSOURCE='C05.F06'
	                 THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='希望交期'
	                 THISFORM.GRID1.COLUMN2.CONTROLSOURCE='C05.F03'   
	                 THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='客戶簡稱'
	                 THISFORM.GRID1.COLUMN3.CONTROLSOURCE='C05_1.EXP_2'               
	                 THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='訂單編號'
	                 THISFORM.GRID1.COLUMN4.CONTROLSOURCE='C05.F01'	   
	        	 THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='料        號'	                  
	        	 THISFORM.GRID1.COLUMN5.CONTROLSOURCE='C05.F02'   
	        	 THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='客戶品號'	                   
	                 THISFORM.GRID1.COLUMN6.CONTROLSOURCE='C04.F17'                                                             
	        	 THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='出貨數量'        	   
	        	 THISFORM.GRID1.COLUMN7.CONTROLSOURCE='C05.F04'        
	        	 THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='客戶單號'  	           	   
	        	 THISFORM.GRID1.COLUMN8.CONTROLSOURCE='C05.F09'	           	               	   	   	   
	  	         THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='出貨日期'  	           	   
	        	 THISFORM.GRID1.COLUMN9.CONTROLSOURCE='C05.F10'
	  	         THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='開單未出'        	   	                   	   
	        	 THISFORM.GRID1.COLUMN10.CONTROLSOURCE='C05.F05'
	        	 THISFORM.GRID1.COLUMN11.HEADER1.CAPTION='預期結餘'        	   	           
	        	 THISFORM.GRID1.COLUMN11.CONTROLSOURCE="IIF(ALLTRIM(C05.F01) = '備料紀錄',0,TRANSFORM(ALTT(C05.F02,'1')+MRP_QTY(C05.F02,C05.F03,C05.F01),'@R 9999999999.99'))"   
				   THISFORM.GRID1.COLUMN12.HEADER1.CAPTION='業務員' + ALLTRIM(INT_209)        	   	           
				   THISFORM.GRID1.COLUMN12.CONTROLSOURCE="IIF(SEEK(C05.F08,'A01'),A01.F03,'')"
				   THISFORM.GRID1.COLUMN13.HEADER1.CAPTION='業務助理'      	   	           
				   THISFORM.GRID1.COLUMN13.CONTROLSOURCE="IIF(SEEK(C05.F13,'A01'),A01.F03,'')"       	           	           	    	   
	                 THISFORM.GRID1.COLUMN1.WIDTH=INT_015*55
	                 THISFORM.GRID1.COLUMN2.WIDTH=INT_015*60
	                 THISFORM.GRID1.COLUMN3.WIDTH=INT_015*55
	                 THISFORM.GRID1.COLUMN4.WIDTH=INT_015*80
	                 THISFORM.GRID1.COLUMN5.WIDTH=INT_015*149
	                 THISFORM.GRID1.COLUMN6.WIDTH=INT_015*90
	                 THISFORM.GRID1.COLUMN7.WIDTH=INT_015*70
	                 THISFORM.GRID1.COLUMN8.WIDTH=INT_015*70
	                 THISFORM.GRID1.COLUMN9.WIDTH=INT_015*60          
	                 THISFORM.GRID1.COLUMN10.WIDTH=INT_015*60 
	                 THISFORM.GRID1.COLUMN11.WIDTH=INT_015*70  
	                 THISFORM.GRID1.COLUMN12.WIDTH=INT_015*55
	                 THISFORM.GRID1.COLUMN13.WIDTH=INT_015*55    
	      CASE THIS.DISPLAYVALUE='依出貨日期+客戶編號排列'
	                 SET ORDER TO C05A                                     	
	  	         THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='出貨日期'  	           	   
	        	 THISFORM.GRID1.COLUMN1.CONTROLSOURCE='C05.F10'	                                                        
	                 THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='客戶編號'
	                 THISFORM.GRID1.COLUMN2.CONTROLSOURCE='C05.F06'
	                 THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='客戶簡稱'
	                 THISFORM.GRID1.COLUMN3.CONTROLSOURCE='C05_1.EXP_2'          	                 
	                 THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='希望交期'
	                 THISFORM.GRID1.COLUMN4.CONTROLSOURCE='C05.F03'        
	                 THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='訂單編號'
	                 THISFORM.GRID1.COLUMN5.CONTROLSOURCE='C05.F01'	   
	        	 THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='料        號'	                  
	        	 THISFORM.GRID1.COLUMN6.CONTROLSOURCE='C05.F02'   
	        	 THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='客戶品號'	                   
	                 THISFORM.GRID1.COLUMN7.CONTROLSOURCE='C04.F17'                                                             
	        	 THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='出貨數量'        	   
	        	 THISFORM.GRID1.COLUMN8.CONTROLSOURCE='C05.F04'        
	        	 THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='客戶單號'  	           	   
	        	 THISFORM.GRID1.COLUMN9.CONTROLSOURCE='C05.F09'	           	               	   	   	   
	  	         THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='開單未出'        	   	                   	   
	        	 THISFORM.GRID1.COLUMN10.CONTROLSOURCE='C05.F05'
	        	 THISFORM.GRID1.COLUMN11.HEADER1.CAPTION='預期結餘'        	   	           
	        	 THISFORM.GRID1.COLUMN11.CONTROLSOURCE="IIF(ALLTRIM(C05.F01) = '備料紀錄',0,TRANSFORM(ALTT(C05.F02,'1')+MRP_QTY(C05.F02,C05.F03,C05.F01),'@R 9999999999.99'))"       
			   THISFORM.GRID1.COLUMN12.HEADER1.CAPTION='業務員' + ALLTRIM(INT_209)        	   	           
			   THISFORM.GRID1.COLUMN12.CONTROLSOURCE="IIF(SEEK(C05.F08,'A01'),A01.F03,'')"
			   THISFORM.GRID1.COLUMN13.HEADER1.CAPTION='業務助理'      	   	           
			   THISFORM.GRID1.COLUMN13.CONTROLSOURCE="IIF(SEEK(C05.F13,'A01'),A01.F03,'')"     
	                 THISFORM.GRID1.COLUMN1.WIDTH=INT_015*60	        	 	           	           	    	   
	                 THISFORM.GRID1.COLUMN2.WIDTH=INT_015*55
	                 THISFORM.GRID1.COLUMN3.WIDTH=INT_015*55	                 
	                 THISFORM.GRID1.COLUMN4.WIDTH=INT_015*60
	                 THISFORM.GRID1.COLUMN5.WIDTH=INT_015*80
	                 THISFORM.GRID1.COLUMN6.WIDTH=INT_015*149
	                 THISFORM.GRID1.COLUMN7.WIDTH=INT_015*90
	                 THISFORM.GRID1.COLUMN8.WIDTH=INT_015*70
	                 THISFORM.GRID1.COLUMN9.WIDTH=INT_015*70
	                 THISFORM.GRID1.COLUMN10.WIDTH=INT_015*60 
	                 THISFORM.GRID1.COLUMN11.WIDTH=INT_015*70  
	                 THISFORM.GRID1.COLUMN12.WIDTH=INT_015*55
	                 THISFORM.GRID1.COLUMN13.WIDTH=INT_015*55     
	      CASE THIS.DISPLAYVALUE='依業務'+ALLTRIM(INT_209)+'編號+客戶編號排列'
	                 SET ORDER TO C05B                          
	             THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='業務員' + ALLTRIM(INT_209)     	   	           
	        	 THISFORM.GRID1.COLUMN1.CONTROLSOURCE="IIF(SEEK(C05.F08,'A01'),A01.F03,'')"         	
	  	         THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='出貨日期'  	           	   
	        	 THISFORM.GRID1.COLUMN2.CONTROLSOURCE='C05.F10'	                                                        
	                 THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='客戶編號'
	                 THISFORM.GRID1.COLUMN3.CONTROLSOURCE='C05.F06'
	                 THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='客戶簡稱'
	                 THISFORM.GRID1.COLUMN4.CONTROLSOURCE='C05_1.EXP_2'          	                 
	                 THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='希望交期'
	                 THISFORM.GRID1.COLUMN5.CONTROLSOURCE='C05.F03'        
	                 THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='訂單編號'
	                 THISFORM.GRID1.COLUMN6.CONTROLSOURCE='C05.F01'	     
	        	 THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='料        號'	                  
	        	 THISFORM.GRID1.COLUMN7.CONTROLSOURCE='C05.F02'   
	        	 THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='客戶品號'	                   
	                 THISFORM.GRID1.COLUMN8.CONTROLSOURCE='C04.F17'                                                             
	        	 THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='出貨數量'        	   
	        	 THISFORM.GRID1.COLUMN9.CONTROLSOURCE='C05.F04'        
	        	 THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='客戶單號'  	           	   
	        	 THISFORM.GRID1.COLUMN10.CONTROLSOURCE='C05.F09'	           	               	   	   	   
	  	         THISFORM.GRID1.COLUMN11.HEADER1.CAPTION='開單未出'        	   	                   	   
	        	 THISFORM.GRID1.COLUMN11.CONTROLSOURCE='C05.F05'
	        	 THISFORM.GRID1.COLUMN12.HEADER1.CAPTION='預期結餘'        	   	           
	        	 THISFORM.GRID1.COLUMN12.CONTROLSOURCE="IIF(ALLTRIM(C05.F01) = '備料紀錄',0,TRANSFORM(ALTT(C05.F02,'1')+MRP_QTY(C05.F02,C05.F03,C05.F01),'@R 9999999999.99'))"      
				   THISFORM.GRID1.COLUMN13.HEADER1.CAPTION='業務助理'      	   	           
				   THISFORM.GRID1.COLUMN13.CONTROLSOURCE="IIF(SEEK(C05.F13,'A01'),A01.F03,'')"   
	                 THISFORM.GRID1.COLUMN1.WIDTH=INT_015*55
	                 THISFORM.GRID1.COLUMN2.WIDTH=INT_015*60	        	 	           	           	    	   
	                 THISFORM.GRID1.COLUMN3.WIDTH=INT_015*55
	                 THISFORM.GRID1.COLUMN4.WIDTH=INT_015*55	                 
	                 THISFORM.GRID1.COLUMN5.WIDTH=INT_015*60
	                 THISFORM.GRID1.COLUMN6.WIDTH=INT_015*80
	                 THISFORM.GRID1.COLUMN7.WIDTH=INT_015*149
	                 THISFORM.GRID1.COLUMN8.WIDTH=INT_015*90
	                 THISFORM.GRID1.COLUMN9.WIDTH=INT_015*70
	                 THISFORM.GRID1.COLUMN10.WIDTH=INT_015*70
	                 THISFORM.GRID1.COLUMN11.WIDTH=INT_015*60 
	                 THISFORM.GRID1.COLUMN12.WIDTH=INT_015*70  
	                 THISFORM.GRID1.COLUMN13.WIDTH=INT_015*55                   
	      CASE THIS.DISPLAYVALUE='依業助編號+客戶編號排列'
	                 SET ORDER TO C05C                          
	             THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='業務助理'  	   	           
	        	 THISFORM.GRID1.COLUMN1.CONTROLSOURCE="IIF(SEEK(C05.F13,'A01'),A01.F03,'')"         	
	  	         THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='出貨日期'  	           	   
	        	 THISFORM.GRID1.COLUMN2.CONTROLSOURCE='C05.F10'	                                                        
	                 THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='客戶編號'
	                 THISFORM.GRID1.COLUMN3.CONTROLSOURCE='C05.F06'
	                 THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='客戶簡稱'
	                 THISFORM.GRID1.COLUMN4.CONTROLSOURCE='C05_1.EXP_2'          	                 
	                 THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='希望交期'
	                 THISFORM.GRID1.COLUMN5.CONTROLSOURCE='C05.F03'        
	                 THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='訂單編號'
	                 THISFORM.GRID1.COLUMN6.CONTROLSOURCE='C05.F01'	     
	        	 THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='料        號'	                  
	        	 THISFORM.GRID1.COLUMN7.CONTROLSOURCE='C05.F02'   
	        	 THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='客戶品號'	                   
	                 THISFORM.GRID1.COLUMN8.CONTROLSOURCE='C04.F17'                                                             
	        	 THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='出貨數量'        	   
	        	 THISFORM.GRID1.COLUMN9.CONTROLSOURCE='C05.F04'        
	        	 THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='客戶單號'  	           	   
	        	 THISFORM.GRID1.COLUMN10.CONTROLSOURCE='C05.F09'	           	               	   	   	   
	  	         THISFORM.GRID1.COLUMN11.HEADER1.CAPTION='開單未出'        	   	                   	   
	        	 THISFORM.GRID1.COLUMN11.CONTROLSOURCE='C05.F05'
	        	 THISFORM.GRID1.COLUMN12.HEADER1.CAPTION='預期結餘'        	   	           
	        	 THISFORM.GRID1.COLUMN12.CONTROLSOURCE="IIF(ALLTRIM(C05.F01) = '備料紀錄',0,TRANSFORM(ALTT(C05.F02,'1')+MRP_QTY(C05.F02,C05.F03,C05.F01),'@R 9999999999.99'))"      
				   THISFORM.GRID1.COLUMN13.HEADER1.CAPTION='業務員' + ALLTRIM(INT_209)     	   	           
				   THISFORM.GRID1.COLUMN13.CONTROLSOURCE="IIF(SEEK(C05.F08,'A01'),A01.F03,'')"   
	                 THISFORM.GRID1.COLUMN1.WIDTH=INT_015*55
	                 THISFORM.GRID1.COLUMN2.WIDTH=INT_015*60	        	 	           	           	    	   
	                 THISFORM.GRID1.COLUMN3.WIDTH=INT_015*55
	                 THISFORM.GRID1.COLUMN4.WIDTH=INT_015*55	                 
	                 THISFORM.GRID1.COLUMN5.WIDTH=INT_015*60
	                 THISFORM.GRID1.COLUMN6.WIDTH=INT_015*80
	                 THISFORM.GRID1.COLUMN7.WIDTH=INT_015*149
	                 THISFORM.GRID1.COLUMN8.WIDTH=INT_015*90
	                 THISFORM.GRID1.COLUMN9.WIDTH=INT_015*70
	                 THISFORM.GRID1.COLUMN10.WIDTH=INT_015*70
	                 THISFORM.GRID1.COLUMN11.WIDTH=INT_015*60 
	                 THISFORM.GRID1.COLUMN12.WIDTH=INT_015*70  
	                 THISFORM.GRID1.COLUMN13.WIDTH=INT_015*55  
       ENDCASE 
       JK=IIF(THIS.VALUE=9,'業務'+ALLTRIM(INT_209)+'編號',THISFORM.GRID1.COLUMN1.HEADER1.CAPTION)
       THISFORM.GRID1.REFRESH
       THISFORM.GRID1.SETFOCUS
  ENDPROC                
  PROC GRID1.AFTERROWCOLCHANGE
       LPARAMETERS NCOLINDEX
       THISFORM.INSCH.CAPTION=IIF(B01.F97 = 'N','\<A.進貨計劃','\<A.生產計劃')
       THISFORM.LBL_REC.CAPTION='總庫存量：'+ALLTRIM(TRANSFORM(ALTT(C05.F02,'1'),'@R 9999999999.99'))       
       THISFORM.GRID1.TOOLTIPTEXT=IIF(C05.F15>'1','計劃需求',IIF(EMPTY(C05.F10),IIF(DATE()-CTOD(LEFT(C05.F07,9))>=VAL(INT_205) AND DATE()-CTOD(LEFT(C05.F07,9))>=-VAL(INT_205),'超過'+INT_205+'天未回覆出貨日期' ,''),IIF(C05.F12='1' AND (DATE()-CTOD(LEFT(C05.F07,9))<=2),'剛回覆出貨日期',IIF(DATE()-C05.F10>=VAL(INT_206),'超過'+INT_206+'天未出貨',IIF(C05.F10>DATE(),'','已到貨'+ALLTRIM(STR(DATE()-C05.F10))+'天')))))
       THISFORM.LBLF01.CAPTION=IIF(C05.F12='1'  AND (DATE()-CTOD(LEFT(C05.F07,9))<=2),'剛回覆出貨日期','出貨日期')
       THISFORM.LBLF01.BACKCOLOR=IIF(C05.F12='1'  AND (DATE()-CTOD(LEFT(C05.F07,9))<=2),RGB(255,0,0),RGB(192,192,192))
       THISFORM.TXTF01.VALUE=C05.F10
       THISFORM.TXTF02.VALUE=C05.F11
       THISFORM.LBLF071.CAPTION=C05.F07
       THISFORM.REPLY_REMARK.ENABLED=IIF(A02.F05='*',.T.,.F.) AND A02.F09 = '*' OR IIF(SEEK(C05.F06,'C01'),C01.F18 = SYS_OPER OR C01.F23 = SYS_OPER OR C01.F33 = SYS_OPER,.F.) OR LEFT(ALLTRIM(C05.F06),1)='V' &&判斷有無修改回覆交期與備註的權限
       JK=IIF(THISFORM.KEY_LIST.VALUE=9,'業務'+ALLTRIM(INT_209)+'編號',THISFORM.GRID1.COLUMN1.HEADER1.CAPTION)
       FCH=THISFORM.ACTIVECONTROL.NAME
       CHK=''
       THISFORM.REFRESH
  ENDPROC  
  ******備料
  PROC BACK_BOT.CLICK
       SELECT C05
       COD = SYS(21)
       SELECT C05.* FROM C05 WHERE ALLTRIM(C05.F01) = '備料紀錄' ORDER BY F02,F08,F06 INTO CURSOR C05_BACK READWRITE
       INDE ON F02+F06+F08 TAG C05_BACK1
       INDE ON F06+F02+F06 TAG C05_BACK2
       INDE ON F08+F06+F02 TAG C05_BACK3
       INDE ON F13+F06+F02 TAG C05_BACK4
       SELECT C05_BACK 
       SET ORDER TO C05_BACK1
       GO TOP
       IF _TALLY > 0
          BACK_SEEK=CREATEOBJECT("BACK_SEEK")  
          BACK_SEEK.SHOW
       ELSE
          =MESSAGEBOX('無備料紀錄',0+48,'警示')
          THISFORM.GRID1.SETFOCUS
       ENDIF
       SELECT C05_BACK 
       USE
       SELE C05
       SET ORDER TO &COD 
       THISFORM.GRID1.SETFOCUS
  ENDPROC        
  **********查看庫存明細
  PROC INV_BOTT.CLICK
       IF !USED('B1A')
           SELECT 0
           USE B1A
       ELSE
          SELECT B1A
       ENDIF
      SET ORDER TO 1   
	  THISFORM.CMDGROUP.SETALL('FORECOLOR',RGB(128,128,128),'COMMANDBUTTON')
         THISFORM.ORPGROUP.SETALL('FORECOLOR',RGB(128,128,128),'COMMANDBUTTON')
         THISFORM.INSCH.FORECOLOR=RGB(128,128,128)
         THISFORM.OUMNY.FORECOLOR=RGB(128,128,128)
         THISFORM.REPLY_REMARK.FORECOLOR=RGB(128,128,128)
         THISFORM.INV_BOTT.FORECOLOR=RGB(128,128,128)
         THISFORM.IODT_BOTT.FORECOLOR=RGB(128,128,128)
         SELE B11.F01,B11.F03,A14.F02,B11.F04,B11.F05,B11.F06,B11.F08 FROM B11,A14 WHERE B11.F01<>INT_190 AND B11.F03=C05.F02 AND A14.F01=B11.F01  INTO CURSOR INV ORDER BY B11.F01
         INV_SEEK=CREATEOBJECT("INV_SEEK")  
         INV_SEEK.SHOW 
         AREA1='C05'
         SELECT &AREA1
         THISFORM.CMDGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
         THISFORM.ORPGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON') 
         THISFORM.INSCH.FORECOLOR=RGB(0,0,0)   
         THISFORM.OUMNY.FORECOLOR=RGB(0,0,0)
         THISFORM.REPLY_REMARK.FORECOLOR=RGB(0,0,0)
         THISFORM.INV_BOTT.FORECOLOR=RGB(0,0,0)
         THISFORM.IODT_BOTT.FORECOLOR=RGB(0,0,0)
         THISFORM.GRID1.SETFOCUS
  ENDPROC   
****************查看進貨計劃
  PROC INSCH.CLICK    
       LK=C05.F02
       IF B01.F97 = 'Y'
       	  SELECT E06.*,'E' AS DE_CK FROM E06 WHERE E06.F02=C05.F02 ORDER BY E06.F03 INTO CURSOR INSCH READWRITE
       ELSE
       	  SELE RECNO(),D07.F01,D07.F02,D07.F03,D07.F04,D07.F05,D07.F07,D07.F08,D07.F09,D07.F10,D07.F13,D07.F14,D07.F15,D07.F16,D07.F17,D07.F18,'D' AS DE_CK FROM D07 WHERE D07.F02=C05.F02 ORDER BY D07.F03 INTO CURSOR INSCH READWRITE
       ENDIF
       SELECT INSCH
       GO TOP
*!*	       INDEX ON F01+F02 TAG INSCH1 
*!*	       SET ORDER TO INSCH1
       IF _TALLY>0
          INSCH_SEEK=CREATEOBJECT("INSCH_SEEK")  
          INSCH_SEEK.SHOW           
       ELSE
          =MESSAGEBOX('此項料品已無採購訂單,請洽採購人員查詢',0+48,'提示訊息視窗')
       ENDIF
       SELE C05
       THISFORM.GRID1.SETFOCUS
  ENDPROC
*********************************查看進出明細
  PROC IODT_BOTT.CLICK
            LK=C05.F02
            LV=C05.F03
            SELE D07.F01,D07.F03,D07.F04,D07.F05,D07.F07,D07.F09 FROM D07 WHERE D07.F02=LK INTO CURSOR IODT1 ORDER BY F03,F01 &&NOWAIT&&
            SELE E06.F01,E06.F03,E06.F04,E06.F05,E06.F07,E06.F09 FROM E06 WHERE E06.F02=LK INTO CURSOR IODT3 ORDER BY F03,F01 &&NOWAIT&&            
            SELE C05.F01,C05.F03,C05.F04,C05.F06,C05.F09 FROM C05 WHERE C05.F02=LK AND !EMPTY(C05.F15)  INTO CURSOR IODT2  ORDER BY F03,F01 &&NOWAIT&&
            SELE E16.F01,E16.F03,E16.F04,E16.F06,E16.F09 FROM E16 WHERE E16.F02=LK INTO CURSOR IODT4 ORDER BY F03,F01 &&NOWAIT&&         
            CREATE CURSOR IODT(F01 C(12),F03 D(8),F04 N(13,3),F08 N(13,3),F05 C(50))
            INDE ON DTOS(F03)+F01 TAG IODT
            SET ORDER TO 1
            SELE IODT1
            GO TOP
            IDEN=0
            DO WHILE !EOF()
               SELE IODT
               APPEND BLANK
               REPL F01 WITH ALLTRIM(IODT1.F01)+IIF(IDEN>0,CHR(IDEN),'')
               REPL F03 WITH IODT1.F03
               REPL F04 WITH IODT1.F04
               REPL F05 WITH '採:'+IODT1.F05+PADL(IIF(SEEK(IODT1.F05,'D01'),D01.F04,''),8,' ')+IIF(IODT1.F09='1','  ','><')+IIF(!EMPTY(IODT1.F07),'請:','')+IODT1.F07
               SELE IODT1
               SKIP
               IF LEFT(IODT.F01,10)=F01
                  IDEN=IDEN+1
               ELSE
                  IDEN=0                 
               ENDIF
            ENDDO   
            USE
            SELE IODT3
            GO TOP
            DO WHILE !EOF()
               SELE IODT
               APPEND BLANK
               REPL F01 WITH IODT3.F01
               REPL F03 WITH IODT3.F03
               REPL F04 WITH IODT3.F04
               REPL F05 WITH '產:'+IODT3.F05+PADL(IIF(SEEK(IODT3.F05,'A14'),A14.F02,''),8,' ')+IIF(IODT3.F09='1','  ','><')+'出:'+IODT3.F07+IIF(SEEK(IODT3.F07,'C01'),C01.F05,'')
               SELE IODT3
               SKIP
            ENDDO   
            USE
            SELE IODT2
            GO TOP
            DO WHILE !EOF()
               SELE IODT
               APPEND BLANK
               REPL F01 WITH IODT2.F01
               REPL F03 WITH IODT2.F03
               REPL F04 WITH IODT2.F04*(-1)
               REPL F05 WITH '出:'+IODT2.F06+IIF(SEEK(IODT2.F06,'C01'),C01.F05,' ')+'  單:'+IODT2.F09 
               SELE IODT2
               SKIP
            ENDDO   
            USE
            SELE IODT4
            GO TOP
            DO WHILE !EOF()
               SELE IODT
               APPEND BLANK
               REPL F01 WITH IODT4.F01
               REPL F03 WITH IODT4.F03
               REPL F04 WITH IODT4.F04*(-1)
               REPL F05 WITH '領:'+IODT4.F06+IIF(SEEK(IODT4.F06,'A14'),A14.F02,' ')+'  成:'+IODT4.F09          
               SELE IODT4
               SKIP
            ENDDO       
            USE                             
            ORD_NO=C05.F01 &&訂單號碼
            STD_NO=C05.F02 &&料號
            DTE_NO=C05.F03 &&希望交期  
            SELECT IODT 
            GO TOP
            IF _TALLY>0 
                IODT_SEEK=CREATEOBJECT("IODT_SEEK")  
                IODT_SEEK.SHOW  
	        ELSE
	          =MESSAGEBOX('無此料品之預期異動',0+48,'提示訊息視窗')
	        ENDIF          
            AREA1='C05' 
            SELECT C05
           THISFORM.GRID1.SETFOCUS    
  **********
 PROC REPLY_REMARK.CLICK &&修改出貨日期與備註 
       SELECT C05
     IF A02.F09 = '*' OR IIF(SEEK(C05.F06,'C01'),C01.F18 = SYS_OPER OR C01.F23 = SYS_OPER OR C01.F33 = SYS_OPER,.F.) OR LEFT(ALLTRIM(C05.F06),1)='V'  &&判斷有無修改回覆與備註的權
	   THISFORM.YES.VISIBLE=.T.
	   THISFORM.NO.VISIBLE=.T.	
	   THISFORM.LBLF071.VISIBLE=.F.
	   THISFORM.KEY_LIST.ENABLED=.F.
	   THISFORM.GRID1.ENABLED=.F.
	   THISFORM.INV_BOTT.ENABLED=.F.
	   THISFORM.REPLY_REMARK.ENABLED=.F.
	   THISFORM.IODT_BOTT.ENABLED=.F.
	   THISFORM.BACK_BOT.ENABLED=.F.
	   THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
	   THISFORM.ORPGROUP.ESC_BOTT.ENABLED=.F.
	   THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
	   THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
	   THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
	   THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
	   THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F. 
	   THISFORM.INSCH.ENABLED=.F.
	   THISFORM.OUMNY.ENABLED=.F.
	   THISFORM.SETALL('READONLY',.F.,'TEXTBOX') 
	   THISFORM.LBLF071.CAPTION=''
	   THISFORM.TXTF01.SETFOCUS
	   LOCK()
	    IF !RLOCK()
		 DO FILE_IMPACT
		 RETURN
	    ENDIF 
     ELSE
	    =MESSAGEBOX('您不是此筆訂單之負責人員,無權回覆出貨日期!',0+64,'提示視窗')
	    THISFORM.GRID1.SETFOCUS  
     ENDIF   
 ENDPROC
*********** 
 PROC YES.CLICK &&修改確認 
    IF C05.F05<>0 AND C05.F10<>THISFORM.TXTF01.VALUE
       =MESSAGEBOX('請先刪除此筆未過帳出貨單或取消單再來修改回覆日期',0+48,'提示訊息視窗')
       
       THISFORM.NO.CLICK
    ENDIF
    IF !USED('E08')
       SELE 0
       USE E08
    ELSE
       SELE E08
    ENDIF
    SET ORDER TO E083   
    SELECT C05        
     IF  RLOCK()
     	 SELECT C05
     	 C05F10 = C05.F10
     	 REPLACE C05.F07 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
     	 REPLACE C05.F10 WITH THISFORM.TXTF01.VALUE
     	 REPLACE C05.F11 WITH THISFORM.TXTF02.VALUE
     	 REPLACE C05.F12 WITH ''        	   
     	 IF THISFORM.TXTF01.VALUE-DATE()>1825  &&若出貨日期超過五年視同暫時取消
     	 
     	    REPLACE F15 WITH ''
     	    SELECT TKE08
     	    SEEK C05.F02+DTOS(C05.F03)+C05.F01
     	    IF FOUND()
     	       DELETE 
     	    ENDIF
     	    SELECT E08   &&預期結餘也要增加
     	    SEEK C05.F02
     	    IF FOUND()
     	       REPLACE F20 WITH F20+C05.F04
     	    ELSE
     	       APPEND BLANK
     	       REPLACE F01 WITH C05.F03
     	       REPLACE F02 WITH C05.F02
     	       REPLACE F20 WITH C05.F04
     	    ENDIF
     	 ELSE 
     	    IF EMPTY(ALLTRIM(C05.F15)) AND LEFT(C05.F01,8)<>'備料紀錄'
     	       REPLACE C05.F15 WITH IIF(SEEK(C05.F01,'C03','C031'),C03.F15,'1') &&BACKHERE
     	       SELECT TKE08
     	       APPEND BLANK
     	       REPLACE F01 WITH C05.F01
     	       REPLACE F02 WITH C05.F02
     	       REPLACE F03 WITH C05.F03
     	       REPLACE F04 WITH C05.F04*(-1)     	   
     	       SELECT E08   &&預期結餘也要扣除
     	       SEEK C05.F02
     	       IF FOUND()
     	          REPLACE F20 WITH F20+C05.F04*(-1)
     	       ELSE
     	          APPEND BLANK
     	          REPLACE F01 WITH C05.F03
     	          REPLACE F02 WITH C05.F02
     	          REPLACE F20 WITH C05.F04*(-1)
     	       ENDIF    
     	    ENDIF
     	 ENDIF

     	 IF C05F10 <> C05.F10 AND ALLTRIM(INT_DNS) <> 'FALSE' AND ALLTRIM(INT_MAI) <> 'FALSE' &&發送MAIL
     	    MAIL_TEXT = ''
     	    TMPCHR=IIF(OS()="Windows 5.01",CHR(13)+CHR(10),'<br/>')
     	    FNTCHG1=IIF(OS()="Windows 5.01","","<font color='blue'>")
            FNTCHG2=IIF(OS()="Windows 5.01","","</font>")
     	    WAIT WINDOW "傳送郵件,請稍後!" AT 0,150 NOWAIT NOCLEAR
     	    MAIL_TEXT =  '客戶名稱：' + C05.F06 + SPACE(2) + IIF(SEEK(C05.F06,'C01'),C01.F04,'') + TMPCHR + ;
     	                 '單據編號：' + C05.F01 +TMPCHR + ;
     	                 '料品編號：' + C05.F02 + TMPCHR + ;
     	                 '希望交期：' + DTCX(C05.F03) + TMPCHR + ;
     	                 '出貨日期：' + IIF(C05F10<>C05.F10,FNTCHG1,'')+DTCX(C05F10) + '  ＞＞  ' + DTCX(C05.F10)+IIF(C05F10<>C05.F10,FNTCHG2,'') +TMPCHR + ;
     	                 '出貨數量：' + ALLTRIM(TRANSFORM(C05.F04,'@R 999,999,999,999')) + TMPCHR + ;
     	                 '備註說明：' + C05.F11 + CHR(13) + CHR(10)
     	    ***傳送給業務助理    	    
     	    IF SEEK(C05.F06,'C01') = .T. AND SEEK(C01.F23,'A01') = .T. AND ALLTRIM(A01.F06) = 'Y' AND AT('@',A01.F10) <> 0 AND ALLTRIM(SYS_OPER) <> ALLTRIM(C01.F23) AND LEFT(C05.F06,1) = 'C' AND EMPTY(MAIL_TEXT) = .F.
     	       ASSIS_NO=A01.F01
               IF OS()="Windows 5.01" 
       	          SEND_MAIL(ALLTRIM(INT_MAI),ALLTRIM(A01.F10),ALLTRIM(INT_DNS),'系統通知：C05.出貨計畫之 ' + C05.F01 + ' 回覆出貨日期已被更新','TEXT',MAIL_TEXT)  
       	       ELSE
       	          IF !EMPTY(ALLTRIM(ASSIS_NO))
                     FILE_NAME=ALLTRIM(INT_DAT)+ALLTRIM(ASSIS_NO)+'.TXT'                  
                     STRTOFILE('<TR><TD>'+MAIL_TEXT+'<TD>回覆出貨日期已被更新<TD>'+TTOC(DATETIME())+ CHR(13) + CHR(10),FILE_NAME,1) 
                  ENDIF   
       	       ENDIF
       	    ELSE
       	       ASSIS_NO=''                     
     	    ENDIF             
     	     ***傳送給業務B 
     	    IF SEEK(C05.F06,'C01') = .T. AND SEEK(C01.F33,'A01') = .T. AND ALLTRIM(A01.F06) = 'Y' AND AT('@',A01.F10) <> 0 AND ALLTRIM(SYS_OPER) <> ALLTRIM(C01.F23) AND LEFT(C05.F06,1) = 'C' AND EMPTY(MAIL_TEXT) = .F.
     	       SALES_B_NO=A01.F01
                 IF SALES_B_NO<>ASSIS_NO
                    IF OS()="Windows 5.01"
     	               SEND_MAIL(ALLTRIM(INT_MAI),ALLTRIM(A01.F10),ALLTRIM(INT_DNS),'系統通知：C05.出貨計畫之 ' + C05.F01 + ' 回覆出貨日期已被更新','TEXT',MAIL_TEXT)      
     	            ELSE
     	               IF !EMPTY(ALLTRIM(SALES_B_NO))
                          FILE_NAME=ALLTRIM(INT_DAT)+ALLTRIM(SALES_B_NO)+'.TXT'                  
                          STRTOFILE('<TR><TD>'+MAIL_TEXT+'<TD>回覆出貨日期已被更新<TD>'+TTOC(DATETIME())+ CHR(13) + CHR(10),FILE_NAME,1) 
                       ENDIF    
     	            ENDIF 
     	         ENDIF
     	    ELSE
     	       SALES_B_NO=''          
     	    ENDIF     	    
     	    ***傳送給業務A
     	    IF SEEK(C05.F06,'C01') = .T. AND SEEK(C01.F18,'A01') = .T. AND ALLTRIM(A01.F06) = 'Y' AND AT('@',A01.F10) <> 0 AND ALLTRIM(SYS_OPER) <> ALLTRIM(C01.F23) AND LEFT(C05.F06,1) = 'C' AND EMPTY(MAIL_TEXT) = .F.
     	        SALES_A_NO=A01.F01
                 IF SALES_A_NO<>SALES_B_NO 
                    IF OS()="Windows 5.01"
     	               SEND_MAIL(ALLTRIM(INT_MAI),ALLTRIM(A01.F10),ALLTRIM(INT_DNS),'系統通知：C05.出貨計畫之 ' + C05.F01 + ' 回覆出貨日期已被更新','TEXT',MAIL_TEXT)   
     	            ELSE
     	               IF !EMPTY(ALLTRIM(SALES_A_NO))
                          FILE_NAME=ALLTRIM(INT_DAT)+ALLTRIM(SALES_A_NO)+'.TXT'                  
                          STRTOFILE('<TR><TD>'+MAIL_TEXT+'<TD>>回覆出貨日期已被更新<TD>'+TTOC(DATETIME())+ CHR(13) + CHR(10),FILE_NAME,1) 
                       ENDIF    
                    ENDIF    	       
     	       ENDIF                 
     	    ELSE
     	       SALES_A_NO=''   
     	    ENDIF     	    
     	   
     	    
     	    WAIT CLEAR
     	 ENDIF
     	 UNLOCK ALL
     ELSE 
          DO FILE_IMPACT          
         RETURN
     ENDIF	  
     SELECT E08
     USE
    THISFORM.NO.CLICK
 ENDPROC
 *********
 PROC NO.CLICK &&修改取消
   THISFORM.SETALL('READONLY',.T.,'TEXTBOX') 
   THISFORM.KEY_LIST.ENABLED=.T.
   THISFORM.YES.VISIBLE=.F.
   THISFORM.NO.VISIBLE=.F.
   THISFORM.LBLF071.VISIBLE=.T.
   THISFORM.INV_BOTT.ENABLED=.T.
   THISFORM.IODT_BOTT.ENABLED=.T.
   THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
   THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
   THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
   THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
   THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T. 
   THISFORM.ORPGROUP.ESC_BOTT.ENABLED=.T.
   THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限  
   THISFORM.OUMNY.ENABLED=IIF(A02.F10='*',.T.,.F.)   &&判斷有無查看預估銷售金額的權限  
   THISFORM.OUMNY.VISIBLE=IIF(A02.F10='*',.T.,.F.)   &&判斷有無查看預估銷售金額的權限  
   THISFORM.REPLY_REMARK.ENABLED=IIF(A02.F05='*',.T.,.F.) AND A02.F09 = '*' OR IIF(SEEK(C05.F06,'C01'),C01.F18 = SYS_OPER OR C01.F23 = SYS_OPER OR C01.F33 = SYS_OPER,.F.) OR LEFT(ALLTRIM(C05.F06),1)='V' &&判斷有無修改回覆交期與備註的權限
   THISFORM.BACK_BOT.ENABLED=.T.
   THISFORM.INSCH.ENABLED=.T.&&出貨計劃
   THISFORM.GRID1.ENABLED=.T.     
   THISFORM.GRID1.SETFOCUS
   UNLOCK ALL
   SELECT C05
   THISFORM.REFRESH
 ENDPROC
*********  
  PROC OUMNY.CLICK    &&預估銷售額
       FLG='0'
       SELECT  C05
       OUM_RANGE=CREATEOBJECT("OUM_RANGE")  
       OUM_RANGE.SHOW    
       IF FLG<>'1'
          =MESSAGEBOX('無此範圍資料',0+48,'警示')
       ENDIF   
       FLG='0'     
       THISFORM.GRID1.SETFOCUS
  ENDPROC 
ENDDEFINE  
***************************************備料作業 
DEFINE CLASS BACK_SEEK AS FORM
*!*	  AUTOCENTER=.T.
  FONTSIZE=INT_015*9
  TOP=INT_015*110
  LEFT=INT_015*40    
  HEIGHT=INT_015*325
  WIDTH=INT_015*710
  FONTSIZE=INT_015*9
  MOVABLE=.T.
  MAXBUTTON=.F.
  MINBUTTON=.F.      
  CONTROLBOX=.F.
  BORDERSTYLE=2
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WINDOWTYPE=1
  NAME='BACK_SEEK'
    ADD OBJECT KEY_LIST AS KEY_LIST WITH;
      AUTOCENTER=.T.,;
      LEFT=INT_015*10,;
      AUTOSIZE=.T.
  ADD OBJECT GRID1 AS GRID WITH;       
      HIGHLIGHTROWLINEWIDTH=4,; 
      TOP=INT_015*90,;
      WIDTH=INT_015*710,;      
      HEIGHT=INT_015*230,;     
      ROWHEIGHT=INT_015*18,;
      HEADERHEIGHT=INT_015*19,; 
      DELETEMARK=.F.,;
      READONLY=.T.,;
      RECORDSOURCETYPE=1,;
      RECORDSOURCE='C05_BACK',;
      COLUMNCOUNT=6,;            
      NAME='GRID1',;
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;      
      COLUMN3.NAME='COLUMN3',; 
      COLUMN4.NAME='COLUMN4',;      
      COLUMN5.NAME='COLUMN5',;
      COLUMN6.NAME='COLUMN6'    
  ADD OBJECT CMDGROUP AS CMDGROUP WITH;      
      TOP=INT_015*55,;
      LEFT=INT_015*300
  ADD OBJECT ORPGROUP AS ORPGROUP WITH;    
      TOP=INT_015*55,;
      LEFT=INT_015*510             
  ADD OBJECT SHRGROUP AS SHRGROUP WITH;
      TOP=INT_015*26,;
      LEFT=INT_015*593      
  ADD OBJECT CMND1 AS COMMANDBUTTON WITH;
      LEFT=INT_015*640,;
      TOP=INT_015*60,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\harrow.CUR',;
      CAPTION='\<X.離開',;
      TOOLTIPTEXT='取消此作業畫面!快速鍵->ALT+X'
      NAME='CMND1'  
  ADD OBJECT LBLF06 AS LABEL WITH;
      TOP=INT_015*10,;
      LEFT=INT_015*260,;
      HEIGHT=INT_015*17,;      
      WIDTH=INT_015*60,;
      CAPTION='客戶編號'
  ADD OBJECT LBLF061 AS LABEL WITH;
      TOP=INT_015*10,;
      LEFT=INT_015*375,;
      AUTOSIZE=.T.,;
      CAPTION='' 
  ADD OBJECT TXTF06 AS TXTF06 WITH;
      TOP=INT_015*5,;
      LEFT=INT_015*315,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*50,;
      MAXLENGTH=5
  ADD OBJECT LBLF02 AS LABEL WITH;
      TOP=INT_015*36,;
      LEFT=INT_015*10,;
      HEIGHT=INT_015*17,;      
      WIDTH=INT_015*60,;
      CAPTION='料品編號' 
  ADD OBJECT LBLF021 AS LABEL WITH;
      TOP=INT_015*36,;
      LEFT=INT_015*375,;
	  AUTOSIZE=.T.,;
      CAPTION=''             
  ADD OBJECT TXTF02 AS TXTF02 WITH;
      TOP=INT_015*31,;
      LEFT=INT_015*65,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*300,;
      MAXLENGTH=43     
  ADD OBJECT LBLF07 AS LABEL WITH; &&安全資料
      TOP=INT_015*36,;
      LEFT=INT_015*375,;
	  AUTOSIZE=.T.,;
      CAPTION=''
  ADD OBJECT LBLF11 AS LABEL WITH;
      TOP=INT_015*62,;
      LEFT=INT_015*10,;
      HEIGHT=INT_015*17,;      
      WIDTH=INT_015*60,;
      CAPTION='備註說明'
  ADD OBJECT TXTF11 AS TEXTBOX WITH;
      TOP=INT_015*57,;
      LEFT=INT_015*65,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*300,;
      MAXLENGTH=60
      PROCEDURE INIT 
         AREA1='C05_BACK' 
         SELECT C05_BACK
         SEEK C05.F02 + C05.F06
         THISFORM.CAPTION='備料紀錄表'    
         THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'COLUMN')
         THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'HEADER')
         THISFORM.GRID1.READONLY=.T. 
         THISFORM.SHRGROUP.VISIBLE=.F.
         THISFORM.SHRGROUP.ENABLED=.F.
         THISFORM.CMDGROUP.TOP_BOTT.VISIBLE=.F. 
         THISFORM.CMDGROUP.UP_BOTT.VISIBLE=.F.
         THISFORM.CMDGROUP.NEXT_BOTT.VISIBLE=.F.
         THISFORM.CMDGROUP.END_BOTT.VISIBLE=.F.
         THISFORM.ORPGROUP.PNT_BOTT.VISIBLE=.F.   
         THISFORM.ORPGROUP.ESC_BOTT.VISIBLE=.F.
       	 THISFORM.SETALL('HEIGHT',INT_015*25,'TEXTBOX')
       	 THISFORM.SETALL('HEIGHT',INT_015*17,'LABEL')     
      	 THISFORM.SETALL('FONTSIZE',INT_015*9,'TEXTBOX')
       	 THISFORM.SETALL('FONTSIZE',INT_015*9,'LABEL')         
       	 THISFORM.SETALL('READONLY',.T.,'TEXTBOX')
         THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='料品編號'
         THISFORM.GRID1.COLUMN1.CONTROLSOURCE='C05_BACK.F02'
         THISFORM.GRID1.COLUMN1.WIDTH=INT_015*195
         THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='日    期'
         THISFORM.GRID1.COLUMN2.WIDTH=INT_015*60
         THISFORM.GRID1.COLUMN2.CONTROLSOURCE='C05_BACK.F03'         
         THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='客戶簡稱'
         THISFORM.GRID1.COLUMN3.CONTROLSOURCE="IIF(SEEK(C05_BACK.F06,'C01'),C01.F05,'')"
         THISFORM.GRID1.COLUMN3.WIDTH=INT_015*55
         THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='業務' + ALLTRIM(INT_209)        
         THISFORM.GRID1.COLUMN4.CONTROLSOURCE="IIF(SEEK(C05_BACK.F08,'A01'),A01.F03,'')"
         THISFORM.GRID1.COLUMN4.WIDTH=INT_015*55
         THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='負責業助'         
         THISFORM.GRID1.COLUMN5.CONTROLSOURCE="IIF(SEEK(C05_BACK.F13,'A01'),A01.F03,'')"
         THISFORM.GRID1.COLUMN5.WIDTH=INT_015*55    
         THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='備註說明'         
         THISFORM.GRID1.COLUMN6.CONTROLSOURCE='C05_BACK.F11'
         THISFORM.GRID1.COLUMN6.WIDTH=INT_015*250                   
         THISFORM.GRID1.SETFOCUS 
      ENDPROC 
      PROC GRID1.AFTERROWCOLCHANGE
           LPARAMETERS XCOLINDEX
           THISFORM.TXTF02.VALUE = C05_BACK.F02
           THISFORM.TXTF06.VALUE = C05_BACK.F06
           THISFORM.TXTF11.VALUE = C05_BACK.F11
           THISFORM.LBLF021.CAPTION = IIF(SEEK(C05_BACK.F02,'B01'),B01.F02,'')
           THISFORM.LBLF061.CAPTION = IIF(SEEK(C05_BACK.F06,'C01'),C01.F04,'')
           THISFORM.LBLF07.CAPTION = '安全資料 ' + C05_BACK.F07
           IF A02.F09 = '*'
              THISFORM.ORPGROUP.EDIT_BOTT.ENABLED = .T.
              THISFORM.ORPGROUP.DEL_BOTT.ENABLED = .T.
           ELSE
              THISFORM.ORPGROUP.EDIT_BOTT.ENABLED = IIF(SEEK(C05_BACK.F06,'C01'),C01.F18 = SYS_OPER OR C01.F23 = SYS_OPER OR C01.F33 = SYS_OPER,.F.)
              THISFORM.ORPGROUP.DEL_BOTT.ENABLED = IIF(SEEK(C05_BACK.F06,'C01'),C01.F18 = SYS_OPER OR C01.F23 = SYS_OPER OR C01.F33 = SYS_OPER,.F.)
           ENDIF
      ENDPROC 
  PROC KEY_LIST.INIT 
       WITH THIS 
           .ADDITEM('依料號+客戶編號+業務編號排列')
           .ADDITEM('依客戶編號+料號+業務編號排列')
           .ADDITEM('依業務' + ALLTRIM(INT_209) + '編號+客戶編號+料號排列')
           .ADDITEM('依業助編號+客戶編號+料號排列')
           .VALUE=1      
       ENDWITH      
  ENDPROC 
  PROC KEY_LIST.INTERACTIVECHANGE                 
       SELECT C05_BACK
       DO CASE
       	  CASE THIS.DISPLAYVALUE='依料號+客戶編號+業務編號排列'
       	  	   SET ORDER TO C05_BACK1
		       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='料品編號'
		       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='C05_BACK.F02'
		       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*195
		       THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='日    期'
		       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*60
		       THISFORM.GRID1.COLUMN2.CONTROLSOURCE='C05_BACK.F03'         
		       THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='客戶簡稱'
		       THISFORM.GRID1.COLUMN3.CONTROLSOURCE="IIF(SEEK(C05_BACK.F06,'C01'),C01.F05,'')"
		       THISFORM.GRID1.COLUMN3.WIDTH=INT_015*55
		       THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='業務' + ALLTRIM(INT_209)        
		       THISFORM.GRID1.COLUMN4.CONTROLSOURCE="IIF(SEEK(C05_BACK.F08,'A01'),A01.F03,'')"
		       THISFORM.GRID1.COLUMN4.WIDTH=INT_015*55
		       THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='負責業助'         
		       THISFORM.GRID1.COLUMN5.CONTROLSOURCE="IIF(SEEK(C05_BACK.F13,'A01'),A01.F03,'')"
		       THISFORM.GRID1.COLUMN5.WIDTH=INT_015*55    
		       THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='備註說明'         
		       THISFORM.GRID1.COLUMN6.CONTROLSOURCE='C05_BACK.F11'
		       THISFORM.GRID1.COLUMN6.WIDTH=INT_015*250  
		       JK = '料品編號'
       	  CASE THIS.DISPLAYVALUE='依客戶編號+料號+業務編號排列'
       	       SET ORDER TO C05_BACK2
		       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='客戶簡稱'
		       THISFORM.GRID1.COLUMN1.CONTROLSOURCE="IIF(SEEK(C05_BACK.F06,'C01'),C01.F05,'')"
		       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*55
		       THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='料品編號'
		       THISFORM.GRID1.COLUMN2.CONTROLSOURCE='C05_BACK.F02'
		       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*195
		       THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='日    期'
		       THISFORM.GRID1.COLUMN3.WIDTH=INT_015*60
		       THISFORM.GRID1.COLUMN3.CONTROLSOURCE='C05_BACK.F03'         
		       THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='業務' + ALLTRIM(INT_209)            
		       THISFORM.GRID1.COLUMN4.CONTROLSOURCE="IIF(SEEK(C05_BACK.F08,'A01'),A01.F03,'')"
		       THISFORM.GRID1.COLUMN4.WIDTH=INT_015*55
		       THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='負責業助'         
		       THISFORM.GRID1.COLUMN5.CONTROLSOURCE="IIF(SEEK(C05_BACK.F13,'A01'),A01.F03,'')"
		       THISFORM.GRID1.COLUMN5.WIDTH=INT_015*55    
		       THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='備註說明'         
		       THISFORM.GRID1.COLUMN6.CONTROLSOURCE='C05_BACK.F11'
		       THISFORM.GRID1.COLUMN6.WIDTH=INT_015*250 
		       JK = '客戶編號'
       	  CASE THIS.DISPLAYVALUE='依業務' + ALLTRIM(INT_209) + '編號+客戶編號+料號排列'
       	       SET ORDER TO C05_BACK3
		       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='負責業務' + ALLTRIM(INT_209)            
		       THISFORM.GRID1.COLUMN1.CONTROLSOURCE="IIF(SEEK(C05_BACK.F08,'A01'),A01.F03,'')"
		       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*55
		       THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='客戶簡稱'
		       THISFORM.GRID1.COLUMN2.CONTROLSOURCE="IIF(SEEK(C05_BACK.F06,'C01'),C01.F05,'')"
		       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*55
		       THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='料品編號'
		       THISFORM.GRID1.COLUMN3.CONTROLSOURCE='C05_BACK.F02'
		       THISFORM.GRID1.COLUMN3.WIDTH=INT_015*195
		       THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='日    期'
		       THISFORM.GRID1.COLUMN4.WIDTH=INT_015*60
		       THISFORM.GRID1.COLUMN4.CONTROLSOURCE='C05_BACK.F03'         
		       THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='業助'         
		       THISFORM.GRID1.COLUMN5.CONTROLSOURCE="IIF(SEEK(C05_BACK.F13,'A01'),A01.F03,'')"
		       THISFORM.GRID1.COLUMN5.WIDTH=INT_015*55    
		       THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='備註說明'         
		       THISFORM.GRID1.COLUMN6.CONTROLSOURCE='C05_BACK.F11'
		       THISFORM.GRID1.COLUMN6.WIDTH=INT_015*250  
		       JK = '業務' + ALLTRIM(INT_209) + '編號' 
       	  CASE THIS.DISPLAYVALUE='依業助編號+客戶編號+料號排列'
       	       SET ORDER TO C05_BACK4
		       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='負責業助'         
		       THISFORM.GRID1.COLUMN1.CONTROLSOURCE="IIF(SEEK(C05_BACK.F13,'A01'),A01.F03,'')"
		       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*55 
		       THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='客戶簡稱'
		       THISFORM.GRID1.COLUMN2.CONTROLSOURCE="IIF(SEEK(C05_BACK.F06,'C01'),C01.F05,'')"
		       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*55
		       THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='料品編號'
		       THISFORM.GRID1.COLUMN3.CONTROLSOURCE='C05_BACK.F02'
		       THISFORM.GRID1.COLUMN3.WIDTH=INT_015*195
		       THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='日    期'
		       THISFORM.GRID1.COLUMN4.WIDTH=INT_015*60
		       THISFORM.GRID1.COLUMN4.CONTROLSOURCE='C05_BACK.F03'         
		       THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='負責業務' + ALLTRIM(INT_209)            
		       THISFORM.GRID1.COLUMN5.CONTROLSOURCE="IIF(SEEK(C05_BACK.F08,'A01'),A01.F03,'')"
		       THISFORM.GRID1.COLUMN5.WIDTH=INT_015*55
		       THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='備註說明'         
		       THISFORM.GRID1.COLUMN6.CONTROLSOURCE='C05_BACK.F11'
		       THISFORM.GRID1.COLUMN6.WIDTH=INT_015*250 
		       JK = '業助編號'
       ENDCASE
       THISFORM.GRID1.REFRESH
       THISFORM.GRID1.SETFOCUS       	  
  PROCEDURE CMND1.CLICK
          AREA1='C05'
         THISFORM.RELEASE
  ENDPROC  
  PROCEDURE ORPGROUP.NEW_BOTT.CLICK 
   THISFORM.CMND1.ENABLED=.F.    
   THISFORM.GRID1.ENABLED=.F. 
   THISFORM.KEY_LIST.ENABLED=.F.
   THISFORM.SETALL('READONLY',.F.,'TEXTBOX') 
   THISFORM.TXTF02.READONLY=.F.
   THISFORM.TXTF06.READONLY=.F. 
   THISFORM.TXTF02.VALUE=''
   THISFORM.TXTF06.VALUE=''
   THISFORM.TXTF11.VALUE='備料'
   THISFORM.LBLF021.CAPTION = ''
   THISFORM.LBLF061.CAPTION = ''
   THISFORM.LBLF07.CAPTION = ''
   THISFORM.TXTF06.SETFOCUS
  ENDPROC     
  PROCEDURE SHRGROUP.SHURE1_BOTT.CLICK               &&新增確認
       IF SEEK(THISFORM.TXTF02.VALUE,'B01')=.F. OR EMPTY(THISFORM.TXTF02.VALUE)
          =MESSAGEBOX('物料基本主檔中無此料號!',0+64,'提示訊息視窗')
          THISFORM.TXTF02.SETFOCUS
          RETURN            
       ENDIF       
       IF SEEK(THISFORM.TXTF06.VALUE,'C01')=.F. OR EMPTY(THISFORM.TXTF06.VALUE)
          =MESSAGEBOX('無此客戶編號請先建立!',0+64,'提示訊息視窗')
          THISFORM.TXTF06.SETFOCUS
          RETURN            
       ENDIF 
       IF EMPTY(THISFORM.TXTF11.VALUE)
          =MESSAGEBOX('備註說明不得空白!',0+64,'提示訊息視窗')
          THISFORM.TXTF11.SETFOCUS
          RETURN            
       ENDIF 
     IF A02.F09 = '*' OR IIF(SEEK(THISFORM.TXTF06.VALUE,'C01'),C01.F18 = SYS_OPER OR C01.F23 = SYS_OPER OR C01.F33 = SYS_OPER,.F.)    
       SELECT C05_BACK          
       APPEND BLANK
       LOCK()
       IF RLOCK()
          REPLACE F01 WITH '備料紀錄'
          REPLACE F02 WITH THISFORM.TXTF02.VALUE
          REPLACE F03 WITH DATE()
          REPLACE F04 WITH 1
          REPLACE F06 WITH THISFORM.TXTF06.VALUE
          REPLACE F07 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
          REPLACE F08 WITH IIF(SEEK(THISFORM.TXTF06.VALUE,'C01'),IIF(INT_209 = 'A',C01.F18,C01.F33),sys_oper)
          REPLACE F11 WITH THISFORM.TXTF11.VALUE
          REPLACE F12 WITH '1'
          REPLACE F13 WITH IIF(SEEK(THISFORM.TXTF06.VALUE,'C01'),C01.F23,sys_oper)
          SELECT C05
          APPEND BLANK
          LOCK()
          IF RLOCK()
          	 REPLACE C05.F01 WITH C05_BACK.F01 
         	 REPLACE C05.F02 WITH C05_BACK.F02
          	 REPLACE C05.F03 WITH C05_BACK.F03
          	 REPLACE C05.F04 WITH C05_BACK.F04
          	 REPLACE C05.F06 WITH C05_BACK.F06
          	 REPLACE C05.F07 WITH C05_BACK.F07
         	 REPLACE C05.F08 WITH C05_BACK.F08
          	 REPLACE C05.F11 WITH C05_BACK.F11
          	 REPLACE C05.F12 WITH C05_BACK.F12
          	 REPLACE C05.F13 WITH C05_BACK.F13
          ENDIF
          SELECT C05_1
          SEEK C05_BACK.F06
          IF !FOUND()
              SELECT C05_1
              APPEND BLANK
              REPLACE C05_1.F06 WITH C05_BACK.F06
              REPLACE C05_1.EXP_2 WITH IIF(SEEK(C05_BACK.F06,'C01'),C01.F05,'')
          ENDIF
       ENDIF 
       THISFORM.SHRGROUP.ABANDON_BOTT.CLICK 
     ELSE
	    =MESSAGEBOX('您不是此客戶之負責人員,無權新增備料紀錄!',0+64,'提示視窗')
	    THISFORM.TXTF06.SETFOCUS 
     ENDIF     
  ENDPROC 
  PROCEDURE ORPGROUP.EDIT_BOTT.CLICK 
   THISFORM.CMND1.ENABLED=.F.    
   THISFORM.GRID1.ENABLED=.F. 
   THISFORM.KEY_LIST.ENABLED=.F.
   THISFORM.TXTF11.READONLY=.F. 
   THISFORM.TXTF11.SETFOCUS
  ENDPROC  
  PROCEDURE SHRGROUP.SHURE2_BOTT.CLICK               &&修改確認
       IF EMPTY(THISFORM.TXTF11.VALUE)
          =MESSAGEBOX('備註說明不得空白!',0+64,'提示訊息視窗')
          THISFORM.TXTF11.SETFOCUS
          RETURN            
       ENDIF 
       SELECT C05
       SET ORDER TO C057   && F06+F01+F02
       SEEK  C05_BACK.F06 + C05_BACK.F01 + C05_BACK.F02
       IF FOUND()
          SELECT C05
          REPLACE C05.F07 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
          REPLACE C05.F11 WITH THISFORM.TXTF11.VALUE
          SELECT C05_BACK
          REPLACE C05_BACK.F07 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
          REPLACE C05_BACK.F11 WITH THISFORM.TXTF11.VALUE
       ENDIF
	   THISFORM.SHRGROUP.ABANDON_BOTT.CLICK  
  ENDPROC 
  PROC ORPGROUP.DEL_BOTT.CLICK  
       IF MESSAGEBOX('是否確認要刪除此筆資料?',4+32+256,'請確認') = 6	
          SELECT C05
          SET ORDER TO C057   && F06+F01+F02
          SEEK  C05_BACK.F06 + C05_BACK.F01 + C05_BACK.F02
          IF FOUND()
             DELETE 
          ENDIF
          SELECT C05_BACK
          DELETE 
       ENDIF
       THISFORM.SHRGROUP.ABANDON_BOTT.CLICK  
  ENDPROC 
  PROCEDURE SHRGROUP.ABANDON_BOTT.CLICK
      SELECT C05_BACK
      THISFORM.CMND1.ENABLED=.T.
      THISFORM.KEY_LIST.ENABLED=.T.
      THISFORM.SHRGROUP.ENABLED=.F.
      THISFORM.SHRGROUP.VISIBLE=.F.      
      THISFORM.ORPGROUP.ENABLED=.T.
      THISFORM.ORPGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
      THISFORM.CMDGROUP.ENABLED=.T.
      THISFORM.CMDGROUP.SETALL('ENABLED',.T.,'COMMANDBUTTON')
      THISFORM.CMDGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
      THISFORM.SETALL('READONLY',.T.,'TEXTBOX')  
      THISFORM.TXTF02.READONLY=.T.
      THISFORM.TXTF06.READONLY=.T.   
      THISFORM.GRID1.ENABLED=.T.
      THISFORM.GRID1.SETFOCUS      
      UNLOCK ALL
  ENDPROC
  PROCEDURE SHRGROUP.FINISH_BOTT.CLICK
       THISFORM.SHRGROUP.ABANDON_BOTT.CLICK
  ENDPROC       
ENDDEFINE       
***********************************************預出貨金額列印範圍
DEFINE CLASS OUM_RANGE AS FORM
*!*	       AUTOCENTER=.T.
   CAPTION='請輸入銷售預估資料範圍'
   TOP=INT_015*180
   LEFT=INT_015*220          
   FONTSIZE=INT_015*9
   HEIGHT=INT_015*170
   WIDTH=INT_015*355
   FONTSIZE=INT_015*9
   MOVABLE=.F.
   MAXBUTTON=.F.
   MINBUTTON=.F.      
   CONTROLBOX=.F.
   BORDERSTYLE=2
   SHOWTIPS=.T.
   SHOWWINDOW=1
   WINDOWTYPE=1
   NAME='ANS_RANGE'
   ADD OBJECT LABEL1 AS LABEL WITH;
       WIDTH=INT_015*50.,;
       HEIGHT=INT_015*25,;
       LEFT=INT_015*30,;
       TOP=INT_015*10,;
       CAPTION='起始日期',;
       NAME='LABEL1'
   ADD OBJECT TEXT1 AS TEXTBOX WITH;
       WIDTH=INT_015*75,;
       TOP=INT_015*5,;
       LEFT=INT_015*80,;
       HEIGHT=INT_015*25,; 
       NAME='TEXT1'           
   ADD OBJECT LABEL2 AS LABEL WITH;
       WIDTH=INT_015*50.,;
       HEIGHT=INT_015*25,;
       LEFT=INT_015*200,;
       TOP=INT_015*10,;
       CAPTION='截止日期',;
       NAME='LABEL2'
   ADD OBJECT TEXT2 AS TEXTBOX WITH;
       WIDTH=INT_015*75.,;
       TOP=INT_015*5,;
       LEFT=INT_015*250,;
       HEIGHT=INT_015*25,;         
       NAME='TEXT2'              
   ADD OBJECT LABEL3 AS LABEL WITH;
       WIDTH=INT_015*50.,;
       HEIGHT=INT_015*25,;    
       LEFT=INT_015*30,;
       TOP=INT_015*50,;
       CAPTION='起始客戶',;
       NAME='LABEL3'          
   ADD OBJECT TEXT3 AS TEXTBOX WITH;
       WIDTH=INT_015*75,;
       TOP=INT_015*45,;
       LEFT=INT_015*80,;
       HEIGHT=INT_015*25,; 
       MAXLENGTH=5,;
       NAME='TEXT3'            
   ADD OBJECT LABEL4 AS LABEL WITH;
      WIDTH=INT_015*50.,;
       HEIGHT=INT_015*25,;
       LEFT=INT_015*200,;
       TOP=INT_015*50,;
       CAPTION='截止客戶',;
       NAME='LABEL4'           
   ADD OBJECT TEXT4 AS TEXTBOX WITH;
       WIDTH=INT_015*75,;
       TOP=INT_015*45,;
       LEFT=INT_015*250,;
       HEIGHT=INT_015*25,;         
       MAXLENGTH=5,;           
       NAME='TEXT4'               
  ADD OBJECT OUM_OPTION AS OPTIONGROUP WITH;
      LEFT=INT_015*90,;
      TOP=INT_015*80,;
      HEIGHT=INT_015*25,;    
      WIDTH=INT_015*185,;      
      BUTTONCOUNT=2,;
      OPTION1.CAPTION='已回覆交期',;
      OPTION1.FONTSIZE=INT_015*9,;
      OPTION1.LEFT=INT_015*4,;
      OPTION1.TOP=INT_015*3,;
      OPTION1.AUTOSIZE=.T.,;
      OPTION2.CAPTION='未回覆交期',;
      OPTION2.FONTSIZE=INT_015*9,;
      OPTION2.LEFT=INT_015*100,;
      OPTION2.TOP=INT_015*3,;
      OPTION2.AUTOSIZE=.T.,;      
      NAME='OUM_OPTION'                  
  ADD OBJECT OUTTYPE_OPTION AS OPTIONGROUP WITH;
      LEFT=INT_015*90,;
      TOP=INT_015*105,;
      HEIGHT=INT_015*25,;    
      WIDTH=INT_015*185,;      
      BUTTONCOUNT=2,;
      OPTION1.CAPTION='列印報表',;
      OPTION1.FONTSIZE=INT_015*9,;
      OPTION1.LEFT=INT_015*4,;
      OPTION1.TOP=INT_015*3,;
      OPTION1.AUTOSIZE=.T.,;
      OPTION2.CAPTION='轉EXCEL',;
      OPTION2.FONTSIZE=INT_015*9,;
      OPTION2.LEFT=INT_015*100,;
      OPTION2.TOP=INT_015*3,;
      OPTION2.AUTOSIZE=.T.,;      
      NAME='OUTTYPE_OPTION'                                              
   ADD OBJECT CMND1 AS COMMANDBUTTON WITH;
       LEFT=INT_015*60,;    
       HEIGHT=INT_015*25,;   
       TOP=INT_015*140,;  
       WIDTH=INT_015*50,;
       CAPTION='\<Y.執  行',;
       TOOLTIPTEXT='確認所輸入的範圍鍵值!快速鍵->ALT+Y',;
       NAME='CMND1'
   ADD OBJECT CMND2 AS COMMANDBUTTON WITH;
       LEFT=INT_015*200,;
       TOP=INT_015*140,;
       HEIGHT=INT_015*25,;
       WIDTH=INT_015*50,;
       CAPTION='\<C.取  消',;
       TOOLTIPTEXT='取消作業!快速鍵->ALT+C',;
       NAME='CMND2'   
   PROCEDURE INIT 
      THISFORM.SETALL('FONTSIZE',INT_015*9,'TEXTBOX')
      THISFORM.SETALL('FONTSIZE',INT_015*9,'LABEL')      
      THISFORM.SETALL('FONTSIZE',INT_015*9,'COMMANDBUTTON') 
      THISFORM.SETALL('MOUSEPOINTER',99,'COMMANDBUTTON')
      THISFORM.SETALL('MOUSEICON','BMPS\harrow.CUR','COMMANDBUTTON')              
      THISFORM.OUM_OPTION.VALUE=1                
      THISFORM.OUTTYPE_OPTION.VALUE=1    
      THISFORM.TEXT1.VALUE=DATE()
      THISFORM.TEXT2.VALUE=DATE()+30
      THISFORM.TEXT3.VALUE=C05.F06
      THISFORM.TEXT4.VALUE=C05.F06                  
   ENDPROC             
   
   PROCEDURE CMND1.CLICK
    IF THISFORM.OUM_OPTION.VALUE=1
 	    SELECT  C05.F06 客戶編號,C05.F03 希望交期,C05.F01 訂單編號,C05.F02 料品編號,C05.F04 出貨數量,C05.F10 出貨日期,C01.F05 客戶簡稱,C04.F06 幣別,C04.F07 單價,C00.F02 匯率;
        FROM C05,C01,C04,C00 WHERE C05.F10>=THISFORM.TEXT1.VALUE AND C05.F10<=THISFORM.TEXT2.VALUE;
        AND C05.F06>=THISFORM.TEXT3.VALUE AND C05.F06<=THISFORM.TEXT4.VALUE AND C05.F15='1';       
        AND C01.F01=C05.F06 AND C04.F03+C04.F04=C05.F01+C05.F02 AND C00.F01=C04.F06 ;
        ORDER BY C05.F06,C05.F10,C05.F02 NOWAIT &&!EMPTY(C05.F10)
    ELSE
 	    SELECT  C05.F06 客戶編號,C05.F03 希望交期,C05.F01 訂單編號,C05.F02 料品編號,C05.F04 出貨數量,C05.F10 出貨日期,C01.F05 客戶簡稱,C04.F06 幣別,C04.F07 單價,C00.F02 匯率;
        FROM C05,C01,C04,C00 WHERE C05.F03>=THISFORM.TEXT1.VALUE AND C05.F03<=THISFORM.TEXT2.VALUE;
        AND C05.F06>=THISFORM.TEXT3.VALUE AND C05.F06<=THISFORM.TEXT4.VALUE AND C05.F15='1';       
        AND EMPTY(C05.F10) AND C01.F01=C05.F06 AND C04.F03+C04.F04=C05.F01+C05.F02 AND C00.F01=C04.F06 ;
        ORDER BY C05.F06,C05.F03,C05.F02 NOWAIT &&!EMPTY(C05.F10)    
    ENDIF    
        IF _TALLY>0
            GHK1=THISFORM.TEXT1.VALUE
            GHK2=THISFORM.TEXT2.VALUE
            GHK3=IIF(THISFORM.OUM_OPTION.VALUE=1,'已回覆交期','未回覆交期')
            IF THISFORM.OUTTYPE_OPTION.VALUE=1
               REPORT FORM ALLTRIM(INT_116)+'C05G' TO PRINT PROMPT PREVIEW 
            ELSE
               FILE_NAME=GHK3+'銷售預估'
               GCDELIMFILE=PUTFILE('儲存路徑',FILE_NAME,'XLS')
               COPY TO (GCDELIMFILE) TYPE XL5   
	            =MESSAGEBOX('儲存成功',0+64,'提示訊息視窗')
            ENDIF   
            FLG='1'                                    
        ENDIF
        THISFORM.RELEASE                   
   ENDPROC  
   PROCEDURE CMND2.CLICK
        FLG='1'   
        THISFORM.RELEASE                   
   ENDPROC                      
ENDDEFINE
***********************************************列印程序
PROCEDURE PNT_PRC  
   FLG='0'
   SELE C05
   ANS_RANGE=CREATEOBJECT("ANS_RANGE")  
   ANS_RANGE.SHOW    
   IF FLG<>'1'
       =MESSAGEBOX('無此範圍資料',0+48,'警示')
   ENDIF   
   FLG='0'     
ENDPROC
***********************************************列印範圍選定
DEFINE CLASS ANS_RANGE AS FORM
*!*	  AUTOCENTER=.T.
  CAPTION='請輸入資料範圍'
  TOP=INT_015*200
  LEFT=INT_015*200    
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*120
  WIDTH=INT_015*400
  FONTSIZE=INT_015*9
  MOVABLE=.F.
  MAXBUTTON=.F.
  MINBUTTON=.F.        
  CONTROLBOX=.F.
  BORDERSTYLE=2
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WINDOWTYPE=1
  NAME='ANS_RANGE'
  ADD OBJECT LABEL1 AS LABEL WITH;
      WIDTH=INT_015*50,;
      HEIGHT=INT_015*25,;
      LEFT=INT_015*30,;
      TOP=INT_015*20,;
      NAME='LABEL1'
  ADD OBJECT TEXT1 AS TEXTBOX WITH;
      TOP=INT_015*14,;
      LEFT=INT_015*80,;
      HEIGHT=INT_015*25,; 
      NAME='TEXT1'      
  ADD OBJECT LABEL2 AS LABEL WITH;
      WIDTH=INT_015*50,;
      HEIGHT=INT_015*25,;
      LEFT=INT_015*30,;
      TOP=INT_015*82,;
      NAME='LABEL2'
  ADD OBJECT TEXT2 AS TEXTBOX WITH;
      TOP=INT_015*76,;
      LEFT=INT_015*80,;
      HEIGHT=INT_015*25,;         
      NAME='TEXT2'    
  ADD OBJECT CMND1 AS COMMANDBUTTON WITH;
      LEFT=INT_015*300,;    
      HEIGHT=INT_015*25,;   
      TOP=INT_015*14,;  
      WIDTH=INT_015*70,;
      CAPTION='\<Y.列  印',;
      TOOLTIPTEXT='確認所輸入的範圍鍵值!快速鍵->ALT+Y',;
      NAME='CMND1'
  ADD OBJECT CMND2 AS COMMANDBUTTON WITH;
      LEFT=INT_015*300,;
      TOP=INT_015*45,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*70,;
      CAPTION='\<E.轉EXCEL',;
      TOOLTIPTEXT='轉成EXCEL格式!快速鍵->ALT+E',;
      NAME='CMND2'            
  ADD OBJECT CMND3 AS COMMANDBUTTON WITH;
      LEFT=INT_015*300,;
      TOP=INT_015*76,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*70,;
      CAPTION='\<C.取  消',;
      TOOLTIPTEXT='取消作業!快速鍵->ALT+C',;
      NAME='CMND3'
  PROCEDURE INIT 
      THISFORM.SETALL('FONTSIZE',INT_015*9,'TEXTBOX')
      THISFORM.SETALL('FONTSIZE',INT_015*9,'LABEL')      
      THISFORM.SETALL('FONTSIZE',INT_015*9,'COMMANDBUTTON')    
      THISFORM.SETALL('MOUSEPOINTER',99,'COMMANDBUTTON')
      THISFORM.SETALL('MOUSEICON','BMPS\harrow.CUR','COMMANDBUTTON')                  
      DO CASE
            CASE KEY()='F01+DTOS(F03)'    
                       THISFORM.LABEL1.CAPTION='起始單號'
	               THISFORM.LABEL2.CAPTION='截止單號'
	               THISFORM.TEXT1.WIDTH=INT_015*80
	               THISFORM.TEXT2.WIDTH=INT_015*80   
	               THISFORM.TEXT1.MAXLENGTH=10              
	               THISFORM.TEXT2.MAXLENGTH=10                                       
	               THISFORM.TEXT1.VALUE=C05.F01
	               THISFORM.TEXT2.VALUE=C05.F01              
	    CASE KEY()='DTOS(F03)+F01'
	               THISFORM.LABEL1.CAPTION='起始日期'
	               THISFORM.LABEL2.CAPTION='截止日期'
	               THISFORM.TEXT1.WIDTH=INT_015*70
	               THISFORM.TEXT2.WIDTH=INT_015*70              
	               THISFORM.TEXT1.VALUE=C05.F03
	               THISFORM.TEXT2.VALUE=C05.F03               
	    CASE KEY()='F06+F09'       
	              THISFORM.LABEL1.CAPTION='起始客戶'
	              THISFORM.LABEL2.CAPTION='截止客戶'
	              THISFORM.TEXT1.WIDTH=INT_015*60
	              THISFORM.TEXT2.WIDTH=INT_015*60   
	              THISFORM.TEXT1.MAXLENGTH=5              
	              THISFORM.TEXT2.MAXLENGTH=5                                       
	              THISFORM.TEXT1.VALUE=C05.F06
	              THISFORM.TEXT2.VALUE=C05.F06               
	   CASE KEY()='F01+F02+DTOS(F03)'   
	              THISFORM.LABEL1.CAPTION='起始單號'
	              THISFORM.LABEL2.CAPTION='截止單號'
	              THISFORM.TEXT1.WIDTH=INT_015*80
	              THISFORM.TEXT2.WIDTH=INT_015*80              
	              THISFORM.TEXT1.MAXLENGTH=10              
	              THISFORM.TEXT2.MAXLENGTH=10                            
	              THISFORM.TEXT1.VALUE=C05.F01
	              THISFORM.TEXT2.VALUE=C05.F01                        
	   CASE KEY()='F02+DTOS(F03)'             
	              THISFORM.LABEL1.CAPTION='起始料號'
	              THISFORM.LABEL2.CAPTION='截止料號'
	              THISFORM.TEXT1.WIDTH=INT_015*160
	              THISFORM.TEXT2.WIDTH=INT_015*160
	              THISFORM.TEXT1.MAXLENGTH=43        
	              THISFORM.TEXT2.MAXLENGTH=43                            
	              THISFORM.TEXT1.VALUE=C05.F02
	              THISFORM.TEXT2.VALUE=C05.F02  
	   CASE KEY()='F09+F02+DTOS(F03)'   
	              THISFORM.LABEL1.CAPTION='起始單號'
	              THISFORM.LABEL2.CAPTION='截止單號'
	              THISFORM.TEXT1.WIDTH=INT_015*80
	              THISFORM.TEXT2.WIDTH=INT_015*80              
	              THISFORM.TEXT1.MAXLENGTH=15              
	              THISFORM.TEXT2.MAXLENGTH=15                            
	              THISFORM.TEXT1.VALUE=C05.F09
	              THISFORM.TEXT2.VALUE=C05.F09 
	   CASE KEY()='F06+DTOS(F03)'       
	              THISFORM.LABEL1.CAPTION='起始客戶'
	              THISFORM.LABEL2.CAPTION='截止客戶'
	              THISFORM.TEXT1.WIDTH=INT_015*60
	              THISFORM.TEXT2.WIDTH=INT_015*60   
	              THISFORM.TEXT1.MAXLENGTH=5              
	              THISFORM.TEXT2.MAXLENGTH=5                                       
	              THISFORM.TEXT1.VALUE=C05.F06
	              THISFORM.TEXT2.VALUE=C05.F06        
	   CASE KEY()='DTOS(F10)+F06'       
	              THISFORM.LABEL1.CAPTION='起始日期'
	              THISFORM.LABEL2.CAPTION='截止日期'
	              THISFORM.TEXT1.WIDTH=INT_015*70
	              THISFORM.TEXT2.WIDTH=INT_015*70                                      
	              THISFORM.TEXT1.VALUE=C05.F10
	              THISFORM.TEXT2.VALUE=C05.F10    	               
      CASE KEY()='F08+F06+F01'	                    
                  THISFORM.LABEL1.CAPTION='起始業務'
	              THISFORM.LABEL2.CAPTION='截止業務'
	              THISFORM.TEXT1.WIDTH=INT_015*70
	              THISFORM.TEXT2.WIDTH=INT_015*70                                      
	              THISFORM.TEXT1.VALUE=C05.F08
	              THISFORM.TEXT2.VALUE=C05.F08    	                                                                  
      ENDCASE   
  ENDPROC    
  PROCEDURE CMND1.CLICK 
      DO CASE
            CASE KEY()='F01+DTOS(F03)'   
                       SELECT C05.F01,C05.F02,C05.F03,C05.F04,C05.F05,C05.F06,C05.F07,C05.F09,C05.F10,C05.F11,B01.F02,C05_1.EXP_2,A01.F03,C04.F07,C04.F17;
                       FROM C05,B01,C05_1,A01,C04 WHERE  B01.F01=C05.F02 AND C05_1.F06=C05.F06 AND A01.F01=C05.F08;
                       AND  C05.F01>=THISFORM.TEXT1.VALUE AND C05.F01<=THISFORM.TEXT2.VALUE AND C05.F01=C04.F03 AND C05.F02=C04.F04;
                       ORDER BY C05.F01,C05.F03 NOWAIT
                       IF _TALLY >0              
                           REPORT FORM ALLTRIM(INT_116)+'C05A' TO PRINT PROMPT PREVIEW    
                           FLG='1'
                           RELEASE frmReportApp 
                           CLEAR 
                       ENDIF  
            CASE KEY()='DTOS(F03)+F01'   
                       SELECT C05.F01,C05.F02,C05.F03,C05.F04,C05.F05,C05.F06,C05.F07,C05.F09,C05.F10,C05.F11,B01.F02,C05_1.EXP_2,A01.F03,C04.F07,C04.F17;
                       FROM C05,B01,C05_1,A01,C04 WHERE  B01.F01=C05.F02 AND C05_1.F06=C05.F06 AND A01.F01=C05.F08;
                       AND C05.F03>=THISFORM.TEXT1.VALUE AND C05.F03<=THISFORM.TEXT2.VALUE AND C05.F01=C04.F03 AND C05.F02=C04.F04;
                       ORDER BY C05.F03,C05.F01 NOWAIT
                       IF _TALLY >0
                           REPORT FORM ALLTRIM(INT_116)+'C05B' TO PRINT PROMPT PREVIEW 
                           FLG='1'
                           CLEAR 
                       ENDIF             
            CASE KEY()='F06+F09'   
                       IF  LEFT(ALLTRIM(THISFORM.TEXT1.VALUE),1)='V' AND LEFT(ALLTRIM(THISFORM.TEXT2.VALUE),1)='V'
      	                    SELECT C05.F01,C05.F02,C05.F03,C05.F04,C05.F05,C05.F06,C05.F07,C05.F09,C05.F10,C05.F11,C05_1.EXP_2,C04.F07;
                            FROM C05,C05_1,C04 WHERE  C05.F06>=THISFORM.TEXT1.VALUE AND C05.F06<=THISFORM.TEXT2.VALUE AND  C05_1.F06=C05.F06;    
                           AND C05.F01=C04.F03 AND C05.F02=C04.F04 ORDER BY C05.F06,C05.F09  NOWAIT
                           IF _TALLY >0
                               REPORT FORM ALLTRIM(INT_116)+'C05C' TO PRINT PROMPT PREVIEW
                               FLG='1'
                               CLEAR 
                           ENDIF             
                       ELSE
                           SELECT C05.F01,C05.F02,C05.F03,C05.F04,C05.F05,C05.F06,C05.F07,C05.F09,C05.F10,C05.F11,B01.F02,C05_1.EXP_2,A01.F03,C04.F07,C04.F17;
                           FROM C05,B01,C05_1,A01,C04 WHERE  B01.F01=C05.F02 AND C05_1.F06=C05.F06 AND A01.F01=C05.F08;
                           AND C05.F06>=THISFORM.TEXT1.VALUE AND C05.F06<=THISFORM.TEXT2.VALUE AND C05.F01=C04.F03 AND C05.F02=C04.F04;        
                           ORDER BY C05.F06,C05.F09 NOWAIT
                           IF _TALLY >0
                              REPORT FORM ALLTRIM(INT_116)+'C05C' TO PRINT PROMPT PREVIEW
                              FLG='1'
                              CLEAR
                           ENDIF             
                       ENDIF     
            CASE KEY()='F01+F02+DTOS(F03)'   
                       SELECT C05.F01,C05.F02,C05.F03,C05.F04,C05.F05,C05.F06,C05.F07,C05.F09,C05.F10,C05.F11,B01.F02,C05_1.EXP_2,A01.F03,C04.F07,C04.F17;
	               FROM C05,B01,C05_1,A01,C04 WHERE  B01.F01=C05.F02 AND C05_1.F06=C05.F06 AND A01.F01=C05.F08;
	              AND C05.F01>=THISFORM.TEXT1.VALUE AND C05.F01<=THISFORM.TEXT2.VALUE AND C05.F01=C04.F03 AND C05.F02=C04.F04;
	              ORDER BY C05.F01,C05.F02,C05.F03 NOWAIT
	              IF _TALLY >0
                          REPORT FORM ALLTRIM(INT_116)+'C05D' TO PRINT PROMPT PREVIEW  
                          FLG='1'
                          CLEAR 
                      ENDIF                       
           CASE KEY()='F02+DTOS(F03)'   
                      SELECT C05.F01,C05.F02,C05.F03,C05.F04,C05.F05,C05.F06,C05.F07,C05.F09,C05.F10,C05.F11,B01.F02,C05_1.EXP_2,A01.F03,C04.F07,C04.F17;
                      FROM C05,B01,C05_1,A01,C04 WHERE  B01.F01=C05.F02 AND C05_1.F06=C05.F06 AND A01.F01=C05.F08;
                      AND C05.F02>=THISFORM.TEXT1.VALUE AND C05.F02<=THISFORM.TEXT2.VALUE AND C05.F01=C04.F03 AND C05.F02=C04.F04;
                      ORDER BY C05.F02,C05.F03 NOWAIT
                      IF _TALLY >0
                          REPORT FORM ALLTRIM(INT_116)+'C05E' TO PRINT PROMPT PREVIEW   
                          FLG='1'
                          CLEAR 
                      ENDIF                   
           CASE KEY()='F09+F02+DTOS(F03)'   
                      SELECT C05.F01,C05.F02,C05.F03,C05.F04,C05.F05,C05.F06,C05.F07,C05.F09,C05.F10,C05.F11,B01.F02,C05_1.EXP_2,C04.F07,C04.F17;
                      FROM C05,B01,C05_1,C04 WHERE  B01.F01=C05.F02 AND C05_1.F06=C05.F06;
                      AND C05.F09>=THISFORM.TEXT1.VALUE AND C05.F09<=THISFORM.TEXT2.VALUE AND C05.F01=C04.F03 AND C05.F02=C04.F04;       
                      ORDER BY C05.F09,C05.F02,C05.F03 NOWAIT
                      IF _TALLY >0
                          REPORT FORM ALLTRIM(INT_116)+'C05F' TO PRINT PROMPT PREVIEW  
                          FLG='1'
                          CLEAR 
                      ENDIF 
           CASE KEY()='F06+DTOS(F03)'        
                      IF  LEFT(ALLTRIM(THISFORM.TEXT1.VALUE),1)='V' AND LEFT(ALLTRIM(THISFORM.TEXT2.VALUE),1)='V'
                           SELECT C05.F01,C05.F02,C05.F03,C05.F04,C05.F05,C05.F06,C05.F07,C05.F09,C05.F10,C05.F11,C05_1.EXP_2,C04.F07;
                           FROM C05,C05_1,C04 WHERE  C05.F06>=THISFORM.TEXT1.VALUE AND C05.F06<=THISFORM.TEXT2.VALUE AND C05_1.F06=C05.F06;
                           AND C05.F01=C04.F03 AND C05.F02=C04.F04 ORDER BY C05.F06,C05.F09  NOWAIT
                           IF _TALLY >0
                               REPORT FORM ALLTRIM(INT_116)+'C05C' TO PRINT PROMPT PREVIEW
                               FLG='1'
                               CLEAR 
                           ENDIF             
                      ELSE            
                           SELECT C05.F01,C05.F02,C05.F03,C05.F04,C05.F05,C05.F06,C05.F07,C05.F09,C05.F10,C05.F11,B01.F02,C05_1.EXP_2,A01.F03,C04.F07,C04.F17;
                           FROM C05,B01,C05_1,A01,C04 WHERE  B01.F01=C05.F02 AND C05_1.F06=C05.F06 AND A01.F01=C05.F08;
                           AND C05.F06>=THISFORM.TEXT1.VALUE AND C05.F06<=THISFORM.TEXT2.VALUE AND C05.F01=C04.F03 AND C05.F02=C04.F04;        
                           ORDER BY C05.F06,C05.F03 NOWAIT
                           IF _TALLY >0
                               REPORT FORM ALLTRIM(INT_116)+'C05C' TO PRINT PROMPT PREVIEW
                               FLG='1'
                               CLEAR 
                           ENDIF   
                      ENDIF      
                      ***
            CASE KEY()='DTOS(F10)+F06'   
                       SELECT C05.F01,C05.F02,C05.F03,C05.F04,C05.F05,C05.F06,C05.F07,C05.F09,C05.F10,C05.F11,B01.F02,C05_1.EXP_2,A01.F03,C04.F07,C04.F17;
                       FROM C05,B01,C05_1,A01,C04 WHERE  B01.F01=C05.F02 AND C05_1.F06=C05.F06 AND A01.F01=C05.F08;
                       AND C05.F10>=THISFORM.TEXT1.VALUE AND C05.F10<=THISFORM.TEXT2.VALUE AND C05.F01=C04.F03 AND C05.F02=C04.F04;
                       ORDER BY C05.F10,C05.F06 NOWAIT
                       IF _TALLY >0
                           REPORT FORM ALLTRIM(INT_116)+'C05H' TO PRINT PROMPT PREVIEW 
                           FLG='1'
                           CLEAR 
                       ENDIF                                                                                                  
            CASE KEY()='F08+F06+F01'
                       SELECT C05.F01,C05.F02,C05.F03,C05.F04,C05.F05,C05.F06,C05.F07,C05.F08,C05.F09,C05.F10,C05.F11,B01.F02,C05_1.EXP_2,A01.F03,C04.F07;
                       FROM C05,B01,C05_1,A01,C04 WHERE  B01.F01=C05.F02 AND C05_1.F06=C05.F06 AND A01.F01=C05.F08;
                       AND C05.F08>=THISFORM.TEXT1.VALUE AND C05.F08<=THISFORM.TEXT2.VALUE AND C05.F01=C04.F03 AND C05.F02=C04.F04;
                       ORDER BY C05.F08,C05.F06,C05.F01 NOWAIT
                       IF _TALLY >0
                           REPORT FORM ALLTRIM(INT_116)+'C05I' TO PRINT PROMPT PREVIEW 
                           FLG='1'
                           CLEAR 
                       ENDIF                                    
       ENDCASE 
       THISFORM.RELEASE                         
  ENDPROC
 ******
  PROCEDURE CMND2.CLICK 
      DO CASE
            CASE KEY()='F01+DTOS(F03)'   
                       FILE_NAME='C05出貨計畫(資料範圍 '+ALLTRIM(THISFORM.TEXT1.VALUE)+'~'+ALLTRIM(THISFORM.TEXT2.VALUE)+' )'
                       SELECT C05.F01 訂單編號,C05.F09 客戶單號,C05.F03 希望交期,C05.F02 料號,B01.F02 品名規格,IIF(SEEK(C05.F02,'C20'),C20.F04,'') 產地,C04.F17 客戶品號,C05.F04 出貨數量,C04.F07 單價,IIF(SEEK(C04.F06,'C00'),C00.F02,1) 匯率,;
                       C05.F04*C04.F07*IIF(SEEK(C04.F06,'C00'),C00.F02,1) 金額小計,C05.F10 出貨日期,C05.F05 開單未出量,C05.F06 客戶編號,C05_1.EXP_2 客戶簡稱,C05.F11 備註,A01.F03 業務人員,C05.F13 業助代號,C04.F01 接單日期,C05.F07 安全資料;
                       FROM C05,B01,C05_1,A01,C04 WHERE  B01.F01=C05.F02 AND C05_1.F06=C05.F06 AND A01.F01=C05.F08;A01,
                       AND  C05.F01>=THISFORM.TEXT1.VALUE AND C05.F01<=THISFORM.TEXT2.VALUE AND C05.F01=C04.F03 AND C05.F02=C04.F04;
                       ORDER BY C05.F01,C05.F03 INTO CURSOR C05_TEMP  
            CASE KEY()='DTOS(F03)+F01'   
		       IF EMPTY(THISFORM.TEXT1.VALUE) OR EMPTY(THISFORM.TEXT2.VALUE)
		            FILE_NAME='C05出貨計畫(依日期排列)'
		       ELSE
		            FILE_NAME='C05出貨計畫(資料範圍 '+ALLTRIM(DTOS(THISFORM.TEXT1.VALUE))+'~'+ALLTRIM(DTOS(THISFORM.TEXT2.VALUE))+' )'
		       ENDIF                            
                       SELECT C05.F01 訂單編號,C05.F03 希望交期,C05.F09 客戶單號,C05.F02 料號,B01.F02 品名規格,IIF(SEEK(C05.F02,'C20'),C20.F04,'') 產地,C04.F17 客戶品號,C05.F04 出貨數量,C04.F07 單價,IIF(SEEK(C04.F06,'C00'),C00.F02,1) 匯率,;
                       C05.F04*C04.F07*IIF(SEEK(C04.F06,'C00'),C00.F02,1) 金額小計,C05.F10 出貨日期,C05.F05 開單未出量,C05.F06 客戶編號,C05_1.EXP_2 客戶簡稱,C05.F11 備註,A01.F03 業務人員,C05.F13 業助代號,C04.F01 接單日期,C05.F07 安全資料;
                       FROM C05,B01,C05_1,A01,C04 WHERE  B01.F01=C05.F02 AND C05_1.F06=C05.F06 AND A01.F01=C05.F08;
                       AND C05.F03>=THISFORM.TEXT1.VALUE AND C05.F03<=THISFORM.TEXT2.VALUE AND C05.F01=C04.F03 AND C05.F02=C04.F04;
                       ORDER BY C05.F03,C05.F01 INTO CURSOR C05_TEMP     
            CASE KEY()='F06+F09'   
                       FILE_NAME='C05出貨計畫(資料範圍 '+ALLTRIM(THISFORM.TEXT1.VALUE)+'~'+ALLTRIM(THISFORM.TEXT2.VALUE)+' )'
                       IF  LEFT(ALLTRIM(THISFORM.TEXT1.VALUE),1)='V' AND LEFT(ALLTRIM(THISFORM.TEXT2.VALUE),1)='V'
                            SELECT C05.F01 訂單編號,C05.F06 客戶編號,C05_1.EXP_2 客戶簡稱,C05.F03 希望交期,C05.F02 料號,B01.F02 品名規格,IIF(SEEK(C05.F02,'C20'),C20.F04,'') 產地,;
                            C04.F07 客戶品號,C05.F09 客戶單號,C05.F04 出貨數量,C05.F05 開單未出量,C05.F10 出貨日期,C05.F11 備註,C04.F01 接單日期,C05.F07 安全資料;
                            FROM C05,C05_1,C04,B01 WHERE  B01.F01=C05.F02 AND C05.F06>=THISFORM.TEXT1.VALUE AND C05.F06<=THISFORM.TEXT2.VALUE AND  C05_1.F06=C05.F06;    
                           AND C05.F01=C04.F03 AND C05.F02=C04.F04 ORDER BY C05.F06,C05.F09  INTO CURSOR C05_TEMP      
                       ELSE                       
                           SELECT C05.F01 訂單編號,C05.F06 客戶編號,C05_1.EXP_2 客戶簡稱,C05.F03 希望交期,C05.F09 客戶單號,C05.F02 料號,B01.F02 品名規格,IIF(SEEK(C05.F02,'C20'),C20.F04,'') 產地,;
                           C04.F17 客戶品號,C05.F04 出貨數量,C04.F07 單價,IIF(SEEK(C04.F06,'C00'),C00.F02,1) 匯率,C05.F04*C04.F07*IIF(SEEK(C04.F06,'C00'),C00.F02,1) 金額小計,C05.F05 開單未出量,C05.F10 出貨日期,C05.F11 備註,A01.F03 業務人員,C05.F13 業助代號,C04.F01 接單日期,C05.F07 安全資料;
                           FROM C05,B01,C05_1,A01,C04 WHERE  B01.F01=C05.F02 AND C05_1.F06=C05.F06 AND A01.F01=C05.F08;
                           AND C05.F06>=THISFORM.TEXT1.VALUE AND C05.F06<=THISFORM.TEXT2.VALUE AND C05.F01=C04.F03 AND C05.F02=C04.F04;        
                           ORDER BY C05.F06,C05.F09 INTO CURSOR C05_TEMP            
                       ENDIF     
            CASE KEY()='F01+F02+DTOS(F03)'   
                       FILE_NAME='C05出貨計畫(資料範圍 '+ALLTRIM(THISFORM.TEXT1.VALUE)+'~'+ALLTRIM(THISFORM.TEXT2.VALUE)+' )'
                       SELECT C05.F01 訂單編號,C05.F09 客戶單號,C05.F02 料號,B01.F02 品名規格,IIF(SEEK(C05.F02,'C20'),C20.F04,'') 產地,C04.F17 客戶品號,C05.F04 出貨數量,C04.F07 單價,IIF(SEEK(C04.F06,'C00'),C00.F02,1) 匯率,C05.F04*C04.F07*IIF(SEEK(C04.F06,'C00'),C00.F02,1) 金額小計,C05.F05 開單未出量,;
                       C05.F06 客戶編號,C05_1.EXP_2 客戶簡稱,C05.F03 希望交期,C05.F10 出貨日期,C05.F11 備註,A01.F03 業務人員,C05.F13 業助代號,C04.F01 接單日期,C05.F07 安全資料;
                       FROM C05,B01,C05_1,A01,C04 WHERE  B01.F01=C05.F02 AND C05_1.F06=C05.F06 AND A01.F01=C05.F08;
	               AND C05.F01>=THISFORM.TEXT1.VALUE AND C05.F01<=THISFORM.TEXT2.VALUE AND C05.F01=C04.F03 AND C05.F02=C04.F04;
	               ORDER BY C05.F01,C05.F02,C05.F03 INTO CURSOR C05_TEMP                  
           CASE KEY()='F02+DTOS(F03)'   
                      FILE_NAME='C05出貨計畫(資料範圍 '+ALLTRIM(THISFORM.TEXT1.VALUE)+'~'+ALLTRIM(THISFORM.TEXT2.VALUE)+' )'
                      SELECT C05.F01 訂單編號,C05.F02 料號,B01.F02 品名規格,IIF(SEEK(C05.F02,'C20'),C20.F04,'') 產地,C04.F17 客戶品號,C05.F03 希望交期,C05.F09 客戶單號,C05.F04 出貨數量,C04.F07 單價,IIF(SEEK(C04.F06,'C00'),C00.F02,1) 匯率,;
                      C05.F05 開單未出量,C05.F06 客戶編號,C05_1.EXP_2 客戶簡稱,C05.F10 出貨日期,C05.F11 備註,A01.F03 業務人員,C05.F13 業助代號,C04.F01 接單日期,C05.F07 安全資料;
                       FROM C05,B01,C05_1,A01,C04 WHERE  B01.F01=C05.F02 AND C05_1.F06=C05.F06 AND A01.F01=C05.F08;
                      AND C05.F02>=THISFORM.TEXT1.VALUE AND C05.F02<=THISFORM.TEXT2.VALUE AND C05.F01=C04.F03 AND C05.F02=C04.F04;
                      ORDER BY C05.F02,C05.F03 INTO CURSOR C05_TEMP                            
           CASE KEY()='F09+F02+DTOS(F03)'   
                      FILE_NAME='C05出貨計畫(資料範圍 '+ALLTRIM(THISFORM.TEXT1.VALUE)+'~'+ALLTRIM(THISFORM.TEXT2.VALUE)+' )'
                      SELECT C05.F01 訂單編號,C05.F09 客戶單號,C05.F02 料號,B01.F02 品名規格,IIF(SEEK(C05.F02,'C20'),C20.F04,'') 產地,C04.F17 客戶品號,C05.F03 希望交期,C05.F04 出貨數量,;
                      C04.F07 單價,IIF(SEEK(C04.F06,'C00'),C00.F02,1) 匯率,C05.F04*C04.F07*IIF(SEEK(C04.F06,'C00'),C00.F02,1) 金額小計,C05.F05 開單未出量,C05.F06 客戶編號,C05_1.EXP_2 客戶簡稱,C05.F10 出貨日期,C05.F11 備註,C04.F01 接單日期,C05.F07 安全資料;
                       FROM C05,B01,C05_1,C04 WHERE  B01.F01=C05.F02 AND C05_1.F06=C05.F06;
                      AND C05.F09>=THISFORM.TEXT1.VALUE AND C05.F09<=THISFORM.TEXT2.VALUE AND C05.F01=C04.F03 AND C05.F02=C04.F04;       
                      ORDER BY C05.F09,C05.F02,C05.F03 INTO CURSOR C05_TEMP        
           CASE KEY()='F06+DTOS(F03)'        
                      FILE_NAME='C05出貨計畫(資料範圍 '+ALLTRIM(THISFORM.TEXT1.VALUE)+'~'+ALLTRIM(THISFORM.TEXT2.VALUE)+' )'
                      IF  LEFT(ALLTRIM(THISFORM.TEXT1.VALUE),1)='V' AND LEFT(ALLTRIM(THISFORM.TEXT2.VALUE),1)='V'
                           SELECT C05.F01 訂單編號,C05.F06 客戶編號,C05_1.EXP_2 客戶簡稱,C05.F09 客戶單號,C05.F02 料號,B01.F02 品名規格,IIF(SEEK(C05.F02,'C20'),C20.F04,'') 產地,;
                           C05.F03 希望交期,C05.F04 出貨數量,C04.F07 單價,IIF(SEEK(C04.F06,'C00'),C00.F02,1) 匯率,C05.F04*C04.F07*IIF(SEEK(C04.F06,'C00'),C00.F02,1) 金額小計,C05.F10 出貨日期,C05.F05 開單未出量,C05.F11 備註,C04.F01 接單日期,C05.F07 安全資料;
                           FROM C05,C05_1,C04,B01 WHERE  B01.F01=C05.F02 AND C05.F06>=THISFORM.TEXT1.VALUE AND C05.F06<=THISFORM.TEXT2.VALUE AND C05_1.F06=C05.F06;
                           AND C05.F01=C04.F03 AND C05.F02=C04.F04 ORDER BY C05.F06,C05.F09  INTO CURSOR C05_TEMP             
                      ELSE            
                           SELECT C05.F01 訂單編號,C05.F06 客戶編號,C05_1.EXP_2 客戶簡稱,C05.F02 料號,B01.F02 品名規格,IIF(SEEK(C05.F02,'C20'),C20.F04,'') 產地,C04.F17 客戶品號,C05.F03 希望交期,;
                           C05.F09 客戶單號,C05.F04 出貨數量,C04.F07 單價,IIF(SEEK(C04.F06,'C00'),C00.F02,1) 匯率,C05.F04*C04.F07*IIF(SEEK(C04.F06,'C00'),C00.F02,1) 金額小計,C05.F05 開單未出量,C05.F10 出貨日期,C05.F11 備註,A01.F03 業務人員,C05.F13 業助代號,C04.F01 接單日期,C05.F07 安全資料;
                           FROM C05,B01,C05_1,A01,C04 WHERE  B01.F01=C05.F02 AND C05_1.F06=C05.F06 AND A01.F01=C05.F08;
                           AND C05.F06>=THISFORM.TEXT1.VALUE AND C05.F06<=THISFORM.TEXT2.VALUE AND C05.F01=C04.F03 AND C05.F02=C04.F04;        
                           ORDER BY C05.F06,C05.F03 INTO CURSOR C05_TEMP  
                      ENDIF                       
            CASE KEY()='DTOS(F10)+F06'   
                       FILE_NAME='C05出貨計畫(依日期排列)'
                       SELECT C05.F01 訂單編號,C05.F09 客戶單號,C05.F10 出貨日期,C05.F03 希望交期,C05.F02 料號,B01.F02 品名規格,IIF(SEEK(C05.F02,'C20'),C20.F04,'') 產地,C04.F17 客戶品號,C05.F04 出貨數量,;
                       C04.F07 單價,IIF(SEEK(C04.F06,'C00'),C00.F02,1) 匯率,C05.F04*C04.F07*IIF(SEEK(C04.F06,'C00'),C00.F02,1) 金額小計,C05.F05 開單未出量,C05.F06 客戶編號,C05_1.EXP_2 客戶簡稱,C05.F11 備註,A01.F03 業務人員,C05.F13 業助代號,C04.F01 接單日期,C05.F07 安全資料;
                       FROM C05,B01,C05_1,A01,C04 WHERE  B01.F01=C05.F02 AND C05_1.F06=C05.F06 AND A01.F01=C05.F08;
                       AND  C05.F10>=THISFORM.TEXT1.VALUE AND C05.F10<=THISFORM.TEXT2.VALUE AND C05.F01=C04.F03 AND C05.F02=C04.F04;
                       ORDER BY C05.F10,C05.F06 INTO CURSOR C05_TEMP              
            CASE KEY()='F08+F06+F01'   
                       FILE_NAME='C05出貨計畫(依業務排列)'
                       SELECT C05.F01 訂單編號,C05.F09 客戶單號,C05.F10 出貨日期,C05.F03 希望交期,C05.F02 料號,B01.F02 品名規格,IIF(SEEK(C05.F02,'C20'),C20.F04,'') 產地,C04.F17 客戶品號,C05.F04 出貨數量,;
                       C04.F07 單價,IIF(SEEK(C04.F06,'C00'),C00.F02,1) 匯率,C05.F04*C04.F07*IIF(SEEK(C04.F06,'C00'),C00.F02,1) 金額小計,C05.F05 開單未出量,C05.F06 客戶編號,C05_1.EXP_2 客戶簡稱,C05.F11 備註,A01.F03 業務人員,C05.F13 業助代號,C04.F01 接單日期,C05.F07 安全資料;
                       FROM C05,B01,C05_1,A01,C04 WHERE  B01.F01=C05.F02 AND C05_1.F06=C05.F06 AND A01.F01=C05.F08;
                       AND  C05.F08>=THISFORM.TEXT1.VALUE AND C05.F08<=THISFORM.TEXT2.VALUE AND C05.F01=C04.F03 AND C05.F02=C04.F04;
                       ORDER BY C05.F08,C05.F06 INTO CURSOR C05_TEMP                                                                                                                                                                                       
       ENDCASE 
       SELECT C05_TEMP
       IF _TALLY >0
	      GCDELIMFILE=PUTFILE('儲存路徑',FILE_NAME,'XLS')
	      IF EMPTY(GCDELIMFILE)  && ESC PRESSED
	         SELECT C05_TEMP
	         USE
	         RETURN
	      ELSE
	         ON ERROR DO FILE_IMPACT
	         IF _TALLY >0
	            COPY TO (GCDELIMFILE) TYPE XL5   
	            =MESSAGEBOX('儲存成功',0+64,'提示訊息視窗')
	         ENDIF                             
	      ENDIF
	      SELECT C05_TEMP
	      USE
	      FLG='1'    
       ENDIF       
       THISFORM.RELEASE                   
  ENDPROC 
 ***** 
  PROCEDURE CMND3.CLICK
      FLG='1'   
      THISFORM.RELEASE
  ENDPROC            
ENDDEFINE        
***************************************進貨計劃/生產計劃 
DEFINE CLASS INSCH_SEEK AS FORM
*!*	  AUTOCENTER=.T.
  FONTSIZE=INT_015*9
  TOP=INT_015*110
  LEFT=INT_015*10    
  HEIGHT=INT_015*322
  WIDTH=INT_015*870
  FONTSIZE=INT_015*9
  MOVABLE=.T.
  MAXBUTTON=.F.
  MINBUTTON=.F.      
  CONTROLBOX=.F.
  BORDERSTYLE=2
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WINDOWTYPE=1
  NAME='INSCH_SEEK'
  ADD OBJECT LBLF18 AS LABEL WITH;
      TOP=INT_015*300,;
      LEFT=INT_015*5,;
      HEIGHT=INT_015*23,;      
      WIDTH=INT_015*50,;
      FONTSIZE=INT_015*9,;
      CAPTION='到貨分配'     
  ADD OBJECT CMDGROUP AS CMDGROUP WITH;      
      TOP=INT_015*290,;
      LEFT=INT_015*470
  ADD OBJECT GRID1 AS GRID WITH;       
      HIGHLIGHTROWLINEWIDTH=4,; 
      AUTOCENTER=.T.,;
      WIDTH=INT_015*870,;      
      HEIGHT=INT_015*293,;     
      ROWHEIGHT=INT_015*18,;
      HEADERHEIGHT=INT_015*19,; 
      DELETEMARK=.F.,;
      READONLY=.T.,;
      RECORDSOURCETYPE=1,;
      COLUMNCOUNT=9,;            
      NAME='GRID1',;
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;      
      COLUMN3.NAME='COLUMN3',; 
      COLUMN4.NAME='COLUMN4',;      
      COLUMN5.NAME='COLUMN5',;
      COLUMN6.NAME='COLUMN6',; 
      COLUMN7.NAME='COLUMN7',;  
      COLUMN8.NAME='COLUMN8',;     
      COLUMN9.NAME='COLUMN9'            
  ADD OBJECT CMND1 AS COMMANDBUTTON WITH;
      LEFT=INT_015*727,;
      TOP=INT_015*295,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\harrow.CUR',;
      CAPTION='\<X.離開',;
      TOOLTIPTEXT='取消此作業畫面!快速鍵->ALT+X'
      NAME='CMND1'
  ADD OBJECT CMND2 AS COMMANDBUTTON WITH;
      LEFT=INT_015*643,;
      TOP=INT_015*295,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\harrow.CUR',;
      CAPTION='\<C.異動',;
      TOOLTIPTEXT='取消此作業畫面!快速鍵->ALT+X'
      NAME='CMND2'     
  ADD OBJECT CMND3 AS COMMANDBUTTON WITH;
      LEFT=INT_015*685,;
      TOP=INT_015*295,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\harrow.CUR',;
      CAPTION='\<T.分配',;
      TOOLTIPTEXT='取消此作業畫面!快速鍵->ALT+X'
      NAME='CMND3'            
  ADD OBJECT YES AS COMMANDBUTTON WITH;
      TOP=INT_015*295,;
      LEFT=INT_015*372,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;
      CAPTION='\<Y.確定'
  ADD OBJECT NO AS COMMANDBUTTON WITH;
      TOP=INT_015*295,;
      LEFT=INT_015*414,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;
      CAPTION='\<N.取消' 
      
  ADD OBJECT TXTF18 AS TEXTBOX WITH;
      TOP=INT_015*295,;
      LEFT=INT_015*61,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*310,;
      MAXLENGTH=40,;
      FONTSIZE=INT_015*9
            
      PROCEDURE INIT    
         AREA1='INSCH'  
         SELE INSCH
         THISFORM.GRID1.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)
         THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'COLUMN')
         THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'HEADER')
         THISFORM.GRID1.READONLY=.T. 
         THISFORM.GRID1.RECORDSOURCE='INSCH'
         THISFORM.CMDGROUP.SEEK_BOTT.VISIBLE=.F.     
         THISFORM.CMND2.ENABLED=CHA
         THISFORM.CMND3.ENABLED=(IIF(SEEK(SYS_OPER,'A01'),A01.F04,'')='S000 ') AND (B01.F97<>'Y')
         THISFORM.CMND3.VISIBLE=(IIF(SEEK(SYS_OPER,'A01'),A01.F04,'')='S000 ') AND (B01.F97<>'Y')
         THISFORM.LBLF18.VISIBLE=(IIF(SEEK(SYS_OPER,'A01'),A01.F04,'')='S000 ') AND (B01.F97<>'Y')
         THISFORM.TXTF18.VISIBLE=(IIF(SEEK(SYS_OPER,'A01'),A01.F04,'')='S000 ') AND (B01.F97<>'Y')
          THISFORM.YES.VISIBLE=.F.
          THISFORM.NO.VISIBLE=.F.
          THISFORM.YES.ENABLED=.T.
          THISFORM.NO.ENABLED=.T.
         THISFORM.SETALL('READONLY',.T.,'TEXTBOX')
         THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(DATE()-CTOD(LEFT(INSCH.F08,9))<=5 AND INSCH.F09='1',RGB(0,255,255),IIF(INSCH.F09<>'1',RGB(255,255,0),IIF(INSCH.F03<DATE() AND INSCH.F09='1',RGB(255,0,0),'')))","COLUMN")
         IF INSCH.DE_CK = 'D'
	         THISFORM.CAPTION='D08.進貨計劃'+'---->'+C05.F02+SPACE(5)+B01.F02 
	         THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='訂單號碼'
	         THISFORM.GRID1.COLUMN1.CONTROLSOURCE='INSCH.F01'
	         THISFORM.GRID1.COLUMN1.WIDTH=INT_015*75
	         THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='進貨日期'
	         THISFORM.GRID1.COLUMN2.WIDTH=INT_015*60
	         THISFORM.GRID1.COLUMN2.CONTROLSOURCE='INSCH.F03'         
	         THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='進貨數量'
	         THISFORM.GRID1.COLUMN3.CONTROLSOURCE='INSCH.F04'
	         THISFORM.GRID1.COLUMN3.WIDTH=INT_015*70
	         THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='採購用途'         
	         THISFORM.GRID1.COLUMN4.CONTROLSOURCE='INSCH.F07'
	         THISFORM.GRID1.COLUMN4.WIDTH=INT_015*130
	         THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='運貨方式'         
	         THISFORM.GRID1.COLUMN5.CONTROLSOURCE="INSCH.F13 + IIF(EMPTY(INSCH.F17),'','(' + ALLTRIM(INSCH.F17) + ')')"
	         THISFORM.GRID1.COLUMN5.WIDTH=INT_015*90    
	         IF A02.F12='*'
	            THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='採購單價'         
	            THISFORM.GRID1.COLUMN6.CONTROLSOURCE="TRANSFORM(IIF(SEEK(INSCH.F01+C05.F02,'P04'),P04.F05*IIF(SEEK(P04.F04,'D00'),D00.F02,1),0),'@R 99999.999999')"
	            IF IIF(SEEK(INSCH.F01+C05.F02,'P04'),P04.F05*IIF(SEEK(P04.F04,'D00'),D00.F02,1),0)=0
	               THISFORM.GRID1.COLUMN6.CONTROLSOURCE="TRANSFORM(IIF(SEEK(INSCH.F01+C05.F02,'D04'),D04.F05*IIF(SEEK(D04.F04,'D00'),D00.F02,1),0),'@R 99999.999999')"
	            ENDIF
	            THISFORM.GRID1.COLUMN6.WIDTH=INT_015*80	         
	         ELSE
	            THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='客戶PO/NO'         
	            THISFORM.GRID1.COLUMN6.CONTROLSOURCE="IIF(SEEK(LEFT(ALLTRIM(INSCH.F07),10),'P05'),IIF(SEEK(P05.F06,'C03'),C03.F14,''),'')"
	            THISFORM.GRID1.COLUMN6.WIDTH=INT_015*130
	         ENDIF   
	         THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='異動狀態與日期'         
	         THISFORM.GRID1.COLUMN7.CONTROLSOURCE="ICASE(INSCH.F14 = '1','提前中 / ',INSCH.F14 = '2','延後中 / ',INSCH.F14 = '3','取消中 / ',INSCH.F14 = '4','異動資料已回覆','') + IIF(EMPTY(INSCH.F15),'',IIF(INT_012=2,DATE(),ALLTRIM(STR(VAL(LEFT(DTOS(DATE()),4))-1911))+RIGHT(DTOC(DATE()),6)))"
	         THISFORM.GRID1.COLUMN7.WIDTH=INT_015*105 
	         THISFORM.GRID1.COLUMN8.HEADER1.CAPTION=IIF(IIF(SEEK(SYS_OPER,'A01'),A01.F04,'')='P000 ','廠商規格','到貨分配')   
	         THISFORM.GRID1.COLUMN8.CONTROLSOURCE=IIF(IIF(SEEK(SYS_OPER,'A01'),A01.F04,'')='P000 ','INSCH.F10','INSCH.F18')   
	         THISFORM.GRID1.COLUMN8.WIDTH=INT_015*IIF(IIF(SEEK(SYS_OPER,'A01'),A01.F04,'')='P000 ',100,200)   
	         THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='安全資料'         
	         THISFORM.GRID1.COLUMN9.CONTROLSOURCE='INSCH.F08'
	         THISFORM.GRID1.COLUMN9.WIDTH=INT_015*120 
	         THISFORM.CMND2.VISIBLE=.T.
	     ELSE
	         THISFORM.CAPTION='E06.生產計劃'+'---->'+C05.F02+SPACE(5)+B01.F02 
	         THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='母製令號碼'
	         THISFORM.GRID1.COLUMN1.CONTROLSOURCE='INSCH.F01'
	         THISFORM.GRID1.COLUMN1.WIDTH=INT_015*100
	         THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='完工日期 '
	         THISFORM.GRID1.COLUMN2.WIDTH=INT_015*70
	         THISFORM.GRID1.COLUMN2.CONTROLSOURCE='INSCH.F03'         
	         THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='預計產出 '
	         THISFORM.GRID1.COLUMN3.CONTROLSOURCE='INSCH.F04'
	         THISFORM.GRID1.COLUMN3.WIDTH=INT_015*80
	         THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='加工部門'         
	         THISFORM.GRID1.COLUMN4.CONTROLSOURCE="IIF(SEEK(INSCH.F05,'A14'),A14.F02,INSCH.F05)"
	         THISFORM.GRID1.COLUMN4.WIDTH=INT_015*60
	         THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='已完成量'         
	         THISFORM.GRID1.COLUMN5.CONTROLSOURCE='INSCH.F04'
	         THISFORM.GRID1.COLUMN5.WIDTH=INT_015*80    
	         THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='客戶名稱'          
	         THISFORM.GRID1.COLUMN6.CONTROLSOURCE="IIF(SEEK(INSCH.F07,'C01'),C01.F04,INSCH.F07)"
	         THISFORM.GRID1.COLUMN6.WIDTH=INT_015*180
	         THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='安全資料'      
			 THISFORM.GRID1.COLUMN7.CONTROLSOURCE='INSCH.F08'
	         THISFORM.GRID1.COLUMN7.WIDTH=INT_015*120
	         THISFORM.GRID1.COLUMN8.HEADER1.CAPTION=''         
	         THISFORM.GRID1.COLUMN8.CONTROLSOURCE=''
	         THISFORM.GRID1.COLUMN8.WIDTH=INT_015*50  
	         THISFORM.CMND2.VISIBLE=.F.                         
	     ENDIF                           
         THISFORM.GRID1.SETFOCUS 
      ENDPROC 
      PROC GRID1.AFTERROWCOLCHANGE
           LPARAMETERS XCOLINDEX
           THISFORM.GRID1.TOOLTIPTEXT=IIF(DATE()-CTOD(LEFT(INSCH.F08,9))<=5 AND INSCH.F09='1','剛回覆交期',IIF(INSCH.F09<>'1','超過10天未回覆交期',IIF(INSCH.F03<DATE() AND INSCH.F09='1','應到貨而未到貨','')))
           THISFORM.CMND2.ENABLED = CHA AND INSCH.DE_CK = 'D'
           IF THISFORM.LBLF18.VISIBLE=.T.
              THISFORM.TXTF18.VALUE=INSCH.F18
           ENDIF
      ENDPROC 
      PROCEDURE CMND3.CLICK
          IF IIF(SEEK(INSCH.F16,'C01'),C01.F23,'')=SYS_OPER OR IIF(SEEK(INSCH.F16,'C01'),C01.F33,'')=SYS_OPER OR IIF(SEEK(INSCH.F16,'C01'),C01.F18,'')=SYS_OPER
             THIS.Enabled=.F.
             THISFORM.CMND1.ENABLED=.F.
             THISFORM.CMND2.ENABLED=.F.
             THISFORM.GRID1.ENABLED=.F.
             THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
             THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
             THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
             THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
             THISFORM.YES.ENABLED=.T.
             THISFORM.NO.ENABLED=.T.
             THISFORM.YES.VISIBLE=.T.
             THISFORM.NO.VISIBLE=.T.           
             THISFORM.TXTF18.READONLY=.F.
             THISFORM.TXTF18.SETFOCUS
          ELSE
             =MESSAGEBOX('你無權線分配此筆進貨計劃!',0+48,'提示訊息視窗')
             THISFORM.NO.ENABLED=.T.
             THISFORM.NO.CLICK
          ENDIF   
      ENDPROC
      PROCEDURE CMND1.CLICK
          SELE INSCH
          USE
          AREA1='C05'
         THISFORM.RELEASE
      ENDPROC  
      PROCEDURE YES.CLICK
         IF THISFORM.TXTF18.VALUE<>INSCH.F18
             SELECT INSCH
             REPLACE F18 WITH THISFORM.TXTF18.VALUE             
             *UPDATE D07 SET D07.F18=INSCH.F18 WHERE D07.F01=INSCH.F01 AND D07.F02=INSCH.F02 AND D07.F03=INSCH.F03 AND D07.F07=INSCH.F07 FROM D07
             UPDATE D07 SET D07.F18=INSCH.F18 WHERE RECNO()=INSCH.EXP_1 FROM D07
         ENDIF    
         THISFORM.NO.CLICK
      ENDPROC
      PROCEDURE NO.CLICK
         THIS.Enabled=.F.
         THIS.Visible=.F.
         THISFORM.YES.ENABLED=.F.
         THISFORM.YES.Visible=.F.
         THISFORM.TXTF18.READONLY=.T.
         THISFORM.CMND1.ENABLED=.T.
         THISFORM.CMND2.ENABLED=.T.
         THISFORM.CMND3.ENABLED=.T.
         THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
         THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
         THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
         THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
         SELECT INSCH
         THISFORM.GRID1.ENABLED=.T.
         THISFORM.GRID1.SETFOCUS
         THISFORM.REFRESH
      ENDPROC
 PROCEDURE CMND2.CLICK
 	  SELECT A02
 	  SEEK SYS_OPER+'C66'
      SELECT IIF(C66.F01 = 0,1,0) AS EXP_1,C66.*,ICASE(F08 = 'A','海運    ',F08 = 'B','海運提前',F08 = 'C','空運    ',F08 = 'D','空運提前',F08 = 'E','快遞    ',F08 = 'F','快遞提前',F08 = 'G','海運延後',F08 = 'H','空運延後',F08 = 'J','快遞延後',SPACE(8)) AS F088;
      FROM C66 WHERE C66.F04 = INSCH.F02 AND C66.F12 = INSCH.F01 AND C66.F11 = IIF(SEEK(LEFT(ALLTRIM(INSCH.F07),10),'P05'),P05.F04,C05.F06)  ORDER BY C66.F03 INTO CURSOR C66_TEMP READWRITE
      SELECT C66_TEMP
      GO TOP
      CH_SEEK=CREATEOBJECT("CH_SEEK")  
      CH_SEEK.SHOW     
 	  SELECT A02
 	  SEEK SYS_OPER+'C05'     
      AREA1='INSCH'
      SELECT INSCH
      THISFORM.GRID1.SETFOCUS 
   ENDPROC            
ENDDEFINE       
**************************************異動 
DEFINE CLASS CH_SEEK AS FORM
  AUTOCENTER=.T.
  FONTSIZE=INT_015*9 
  TOP=INT_015*110
  LEFT=INT_015*40    
  HEIGHT=INT_015*350
  WIDTH=INT_015*550
  FONTSIZE=INT_015*9
  MOVABLE=.T.
  MAXBUTTON=.F.
  MINBUTTON=.F.      
  CONTROLBOX=.F.
  BORDERSTYLE=2
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WINDOWTYPE=1
  NAME='CH_SEEK'      
  ADD OBJECT GRID1 AS GRID WITH;        
      LEFT=INT_015*10,;
      TOP=INT_015*165,;
      WIDTH=INT_015*540,;      
      HEIGHT=INT_015*150,;      
      ROWHEIGHT=INT_015*18,;
      HEADERHEIGHT=INT_015*19,;  
      RECORDSOURCE='C66_TEMP',;    
      DELETEMARK=.F.,;
      READONLY=.T.,;
      RECORDSOURCETYPE=1,;
      ALLOWCELLSELECTION=.T.,;
      HIGHLIGHTROWLINEWIDTH=4,;
      ALLOWROWSIZING=.F.,;
      COLUMNCOUNT=9,;            
      NAME='GRID1',;
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;      
      COLUMN3.NAME='COLUMN3',; 
      COLUMN4.NAME='COLUMN4',;
      COLUMN5.NAME='COLUMN5',;      
      COLUMN6.NAME='COLUMN6',;
      COLUMN7.NAME='COLUMN7',;
      COLUMN8.NAME='COLUMN8',;
      COLUMN9.NAME='COLUMN9'    
  ADD OBJECT KEY_LIST AS KEY_LIST WITH;
      AUTOCENTER=.T.
  ADD OBJECT CMDGROUP AS CMDGROUP WITH;
      AUTOSIZE=.T.  
  ADD OBJECT LBLF03 AS LABEL WITH;
      TOP=INT_015*10,;
      LEFT=INT_015*10,;
      HEIGHT=INT_015*17,;      
      WIDTH=INT_015*60,;
      CAPTION='異動日期'            
  ADD OBJECT TXTF03 AS TEXTBOX WITH;
      TOP=INT_015*5,;
      LEFT=INT_015*65,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*80,;
      MAXLENGTH=8   
  ADD OBJECT LBLF08 AS LABEL WITH;
      TOP=INT_015*10,;
      LEFT=INT_015*390,;
      HEIGHT=INT_015*17,;      
      WIDTH=INT_015*60,;
      CAPTION='運貨方式'   
 ADD OBJECT COMBOBOX08 AS COMBOBOX WITH;      
      TOP=INT_015*5,;
      LEFT=INT_015*445,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*80,;
      STYLE=2,;
      FONTSIZE=INT_015*9   
  ADD OBJECT TXTF08 AS TEXTBOX WITH;
      TOP=INT_015*5,;
      LEFT=INT_015*445,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*80,; 
      MAXLENGTH=10       
  ADD OBJECT LBLF02 AS LABEL WITH;
      TOP=INT_015*36,;
      LEFT=INT_015*10,;
      HEIGHT=INT_015*17,;      
      WIDTH=INT_015*60,;
      CAPTION='異動類別'      
 ADD OBJECT COMBOBOX02 AS COMBOBOX WITH;      
      TOP=INT_015*31,;
      LEFT=INT_015*65,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*80,;
      STYLE=2,;
      FONTSIZE=INT_015*9    
  ADD OBJECT TXTF02 AS TEXTBOX WITH;
      TOP=INT_015*31,;
      LEFT=INT_015*65,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*80              
  ADD OBJECT LBLF10 AS LABEL WITH;
      TOP=INT_015*36,;
      LEFT=INT_015*390,;
      HEIGHT=INT_015*17,;      
      WIDTH=INT_015*60,;
       CAPTION='運費對象'    
 ADD OBJECT COMBOBOX10 AS COMBOBOX WITH;      
      TOP=INT_015*31,;
      LEFT=INT_015*445,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*80,;
      STYLE=2,;
      FONTSIZE=INT_015*9         
  ADD OBJECT TXTF10 AS TEXTBOX WITH;
      TOP=INT_015*31,;
      LEFT=INT_015*445,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*80,; 
      MAXLENGTH=10  
  ADD OBJECT LBLF06 AS LABEL WITH;
      TOP=INT_015*62,;
      LEFT=INT_015*10,;
      HEIGHT=INT_015*17,;      
      WIDTH=INT_015*60,;
       CAPTION='原訂交期'            
  ADD OBJECT TXTF06 AS TEXTBOX WITH;
      TOP=INT_015*57,;
      LEFT=INT_015*65,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*80,;
      MAXLENGTH=8
  ADD OBJECT LBLF05 AS LABEL WITH;
      TOP=INT_015*62,;
      LEFT=INT_015*390,;
      HEIGHT=INT_015*17,;      
      WIDTH=INT_015*60,;
      CAPTION='異動數量'            
  ADD OBJECT TXTF05 AS TEXTBOX WITH;
      TOP=INT_015*57,;
      LEFT=INT_015*445,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*80,;
      MAXLENGTH=13      
  ADD OBJECT LBLF07 AS LABEL WITH;
      TOP=INT_015*88,;
      LEFT=INT_015*10,;
      HEIGHT=INT_015*17,;      
      WIDTH=INT_015*60,;
      CAPTION='希望交期'            
  ADD OBJECT TXTF07 AS TEXTBOX WITH;
      TOP=INT_015*83,;
      LEFT=INT_015*65,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*80,;
      MAXLENGTH=8                
  ADD OBJECT LBLF14 AS LABEL WITH;
      TOP=INT_015*114,;
      LEFT=INT_015*10,;
      HEIGHT=INT_015*17,;      
      WIDTH=INT_015*60,;
      CAPTION='備註說明'            
  ADD OBJECT TXTF14 AS TEXTBOX WITH;
      TOP=INT_015*109,;
      LEFT=INT_015*65,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*460,;
      MAXLENGTH=80     
  ADD OBJECT LBLF99 AS LABEL WITH;
      TOP=INT_015*140,;
      LEFT=INT_015*10,;
      HEIGHT=INT_015*17,;      
      AUTOSIZE=.T.,;
      CAPTION=''     
  ADD OBJECT ORPGROUP AS ORPGROUP WITH;    
      TOP=INT_015*316,;
      LEFT=INT_015*70
  ADD OBJECT SHRGROUP AS SHRGROUP WITH;
      TOP=INT_015*316,;
      LEFT=INT_015*370    
  ADD OBJECT PNT_BT AS COMMANDBUTTON WITH;
      LEFT=INT_015*200,;
      TOP=INT_015*321,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\harrow.CUR',;
      CAPTION='\<P.列印',;
      TOOLTIPTEXT='列印資料!快速鍵->ALT+P'
      NAME='PNT_BT' 
  ADD OBJECT CMND1 AS COMMANDBUTTON WITH;
      LEFT=INT_015*243,;
      TOP=INT_015*321,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\harrow.CUR',;
      CAPTION='\<X.離開',;
      TOOLTIPTEXT='取消此作業畫面!快速鍵->ALT+X'
      NAME='CMND1'
 PROC INIT   
       THISFORM.CAPTION='C66.入貨異動單' + '   料號：' + ALLTRIM(C05.F02) + '   客戶：' + ALLTRIM(IIF(SEEK(IIF(SEEK(LEFT(ALLTRIM(INSCH.F07),10),'P05'),P05.F04,C05.F06),'C01'),C01.F05,'')) + '   採購單號：' + INSCH.F01
       THISFORM.SETALL('HEIGHT',INT_015*25,'TEXTBOX')
       THISFORM.SETALL('HEIGHT',INT_015*17,'LABEL')
       THISFORM.SETALL('FONTSIZE',INT_015*9,'TEXTBOX')
       THISFORM.SETALL('FONTSIZE',INT_015*9,'LABEL')       
       THISFORM.SETALL('READONLY',.T.,'TEXTBOX')  
	   THISFORM.KEY_LIST.VISIBLE=.F.                
	   THISFORM.CMDGROUP.VISIBLE=.F.
       THISFORM.SHRGROUP.VISIBLE=.F.
       THISFORM.SHRGROUP.ENABLED=.F.
       THISFORM.ORPGROUP.ESC_BOTT.VISIBLE=.F.
       THISFORM.ORPGROUP.PNT_BOTT.VISIBLE=.F.
       THISFORM.COMBOBOX02.VISIBLE = .T.
       THISFORM.COMBOBOX08.VISIBLE = .T.
       THISFORM.COMBOBOX10.VISIBLE = .T. 
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'COLUMN')
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'HEADER')  
       THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(C66_TEMP.F01 = 0,RGB(255,0,0),'')","COLUMN") 
       THISFORM.GRID1.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)
       THISFORM.GRID1.COLUMN4.BACKCOLOR = RGB(255,255,0)
       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION=''
       THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='列印狀態'    
       THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='異動日期'
       THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='異動類別'
       THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='原定交期'
       THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='希望交期'
       THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='異動數量'
       THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='運貨方式'
       THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='運費對象'
       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='C66_TEMP.EXP_1'
       THISFORM.GRID1.COLUMN2.CONTROLSOURCE="IIF(C66_TEMP.F01 = 0,'尚未列印','已列印')"
       THISFORM.GRID1.COLUMN3.CONTROLSOURCE='C66_TEMP.F03'
       THISFORM.GRID1.COLUMN4.CONTROLSOURCE="ICASE(C66_TEMP.F02 = '1','提前交期',C66_TEMP.F02 = '2','延後交期','取消請購')"
       THISFORM.GRID1.COLUMN5.CONTROLSOURCE="IIF(!EMPTY(C66_TEMP.F09),C66_TEMP.F09,IIF(C66_TEMP.F17 = '1',C66_TEMP.F06,'尚未回覆'))"
       THISFORM.GRID1.COLUMN6.CONTROLSOURCE='C66_TEMP.F07'
       THISFORM.GRID1.COLUMN7.CONTROLSOURCE='C66_TEMP.F05'
       THISFORM.GRID1.COLUMN8.CONTROLSOURCE='C66_TEMP.F088'
       THISFORM.GRID1.COLUMN9.CONTROLSOURCE="ICASE(C66_TEMP.F10 = '1','客戶負擔',C66_TEMP.F10 = '2','公司負擔','')"
       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*20
       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*55
       THISFORM.GRID1.COLUMN3.WIDTH=INT_015*65
       THISFORM.GRID1.COLUMN4.WIDTH=INT_015*55
       THISFORM.GRID1.COLUMN5.WIDTH=INT_015*65
       THISFORM.GRID1.COLUMN6.WIDTH=INT_015*65
       THISFORM.GRID1.COLUMN7.WIDTH=INT_015*70
       THISFORM.GRID1.COLUMN8.WIDTH=INT_015*55
       THISFORM.GRID1.COLUMN9.WIDTH=INT_015*55      
       THISFORM.GRID1.SETFOCUS
       IF THISFORM.GRID1.ACTIVEROW=0
		  THISFORM.SETALL('VALUE','','TEXTBOX') 
		  THISFORM.LBLF99.CAPTION = ''
	      THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
	      THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
	      THISFORM.PNT_BT.ENABLED=.F.
       ELSE
	      THISFORM.ORPGROUP.EDIT_BOTT.ENABLED = IIF(A02.F05 = '*',.T.,.F.)
	      THISFORM.ORPGROUP.DEL_BOTT.ENABLED = IIF(A02.F06 = '*',.T.,.F.)
	      THISFORM.PNT_BT.ENABLED = IIF(A02.F07 = '*',.T.,.F.)
	      THISFORM.TXTF02.VALUE = ICASE(C66_TEMP.F02 = '1','提前交期',C66_TEMP.F02 = '2','延後交期','取消請購')
	      THISFORM.TXTF03.VALUE = C66_TEMP.F03
	      THISFORM.TXTF05.VALUE = C66_TEMP.F05
	      THISFORM.TXTF06.VALUE = IIF(!EMPTY(C66_TEMP.F09),C66_TEMP.F09,IIF(C66_TEMP.F17 = '1',C66_TEMP.F06,'尚未回覆'))
	      THISFORM.TXTF07.VALUE = C66_TEMP.F07
	      THISFORM.TXTF08.VALUE = C66_TEMP.F088
	      THISFORM.TXTF10.VALUE = ICASE(C66_TEMP.F10 = '1','客戶負擔',C66_TEMP.F10 = '2','公司負擔','')
	      THISFORM.TXTF14.VALUE = C66_TEMP.F14
	      THISFORM.LBLF99.CAPTION = '安全資料 ' + C66_TEMP.F99
       ENDIF
       THISFORM.ORPGROUP.NEW_BOTT.ENABLED = IIF(A02.F04 = '*',.T.,.F.)
   ENDPROC   
  PROC GRID1.INIT      
	 THISFORM.GRID1.COLUMN1.READONLY=.F.
	 THISFORM.GRID1.COLUMN2.READONLY=.T.
	 THISFORM.GRID1.COLUMN3.READONLY=.T.
	 THISFORM.GRID1.COLUMN4.READONLY=.T.
	 THISFORM.GRID1.COLUMN5.READONLY=.T.
	 THISFORM.GRID1.COLUMN6.READONLY=.T.
	 THISFORM.GRID1.COLUMN7.READONLY=.T.
	 THISFORM.GRID1.COLUMN8.READONLY=.T.
	 THISFORM.GRID1.COLUMN9.READONLY=.T.
	 THISFORM.GRID1.COLUMN1.removeobject("TEXT1")
	 THISFORM.GRID1.COLUMN1.AddObject("CheckBox1","CheckBox1") 
	 THISFORM.GRID1.COLUMN1.CurrentControl="CheckBox1" 
	 THISFORM.GRID1.COLUMN1.Sparse=.F.
	 THISFORM.GRID1.COLUMN1.CheckBox1.Visible=.T.
	 THISFORM.GRID1.COLUMN1.CheckBox1.CAPTION=''
	 THISFORM.GRID1.COLUMN1.CheckBox1.AUTOSIZE=.T.
	 THISFORM.GRID1.COLUMN1.CheckBox1.CENTERED=.T.
	 THISFORM.GRID1.COLUMN1.CheckBox1.BACKSTYLE=0
	 THISFORM.GRID1.COLUMN1.CheckBox1.LEFT=5	 
  ENDPROC 
  PROCEDURE GRID1.AFTERROWCOLCHANGE
       LPARAMETERS NCOLINDEX
          THISFORM.GRID1.TOOLTIPTEXT = IIF(C66_TEMP.F01 = 0,'尚未列印','已列印')
	      THISFORM.TXTF02.VALUE = ICASE(C66_TEMP.F02 = '1','提前交期',C66_TEMP.F02 = '2','延後交期','取消請購')
	      THISFORM.TXTF03.VALUE = C66_TEMP.F03
	      THISFORM.TXTF05.VALUE = C66_TEMP.F05
	      THISFORM.TXTF06.VALUE = IIF(!EMPTY(C66_TEMP.F09),C66_TEMP.F09,IIF(C66_TEMP.F17 = '1',C66_TEMP.F06,'尚未回覆'))
	      THISFORM.TXTF07.VALUE = C66_TEMP.F07
	      THISFORM.TXTF08.VALUE = C66_TEMP.F088
	      THISFORM.TXTF10.VALUE = ICASE(C66_TEMP.F10 = '1','客戶負擔',C66_TEMP.F10 = '2','公司負擔','')
	      THISFORM.TXTF14.VALUE = C66_TEMP.F14 
	      THISFORM.LBLF99.CAPTION = '安全資料 ' + C66_TEMP.F99
  ENDPROC 
   PROCEDURE COMBOBOX02.INIT
		WITH THIS
   			.ADDITEM('提前交期')
   			.ADDITEM('延後交期')
   			.ADDITEM('取消請購')
   			.VALUE = 1
    	ENDWITH
   ENDPROC     
PROCEDURE COMBOBOX02.INTERACTIVECHANGE 
	 THISFORM.COMBOBOX08.CLEAR
	 THISFORM.TXTF08.VISIBLE = .F.
	 THISFORM.TXTF10.VISIBLE = .T.
	 THISFORM.COMBOBOX08.VISIBLE = .T.
	 THISFORM.COMBOBOX10.VISIBLE = .F.	
	 THISFORM.COMBOBOX08.VALUE = 1
	 THISFORM.TXTF07.ENABLED = .T.
	 THISFORM.TXTF07.VALUE = DATE()
	 THISFORM.TXTF10.VALUE = ''
	 DO CASE
	 	CASE  THISFORM.COMBOBOX02.VALUE = 1
	 	      THISFORM.COMBOBOX08.ADDITEM('海運')
	 	      THISFORM.COMBOBOX08.ADDITEM('海運提前')
	 	      THISFORM.COMBOBOX08.ADDITEM('空運')
	 	      THISFORM.COMBOBOX08.ADDITEM('空運提前')
	 	      THISFORM.COMBOBOX08.ADDITEM('快遞')
	 	      THISFORM.COMBOBOX08.ADDITEM('快遞提前')
	 	      THISFORM.TXTF08.VALUE = IIF(THISFORM.COMBOBOX08.VALUE = 1 OR THISFORM.COMBOBOX08.VALUE = 2,'',THISFORM.COMBOBOX10.DISPLAYVALUE)
	 	CASE  THISFORM.COMBOBOX02.VALUE = 2
	 		  THISFORM.COMBOBOX08.ADDITEM('海運延後') 
	 	      THISFORM.COMBOBOX08.ADDITEM('空運延後') 
	 	      THISFORM.COMBOBOX08.ADDITEM('快遞延後')
	 	      THISFORM.TXTF08.VALUE = IIF(THISFORM.COMBOBOX08.VALUE = 1,'',THISFORM.COMBOBOX10.DISPLAYVALUE)
	 	CASE  THISFORM.COMBOBOX02.VALUE = 3
	 		  THISFORM.TXTF07.ENABLED = .F.
	 		  THISFORM.TXTF07.VALUE = ''
	 	      THISFORM.TXTF08.VISIBLE = .T.
	 	      THISFORM.COMBOBOX08.VISIBLE = .F.
	 	      THISFORM.TXTF08.VALUE = ''
			  THISFORM.TXTF10.VISIBLE = .T.
			  THISFORM.COMBOBOX10.VISIBLE = .F.
	 ENDCASE   
ENDPROC    
   PROCEDURE COMBOBOX08.INIT
		WITH THIS
   			.ADDITEM('海運')
   			.ADDITEM('海運提前')
   			.ADDITEM('空運')
   			.ADDITEM('空運提前')
   			.ADDITEM('快遞')
   			.ADDITEM('快遞提前')
   			.VALUE = 1
    	ENDWITH           
   ENDPROC  
PROCEDURE COMBOBOX08.INTERACTIVECHANGE   
      IF THISFORM.COMBOBOX08.DISPLAYVALUE = '海運' OR THISFORM.COMBOBOX08.DISPLAYVALUE = '海運提前' OR THISFORM.COMBOBOX08.DISPLAYVALUE = '海運延後'
		 THISFORM.TXTF10.VISIBLE = .T.
		 THISFORM.COMBOBOX10.VISIBLE = .F. 
	  ELSE
		 THISFORM.TXTF10.VISIBLE = .F.
		 THISFORM.COMBOBOX10.VISIBLE = .T. 
		 THISFORM.COMBOBOX10.VALUE = 1  
	  ENDIF
 ENDPROC 
   PROCEDURE COMBOBOX10.INIT
		WITH THIS
   			.ADDITEM('客戶負擔')
   			.ADDITEM('公司負擔')
   			.VALUE = 1
    	ENDWITH           
   ENDPROC     
PROCEDURE ORPGROUP.NEW_BOTT.CLICK 
	   THISFORM.ORPGROUP.ENABLED = .F.
	   THISFORM.CMND1.ENABLED =.F.
       THISFORM.GRID1.ENABLED=.F.
       THISFORM.PNT_BT.ENABLED = .F.
       THISFORM.SETALL('READONLY',.F.,'TEXTBOX') 
       THISFORM.TXTF02.VISIBLE = .F.
       THISFORM.TXTF08.VISIBLE = .F.      
       THISFORM.TXTF03.READONLY= .T.
       THISFORM.TXTF06.READONLY= .T.
       THISFORM.TXTF08.READONLY= .T.
       THISFORM.TXTF10.READONLY= .T.
       THISFORM.COMBOBOX02.VISIBLE = .T.
       THISFORM.COMBOBOX08.VISIBLE = .T.
       THISFORM.COMBOBOX10.VISIBLE = .F.
       THISFORM.COMBOBOX02.VALUE = 1
       THISFORM.TXTF02.VALUE = ''
       THISFORM.TXTF03.VALUE = DATE()
       THISFORM.TXTF05.VALUE = INSCH.F04
       THISFORM.TXTF06.VALUE = IIF(INSCH.F09 = '1',INSCH.F03,'尚未回覆')
       THISFORM.TXTF07.VALUE = DATE()
       THISFORM.TXTF08.VALUE = ''
       THISFORM.TXTF10.VALUE = ''
       THISFORM.TXTF14.VALUE = ''
       THISFORM.LBLF99.CAPTION = ''
       THISFORM.COMBOBOX02.SETFOCUS 
 ENDPROC
 PROCEDURE SHRGROUP.SHURE1_BOTT.CLICK  
      IF EMPTY(THISFORM.TXTF07.VALUE) = .T. AND THISFORM.COMBOBOX02.VALUE <> 3
          =MESSAGEBOX('希望交期不得空白!',0+64,'提示訊息視窗')
          THISFORM.TXTF07.SETFOCUS
          RETURN            
      ENDIF 
      IF INSCH.F09 = '1'
         IF THISFORM.COMBOBOX02.VALUE = 2 AND THISFORM.TXTF07.VALUE <= INSCH.F03
            =MESSAGEBOX('延後之希望交期不得小於原定交期!',0+64,'提示訊息視窗')
            THISFORM.TXTF07.SETFOCUS
            RETURN            
         ENDIF     
      ENDIF
      IF THISFORM.TXTF05.VALUE <= 0
          =MESSAGEBOX('異動數量不得小於等於零!',0+64,'提示訊息視窗')
          THISFORM.TXTF05.SETFOCUS
          RETURN            
      ENDIF     
      IF THISFORM.TXTF05.VALUE > INSCH.F04
          =MESSAGEBOX('異動數量不得大於訂購數量!',0+64,'提示訊息視窗')
          THISFORM.TXTF05.SETFOCUS
          RETURN            
      ENDIF
      SELECT C66
      APPEND BLANK
      REPLACE C66.F02 WITH ALLTRIM(STR(THISFORM.COMBOBOX02.VALUE))
      REPLACE C66.F03 WITH THISFORM.TXTF03.VALUE
      REPLACE C66.F04 WITH INSCH.F02
      REPLACE C66.F05 WITH THISFORM.TXTF05.VALUE
      REPLACE C66.F06 WITH INSCH.F03
      REPLACE C66.F07 WITH IIF(C66.F02 = '3',CTOD(''),THISFORM.TXTF07.VALUE)
      REPLACE C66.F08 WITH IIF(C66.F02 = '3','',CHR(IIF(C66.F02 = '1',64,70) + THISFORM.COMBOBOX08.VALUE))
      REPLACE C66.F10 WITH IIF(THISFORM.COMBOBOX10.VISIBLE = .T.,ALLTRIM(STR(THISFORM.COMBOBOX10.VALUE)),'')
      REPLACE C66.F11 WITH IIF(SEEK(LEFT(ALLTRIM(INSCH.F07),10),'P05'),P05.F04,C05.F06)
      REPLACE C66.F12 WITH INSCH.F01
      REPLACE C66.F13 WITH IIF(SEEK(C66.F11,'C01'),IIF(ALLTRIM(INT_209) = 'A',C01.F18,C01.F33),sys_oper)
      REPLACE C66.F14 WITH THISFORM.TXTF14.VALUE
      REPLACE C66.F17 WITH INSCH.F09
      REPLACE C66.F18 WITH INSCH.F05
      REPLACE C66.F20 WITH IIF(SEEK(C66.F11,'C01'),C01.F23,sys_oper)
      REPLACE C66.F99 WITH IIF(INT_012=1,PADL(ALLTRIM(STR(YEAR(DATE())-1911)),3,' ')+RIGHT(DTOC(DATE()),6),dtoc(DATE())+' ')+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
   	  SELECT C66_TEMP
      APPEND BLANK
      REPLACE C66_TEMP.EXP_1 WITH 1
      REPLACE C66_TEMP.F02 WITH ALLTRIM(STR(THISFORM.COMBOBOX02.VALUE))
      REPLACE C66_TEMP.F03 WITH THISFORM.TXTF03.VALUE
      REPLACE C66_TEMP.F04 WITH INSCH.F02
      REPLACE C66_TEMP.F05 WITH THISFORM.TXTF05.VALUE
      REPLACE C66_TEMP.F06 WITH INSCH.F03
      REPLACE C66_TEMP.F07 WITH IIF(C66_TEMP.F02 = '3',CTOD(''),THISFORM.TXTF07.VALUE)
      REPLACE C66_TEMP.F08 WITH IIF(C66_TEMP.F02 = '3','',CHR(IIF(C66_TEMP.F02 = '1',64,70) + THISFORM.COMBOBOX08.VALUE))
      REPLACE C66_TEMP.F088 WITH IIF(C66_TEMP.F02 = '3','',ALLTRIM(THISFORM.COMBOBOX08.DISPLAYVALUE))
      REPLACE C66_TEMP.F10 WITH IIF(THISFORM.COMBOBOX10.VISIBLE = .T.,ALLTRIM(STR(THISFORM.COMBOBOX10.VALUE)),'')
      REPLACE C66_TEMP.F11 WITH IIF(SEEK(LEFT(ALLTRIM(INSCH.F07),10),'P05'),P05.F04,C05.F06)
      REPLACE C66_TEMP.F12 WITH INSCH.F01
      REPLACE C66_TEMP.F13 WITH IIF(SEEK(C66_TEMP.F11,'C01'),IIF(ALLTRIM(INT_209) = 'A',C01.F18,C01.F33),sys_oper)
      REPLACE C66_TEMP.F14 WITH THISFORM.TXTF14.VALUE
      REPLACE C66_TEMP.F17 WITH INSCH.F09
      REPLACE C66_TEMP.F18 WITH INSCH.F05
      REPLACE C66_TEMP.F20 WITH IIF(SEEK(C66_TEMP.F11,'C01'),C01.F23,sys_oper)
      REPLACE C66_TEMP.F99 WITH IIF(INT_012=1,PADL(ALLTRIM(STR(YEAR(DATE())-1911)),3,' ')+RIGHT(DTOC(DATE()),6),dtoc(DATE())+' ')+IIF(SEEK(sys_oper,'A01'),A01.F03,'') 
	  SELECT INSCH
	  REPLACE INSCH.F14 WITH ALLTRIM(STR(THISFORM.COMBOBOX02.VALUE))
	  REPLACE INSCH.F15 WITH THISFORM.TXTF03.VALUE
	  SELECT D07
	  SET ORDER TO D074   && F01+F02+DTOS(F03)
	  SEEK INSCH.F01 + INSCH.F02 + DTOS(INSCH.F03)
	  IF FOUND()
	     REPLACE D07.F14 WITH ALLTRIM(STR(THISFORM.COMBOBOX02.VALUE))
	     REPLACE D07.F15 WITH THISFORM.TXTF03.VALUE
	  ENDIF
	  SELECT C66_TEMP
	  UNLOCK ALL
	  THISFORM.GRID1.ENABLED=.T.
	  THISFORM.GRID1.SETFOCUS  
	  THISFORM.ORPGROUP.NEW_BOTT.CLICK
 ENDPROC
 PROCEDURE ORPGROUP.EDIT_BOTT.CLICK 
	   THISFORM.ORPGROUP.ENABLED = .F.
	   THISFORM.CMND1.ENABLED =.F.
	   THISFORM.PNT_BT.ENABLED = .F.
       THISFORM.GRID1.ENABLED=.F.
       THISFORM.SETALL('READONLY',.F.,'TEXTBOX') 
       THISFORM.TXTF02.VISIBLE = .F.
       THISFORM.TXTF08.VISIBLE = .F.
       THISFORM.TXTF03.READONLY= .T.
       THISFORM.TXTF06.READONLY= .T.
       THISFORM.TXTF08.READONLY= .T.
       THISFORM.TXTF10.READONLY= .T.
       THISFORM.COMBOBOX02.VISIBLE = .T.
       THISFORM.COMBOBOX08.VISIBLE = .T.
       THISFORM.COMBOBOX10.VISIBLE = .F.
       THISFORM.COMBOBOX02.VALUE = VAL(C66_TEMP.F02)
       THISFORM.COMBOBOX02.INTERACTIVECHANGE
       THISFORM.COMBOBOX08.VALUE = ASC(C66_TEMP.F08) - IIF(C66_TEMP.F02 = '1',64,70)
       THISFORM.TXTF10.VISIBLE = IIF(EMPTY(C66_TEMP.F10),.T.,.F.)
       THISFORM.COMBOBOX10.VISIBLE = IIF(EMPTY(C66_TEMP.F10),.F.,.T.)
       THISFORM.COMBOBOX10.VALUE = VAL(C66_TEMP.F10)
       THISFORM.TXTF07.VALUE = C66_TEMP.F07
       THISFORM.TXTF10.VALUE = ICASE(C66_TEMP.F10 = '1','客戶負擔',C66_TEMP.F10 = '1','公司負擔','')
       THISFORM.COMBOBOX02.SETFOCUS 
 ENDPROC 
 PROCEDURE SHRGROUP.SHURE2_BOTT.CLICK  
      IF EMPTY(THISFORM.TXTF07.VALUE) = .T. AND THISFORM.COMBOBOX02.VALUE <> 3
          =MESSAGEBOX('希望交期不得空白!',0+64,'提示訊息視窗')
          THISFORM.TXTF07.SETFOCUS
          RETURN            
      ENDIF 
      IF INSCH.F09 = '1'
         IF THISFORM.COMBOBOX02.VALUE = 2 AND THISFORM.TXTF07.VALUE <= IIF(EMPTY(C66_TEMP.F09),C66_TEMP.F06,C66_TEMP.F09)
            =MESSAGEBOX('延後之希望交期不得小於原定交期!',0+64,'提示訊息視窗')
            THISFORM.TXTF07.SETFOCUS
            RETURN            
         ENDIF     
      ENDIF
      IF THISFORM.TXTF05.VALUE <= 0
          =MESSAGEBOX('異動數量不得小於等於零!',0+64,'提示訊息視窗')
          THISFORM.TXTF05.SETFOCUS
          RETURN            
      ENDIF     
      IF THISFORM.TXTF05.VALUE > INSCH.F04
          =MESSAGEBOX('異動數量不得大於訂購數量!',0+64,'提示訊息視窗')
          THISFORM.TXTF05.SETFOCUS
          RETURN            
      ENDIF
      SELECT C66
      SET ORDER TO C661 &&F02+DTOS(F03)+F04+ALLTRIM(TRANSFORM(F05,"@R 99,999,999.99"))+F08+F10+F11+F12+F13
      SEEK C66_TEMP.F02 + DTOS(C66_TEMP.F03) + C66_TEMP.F04 + ALLTRIM(TRANSFORM(C66_TEMP.F05,"@R 99,999,999.99")) + C66_TEMP.F08 + C66_TEMP.F10 + C66_TEMP.F11 + C66_TEMP.F12 + C66_TEMP.F13
	  IF FOUND()
	     REPLACE C66.F01 WITH 0
	     REPLACE C66.F02 WITH ALLTRIM(STR(THISFORM.COMBOBOX02.VALUE))
	     REPLACE C66.F04 WITH INSCH.F02
	     REPLACE C66.F05 WITH THISFORM.TXTF05.VALUE
	     REPLACE C66.F06 WITH INSCH.F03
	     REPLACE C66.F07 WITH IIF(C66.F02 = '3',CTOD(''),THISFORM.TXTF07.VALUE)
	     REPLACE C66.F08 WITH IIF(C66.F02 = '3','',CHR(IIF(C66.F02 = '1',64,70) + THISFORM.COMBOBOX08.VALUE))
	     REPLACE C66.F10 WITH IIF(THISFORM.COMBOBOX10.VISIBLE = .T.,ALLTRIM(STR(THISFORM.COMBOBOX10.VALUE)),'')
	     REPLACE C66.F14 WITH THISFORM.TXTF14.VALUE
	     REPLACE C66.F17 WITH INSCH.F09
	     REPLACE C66.F99 WITH IIF(INT_012=1,PADL(ALLTRIM(STR(YEAR(DATE())-1911)),3,' ')+RIGHT(DTOC(DATE()),6),dtoc(DATE())+' ')+IIF(SEEK(sys_oper,'A01'),A01.F03,'')    
	  ENDIF
   	  SELECT C66_TEMP
      LOCK()
      IF RLOCK()
	      REPLACE C66_TEMP.EXP_1 WITH 1
	      REPLACE C66_TEMP.F01 WITH 0
	      REPLACE C66_TEMP.F02 WITH ALLTRIM(STR(THISFORM.COMBOBOX02.VALUE))
	      REPLACE C66_TEMP.F04 WITH INSCH.F02
	      REPLACE C66_TEMP.F05 WITH THISFORM.TXTF05.VALUE
	      REPLACE C66_TEMP.F06 WITH INSCH.F03
	      REPLACE C66_TEMP.F07 WITH IIF(C66_TEMP.F02 = '3',CTOD(''),THISFORM.TXTF07.VALUE)
	      REPLACE C66_TEMP.F08 WITH IIF(C66_TEMP.F02 = '3','',CHR(IIF(C66_TEMP.F02 = '1',64,70) + THISFORM.COMBOBOX08.VALUE))
	      REPLACE C66_TEMP.F088 WITH IIF(C66_TEMP.F02 = '3','',ALLTRIM(THISFORM.COMBOBOX08.DISPLAYVALUE))
	      REPLACE C66_TEMP.F10 WITH IIF(THISFORM.COMBOBOX10.VISIBLE = .T.,ALLTRIM(STR(THISFORM.COMBOBOX10.VALUE)),'')
	      REPLACE C66_TEMP.F14 WITH THISFORM.TXTF14.VALUE
	      REPLACE C66_TEMP.F17 WITH INSCH.F09
	      REPLACE C66_TEMP.F99 WITH IIF(INT_012=1,PADL(ALLTRIM(STR(YEAR(DATE())-1911)),3,' ')+RIGHT(DTOC(DATE()),6),dtoc(DATE())+' ')+IIF(SEEK(sys_oper,'A01'),A01.F03,'')       
      ENDIF
	  SELECT INSCH
	  REPLACE INSCH.F14 WITH ALLTRIM(STR(THISFORM.COMBOBOX02.VALUE))
	  REPLACE INSCH.F15 WITH THISFORM.TXTF03.VALUE
	  SELECT D07
	  SET ORDER TO D074   && F01+F02+DTOS(F03)
	  SEEK INSCH.F01 + INSCH.F02 + DTOS(INSCH.F03)
	  IF FOUND()
	     REPLACE D07.F14 WITH ALLTRIM(STR(THISFORM.COMBOBOX02.VALUE))
	     REPLACE D07.F15 WITH THISFORM.TXTF03.VALUE
	  ENDIF
	  SELECT C66_TEMP
	  UNLOCK ALL
	  THISFORM.GRID1.ENABLED=.T.
	  THISFORM.GRID1.SETFOCUS  
	  THISFORM.SHRGROUP.ABANDON_BOTT.CLICK  
 ENDPROC  
 PROCEDURE ORPGROUP.DEL_BOTT.CLICK
      IF MESSAGEBOX('是否確定要刪除此筆資料',4+32+256,'請確認') = 6
	     SELECT C66
	     SET ORDER TO C661 &&F02+DTOS(F03)+F04+ALLTRIM(TRANSFORM(F05,"@R 99,999,999.99"))+F08+F10+F11+F12+F13
	     SEEK C66_TEMP.F02 + DTOS(C66_TEMP.F03) + C66_TEMP.F04 + ALLTRIM(TRANSFORM(C66_TEMP.F05,"@R 99,999,999.99")) + C66_TEMP.F08 + C66_TEMP.F10 + C66_TEMP.F11 + C66_TEMP.F12 + C66_TEMP.F13
		 IF FOUND()
		    SELECT C66
		    DELETE 
		    SELECT C66_TEMP
		    DELETE 
		 ENDIF
      ENDIF
      THISFORM.GRID1.SETFOCUS 
      IF THISFORM.GRID1.ACTIVEROW=0
		  SELECT INSCH
		  REPLACE INSCH.F14 WITH ''
		  REPLACE INSCH.F15 WITH CTOD('')
		  SELECT D07
		  SET ORDER TO D074   && F01+F02+DTOS(F03)
		  SEEK INSCH.F01 + INSCH.F02 + DTOS(INSCH.F03)
		  IF FOUND()
		     REPLACE D07.F14 WITH ''
		     REPLACE D07.F15 WITH CTOD('')
		  ENDIF
		  THISFORM.SETALL('VALUE','','TEXTBOX') 
	      THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
	      THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
	      THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
      ENDIF
      SELECT C66_TEMP
 ENDPROC
 PROCEDURE SHRGROUP.ABANDON_BOTT.CLICK
	  SELECT C66_TEMP 
	  THISFORM.CMND1.ENABLED=.T.
	  THISFORM.ORPGROUP.ENABLED=.T.
      THISFORM.ORPGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
	  THISFORM.SHRGROUP.ENABLED=.F.
      THISFORM.SHRGROUP.VISIBLE=.F.
      THISFORM.TXTF07.ENABLED = .T.
      THISFORM.COMBOBOX02.VISIBLE = .T.
      THISFORM.COMBOBOX08.VISIBLE = .T.
      THISFORM.COMBOBOX10.VISIBLE = .T.
      THISFORM.SETALL('READONLY',.T.,'TEXTBOX')
      THISFORM.SETALL('VISIBLE',.T.,'TEXTBOX') 
	  THISFORM.GRID1.ENABLED=.T.
	  THISFORM.GRID1.SETFOCUS  
      IF THISFORM.GRID1.ACTIVEROW=0
	     THISFORM.SETALL('VALUE','','TEXTBOX') 
	     THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
	     THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
	     THISFORM.PNT_BT.ENABLED=.F. 
      ELSE
	     THISFORM.ORPGROUP.EDIT_BOTT.ENABLED = IIF(A02.F05 = '*',.T.,.F.)
	     THISFORM.ORPGROUP.DEL_BOTT.ENABLED = IIF(A02.F06 = '*',.T.,.F.)
	     THISFORM.PNT_BT.ENABLED = IIF(A02.F07 = '*',.T.,.F.)
      ENDIF
      THISFORM.ORPGROUP.NEW_BOTT.ENABLED = IIF(A02.F04 = '*',.T.,.F.)
 ENDPROC
 PROCEDURE SHRGROUP.FINISH_BOTT.CLICK
   THISFORM.SHRGROUP.ABANDON_BOTT.CLICK
 ENDPROC
 PROCEDURE CMND1.CLICK
     THISFORM.RELEASE
     RETURN 
 ENDPROC  
 PROCEDURE PNT_BT.CLICK  
 	CH_F02 = '' 
 	MAIL_TEXT = ''
    SELECT * FROM C66_TEMP WHERE C66_TEMP.EXP_1 = 1 INTO CURSOR C66_1	
    SELECT C66_1
    GO TOP
    IF _TALLY > 0
       SELECT C66_1.F02,C66_1.F11,C66_1.F18 FROM C66_1 GROUP BY C66_1.F02 ORDER BY C66_1.F02 INTO CURSOR C66_2
       SELECT C66_2
       IF RECCOUNT('C66_2') > 1
          DO WHILE !EOF()
             CH_F02 = CH_F02 + ICASE(C66_2.F02 = '1','提前交期、',C66_2.F02 = '2','延後交期、','取消請購、')
             SELECT C66_2
             SKIP
          ENDDO
          =MESSAGEBOX('此列印作業將會預覽列印共 ' + ALLTRIM(STR(RECCOUNT('C66_2'))) + ' 張入貨異動申請單，異動類別包含：' + LEFT(ALLTRIM(CH_F02),LEN(ALLTRIM(CH_F02)) - 2),0+64,'提示訊息視窗')
       ENDIF
	   SELECT C66_2
	   GO TOP
	   DO WHILE !EOF()
	      SELECT C66_TEMP.* FROM C66_TEMP WHERE C66_TEMP.EXP_1 = 1 AND C66_TEMP.F02 = C66_2.F02 ORDER BY C66_TEMP.F03 INTO CURSOR C66ABC
	      REPORT FORM ALLTRIM(INT_116)+'C66' TO PRINT PROMPT PREVIEW 
	      CLEAR    
	      ******傳送MAIL給該廠商負責之採購人員
	      WAIT WINDOW "傳送郵件,請稍後!" AT 0,150 NOWAIT NOCLEAR  
	      SELECT C66ABC
	      GO TOP
	      TMPCHR=IIF(OS()="Windows 5.01",CHR(13)+CHR(10),'<br/>')
	      DO WHILE !EOF()
	         
	         MAIL_TEXT = MAIL_TEXT + '廠商簡稱：' + IIF(SEEK(C66ABC.F18,'D01'),D01.F04,C66ABC.F18) +TMPCHR + ;
	         			 '採購單號：' + C66ABC.F12 +TMPCHR + ;
	         			 '料品編號：' + C66ABC.F04 + TMPCHR + ;
	         			 '異動類別：' + ICASE(C66ABC.F02 = '1','提前交期',C66ABC.F02 = '2','延後交期','取消請購') + TMPCHR + ;
	         			 '異動數量：' + ALLTRIM(TRANSFORM(C66ABC.F05,'@R 99,999,999.99'))  + TMPCHR + ;
	         			 '希望交期：' + DTCX(C66ABC.F07) + TMPCHR + ;
	         			 '載運方式：' + C66ABC.F088 + TMPCHR+ ;
	         			 '運費對象：' + ICASE(C66ABC.F10 = '1','客戶負擔',C66ABC.F10 = '1','公司負擔','') +TMPCHR + ;
	         			 '備註說明：' + C66ABC.F14 + TMPCHR + ;
	         			 '************************************************' + CHR(13) + CHR(10)
 	         SELECT C66ABC
 	         SKIP
 	      ENDDO
 	      ****傳送MAIL給負責此廠商之採購
 	      IF SEEK(C66_1.F18,'D01') = .T. AND EMPTY(D01.F39) = .F. AND SEEK(D01.F39,'A01') = .T. AND ALLTRIM(A01.F06) = 'Y' AND AT('@',A01.F10) <> 0 AND EMPTY(MAIL_TEXT) = .F.
 	         PRS_NO=A01.F01
 	         IF OS()="Windows 5.01"
                SEND_MAIL(ALLTRIM(INT_MAI),ALLTRIM(A01.F10),ALLTRIM(INT_DNS),'系統通知：C66.入貨異動申請單、客戶簡稱：' + IIF(SEEK(C66_2.F11,'C01'),C01.F05,C66_2.F11) + '、異動類別：' + ICASE(C66_2.F02 = '1','提前交期',C66_2.F02 = '2','延後交期','取消請購'),'TEXT',MAIL_TEXT)
             ELSE
                IF !EMPTY(ALLTRIM(PRS_NO))
                   FILE_NAME=ALLTRIM(INT_DAT)+ALLTRIM(PRS_NO)+'.TXT'                  
                   STRTOFILE('<TR><TD>'+MAIL_TEXT+'<TD>C66.入貨異動申請單、客戶簡稱：'+IIF(SEEK(C66_2.F11,'C01'),C01.F05,C66_2.F11) + '、異動類別：' + ICASE(C66_2.F02 = '1','提前交期',C66_2.F02 = '2','延後交期','取消請購')+'<TD>'+TTOC(DATETIME())+ CHR(13) + CHR(10),FILE_NAME,1) 
                ENDIF   
             ENDIF   
          ELSE
            PRS_NO=''   
          ENDIF
 	      ****傳送MAIL給負責此廠商之採購主管 	      
 	      IF SEEK(C66_1.F18,'D01') = .T. AND EMPTY(D01.F25) = .F. AND SEEK(LEFT(D01.F25,5),'A01') = .T. AND ALLTRIM(A01.F06) = 'Y' AND AT('@',A01.F10) <> 0 AND EMPTY(MAIL_TEXT) = .F.
 	         PRS_CHEF=A01.F01
             IF PRS_CHEF<>PRS_NO
                IF OS()="Windows 5.01"
                   SEND_MAIL(ALLTRIM(INT_MAI),ALLTRIM(A01.F10),ALLTRIM(INT_DNS),'系統通知：C66.入貨異動申請單、客戶簡稱：' + IIF(SEEK(C66_2.F11,'C01'),C01.F05,C66_2.F11) + '、異動類別：' + ICASE(C66_2.F02 = '1','提前交期',C66_2.F02 = '2','延後交期','取消請購'),'TEXT',MAIL_TEXT)
                ELSE
                   IF !EMPTY(ALLTRIM(PRS_CHEF))
                      FILE_NAME=ALLTRIM(INT_DAT)+ALLTRIM(PRS_CHEF)+'.TXT'                  
                      STRTOFILE('<TR><TD>'+MAIL_TEXT+'<TD>C66.入貨異動申請單、客戶簡稱：'+IIF(SEEK(C66_2.F11,'C01'),C01.F05,C66_2.F11) + '、異動類別：' + ICASE(C66_2.F02 = '1','提前交期',C66_2.F02 = '2','延後交期','取消請購')+'<TD>'+TTOC(DATETIME())+ CHR(13) + CHR(10),FILE_NAME,1) 
                   ENDIF     
                ENDIF
             ENDIF
          ELSE
             PRS_CHEF=''                 
          ENDIF
          ****傳送MAIL給負責業助
 	      IF SEEK(C66_1.F11,'C01') = .T. AND EMPTY(C01.F23) = .F. AND ALLTRIM(SYS_OPER) <> ALLTRIM(C01.F23) AND SEEK(C01.F23,'A01') = .T. AND ALLTRIM(A01.F06) = 'Y' AND AT('@',A01.F10) <> 0 AND EMPTY(MAIL_TEXT) = .F.
 	         ASSIS_NO=A01.F01
 	         IF OS()="Windows 5.01"
                SEND_MAIL(ALLTRIM(INT_MAI),ALLTRIM(A01.F10),ALLTRIM(INT_DNS),'系統通知：C66.入貨異動申請單、客戶簡稱：' + IIF(SEEK(C66_2.F11,'C01'),C01.F05,C66_2.F11) + '、異動類別：' + ICASE(C66_2.F02 = '1','提前交期',C66_2.F02 = '2','延後交期','取消請購'),'TEXT',MAIL_TEXT)
             ELSE
                IF !EMPTY(ALLTRIM(ASSIS_NO))
                   FILE_NAME=ALLTRIM(INT_DAT)+ALLTRIM(ASSIS_NO)+'.TXT'                  
                   STRTOFILE('<TR><TD>'+MAIL_TEXT+'<TD>C66.入貨異動申請單、客戶簡稱：'+IIF(SEEK(C66_2.F11,'C01'),C01.F05,C66_2.F11) + '、異動類別：' + ICASE(C66_2.F02 = '1','提前交期',C66_2.F02 = '2','延後交期','取消請購')+'<TD>'+TTOC(DATETIME())+ CHR(13) + CHR(10),FILE_NAME,1) 
                ENDIF   
             ENDIF
          ELSE
             ASSIS_NO=''   
          ENDIF
          ****傳送MAIL給負責業務B
 	      IF SEEK(C66_1.F11,'C01') = .T. AND EMPTY(C01.F33) = .F. AND ALLTRIM(SYS_OPER) <> ALLTRIM(C01.F33) AND SEEK(C01.F33,'A01') = .T. AND ALLTRIM(A01.F06) = 'Y' AND AT('@',A01.F10) <> 0 AND EMPTY(MAIL_TEXT) = .F.
             SALES_B_NO=A01.F01
             IF SALES_B_NO<>ASSIS_NO
                IF OS()="Windows 5.01"
                   SEND_MAIL(ALLTRIM(INT_MAI),ALLTRIM(A01.F10),ALLTRIM(INT_DNS),'系統通知：C66.入貨異動申請單、客戶簡稱：' + IIF(SEEK(C66_2.F11,'C01'),C01.F05,C66_2.F11) + '、異動類別：' + ICASE(C66_2.F02 = '1','提前交期',C66_2.F02 = '2','延後交期','取消請購'),'TEXT',MAIL_TEXT)
                ELSE
                   IF !EMPTY(ALLTRIM(SALES_B_NO))
                      FILE_NAME=ALLTRIM(INT_DAT)+ALLTRIM(SALES_B_NO)+'.TXT'                  
                      STRTOFILE('<TR><TD>'+MAIL_TEXT+'<TD>C66.入貨異動申請單、客戶簡稱：'+IIF(SEEK(C66_2.F11,'C01'),C01.F05,C66_2.F11) + '、異動類別：' + ICASE(C66_2.F02 = '1','提前交期',C66_2.F02 = '2','延後交期','取消請購')+'<TD>'+TTOC(DATETIME())+ CHR(13) + CHR(10),FILE_NAME,1) 
                   ENDIF   
                ENDIF
             ENDIF   
          ELSE
             SALES_B_NO=''   
          ENDIF
          ****傳送MAIL給負責業務A
 	      IF SEEK(C66_1.F11,'C01') = .T. AND EMPTY(C01.F18) = .F. AND ALLTRIM(SYS_OPER) <> ALLTRIM(C01.F18) AND SEEK(C01.F18,'A01') = .T. AND ALLTRIM(A01.F06) = 'Y' AND AT('@',A01.F10) <> 0 AND EMPTY(MAIL_TEXT) = .F.
             SALES_A_NO=A01.F01
             IF SALES_A_NO<>SALES_B_NO
                IF OS()="Windows 5.01"
                   SEND_MAIL(ALLTRIM(INT_MAI),ALLTRIM(A01.F10),ALLTRIM(INT_DNS),'系統通知：C66.入貨異動申請單、客戶簡稱：' + IIF(SEEK(C66_2.F11,'C01'),C01.F05,C66_2.F11) + '、異動類別：' + ICASE(C66_2.F02 = '1','提前交期',C66_2.F02 = '2','延後交期','取消請購'),'TEXT',MAIL_TEXT)
                ELSE
                   IF !EMPTY(ALLTRIM(SALES_A_NO))
                      FILE_NAME=ALLTRIM(INT_DAT)+ALLTRIM(SALES_A_NO)+'.TXT'                  
                      STRTOFILE('<TR><TD>'+MAIL_TEXT+'<TD>C66.入貨異動申請單、客戶簡稱：'+IIF(SEEK(C66_2.F11,'C01'),C01.F05,C66_2.F11) + '、異動類別：' + ICASE(C66_2.F02 = '1','提前交期',C66_2.F02 = '2','延後交期','取消請購')+'<TD>'+TTOC(DATETIME())+ CHR(13) + CHR(10),FILE_NAME,1) 
                   ENDIF   
                ENDIF
             ENDIF
          ELSE
             SALES_A_NO=''      
          ENDIF                    
          WAIT CLEAR
	      SELECT C66_2
	      SKIP 
	   ENDDO
	   SELECT C66_2
	   USE
	   SELECT C66_TEMP
	   GO TOP
	   DO WHILE !EOF()
	      IF C66_TEMP.EXP_1 = 1
	         REPLACE C66_TEMP.EXP_1 WITH 0
	         REPLACE C66_TEMP.F01 WITH 1
	         REPLACE C66_TEMP.F03 WITH DATE()
	     	 SELECT C66
	     	 SET ORDER TO C661 &&F02+DTOS(F03)+F04+ALLTRIM(TRANSFORM(F05,"@R 99,999,999.99"))+F08+F10+F11+F12+F13
	     	 SEEK C66_TEMP.F02 + DTOS(C66_TEMP.F03) + C66_TEMP.F04 + ALLTRIM(TRANSFORM(C66_TEMP.F05,"@R 99,999,999.99")) + C66_TEMP.F08 + C66_TEMP.F10 + C66_TEMP.F11 + C66_TEMP.F12 + C66_TEMP.F13
		 	 IF FOUND()
		    	REPLACE C66.F01 WITH 1
		    	REPLACE C66.F03 WITH DATE()
		    	REPLACE C66.F15 WITH ''
		    	REPLACE C66.F16 WITH 0
		    	REPLACE C66.F98 WITH ''
		 	 ENDIF 
	      ENDIF
	      SELECT C66_TEMP
	      SKIP   
	   ENDDO
    ELSE
      =MESSAGEBOX('請選擇欲列印之資料!',0+64,'提示訊息視窗')
      THISFORM.GRID1.SETFOCUS 
      RETURN
    ENDIF
    SELECT C66_1
    USE
    SELECT C66_TEMP                                                                                    
    THISFORM.GRID1.SETFOCUS 
 ENDPROC 
ENDDEFINE   
**********
  DEFINE CLASS CheckBox1 AS CheckBox
      PROCEDURE CLICK
        IF THIS.VALUE=1
           REPLACE C66_TEMP.EXP_1 WITH 1
        ELSE
           REPLACE C66_TEMP.EXP_1 WITH 0      
        ENDIF
        THISFORM.GRID1.SETFOCUS     
   ENDPROC  
  ENDDEFINE 
************************************************特殊輸入欄位的設定----料號
DEFINE CLASS TXTF02 AS TEXTBOX
  READONLY=.T.
  MAXLENGTH=43
  FONTSIZE=INT_015*9
  PROCEDURE INTERACTIVECHANGE
    IF AT('?',ALLTRIM(THIS.VALUE))<>0
       IF AT('?',ALLTRIM(THIS.VALUE))>1             
          SELECT F01,F02 FROM B01 INTO CURSOR MTR ORDER BY F01 WHERE !EMPTY(F98) AND LEFT(F01,AT('?',THIS.VALUE)-1)=LEFT(THIS.VALUE,AT('?',THIS.VALUE)-1)    
       ELSE
          SELECT F01,F02 FROM B01 INTO CURSOR MTR ORDER BY F01 WHERE !EMPTY(F98)   
       ENDIF        
       IF _TALLY>0
          MTR_SEEK=createobject("MTR_SEEK")  
          MTR_SEEK.SHOW    
          THIS.VALUE=FLG
          THIS.REFRESH
          FLG='0'     
       ENDIF          
    ENDIF  
       THISFORM.LBLF021.CAPTION=IIF(SEEK(THIS.VALUE,'B01'),B01.F02,'')     
  ENDPROC
ENDDEFINE
***************************************************特殊輸入欄位設定-----------客戶
DEFINE CLASS TXTF06 AS TEXTBOX
  READONLY=.T.
  MAXLENGTH=5
  FONTSIZE=INT_015*9
  PROCEDURE INTERACTIVECHANGE
    IF AT('?',ALLTRIM(THIS.VALUE))<>0 
       IF AT('?',ALLTRIM(THIS.VALUE))>1             
          SELECT F02,F01,F04 FROM C01 INTO CURSOR VDR ORDER BY F02 WHERE LEFT(F02,AT('?',THIS.VALUE)-1)=LEFT(THIS.VALUE,AT('?',THIS.VALUE)-1) 
       ELSE
          SELECT F02,F01,F04 FROM C01 INTO CURSOR VDR ORDER BY F02 
       ENDIF
       IF _TALLY>0          
          VDR_SEEK=createobject("VDR_SEEK")  
          VDR_SEEK.SHOW    
          THIS.VALUE=FLG
          THIS.REFRESH
          FLG='0'        
       ENDIF   
    ELSE
       IF LEN(ALLTRIM(THIS.VALUE))=4
          SELECT F02,F01,F04 FROM C01 INTO CURSOR VDR ORDER BY F02 WHERE F02=ALLTRIM(THIS.VALUE)
          DO CASE
             CASE _TALLY=1
                  THIS.VALUE=VDR.F01
                  THIS.REFRESH
             CASE _TALLY>1
                  VDR_SEEK=createobject("VDR_SEEK")  
                  VDR_SEEK.SHOW    
                  THIS.VALUE=FLG
                  THIS.REFRESH
                  FLG='0'        
          ENDCASE      
       ENDIF    
    ENDIF      
       THISFORM.LBLF061.CAPTION=IIF(SEEK(THIS.VALUE,'C01'),C01.F04,'')  
  ENDPROC
ENDDEFINE   