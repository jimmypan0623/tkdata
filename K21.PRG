close all
clear 
FLG='0'
FCH=''
AREA1='K36'
CHK=''
IF !USED('A02')
   SELE 0
   USE A02 INDE A02
ELSE 
   SELE A02
ENDIF
SET ORDER TO A021      
SEEK sys_oper+'K21'   
IF !USED('A01')
   SELE 0
   USE A01 INDE A01
ELSE 
   SELE A01
ENDIF
SET ORDER TO A01
IF !USED('K36')
   SELE 0
   USE K36 INDE K36
ELSE
   SELE K36
ENDIF
SET ORDER TO 1  
GO BOTT
K21form=createobject("tkK21")
K21form.show  
define class tkK21 as form
  caption='K21.電子計算機發票號碼字軌設定'
*!*	  autocenter=.t.
  controlbox=.F.
  BORDERSTYLE=3  
  MAXBUTTON=.F.
  MINBUTTON=.F.
  MOVABLE=.F.
  CLOSABLE=.F.
  controlcount=57
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*550
  showtips=.t.
  showwindow=1
  WIDTH=INT_015*789
  windowtype=1
  NAME='TKE00'
  add object shape1 as shape1 with;
      autocenter=.t.
  add object shape2 as shape2 with;
      autocenter=.t.
  add object shape3 as shape3 with;
      autocenter=.t.
  ADD OBJECT LBL_REC AS LBL_REC WITH;
      AUTOCENTER =.T.
  ADD OBJECT REC_COUNT AS REC_COUNT  with;
      caption=str(reccount())      
  ADD OBJECT LBLF01 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*27,;
      WIDTH=INT_015*50,;
      CAPTION='民國年度(四碼)'
  ADD OBJECT LBLF02 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*52,;
      WIDTH=INT_015*50,;
      CAPTION='起始編號'      
  ADD OBJECT LBLF03 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*77,;
      WIDTH=INT_015*50,;
      CAPTION='截止編號'      
  ADD OBJECT LBLF04 AS LABEL WITH;      
      LEFT=INT_015*244,;
      TOP=INT_015*102,;
      WIDTH=INT_015*80,;
      CAPTION='01-02月字軌'
  ADD OBJECT LBLF05 AS LABEL WITH;      
      LEFT=INT_015*244,;
      TOP=INT_015*127,;
      WIDTH=INT_015*80,;
      CAPTION='03-04月字軌'      
   ADD OBJECT LBLF06 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*152,;
      WIDTH=INT_015*80,;
      CAPTION='05-06月字軌'
   ADD OBJECT LBLF07 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*177,;
      WIDTH=INT_015*80,;
      CAPTION='07-08月字軌'                           
   ADD OBJECT LBLF08 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*202,;
      WIDTH=INT_015*80,;
      CAPTION='09-10月字軌'                           
   ADD OBJECT LBLF09 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*227,;
      WIDTH=INT_015*80,;
      CAPTION='11-12月字軌'                   
   ADD OBJECT LBLF10 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*252,;
      WIDTH=INT_015*50,;
      CAPTION='安全資料'                 
   ADD OBJECT LBLF101 AS LABEL WITH;
      LEFT=INT_015*295,;
      TOP=INT_015*252,;
      AUTOSIZE=.T.,;
      CAPTION=''               
  ADD OBJECT TXTF01 AS TEXTBOX WITH;      
      LEFT=INT_015*295,;
      TOP=INT_015*23,;
      WIDTH=INT_015*45,;
      MAXLENGTH=4,;
      NAME='TXTF01'  
  ADD OBJECT TXTF02 AS TEXTBOX WITH;
      LEFT=INT_015*295,;
      TOP=INT_015*48,;
      WIDTH=INT_015*80,;
      HEIGHT=INT_015*25,;
      MAXLENGTH=8,;    
      NAME='TXTF02'                      
  ADD OBJECT TXTF03 AS TEXTBOX WITH;
      AUTOSIZE=.T.,;
      LEFT=INT_015*295,;
      TOP=INT_015*73,;
      WIDTH=INT_015*80,;
      MAXLENGTH=8,;
      NAME='TXTF03'                                
  ADD OBJECT TXTF04 AS TEXTBOX WITH;
      AUTOSIZE=.T.,;
      LEFT=INT_015*325,;
      TOP=INT_015*98,;
      WIDTH=INT_015*30,;
      MAXLENGTH=2,;
      NAME='TXTF04'                 
  ADD OBJECT TXTF05 AS TEXTBOX WITH;
      AUTOSIZE=.T.,;
      LEFT=INT_015*325,;
      TOP=INT_015*123,;
      WIDTH=INT_015*30,;
      MAXLENGTH=2,;
      NAME='TXTF05'                       
  ADD OBJECT TXTF06 AS TEXTBOX WITH;
      LEFT=INT_015*325,;
      TOP=INT_015*148,;
      WIDTH=INT_015*30,;
      HEIGHT=INT_015*25,;
      MAXLENGTH=2,;
      NAME='TXTF06'                      
  ADD OBJECT TXTF07 AS TEXTBOX WITH;
      LEFT=INT_015*325,;
      TOP=INT_015*173,;
      WIDTH=INT_015*30,;
      HEIGHT=INT_015*25,;
      MAXLENGTH=2,;
      NAME='TXTF07'                         
  ADD OBJECT TXTF08 AS TEXTBOX WITH;
      LEFT=INT_015*325,;
      TOP=INT_015*198,;
      WIDTH=INT_015*30,;
      HEIGHT=INT_015*25,;
      MAXLENGTH=2,;
      NAME='TXTF08'                         
  ADD OBJECT TXTF09 AS TEXTBOX WITH;
      LEFT=INT_015*325,;
      TOP=INT_015*223,;
      WIDTH=INT_015*30,;
      HEIGHT=INT_015*25,;
      MAXLENGTH=2,;
      NAME='TXTF09'                                                    
  ADD OBJECT KEY_LIST AS KEY_LIST WITH;
      AUTOCENTER=.T.
  ADD OBJECT GRID1 AS GRID1 WITH;
      columncount=3,;            
      RECORDSOURCE='K36',;      
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;      
      COLUMN3.NAME='COLUMN3'
  ADD OBJECT CMDGROUP AS CMDGROUP WITH;
      AUTOSIZE=.T.              
  ADD OBJECT ORPGROUP AS ORPGROUP WITH;    
      AUTOSIZE=.T.
  ADD OBJECT SHRGROUP AS SHRGROUP WITH;
      TOP=INT_015*455,;
      LEFT=INT_015*558          
  PROC INIT
       THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.)   &&判斷有無新增的權限
       THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.) AND K36.F11<'11' &&判斷有無修改的權限
       THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.) AND EMPTY(K36.F11)  &&判斷有無刪除的權限
       THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
       THISFORM.ORPGROUP.PNT_BOTT.VISIBLE=.F.
       THISFORM.SHRGROUP.VISIBLE=.F.
       THISFORM.SHRGROUP.ENABLED=.F.
       thisform.setall('height',INT_015*25,'textbox')
       thisform.setall('FONTSIZE',INT_015*9,'label')
       thisform.setall('FONTSIZE',INT_015*9,'textbox')
       thisform.setall('height',INT_015*17,'label')       
       THISFORM.SETALL('READONLY',.T.,'TEXTBOX')
       thisform.setall('FONTSIZE',INT_015*9,'COLUMN')
       thisform.setall('FONTSIZE',INT_015*9,'HEADER')       
       THISFORM.LBLF04.BACKCOLOR=IIF(K36.F11>='01',RGB(255,255,0),RGB(0,255,0))
       THISFORM.LBLF05.BACKCOLOR=IIF(K36.F11>='03',RGB(255,255,0),RGB(0,255,0))
       THISFORM.LBLF06.BACKCOLOR=IIF(K36.F11>='05',RGB(255,255,0),RGB(0,255,0))
       THISFORM.LBLF07.BACKCOLOR=IIF(K36.F11>='07',RGB(255,255,0),RGB(0,255,0))
       THISFORM.LBLF08.BACKCOLOR=IIF(K36.F11>='09',RGB(255,255,0),RGB(0,255,0))
       THISFORM.LBLF09.BACKCOLOR=IIF(K36.F11>='11',RGB(255,255,0),RGB(0,255,0))
       THISFORM.GRID1.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)
       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*49
       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*73
       THISFORM.GRID1.COLUMN3.WIDTH=INT_015*73
       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='民國年度'
	   THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='起始號碼'
	   THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='截止號碼'
	   THISFORM.GRID1.COLUMN1.CONTROLSOURCE='K36.F01'
	   THISFORM.GRID1.COLUMN2.CONTROLSOURCE='K36.F02'
	   THISFORM.GRID1.COLUMN3.CONTROLSOURCE='K36.F03'
       THISFORM.GRID1.READONLY=.T.       
       THISFORM.GRID1.SETFOCUS
       JK='民國年度'
  ENDPROC     

  PROC KEY_LIST.INIT 
       with this 
           .additem('依民國年度排列')
       endwith      
  ENDPROC
  PROC GRID1.AFTERROWCOLCHANGE
       LPARAMETERS nColIndex
       THISFORM.LBLF04.BACKCOLOR=IIF(K36.F11>='01',RGB(255,255,0),RGB(0,255,0))
       THISFORM.LBLF05.BACKCOLOR=IIF(K36.F11>='03',RGB(255,255,0),RGB(0,255,0))
       THISFORM.LBLF06.BACKCOLOR=IIF(K36.F11>='05',RGB(255,255,0),RGB(0,255,0))
       THISFORM.LBLF07.BACKCOLOR=IIF(K36.F11>='07',RGB(255,255,0),RGB(0,255,0))
       THISFORM.LBLF08.BACKCOLOR=IIF(K36.F11>='09',RGB(255,255,0),RGB(0,255,0))
       THISFORM.LBLF09.BACKCOLOR=IIF(K36.F11>='11',RGB(255,255,0),RGB(0,255,0))
       THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.) AND K36.F11<'11' &&判斷有無修改的權限
       THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.) AND EMPTY(K36.F11)
       THISFORM.TXTF01.VALUE=K36.F01
       THISFORM.TXTF02.VALUE=K36.F02
       THISFORM.TXTF03.VALUE=K36.F03
       THISFORM.TXTF04.VALUE=K36.F04
       THISFORM.TXTF05.VALUE=K36.F05
       THISFORM.TXTF06.VALUE=K36.F06
       THISFORM.TXTF07.VALUE=K36.F07
       THISFORM.TXTF08.VALUE=K36.F08
       THISFORM.TXTF09.VALUE=K36.F09
       THISFORM.LBLF101.CAPTION=K36.F10    
       FCH=THISFORM.ACTIVECONTROL.NAME
       CHK=''
       thisform.refresh
  ENDPROC       
  PROCEDURE ORPGROUP.NEW_BOTT.CLICK    
       THISFORM.SETALL('READONLY',.F.,'TEXTBOX')  
       THISFORM.TXTF01.VALUE=''         
       THISFORM.TXTF02.VALUE='' 
       THISFORM.TXTF03.VALUE='' 
       THISFORM.TXTF04.VALUE='' 
       THISFORM.TXTF05.VALUE='' 
       THISFORM.TXTF06.VALUE='' 
       THISFORM.TXTF07.VALUE='' 
       THISFORM.TXTF08.VALUE='' 
       THISFORM.TXTF09.VALUE='' 
       THISFORM.TXTF01.SETFOCUS()
       THISFORM.GRID1.ENABLED=.F.
       FLG='1'
  ENDPROC  
  PROCEDURE ORPGROUP.EDIT_BOTT.CLICK
     THISFORM.TXTF01.READONLY=.T.
     THISFORM.TXTF02.READONLY=!EMPTY(ALLTRIM(K36.F11))
     THISFORM.TXTF03.READONLY=!EMPTY(ALLTRIM(K36.F11))
     THISFORM.TXTF04.READONLY=(K36.F11>='01')
     THISFORM.TXTF05.READONLY=(K36.F11>='03')
     THISFORM.TXTF06.READONLY=(K36.F11>='05')
     THISFORM.TXTF07.READONLY=(K36.F11>='07')
     THISFORM.TXTF08.READONLY=(K36.F11>='09')
     THISFORM.TXTF09.READONLY=(K36.F11>='11')
     THISFORM.GRID1.ENABLED=.F.
     THISFORM.TXTF02.SETFOCUS

     LOCK()
     IF !RLOCK()
        DO file_impact
        return
     endif
  endproc 
  PROCEDURE ORPGROUP.DEL_BOTT.CLICK
     if messagebox('是否確定要刪除此筆資料',4+32+256,'請確認') = 6	      
        SELE K36
        LOCK()
        IF RLOCK()        
           SELE K36
           DELE
           unlock
           SKIP -1
           IF BOF()
              GO TOP
           ENDIF   
           THISFORM.GRID1.SETFOCUS
           IF THISFORM.GRID1.ACTIVEROW=0
              THISFORM.SETALL('VALUE','','TEXTBOX')
              THISFORM.CMDGROUP.ENABLED=.F.
              THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
              THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
              THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
              THISFORM.LBLF101.CAPTION=''
    
           ELSE
              THISFORM.CMDGROUP.ENABLED=.T.
              THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  &&判斷有無修改的權限
              THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.) AND EMPTY(K36.F11)   &&判斷有無刪除的權限
              THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限              
           ENDIF
        ELSE
          DO file_impact    
        ENDIF
     ENDIF        
  ENDPROC
  PROCEDURE SHRGROUP.SHURE1_BOTT.CLICK
    if empty(ALLTRIM(THISFORM.TXTf01.VALUE))
       =messagebox('民國年度不得空白!',0+64,'提示視窗')
       thisform.txtf01.setfocus
       return
    endif   
    IF VAL(THISFORM.TXTF01.VALUE)<=0
        =messagebox('民國年度輸入錯誤',0+64,'提示視窗')
       thisform.txtf01.setfocus
       return
    ENDIF
    IF SEEK(THISFORM.TXTF01.VALUE,'K36')=.T.
       =MESSAGEBOX('此年度之號碼與字軌已建立!',0+64,'請注意')
       THISFORM.TXTF01.VALUE=''
       THISFORM.TXTF01.SETFOCUS  
       RETURN
    ENDIF        
    IF EMPTY(ALLTRIM(THISFORM.TXTF02.VALUE))
        =MESSAGEBOX('起始編號不得空白',0+48,'提示訊息視窗')
        THISFORM.TXTF02.SETFOCUS
        RETURN
    ENDIF        
        IF EMPTY(ALLTRIM(THISFORM.TXTF03.VALUE))
        =MESSAGEBOX('截止編號不得空白',0+48,'提示訊息視窗')
        THISFORM.TXTF03.SETFOCUS
        RETURN
    ENDIF        
    IF (VAL(THISFORM.TXTF03.VALUE)-VAL(THISFORM.TXTF02.VALUE)+1)%50<>0
        =MESSAGEBOX('起訖號碼有誤!',0+48,'提示訊息視窗')
        THISFORM.TXTF02.SETFOCUS
        RETURN
    ENDIF
    IF THISFORM.TXTF03.VALUE<THISFORM.TXTF02.VALUE
       =MESSAGEBOX('截止號碼小於起始號碼',0+48,'提示訊息視窗')
       THISFORM.TXTF02.SETFOCUS
       RETURN
     ENDIF             
     IF !(RIGHT(THISFORM.TXTF02.VALUE,2)='00' OR RIGHT(THISFORM.TXTF02.VALUE,2)='50')
        =MESSAGEBOX('起始號碼有誤',0+48,'提示訊息視窗')
        THISFORM.TXTF03.SETFOCUS
        RETURN
     ENDIF                     
     IF !(RIGHT(THISFORM.TXTF03.VALUE,2)='49' OR RIGHT(THISFORM.TXTF03.VALUE,2)='99')
        =MESSAGEBOX('截止號碼有誤',0+48,'提示訊息視窗')
       THISFORM.TXTF03.SETFOCUS
       RETURN
     ENDIF
     IF ASC(LEFT(THISFORM.TXTF04.VALUE,1))<65 OR ASC(LEFT(THISFORM.TXTF04.VALUE,1))>90
        =MESSAGEBOX('字軌錯誤!',0+48,'提示訊息視窗')
        THISFORM.TXTF04.SETFOCUS
        RETURN
     ENDIF
     IF ASC(RIGHT(THISFORM.TXTF04.VALUE,1))<65 OR ASC(RIGHT(THISFORM.TXTF04.VALUE,1))>90
        =MESSAGEBOX('字軌錯誤!',0+48,'提示訊息視窗')
        THISFORM.TXTF04.SETFOCUS
        RETURN
     ENDIF
     IF ASC(LEFT(THISFORM.TXTF05.VALUE,1))<65 OR ASC(LEFT(THISFORM.TXTF05.VALUE,1))>90
        =MESSAGEBOX('字軌錯誤!',0+48,'提示訊息視窗')
        THISFORM.TXTF05.SETFOCUS
        RETURN
     ENDIF
     IF ASC(RIGHT(THISFORM.TXTF05.VALUE,1))<65 OR ASC(RIGHT(THISFORM.TXTF05.VALUE,1))>90
        =MESSAGEBOX('字軌錯誤!',0+48,'提示訊息視窗')
        THISFORM.TXTF05.SETFOCUS
        RETURN
     ENDIF
     IF ASC(LEFT(THISFORM.TXTF06.VALUE,1))<65 OR ASC(LEFT(THISFORM.TXTF06.VALUE,1))>90
        =MESSAGEBOX('字軌錯誤!',0+48,'提示訊息視窗')
        THISFORM.TXTF06.SETFOCUS
        RETURN
     ENDIF
     IF ASC(RIGHT(THISFORM.TXTF06.VALUE,1))<65 OR ASC(RIGHT(THISFORM.TXTF06.VALUE,1))>90
        =MESSAGEBOX('字軌錯誤!',0+48,'提示訊息視窗')
        THISFORM.TXTF06.SETFOCUS
        RETURN
     ENDIF
     IF ASC(LEFT(THISFORM.TXTF07.VALUE,1))<65 OR ASC(LEFT(THISFORM.TXTF07.VALUE,1))>90
        =MESSAGEBOX('字軌錯誤!',0+48,'提示訊息視窗')
        THISFORM.TXTF07.SETFOCUS
        RETURN
     ENDIF
     IF ASC(RIGHT(THISFORM.TXTF07.VALUE,1))<65 OR ASC(RIGHT(THISFORM.TXTF07.VALUE,1))>90
        =MESSAGEBOX('字軌錯誤!',0+48,'提示訊息視窗')
        THISFORM.TXTF07.SETFOCUS
        RETURN
     ENDIF
     IF ASC(LEFT(THISFORM.TXTF08.VALUE,1))<65 OR ASC(LEFT(THISFORM.TXTF08.VALUE,1))>90
        =MESSAGEBOX('字軌錯誤!',0+48,'提示訊息視窗')
        THISFORM.TXTF08.SETFOCUS
        RETURN
     ENDIF
     IF ASC(RIGHT(THISFORM.TXTF08.VALUE,1))<65 OR ASC(RIGHT(THISFORM.TXTF08.VALUE,1))>90
        =MESSAGEBOX('字軌錯誤!',0+48,'提示訊息視窗')
        THISFORM.TXTF08.SETFOCUS
        RETURN
     ENDIF
     IF ASC(LEFT(THISFORM.TXTF09.VALUE,1))<65 OR ASC(LEFT(THISFORM.TXTF09.VALUE,1))>90
        =MESSAGEBOX('字軌錯誤!',0+48,'提示訊息視窗')
        THISFORM.TXTF04.SETFOCUS
        RETURN
     ENDIF
     IF ASC(RIGHT(THISFORM.TXTF09.VALUE,1))<65 OR ASC(RIGHT(THISFORM.TXTF09.VALUE,1))>90
        =MESSAGEBOX('字軌錯誤!',0+48,'提示訊息視窗')
        THISFORM.TXTF09.SETFOCUS
        RETURN
     ENDIF

     
    SELE K36    
    APPEND BLANK
    LOCK()
    IF RLOCK()
       REPLACE F01 WITH PADL(ALLTRIM(THISFORM.TXTF01.VALUE),4,'0')
       REPLACE F02 WITH THISFORM.TXTF02.VALUE
       REPLACE F03 WITH THISFORM.TXTF03.VALUE
       REPLACE F04 WITH THISFORM.TXTF04.VALUE       
       REPLACE F05 WITH THISFORM.TXTF05.VALUE
       REPLACE F06 WITH THISFORM.TXTF06.VALUE
       REPLACE F07 WITH THISFORM.TXTF07.VALUE
       REPLACE F08 WITH THISFORM.TXTF08.VALUE
       REPLACE F09 WITH THISFORM.TXTF09.VALUE
       REPLACE F10 WITH IIF(INT_012=1,PADL(ALLTRIM(STR(YEAR(DATE())-1911)),3,' ')+RIGHT(DTOC(DATE()),6),dtoc(DATE())+' ')+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
    ENDIF
    UNLOCK
    THISFORM.REC_COUNT.CAPTION=STR(RECCOUNT())
    THISFORM.GRID1.ENABLED=.T.
    THISFORM.REFRESH
    THISFORM.GRID1.SETFOCUS    
    THISFORM.ORPGROUP.NEW_BOTT.CLICK            
  ENDPROC
  PROCEDURE SHRGROUP.SHURE2_BOTT.CLICK    
    IF EMPTY(ALLTRIM(THISFORM.TXTF02.VALUE))
        =MESSAGEBOX('起始編號不得空白',0+48,'提示訊息視窗')
        THISFORM.TXTF02.SETFOCUS
        RETURN
    ENDIF        
        IF EMPTY(ALLTRIM(THISFORM.TXTF03.VALUE))
        =MESSAGEBOX('截止編號不得空白',0+48,'提示訊息視窗')
        THISFORM.TXTF03.SETFOCUS
        RETURN
    ENDIF        
    IF (VAL(THISFORM.TXTF03.VALUE)-VAL(THISFORM.TXTF02.VALUE)+1)%50<>0
        =MESSAGEBOX('起訖號碼有誤!',0+48,'提示訊息視窗')
        THISFORM.TXTF02.SETFOCUS
        RETURN
    ENDIF
    IF THISFORM.TXTF03.VALUE<THISFORM.TXTF02.VALUE
       =MESSAGEBOX('截止號碼小於起始號碼',0+48,'提示訊息視窗')
       THISFORM.TXTF02.SETFOCUS
       RETURN
     ENDIF             
     IF !(RIGHT(THISFORM.TXTF02.VALUE,2)='00' OR RIGHT(THISFORM.TXTF02.VALUE,2)='50')
        =MESSAGEBOX('起始號碼有誤',0+48,'提示訊息視窗')
        THISFORM.TXTF03.SETFOCUS
        RETURN
     ENDIF                     
     IF !(RIGHT(THISFORM.TXTF03.VALUE,2)='49' OR RIGHT(THISFORM.TXTF03.VALUE,2)='99')
        =MESSAGEBOX('截止號碼有誤',0+48,'提示訊息視窗')
       THISFORM.TXTF03.SETFOCUS
       RETURN
     ENDIF
     IF ASC(LEFT(THISFORM.TXTF04.VALUE,1))<65 OR ASC(LEFT(THISFORM.TXTF04.VALUE,1))>90
        =MESSAGEBOX('字軌錯誤!',0+48,'提示訊息視窗')
        THISFORM.TXTF04.SETFOCUS
        RETURN
     ENDIF
     IF ASC(RIGHT(THISFORM.TXTF04.VALUE,1))<65 OR ASC(RIGHT(THISFORM.TXTF04.VALUE,1))>90
        =MESSAGEBOX('字軌錯誤!',0+48,'提示訊息視窗')
        THISFORM.TXTF04.SETFOCUS
        RETURN
     ENDIF
     IF ASC(LEFT(THISFORM.TXTF05.VALUE,1))<65 OR ASC(LEFT(THISFORM.TXTF05.VALUE,1))>90
        =MESSAGEBOX('字軌錯誤!',0+48,'提示訊息視窗')
        THISFORM.TXTF05.SETFOCUS
        RETURN
     ENDIF
     IF ASC(RIGHT(THISFORM.TXTF05.VALUE,1))<65 OR ASC(RIGHT(THISFORM.TXTF05.VALUE,1))>90
        =MESSAGEBOX('字軌錯誤!',0+48,'提示訊息視窗')
        THISFORM.TXTF05.SETFOCUS
        RETURN
     ENDIF
     IF ASC(LEFT(THISFORM.TXTF06.VALUE,1))<65 OR ASC(LEFT(THISFORM.TXTF06.VALUE,1))>90
        =MESSAGEBOX('字軌錯誤!',0+48,'提示訊息視窗')
        THISFORM.TXTF06.SETFOCUS
        RETURN
     ENDIF
     IF ASC(RIGHT(THISFORM.TXTF06.VALUE,1))<65 OR ASC(RIGHT(THISFORM.TXTF06.VALUE,1))>90
        =MESSAGEBOX('字軌錯誤!',0+48,'提示訊息視窗')
        THISFORM.TXTF06.SETFOCUS
        RETURN
     ENDIF
     IF ASC(LEFT(THISFORM.TXTF07.VALUE,1))<65 OR ASC(LEFT(THISFORM.TXTF07.VALUE,1))>90
        =MESSAGEBOX('字軌錯誤!',0+48,'提示訊息視窗')
        THISFORM.TXTF07.SETFOCUS
        RETURN
     ENDIF
     IF ASC(RIGHT(THISFORM.TXTF07.VALUE,1))<65 OR ASC(RIGHT(THISFORM.TXTF07.VALUE,1))>90
        =MESSAGEBOX('字軌錯誤!',0+48,'提示訊息視窗')
        THISFORM.TXTF07.SETFOCUS
        RETURN
     ENDIF
     IF ASC(LEFT(THISFORM.TXTF08.VALUE,1))<65 OR ASC(LEFT(THISFORM.TXTF08.VALUE,1))>90
        =MESSAGEBOX('字軌錯誤!',0+48,'提示訊息視窗')
        THISFORM.TXTF08.SETFOCUS
        RETURN
     ENDIF
     IF ASC(RIGHT(THISFORM.TXTF08.VALUE,1))<65 OR ASC(RIGHT(THISFORM.TXTF08.VALUE,1))>90
        =MESSAGEBOX('字軌錯誤!',0+48,'提示訊息視窗')
        THISFORM.TXTF08.SETFOCUS
        RETURN
     ENDIF
     IF ASC(LEFT(THISFORM.TXTF09.VALUE,1))<65 OR ASC(LEFT(THISFORM.TXTF09.VALUE,1))>90
        =MESSAGEBOX('字軌錯誤!',0+48,'提示訊息視窗')
        THISFORM.TXTF04.SETFOCUS
        RETURN
     ENDIF
     IF ASC(RIGHT(THISFORM.TXTF09.VALUE,1))<65 OR ASC(RIGHT(THISFORM.TXTF09.VALUE,1))>90
        =MESSAGEBOX('字軌錯誤!',0+48,'提示訊息視窗')
        THISFORM.TXTF09.SETFOCUS
        RETURN
     ENDIF

    SELE K36
    IF RLOCK()
       REPLACE F02 WITH THISFORM.TXTF02.VALUE
       REPLACE F03 WITH THISFORM.TXTF03.VALUE
       REPLACE F04 WITH THISFORM.TXTF04.VALUE    
       REPLACE F05 WITH THISFORM.TXTF05.VALUE
       REPLACE F06 WITH THISFORM.TXTF06.VALUE
       REPLACE F07 WITH THISFORM.TXTF07.VALUE
       REPLACE F08 WITH THISFORM.TXTF08.VALUE
       REPLACE F09 WITH THISFORM.TXTF09.VALUE
       REPLACE F10 WITH IIF(INT_012=1,PADL(ALLTRIM(STR(YEAR(DATE())-1911)),3,' ')+RIGHT(DTOC(DATE()),6),dtoc(DATE())+' ')+IIF(SEEK(sys_oper,'A01'),A01.F03,'')          
    ELSE
      DO file_impact
      return   
    ENDIF   
    THISFORM.SHRGROUP.ABANDON_BOTT.CLICK    
  ENDPROC   
  procedure SHRGROUP.ABANDON_BOTT.CLICK
      THISFORM.SHRGROUP.ENABLED=.F.
      THISFORM.SHRGROUP.VISIBLE=.F.      
      THISFORM.ORPGROUP.ENABLED=.T.
      THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.)   &&判斷有無新增的權限
      THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  &&判斷有無修改的權限
      THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.) AND EMPTY(K36.F11)   &&判斷有無刪除的權限
      THISFORM.ORPGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
      THISFORM.CMDGROUP.ENABLED=.T.
      THISFORM.CMDGROUP.SETALL('ENABLED',.T.,'COMMANDBUTTON')
      THISFORM.CMDGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
      THISFORM.KEY_LIST.ENABLED=.T.      
      THISFORM.SETALL('READONLY',.T.,'TEXTBOX')   

      UNLOCK ALL
      SELE K36
      THISFORM.GRID1.ENABLED=.T.
      THISFORM.GRID1.SETFOCUS      
  ENDPROC
  PROCEDURE SHRGROUP.FINISH_BOTT.CLICK   
       THISFORM.SHRGROUP.ABANDON_BOTT.CLICK
  ENDPROC     
enddefine    
**************************************************刪除資料前檢查是否仍有關聯資料在其他資料表格中
procedure dele_shure 

        
     SELE K36

     LOCK()
     IF RLOCK()        
        SELE K36
        DELE
        unlock
        SKIP -1
        IF BOF()
           GO TOP
        ENDIF   
     ELSE
       DO file_impact    
     ENDIF      
ENDPROC     
************************************************
