****A12.作業畫面項目分類
CLOSE ALL
CLEAR 
FLG='0'
FCH=''
CHK=''
R=0
AREA1='A01_1'
AREA2='A02_1'
IF !USED('A01')
   SELECT  0
   USE A01 INDE A01
ELSE
   SELECT  A01
ENDIF      
SET ORDER TO A01
IF !USED('A03')
   SELECT  0
   USE A03
ELSE 
   SELECT  A03
ENDIF
SET ORDER TO A03
IF !USED('A02')
   SELE 0
   USE A02 INDE A02
ELSE 
   SELE A02
ENDIF
SET ORDER TO A021  
SELECT A02
SEEK SYS_OPER + 'A12' 
SELECT F01,F03,000 AS EXP_1,000 AS EXP_2,000 AS EXP_3 FROM A01 WHERE IIF(A02.F08 <> '*',ALLTRIM(A01.F01) = ALLTRIM(SYS_OPER),.T.) ORDER BY F01 INTO CURSOR A01_1 READWRITE
INDE ON F01 TAG A01_11
GO TOP
DO WHILE !EOF()
   SELECT * FROM A02 WHERE A02.F01 = A01_1.F01 INTO CURSOR A02_TEMP1
   SELECT * FROM A02 WHERE A02.F01 = A01_1.F01 AND A02.F14 = .T. INTO CURSOR A02_TEMP2
   SELECT * FROM A02 WHERE A02.F01 = A01_1.F01 AND A02.F14 = .F. INTO CURSOR A02_TEMP3
   REPLACE A01_1.EXP_1 WITH RECCOUNT('A02_TEMP1')	&&總作業數
   REPLACE A01_1.EXP_2 WITH RECCOUNT('A02_TEMP2')	&&已選取作業數
   REPLACE A01_1.EXP_3 WITH RECCOUNT('A02_TEMP3')	&&未選取作業數
   SELECT A02_TEMP1
   USE
   SELECT A02_TEMP2
   USE
   SELECT A02_TEMP3
   USE   
   SELECT A01_1
   SKIP
ENDDO
SELECT IIF(F14 = .T.,1,0) AS EXP_1,F01,F03 FROM A02 INTO CURSOR A02_1 READWRITE
INDE ON F01 + F03 TAG A02_11
SET ORDER TO A02_11
SELECT A01_1
SET ORDER TO A01_11
GO TOP
********* 
A12FORM=CREATEOBJECT("TKA12")
A12FORM.SHOW  
DEFINE CLASS TKA12 AS FORM
  CAPTION='A12.作業畫面項目分類'
*!*	  AUTOCENTER=.T.
  CONTROLBOX=.F.
  BORDERSTYLE=1  
  MAXBUTTON=.F.
  MINBUTTON=.F.
  MOVABLE=.F.
  CLOSABLE=.F.
  CONTROLCOUNT=57
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*550
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WIDTH=INT_015*789
  WINDOWTYPE=1
  NAME='TKA12'
  ADD OBJECT SHAPE1 AS SHAPE1 WITH;
      AUTOCENTER=.T.
  ADD OBJECT SHAPE2 AS SHAPE2 WITH;
      AUTOCENTER=.T.
  ADD OBJECT SHAPE3 AS SHAPE3 WITH;
      AUTOCENTER=.T.
  ADD OBJECT KEY_LIST AS KEY_LIST WITH;
      AUTOCENTER=.T.
  ADD OBJECT GRID1 AS GRID1 WITH;
      COLUMNCOUNT=2,;    
      HEIGHT=INT_015*420,;
      RECORDSOURCE='A01_1',;
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2'      
  ADD OBJECT GRID2 AS GRID2 WITH;
      TOP=INT_015*53,;
      HEIGHT=INT_015*465,;
      COLUMNCOUNT=3,;            
      RECORDSOURCE='A02_1',;
      LINKMASTER='A01_1',;
      RELATIONALEXPR='F01',;
      CHILDORDER='A02_11',; 
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;
      COLUMN3.NAME='COLUMN3'
  ADD OBJECT CMDGROUP AS CMDGROUP WITH;
      TOP=INT_015*455,;
      AUTOSIZE=.T.
  ADD OBJECT CMND2 AS COMMANDBUTTON WITH;
      LEFT=INT_015*182,;
      TOP=INT_015*490,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*40,;     
      FONTSIZE=INT_015*9,; 
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\HAND.CUR',;           
      CAPTION='\<X.離開',;
      TOOLTIPTEXT='離開此搜尋畫面!快速鍵->ALT+X'
      NAME='CMND2'
  ADD OBJECT CMND3 AS COMMANDBUTTON WITH;
      LEFT=INT_015*98,;    
      HEIGHT=INT_015*25,;   
      TOP=INT_015*490,;        
      WIDTH=INT_015*40,;    
      FONTSIZE=INT_015*9,;
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\HAND.CUR',;
      CAPTION='\<A.全選',;
      TOOLTIPTEXT='全選所有資料!快速鍵->ALT+A'
      NAME='CMND3'
  ADD OBJECT CMND4 AS COMMANDBUTTON WITH;
      LEFT=INT_015*140,;    
      HEIGHT=INT_015*25,;   
      TOP=INT_015*490,;        
      WIDTH=INT_015*40,;  
      FONTSIZE=INT_015*9,;
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\HAND.CUR',;      
      CAPTION='\<C.清除',;
      TOOLTIPTEXT='清除已全選之資料!快速鍵->ALT+C'
      NAME='CMND4'               
 ************     
  ADD OBJECT LBLF01 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*29,;
      WIDTH=INT_015*50,;
      CAPTION='人員編號' 
  ADD OBJECT TXTF01 AS TEXTBOX WITH;      
      LEFT=INT_015*295,;
      TOP=INT_015*23,;
      WIDTH=INT_015*55,;
      HEIGHT=INT_015*25,;
      NAME='TXTF01'    
  ADD OBJECT LBLF03 AS LABEL WITH;      
      LEFT=INT_015*355,;
      TOP=INT_015*29,;
      WIDTH=INT_015*50,;
      CAPTION='人員姓名'
 ADD OBJECT TXTF03 AS TEXTBOX WITH;
      LEFT=INT_015*410,;
      TOP=INT_015*23,;
      WIDTH=INT_015*75,;
      HEIGHT=INT_015*25,;
      NAME='TXTF03'  
  ADD OBJECT LBLF04 AS LABEL WITH;      
      LEFT=INT_015*490,;
      TOP=INT_015*29,;
      AUTOSIZE=.T.,;
      BACKCOLOR=RGB(255,255,0)                 
**********
  PROC INIT   
       SELECT A02_1
       GO TOP
       THISFORM.SETALL('HEIGHT',INT_015*25,'TEXTBOX')
       THISFORM.SETALL('HEIGHT',INT_015*17,'LABEL')
       THISFORM.SETALL('FONTSIZE',INT_015*9,'TEXTBOX')
       THISFORM.SETALL('FONTSIZE',INT_015*9,'LABEL')
       THISFORM.SETALL('READONLY',.T.,'TEXTBOX')
       THISFORM.SETALL('MOVABLE',.F.,'COLUMN')    
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'COLUMN')
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'HEADER') 
       THISFORM.GRID1.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)
       THISFORM.GRID2.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)  
       THISFORM.GRID2.SETALL("DYNAMICBACKCOLOR","IIF(A02_1.EXP_1 = 1,RGB(255,168,81),'')","COLUMN")      
       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*60
       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*80
       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='人員編號'
       THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='人員姓名'
       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='A01_1.F01'
       THISFORM.GRID1.COLUMN2.CONTROLSOURCE='A01_1.F03'
       THISFORM.GRID2.SETALL('FONTSIZE',INT_015*9,'COLUMN')
       THISFORM.GRID2.SETALL('FONTSIZE',INT_015*9,'HEADER')       
       THISFORM.GRID2.COLUMN1.HEADER1.CAPTION=''
       THISFORM.GRID2.COLUMN2.HEADER1.CAPTION='作業編號'
	   THISFORM.GRID2.COLUMN3.HEADER1.CAPTION='作業名稱'
	   THISFORM.GRID2.COLUMN1.CONTROLSOURCE='A02_1.EXP_1'
	   THISFORM.GRID2.COLUMN2.CONTROLSOURCE='A02_1.F03'
	   THISFORM.GRID2.COLUMN3.CONTROLSOURCE="IIF(SEEK(A02_1.F03,'A03'),A03.F02,'')"
	   THISFORM.GRID2.COLUMN1.WIDTH=INT_015*20
	   THISFORM.GRID2.COLUMN2.WIDTH=INT_015*55
	   THISFORM.GRID2.COLUMN3.WIDTH=INT_015*200
       THISFORM.GRID1.READONLY=.T.                
       THISFORM.GRID1.SETFOCUS     
       IF THISFORM.GRID1.ACTIVEROW=0
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.         
       ELSE
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.             
       ENDIF        
       THISFORM.KEY_LIST.DISPLAYVALUE='依人員編號排列'       
       JK='人員編號'
       THISFORM.TXTF01.VALUE=A01_1.F01
       THISFORM.TXTF03.VALUE=A01_1.F03
	   THISFORM.LBLF04.CAPTION='作業總數：' + ALLTRIM(TRANSFORM(A01_1.EXP_1,'@R 999')) + '   已選作業數：' + ALLTRIM(TRANSFORM(A01_1.EXP_2,'@R 999')) + '   未選作業數：' + ALLTRIM(TRANSFORM(A01_1.EXP_3,'@R 999'))
  ENDPROC  
*****  
 PROC GRID2.INIT
	THISFORM.GRID2.COLUMN1.READONLY=.F.
	THISFORM.GRID2.COLUMN2.READONLY=.T.
	THISFORM.GRID2.COLUMN3.READONLY=.T.
	THISFORM.GRID2.COLUMN1.removeobject("TEXT1")
	THISFORM.GRID2.COLUMN1.AddObject("CheckBox1","CheckBox1") 
	THISFORM.GRID2.COLUMN1.CurrentControl="CheckBox1" 
	THISFORM.GRID2.COLUMN1.Sparse=.F.
	THISFORM.GRID2.COLUMN1.CheckBox1.Visible=.T.
	THISFORM.GRID2.COLUMN1.CheckBox1.CAPTION=''
	THISFORM.GRID2.COLUMN1.CheckBox1.AUTOSIZE=.T.
	THISFORM.GRID2.COLUMN1.CheckBox1.CENTERED=.T.
	THISFORM.GRID2.COLUMN1.CheckBox1.BACKSTYLE=0
	THISFORM.GRID2.COLUMN1.CheckBox1.LEFT=5
  ENDPROC         
***********   
  PROC KEY_LIST.INIT 
       WITH THIS 
           .ADDITEM('依人員編號排列')
       ENDWITH      
  ENDPROC 
  **********
  PROC GRID1.AFTERROWCOLCHANGE
       LPARAMETERS NCOLINDEX
       THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","","COLUMN")
       IF THIS.ACTIVEROW = 0
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.        
       ELSE
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.
	      THISFORM.TXTF01.VALUE=A01_1.F01
	      THISFORM.TXTF03.VALUE=A01_1.F03
	      THISFORM.LBLF04.CAPTION='作業總數：' + ALLTRIM(TRANSFORM(A01_1.EXP_1,'@R 999')) + '   已選作業數：' + ALLTRIM(TRANSFORM(A01_1.EXP_2,'@R 999')) + '   未選作業數：' + ALLTRIM(TRANSFORM(A01_1.EXP_3,'@R 999'))
       ENDIF        
       FCH=THISFORM.ACTIVECONTROL.NAME
       JK=THIS.COLUMN1.HEADER1.CAPTION         
       CHK=''     
       THISFORM.REFRESH
  ENDPROC     
  ***********
  PROC GRID2.AFTERROWCOLCHANGE
       LPARAMETERS NCOLINDEX  
       SELECT A02_1
       R=RECNO('&AREA1')
       THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(RECNO('&AREA1') = R,RGB(255,255,0),'')","COLUMN") 
       THISFORM.GRID2.SETALL("DYNAMICBACKCOLOR","IIF(A02_1.EXP_1 = 1,RGB(255,168,81),'')","COLUMN")                   
       THISFORM.GRID1.ENABLED=.F.
       THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
       FCH=THISFORM.ACTIVECONTROL.NAME
       JK=THIS.COLUMN1.HEADER1.CAPTION
       CHK=THISFORM.TXTF01.VALUE 
  ENDPROC       
*****  
  PROC GRID1.MOUSEENTER
       LPARAMETERS nButton, nShift, nXCoord, nYCoord
         THISFORM.GRID1.ENABLED=.T.   
 ENDPROC 
 ***
 PROCEDURE CMND2.CLICK
   	 IF MESSAGEBOX('您真的要結束此作業嗎',4+48+0,'請確定')=6
        IF A02.F08 <> '*' AND A01_1.EXP_1 > 47 AND A01_1.EXP_2 > 47
           =MESSAGEBOX('若您在A02.操作人員資料管理之作業畫面為MENU1時,則作業畫面將  L.出現其他作業項目明細表  之選項',0+64,'提示訊息視窗')
        ENDIF
        
        
        IF !USED('A05')
            SELECT  0
            USE A05 
        ELSE
            SELE A05
        ENDIF   
        SET ORDER TO 1    
        SEEK sys_oper +'A12'
        IF FOUND()
           DELETE 
        ENDIF   
        ON KEY
        UNLOCK ALL
        SELECT A01_1
   	    USE          
        SELECT A02_1
   	    USE                  
        CLOSE TABLE ALL
        THISFORM.RELEASE 
        RETURN    	     
   	  ENDIF   
 ENDPROC  
 PROCEDURE CMND3.CLICK		&&全選
   	  SELECT A01_1
	  REPLACE A01_1.EXP_2 WITH A01_1.EXP_1
	  REPLACE A01_1.EXP_3 WITH 0  
	  THISFORM.LBLF04.CAPTION='作業總數：' + ALLTRIM(TRANSFORM(A01_1.EXP_1,'@R 999')) + '   已選作業數：' + ALLTRIM(TRANSFORM(A01_1.EXP_2,'@R 999')) + '   未選作業數：' + ALLTRIM(TRANSFORM(A01_1.EXP_3,'@R 999'))			  	     	     	 
   	  SELECT A02
   	  REPLACE A02.F14 WITH .T. FOR ALLTRIM(A02.F01) = ALLTRIM(THISFORM.TXTF01.VALUE)
   	  SELECT A02_1
   	  REPLACE A02_1.EXP_1 WITH 1 FOR ALLTRIM(A02_1.F01) = ALLTRIM(THISFORM.TXTF01.VALUE)
	  GO TOP	  
   	  THISFORM.GRID2.SETFOCUS     
 ENDPROC  
 PROCEDURE CMND4.CLICK		&&清除
   	  SELECT A01_1
	  REPLACE A01_1.EXP_2 WITH 0
	  REPLACE A01_1.EXP_3 WITH A01_1.EXP_1  
	  THISFORM.LBLF04.CAPTION='作業總數：' + ALLTRIM(TRANSFORM(A01_1.EXP_1,'@R 999')) + '   已選作業數：' + ALLTRIM(TRANSFORM(A01_1.EXP_2,'@R 999')) + '   未選作業數：' + ALLTRIM(TRANSFORM(A01_1.EXP_3,'@R 999'))			  	  
   	  SELECT A02
   	  REPLACE A02.F14 WITH .F. FOR ALLTRIM(A02.F01) = ALLTRIM(THISFORM.TXTF01.VALUE)   	  
   	  SELECT A02_1
   	  REPLACE A02_1.EXP_1 WITH 0 FOR ALLTRIM(A02_1.F01) = ALLTRIM(THISFORM.TXTF01.VALUE)
	  GO TOP
   	  THISFORM.GRID2.SETFOCUS     
 ENDPROC     
ENDDEFINE      
*********     
DEFINE CLASS CheckBox1 AS CheckBox
	PROCEDURE CLICK
		IF A02_1.EXP_1 = 1 
		   REPLACE A01_1.EXP_2 WITH A01_1.EXP_2 + 1
		   REPLACE A01_1.EXP_3 WITH A01_1.EXP_3 - 1
		ELSE
		   REPLACE A01_1.EXP_2 WITH A01_1.EXP_2 - 1
		   REPLACE A01_1.EXP_3 WITH A01_1.EXP_3 + 1		  
		ENDIF   
	    THISFORM.LBLF04.CAPTION='作業總數：' + ALLTRIM(TRANSFORM(A01_1.EXP_1,'@R 999')) + '   已選作業數：' + ALLTRIM(TRANSFORM(A01_1.EXP_2,'@R 999')) + '   未選作業數：' + ALLTRIM(TRANSFORM(A01_1.EXP_3,'@R 999'))		
   	    SELECT A02
   	    SET ORDER TO A021
   	    SEEK A01_1.F01 + A02_1.F03	 
   	    IF FOUND()   
   	       REPLACE A02.F14 WITH IIF(A02_1.EXP_1 = 0,.F.,.T.)
   	    ENDIF
		THISFORM.GRID2.REFRESH
	ENDPROC  
ENDDEFINE  
