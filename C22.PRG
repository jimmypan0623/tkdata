******C22.INVOICE
CLOSE ALL
CLEAR 
PO_NO=''
FLG='0'
FCH=''
CHK=''
CHK_STR=''
R=0
STARN='' &&起始箱號
ENDN='' &&截止箱號
MTH_STR=''
***********
AREA1='C22'
AREA2='C23'
HD1='C022 '
HD2='CD'
HD3='INVOICE'
IF ! USED('A01')
   SELE 0
   USE A01 INDE A01
ELSE
   SELE A01
ENDIF      
SET ORDER TO A01
GSYS=IIF(SEEK(SYS_OPER,'A01'),A01.F03,'')
GEMAL=IIF(SEEK(SYS_OPER,'A01'),A01.F10,'')
IF !USED('A02')
   SELE 0
   USE A02 INDE A02
ELSE
   SELE A02
ENDIF
SET ORDER TO A021
SEEK SYS_OPER+'C22'
GL=F04
GM=F05
GN=F06
GP=F07
IF !USED('A09')
   SELE 0
   USE A09
ELSE
   SELE A09
ENDIF
SET ORDER TO 1
A24='A24'+LEFT(DTOS(DATE()),6)
IF !USED('&A24')
   SELE 0
   USE (A24) ALIA A24
ELSE
   SELE A24
ENDIF
SET ORDER TO 1     
IF !USED('A26')
   SELE 0
   USE A26 INDE A26
ELSE
   SELE A26
ENDIF
SET ORDER TO 1 
IF !USED('B01')
   SELE 0
   USE B01 
ELSE
   SELE B01
ENDIF
SET ORDER TO B011
IF !USED('C00')
   SELE 0
   USE C00
ELSE
   SELE C00
ENDIF
SET ORDER TO 1
IF !USED('C01')
   SELE 0
   USE C01  INDE C01
ELSE 
   SELE C01
ENDIF
SET ORDER TO C011
IF !USED('C03')
   SELE 0
   USE C03 INDE C03
ELSE
   SELE C03
ENDIF
SET ORDER TO C031
IF !USED('C04')
   SELE 0
   USE C04 INDE C04
ELSE
   SELE C04
ENDIF
SET ORDER TO C041
 IF !USED('C20')
    SELE 0
    USE C20
 ELSE
    SELE C20
 ENDIF   
 SET ORDER TO C201
IF !USED('C24')
    SELE 0
    USE C24
ELSE 
   SELE C24
ENDIF
SET ORDER TO C241
 
IF !USED('C22')
    SELE 0
    USE C22
ELSE 
   SELE C22
ENDIF
SET ORDER TO C221
IF !USED('C23')
    SELE 0
    USE C23
ELSE 
   SELE C23
ENDIF
SET ORDER TO C231
SET RELATION TO F01+F02+F06 INTO C24
IF !USED('C28')
    SELE 0
    USE C28
ELSE 
   SELE C28
ENDIF
SET ORDER TO C283
**************************
C22FORM=CREATEOBJECT("TKC22")
C22FORM.SHOW  
DEFINE CLASS TKC22 AS FORM
  CAPTION='C22.INVOICE'
*!*	  AUTOCENTER=.T.
  CONTROLBOX=.F.
  BORDERSTYLE=3  
  MAXBUTTON=.F.
  MINBUTTON=.F.
  MOVABLE=.F.
  CLOSABLE=.F.
  CONTROLCOUNT=57
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*550
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WIDTH=INT_015*791
  WINDOWTYPE=1
  NAME='TKC22'
  ADD OBJECT SHAPE1 AS SHAPE1 WITH;
      AUTOCENTER=.T.
  ADD OBJECT LBL_REC AS LBL_REC WITH;
      AUTOCENTER =.T.
  ADD OBJECT SHAPE2 AS SHAPE2 WITH;
      AUTOCENTER=.T.
  ADD OBJECT SHAPE3 AS SHAPE3 WITH;
      AUTOCENTER=.T.
  ADD OBJECT PAGEFRAME1 AS PAGEFRAME WITH;
      LEFT=INT_015*236,;
      WIDTH=INT_015*540,;
      HEIGHT=INT_015*285,;
      FONTSIZE=INT_015*9,;
      PAGECOUNT=2,;
      TABSTRETCH=1,;
      ACTIVEPAGE=1,;
      VISIBLE=.T.,;
      PAGE1.NAME='PAGE1',;
      PAGE1.VISIBLE=.T.,;
      PAGE1.CAPTION='表頭資料',;
      PAGE2.NAME='PAGE2',;
      PAGE2.VISIBLE=.T.,;
      PAGE2.CAPTION='表身詳細資料內容'   
  ADD OBJECT KEY_LIST AS KEY_LIST WITH;
      AUTOCENTER=.T.
  ADD OBJECT GRID1 AS GRID1 WITH;
      COLUMNCOUNT=3,;            
      RECORDSOURCE='C22',;      
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;
      COLUMN3.NAME='COLUMN3'
  ADD OBJECT GRID2 AS GRID2 WITH;
      TOP=INT_015*285,;
      HEIGHT=INT_015*233,;
      COLUMNCOUNT=7,;            
      RECORDSOURCE='C23',; 
      LINKMASTER='C22',;
      RELATIONALEXPR='F01',;
      CHILDORDER='C231',;  
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;
      COLUMN3.NAME='COLUMN3',;
      COLUMN4.NAME='COLUMN4',;
      COLUMN5.NAME='COLUMN5',;
      COLUMN6.NAME='COLUMN6',;
      COLUMN7.NAME='COLUMN7'
   ADD OBJECT CMDGROUP AS CMDGROUP WITH;
      AUTOSIZE=.T.              
  ADD OBJECT ORPGROUP AS ORPGROUP WITH;    
      AUTOSIZE=.T.              
  ADD OBJECT SHRGROUP AS SHRGROUP WITH;
      TOP=INT_015*252,;
      LEFT=INT_015*600 
  ADD OBJECT TRN_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*490,;
      LEFT=INT_015*143,;
      HEIGHT=INT_015*25,;
      FONTSIZE=INT_015*9,;      
      WIDTH=INT_015*80,;
      CAPTION='\<T.轉PACKING',;
      TOOLTIPTEXT='將此張出貨單轉入C23 PACKING LIST',;
      NAME='TRN_BOTT'              
  ADD OBJECT XLS_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*490,;
      LEFT=INT_015*60,;
      HEIGHT=INT_015*25,;
      FONTSIZE=INT_015*9,;      
      WIDTH=INT_015*80,;
      CAPTION='\<L.轉EXCEL檔',;
      TOOLTIPTEXT='將此張轉成EXCEL檔',;
      NAME='XLS_BOTT'                                                  
***************************PAGEFRAME1.PAGE1
PROCEDURE PAGEFRAME1.PAGE1.INIT   
  THIS.ADDOBJECT('LBLF01','LABEL')&&INVOICE
     WITH THIS.LBLF01
          .VISIBLE=.T.
          .LEFT=INT_015*10
          .TOP=INT_015*8
          .WIDTH=INT_015*85
          .CAPTION='INVOICE'          
     ENDWITH
  THIS.ADDOBJECT('TXTF01','TEXTBOX')     
     WITH THIS.TXTF01
          .VISIBLE=.T.
          .LEFT=INT_015*60
          .TOP=INT_015*2
          .WIDTH=INT_015*85
          .HEIGHT=INT_015*25
          .MAXLENGTH=10
     ENDWITH
THIS.ADDOBJECT('LBLF04','LABEL')&&出貨單號'
     WITH THIS.LBLF04
          .VISIBLE=.T.
          .LEFT=INT_015*10
          .TOP=INT_015*33
          .WIDTH=INT_015*50
          .CAPTION='出貨單號'          
     ENDWITH    
 THIS.ADDOBJECT('TXTF04','TXTF04')     
     WITH THIS.TXTF04
          .VISIBLE=.T.
          .LEFT=INT_015*60
          .TOP=INT_015*27
          .WIDTH=INT_015*85
          .HEIGHT=INT_015*25
          .MAXLENGTH=10
     ENDWITH     
 THIS.ADDOBJECT('LBLF03','LABEL')&&客戶編號
     WITH THIS.LBLF03
          .VISIBLE=.T.
          .LEFT=INT_015*10
          .TOP=INT_015*58
          .WIDTH=INT_015*50
          .CAPTION='客戶編號'          
     ENDWITH
   THIS.ADDOBJECT('LBLF031','LABEL')
     WITH THIS.LBLF031
          .VISIBLE=.T.
          .LEFT=INT_015*113
          .TOP=INT_015*58
          .AUTOSIZE=.T.
          .CAPTION=''          
     ENDWITH
  THIS.ADDOBJECT('TXTF03','TXTF03')     
     WITH THIS.TXTF03
          .VISIBLE=.T.
          .LEFT=INT_015*60
          .TOP=INT_015*52
          .WIDTH=INT_015*50
          .HEIGHT=INT_015*25
          .MAXLENGTH=5
     ENDWITH         
 THIS.ADDOBJECT('LBLF05','LABEL')&&公司名稱A
     WITH THIS.LBLF05
          .VISIBLE=.T.
          .LEFT=INT_015*10
          .TOP=INT_015*83
          .WIDTH=INT_015*50
          .CAPTION='公司名稱'          
     ENDWITH
  THIS.ADDOBJECT('TXTF05','TEXTBOX')     
     WITH THIS.TXTF05
          .VISIBLE=.T.
          .LEFT=INT_015*60
          .TOP=INT_015*77
          .WIDTH=INT_015*460
          .HEIGHT=INT_015*25
          .MAXLENGTH=80
     ENDWITH
  THIS.ADDOBJECT('TXTF18','TEXTBOX')     &&公司名稱B
     WITH THIS.TXTF18
          .VISIBLE=.T.
          .LEFT=INT_015*60
          .TOP=INT_015*102
          .WIDTH=INT_015*460
          .HEIGHT=INT_015*25
          .MAXLENGTH=80
     ENDWITH     
 THIS.ADDOBJECT('LBLF06','LABEL')&&英文送貨地址A
     WITH THIS.LBLF06
          .VISIBLE=.T.
          .LEFT=INT_015*10
          .TOP=INT_015*133
          .WIDTH=INT_015*50
          .CAPTION='送貨地址'          
     ENDWITH
  THIS.ADDOBJECT('TXTF06','TEXTBOX')     
     WITH THIS.TXTF06
          .VISIBLE=.T.
          .LEFT=INT_015*60
          .TOP=INT_015*127
          .WIDTH=INT_015*460
          .HEIGHT=INT_015*25
          .MAXLENGTH=100
     ENDWITH
   THIS.ADDOBJECT('TXTF17','TEXTBOX')   &&英文送貨地址B  
     WITH THIS.TXTF17
          .VISIBLE=.T.
          .LEFT=INT_015*60
          .TOP=INT_015*152
          .WIDTH=INT_015*460
          .HEIGHT=INT_015*25
          .MAXLENGTH=100
     ENDWITH    
 THIS.ADDOBJECT('LBLF09','LABEL')&&備註資料一
     WITH THIS.LBLF09
          .VISIBLE=.T.
          .LEFT=INT_015*10
          .TOP=INT_015*183
          .WIDTH=INT_015*50
          .CAPTION='備  註  一'          
     ENDWITH
  THIS.ADDOBJECT('TXTF09','TEXTBOX')     
     WITH THIS.TXTF09
          .VISIBLE=.T.
          .LEFT=INT_015*60
          .TOP=INT_015*177
          .WIDTH=INT_015*430
          .HEIGHT=INT_015*25
          .MAXLENGTH=120
     ENDWITH
 THIS.ADDOBJECT('LBLF16','LABEL')&&備註資料二
     WITH THIS.LBLF16
          .VISIBLE=.T.
          .LEFT=INT_015*10
          .TOP=INT_015*208
          .WIDTH=INT_015*50
          .CAPTION='備  註  二'          
     ENDWITH
  THIS.ADDOBJECT('TXTF16','TEXTBOX')     
     WITH THIS.TXTF16
          .VISIBLE=.T.
          .LEFT=INT_015*60
          .TOP=INT_015*202
          .WIDTH=INT_015*430
          .HEIGHT=INT_015*25
          .MAXLENGTH=120
     ENDWITH    
 THIS.ADDOBJECT('LBLF14','LABEL')&&FROM
     WITH THIS.LBLF14
          .VISIBLE=.T.
          .LEFT=INT_015*10
          .TOP=INT_015*233
          .WIDTH=INT_015*35
          .CAPTION='FROM'          
     ENDWITH    
 THIS.ADDOBJECT('TXTF14','TEXTBOX')     
     WITH THIS.TXTF14
          .VISIBLE=.T.
          .LEFT=INT_015*60
          .TOP=INT_015*227
          .WIDTH=INT_015*160
          .HEIGHT=INT_015*25
          .MAXLENGTH=20
     ENDWITH
  THIS.ADDOBJECT('FROM14','FROM14')
       WITH THIS.FROM14
          .VISIBLE=.F.
          .LEFT=INT_015*60
          .TOP=INT_015*227
          .WIDTH=INT_015*160
          .HEIGHT=INT_015*25
     ENDWITH                      
  THIS.ADDOBJECT('LBLF15','LABEL')&&TO
     WITH THIS.LBLF15
          .VISIBLE=.T.
          .LEFT=INT_015*222
          .TOP=INT_015*233
          .WIDTH=INT_015*17
          .CAPTION='TO'          
     ENDWITH    
 THIS.ADDOBJECT('TXTF15','TEXTBOX')     
     WITH THIS.TXTF15
          .VISIBLE=.T.
          .LEFT=INT_015*239
          .TOP=INT_015*227
          .WIDTH=INT_015*116
          .HEIGHT=INT_015*25
          .MAXLENGTH=20
     ENDWITH     
THIS.ADDOBJECT('LBLF02','LABEL')&&日        期
     WITH THIS.LBLF02
          .VISIBLE=.T.
          .LEFT=INT_015*210
          .TOP=INT_015*8
          .WIDTH=INT_015*50
          .CAPTION='日        期'          
     ENDWITH    
 THIS.ADDOBJECT('TXTF02','TEXTBOX')     
     WITH THIS.TXTF02
          .VISIBLE=.T.
          .LEFT=INT_015*260
          .TOP=INT_015*2
          .WIDTH=INT_015*80
          .HEIGHT=INT_015*25
          .MAXLENGTH=10
     ENDWITH                   
THIS.ADDOBJECT('LBLF07','LABEL')&&交貨日期'
     WITH THIS.LBLF07
          .VISIBLE=.T.
          .LEFT=INT_015*210
          .TOP=INT_015*33
          .WIDTH=INT_015*50
          .CAPTION='交貨日期'          
     ENDWITH    
 THIS.ADDOBJECT('TXTF07','TEXTBOX')     
     WITH THIS.TXTF07
          .VISIBLE=.T.
          .LEFT=INT_015*260
          .TOP=INT_015*27
          .WIDTH=INT_015*80
          .HEIGHT=INT_015*25
          .MAXLENGTH=10
     ENDWITH     
 THIS.ADDOBJECT('LBLF08','LABEL')&&付款方式
     WITH THIS.LBLF08
          .VISIBLE=.T.
          .LEFT=INT_015*210
          .TOP=INT_015*58
          .WIDTH=INT_015*50
          .CAPTION='付款方式'          
     ENDWITH    
 THIS.ADDOBJECT('TXTF08','TEXTBOX')     
     WITH THIS.TXTF08
          .VISIBLE=.T.
          .LEFT=INT_015*260
          .TOP=INT_015*52
          .WIDTH=INT_015*120
          .HEIGHT=INT_015*25
          .MAXLENGTH=20
     ENDWITH
  THIS.ADDOBJECT('LBLF10','LABEL')&&賣頭
     WITH THIS.LBLF10
          .VISIBLE=.T.
          .LEFT=INT_015*390
          .TOP=INT_015*8
          .WIDTH=INT_015*50
          .CAPTION='賣        頭'          
     ENDWITH    
 THIS.ADDOBJECT('TXTF10','TEXTBOX')     
     WITH THIS.TXTF10
          .VISIBLE=.T.
          .LEFT=INT_015*440
          .TOP=INT_015*2
          .WIDTH=INT_015*80
          .HEIGHT=INT_015*25
          .MAXLENGTH=15
     ENDWITH
 THIS.ADDOBJECT('LBLF11','LABEL')&&製造地
     WITH THIS.LBLF11
          .VISIBLE=.T.
          .LEFT=INT_015*390
          .TOP=INT_015*33
          .WIDTH=INT_015*50
          .CAPTION='製  造  地'          
     ENDWITH    
 THIS.ADDOBJECT('TXTF11','TEXTBOX')     
     WITH THIS.TXTF11
          .VISIBLE=.T.
          .LEFT=INT_015*440
          .TOP=INT_015*27
          .WIDTH=INT_015*80
          .HEIGHT=INT_015*25
          .MAXLENGTH=15
     ENDWITH    
 THIS.ADDOBJECT('LBLF12','LABEL')&&C/NO
     WITH THIS.LBLF12
          .VISIBLE=.T.
          .LEFT=INT_015*390
          .TOP=INT_015*58
          .WIDTH=INT_015*50
          .CAPTION='     C/NO'          
     ENDWITH    
 THIS.ADDOBJECT('TXTF12','TEXTBOX')     
     WITH THIS.TXTF12
          .VISIBLE=.T.
          .LEFT=INT_015*440
          .TOP=INT_015*52
          .WIDTH=INT_015*80
          .HEIGHT=INT_015*25
          .MAXLENGTH=15
     ENDWITH           
 THIS.ADDOBJECT('LBLF13','LABEL')&&安全資料'
     WITH THIS.LBLF13
          .VISIBLE=.T.
          .LEFT=INT_015*375
          .TOP=INT_015*233
          .WIDTH=INT_015*50
          .CAPTION='安全資料'          
     ENDWITH
 THIS.ADDOBJECT('LBLF131','LABEL')
     WITH THIS.LBLF131
          .VISIBLE=.T.
          .LEFT=INT_015*425
          .TOP=INT_015*233
          .AUTOSIZE=.T.
          .CAPTION=''          
     ENDWITH                                            
***********************PAGEFRAME1.PAGE2                  
PROCEDURE PAGEFRAME1.PAGE2.INIT
 THIS.ADDOBJECT('LBLF02','LABEL')&&品        號
     WITH THIS.LBLF02
          .VISIBLE=.T.
          .LEFT=INT_015*14
          .TOP=INT_015*15
          .WIDTH=INT_015*50
          .CAPTION='品        號'          
     ENDWITH
 THIS.ADDOBJECT('LBLF021','LABEL')
     WITH THIS.LBLF021
          .VISIBLE=.T.
          .LEFT=INT_015*337
          .TOP=INT_015*15
          .AUTOSIZE=.T.
          .CAPTION=''          
     ENDWITH    
THIS.ADDOBJECT('TXTF02','TXTF02')          
     WITH THIS.TXTF02
          .VISIBLE=.T.
          .LEFT=INT_015*65
          .TOP=INT_015*9
          .WIDTH=INT_015*261
          .HEIGHT=INT_015*25
          .MAXLENGTH=43
          .NAME='TXTF02'
ENDWITH        
THIS.ADDOBJECT('LBLF03','LABEL')&&數        量
     WITH THIS.LBLF03
         .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*40
         .WIDTH=INT_015*60
         .CAPTION='數        量'
ENDWITH
THIS.ADDOBJECT('TXTF03','TEXTBOX')          
     WITH THIS.TXTF03
          .VISIBLE=.T.
          .LEFT=INT_015*65
          .TOP=INT_015*34
          .WIDTH=INT_015*80
          .HEIGHT=INT_015*25
          .MAXLENGTH=15
          .NAME='TXTF03'
ENDWITH    
THIS.ADDOBJECT('LBLF04','LABEL')&&單        價     
     WITH THIS.LBLF04
          .VISIBLE=.T.
          .LEFT=INT_015*14
          .TOP=INT_015*65
          .WIDTH=INT_015*50  
          .CAPTION='單        價'
ENDWITH            
THIS.ADDOBJECT('TXTF04','TEXTBOX')          
     WITH THIS.TXTF04
          .VISIBLE=.T.
          .LEFT=INT_015*65
          .TOP=INT_015*59
          .WIDTH=INT_015*100
          .HEIGHT=INT_015*25
          .INPUTMASK='9999999.999999'
          .MAXLENGTH=15
          .NAME='TXTF04'
ENDWITH
THIS.ADDOBJECT('LBLF07','LABEL')&&幣        別'
     WITH THIS.LBLF07
          .VISIBLE=.T.
          .LEFT=INT_015*14
          .TOP=INT_015*90
          .WIDTH=INT_015*50
          .CAPTION='幣        別'          
     ENDWITH    
 THIS.ADDOBJECT('TXTF07','TEXTBOX')     
     WITH THIS.TXTF07
          .VISIBLE=.T.
          .LEFT=INT_015*65
          .TOP=INT_015*84
          .WIDTH=INT_015*55
          .HEIGHT=INT_015*25
          .MAXLENGTH=4
     ENDWITH
 THIS.ADDOBJECT('CRCY','CRCY')
       WITH THIS.CRCY
          .VISIBLE=.F.
          .LEFT=INT_015*64
          .TOP=INT_015*84
          .WIDTH=INT_015*55
          .HEIGHT=INT_015*25
     ENDWITH                            
THIS.ADDOBJECT('LBLF34','LABEL')&&金額小計     
     WITH THIS.LBLF34
          .VISIBLE=.T.
          .LEFT=INT_015*14
          .TOP=INT_015*115
          .WIDTH=INT_015*50  
          .CAPTION='金額小計'
ENDWITH            
THIS.ADDOBJECT('LBLF341','LABEL')          
     WITH THIS.LBLF341
          .VISIBLE=.T.
          .LEFT=INT_015*65
          .TOP=INT_015*115
          .AUTOSIZE=.T.
ENDWITH 
THIS.ADDOBJECT('LBLF06','LABEL')&&客  戶 P/O
     WITH THIS.LBLF06
         .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*140
         .WIDTH=INT_015*50
         .CAPTION='客 戶P/O'
ENDWITH

THIS.ADDOBJECT('TXTF06','TEXTBOX')          
     WITH THIS.TXTF06
          .VISIBLE=.T.
          .LEFT=INT_015*64
          .TOP=INT_015*134
          .WIDTH=INT_015*220
          .HEIGHT=INT_015*25
          .MAXLENGTH=25
          .NAME='TXTF06'
ENDWITH
THIS.ADDOBJECT('LBLF05','LABEL')&&客戶品號
     WITH THIS.LBLF05
         .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*165
         .WIDTH=INT_015*50
         .CAPTION='客戶品號'
ENDWITH
THIS.ADDOBJECT('TXTF05','TEXTBOX')          
     WITH THIS.TXTF05
          .VISIBLE=.T.
          .LEFT=INT_015*64
          .TOP=INT_015*159
          .WIDTH=INT_015*220
          .HEIGHT=INT_015*25
          .MAXLENGTH=30
          .NAME='TXTF05'
ENDWITH 
THIS.ADDOBJECT('LBLF19','LABEL')
     WITH THIS.LBLF19
         .VISIBLE=.T.
         .LEFT=INT_015*334
         .TOP=INT_015*165
         .WIDTH=INT_015*50
         .CAPTION='其他序號'
ENDWITH
THIS.ADDOBJECT('TXTF19','TEXTBOX')          
     WITH THIS.TXTF19
          .VISIBLE=.T.
          .LEFT=INT_015*384
          .TOP=INT_015*159
          .WIDTH=INT_015*130
          .HEIGHT=INT_015*25
          .MAXLENGTH=20
          .NAME='TXTF19'
ENDWITH 
THIS.ADDOBJECT('LBLF13','LABEL')&&產地
     WITH THIS.LBLF13
         .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*190
         .WIDTH=INT_015*50
         .CAPTION='產       地'
ENDWITH
THIS.ADDOBJECT('TXTF13','TEXTBOX')          
     WITH THIS.TXTF13
          .VISIBLE=.T.
          .LEFT=INT_015*64
          .TOP=INT_015*184
          .WIDTH=INT_015*90
          .HEIGHT=INT_015*25
          .MAXLENGTH=15
          .NAME='TXTF13'
ENDWITH 
THIS.ADDOBJECT('LBLFEX','LABEL')&&申報事項說明
     WITH THIS.LBLFEX
         .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*215
         .WIDTH=INT_015*50
         .CAPTION='其他備註'
ENDWITH


THIS.ADDOBJECT('TXTFEX','TEXTBOX')          
     WITH THIS.TXTFEX
          .VISIBLE=.T.
          .LEFT=INT_015*64
          .TOP=INT_015*209
          .WIDTH=INT_015*460
          .HEIGHT=INT_015*50
          .MAXLENGTH=100
          .NAME='TXTFEX'
ENDWITH 

THIS.ADDOBJECT('LBLF08','LABEL')
     WITH THIS.LBLF08
          .VISIBLE=.T.
          .LEFT=INT_015*385
          .TOP=INT_015*240
          .WIDTH=INT_015*50
          .CAPTION='安全資料'          
     ENDWITH
 THIS.ADDOBJECT('LBLF081','LABEL')
     WITH THIS.LBLF081
          .VISIBLE=.T.
          .LEFT=INT_015*435
          .TOP=INT_015*240
          .AUTOSIZE=.T.
          .CAPTION=''          
     ENDWITH                                               
ENDPROC 
******************設定PAGE1之動態動作******************        
  PROCEDURE PAGEFRAME1.PAGE1.ACTIVATE
     R=0
     SELECT C22
     IF THISFORM.SHRGROUP.VISIBLE=.F.
         THISFORM.GRID1.ENABLED=.T.   
         THISFORM.GRID1.SETFOCUS   
         THISFORM.KEY_LIST.ENABLED=.T.
     ELSE
        THISFORM.KEY_LIST.ENABLED=.F.   
     ENDIF                
     IF THISFORM.GRID1.ACTIVEROW=0 .AND. THISFORM.SHRGROUP.ENABLED=.F.
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
        THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
        THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
        THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
        THISFORM.TRN_BOTT.ENABLED=.F. 
        THISFORM.PAGEFRAME1.PAGE1.SETALL('VALUE','','TEXTBOX')
        THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=''
       THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE=''
       THISFORM.PAGEFRAME1.PAGE1.TXTF03.VALUE=''
       THISFORM.PAGEFRAME1.PAGE1.TXTF04.VALUE=''
       THISFORM.PAGEFRAME1.PAGE1.TXTF05.VALUE=''
       THISFORM.PAGEFRAME1.PAGE1.TXTF06.VALUE=''
       THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE=''
       THISFORM.PAGEFRAME1.PAGE1.TXTF08.VALUE=''
       THISFORM.PAGEFRAME1.PAGE1.TXTF09.VALUE=''
       THISFORM.PAGEFRAME1.PAGE1.TXTF10.VALUE=''
       THISFORM.PAGEFRAME1.PAGE1.TXTF11.VALUE=''
       THISFORM.PAGEFRAME1.PAGE1.TXTF12.VALUE=''
       THISFORM.PAGEFRAME1.PAGE1.TXTF14.VALUE=''
       THISFORM.PAGEFRAME1.PAGE1.TXTF15.VALUE=''
       THISFORM.PAGEFRAME1.PAGE1.TXTF16.VALUE=''
       THISFORM.PAGEFRAME1.PAGE1.TXTF17.VALUE=''
       THISFORM.PAGEFRAME1.PAGE1.TXTF18.VALUE=''
        THISFORM.PAGEFRAME1.PAGE1.LBLF031.CAPTION='' 
        THISFORM.PAGEFRAME1.PAGE1.LBLF131.CAPTION=''
        THISFORM.PAGEFRAME1.PAGE2.ENABLED=.F. 
     ELSE
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.
        THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(GM='*',.T.,.F.)  &&判斷有無修改的權限
        THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(GN='*',.T.,.F.)   &&判斷有無刪除的權限
        THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(GP='*',.T.,.F.)   &&判斷有無列印的權限 
	THISFORM.TRN_BOTT.ENABLED=IIF(SEEK(C22.F04,'C28'),.F.,.T.)&&判斷是否有轉PACKING LIST的權限
        THISFORM.PAGEFRAME1.PAGE2.ENABLED=.T. 
     ENDIF
     THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(GP='*',.T.,.F.)
 ENDPROC
*****************設定PAGE2之動態動作****************** 
 PROCEDURE PAGEFRAME1.PAGE2.ACTIVATE
     SELE C23
     IF THISFORM.SHRGROUP.ENABLED=.F.
         THISFORM.GRID2.READONLY=.T.   
         THISFORM.GRID2.SETFOCUS  
     ENDIF   
     IF THISFORM.GRID2.ACTIVEROW=0  .AND. THISFORM.SHRGROUP.ENABLED=.F.
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
        THISFORM.PAGEFRAME1.PAGE2.SETALL('VALUE','','TEXTBOX')
       THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE=''
       THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=0
       THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE=0
       THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE=''
       THISFORM.PAGEFRAME1.PAGE2.TXTF06.VALUE=''
       THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE=''
       THISFORM.PAGEFRAME1.PAGE2.TXTF19.VALUE=''
       THISFORM.PAGEFRAME1.PAGE2.TXTF13.VALUE=''
       THISFORM.PAGEFRAME1.PAGE2.LBLF081.CAPTION=''
        THISFORM.PAGEFRAME1.PAGE2.LBLF021.CAPTION='' 
        THISFORM.PAGEFRAME1.PAGE2.LBLF341.CAPTION=''
    ELSE 
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T. 
        THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(GP='*',.T.,.F.)   &&判斷有無列印的權限 
	THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(GM='*',.T.,.F.)  &&判斷有無修改的權限
        THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(GN='*',.T.,.F.)   &&判斷有無刪除的權限
     ENDIF   
     R=RECNO('&AREA1')
     THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(RECNO('&AREA1')=R,RGB(255,255,0),'')","COLUMN")
     THISFORM.GRID1.ENABLED=.F.     
     THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(GL='*',.T.,.F.)   &&判斷有無新增的權
     THISFORM.KEY_LIST.ENABLED=.F. 
     THISFORM.TRN_BOTT.ENABLED=.F.
  ENDPROC 
 ******************屬性設定******************
  PROC INIT
       THISFORM.PAGEFRAME1.PAGE1.FONTSIZE=INT_015*9
       THISFORM.PAGEFRAME1.PAGE2.FONTSIZE=INT_015*9    
       THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(GL='*',.T.,.F.)   &&判斷有無新增的權限
       THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(GP='*',.T.,.F.)   &&判斷有無列印的權限
       THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(RECCOUNT('C22')=0,.F.,.T.) 
       THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(RECCOUNT('C22')=0,.F.,.T.)          
       THISFORM.SETALL('HEIGHT',INT_015*25,'TEXTBOX')
       THISFORM.SETALL('HEIGHT',INT_015*17,'LABEL')
       THISFORM.SETALL('FONTSIZE',INT_015*9,'TEXTBOX')
       THISFORM.SETALL('FONTSIZE',INT_015*9,'LABEL')       
       THISFORM.SETALL('READONLY',.T.,'TEXTBOX')
       
       THISFORM.SHRGROUP.VISIBLE=.F.
       THISFORM.SHRGROUP.ENABLED=.F.
       THISFORM.GRID1.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)
       THISFORM.GRID2.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'COLUMN')
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'HEADER')          
       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='INVOICE單號'
       THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='客戶編號'
       THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='出貨單號'
       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='C22.F01'
       THISFORM.GRID1.COLUMN2.CONTROLSOURCE='C22.F03'
       THISFORM.GRID1.COLUMN3.CONTROLSOURCE='C22.F04'
       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*80
       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*50
       THISFORM.GRID1.COLUMN3.WIDTH=INT_015*80
       THISFORM.GRID2.SETALL('FONTSIZE',INT_015*9,'COLUMN')
       THISFORM.GRID2.SETALL('FONTSIZE',INT_015*9,'HEADER')
       THISFORM.GRID2.COLUMN1.HEADER1.CAPTION='品號'  
       THISFORM.GRID2.COLUMN2.HEADER1.CAPTION='數量'
       THISFORM.GRID2.COLUMN3.HEADER1.CAPTION='單價'
       THISFORM.GRID2.COLUMN4.HEADER1.CAPTION='小計'
       THISFORM.GRID2.COLUMN5.HEADER1.CAPTION='幣別'
       THISFORM.GRID2.COLUMN6.HEADER1.CAPTION='客戶P/O'       
       THISFORM.GRID2.COLUMN7.HEADER1.CAPTION='客戶品號'
       THISFORM.GRID2.COLUMN1.CONTROLSOURCE='C23.F02'
       THISFORM.GRID2.COLUMN2.CONTROLSOURCE='C23.F03'
       THISFORM.GRID2.COLUMN3.CONTROLSOURCE='C23.F04'
       THISFORM.GRID2.COLUMN4.CONTROLSOURCE='C23.F03*C23.F04'
       THISFORM.GRID2.COLUMN5.CONTROLSOURCE='C23.F07'
       THISFORM.GRID2.COLUMN6.CONTROLSOURCE='C23.F06'
       THISFORM.GRID2.COLUMN7.CONTROLSOURCE='C23.F05'       
       THISFORM.GRID2.COLUMN1.WIDTH=INT_015*249
       THISFORM.GRID2.COLUMN2.WIDTH=INT_015*60
       THISFORM.GRID2.COLUMN3.WIDTH=INT_015*70
       THISFORM.GRID2.COLUMN4.WIDTH=INT_015*90
       THISFORM.GRID2.COLUMN5.WIDTH=INT_015*30
       THISFORM.GRID2.COLUMN6.WIDTH=INT_015*200
       THISFORM.GRID2.COLUMN7.WIDTH=INT_015*150
       THISFORM.GRID1.READONLY=.T.      
       THISFORM.GRID2.READONLY=.T.            
       THISFORM.GRID1.SETFOCUS
       IF THISFORM.GRID1.ACTIVEROW=0
            THISFORM.CMDGROUP.ENABLED=.F.
            THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
            THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
            THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
            THISFORM.TRN_BOTT.ENABLED=.F. 
       ELSE
             THISFORM.CMDGROUP.ENABLED=.T. 
             THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(GM='*',.T.,.F.)  &&判斷有無修改的權限
             THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(GN='*',.T.,.F.)   &&判斷有無刪除的權限 
             THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(GP='*',.T.,.F.)   &&判斷有無列印的權限      
             THISFORM.TRN_BOTT.ENABLED=IIF(SEEK(C22.F04,'C28'),.F.,.T.)&&判斷是否有轉PACKING LIST的權限
       ENDIF          
       THISFORM.KEY_LIST.DISPLAYVALUE='依INVOICE單號排列'       
       JK='INVOICE單號'
       SELE C22
*!*	       THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=C22.F01
*!*	       GO TOP
       GO BOTTOM
  ENDPROC            
***************GRID1動態改變*********
 PROC GRID1.AFTERROWCOLCHANGE
       LPARAMETERS NCOLINDEX 
       THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=C22.F01
       THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE=C22.F02
       THISFORM.PAGEFRAME1.PAGE1.TXTF03.VALUE=C22.F03
       THISFORM.PAGEFRAME1.PAGE1.LBLF031.CAPTION=IIF(SEEK(ALLTRIM(THISFORM.PAGEFRAME1.PAGE1.TXTF03.VALUE),'C01'),C01.F05,'')
       THISFORM.PAGEFRAME1.PAGE1.TXTF04.VALUE=C22.F04
       THISFORM.PAGEFRAME1.PAGE1.TXTF05.VALUE=C22.F05
       THISFORM.PAGEFRAME1.PAGE1.TXTF06.VALUE=C22.F06
       THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE=C22.F07
       THISFORM.PAGEFRAME1.PAGE1.TXTF08.VALUE=C22.F08
       THISFORM.PAGEFRAME1.PAGE1.TXTF09.VALUE=C22.F09
       THISFORM.PAGEFRAME1.PAGE1.TXTF10.VALUE=C22.F10
       THISFORM.PAGEFRAME1.PAGE1.TXTF11.VALUE=C22.F11
       THISFORM.PAGEFRAME1.PAGE1.TXTF12.VALUE=C22.F12
       THISFORM.PAGEFRAME1.PAGE1.TXTF14.VALUE=C22.F14
       THISFORM.PAGEFRAME1.PAGE1.TXTF15.VALUE=C22.F15
       THISFORM.PAGEFRAME1.PAGE1.TXTF16.VALUE=C22.F16
       THISFORM.PAGEFRAME1.PAGE1.TXTF17.VALUE=C22.F17
       THISFORM.PAGEFRAME1.PAGE1.TXTF18.VALUE=C22.F18
       THISFORM.PAGEFRAME1.PAGE1.LBLF131.CAPTION=C22.F13
       THISFORM.TRN_BOTT.ENABLED=IIF(SEEK(C22.F04,'C28'),.F.,.T.)&&判斷是否有轉出PACKING LIST的權限
       FCH=THISFORM.ACTIVECONTROL.NAME
       JK=THIS.COLUMN1.HEADER1.CAPTION
       IF THIS.ACTIVEROW=0
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
          THISFORM.TRN_BOTT.ENABLED=.F.
       ELSE
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T. 
          THISFORM.TRN_BOTT.ENABLED=IIF(SEEK(C22.F04,'C28'),.F.,.T.)&&判斷是否有轉PACKING LIST的權限
       ENDIF   
       CHK=''
*!*	       THISFORM.REFRESH
  ENDPROC     
***************GRID2動態改變*************** 
PROC GRID2.AFTERROWCOLCHANGE
      LPARAMETERS NCOLINDEXIIF
       THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE=C23.F02
       THISFORM.PAGEFRAME1.PAGE2.LBLF021.CAPTION=C23.F09
       THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=C23.F03
       THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE=C23.F04
       THISFORM.PAGEFRAME1.PAGE2.LBLF341.CAPTION=TRANSFORM(C23.F03*C23.F04,'99999999999.99')
       THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE=C23.F05
       THISFORM.PAGEFRAME1.PAGE2.TXTF06.VALUE=C23.F06
       THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE=C23.F07
       THISFORM.PAGEFRAME1.PAGE2.TXTF19.VALUE=C23.F19
       THISFORM.PAGEFRAME1.PAGE2.TXTF13.VALUE=C23.F13
       THISFORM.PAGEFRAME1.PAGE2.LBLF081.CAPTION=C23.F08
       THISFORM.PAGEFRAME1.PAGE2.TXTFEX.VALUE=C24.F04
       FCH=THISFORM.ACTIVECONTROL.NAME
       JK=THIS.COLUMN1.HEADER1.CAPTION
       CHK=THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
       IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
          THISFORM. CMDGROUP.SEEK_BOTT.ENABLED=.F.
          THISFORM.TRN_BOTT.ENABLED=.F.
       ENDIF
*!*	       THISFORM.REFRESH   
  ENDPROC 
**************************************            
 PROC KEY_LIST.INIT 
       WITH THIS
           .ADDITEM('依INVOICE單號排列') 
           .ADDITEM('依客戶編號排列')
           .ADDITEM('依出貨單號排列')
       ENDWITH      
  ENDPROC  
****************************  
PROC KEY_LIST.INTERACTIVECHANGE                 
  SELE C22
       DO CASE
          CASE THIS.DISPLAYVALUE='依INVOICE單號排列'
                SET ORDER TO C221
               THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='INVOICE單號'
               THISFORM.GRID1.COLUMN1.CONTROLSOURCE='C22.F01'
               THISFORM.GRID1.COLUMN1.WIDTH=INT_015*80
               THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='客戶編號'
               THISFORM.GRID1.COLUMN2.CONTROLSOURCE='C22.F03'
               THISFORM.GRID1.COLUMN2.WIDTH=INT_015*50
               THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='出貨單號'
               THISFORM.GRID1.COLUMN3.CONTROLSOURCE='C22.F04'
               THISFORM.GRID1.COLUMN3.WIDTH=INT_015*80                 
       	  CASE THIS.DISPLAYVALUE='依客戶編號排列'
                SET ORDER TO C222
               THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='客戶編號'
               THISFORM.GRID1.COLUMN1.CONTROLSOURCE='C22.F03'
               THISFORM.GRID1.COLUMN1.WIDTH=INT_015*50
               THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='INVOICE單號'
               THISFORM.GRID1.COLUMN2.CONTROLSOURCE='C22.F01'
               THISFORM.GRID1.COLUMN2.WIDTH=INT_015*80
               THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='出貨單號'
               THISFORM.GRID1.COLUMN3.CONTROLSOURCE='C22.F04'
               THISFORM.GRID1.COLUMN3.WIDTH=INT_015*80                 
       	  CASE THIS.DISPLAYVALUE='依出貨單號排列'
                SET ORDER TO C223
               THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='出貨單號'
               THISFORM.GRID1.COLUMN1.CONTROLSOURCE='C22.F04'
               THISFORM.GRID1.COLUMN1.WIDTH=INT_015*80
               THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='INVOICE單號'
               THISFORM.GRID1.COLUMN2.CONTROLSOURCE='C22.F01'
               THISFORM.GRID1.COLUMN2.WIDTH=INT_015*80
               THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='客戶編號'
               THISFORM.GRID1.COLUMN3.CONTROLSOURCE='C22.F03'
               THISFORM.GRID1.COLUMN3.WIDTH=INT_015*50             
       	ENDCASE
       	THISFORM.GRID1.SETFOCUS     
  ENDPROC
**************新增鍵******************  
PROCEDURE ORPGROUP.NEW_BOTT.CLICK 
     THISFORM.KEY_LIST.ENABLED=.F.
     THISFORM.TRN_BOTT.ENABLED=.F. 
   IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
       THISFORM.GRID2.RECORDSOURCE=''   &&處理表頭新增
       THISFORM.GRID2.CHILDORDER=''
        THISFORM.GRID1.ENABLED=.F.   
        THISFORM.GRID2.ENABLED=.F.    
       THISFORM.PAGEFRAME1.PAGE1.SETALL('READONLY',.F.,'TEXTBOX')  
       THISFORM.PAGEFRAME1.PAGE2.ENABLED=.F.
          HD='C022 '+SUBSTR(DTOS(DATE()),3,4)
          DO ODR_CRT
       THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=PO_NO
       THISFORM.PAGEFRAME1.PAGE1.TXTF01.REFRESH    		    
       THISFORM.PAGEFRAME1.PAGE1.TXTF01.READONLY=.T.		                          
       THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE=DATE()
       THISFORM.PAGEFRAME1.PAGE1.TXTF03.READONLY=.F.
       THISFORM.PAGEFRAME1.PAGE1.TXTF03.VALUE=''
       THISFORM.PAGEFRAME1.PAGE1.LBLF031.CAPTION=''
       THISFORM.PAGEFRAME1.PAGE1.TXTF04.READONLY=.F.
       THISFORM.PAGEFRAME1.PAGE1.TXTF04.SETFOCUS
       THISFORM.PAGEFRAME1.PAGE1.TXTF04.VALUE=''
       THISFORM.PAGEFRAME1.PAGE1.TXTF05.VALUE=''
       THISFORM.PAGEFRAME1.PAGE1.TXTF06.VALUE=''
       THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE=DATE()
       THISFORM.PAGEFRAME1.PAGE1.TXTF08.VALUE=''
       THISFORM.PAGEFRAME1.PAGE1.TXTF09.VALUE=''
       THISFORM.PAGEFRAME1.PAGE1.TXTF10.VALUE='TOK'
       THISFORM.PAGEFRAME1.PAGE1.TXTF11.VALUE='TAIWAN'
       THISFORM.PAGEFRAME1.PAGE1.TXTF12.VALUE=''
       THISFORM.PAGEFRAME1.PAGE1.TXTF14.VISIBLE=.F.
       THISFORM.PAGEFRAME1.PAGE1.TXTF14.VALUE=THISFORM.PAGEFRAME1.PAGE1.FROM14.DISPLAYVALUE
       THISFORM.PAGEFRAME1.PAGE1.FROM14.VISIBLE=.T.
       THISFORM.PAGEFRAME1.PAGE1.FROM14.VALUE=1
       THISFORM.PAGEFRAME1.PAGE1.TXTF15.VALUE=''
       THISFORM.PAGEFRAME1.PAGE1.TXTF16.VALUE=''
       THISFORM.PAGEFRAME1.PAGE1.TXTF17.VALUE=''
       THISFORM.PAGEFRAME1.PAGE1.TXTF18.VALUE=''
       THISFORM.PAGEFRAME1.PAGE1.LBLF131.CAPTION=''
    ELSE
    	THISFORM.PAGEFRAME1.PAGE1.ENABLED=.F.              &&處理表身新增
        THISFORM.GRID2.ENABLED=.F.
        THISFORM.PAGEFRAME1.PAGE2.SETALL('READONLY',.F.,'TEXTBOX')
        THISFORM.PAGEFRAME1.PAGE2.TXTF02.READONLY=.F.
        THISFORM.PAGEFRAME1.PAGE2.TXTF02.SETFOCUS 
        THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE=''
        THISFORM.PAGEFRAME1.PAGE2.LBLF021.CAPTION=''
        THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=0
        THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE=0
        THISFORM.PAGEFRAME1.PAGE2.LBLF341.CAPTION=TRANSFORM(0,'999999999999.99')
        THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE=''
        THISFORM.PAGEFRAME1.PAGE2.TXTF06.VALUE=''
        THISFORM.PAGEFRAME1.PAGE2.TXTF19.VALUE=''
        THISFORM.PAGEFRAME1.PAGE2.TXTF13.VALUE=''
        THISFORM.PAGEFRAME1.PAGE2.TXTF07.VISIBLE=.F.
        THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE=THISFORM.PAGEFRAME1.PAGE2.CRCY.DISPLAYVALUE
        THISFORM.PAGEFRAME1.PAGE2.CRCY.VISIBLE=.T.
        THISFORM.PAGEFRAME1.PAGE2.CRCY.DISPLAYVALUE='US'
        THISFORM.PAGEFRAME1.PAGE2.LBLF081.CAPTION=''
    ENDIF  
ENDPROC 
***********************新增之確認******************** 
PROCEDURE SHRGROUP.SHURE1_BOTT.CLICK
IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1 
    THISFORM.GRID2.RECORDSOURCE='C23'
    THISFORM.GRID2.CHILDORDER='C231'
    THISFORM.GRID2.COLUMN1.CONTROLSOURCE='C23.F02'
    THISFORM.GRID2.COLUMN2.CONTROLSOURCE='C23.F03'
    THISFORM.GRID2.COLUMN3.CONTROLSOURCE='C23.F04'
    THISFORM.GRID2.COLUMN4.CONTROLSOURCE='C23.F03*C23.F04'
    THISFORM.GRID2.COLUMN5.CONTROLSOURCE='C23.F07'
    THISFORM.GRID2.COLUMN6.CONTROLSOURCE='C23.F05'
    THISFORM.GRID2.COLUMN7.CONTROLSOURCE='C23.F06'
    SELECT C22
    COD=SYS(21)
    SET ORDER TO C221
    IF SEEK(THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE,'C22')=.T.   &&若有發生單號重複
         SELE MAX(F01) FROM C22 INTO ARRAY GB NOWAIT
         HD='C022 '+SUBSTR(DTOS(DATE()),3,4)+THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
         DO ODR_RPT
		 THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=PO_NO
		 THISFORM.PAGEFRAME1.PAGE1.TXTF01.REFRESH                                          
      ENDIF     
 **********      
      IF  SEEK(THISFORM.PAGEFRAME1.PAGE1.TXTF03.VALUE,'C01')=.F. .OR. EMPTY(THISFORM.PAGEFRAME1.PAGE1.TXTF03.VALUE)
  	   =MESSAGEBOX('客戶基本主檔中無此編號請先建立!',0+64,'提示訊息視窗')
  	   THISFORM.PAGEFRAME1.PAGE1.TXTF03.SETFOCUS
  	   THISFORM.GRID2.RECORDSOURCE=''  
   	   THISFORM.GRID2.CHILDORDER=''
  	   SET ORDER TO &COD
  	   RETURN       		
      ENDIF    											
 **********  出貨單號欄位為出貨單號時    
 IF   LEFT(ALLTRIM(THISFORM.PAGEFRAME1.PAGE1.TXTF04.VALUE),2)='BC'  .AND.  LEN(ALLTRIM(THISFORM.PAGEFRAME1.PAGE1.TXTF04.VALUE))=10
          S1='20'+SUBSTR(ALLTRIM(THISFORM.PAGEFRAME1.PAGE1.TXTF04.VALUE),3,2)&&B04檔名之年份
     	  S2=SUBSTR(ALLTRIM(THISFORM.PAGEFRAME1.PAGE1.TXTF04.VALUE),5,2)&&B04檔名之月份
     	  B04='B04'+S1+S2 &&出貨單
	   IF FILE(B04+'.DBF')=.T.
       	  IF USED('&B04')
          	        SELE B04
                   ELSE
                   	SELE 0 
                    USE (B04) ALIA B04
                   ENDIF
                   SET ORDER TO 1
           ELSE
		         =MESSAGEBOX('無'+S1+'年'+S2+'月份之出貨單,請查明後再輸入!',0+64,'提示訊息視窗')
		        THISFORM.PAGEFRAME1.PAGE1.TXTF04.SETFOCUS
          	    THISFORM.GRID2.RECORDSOURCE=''  
       		    THISFORM.GRID2.CHILDORDER=''
		        RETURN
          ENDIF
          SELECT C22
          SET ORDER TO C223
       IF SEEK(THISFORM.PAGEFRAME1.PAGE1.TXTF04.VALUE,'C22')=.T. 	&&判斷此出貨單號是否已重複開單過
              =MESSAGEBOX('此出貨單號已開過INVOICE請重新確認!',0+48,'提示訊息視窗')
	      THISFORM.PAGEFRAME1.PAGE1.TXTF04.SETFOCUS
	      THISFORM.GRID2.RECORDSOURCE=''  
       	      THISFORM.GRID2.CHILDORDER=''
       	      SELE C22
       	      SET ORDER TO C221
       	      SELE B04
       	      USE
             RETURN
      ENDIF 
       IF SEEK(ALLTRIM(THISFORM.PAGEFRAME1.PAGE1.TXTF04.VALUE),'B04')=.F. &&判斷此出貨單號是否存在
            MESSAGEBOX('查無此出貨單號!',0+48,'提示訊息視窗')
	    THISFORM.PAGEFRAME1.PAGE1.TXTF04.SETFOCUS
	    THISFORM.GRID2.RECORDSOURCE=''  
       	    THISFORM.GRID2.CHILDORDER=''
       	    SELE C22
       	    SET ORDER TO C221
       	    SELE B04
            USE
            RETURN  
       ENDIF
       IF IIF(SEEK(THISFORM.PAGEFRAME1.PAGE1.TXTF04.VALUE,'B04'),B04.F06,'')<>THISFORM.PAGEFRAME1.PAGE1.TXTF03.VALUE  &&判斷該出貨單之客戶編號是否為該INVOICE之客戶編號
            =MESSAGEBOX('您所輸入的客戶編號,與此出貨單之客戶編號不符!',0+48,'提示訊息視窗')
	    THISFORM.PAGEFRAME1.PAGE1.TXTF03.SETFOCUS
	    THISFORM.GRID2.RECORDSOURCE=''  
       	    THISFORM.GRID2.CHILDORDER=''
       	    SELE C22
       	    SET ORDER TO C221
      	    SELE B04
     	    USE
            RETURN
        ENDIF 
        SELECT F01,F03,F04,F06,F07,F14,F15,F79 FROM B04 WHERE F01=ALLTRIM(THISFORM.PAGEFRAME1.PAGE1.TXTF04.VALUE)  INTO CURSOR B04A
        SELECT B04A
  	    GO TOP
        DO WHILE !EOF()
	       SELECT C23			&&帶入出貨單至表身C23
	       APPEND BLANK
	       REPLACE F01 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
	       REPLACE F02 WITH B04A.F03
	       REPLACE F03 WITH B04A.F04
	       REPLACE F04 WITH B04A.F15
	       REPLACE F05 WITH IIF(SEEK(B04A.F07+B04A.F03,'C04'),C04.F17,'')  &&客戶品號
	       REPLACE F06 WITH IIF(SEEK(B04A.F07,'C03'),C03.F14,'') &&PO/NO
	       REPLACE F07 WITH B04A.F14
	       REPLACE F08 WITH DTOC(DATE())+' '+GSYS
	       REPLACE F09 WITH IIF(SEEK(B04A.F07+B04A.F03,'C04'),C04.F25,'')  &&客戶指定品名規格
	       REPLACE F79 WITH B04A.F79
	       SELECT B04A
               SKIP
        ENDDO
        SELE C22
        APPEND BLANK
        LOCK()
        IF  RLOCK()			&&寫入至表頭C22
             REPLACE F01 WITH PO_NO
             REPLACE F02 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE
             REPLACE F03 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF03.VALUE
             REPLACE F04 WITH ALLTRIM(THISFORM.PAGEFRAME1.PAGE1.TXTF04.VALUE)
             REPLACE F05 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF05.VALUE
    	     REPLACE F06 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF06.VALUE
    	     REPLACE F07 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE
    	     REPLACE F08 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF08.VALUE
    	     REPLACE F09 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF09.VALUE
    	     REPLACE F10 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF10.VALUE
    	     REPLACE F11 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF11.VALUE
    	     REPLACE F12 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF12.VALUE
    	     REPLACE F14 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF14.VALUE
    	     REPLACE F15 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF15.VALUE
    	     REPLACE F16 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF16.VALUE
    	     REPLACE F17 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF17.VALUE
    	     REPLACE F18 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF18.VALUE
    	     REPLACE F13 WITH DTOC(DATE())+' '+GSYS
	ENDIF
    	UNLOCK
    	SELECT B04 
	USE 
	SELE C22
	SET ORDER TO C221  
	THISFORM.PAGEFRAME1.PAGE1.ENABLED=.T.
   	THISFORM.PAGEFRAME1.PAGE2.ENABLED=.F. 
   	THISFORM.ORPGROUP.NEW_BOTT.CLICK
   	THISFORM.REFRESH
    ELSE  &&出貨單號為空白或非出貨單號之編號
           SELE C22
   	   APPEND BLANK
   	   LOCK()
          IF  RLOCK()			&&寫入至表頭C22
                REPLACE F01 WITH PO_NO
                REPLACE F02 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE
                REPLACE F03 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF03.VALUE
	            REPLACE F04 WITH ALLTRIM(THISFORM.PAGEFRAME1.PAGE1.TXTF04.VALUE)
    	        REPLACE F05 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF05.VALUE
    	        REPLACE F06 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF06.VALUE
    	        REPLACE F07 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE
    	        REPLACE F08 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF08.VALUE
    	        REPLACE F09 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF09.VALUE
    	        REPLACE F10 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF10.VALUE
    	        REPLACE F11 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF11.VALUE
    	        REPLACE F12 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF12.VALUE
    	        REPLACE F14 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF14.VALUE
    	        REPLACE F15 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF15.VALUE
    	        REPLACE F16 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF16.VALUE
    	        REPLACE F17 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF17.VALUE
    	        REPLACE F18 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF18.VALUE
    	        REPLACE F13 WITH DTOC(DATE())+' '+GSYS
    	ENDIF
	UNLOCK
        THISFORM.PAGEFRAME1.PAGE1.ENABLED=.F.
        THISFORM.PAGEFRAME1.PAGE2.ENABLED=.T.  
        THISFORM.PAGEFRAME1.ACTIVEPAGE=2
        THISFORM.ORPGROUP.NEW_BOTT.CLICK
   	THISFORM.REFRESH
   ENDIF
  ******************** 	   
   ELSE   &&表身新增
    	  IF EMPTY(THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE)     
                       =MESSAGEBOX('料品編號不得空白!',0+64,'提示視窗')
      		      THISFORM.PAGEFRAME1.PAGE2.TXTF02.SETFOCUS
                      RETURN  
          ENDIF  
          IF EMPTY(THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE)     
                       =MESSAGEBOX('數量不得為零!',0+64,'提示視窗')
      		      THISFORM.PAGEFRAME1.PAGE2.TXTF03.SETFOCUS
                      RETURN  
          ENDIF 
          IF EMPTY(THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE)     
                       =MESSAGEBOX('單價不得為零!',0+64,'提示視窗')
      		      THISFORM.PAGEFRAME1.PAGE2.TXTF04.SETFOCUS
                      RETURN  
          ENDIF 
  	  SELE C23
          APPEND BLANK
          LOCK()
          IF RLOCK()
              REPLACE F01 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
              REPLACE F02 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE
              REPLACE F03 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE
              REPLACE F04 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE
              REPLACE F05 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE
              REPLACE F06 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF06.VALUE
              REPLACE F07 WITH THISFORM.PAGEFRAME1.PAGE2.CRCY.DISPLAYVALUE
              REPLACE F08 WITH  DTCX(DATE())+GSYS
              REPLACE F09 WITH IIF(SEEK(THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE,'B01'),B01.F02,'')
              REPLACE F19 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF19.VALUE
              REPLACE F13 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF13.VALUE
              REPLACE F79 WITH F02
              IF !EMPTY(THISFORM.PAGEFRAME1.PAGE2.TXTFEX.VALUE)
                  SELECT C24
                  APPEND BLANK
                  REPLACE F01 WITH C23.F01
                  REPLACE F02 WITH C23.F02
                  REPLACE F03 WITH C23.F06
                  REPLACE F04 WITH THISFORM.PAGEFRAME1.PAGE2.TXTFEX.VALUE
                  REPLACE F05 WITH C22.F04
                 SELECT C23
              ENDIF
              seek thisform.pageframe1.page1.txtf01.value+thisform.pageframe1.page2.txtf02.value 
              THISFORM.GRID2.SETFOCUS
              THISFORM.ORPGROUP.NEW_BOTT.CLICK
              THISFORM.REFRESH
              UNLOCK
          ENDIF  
          UNLOCK
   ENDIF      
 ENDPROC
 *****************修改***********
PROCEDURE ORPGROUP.EDIT_BOTT.CLICK
    THISFORM.KEY_LIST.ENABLED=.F.
    THISFORM.TRN_BOTT.ENABLED=.F. 
    THISFORM.GRID1.ENABLED=.F. 
    THISFORM.GRID2.ENABLED=.F. 
     IF    THISFORM.PAGEFRAME1.ACTIVEPAGE=1
            THISFORM.PAGEFRAME1.PAGE2.ENABLED=.F. 
	    THISFORM.SETALL('READONLY',.F.,'TEXTBOX')
	    THISFORM.PAGEFRAME1.PAGE1.TXTF01.READONLY=.T.
	    THISFORM.PAGEFRAME1.PAGE1.TXTF03.READONLY=.F.
	    THISFORM.PAGEFRAME1.PAGE1.TXTF03.SETFOCUS
	    THISFORM.PAGEFRAME1.PAGE1.LBLF031.CAPTION=IIF(SEEK(ALLTRIM(THISFORM.PAGEFRAME1.PAGE1.TXTF03.VALUE),'C01'),C01.F05,'')
	    THISFORM.PAGEFRAME1.PAGE1.TXTF04.READONLY=.F.
	    THISFORM.PAGEFRAME1.PAGE1.TXTF14.VISIBLE=.F.
	    THISFORM.PAGEFRAME1.PAGE1.FROM14.VISIBLE=.T.
            THISFORM.PAGEFRAME1.PAGE1.FROM14.DISPLAYVALUE=THISFORM.PAGEFRAME1.PAGE1.TXTF14.VALUE     
	    THISFORM.PAGEFRAME1.PAGE1.LBLF131.CAPTION=''
	    LOCK()
	    IF !RLOCK()
	         DO FILE_IMPACT
	         RETURN
	    ENDIF 
   ELSE
    	THISFORM.PAGEFRAME1.PAGE1.ENABLED=.F.
        THISFORM.PAGEFRAME1.PAGE2.SETALL('READONLY',.F.,'TEXTBOX')
        
        THISFORM.PAGEFRAME1.PAGE2.TXTF02.READONLY=.F.
        THISFORM.PAGEFRAME1.PAGE2.TXTF02.SETFOCUS
        THISFORM.PAGEFRAME1.PAGE2.CRCY.VISIBLE=.T.
	     THISFORM.PAGEFRAME1.PAGE2.CRCY.DISPLAYVALUE=THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE    
    	 LOCK()     
         IF !RLOCK()
              DO FILE_IMPACT
              RETURN
         ENDIF          
   ENDIF                  	                  	                                               	                            
 ENDPROC 
 *****************修改之確認***********
 PROCEDURE SHRGROUP.SHURE2_BOTT.CLICK 
 IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
      SELECT C22&&表頭修改確認
      IF  RLOCK() 
            IF SEEK(THISFORM.PAGEFRAME1.PAGE1.TXTF03.VALUE,'C01')=.F. .OR. EMPTY(THISFORM.PAGEFRAME1.PAGE1.TXTF03.VALUE)
                =MESSAGEBOX('客戶基本主檔中無此編號請先建立!',0+64,'提示訊息視窗')
	       THISFORM.PAGEFRAME1.PAGE1.TXTF03.SETFOCUSS
               SET ORDER TO &COD
               RETURN            
          ENDIF
	  REPLACE F02 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE
	  REPLACE F03 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF03.VALUE
	  REPLACE F04 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF04.VALUE
	  REPLACE F05 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF05.VALUE
	  REPLACE F06 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF06.VALUE
	  REPLACE F07 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE
	  REPLACE F08 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF08.VALUE
	  REPLACE F09 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF09.VALUE
	  REPLACE F10 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF10.VALUE
	  REPLACE F11 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF11.VALUE
	  REPLACE F12 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF12.VALUE
	  REPLACE F14 WITH THISFORM.PAGEFRAME1.PAGE1.FROM14.DISPLAYVALUE
	  REPLACE F15 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF15.VALUE
	  REPLACE F16 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF16.VALUE
	  REPLACE F17 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF17.VALUE
	  REPLACE F18 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF18.VALUE
	  REPLACE F13 WITH DTOC(DATE())+' '+GSYS
     ELSE 
         DO     FILE_IMPACT
         RETURN
      ENDIF
  ELSE        &&表身修改確認 
       IF EMPTY(THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE)     
            =MESSAGEBOX('料品編號不得空白!',0+64,'提示視窗')
      	   THISFORM.PAGEFRAME1.PAGE2.TXTF02.SETFOCUS
           RETURN  
      ENDIF
      IF EMPTY(THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE)     
          =MESSAGEBOX('數量不得為零!',0+64,'提示視窗')
  	  THISFORM.PAGEFRAME1.PAGE2.TXTF03.SETFOCUS
          RETURN  
      ENDIF 
      IF EMPTY(THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE)     
          =MESSAGEBOX('單價不得為零!',0+64,'提示視窗')
  	  THISFORM.PAGEFRAME1.PAGE2.TXTF04.SETFOCUS
          RETURN  
      ENDIF  
      SELE C23
          IF  RLOCK()
               REPLACE F02 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE
               REPLACE F03 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE
               REPLACE F04 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE
               REPLACE F05 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE
               REPLACE F06 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF06.VALUE
               REPLACE F13 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF13.VALUE
               REPLACE F07 WITH THISFORM.PAGEFRAME1.PAGE2.CRCY.DISPLAYVALUE
               REPLACE F08 WITH DTOC(DATE())+' '+GSYS
               REPLACE F19 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF19.VALUE
               REPLACE F79 WITH F02
               IF !EMPTY(THISFORM.PAGEFRAME1.PAGE2.TXTFEX.VALUE)
                  SELECT C24
                  SEEK C23.F01+C23.F02+C23.F06
                  IF !FOUND()
                     APPEND BLANK
                     REPLACE F01 WITH C23.F01
                     REPLACE F02 WITH C23.F02
                     REPLACE F03 WITH C23.F06
                     REPLACE F05 WITH C22.F04
                  ENDIF
                  REPLACE F04 WITH THISFORM.PAGEFRAME1.PAGE2.TXTFEX.VALUE
               ELSE
                  DELETE FROM C24 WHERE C24.F01=C22.F01 AND C24.F02=C23.F02 AND C24.F03=C23.F06   
               ENDIF
               SELECT C23
          ELSE 
         	DO  FILE_IMPACT
         	RETURN
      	  ENDIF
  ENDIF    	      
 THISFORM.SHRGROUP.ABANDON_BOTT.CLICK   
ENDPROC             	             
 *****************刪除***********
PROCEDURE ORPGROUP.DEL_BOTT.CLICK
 IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1     
      IF MESSAGEBOX('是否確定要刪除此筆之所有資料',4+32+256,'請確認')=6
         IF ALIA()='C22'           &&刪除整張訂單
           SELECT C22
	   LOCK()
	   IF  RLOCK()
	        PO_NO=ALLTRIM(C22.F01)
	        DELETE FROM C24 WHERE C24.F01=PO_NO
	        DELETE FROM C23 WHERE C23.F01=PO_NO
	       
      	        DELE
                UNLOCK
                SKIP -1
                IF BOF()
                    GO TOP
                ENDIF
                UNLOCK ALL
                IF INT_099=.T. .AND. SUBSTR(PO_NO,3,4)=SUBSTR(DTOS(DATE()),3,4)   &&將刪除的單號丟回去A24                      
                    HD='C022 '+SUBSTR(DTOS(DATE()),3,4)+PO_NO
                    DO ODR_RJT
                ENDIF  
          ELSE
                 DO FILE_IMPACT                  
          ENDIF
          THISFORM.GRID1.SETFOCUS
          IF  THISFORM.GRID1.ACTIVEROW=0
                THISFORM.SETALL('VALUE','','TEXTBOX')
                THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
                THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
                THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
                THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
                THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
                THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
                THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
         ELSE
                THISFORM.CMDGROUP.ENABLED=.T. 
                THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(GM='*',.T.,.F.)  &&判斷有無修改的權限
                THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(GN='*',.T.,.F.)   &&判斷有無刪除的權限 
                THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(GP='*',.T.,.F.)   &&判斷有無列印的權限     
        ENDIF
   ENDIF
  ENDIF 
 ELSE  &&刪除單筆資料
    IF  MESSAGEBOX('是否確定要刪除此料品編號之所有資料',4+32+256,'請確認')=6 
        SELE C23 
        LOCK()
        IF  RLOCK()
            DELETE FROM C24 WHERE F01+F02+F03=C22.F01+C23.F02+C23.F06
            SELECT C23
             DELE
             UNLOCK
             SKIP -1
             IF   BOF()
                   GO TOP
             ENDIF
        ELSE
            DO FILE_IMPACT    
        ENDIF         
        THISFORM.GRID2.SETFOCUS
        IF THISFORM.GRID2.ACTIVEROW=0
             THISFORM.PAGEFRAME1.PAGE2.SETALL('VALUE','','TEXTBOX')
             THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
             THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
             THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
             THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
             THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
             THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
             THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
        ELSE
             THISFORM.CMDGROUP.ENABLED=.T. 
             THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(GM='*',.T.,.F.)  &&判斷有無修改的權限
             THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(GN='*',.T.,.F.)   &&判斷有無刪除的權限
             THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(GP='*',.T.,.F.)   &&判斷有無列印的權限
        ENDIF
     ENDIF           
  ENDIF    
ENDPROC 
**************************放棄***************
PROCEDURE SHRGROUP.ABANDON_BOTT.CLICK
      THISFORM.SHRGROUP.ENABLED=.F.
      THISFORM.SHRGROUP.VISIBLE=.F.      
      THISFORM.ORPGROUP.ENABLED=.T.
      THISFORM.CMDGROUP.ENABLED=.T.
      THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(GL='*',.T.,.F.)   &&判斷有無新增的權限
      THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(GM='*',.T.,.F.)  &&判斷有無修改的權限
      THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(GN='*',.T.,.F.)   &&判斷有無刪除的權限
      THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(GP='*',.T.,.F.)   &&判斷有無列印的權限
      THISFORM.ORPGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
      THISFORM.CMDGROUP.SETALL('ENABLED',.T.,'COMMANDBUTTON')
      THISFORM.CMDGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
      THISFORM.SETALL('READONLY',.T.,'TEXTBOX')
      THISFORM.PAGEFRAME1.PAGE1.SETALL('READONLY',.T.,'TEXTBOX')  
      THISFORM.PAGEFRAME1.PAGE2.SETALL('READONLY',.T.,'TEXTBOX')
      
      THISFORM.PAGEFRAME1.PAGE1.ENABLED=.T.
      THISFORM.PAGEFRAME1.PAGE2.ENABLED=.T.
      THISFORM.PAGEFRAME1.PAGE1.FROM14.VISIBLE=.F.
      THISFORM.PAGEFRAME1.PAGE1.TXTF14.VISIBLE=.T.
      THISFORM.PAGEFRAME1.PAGE1.TXTF03.READONLY=.T.
      THISFORM.PAGEFRAME1.PAGE1.TXTF04.READONLY=.T.
      THISFORM.PAGEFRAME1.PAGE2.TXTF02.READONLY=.T.       
     IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
        THISFORM.TRN_BOTT.ENABLED=IIF(SEEK(C22.F04,'C28'),.F.,.T.)&&判斷是否有轉出PACKING LIST的權限    
        THISFORM.KEY_LIST.ENABLED=.T.
        THISFORM.GRID1.ENABLED=.T.
        THISFORM.GRID2.ENABLED=.T.
        THISFORM.GRID1.SETFOCUS 
      ELSE
	       THISFORM.GRID1.ENABLED=.F.
	       THISFORM.GRID2.ENABLED=.T.
           THISFORM.PAGEFRAME1.PAGE2.TXTF07.VISIBLE=.T.
           THISFORM.PAGEFRAME1.PAGE2.CRCY.VISIBLE=.F.
           THISFORM.GRID2.SETFOCUS
            IF THISFORM.GRID2.ACTIVEROW=0
               IF INT_099=.T. .AND. SUBSTR(PO_NO,3,4)=SUBSTR(DTOS(DATE()),3,4)   &&將刪除的單號丟回去A24                      
                   HD='C022 '+SUBSTR(DTOS(DATE()),3,4)+PO_NO
                   DO ODR_RJT
               ENDIF              
                 SELE C22              
                 DELE
                 SKIP -1
                 IF BOF()
                     GO TOP
                 ENDIF               
	         THISFORM.PAGEFRAME1.ACTIVEPAGE=1
	         THISFORM.REFRESH
            ENDIF   
      ENDIF    
    UNLOCK ALL
 ENDPROC
 ***************************完成***********  
  PROCEDURE SHRGROUP.FINISH_BOTT.CLICK
      IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
           IF THISFORM.GRID2.RECORDSOURCE<>'C23'
	       THISFORM.GRID2.RECORDSOURCE='C23'
	       THISFORM.GRID2.CHILDORDER='C231'
	       THISFORM.GRID2.COLUMN1.CONTROLSOURCE='C23.F02'
	       THISFORM.GRID2.COLUMN2.CONTROLSOURCE='C23.F03'
	       THISFORM.GRID2.COLUMN3.CONTROLSOURCE='C23.F04'
	       THISFORM.GRID2.COLUMN4.CONTROLSOURCE='C23.F03*C23.F04'
	       THISFORM.GRID2.COLUMN5.CONTROLSOURCE='C23.F07'
           THISFORM.GRID2.COLUMN6.CONTROLSOURCE='C23.F05'
	       THISFORM.GRID2.COLUMN7.CONTROLSOURCE='C23.F06'      
	   ENDIF   
           IF INT_099=.T. .AND. SUBSTR(PO_NO,3,4)=SUBSTR(DTOS(DATE()),3,4)   &&將刪除的單號丟回去A24                      
               HD='C022 '+SUBSTR(DTOS(DATE()),3,4)+PO_NO
               DO ODR_RJT
           ENDIF  

            SELE C22
            DO CASE 
                  CASE THISFORM.KEY_LIST.DISPLAYVALUE='依INVOICE單號排列'
                             SET ORDER TO C221
	          CASE THISFORM.KEY_LIST.DISPLAYVALUE='依客戶編號排列'
	                     SET ORDER TO C222
	          CASE THISFORM.KEY_LIST.DISPLAYVALUE='依出貨單號排列'
	                     SET ORDER TO C223
            ENDCASE   
     ENDIF  
       THISFORM.SHRGROUP.ABANDON_BOTT.CLICK
  ENDPROC
***********************  
PROC TRN_BOTT.CLICK          &&轉入C23.PACKING LIST
    IF MESSAGEBOX('是否確認資料無誤可以轉入PACKING LIST?',4+32+256,'請確認') = 6
       IF MESSAGEBOX('不同客戶料號是否分開包裝?',4+32+256,'請確認') = 6
          CHK_STR='Y'
       ELSE
          CHK_STR='N'
       ENDIF
       
       IF SEEK(C22.F04,'C28')=.F.	&&A      &&判斷出貨單是否已存在PACKING LIST         
          IF RLOCK('C22')  &&B
*!*	             IF !USED('C28')
*!*	                SELE 0
*!*	                USE C28
*!*	             ELSE
*!*	                SELE C28
*!*	             ENDIF
             SELECT C28
             SET ORDER TO C281
             IF !USED('C29')
                SELE 0
                USE C29
             ELSE
                SELE C29
             ENDIF   
             SET ORDER TO C291
                HD='C023 '+SUBSTR(DTOS(DATE()),3,4)
                HD1='C023 '
                HD2='CE'
                HD3='PACKING LIST'
                DO ODR_CRT
                IF SEEK(PO_NO,'C28')=.T.      &&如果編號重複
                   SELECT MAX(F01) FROM C28 INTO ARRAY GB NOWAIT
                   HD='C023 '+SUBSTR(DTOS(DATE()),3,4)+PO_NO
                   DO ODR_RPT
                ENDIF 
           ********     
               SELE C28
               APPEND BLANK
               REPL F01 WITH PO_NO
               REPL F02 WITH DATE()
               REPL F03 WITH C22.F03
               REPL F04 WITH C22.F04
               REPL F05 WITH C22.F05
               REPL F06 WITH C22.F06
               REPL F07 WITH C22.F07
               REPL F08 WITH C22.F09
               REPL F09 WITH C22.F10
               REPL F10 WITH C22.F11
               REPL F13 WITH C22.F14
               REPL F14 WITH C22.F15                              
               REPL F16 WITH C22.F16
               REPL F17 WITH C22.F17
               REPL F18 WITH C22.F18
               REPL F15 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
              SELECT  C23
              IF CHK_STR='Y'
                 SELECT F01,F02,SUM(F03),F03,F04,F05,F06,F09,F13,F19 FROM C23 ORDER BY F02  GROUP BY F01,F02,F05 WHERE F01=THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE  INTO CURSOR C23A
              ELSE
                 SELECT F01,F02,SUM(F03),F03,F04,F05,F06,F09,F13,F19 FROM C23 ORDER BY F02  GROUP BY F01,F02 WHERE F01=THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE  INTO CURSOR C23A
              ENDIF                 
              SELECT C23A
	      GO TOP
	      STARN=''
	      ENDN=''
	     DO WHILE !EOF()
	     		 PW=IIF(SEEK(C23A.F02,'C20'),C20.F11,0) &&包裝量
	              	 GW=IIF(SEEK(C23A.F02,'C20'),C20.F13,0) &&毛重
	              	 NW=IIF(SEEK(C23A.F02,'C20'),C20.F14,0) &&淨重
	              	 PN=IIF(PW=0,'1',IIF(PW>=C23A.SUM_F03,'1',IIF(INT(C23A.SUM_F03/PW)=0,'1',IIF(MOD(C23A.SUM_F03,PW)=0,ALLTRIM(STR(INT(C23A.SUM_F03/PW))),ALLTRIM(STR(INT(C23A.SUM_F03/PW))))))) &&單裝起止箱號
			 STARN=ALLTRIM(STR(1+VAL(ENDN)))

			 ENDN=ALLTRIM(STR(VAL(PN)+VAL(ENDN)))
			 

			     SELECT C29	
		         APPEND BLANK
		         REPLACE F01 WITH PO_NO
		         REPLACE F02 WITH C23A.F02 &&品號
		         REPLACE F03 WITH C23A.SUM_F03 &&出貨總數量	
		         REPLACE F04 WITH PW &&包裝量
		         REPLACE F05 WITH GW &&毛重
		         REPLACE F06 WITH NW&&淨重
				 REPLACE F07 WITH C23A.F04
		         REPLACE F08 WITH IIF(PW>=C23A.SUM_F03 .OR. PW<=0,PADL(STARN,4,' '),IIF(INT(C23A.SUM_F03/PW)=1,PADL(STARN,4,' '),PADL(STARN,4,' ')+'-'+PADL(ENDN,4,' '))) &&起止箱號
		         REPLACE F09 WITH IIF(PW>=C23A.SUM_F03 .OR. PW<=0,C23A.SUM_F03,PW*INT(C23A.SUM_F03/PW)) &&合計數量
		         REPLACE F10 WITH IIF(PW>=C23A.SUM_F03 .AND. PW>0,(GW/PW)*C23A.SUM_F03,IIF(PW<=0,0,GW*INT(C23A.SUM_F03/PW))) &&合計毛重
		         REPLACE F11 WITH IIF(PW>=C23A.SUM_F03 .AND. PW>0,(NW/PW)*C23A.SUM_F03,IIF(PW<=0,0,NW*INT(C23A.SUM_F03/PW))) &&合計淨重
		         REPLACE F12 WITH C23A.F05  &&客戶品號
		         REPLACE F13 WITH C23A.F06 &&客戶PO/NO
		         REPLACE F14 WITH DTOC(DATE())+' '+GSYS
		         REPLACE F15 WITH C23A.F13
		         REPLACE F16 WITH C23A.F09
		         REPLACE F19 WITH C23A.F19
		         ****************混裝數量
		       IF  IIF(PW!=0 .AND. PW<C23A.SUM_F03,IIF(MOD(C23A.SUM_F03,PW)!=0,.T.,.F.),.F.)
	       		 PN='1' 
			     STARN=ALLTRIM(STR(1+VAL(ENDN)))

			     ENDN=ALLTRIM(STR(VAL(PN)+VAL(ENDN)))

	             APPEND BLANK
		         REPLACE F01 WITH PO_NO
		         REPLACE F02 WITH C23A.F02 &&品號
		         REPLACE F03 WITH C23A.SUM_F03&&出貨總數量
		         REPLACE F04 WITH PW &&包裝量
		         REPLACE F05 WITH GW &&毛重
		         REPLACE F06 WITH NW&&淨重
				 REPLACE F07 WITH C23A.F04
		         REPLACE F08 WITH PADL(STARN,4,' ')&&起止箱號
		         REPLACE F09 WITH IIF(PW>=C23A.SUM_F03 .OR. PW<=0 ,C23A.SUM_F03,C23A.SUM_F03-(PW*INT(C23A.SUM_F03/PW)))&&合計數量
			     REPLACE F10 WITH IIF(PW>=C23A.SUM_F03 .AND. PW>0,(GW/PW)*(C23A.SUM_F03-(PW*INT(C23A.SUM_F03/PW))),IIF(PW<=0,0,(GW/PW)*(C23A.SUM_F03-(PW*INT(C23A.SUM_F03/PW)))))&&合計毛重
		         REPLACE F11 WITH IIF(PW>=C23A.SUM_F03 .AND. PW>0,(NW/PW)*(C23A.SUM_F03-(PW*INT(C23A.SUM_F03/PW))),IIF(PW<=0,0,(NW/PW)*(C23A.SUM_F03-(PW*INT(C23A.SUM_F03/PW)))))&&合計淨重	
		         REPLACE F12 WITH C23A.F05 &&客戶品號
			     REPLACE F13 WITH C23A.F06 &&客戶PO/NO
		         REPLACE F14 WITH DTOC(DATE())+' '+GSYS
		         REPLACE F15 WITH C23A.F13
		         REPLACE F16 WITH C23A.F09
		         REPLACE F19 WITH C23A.F19
		       ENDIF
	                SELECT C23A
	                SKIP
             ENDDO  
              =MESSAGEBOX('轉入成功, PACKING LIST單號為'+PO_NO,0+64,'請至C22 INVOICE再次確認')    
             UNLOCK ALL
             SELECT C23A
             USE
             SELE C29
             USE       
             IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
                THISFORM.GRID1.SETFOCUS
             ELSE
                THISFORM.GRID2.SETFOCUS
             ENDIF      
          ELSE 
             DO FILE_IMPACT
             UNLOCK ALL
             RETURN
          ENDIF &&B
        ELSE
             =MESSAGEBOX('此INVOICE單號已轉入PACKING LIST請勿重複轉入,並請至C23 PACKING LIST查詢',0+48,'錯誤訊息')
        ENDIF     &&A
    ENDIF   
       SELECT C28
       SET ORDER TO C283   
       THISFORM.TRN_BOTT.ENABLED=.F.
       HD1='C022 '
       HD2='CD'
       HD3='INVOICE'      
       SELECT C22
       THISFORM.GRID1.SETFOCUS
   
 
  ENDPROC  
  PROCEDURE XLS_BOTT.CLICK
       LK=C22.F01
       SELECT C22.F03 客戶編號,C22.F04 出貨單號,C23.F02 料號,C23.F03 數量,C23.F06 客戶單號,C23.F05 客戶品號,C23.F07 幣別,C23.F04 單價,C23.F13 產地;
       FROM C22,C23 WHERE C22.F01=LK AND C23.F01=LK  ORDER BY 料號 NOWAIT
       IF _TALLY>0
	        GCDELIMFILE=PUTFILE('儲存路徑',LK,'XLS')
	        IF EMPTY(GCDELIMFILE)  && ESC PRESSED
	           RETURN
	        ELSE
	          ON ERROR DO FILE_IMPACT
	          
	             COPY TO (GCDELIMFILE) TYPE XL5   
	             =MESSAGEBOX('儲存成功',0+64,'提示訊息視窗')
	          
	        ENDIF                    
       ENDIF
       
  ENDPROC
ENDDEFINE     
  *************************************************************列印
PROCEDURE PNT_PRC 
    LK=C22.F01
    BK=IIF(SEEK(LK,'C24'),'A','')
    C20_INV_NEW=''
    C20_INV_OLD=''
    SUM_ACC=0
    ITEN=1
    CREATE CURSOR C23B;
    (F01 C(10),F02 C(43),F03 N(11),F04 N(14,6),F05 C(40),F06 C(40),F07 C(4),F08 N(16,2),F09 C(40),F10 C(40),F13 C(15),F19 C(20),F79 C(43))
    INDE ON F10 TAG C23B_1
    SELECT * FROM C23 ORDER BY C23.F02 WHERE C23.F01=LK INTO CURSOR C23C
    SELE C23C
    GO TOP
    DO WHILE !EOF() 	   
	   SELE C23B
	   APPEND BLANK 
	   REPL F01 WITH C23C.F01
	   REPL F02 WITH C23C.F02
	   REPL F03 WITH C23C.F03
	   REPL F04 WITH C23C.F04
	   REPL F05 WITH C23C.F05
	   REPL F06 WITH C23C.F06
	   REPL F07 WITH C23C.F07
	   REPLACE F19 WITH C23C.F19
	   REPLACE F13 WITH C23C.F13
	   IF ALLTRIM(INT_011)=ALLTRIM(C23C.F07) &&判斷幣別是否與本地幣別一樣,若相同取整數否則取小數2位
	      REPL F08 WITH ROUND(C23C.F03*C23C.F04,INT_069)
	   ELSE
	   	  REPL F08 WITH ROUND(C23C.F03*C23C.F04,2)
	   ENDIF
	   REPL F09 WITH C23C.F09 && 客戶指定之品名規格
	   REPL F10 WITH IIF(SEEK(C23C.F02,'C20'),C20.F10,'') && INVOICE品名
	   
	   REPLACE F79 WITH C23C.F79
       SELECT C23C
	   SKIP
    ENDDO
    CREATE CURSOR C23_1;
    (F01 C(10),F02 C(43),F03 N(11),F04 N(14,6),F05 C(40),F06 C(40),F07 C(4),F08 N(16,2),F09 C(40),F10 C(40),F11 C(40),F12 N(3),F13 C(15),F19 C(20),F99 C(10))
    INDE ON F11+STR(F12)+F02 TAG C23_11
    SELECT C23B
    SET ORDER TO 1
    GO TOP
    SELECT C23_1
    APPEND BLANK 
    REPLACE F11 WITH C23B.F10
    C20_INV_OLD=C23B.F10
    SELECT C23B
   DO WHILE !EOF() 	   
	   SELE C23_1
	   APPEND BLANK  
	   REPL F01 WITH C23B.F01
	   REPL F02 WITH C23B.F02
	   REPL F03 WITH C23B.F03
	   REPL F04 WITH C23B.F04
	   REPL F05 WITH C23B.F05
	   REPL F06 WITH C23B.F06
	   REPL F07 WITH C23B.F07
	   REPL F08 WITH C23B.F08
	   REPL F09 WITH C23B.F09
	   REPLACE F19 WITH C23B.F19
	   REPLACE F99 WITH IIF(SEEK(C23B.F79,'B01'),'('+B01.F99+')','')
	   C20_INV_NEW=C23B.F10  &&C20 INVOICE品名規格
	      	IF  C20_INV_NEW<>C20_INV_OLD	
	              REPL F10 WITH C20_INV_NEW 
	        ELSE      
	   	      REPL F10 WITH  ''
	   	ENDIF      
	   REPL F11 WITH C23B.F10
	   REPL F12 WITH ITEN
	   REPLACE F13 WITH C23B.F13
	   ITEN=ITEN+1
	   C20_INV_OLD=C23B.F10
	   SUM_ACC=SUM_ACC+C23_1.F08 &&加總
	   SELECT C23B
	   SKIP
	    IF C20_INV_OLD<>C23B.F10
	   	SELECT C23_1
	   	APPEND BLANK 
	   	REPLACE F11 WITH C23B.F10
	   	SELECT C23B 
	  ENDIF 
     ENDDO
    SELE C23B
    USE       
    IF MESSAGEBOX('客戶品號是否要一併列出',4+32+256,'請確認')=6
	    CHK=1  
     ELSE 
     	CHK=0   
    ENDIF 
    IF MESSAGEBOX('是否印出產地',4+32+256,'請確認')=6
	    KUS=1  
     ELSE 
     	KUS=0   
    ENDIF     
    TOAL=KMP(SUM_ACC)
    SELE C23_1
    SET ORDER TO 1   && F11+F12+F02
    GO TOP
    DELETE 	
    IF _TALLY >0       
       REPORT FORM ALLTRIM(INT_116)+'C22'+BK TO PRINT PROMPT PREVIEW
    ENDIF
ENDPROC
***************************************************出貨處(FROM)設定
DEFINE CLASS FROM14 AS COMBOBOX
  HEIGHT=INT_015*25
 WIDTH=INT_015*140
  TOP=INT_015*84
  LEFT=INT_015*418
  FONTSIZE=INT_015*9
  BOUNDCOLUMN=1
  COLUMNCOUNT=1
  WIDTH=INT_015*84
  ROWSOURCETYPE=1
  STYLE=0
  NAME='FROM14'
PROCEDURE INIT
  THIS.ADDITEM('') 
  THIS.ADDITEM('KEELUNG TAIWAN')
  THIS.ADDITEM('TPE AIRPORT TAIWAN')
ENDPROC
PROCEDURE INTERACTIVECHANGE
    THISFORM.PAGEFRAME1.PAGE1.TXTF14.VALUE=THIS.DISPLAYVALUE
    THISFORM.PAGEFRAME1.PAGE1.TXTF14.REFRESH
 ENDPROC
ENDDEFINE
***************************************************幣別設定
DEFINE CLASS CRCY AS COMBOBOX
  HEIGHT=INT_015*25
  AUTOSIZE=.T.
  TOP=INT_015*84
  LEFT=INT_015*418
  FONTSIZE=INT_015*9
  BOUNDCOLUMN=1
  COLUMNCOUNT=1
  WIDTH=INT_015*84
  ROWSOURCETYPE=1
  STYLE=2
  NAME='CRCY'
  PROCEDURE INIT
    SELECT C00
    GO TOP 
    DO WHILE .NOT. EOF()
       L=4-LEN(ALLTRIM(F01))
       THIS.ADDITEM(F01)
       SKIP
    ENDDO
  ENDPROC
  PROCEDURE INTERACTIVECHANGE
    THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE=THIS.DISPLAYVALUE
    THISFORM.PAGEFRAME1.PAGE2.TXTF07.REFRESH
  ENDPROC
ENDDEFINE
**********
DEFINE CLASS TXTF04 AS TEXTBOX
  READONLY=.T.
  MAXLENGTH=10
  FONTSIZE=INT_015*9  
  PROCEDURE INTERACTIVECHANGE 
    IF  LEFT(ALLTRIM(THIS.VALUE),2)='BC' AND LEN(ALLTRIM(THIS.VALUE))=10
    	 THISFORM.PAGEFRAME1.PAGE1.TXTF04.VALUE=THIS.VALUE
    ENDIF
    IF  LEFT(ALLTRIM(THIS.VALUE),2)!='BC' AND LEN(ALLTRIM(THIS.VALUE))=8
    	 THISFORM.PAGEFRAME1.PAGE1.TXTF04.VALUE='BC'+ALLTRIM(THIS.VALUE)
   ENDIF 	 
   ENDPROC
ENDDEFINE    
***************************************************特殊輸入欄位設定-----------客戶
DEFINE CLASS TXTF03 AS TEXTBOX
  READONLY=.T.
  MAXLENGTH=5
  FONTSIZE=INT_015*9  
  PROCEDURE INTERACTIVECHANGE
    IF AT('?',ALLTRIM(THIS.VALUE))<>0 
       IF AT('?',ALLTRIM(THIS.VALUE))>1          
          IF EMPTY(A02.F12)
             SELECT F02,F01,F04 FROM C01 INTO CURSOR VDR ORDER BY F02 WHERE LEFT(F02,AT('?',THIS.VALUE)-1)=LEFT(THIS.VALUE,AT('?',THIS.VALUE)-1) AND F18=SYS_OPER
          ELSE
             SELECT F02,F01,F04 FROM C01 INTO CURSOR VDR ORDER BY F02 WHERE LEFT(F02,AT('?',THIS.VALUE)-1)=LEFT(THIS.VALUE,AT('?',THIS.VALUE)-1)
          ENDIF
       ELSE
          IF EMPTY(A02.F12)
             SELECT F02,F01,F04 FROM C01 INTO CURSOR VDR ORDER BY F02 WHERE F18=SYS_OPER   
          ELSE   
            SELECT F02,F01,F04 FROM C01 INTO CURSOR VDR ORDER BY F02 
          ENDIF   
       ENDIF          
       VDR_SEEK=CREATEOBJECT("VDR_SEEK")  
       VDR_SEEK.SHOW  
       THIS.VALUE=FLG
       THIS.REFRESH
       FLG='0'        
    ELSE
       IF LEN(ALLTRIM(THIS.VALUE))=4
          SELECT F02,F01,F04 FROM C01 INTO CURSOR VDR ORDER BY F02 WHERE F02=ALLTRIM(THIS.VALUE)
          DO CASE
             CASE _TALLY=1
                  THIS.VALUE=VDR.F01
                  THIS.REFRESH
             CASE _TALLY>1
                  VDR_SEEK=CREATEOBJECT("VDR_SEEK")  
                  VDR_SEEK.SHOW    
                  THIS.VALUE=FLG
                  THIS.REFRESH
                  FLG='0'        
          ENDCASE      
       ENDIF
    ENDIF      
     THISFORM.PAGEFRAME1.PAGE1.TXTF06.VALUE=IIF(SEEK(ALLTRIM(THIS.VALUE),'C01'),IIF(EMPTY(C01.F08),C01.F07,C01.F08),'') 
     THISFORM.PAGEFRAME1.PAGE1.TXTF06.REFRESH
     THISFORM.PAGEFRAME1.PAGE1.TXTF17.VALUE=IIF(SEEK(ALLTRIM(THIS.VALUE),'C01'),C01.F34,'') 
     THISFORM.PAGEFRAME1.PAGE1.TXTF17.REFRESH
     THISFORM.PAGEFRAME1.PAGE1.LBLF031.CAPTION=IIF(SEEK(ALLTRIM(THIS.VALUE),'C01'),C01.F05,'')
     THISFORM.PAGEFRAME1.PAGE1.TXTF05.VALUE=IIF(SEEK(ALLTRIM(THIS.VALUE),'C01'),IIF(EMPTY(C01.F09),C01.F04,C01.F09),'')
     THISFORM.PAGEFRAME1.PAGE1.TXTF05.REFRESH
     THISFORM.PAGEFRAME1.PAGE1.TXTF08.VALUE=IIF(SEEK(ALLTRIM(THIS.VALUE),'C01'),C01.F24,'')
     THISFORM.PAGEFRAME1.PAGE1.TXTF08.REFRESH     
  ENDPROC
ENDDEFINE
************************************************特殊輸入欄位的設定----料號
DEFINE CLASS TXTF02 AS TEXTBOX
  READONLY=.T.
  MAXLENGTH=43
  FONTSIZE=INT_015*9
  PROCEDURE INTERACTIVECHANGE
    IF AT('?',ALLTRIM(THIS.VALUE))<>0
       IF AT('?',ALLTRIM(THIS.VALUE))>1             
          SELECT F01,F02 FROM B01 INTO CURSOR MTR ORDER BY F01 WHERE LEFT(F01,AT('?',THIS.VALUE)-1)=LEFT(THIS.VALUE,AT('?',THIS.VALUE)-1)    
       ELSE
          SELECT F01,F02 FROM B01 INTO CURSOR MTR ORDER BY F01  
       ENDIF        
       IF _TALLY>0
          MTR_SEEK=CREATEOBJECT("MTR_SEEK")  
          MTR_SEEK.SHOW    
          THIS.VALUE=FLG
          THIS.REFRESH
          FLG='0'     
       ENDIF          
    ENDIF  
       THISFORM.PAGEFRAME1.PAGE2.LBLF021.CAPTION=IIF(SEEK(THIS.VALUE,'B01'),B01.F02,'')      
       THISFORM.PAGEFRAME1.PAGE2.TXTF13.VALUE=IIF(SEEK(THIS.VALUE,'C20'),C20.F04,'') 
  ENDPROC
ENDDEFINE
*****************

 