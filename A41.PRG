***程式名稱:A41.物品種類表
CLOSE ALL
CLEAR 
FLG='0'
FCH=''
CHK=''
R=0
AREA1='A41_1'
AREA2='A41'     
IF ! USED('A01')
   SELE 0
   USE A01 INDE A01
ELSE
   SELE A01
ENDIF      
SET ORDER TO A01
IF !USED('A02')
   SELE 0
   USE A02 INDE A02
ELSE
   SELE A02
ENDIF
SET ORDER TO A021      
SEEK sys_oper + 'A41'
IF !USED('A41')
   SELE 0
   USE A41 INDE A41
ELSE
   SELE A41
ENDIF
SET ORDER TO A411     
CREATE CURSOR A41_1 (F01 C(20))
INDE ON F01 TAG A41_11
SELE F01 FROM A41 GROUP BY F01 ORDER BY F01 INTO CURSOR A41A
SELE A41A
GO TOP
DO WHILE !EOF()
   SELE A41_1
   APPEND BLANK
   REPL A41_1.F01 WITH A41A.F01
   SELE A41A
   SKIP   
ENDDO
SELE A41A
USE   
SELE A41_1
SET ORDER TO A41_11
***
A41FORM=CREATEOBJECT("TKA41")
A41FORM.SHOW  
DEFINE CLASS TKA41 AS FORM
  CAPTION='A41.物品種類表'
*!*	  AUTOCENTER=.T.
  CONTROLBOX=.F.
  BORDERSTYLE=1  
  MAXBUTTON=.F.
  MINBUTTON=.F.
  MOVABLE=.F.
  CLOSABLE=.F.
  CONTROLCOUNT=57
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*550
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WIDTH=INT_015*791
  WINDOWTYPE=1
  NAME='TKA41'
  ADD OBJECT SHAPE1 AS SHAPE1 WITH;
      AUTOCENTER=.T.
  ADD OBJECT SHAPE2 AS SHAPE2 WITH;
      AUTOCENTER=.T.
  ADD OBJECT SHAPE3 AS SHAPE3 WITH;
      AUTOCENTER=.T.
  ADD OBJECT PAGEFRAME1 AS PAGEFRAME WITH;
      LEFT=INT_015*236,;
      WIDTH=INT_015*540,;
      HEIGHT=INT_015*200,;
      FONTSIZE=INT_015*9,;
      PAGECOUNT=2,;
      TABSTRETCH=1,;
      ACTIVEPAGE=1,;
      VISIBLE=.T.,;
      PAGE1.NAME='PAGE1',;
      PAGE1.VISIBLE=.T.,;
      PAGE1.CAPTION='表頭資料',;
      PAGE2.NAME='PAGE2',;
      PAGE2.VISIBLE=.T.,;
      PAGE2.CAPTION='表身詳細資料內容'   
  ADD OBJECT KEY_LIST AS KEY_LIST WITH;
      AUTOCENTER=.T.
  ADD OBJECT GRID1 AS GRID1 WITH;
      COLUMNCOUNT=1,;            
      RECORDSOURCE='A41_1',;      
      COLUMN1.NAME='COLUMN1' 
  ADD OBJECT GRID2 AS GRID2 WITH;
      COLUMNCOUNT=4,;            
      RECORDSOURCE='A41',; 
      LINKMASTER='A41_1',;
      RELATIONALEXPR='F01',;
      CHILDORDER='A411',;  
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;
      COLUMN3.NAME='COLUMN3',;
      COLUMN4.NAME='COLUMN4'
  ADD OBJECT CMDGROUP AS CMDGROUP WITH;
      AUTOSIZE=.T.              
  ADD OBJECT ORPGROUP AS ORPGROUP WITH;    
      AUTOSIZE=.T.              
  ADD OBJECT SHRGROUP AS SHRGROUP WITH;
      TOP=INT_015*150,;
      LEFT=INT_015*560                          
  PROCEDURE PAGEFRAME1.PAGE1.INIT     
     THIS.ADDOBJECT('LBLF01','LABEL')
     WITH THIS.LBLF01
          .VISIBLE=.T.
          .LEFT=INT_015*14
          .TOP=INT_015*18
          .WIDTH=INT_015*50
          .CAPTION='物品類別'          
     ENDWITH   
     THIS.ADDOBJECT('TXTF01','TEXTBOX')          
     WITH THIS.TXTF01
          .VISIBLE=.T.
          .LEFT=INT_015*64
          .TOP=INT_015*14
          .WIDTH=INT_015*150
          .HEIGHT=INT_015*25
          .MAXLENGTH=20
     ENDWITH              
  ENDPROC   
  ****
  PROCEDURE PAGEFRAME1.PAGE2.INIT
	THIS.ADDOBJECT('LBLF02','LABEL')
	WITH THIS.LBLF02  
	    .VISIBLE=.T.
            .LEFT=INT_015*14
            .TOP=INT_015*18
	    .WIDTH=INT_015*50
         .CAPTION='品項名稱'
    ENDWITH  
   THIS.ADDOBJECT('TXTF02','TEXTBOX')
	WITH THIS.TXTF02      
	     .VISIBLE=.T.
	     .LEFT=INT_015*65
	     .TOP=INT_015*14
	     .WIDTH=INT_015*200
	     .HEIGHT=INT_015*25
	     .MAXLENGTH=30
	     .NAME='TXTF02'  
    ENDWITH        
    THIS.ADDOBJECT('LBLF03','LABEL')
    WITH THIS.LBLF03
         .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*46
         .WIDTH=INT_015*50
         .CAPTION='單        位'         
    ENDWITH     
   THIS.ADDOBJECT('TXTF03','TEXTBOX')
	WITH THIS.TXTF03
	     .VISIBLE=.T.
	     .LEFT=INT_015*65
	     .TOP=INT_015*40
	     .WIDTH=INT_015*40
	     .HEIGHT=INT_015*25
	     .MAXLENGTH=4
	     .NAME='TXTF03'	    
	ENDWITH      
    THIS.ADDOBJECT('LBLF04','LABEL')
    WITH THIS.LBLF04
         .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*72
         .WIDTH=INT_015*50
         .CAPTION='備註說明'         
    ENDWITH     
   THIS.ADDOBJECT('TXTF04','TEXTBOX')
	WITH THIS.TXTF04
	     .VISIBLE=.T.
	     .LEFT=INT_015*65
	     .TOP=INT_015*66
	     .WIDTH=INT_015*250
	     .HEIGHT=INT_015*25
	     .MAXLENGTH=40
	     .NAME='TXTF04'	    
	ENDWITH  	
    THIS.ADDOBJECT('LBLF99','LABEL')
    WITH THIS.LBLF99
        .VISIBLE=.T.           
        .LEFT=INT_015*14
        .TOP=INT_015*143
        .WIDTH=INT_015*50
        .CAPTION='安全資料'         
    ENDWITH    
    THIS.ADDOBJECT('LBLF991','LABEL')
    WITH THIS.LBLF991
        .VISIBLE=.T.           
        .LEFT=INT_015*65
        .TOP=INT_015*143
        .AUTOSIZE=.T.
        .CAPTION=''
    ENDWITH       
  ENDPROC     
  ****  
  PROC INIT       
       THISFORM.SETALL('HEIGHT',INT_015*25,'TEXTBOX')
       THISFORM.SETALL('HEIGHT',INT_015*17,'LABEL')     
       THISFORM.SETALL('FONTSIZE',INT_015*9,'TEXTBOX')
       THISFORM.SETALL('FONTSIZE',INT_015*9,'LABEL')         
       THISFORM.SETALL('READONLY',.T.,'TEXTBOX')
       THISFORM.PAGEFRAME1.PAGE1.FONTSIZE=INT_015*10
       THISFORM.PAGEFRAME1.PAGE2.FONTSIZE=INT_015*10          
       THISFORM.SHRGROUP.VISIBLE=.F.
       THISFORM.SHRGROUP.ENABLED=.F.
       THISFORM.GRID1.BACKCOLOR=IIF(SEEK(SYS_OPER,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)
       THISFORM.GRID2.BACKCOLOR=IIF(SEEK(SYS_OPER,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'COLUMN')
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'HEADER')         
       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='物品類別'
       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='A41_1.F01'
       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*150
       THISFORM.GRID2.SETALL('FONTSIZE',INT_015*9,'COLUMN')
       THISFORM.GRID2.SETALL('FONTSIZE',INT_015*9,'HEADER')       
       THISFORM.GRID2.COLUMN1.HEADER1.CAPTION='品項名稱'       
       THISFORM.GRID2.COLUMN2.HEADER1.CAPTION='單位'
       THISFORM.GRID2.COLUMN3.HEADER1.CAPTION='備註說明'
       THISFORM.GRID2.COLUMN4.HEADER1.CAPTION='安全資料'
       THISFORM.GRID2.COLUMN1.CONTROLSOURCE='A41.F02'
       THISFORM.GRID2.COLUMN2.CONTROLSOURCE='A41.F03'
       THISFORM.GRID2.COLUMN3.CONTROLSOURCE='A41.F04'
       THISFORM.GRID2.COLUMN4.CONTROLSOURCE='A41.F99'
       THISFORM.GRID2.COLUMN1.WIDTH=INT_015*150
       THISFORM.GRID2.COLUMN2.WIDTH=INT_015*40
       THISFORM.GRID2.COLUMN3.WIDTH=INT_015*200
       THISFORM.GRID2.COLUMN4.WIDTH=INT_015*100
       THISFORM.GRID1.READONLY=.T.      
       THISFORM.GRID2.READONLY=.T.            
       THISFORM.GRID1.SETFOCUS
       IF THISFORM.GRID1.ACTIVEROW=0
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
          THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
          THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
          THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F. 
       ELSE
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T. 
          THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  &&判斷有無修改的權限
          THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)  &&判斷有無刪除的權限
          THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限                     
       ENDIF          
       THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.)
       THISFORM.KEY_LIST.DISPLAYVALUE='依物品類別排列'      
       JK='物品類別'
       SELE A41_1
       GO TOP
       THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=A41_1.F01
  ENDPROC             
  PROCEDURE PAGEFRAME1.PAGE1.ACTIVATE
     R=0
     SELE A41_1
     IF THISFORM.SHRGROUP.VISIBLE=.F.
        THISFORM.GRID1.ENABLED=.T.   
        THISFORM.GRID1.SETFOCUS   
        THISFORM.KEY_LIST.ENABLED=.T.
     ELSE
       THISFORM.KEY_LIST.ENABLED=.F.   
     ENDIF                
     THISFORM.GRID1.SETFOCUS
    IF THISFORM.GRID1.ACTIVEROW=0 .AND. THISFORM.SHRGROUP.ENABLED=.F.
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
        THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
        THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
        THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
        THISFORM.PAGEFRAME1.PAGE1.SETALL('VALUE','','TEXTBOX')        
        THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=''          
        THISFORM.PAGEFRAME1.PAGE2.ENABLED=.F.      
     ELSE
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.
        THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.) &&判斷有無修改的權限
        THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)  &&判斷有無刪除的權限
        THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)    &&判斷有無列印的權限         
        THISFORM.PAGEFRAME1.PAGE2.ENABLED=.T.
     ENDIF   
     THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.)
  ENDPROC
  PROCEDURE PAGEFRAME1.PAGE2.ACTIVATE
     SELE A41
     IF THISFORM.SHRGROUP.ENABLED=.F.
        THISFORM.GRID2.READONLY=.T.   
        THISFORM.GRID2.SETFOCUS   
     ENDIF   
     IF THISFORM.GRID2.ACTIVEROW=0 .AND. THISFORM.SHRGROUP.ENABLED=.F.
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
        THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
        THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
        THISFORM.PAGEFRAME1.PAGE2.SETALL('VALUE','','TEXTBOX')
        THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE=''
        THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=''
        THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE=''
        THISFORM.PAGEFRAME1.PAGE2.LBLF991.CAPTION=''
     ELSE
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.
        THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  &&判斷有無修改的權限
        THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)  &&判斷有無刪除的權限
        THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)  &&&&判斷有無列印的權限  
     ENDIF   
     R=RECNO('&AREA1')
     THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(RECNO('&AREA1')=R,RGB(255,255,0),'')","COLUMN")
     THISFORM.GRID1.ENABLED=.F.     
     THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.) &&判斷有無新增的權限
     THISFORM.KEY_LIST.ENABLED=.F.     
  ENDPROC         
  PROC KEY_LIST.INIT 
       WITH THIS 
           .ADDITEM('依物品類別排列')
           .VALUE=1
       ENDWITH             
  ENDPROC 
  PROC GRID1.AFTERROWCOLCHANGE
       LPARAMETERS nColIndex
       THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=A41_1.F01
       THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)   &&判斷有無修改的權限
       THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)   &&判斷有無刪除的權限
       FCH=THISFORM.ACTIVECONTROL.NAME
       JK=THIS.COLUMN1.HEADER1.CAPTION  
       IF THIS.ACTIVEROW=0
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
       ELSE
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.
       ENDIF   
       CHK=''     
*       THISFORM.REFRESH
  ENDPROC     
  PROC GRID2.AFTERROWCOLCHANGE
       LPARAMETERS nColIndex
       THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE=A41.F02
       THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=A41.F03 
       THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE=A41.F04     
       THISFORM.PAGEFRAME1.PAGE2.LBLF991.CAPTION=A41.F99
       FCH=THISFORM.ACTIVECONTROL.NAME
       JK=THIS.COLUMN1.HEADER1.CAPTION
       CHK=A41_1.F01
*       CHK=THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
       IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
       ENDIF   
*       thisform.refresh
  ENDPROC 
  ****
  PROCEDURE ORPGROUP.NEW_BOTT.CLICK    
    THISFORM.KEY_LIST.ENABLED=.F. 
    THISFORM.GRID1.ENABLED=.F.   
    THISFORM.GRID2.ENABLED=.F.       
    IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1      
        THISFORM.PAGEFRAME1.PAGE2.ENABLED=.F.  
       THISFORM.PAGEFRAME1.PAGE1.SETALL('READONLY',.F.,'TEXTBOX')     &&處理表頭新增
       THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=''
       THISFORM.PAGEFRAME1.PAGE1.TXTF01.SETFOCUS
     ELSE
        THISFORM.PAGEFRAME1.PAGE1.ENABLED=.F.              &&處理表身新增
        THISFORM.PAGEFRAME1.PAGE2.SETALL('READONLY',.F.,'TEXTBOX')     
        THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE=''              
        THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE='PCS'
        THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE=''
        THISFORM.PAGEFRAME1.PAGE2.LBLF991.CAPTION=''        
        THISFORM.PAGEFRAME1.PAGE2.TXTF02.SETFOCUS       
     ENDIF   
  ENDPROC  
  PROCEDURE SHRGROUP.SHURE1_BOTT.CLICK               &&新增確認
    IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
       IF  EMPTY(THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE)
          =MESSAGEBOX('物品類別不得空白!',0+64,'提示訊息視窗')
          THISFORM.PAGEFRAME1.PAGE1.TXTF01.SETFOCUS
          RETURN            
       ENDIF    
       IF INDEXSEEK(THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE,.F.,'A41_1','A41_11') = .T. 
          =MESSAGEBOX('物品類別已存在!',0+64,'提示訊息視窗')
          THISFORM.PAGEFRAME1.PAGE1.TXTF01.SETFOCUS
          RETURN            
       ENDIF
       SELE A41_1          
       APPEND BLANK
       LOCK()
       IF RLOCK()
          REPLACE F01 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
       ENDIF   
       UNLOCK
       THISFORM.PAGEFRAME1.PAGE1.ENABLED=.F.
       THISFORM.PAGEFRAME1.PAGE2.ENABLED=.T.  
       THISFORM.PAGEFRAME1.ACTIVEPAGE=2
       THISFORM.ORPGROUP.NEW_BOTT.CLICK
       THISFORM.REFRESH
    ELSE	&&表身新增
       IF  EMPTY(THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE)
            =MESSAGEBOX('品項名稱不得空白!',0+64,'提示訊息視窗')
            THISFORM.PAGEFRAME1.PAGE2.TXTF02.SETFOCUS
            RETURN            
       ENDIF        
       IF INDEXSEEK(THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE + THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE,.F.,'A41','A411') = .T.
          =MESSAGEBOX('此品項名稱已存在!',0+48,'提示訊息視窗')          
          THISFORM.PAGEFRAME1.PAGE2.TXTF02.SETFOCUS
          RETURN
       ENDIF   
       IF  EMPTY(THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE)
            =MESSAGEBOX('單位不得空白!',0+64,'提示訊息視窗')
            THISFORM.PAGEFRAME1.PAGE2.TXTF03.SETFOCUS
            RETURN            
       ENDIF                    
       SELECT A41
       APPEND BLANK
       LOCK()
       IF RLOCK()
          REPLACE F01 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
          REPLACE F02 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE
          REPLACE F03 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE
          REPLACE F04 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE
          REPLACE F99 WITH IIF(INT_012=1,PADL(ALLTRIM(STR(YEAR(DATE())-1911)),3,' ')+RIGHT(DTOC(DATE()),6),dtoc(DATE())+' ')+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
       ENDIF
       UNLOCK ALL         
       SEEK THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE
       THISFORM.GRID2.ENABLED=.T.
       THISFORM.GRID2.SETFOCUS  
       THISFORM.ORPGROUP.NEW_BOTT.CLICK      
    ENDIF  
  ENDPROC
****  
  PROCEDURE ORPGROUP.EDIT_BOTT.CLICK
     THISFORM.KEY_LIST.ENABLED=.F. 
     THISFORM.GRID1.ENABLED=.F.   
     THISFORM.GRID2.ENABLED=.F.   
     IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
          THISFORM.PAGEFRAME1.PAGE2.ENABLED=.F.
          THISFORM.PAGEFRAME1.PAGE1.SETALL('READONLY',.F.,'TEXTBOX')     
          THISFORM.PAGEFRAME1.PAGE1.TXTF01.SETFOCUS  
     ELSE
          THISFORM.PAGEFRAME1.PAGE1.ENABLED=.F.
         THISFORM.PAGEFRAME1.PAGE2.SETALL('READONLY',.F.,'TEXTBOX') 
         THISFORM.PAGEFRAME1.PAGE2.TXTF02.SETFOCUS  
     ENDIF
  ENDPROC    
  PROCEDURE SHRGROUP.SHURE2_BOTT.CLICK                          &&修改確認
     IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
          IF  EMPTY(THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE)
               =MESSAGEBOX('物品類別不得空白!',0+64,'提示訊息視窗')
               THISFORM.PAGEFRAME1.PAGE1.TXTF01.SETFOCUS
               RETURN            
          ENDIF    
          IF THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE <> A41_1.F01
              IF INDEXSEEK(THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE,.F.,'A41_1','A41_11') = .T.  
                   =MESSAGEBOX('物品類別已存在立!',0+64,'提示訊息視窗')
                   THISFORM.PAGEFRAME1.PAGE1.TXTF01.SETFOCUS
                   RETURN            
              ENDIF
         ENDIF
          SELECT A41_1
          LOCK()
          IF RLOCK()
              SELE RECNO() FROM A41 WHERE A41.F01=A41_1.F01 INTO ARRAY BK1
              JJ1=''                
              IF _TALLY>0                   
                   FOR I= 1 TO ALEN(BK1)
                          JJ1=JJ1+ALLTRIM(STR(BK1(I)))+','
                   ENDFOR  
                   KK1=STUFF(JJ1,RAT(',',JJ1,1),1,'')
                   RLOCK(KK1,'A41')
                   LL1=RLOCK(KK1,'A41')
                   IF LL1=.T. AND LEN(ALLTRIM(JJ1))>0 
                       SELECT A41
                       FOR I= 1 TO ALEN(BK1)                      
                              GO BK1(I) 
                              SELECT A41
                              REPLACE A41.F01 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
                       ENDFOR
                   ENDIF
                ENDIF   
                SELECT  A41_1
                REPLACE A41_1.F01 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
                RELEASE ALL LIKE BK*   
           ELSE 
               DO FILE_IMPACT
               UNLOCK ALL
          ENDIF  
     ELSE         
       IF  EMPTY(THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE)
            =MESSAGEBOX('品項名稱不得空白!',0+64,'提示訊息視窗')
            THISFORM.PAGEFRAME1.PAGE2.TXTF02.SETFOCUS
            RETURN            
       ENDIF        
       IF THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE <> A41.F02
            IF INDEXSEEK(THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE + THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE,.F.,'A41','A411') = .T.
                =MESSAGEBOX('此品項名稱已存在!',0+48,'提示訊息視窗')          
                THISFORM.PAGEFRAME1.PAGE2.TXTF02.SETFOCUS
                RETURN
            ENDIF   
       ENDIF
       IF  EMPTY(THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE)
            =MESSAGEBOX('單位不得空白!',0+64,'提示訊息視窗')
            THISFORM.PAGEFRAME1.PAGE2.TXTF03.SETFOCUS
            RETURN            
       ENDIF                    
       SELECT A41
       LOCK()
       IF RLOCK()
          REPLACE F02 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE
          REPLACE F03 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE
          REPLACE F04 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE
          REPLACE F99 WITH IIF(INT_012=1,PADL(ALLTRIM(STR(YEAR(DATE())-1911)),3,' ')+RIGHT(DTOC(DATE()),6),dtoc(DATE())+' ')+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
       ENDIF
    ENDIF   
    UNLOCK ALL
    THISFORM.SHRGROUP.ABANDON_BOTT.CLICK    
  ENDPROC   
****
 PROCEDURE  ORPGROUP.DEL_BOTT.CLICK                    &&刪除資料程序
    IF MESSAGEBOX('是否確定要刪除此筆資料',4+32+256,'請確認') = 6	
        IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1     &&刪除全部
             SELECT A41_1
             LOCK()
             IF RLOCK()
                  SELE RECNO() FROM A41 WHERE A41.F01=A41_1.F01 INTO ARRAY BK1
                  JJ1=''                
                  IF _TALLY>0                   
                      FOR I= 1 TO ALEN(BK1)
                             JJ1=JJ1+ALLTRIM(STR(BK1(I)))+','
                      ENDFOR  
                      KK1=STUFF(JJ1,RAT(',',JJ1,1),1,'')
                      RLOCK(KK1,'A41')
                      LL1=RLOCK(KK1,'A41')
                      IF LL1=.T. AND LEN(ALLTRIM(JJ1))>0 
                          SELECT A41
                          FOR I= 1 TO ALEN(BK1)                      
                                 GO BK1(I) 
                                 SELECT A41
                                 DELETE 
                          ENDFOR
                      ENDIF
                   ENDIF   
                   SELECT A41_1
                   DELETE   
                   RELEASE ALL LIKE BK*       
             ELSE
                   DO file_impact                  
             ENDIF    
             UNLOCK ALL
            THISFORM.GRID1.SETFOCUS
           IF THISFORM.GRID1.ACTIVEROW=0
               THISFORM.PAGEFRAME1.PAGE2.ENABLED=.F.
	       THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
	       THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
	       THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
	       THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
	       THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
	       THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
               THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
               THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
	    ELSE
	       THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
	       THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
	       THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
	       THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
	       THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T. 
	       THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  &&判斷有無修改的權限
               THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)  &&判斷有無刪除的權限
               THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)  &&&&判斷有無列印的權限  
	     ENDIF               
             THISFORM.SHRGROUP.ABANDON_BOTT.CLICK                 
        ELSE		&&單筆刪除
             SELECT A41
             LOCK()
             IF RLOCK()
                  SELECT A41
                  DELETE 
             ELSE
                  DO file_impact    
             ENDIF
             UNLOCK ALL
             THISFORM.GRID2.SETFOCUS
             IF THISFORM.GRID2.ACTIVEROW=0         &&如果單身被刪空             
                  SELE A41_1
                   DELETE 
                  THISFORM.PAGEFRAME1.ACTIVEPAGE=1 
                   THISFORM.REFRESH    
                  THISFORM.SHRGROUP.ABANDON_BOTT.CLICK                   
             ENDIF
        ENDIF
    ENDIF      
  ENDPROC  
***
  PROCEDURE SHRGROUP.ABANDON_BOTT.CLICK
      THISFORM.SHRGROUP.ENABLED=.F.
      THISFORM.SHRGROUP.VISIBLE=.F.      
      THISFORM.ORPGROUP.ENABLED=.T.
      THISFORM.ORPGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
      THISFORM.CMDGROUP.ENABLED=.T.
      THISFORM.CMDGROUP.SETALL('ENABLED',.T.,'COMMANDBUTTON')
      THISFORM.CMDGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
      THISFORM.SETALL('READONLY',.T.,'TEXTBOX')  
      THISFORM.PAGEFRAME1.PAGE1.SETALL('READONLY',.T.,'TEXTBOX')  
      THISFORM.PAGEFRAME1.PAGE2.SETALL('READONLY',.T.,'TEXTBOX')  
      THISFORM.PAGEFRAME1.PAGE1.ENABLED=.T.
      THISFORM.PAGEFRAME1.PAGE2.ENABLED=.T.
      THISFORM.GRID1.ENABLED=.T.
      THISFORM.GRID2.ENABLED=.T.
      IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1         
         THISFORM.GRID1.SETFOCUS
         THISFORM.KEY_LIST.ENABLED=.T.
      ELSE
         THISFORM.GRID2.SETFOCUS
          IF THISFORM.GRID2.ACTIVEROW=0
              SELE A41_1
              DELETE 
              THISFORM.PAGEFRAME1.ACTIVEPAGE=1
             THISFORM.REFRESH                    
          ENDIF   
      ENDIF    
      IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
      THISFORM.GRID1.SETFOCUS
           IF THISFORM.GRID1.ACTIVEROW=0
               THISFORM.PAGEFRAME1.PAGE2.ENABLED=.F.
	       THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
	       THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
	       THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
	       THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
	       THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
               THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
               THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
               THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.  	       
	    ELSE
	       THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
	       THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
	       THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
	       THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
	       THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T. 
               THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  &&判斷有無修改的權限
               THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)  &&判斷有無刪除的權限
               THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)  &&&&判斷有無列印的權限  	       
	     ENDIF  
       ENDIF	           
      UNLOCK ALL
  ENDPROC
  PROCEDURE SHRGROUP.FINISH_BOTT.CLICK
       THISFORM.SHRGROUP.ABANDON_BOTT.CLICK
  ENDPROC     
ENDDEFINE    
***********************************************列印程序
PROCEDURE PNT_PRC  

ENDPROC