SET TALK OFF
SET DELE ON
SET SAFE OFF
CLOSE ALL
CLEAR
PUBLIC REC_NO
IF !USED('F01')
   SELE 0
   USE F01  ALIA F01
ELSE
   SELE F01
ENDIF
SET ORDER TO 1
IF !USED('F02')
   SELE 0
   USE F02
ELSE
   SELE F02
ENDIF
*SET FILTER TO !EMPTY(F05)
SET ORDER TO 1
IF !USED('F07')
   SELE 0
   USE F07 EXCL
ELSE
   SELE F07
ENDIF
ZAP

SELE F01
SEEK 'G'
DO WHILE F01='G'
   SELE F07
   APPEND BLANK
   REPL F01 WITH F01.F01
   REPL F02 WITH F01.F02
   REPL F04 WITH F01.F01
   REPL F05 WITH F01.F02
   REPL F07 WITH 1
   REPL F08 WITH '00'
   SELE F01
*   SKIP
*ENDDO   
*SELE F01
*GO TOP
*DO WHILE !EOF()
   L=F01
   M=F02
   SELE F07 
   GO TOP
   DO WHILE .T.	 
      H=F04
      K=F05  
      O=F07
      P=F08
      R=RECNO()   
      SELE F04+F05+TRANSFORM(F07,'@R 999.9999') FROM F02 WHERE F01+F02=H+K   INTO ARRAY BK ORDER BY F04,F05
      IF _TALLY>0
         FOR I=1 TO ALEN(BK)             
             SELE F07             
             APPEND BLANK
             REPL F01 WITH L
             REPL F02 WITH M
             REPL F04 WITH LEFT(BK(I),20)
             REPL F05 WITH SUBSTR(BK(I),21,3)
             REPL F07 WITH O*VAL(RIGHT(BK(I),8))
             REPL F08 WITH PADL(ALLTRIM(STR(VAL(P)+1)),2,'00')
         ENDFOR      
      ELSE
        EXIT
      ENDIF
      SELE F07
      SET ORDER TO 1
      GO R
      SKIP          
   ENDDO
   SELE F01
   SKIP
ENDDO      
SELE F07
BROW