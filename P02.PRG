*****P02.廠商詢價資料
CLOSE ALL
CLEAR 
FLG='0'
FCH=''
CHK=''
R=0
AREA1='D01'
AREA2='P02'
IF !USED('D00')
   SELE 0
   USE D00
ELSE
   SELE D00
ENDIF
SET ORDER TO 1
IF ! USED('A01')
   SELE 0
   USE A01 INDE A01
ELSE
   SELE A01
ENDIF      
SET ORDER TO A01
IF !USED('A02')
   SELE 0
   USE A02 INDE A02
ELSE
   SELE A02
ENDIF
SET ORDER TO A021      
SEEK SYS_OPER+'P02'

IF !USED('B01')
   SELE 0
   USE B01 INDE B01
ELSE
   SELE B01
ENDIF
SET ORDER TO B011   

IF !USED('D01')
   SELE 0
   USE D01 INDE D01
ELSE
   SELE D01
ENDIF
SET ORDER TO D011
IF !USED('P02')
   SELE 0
   USE P02
ELSE
   SELE P02
ENDIF
SET ORDER TO P021      
SET RELA TO F03 INTO B01
P02FORM=CREATEOBJECT("TKP02")
P02FORM.SHOW  
DEFINE CLASS TKP02 AS FORM
  CAPTION='P02.廠商詢價資料'
*!*	  AUTOCENTER=.T.
  CONTROLBOX=.F.
  BORDERSTYLE=1  
  MAXBUTTON=.F.
  MINBUTTON=.F.
  MOVABLE=.F.
  CLOSABLE=.F.
  CONTROLCOUNT=57
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*550
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WIDTH=INT_015*789
  WINDOWTYPE=1
  NAME='TKP02'
  ADD OBJECT SHAPE1 AS SHAPE1 WITH;
      AUTOCENTER=.T.

  ADD OBJECT LBL_REC AS LBL_REC WITH;
      AUTOCENTER =.T.
  ADD OBJECT REC_COUNT AS REC_COUNT  WITH;
      CAPTION=STR(RECCOUNT())        
  ADD OBJECT SHAPE2 AS SHAPE2 WITH;
      AUTOCENTER=.T.
  ADD OBJECT SHAPE3 AS SHAPE3 WITH;
      AUTOCENTER=.T.
  ADD OBJECT PAGEFRAME1 AS PAGEFRAME WITH;
      LEFT=INT_015*236,;
      WIDTH=INT_015*540,;
      HEIGHT=INT_015*200,;
      FONTSIZE=INT_015*9,;
      PAGECOUNT=2,;
      TABSTRETCH=1,;
      ACTIVEPAGE=1,;
      VISIBLE=.T.,;
      PAGE1.NAME='PAGE1',;
      PAGE1.VISIBLE=.T.,;
      PAGE1.CAPTION='依照廠商搜尋紀錄',;
      PAGE2.NAME='PAGE2',;
      PAGE2.VISIBLE=.T.,;
      PAGE2.CAPTION='詳細資料內容'   
  ADD OBJECT KEY_LIST AS KEY_LIST WITH;
      AUTOCENTER=.T.
  ADD OBJECT GRID1 AS GRID1 WITH;
      COLUMNCOUNT=2,;            
      RECORDSOURCE='D01',;
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2'      
  ADD OBJECT GRID2 AS GRID2 WITH;
      COLUMNCOUNT=11,;            
      RECORDSOURCE='P02',;
      LINKMASTER='D01',;
      RELATIONALEXPR='F01',;
      CHILDORDER='P021',;      
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;
      COLUMN3.NAME='COLUMN3',;
      COLUMN4.NAME='COLUMN4',;
      COLUMN5.NAME='COLUMN5',;
      COLUMN6.NAME='COLUMN6',;
      COLUMN7.NAME='COLUMN7',;
      COLUMN8.NAME='COLUMN8',;
      COLUMN9.NAME='COLUMN9',;
      COLUMN10.NAME='COLUMN10',;
      COLUMN11.NAME='COLUMN11'
  ADD OBJECT CMDGROUP AS CMDGROUP WITH;
      AUTOSIZE=.T.              
  ADD OBJECT ORPGROUP AS ORPGROUP WITH;    
      AUTOSIZE=.T.              
  ADD OBJECT SHRGROUP AS SHRGROUP WITH;
      TOP=INT_015*173,;
      LEFT=INT_015*558          
  ADD OBJECT TRN_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*490,;
      LEFT=INT_015*15,;
      HEIGHT=INT_015*25,;
      FONTSIZE=INT_015*9,;
      AUTOSIZE=.T.,;
      CAPTION='\<T.將此筆詢價轉成銷售成本',;
      NAME='TRN_BOTT'      
  PROCEDURE PAGEFRAME1.PAGE1.INIT     
     THIS.ADDOBJECT('LBLF01','LABEL')
     WITH THIS.LBLF01
          .VISIBLE=.T.
          .LEFT=INT_015*14
          .TOP=INT_015*27
          .WIDTH=INT_015*50
          .CAPTION='廠商編號'          
     ENDWITH
     THIS.ADDOBJECT('LBLF011','LABEL')     
     WITH THIS.LBLF011
          .VISIBLE=.T.
          .LEFT=INT_015*140
          .TOP=INT_015*27
          .AUTOSIZE=.T.  
     ENDWITH            
     THIS.ADDOBJECT('TXTF01','TEXTBOX')     
     WITH THIS.TXTF01
          .VISIBLE=.T.
          .LEFT=INT_015*64
          .TOP=INT_015*23
          .WIDTH=INT_015*74
          .HEIGHT=INT_015*25
          .MAXLENGTH=5
     ENDWITH        
  ENDPROC   
  PROCEDURE PAGEFRAME1.PAGE2.INIT
	THIS.ADDOBJECT('LBLF01','LABEL')
	WITH THIS.LBLF01  
         .LEFT=INT_015*14
         .TOP=INT_015*13
	     .WIDTH=INT_015*50
         .CAPTION='廠商編號'
    ENDWITH  
    THIS.ADDOBJECT('LBLF011','LABEL')
    WITH THIS.LBLF011
         .LEFT=INT_015*126
	     .TOP=INT_015*14
	     .AUTOSIZE=.T.
	ENDWITH     
    THIS.ADDOBJECT('LBLF03','LABEL')
    WITH THIS.LBLF03
         .VISIBLE=.T.
	     .LEFT=INT_015*14
	     .TOP=INT_015*14
	     .WIDTH=INT_015*50
	     .CAPTION='品        號'
	ENDWITH     
    THIS.ADDOBJECT('LBLF031','LABEL')
    WITH THIS.LBLF031
         .VISIBLE=.T.
         .LEFT=INT_015*337
         .TOP=INT_015*14
         .WIDTH=INT_015*144         
    ENDWITH     
    THIS.ADDOBJECT('LBLF04','LABEL')
    WITH THIS.LBLF04
         .VISIBLE=.T.    
         .LEFT=INT_015*14
         .TOP=INT_015*39
         .WIDTH=INT_015*50
         .CAPTION='廠商料號'       
    ENDWITH     
    THIS.ADDOBJECT('LBLF02','LABEL')      
    WITH THIS.LBLF02
         .VISIBLE=.T.       
         .LEFT=INT_015*328
         .TOP=INT_015*39
         .WIDTH=INT_015*50
         .CAPTION='詢價日期'
    ENDWITH     
    THIS.ADDOBJECT('LBLF05','LABEL')
    WITH THIS.LBLF05
         .VISIBLE=.T.           
         .LEFT=INT_015*14
         .TOP=INT_015*64
         .WIDTH=INT_015*50
         .CAPTION='單        位'
    ENDWITH     
    THIS.ADDOBJECT('LBLF06','LABEL')
    WITH THIS.LBLF06
         .VISIBLE=.T.           
         .LEFT=INT_015*170
         .TOP=INT_015*64
         .WIDTH=INT_015*50
         .CAPTION='幣        別'
    ENDWITH     
    THIS.ADDOBJECT('LBLF07','LABEL')
    WITH THIS.LBLF07
         .VISIBLE=.T.           
         .LEFT=INT_015*328
         .TOP=INT_015*64
         .WIDTH=INT_015*50
         .CAPTION='單        價'
    ENDWITH     
    THIS.ADDOBJECT('LBLF13','LABEL')
    WITH THIS.LBLF13
         .VISIBLE=.T.           
         .LEFT=INT_015*14
         .TOP=INT_015*89
         .WIDTH=INT_015*50
         .CAPTION='包裝基量'               
    ENDWITH  
    THIS.ADDOBJECT('LBLF08','LABEL')
    WITH THIS.LBLF08
        .VISIBLE=.T.           
        .LEFT=INT_015*328
        .TOP=INT_015*89
        .WIDTH=INT_015*50
        .CAPTION='包裝數量'         
    ENDWITH    
    THIS.ADDOBJECT('LBLF09','LABEL')
    WITH THIS.LBLF09
         .VISIBLE=.T.           
         .LEFT=INT_015*14
         .TOP=INT_015*114
         .WIDTH=INT_015*50
         .CAPTION='採購前置'         
    ENDWITH     
    THIS.ADDOBJECT('LBLF10','LABEL')
    WITH THIS.LBLF10
         .VISIBLE=.T.           
         .LEFT=INT_015*328
         .TOP=INT_015*114
         .WIDTH=INT_015*50
         .CAPTION='交易條件'         
    ENDWITH   
   THIS.ADDOBJECT('LBLF14','LABEL')
    WITH THIS.LBLF14
         .VISIBLE=.T.           
         .LEFT=INT_015*14
         .TOP=INT_015*139
         .WIDTH=INT_015*50
         .CAPTION='備註說明'          
    ENDWITH     
    THIS.ADDOBJECT('LBLF11','LABEL')
    WITH THIS.LBLF11
         .VISIBLE=.T.           
         .LEFT=INT_015*328
         .TOP=INT_015*139
         .WIDTH=INT_015*50
         .CAPTION='安全資料'          
    ENDWITH     
    THIS.ADDOBJECT('LBLF111','LABEL')
    WITH THIS.LBLF111
         .VISIBLE=.T.           
         .LEFT=INT_015*379
         .TOP=INT_015*139
         .AUTOSIZE=.T.          
    ENDWITH   
    THIS.ADDOBJECT('LBLF90','LABEL')
    WITH THIS.LBLF90
         .VISIBLE=.T.           
         .LEFT=INT_015*328
         .TOP=INT_015*160
         .WIDTH=INT_015*50
         .CAPTION='確認人員'          
    ENDWITH     
    THIS.ADDOBJECT('LBLF901','LABEL')
    WITH THIS.LBLF901
         .VISIBLE=.T.           
         .LEFT=INT_015*379
         .TOP=INT_015*160
         .AUTOSIZE=.T.          
    ENDWITH       
    THIS.ADDOBJECT('TXTF01','TXTF01')
	WITH THIS.TXTF01      
	     .LEFT=INT_015*65
	     .TOP=INT_015*10
	     .WIDTH=INT_015*60
	     .HEIGHT=INT_015*25
	     .MAXLENGTH=5
	     .NAME='TXTF01'  
    ENDWITH     
   THIS.ADDOBJECT('TXTF03','TXTF03')
	WITH THIS.TXTF03
	     .VISIBLE=.T.
	     .LEFT=INT_015*65
	     .TOP=INT_015*10
	     .WIDTH=INT_015*261
	     .HEIGHT=INT_015*25
	     .MAXLENGTH=43
	     .NAME='TXTF03'	    
	ENDWITH     
    THIS.ADDOBJECT('TXTF04','TEXTBOX')
    WITH THIS.TXTF04
         .VISIBLE=.T.           
         .LEFT=INT_015*65
         .TOP=INT_015*35
         .WIDTH=INT_015*149
         .MAXLENGTH=36
         .NAME='TXTF04'
    ENDWITH     
    THIS.ADDOBJECT('TXTF02','TEXTBOX')
    WITH THIS.TXTF02
         .VISIBLE=.T.           
         .LEFT=INT_015*379
         .TOP=INT_015*35
         .WIDTH=INT_015*74
         .HEIGHT=INT_015*25
         .NAME='TXTF02'                            
    ENDWITH     
    THIS.ADDOBJECT('TXTF05','TEXTBOX')
    WITH THIS.TXTF05     
         .VISIBLE=.T.           
         .LEFT=INT_015*65
         .TOP=INT_015*60
         .WIDTH=INT_015*44
         .MAXLENGTH=4
         .NAME='TXTF05'
    ENDWITH     
    THIS.ADDOBJECT('TXTF06','TEXTBOX')
    WITH THIS.TXTF06
         .VISIBLE=.T.           
         .LEFT=INT_015*220
         .TOP=INT_015*60
         .WIDTH=INT_015*44
         .MAXLENGTH=4
         .NAME='TXTF06'                 
    ENDWITH     
    THIS.ADDOBJECT('CRCY','CRCY')
    
    THIS.ADDOBJECT('TXTF07','TEXTBOX')
    WITH THIS.TXTF07
         .VISIBLE=.T.           
         .LEFT=INT_015*379
         .TOP=INT_015*60
         .WIDTH=INT_015*118
         .INPUTMASK='999999999.999999'
         .NAME='TXTF07'
    ENDWITH     
    THIS.ADDOBJECT('TXTF13','TEXTBOX')
    WITH THIS.TXTF13
         .VISIBLE=.T.           
         .LEFT=INT_015*65
         .TOP=INT_015*85
         .WIDTH=INT_015*118
         .INPUTMASK='99999999.99'
         .NAME='TXTF13'                       
    ENDWITH     
    THIS.ADDOBJECT('TXTF08','TEXTBOX')
    WITH THIS.TXTF08
         .VISIBLE=.T.           
         .LEFT=INT_015*379
         .TOP=INT_015*85
         .WIDTH=INT_015*118
         .INPUTMASK='99999999.99'
         .NAME='TXTF08'
    ENDWITH     
    THIS.ADDOBJECT('TXTF09','TEXTBOX')    
    WITH THIS.TXTF09
         .VISIBLE=.T.           
         .LEFT=INT_015*65
         .TOP=INT_015*110
         .WIDTH=INT_015*74
         .NAME='TXTF09'              
    ENDWITH     
    THIS.ADDOBJECT('TXTF10','TEXTBOX')
    WITH THIS.TXTF10
         .VISIBLE=.T.           
         .LEFT=INT_015*379
         .TOP=INT_015*110
         .WIDTH=INT_015*74
         .MAXLENGTH=10
         .NAME='TXTF10'                   
    ENDWITH
  THIS.ADDOBJECT('TXTF14','TEXTBOX')
    WITH THIS.TXTF14
         .VISIBLE=.T.           
         .LEFT=INT_015*65
         .TOP=INT_015*135
         .WIDTH=INT_015*255
         .MAXLENGTH=40
         .NAME='TXTF14'                   
    ENDWITH  
  ENDPROC       
  PROCEDURE PAGEFRAME1.PAGE1.ACTIVATE
     R=0
     IF THISFORM.KEY_LIST.DISPLAYVALUE='依廠商編號排列'
        SELE D01
     ELSE
        SELE B01
     ENDIF      
     SEEK THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE          
     THISFORM.GRID1.ENABLED=.T.          
     THISFORM.GRID1.SETFOCUS     
     IF THISFORM.GRID1.ACTIVEROW=0
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
        THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=''
        THISFORM.PAGEFRAME1.PAGE1.LBLF011.CAPTION=''
     ELSE
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.
     ENDIF   
     THISFORM.ORPGROUP.NEW_BOTT.ENABLED=.F. 
     THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
     THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
     THISFORM.TRN_BOTT.ENABLED=.F.
     THISFORM.KEY_LIST.ENABLED=.T.
  ENDPROC
  PROCEDURE PAGEFRAME1.PAGE2.ACTIVATE
     SELE P02   
     IF THISFORM.SHRGROUP.ENABLED=.F.
        THISFORM.GRID2.READONLY=.T.        
        THISFORM.GRID2.SETFOCUS   
     ENDIF 
     IF THISFORM.GRID2.ACTIVEROW=0 .AND. THISFORM.SHRGROUP.ENABLED=.F.
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
        THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
        THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
        THISFORM.TRN_BOTT.ENABLED=.F.        
        THISFORM.PAGEFRAME1.PAGE2.SETALL('VALUE','','TEXTBOX')
        THISFORM.PAGEFRAME1.PAGE2.TXTF01.VALUE=''
        THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=''
        THISFORM.PAGEFRAME1.PAGE2.TXTF14.VALUE=''
        THISFORM.PAGEFRAME1.PAGE2.LBLF011.CAPTION=''
        THISFORM.PAGEFRAME1.PAGE2.LBLF031.CAPTION=''
        THISFORM.PAGEFRAME1.PAGE2.LBLF111.CAPTION=''
        THISFORM.PAGEFRAME1.PAGE2.LBLF901.CAPTION=''
     ELSE
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.
        THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  &&判斷有無修改的權限
        THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)   &&判斷有無刪除的權限
        THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限  
     ENDIF   
     R=RECNO('&AREA1')
     THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(RECNO('&AREA1')=R,RGB(255,255,0),'')","COLUMN")
     THISFORM.GRID1.ENABLED=.F.     
     THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.)   &&判斷有無新增的權限
     THISFORM.KEY_LIST.ENABLED=.F.     
  ENDPROC   

  PROC INIT              
       THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限  
       THISFORM.SETALL('HEIGHT',INT_015*25,'TEXTBOX')
       THISFORM.SETALL('HEIGHT',INT_015*17,'LABEL')
       THISFORM.SETALL('FONTSIZE',INT_015*9,'TEXTBOX')
       THISFORM.SETALL('FONTSIZE',INT_015*9,'LABEL')       
       THISFORM.SETALL('READONLY',.T.,'TEXTBOX')
       THISFORM.SHRGROUP.VISIBLE=.F.
       THISFORM.SHRGROUP.ENABLED=.F.
       THISFORM.GRID1.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)
       THISFORM.GRID2.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)
       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*50
       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*50
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'COLUMN')
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'HEADER')         
       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='廠商編號'
       THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='廠商簡稱'
       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='D01.F01'
       THISFORM.GRID1.COLUMN2.CONTROLSOURCE='D01.F04'
       THISFORM.GRID2.SETALL('FONTSIZE',INT_015*9,'COLUMN')
       THISFORM.GRID2.SETALL('FONTSIZE',INT_015*9,'HEADER')       
       THISFORM.GRID2.COLUMN1.HEADER1.CAPTION='料品編號'
       THISFORM.GRID2.COLUMN2.HEADER1.CAPTION='品名規格'
	   THISFORM.GRID2.COLUMN3.HEADER1.CAPTION='詢價日期'
	   THISFORM.GRID2.COLUMN4.HEADER1.CAPTION='單位'
	   THISFORM.GRID2.COLUMN5.HEADER1.CAPTION='幣別'
	   THISFORM.GRID2.COLUMN6.HEADER1.CAPTION='單       價'
	   THISFORM.GRID2.COLUMN7.HEADER1.CAPTION='包裝基量'
	   THISFORM.GRID2.COLUMN8.HEADER1.CAPTION='包裝數量'
	   THISFORM.GRID2.COLUMN9.HEADER1.CAPTION='備        註'
	   THISFORM.GRID2.COLUMN10.HEADER1.CAPTION='採購前置'
	   THISFORM.GRID2.COLUMN11.HEADER1.CAPTION='交易條件'       	   	       
	   THISFORM.GRID2.COLUMN1.CONTROLSOURCE='P02.F03'
	   THISFORM.GRID2.COLUMN2.CONTROLSOURCE='B01.F02'
	   THISFORM.GRID2.COLUMN3.CONTROLSOURCE='P02.F02'
	   THISFORM.GRID2.COLUMN4.CONTROLSOURCE='P02.F05'
	   THISFORM.GRID2.COLUMN5.CONTROLSOURCE='P02.F06'
	   THISFORM.GRID2.COLUMN6.CONTROLSOURCE='P02.F07'
	   THISFORM.GRID2.COLUMN7.CONTROLSOURCE='P02.F13'
	   THISFORM.GRID2.COLUMN8.CONTROLSOURCE='P02.F08'
	   THISFORM.GRID2.COLUMN9.CONTROLSOURCE='P02.F14'
	   THISFORM.GRID2.COLUMN10.CONTROLSOURCE='P02.F09'
	   THISFORM.GRID2.COLUMN11.CONTROLSOURCE='P02.F10'
	   THISFORM.GRID2.COLUMN1.WIDTH=INT_015*149
	   THISFORM.GRID2.COLUMN2.WIDTH=INT_015*100
       THISFORM.GRID2.COLUMN3.WIDTH=INT_015*65
       THISFORM.GRID2.COLUMN4.WIDTH=INT_015*30
       THISFORM.GRID2.COLUMN5.WIDTH=INT_015*30
       THISFORM.GRID1.READONLY=.T.       
       THISFORM.GRID1.SETFOCUS
       IF THISFORM.GRID1.ACTIVEROW=0
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
       ELSE
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.      
       ENDIF          
       THISFORM.KEY_LIST.DISPLAYVALUE='依廠商編號排列'       
       JK='廠商編號'
       SELE D01
       GO TOP
       THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=D01.F01
       THISFORM.PAGEFRAME1.PAGE1.LBLF011.CAPTION=D01.F03
  ENDPROC     
  PROC KEY_LIST.INIT 
       WITH THIS 
           .ADDITEM('依廠商編號排列')
           .ADDITEM('依料品編號排列')
       ENDWITH      
  ENDPROC 
  PROC KEY_LIST.INTERACTIVECHANGE                 
       SELE D01
       SET RELA OFF INTO P02
       SELE B01
       SET RELA OFF INTO P02
       SELE P02
       SET RELA OFF INTO D01
       SET RELA OFF INTO B01       
       THISFORM.GRID1.RECORDSOURCE=''
       THISFORM.GRID1.CHILDORDER=''
       DO CASE
          CASE THIS.DISPLAYVALUE='依廠商編號排列'
               THISFORM.PAGEFRAME1.PAGE1.CAPTION='依照廠商搜尋紀錄'
               SELE D01
               GO TOP
               AREA1='D01'
               SELE P02
               SET ORDER TO P021     
               SET RELA TO F03 INTO B01       
               THISFORM.PAGEFRAME1.PAGE1.LBLF01.CAPTION='廠商編號'
               THISFORM.PAGEFRAME1.PAGE1.TXTF01.WIDTH=INT_015*74
               THISFORM.PAGEFRAME1.PAGE1.TXTF01.MAXLENGTH=5
               THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=D01.F01
               THISFORM.PAGEFRAME1.PAGE1.LBLF011.LEFT=INT_015*140
               THISFORM.PAGEFRAME1.PAGE1.LBLF011.CAPTION=D01.F03
               THISFORM.PAGEFRAME1.PAGE2.LBLF01.VISIBLE=.F.
               THISFORM.PAGEFRAME1.PAGE2.LBLF011.VISIBLE=.F.
               THISFORM.PAGEFRAME1.PAGE2.TXTF01.VISIBLE=.F.
               THISFORM.PAGEFRAME1.PAGE2.TXTF01.ENABLED=.F.
               THISFORM.PAGEFRAME1.PAGE2.LBLF03.VISIBLE=.T.
               THISFORM.PAGEFRAME1.PAGE2.LBLF031.VISIBLE=.T.
               THISFORM.PAGEFRAME1.PAGE2.TXTF03.VISIBLE=.T.
               THISFORM.PAGEFRAME1.PAGE2.TXTF03.ENABLED=.T.
               THISFORM.GRID1.RECORDSOURCE='D01'
               THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='廠商編號'
               THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='廠商簡稱'
               THISFORM.GRID1.COLUMN1.CONTROLSOURCE='D01.F01'
               THISFORM.GRID1.COLUMN2.CONTROLSOURCE='D01.F04'   
               THISFORM.GRID1.COLUMN1.WIDTH=INT_015*50
               THISFORM.GRID1.COLUMN2.WIDTH=INT_015*50
               THISFORM.GRID2.LINKMASTER='D01'
               THISFORM.GRID2.RELATIONALEXPR='F01'
               THISFORM.GRID2.CHILDORDER='P021'            
               THISFORM.GRID2.COLUMN1.HEADER1.CAPTION='料品編號'
               THISFORM.GRID2.COLUMN1.CONTROLSOURCE='P02.F03'
               THISFORM.GRID2.COLUMN1.WIDTH=INT_015*149
               THISFORM.GRID2.COLUMN2.HEADER1.CAPTION='品名規格'
               THISFORM.GRID2.COLUMN2.CONTROLSOURCE='B01.F02'   
               THISFORM.GRID2.COLUMN2.WIDTH=INT_015*100                     
          CASE THIS.DISPLAYVALUE='依料品編號排列'
               THISFORM.PAGEFRAME1.PAGE1.CAPTION='依照料號搜尋紀錄'          
               SELE B01
               GO TOP
               AREA1='B01'
               SELE P02
               SET ORDER TO P022
               SET RELA TO F01 INTO D01
               THISFORM.PAGEFRAME1.PAGE1.LBLF01.CAPTION='料品編號'
               THISFORM.PAGEFRAME1.PAGE1.TXTF01.WIDTH=INT_015*261
               THISFORM.PAGEFRAME1.PAGE1.TXTF01.MAXLENGTH=43
               THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=B01.F01
               THISFORM.PAGEFRAME1.PAGE1.LBLF011.LEFT=INT_015*337
               THISFORM.PAGEFRAME1.PAGE1.LBLF011.CAPTION=B01.F02
               THISFORM.PAGEFRAME1.PAGE2.LBLF01.VISIBLE=.T.
               THISFORM.PAGEFRAME1.PAGE2.LBLF011.VISIBLE=.T.
               THISFORM.PAGEFRAME1.PAGE2.TXTF01.VISIBLE=.T.
               THISFORM.PAGEFRAME1.PAGE2.TXTF01.ENABLED=.T.
               THISFORM.PAGEFRAME1.PAGE2.LBLF03.VISIBLE=.F.
               THISFORM.PAGEFRAME1.PAGE2.LBLF031.VISIBLE=.F.
               THISFORM.PAGEFRAME1.PAGE2.TXTF03.VISIBLE=.F.
               THISFORM.PAGEFRAME1.PAGE2.TXTF03.ENABLED=.F.                
               THISFORM.GRID1.RECORDSOURCE='B01'
               THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='料品編號'
               THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='品名規格'
               THISFORM.GRID1.COLUMN1.CONTROLSOURCE='B01.F01'
               THISFORM.GRID1.COLUMN2.CONTROLSOURCE='B01.F02'
               THISFORM.GRID1.COLUMN1.WIDTH=INT_015*149
               THISFORM.GRID1.COLUMN2.WIDTH=INT_015*149   
               THISFORM.GRID2.LINKMASTER='B01'
               THISFORM.GRID2.RELATIONALEXPR='F01'
               THISFORM.GRID2.CHILDORDER='P022'  
               THISFORM.GRID2.COLUMN1.HEADER1.CAPTION='廠商編號'
               THISFORM.GRID2.COLUMN1.CONTROLSOURCE='P02.F01'
               THISFORM.GRID2.COLUMN1.WIDTH=INT_015*50               
               THISFORM.GRID2.COLUMN2.HEADER1.CAPTION='廠商簡稱'
               THISFORM.GRID2.COLUMN2.CONTROLSOURCE='D01.F04'       
               THISFORM.GRID2.COLUMN2.WIDTH=INT_015*50                                        
       ENDCASE 
        THISFORM.PAGEFRAME1.ACTIVEPAGE=2
        THISFORM.PAGEFRAME1.ACTIVEPAGE=1
        SELE &AREA1
        THISFORM.GRID1.SETFOCUS
  ENDPROC      
  PROC GRID1.AFTERROWCOLCHANGE
       LPARAMETERS NCOLINDEX
       IF THISFORM.KEY_LIST.DISPLAYVALUE='依廠商編號排列'
          THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=D01.F01
          THISFORM.PAGEFRAME1.PAGE1.LBLF011.CAPTION=D01.F03
       ELSE          
          THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=B01.F01
          THISFORM.PAGEFRAME1.PAGE1.LBLF011.CAPTION=B01.F02
       ENDIF
       FCH=THISFORM.ACTIVECONTROL.NAME
       JK=THIS.COLUMN1.HEADER1.CAPTION  
       IF THIS.ACTIVEROW=0
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
       ELSE
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.
       ENDIF   
       CHK=''     
       THISFORM.REFRESH
  ENDPROC     
  PROC GRID2.AFTERROWCOLCHANGE
       LPARAMETERS NCOLINDEX
       THISFORM.PAGEFRAME1.PAGE2.TXTF01.VALUE=F01
       THISFORM.PAGEFRAME1.PAGE2.LBLF011.CAPTION=D01.F03
       THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE=F02
       THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=F03
       THISFORM.PAGEFRAME1.PAGE2.LBLF031.CAPTION=LEFT(B01.F02,20)
       THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE=F04
       THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE=F05
       THISFORM.PAGEFRAME1.PAGE2.TXTF06.VALUE=F06
       THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE=F07
       THISFORM.PAGEFRAME1.PAGE2.TXTF08.VALUE=F08
       THISFORM.PAGEFRAME1.PAGE2.TXTF09.VALUE=F09
       THISFORM.PAGEFRAME1.PAGE2.TXTF10.VALUE=F10
       THISFORM.PAGEFRAME1.PAGE2.LBLF111.CAPTION=F11
       THISFORM.PAGEFRAME1.PAGE2.TXTF13.VALUE=F13  
       THISFORM.PAGEFRAME1.PAGE2.TXTF14.VALUE=F14  
       THISFORM.PAGEFRAME1.PAGE2.LBLF901.CAPTION=F90  
       THISFORM.TRN_BOTT.ENABLED=IIF(F12=.T.,.F.,.T.)
       FCH=THISFORM.ACTIVECONTROL.NAME
       JK=THIS.COLUMN1.HEADER1.CAPTION
       CHK=THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
       IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
          THISFORM. CMDGROUP.SEEK_BOTT.ENABLED=.F.
       ENDIF   
  ENDPROC 
  PROCEDURE ORPGROUP.NEW_BOTT.CLICK    
    THISFORM.SETALL('READONLY',.F.,'TEXTBOX')       
    THISFORM.PAGEFRAME1.PAGE1.ENABLED=.F.
    THISFORM.GRID2.ENABLED=.F. 
    THISFORM.PAGEFRAME1.PAGE2.CRCY.VISIBLE=.T.
    THISFORM.PAGEFRAME1.PAGE2.CRCY.DISPLAYVALUE=INT_011
    IF AREA1='D01'
        THISFORM.PAGEFRAME1.PAGE2.TXTF03.READONLY=.F.    
        THISFORM.PAGEFRAME1.PAGE2.TXTF03.SETFOCUS     
        THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=''
     ELSE
        THISFORM.PAGEFRAME1.PAGE2.TXTF01.READONLY=.F. 
        THISFORM.PAGEFRAME1.PAGE2.TXTF01.SETFOCUS
        THISFORM.PAGEFRAME1.PAGE2.TXTF01.VALUE=''     
     ENDIF   
     THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE=DATE()
     THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE=''
     THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE=''
     THISFORM.PAGEFRAME1.PAGE2.TXTF06.VALUE=''
     THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE=0
     THISFORM.PAGEFRAME1.PAGE2.TXTF08.VALUE=1
     THISFORM.PAGEFRAME1.PAGE2.TXTF09.VALUE=1
     THISFORM.PAGEFRAME1.PAGE2.TXTF10.VALUE=''
     THISFORM.PAGEFRAME1.PAGE2.TXTF13.VALUE=1
     THISFORM.PAGEFRAME1.PAGE2.TXTF14.VALUE=''
     THISFORM.PAGEFRAME1.PAGE2.LBLF111.CAPTION=''
     THISFORM.PAGEFRAME1.PAGE2.LBLF901.CAPTION=''
  ENDPROC  
  PROCEDURE ORPGROUP.EDIT_BOTT.CLICK
     THISFORM.PAGEFRAME1.PAGE1.ENABLED=.F.
     THISFORM.GRID2.ENABLED=.F.
     THISFORM.PAGEFRAME1.PAGE2.CRCY.VISIBLE=.T.
     THISFORM.PAGEFRAME1.PAGE2.CRCY.DISPLAYVALUE=THISFORM.PAGEFRAME1.PAGE2.TXTF06.VALUE
     IF AREA1='D01'
        THISFORM.PAGEFRAME1.PAGE2.TXTF03.SETFOCUS     
     ELSE
        THISFORM.PAGEFRAME1.PAGE2.TXTF01.SETFOCUS     
     ENDIF   
     LOCK()
     IF !RLOCK()
        DO FILE_IMPACT
        RETURN
     ENDIF
  ENDPROC      
  PROCEDURE ORPGROUP.DEL_BOTT.CLICK
     IF MESSAGEBOX('是否確定要刪除此筆資料',4+32+256,'請確認') = 6	       
        SELE P02   
        LOCK()
        IF RLOCK()
           DELE
           UNLOCK
           SKIP -1
           IF BOF()
              GO TOP
           ENDIF   
           THISFORM.GRID2.SETFOCUS
           IF THISFORM.GRID2.ACTIVEROW=0
              THISFORM.PAGEFRAME1.PAGE2.SETALL('VALUE','','TEXTBOX')
              THISFORM.PAGEFRAME1.PAGE2.TXTF01.VALUE=''
              THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=''
              THISFORM.PAGEFRAME1.PAGE2.LBLF011.CAPTION=''
              THISFORM.PAGEFRAME1.PAGE2.LBLF031.CAPTION=''
              THISFORM.PAGEFRAME1.PAGE2.LBLF111.CAPTION=''              
              THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
              THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
              THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
              THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
              THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
              THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
              THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
           ELSE
              THISFORM.CMDGROUP.ENABLED=.T. 
              THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  &&判斷有無修改的權限
              THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)   &&判斷有無刪除的權限
              THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限              
           ENDIF
        ELSE
          DO FILE_IMPACT    
        ENDIF     
     ENDIF   
  ENDPROC
  PROCEDURE SHRGROUP.SHURE1_BOTT.CLICK
    DO CASE
       CASE AREA1='D01'
            IF SEEK(THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE,'B01')=.F.
               =MESSAGEBOX('物料基本主檔中歸屬類別設定錯誤或是根本無此料號!',0+64,'提示訊息視窗')
               THISFORM.PAGEFRAME1.PAGE2.TXTF03.SETFOCUS
               RETURN
            ELSE
               THISFORM.PAGEFRAME1.PAGE2.TXTF01.VALUE=THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE   
            ENDIF   
       CASE AREA1='B01'
            IF SEEK(THISFORM.PAGEFRAME1.PAGE2.TXTF01.VALUE,'D01')=.F. 
               =MESSAGEBOX('廠商基本主檔無此編號請先建立!',0+64,'提示訊息視窗')
               THISFORM.PAGEFRAME1.PAGE2.TXTF01.SETFOCUS
               RETURN
            ELSE
               THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE    
            ENDIF
    ENDCASE           
    IF THISFORM.PAGEFRAME1.PAGE2.TXTF08.VALUE<THISFORM.PAGEFRAME1.PAGE2.TXTF13.VALUE
       =MESSAGEBOX('包裝數量必須大於或等於包裝基量!',0+64,'提示訊息視窗')
       THISFORM.PAGEFRAME1.PAGE2.TXTF13.SETFOCUS
       RETURN
    ENDIF   
    SELE P02
    APPEND BLANK
    LOCK()
    IF RLOCK()
       REPLACE F01 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF01.VALUE
       REPLACE F02 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE
       REPLACE F03 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE
       REPLACE F04 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE
       REPLACE F05 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE
       REPLACE F06 WITH THISFORM.PAGEFRAME1.PAGE2.CRCY.DISPLAYVALUE
       REPLACE F07 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE
       REPLACE F08 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF08.VALUE
       REPLACE F09 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF09.VALUE
       REPLACE F10 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF10.VALUE
       REPLACE F11 WITH DTOC(DATE())+' '+IIF(SEEK(SYS_OPER,'A01'),A01.F03,'')
       REPLACE F13 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF13.VALUE
       REPLACE F14 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF14.VALUE
    ENDIF
    UNLOCK
    IF AREA1='D01'
       SEEK THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE+DTOS(THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE)
    ELSE
       SEEK THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF01.VALUE++DTOS(THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE)
    ENDIF   
    THISFORM.GRID2.ENABLED=.T.    
    THISFORM.GRID2.SETFOCUS    
    
*    THISFORM.REFRESH
    THISFORM.ORPGROUP.NEW_BOTT.CLICK            
  ENDPROC
  PROCEDURE SHRGROUP.SHURE2_BOTT.CLICK
    IF AREA1='D01'
       THISFORM.PAGEFRAME1.PAGE2.TXTF01.VALUE=THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
    ELSE
       THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
    ENDIF      
    SELE P02
    IF RLOCK()
       REPLACE F01 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF01.VALUE
       REPLACE F02 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE
       REPLACE F03 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE
       REPLACE F04 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE
       REPLACE F05 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE
       REPLACE F06 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF06.VALUE
       REPLACE F07 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE
       REPLACE F08 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF08.VALUE
       REPLACE F09 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF09.VALUE
       REPLACE F10 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF10.VALUE
       REPLACE F11 WITH DTOC(DATE())+' '+IIF(SEEK(SYS_OPER,'A01'),A01.F03,'')
       REPLACE F12 WITH .F.
*       REPLACE F12 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF12.VALUE
       REPLACE F13 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF13.VALUE
       REPLACE F14 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF14.VALUE
    ELSE
      DO FILE_IMPACT
      RETURN   
    ENDIF   
    THISFORM.SHRGROUP.ABANDON_BOTT.CLICK    
  ENDPROC   
  PROCEDURE SHRGROUP.ABANDON_BOTT.CLICK
      THISFORM.SHRGROUP.ENABLED=.F.
      THISFORM.SHRGROUP.VISIBLE=.F.      
      THISFORM.ORPGROUP.ENABLED=.T.      
      THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.)   &&判斷有無新增的權限      
      THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  &&判斷有無修改的權限
      THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)   &&判斷有無刪除的權限
      THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限
      THISFORM.PAGEFRAME1.PAGE2.CRCY.VISIBLE=.F.
      THISFORM.ORPGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
      THISFORM.CMDGROUP.ENABLED=.T.
      THISFORM.CMDGROUP.SETALL('ENABLED',.T.,'COMMANDBUTTON')
      THISFORM.CMDGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
      THISFORM.SETALL('READONLY',.T.,'TEXTBOX')  
      THISFORM.PAGEFRAME1.PAGE2.TXTF01.READONLY=.T.
      THISFORM.PAGEFRAME1.PAGE2.TXTF03.READONLY=.T.
      UNLOCK ALL
      SELE P02
      THISFORM.PAGEFRAME1.PAGE1.ENABLED=.T.
      THISFORM.GRID2.ENABLED=.T.
      THISFORM.GRID2.SETFOCUS       
      UNLOCK ALL
  ENDPROC
  PROCEDURE SHRGROUP.FINISH_BOTT.CLICK
       SELE P02
       THISFORM.SHRGROUP.ABANDON_BOTT.CLICK
  ENDPROC     
  PROCEDURE TRN_BOTT.CLICK
     THISFORM.PAGEFRAME1.PAGE2.ENABLED=.F.
     THISFORM.GRID2.ENABLED=.F.
     SELE P02
     RLOCK()
     IF RLOCK()     
        SELE B01        
           RLOCK()
           IF RLOCK()
              REPL F38 WITH P02.F07*IIF(SEEK(P02.F06,'D00'),D00.F02,1)
              UNLOCK
           ELSE
              DO FILE_IMPACT
              UNLOCK ALL
              RETURN
           ENDIF    
       SELE P02
       REPLACE F12 WITH .T.
       REPLACE F90 WITH DTOC(DATE())+' '+IIF(SEEK(SYS_OPER,'A01'),A01.F03,'')
       UNLOCK       
    ELSE
       DO FILE_IMPACT
       UNLOCK ALL
       RETURN
    ENDIF  
    THISFORM.PAGEFRAME1.PAGE2.ENABLED=.T.
    THISFORM.GRID2.ENABLED=.T.
    THISFORM.GRID2.SETFOCUS  
  ENDPROC           
ENDDEFINE    
***********************************************列印程序
PROCEDURE PNT_PRC  
  IF AREA1='D01'  
     LK=D01.F01   
     SELECT P02.F01,;
            P02.F02,;
            P02.F03,;          
            P02.F05,;
            P02.F06,;
            P02.F07,;       
            P02.F08,;
            P02.F09,;
            P02.F10,;                       
            P02.F13,;            
            B01.F02,;
            D01.F03;
     FROM P02,B01,D01;
     WHERE P02.F01=LK AND B01.F01=P02.F03  AND D01.F01=P02.F01  ORDER BY P02.F03 NOWAIT
     IF _TALLY >0
        REPORT FORM ALLTRIM(INT_116)+'D02A' TO PRINT PROMPT PREVIEW
     ENDIF
  ELSE
     LK=B01.F01   
     SELECT P02.F01,;
            P02.F02,;
            P02.F03,;          
            P02.F05,;
            P02.F06,;
            P02.F07,;       
            P02.F08,;
            P02.F09,;
            P02.F10,;                       
            P02.F13,;            
            B01.F02,;
            D01.F03;
     FROM P02,B01,D01;     
     WHERE P02.F03=LK AND B01.F01=P02.F03  AND D01.F01=P02.F01 ORDER BY D01.F01 NOWAIT
     IF _TALLY >0
       REPORT FORM ALLTRIM(INT_116)+'D02B' TO PRINT PROMPT PREVIEW
     ENDIF  
  ENDIF            
ENDPROC
************************************************特殊輸入欄位的設定----料號
DEFINE CLASS TXTF03 AS TEXTBOX
  READONLY=.T.
  MAXLENGTH=43
  FONTSIZE=INT_015*9
  PROCEDURE INTERACTIVECHANGE
    IF AT('?',ALLTRIM(THIS.VALUE))<>0
       IF AT('?',ALLTRIM(THIS.VALUE))>1             
          SELECT F01,F02 FROM B01 INTO CURSOR MTR ORDER BY F01 WHERE  LEFT(F01,AT('?',THIS.VALUE)-1)=LEFT(THIS.VALUE,AT('?',THIS.VALUE)-1)
       ELSE
          SELECT F01,F02 FROM B01 INTO CURSOR MTR ORDER BY F01 
       ENDIF   
       MAN_SEEK=CREATEOBJECT("MTR_SEEK")  
       MAN_SEEK.SHOW    
       THIS.VALUE=FLG
       THIS.REFRESH
       FLG='0'        
    ENDIF  
       THISFORM.PAGEFRAME1.PAGE2.LBLF031.CAPTION=IIF(SEEK(THIS.VALUE,'B01'),B01.F02,'')  
       THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE=IIF(SEEK(THIS.VALUE,'B01'),B01.F03,'')  
       THISFORM.PAGEFRAME1.PAGE2.TXTF05.REFRESH       
  ENDPROC
ENDDEFINE
***************************************************特殊輸入欄位設定-----------廠商
DEFINE CLASS TXTF01 AS TEXTBOX
  READONLY=.T.
  MAXLENGTH=5
  FONTSIZE=INT_015*9  
  PROCEDURE INTERACTIVECHANGE
    IF AT('?',ALLTRIM(THIS.VALUE))<>0
       IF AT('?',ALLTRIM(THIS.VALUE))>1             
          SELECT F02,F01,F04 FROM D01 INTO CURSOR VDR ORDER BY F02 WHERE LEFT(F02,AT('?',THIS.VALUE)-1)=LEFT(THIS.VALUE,AT('?',THIS.VALUE)-1)
       ELSE
          SELECT F02,F01,F04 FROM D01 INTO CURSOR VDR ORDER BY F02 
       ENDIF   
       IF _TALLY>0
          VDR_SEEK=CREATEOBJECT("VDR_SEEK")  
          VDR_SEEK.SHOW    
          THIS.VALUE=FLG
          THIS.REFRESH
          FLG='0'        
       ENDIF   
    ENDIF  
       THISFORM.PAGEFRAME1.PAGE2.LBLF011.CAPTION=IIF(SEEK(THIS.VALUE,'D01'),D01.F03,'')  
       THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE=IIF(SEEK(THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE,'B01'),B01.F03,'')  
       THISFORM.PAGEFRAME1.PAGE2.TXTF05.REFRESH       
  ENDPROC
ENDDEFINE
***************************************************幣別設定
DEFINE CLASS CRCY AS COMBOBOX
  HEIGHT=INT_015*25
  AUTOSIZE=.T.
  TOP=INT_015*60
  LEFT=INT_015*220
  FONTSIZE=INT_015*9  
  BOUNDCOLUMN=1
  COLUMNCOUNT=1
  WIDTH=INT_015*84
  ROWSOURCETYPE=1
  STYLE=2
  NAME='CRCY'
  PROCEDURE INIT
    SELECT D00
    GO TOP 
    DO WHILE .NOT. EOF()
       L=4-LEN(ALLTRIM(F01))
       THIS.ADDITEM(F01)
       SKIP
    ENDDO
    THIS.DISPLAYVALUE=D00.F01
  ENDPROC  
  PROCEDURE INTERACTIVECHANGE
    THISFORM.PAGEFRAME1.PAGE2.TXTF06.VALUE=THIS.DISPLAYVALUE
  ENDPROC  
ENDDEFINE      
***************************************************