**程式名稱:K08.立沖結餘明細帳(應收)
SET EXCL OFF
CLOSE ALL
CLEAR 
AREA1='K51'
FLG='0'
FCH=''
CHK=''
EXCEL_CK='N'
DA_STR=''
IF !USED('A01')
   SELE 0
   USE A01
ELSE 
   SELE A01
ENDIF
SET ORDER TO A01      
IF !USED('A02')
   SELE 0
   USE A02 INDE A02
ELSE
   SELE A02
ENDIF
SET ORDER TO A021      
SEEK SYS_OPER+'K08'        
IF !USED('C01')
   SELE 0
   USE C01 
ELSE 
   SELE C01 
ENDIF
SET ORDER TO C011
IF !USED('D01')
   SELE 0
   USE D01 
ELSE 
   SELE D01 
ENDIF
SET ORDER TO D011
IF !USED('K51')
   SELE 0
   USE K51 
ELSE 
   SELE K51 
ENDIF
SET FILTER TO F19='1'
SET ORDER TO K511
GO TOP
******************
K08FORM=CREATEOBJECT("TKK08")
K08FORM.SHOW  
DEFINE CLASS TKK08 AS FORM
  CAPTION='K08.立沖結餘明細帳(應收)'
*!*	  AUTOCENTER=.T.
  CONTROLBOX=.F.
  BORDERSTYLE=1  
  MAXBUTTON=.F.
  MINBUTTON=.F.
  MOVABLE=.F.
  CLOSABLE=.F.
  CONTROLCOUNT=57
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*550
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WIDTH=INT_015*792
  WINDOWTYPE=1
 ADD OBJECT REC_COUNT1 AS REC_COUNT WITH;
      TOP=INT_015*1,;
      LEFT=INT_015*620,;  
      BACKCOLOR=RGB(255,255,0),;
      CAPTION=''
 ADD OBJECT REC_COUNT2 AS REC_COUNT WITH;
      TOP=INT_015*14,;
      LEFT=INT_015*620,;  
      BACKCOLOR=RGB(255,255,0),;
      CAPTION=''         
  ADD OBJECT KEY_LIST AS KEY_LIST WITH;
      AUTOCENTER=.T.,;
      WIDTH=INT_015*170
  ADD OBJECT GRID1 AS GRID1 WITH;
      COLUMNCOUNT=23,;            
      RECORDSOURCE='K51',; 
      TOP=INT_015*61,;
      HEIGHT=INT_015*465,;     
      WIDTH=INT_015*780,;      
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;
      COLUMN3.NAME='COLUMN3',; 
      COLUMN4.NAME='COLUMN4',; 
      COLUMN5.NAME='COLUMN5',;             
      COLUMN6.NAME='COLUMN6',;       
      COLUMN7.NAME='COLUMN7',;       
      COLUMN8.NAME='COLUMN8',;
      COLUMN9.NAME='COLUMN9',;
      COLUMN10.NAME='COLUMN10',;
      COLUMN11.NAME='COLUMN11',;
      COLUMN12.NAME='COLUMN12',;
      COLUMN13.NAME='COLUMN13',;
      COLUMN14.NAME='COLUMN14',;
      COLUMN15.NAME='COLUMN15',;
      COLUMN16.NAME='COLUMN16',;
      COLUMN17.NAME='COLUMN17',;
      COLUMN18.NAME='COLUMN18',;  
      COLUMN19.NAME='COLUMN19',;      
      COLUMN20.NAME='COLUMN20',; 
      COLUMN21.NAME='COLUMN21',;   
      COLUMN22.NAME='COLUMN22',; 
      COLUMN23.NAME='COLUMN23'         
  ADD OBJECT CMDGROUP AS CMDGROUP WITH;
      TOP=INT_015*0,;
      LEFT=INT_015*180,;
      ENABLED=.T.,;
      VISIBLE=.T.   
  ADD OBJECT ORPGROUP AS ORPGROUP WITH;      
      TOP=INT_015*0,;
      LEFT=INT_015*375    
   ADD OBJECT VRT_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*33,;
      LEFT=INT_015*100,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*53,;
      FONTSIZE=INT_015*9,;
      CAPTION='\<V.反帳款'                                   
   ADD OBJECT LIST_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*5,;
      LEFT=INT_015*395,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*65,;
      FONTSIZE=INT_015*9,;
      CAPTION='\<L.列印明細'         
  ADD OBJECT REPLY_REMARK AS COMMANDBUTTON WITH;
      TOP=INT_015*5,;
      LEFT=INT_015*463,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;
      CAPTION='\<E.修改'           
   ADD OBJECT LBLF15 AS LABEL WITH;
      TOP=INT_015*38,;
      LEFT=INT_015*185,;
      HEIGHT=INT_015*23,;      
      WIDTH=INT_015*50,;
      FONTSIZE=INT_015*9,;
       CAPTION='收款日期'            
  ADD OBJECT TXTF15 AS TEXTBOX WITH;
      TOP=INT_015*33,;
      LEFT=INT_015*235,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*70,;
      MAXLENGTH=8,;
      FONTSIZE=INT_015*9
  ADD OBJECT LBLF08 AS LABEL WITH;
      TOP=INT_015*38,;
      LEFT=INT_015*310,;
      HEIGHT=INT_015*23,;      
      WIDTH=INT_015*30,;
      FONTSIZE=INT_015*9,;
      CAPTION='備 註'     
  ADD OBJECT TXTF08 AS TEXTBOX WITH;
      TOP=INT_015*33,;
      LEFT=INT_015*340,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*345,;
      MAXLENGTH=60,;
      FONTSIZE=INT_015*9
  ADD OBJECT YES AS COMMANDBUTTON WITH;
      TOP=INT_015*33,;
      LEFT=INT_015*696,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;
      CAPTION='\<Y.確定'
  ADD OBJECT NO AS COMMANDBUTTON WITH;
      TOP=INT_015*33,;
      LEFT=INT_015*738,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;
      CAPTION='\<N.取消' 
*!*	  ADD OBJECT LBLF20 AS LABEL WITH;
*!*	      TOP=INT_015*39,;
*!*	      LEFT=INT_015*555,;
*!*	      HEIGHT=INT_015*23,;      
*!*	      WIDTH=INT_015*50,;
*!*	      FONTSIZE=INT_015*9,;
*!*	      CAPTION='安全資料'
  ADD OBJECT LBLF201 AS LABEL WITH;
      TOP=INT_015*39,;
      LEFT=INT_015*692,;
      FONTSIZE=INT_015*9,;
      VISIBLE=.T.,;
      AUTOSIZE=.T.,;
      CAPTION=''                      
***********                
  PROCEDURE INIT
       SELECT  K51
       CALC SUM(F10),SUM(F07) TO TOTAL_CNT,TOTAL_CNT2
       GO TOP
       THISFORM.REC_COUNT1.CAPTION='發票總金額：'+ALLTRIM(TRANSFORM(TOTAL_CNT2,'@R 999,999,999,999.99'))
       THISFORM.REC_COUNT2.CAPTION='未沖總金額：'+ALLTRIM(TRANSFORM(TOTAL_CNT,'@R 999,999,999,999.99'))	 
       THISFORM.ORPGROUP.NEW_BOTT.VISIBLE=.F.
       THISFORM.ORPGROUP.EDIT_BOTT.VISIBLE=.F.
       THISFORM.ORPGROUP.DEL_BOTT.VISIBLE=.F.
       THISFORM.YES.ENABLED=.F.
       THISFORM.NO.ENABLED=.F.
       THISFORM.YES.VISIBLE=.F.
       THISFORM.NO.VISIBLE=.F.       
       THISFORM.SETALL('READONLY',.T.,'TEXTBOX') 
       THISFORM.GRID1.LOCKCOLUMNS=2
       THISFORM.GRID1.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'COLUMN')
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'HEADER')
       THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF((DATE()-K51.F15)=>0 .AND. (DATE()-K51.F15)<INT_210,RGB(0,255,255),IIF((DATE()-K51.F15)>=INT_211,RGB(255,0,0),IIF((DATE()-K51.F15)>=INT_210 .AND. (DATE()-K51.F15)<INT_211,RGB(255,255,0),'')))","COLUMN")
       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*80
       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*60
       THISFORM.GRID1.COLUMN3.WIDTH=INT_015*60
       THISFORM.GRID1.COLUMN4.WIDTH=INT_015*65
       THISFORM.GRID1.COLUMN5.WIDTH=INT_015*75
       THISFORM.GRID1.COLUMN6.WIDTH=INT_015*50
       THISFORM.GRID1.COLUMN7.WIDTH=INT_015*55
       THISFORM.GRID1.COLUMN8.WIDTH=INT_015*55
       THISFORM.GRID1.COLUMN9.WIDTH=INT_015*55
       THISFORM.GRID1.COLUMN10.WIDTH=INT_015*60
       THISFORM.GRID1.COLUMN11.WIDTH=INT_015*55
       THISFORM.GRID1.COLUMN12.WIDTH=INT_015*100
       THISFORM.GRID1.COLUMN13.WIDTH=INT_015*75  
       THISFORM.GRID1.COLUMN14.WIDTH=INT_015*35
       THISFORM.GRID1.COLUMN15.WIDTH=INT_015*65
       THISFORM.GRID1.COLUMN16.WIDTH=INT_015*60       
       THISFORM.GRID1.COLUMN17.WIDTH=INT_015*75       
       THISFORM.GRID1.COLUMN18.WIDTH=INT_015*120 
       THISFORM.GRID1.COLUMN19.WIDTH=INT_015*149
       THISFORM.GRID1.COLUMN20.WIDTH=INT_015*60
       THISFORM.GRID1.COLUMN21.WIDTH=INT_015*50
       THISFORM.GRID1.COLUMN22.WIDTH=INT_015*50
       THISFORM.GRID1.COLUMN23.WIDTH=INT_015*90
       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='發票號碼'
	   THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='發票日期'
	   THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='發票總額'  
	   THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='未沖銷金額'  
	   THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='憑證單號'
  	   THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='對象編號'
  	   THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='對象簡稱'
  	   THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='業務人員'
  	   THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='業務助理'
  	   THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='收款日期' 
  	   THISFORM.GRID1.COLUMN11.HEADER1.CAPTION='逾期天數' 
  	   THISFORM.GRID1.COLUMN12.HEADER1.CAPTION='收款方式' 
  	   THISFORM.GRID1.COLUMN13.HEADER1.CAPTION='開單未沖金額' 
  	   THISFORM.GRID1.COLUMN14.HEADER1.CAPTION='幣別'
  	   THISFORM.GRID1.COLUMN15.HEADER1.CAPTION='匯率' 
  	   THISFORM.GRID1.COLUMN16.HEADER1.CAPTION='外幣金額'   	   
  	   THISFORM.GRID1.COLUMN17.HEADER1.CAPTION='外幣未沖金額' 
  	   THISFORM.GRID1.COLUMN18.HEADER1.CAPTION='備        註'
  	   THISFORM.GRID1.COLUMN19.HEADER1.CAPTION='發票類別'
  	   THISFORM.GRID1.COLUMN20.HEADER1.CAPTION='統一編號'
  	   THISFORM.GRID1.COLUMN21.HEADER1.CAPTION='業務編號'
  	   THISFORM.GRID1.COLUMN22.HEADER1.CAPTION='業助編號'
  	   THISFORM.GRID1.COLUMN23.HEADER1.CAPTION='安全資料'
	   THISFORM.GRID1.COLUMN1.CONTROLSOURCE='K51.F01'
	   THISFORM.GRID1.COLUMN2.CONTROLSOURCE='K51.F02'
	   THISFORM.GRID1.COLUMN3.CONTROLSOURCE='K51.F07'
	   THISFORM.GRID1.COLUMN4.CONTROLSOURCE='K51.F10'
	   THISFORM.GRID1.COLUMN5.CONTROLSOURCE='K51.F05'
	   THISFORM.GRID1.COLUMN6.CONTROLSOURCE='K51.F06'
	   THISFORM.GRID1.COLUMN7.CONTROLSOURCE='K51.F11'
  	   THISFORM.GRID1.COLUMN8.CONTROLSOURCE="IIF(SEEK(K51.F17,'A01'),A01.F03,'')"
  	   THISFORM.GRID1.COLUMN9.CONTROLSOURCE="IIF(SEEK(K51.F18,'A01'),A01.F03,'')"
  	   THISFORM.GRID1.COLUMN10.CONTROLSOURCE='K51.F15'
  	   THISFORM.GRID1.COLUMN11.CONTROLSOURCE="IIF((DATE()-K51.F15)<0,'尚未逾期',DATE()-K51.F15)"
	   THISFORM.GRID1.COLUMN12.CONTROLSOURCE='K51.F16'
	   THISFORM.GRID1.COLUMN13.CONTROLSOURCE='K51.F09'
	   THISFORM.GRID1.COLUMN14.CONTROLSOURCE='K51.F12'
	   THISFORM.GRID1.COLUMN15.CONTROLSOURCE='K51.F13'
	   THISFORM.GRID1.COLUMN16.CONTROLSOURCE='K51.F14'	   
	   THISFORM.GRID1.COLUMN17.CONTROLSOURCE="ROUND(K51.F10/K51.F13,3)"
	   THISFORM.GRID1.COLUMN18.CONTROLSOURCE='K51.F08'
	   THISFORM.GRID1.COLUMN19.CONTROLSOURCE="K51.F03+BILL(K51.F03)"
	   THISFORM.GRID1.COLUMN20.CONTROLSOURCE='K51.F04'
	   THISFORM.GRID1.COLUMN21.CONTROLSOURCE='K51.F17'
	   THISFORM.GRID1.COLUMN22.CONTROLSOURCE='K51.F18'
	   THISFORM.GRID1.COLUMN23.CONTROLSOURCE='K51.F20' 
       THISFORM.GRID1.READONLY=.T.       
       THISFORM.GRID1.SETFOCUS      
       IF THISFORM.GRID1.ACTIVEROW=0
           THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
	   THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
	   THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
	   THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.    
	   THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.	    
	   THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F. 	
           THISFORM.LIST_BOTT.ENABLED=.F. 
           THISFORM.VRT_BOTT.ENABLED=.F.
           THISFORM.REPLY_REMARK.ENABLED=.F.	       	   
       ELSE
           THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
	   THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
	   THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
	   THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.    
	   THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.	      
	   THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限   
           THISFORM.LIST_BOTT.ENABLED=IIF(A02.F08='*',.T.,.F.)   &&判斷有無列印明細的權限     
           THISFORM.VRT_BOTT.ENABLED=IIF(A02.F09='*',.T.,.F.) AND IIF(K51.F07=K51.F10,K51.F09=0,.F.)  &&判斷有無反帳款至K17的權限
           THISFORM.REPLY_REMARK.ENABLED=IIF(A02.F05='*' ,.T.,.F.) &&判斷有無修改收款日期與備註的權限	   	       
       ENDIF
       JK='發票號碼'
  ENDPROC     
*****************  
  PROC KEY_LIST.INIT 
       WITH THIS 
           .ADDITEM('依發票號碼+發票日期排列')
           .ADDITEM('依發票日期+發票號碼排列')
           .ADDITEM('依對象編號+發票日期排列')   
           .ADDITEM('依對象簡稱+發票日期排列')
           .ADDITEM('依憑證單號+發票日期排列')
           .ADDITEM('依業務編號+收款日期排列')
           .ADDITEM('依業助編號+收款日期排列')
       ENDWITH      
  ENDPROC  
****************  
  PROC KEY_LIST.INTERACTIVECHANGE                 
   SELE K51
   DO CASE
      CASE THIS.DISPLAYVALUE='依發票號碼+發票日期排列'
           SET ORDER TO K511
           THISFORM.GRID1.COLUMN1.WIDTH=INT_015*80
	   THISFORM.GRID1.COLUMN2.WIDTH=INT_015*60
	   THISFORM.GRID1.COLUMN3.WIDTH=INT_015*60
	   THISFORM.GRID1.COLUMN4.WIDTH=INT_015*65
	   THISFORM.GRID1.COLUMN5.WIDTH=INT_015*75
	   THISFORM.GRID1.COLUMN6.WIDTH=INT_015*50
	   THISFORM.GRID1.COLUMN7.WIDTH=INT_015*55
	   THISFORM.GRID1.COLUMN8.WIDTH=INT_015*55
	   THISFORM.GRID1.COLUMN9.WIDTH=INT_015*55
	   THISFORM.GRID1.COLUMN10.WIDTH=INT_015*60
	   THISFORM.GRID1.COLUMN11.WIDTH=INT_015*55
	   THISFORM.GRID1.COLUMN12.WIDTH=INT_015*100
	   THISFORM.GRID1.COLUMN13.WIDTH=INT_015*75  
	   THISFORM.GRID1.COLUMN14.WIDTH=INT_015*35
	   THISFORM.GRID1.COLUMN15.WIDTH=INT_015*65
	   THISFORM.GRID1.COLUMN16.WIDTH=INT_015*60       
	   THISFORM.GRID1.COLUMN17.WIDTH=INT_015*75       
	   THISFORM.GRID1.COLUMN18.WIDTH=INT_015*120 
	   THISFORM.GRID1.COLUMN19.WIDTH=INT_015*149
	   THISFORM.GRID1.COLUMN20.WIDTH=INT_015*60
           THISFORM.GRID1.COLUMN21.WIDTH=INT_015*50
           THISFORM.GRID1.COLUMN22.WIDTH=INT_015*50	   
           THISFORM.GRID1.COLUMN23.WIDTH=INT_015*90
           THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='發票號碼'
	   THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='發票日期'
	   THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='發票總額'  
	   THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='未沖銷金額'  
	   THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='憑證單號'
  	   THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='對象編號'
  	   THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='對象簡稱'
  	   THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='業務人員'
  	   THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='業務助理'
  	   THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='收款日期' 
  	   THISFORM.GRID1.COLUMN11.HEADER1.CAPTION='逾期天數' 
  	   THISFORM.GRID1.COLUMN12.HEADER1.CAPTION='收款方式' 
  	   THISFORM.GRID1.COLUMN13.HEADER1.CAPTION='開單未沖金額' 
  	   THISFORM.GRID1.COLUMN14.HEADER1.CAPTION='幣別'
  	   THISFORM.GRID1.COLUMN15.HEADER1.CAPTION='匯率' 
  	   THISFORM.GRID1.COLUMN16.HEADER1.CAPTION='外幣金額'   	   
  	   THISFORM.GRID1.COLUMN17.HEADER1.CAPTION='外幣未沖金額' 
  	   THISFORM.GRID1.COLUMN18.HEADER1.CAPTION='備        註'
  	   THISFORM.GRID1.COLUMN19.HEADER1.CAPTION='發票類別'
  	   THISFORM.GRID1.COLUMN20.HEADER1.CAPTION='統一編號'
  	   THISFORM.GRID1.COLUMN21.HEADER1.CAPTION='業務編號'
  	   THISFORM.GRID1.COLUMN22.HEADER1.CAPTION='業助編號'  
  	   THISFORM.GRID1.COLUMN23.HEADER1.CAPTION='安全資料'	   
	   THISFORM.GRID1.COLUMN1.CONTROLSOURCE='K51.F01'
	   THISFORM.GRID1.COLUMN2.CONTROLSOURCE='K51.F02'
	   THISFORM.GRID1.COLUMN3.CONTROLSOURCE='K51.F07'
	   THISFORM.GRID1.COLUMN4.CONTROLSOURCE='K51.F10'
	   THISFORM.GRID1.COLUMN5.CONTROLSOURCE='K51.F05'
	   THISFORM.GRID1.COLUMN6.CONTROLSOURCE='K51.F06'
	   THISFORM.GRID1.COLUMN7.CONTROLSOURCE='K51.F11'
  	   THISFORM.GRID1.COLUMN8.CONTROLSOURCE="IIF(SEEK(K51.F17,'A01'),A01.F03,'')"
  	   THISFORM.GRID1.COLUMN9.CONTROLSOURCE="IIF(SEEK(K51.F18,'A01'),A01.F03,'')"
  	   THISFORM.GRID1.COLUMN10.CONTROLSOURCE='K51.F15'
  	   THISFORM.GRID1.COLUMN11.CONTROLSOURCE="IIF((DATE()-K51.F15)<0,'尚未逾期',DATE()-K51.F15)"
	   THISFORM.GRID1.COLUMN12.CONTROLSOURCE='K51.F16'
	   THISFORM.GRID1.COLUMN13.CONTROLSOURCE='K51.F09'
	   THISFORM.GRID1.COLUMN14.CONTROLSOURCE='K51.F12'
	   THISFORM.GRID1.COLUMN15.CONTROLSOURCE='K51.F13'
	   THISFORM.GRID1.COLUMN16.CONTROLSOURCE='K51.F14'	   
	   THISFORM.GRID1.COLUMN17.CONTROLSOURCE="ROUND(K51.F10/K51.F13,3)"
	   THISFORM.GRID1.COLUMN18.CONTROLSOURCE='K51.F08'
	   THISFORM.GRID1.COLUMN19.CONTROLSOURCE="K51.F03+BILL(K51.F03)"
	   THISFORM.GRID1.COLUMN20.CONTROLSOURCE='K51.F04'
	   THISFORM.GRID1.COLUMN21.CONTROLSOURCE='K51.F17'
	   THISFORM.GRID1.COLUMN22.CONTROLSOURCE='K51.F18'
	   THISFORM.GRID1.COLUMN23.CONTROLSOURCE='K51.F20' 
      CASE THIS.DISPLAYVALUE='依發票日期+發票號碼排列'
           SET ORDER TO K514
	   THISFORM.GRID1.COLUMN1.WIDTH=INT_015*60
           THISFORM.GRID1.COLUMN2.WIDTH=INT_015*80	   
	   THISFORM.GRID1.COLUMN3.WIDTH=INT_015*60
	   THISFORM.GRID1.COLUMN4.WIDTH=INT_015*65
	   THISFORM.GRID1.COLUMN5.WIDTH=INT_015*75
	   THISFORM.GRID1.COLUMN6.WIDTH=INT_015*50
	   THISFORM.GRID1.COLUMN7.WIDTH=INT_015*55
	   THISFORM.GRID1.COLUMN8.WIDTH=INT_015*55
	   THISFORM.GRID1.COLUMN9.WIDTH=INT_015*55
	   THISFORM.GRID1.COLUMN10.WIDTH=INT_015*60
	   THISFORM.GRID1.COLUMN11.WIDTH=INT_015*55
	   THISFORM.GRID1.COLUMN12.WIDTH=INT_015*100
	   THISFORM.GRID1.COLUMN13.WIDTH=INT_015*75  
           THISFORM.GRID1.COLUMN14.WIDTH=INT_015*35
           THISFORM.GRID1.COLUMN15.WIDTH=INT_015*65
           THISFORM.GRID1.COLUMN16.WIDTH=INT_015*60       
           THISFORM.GRID1.COLUMN17.WIDTH=INT_015*75       
           THISFORM.GRID1.COLUMN18.WIDTH=INT_015*120 
           THISFORM.GRID1.COLUMN19.WIDTH=INT_015*149
           THISFORM.GRID1.COLUMN20.WIDTH=INT_015*60 
           THISFORM.GRID1.COLUMN21.WIDTH=INT_015*50
           THISFORM.GRID1.COLUMN22.WIDTH=INT_015*50	
           THISFORM.GRID1.COLUMN23.WIDTH=INT_015*90           
	   THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='發票日期'
           THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='發票號碼'	   
	   THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='發票總額'  
	   THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='未沖銷金額'  
	   THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='憑證單號'
  	   THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='對象編號'
  	   THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='對象簡稱'
  	   THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='業務人員'
  	   THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='業務助理'
  	   THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='收款日期' 
  	   THISFORM.GRID1.COLUMN11.HEADER1.CAPTION='逾期天數' 
  	   THISFORM.GRID1.COLUMN12.HEADER1.CAPTION='收款方式' 
  	   THISFORM.GRID1.COLUMN13.HEADER1.CAPTION='開單未沖金額' 
  	   THISFORM.GRID1.COLUMN14.HEADER1.CAPTION='幣別'
  	   THISFORM.GRID1.COLUMN15.HEADER1.CAPTION='匯率' 
  	   THISFORM.GRID1.COLUMN16.HEADER1.CAPTION='外幣金額'   	   
  	   THISFORM.GRID1.COLUMN17.HEADER1.CAPTION='外幣未沖金額' 
  	   THISFORM.GRID1.COLUMN18.HEADER1.CAPTION='備        註'
  	   THISFORM.GRID1.COLUMN19.HEADER1.CAPTION='發票類別'
  	   THISFORM.GRID1.COLUMN20.HEADER1.CAPTION='統一編號'
  	   THISFORM.GRID1.COLUMN21.HEADER1.CAPTION='業務編號'
  	   THISFORM.GRID1.COLUMN22.HEADER1.CAPTION='業助編號'  
  	   THISFORM.GRID1.COLUMN23.HEADER1.CAPTION='安全資料'	   
	   THISFORM.GRID1.COLUMN1.CONTROLSOURCE='K51.F02'  	   
	   THISFORM.GRID1.COLUMN2.CONTROLSOURCE='K51.F01'
	   THISFORM.GRID1.COLUMN3.CONTROLSOURCE='K51.F07'
	   THISFORM.GRID1.COLUMN4.CONTROLSOURCE='K51.F10'
	   THISFORM.GRID1.COLUMN5.CONTROLSOURCE='K51.F05'
	   THISFORM.GRID1.COLUMN6.CONTROLSOURCE='K51.F06'
	   THISFORM.GRID1.COLUMN7.CONTROLSOURCE='K51.F11'
  	   THISFORM.GRID1.COLUMN8.CONTROLSOURCE="IIF(SEEK(K51.F17,'A01'),A01.F03,'')"
  	   THISFORM.GRID1.COLUMN9.CONTROLSOURCE="IIF(SEEK(K51.F18,'A01'),A01.F03,'')"
  	   THISFORM.GRID1.COLUMN10.CONTROLSOURCE='K51.F15'
  	   THISFORM.GRID1.COLUMN11.CONTROLSOURCE="IIF((DATE()-K51.F15)<0,'尚未逾期',DATE()-K51.F15)"
	   THISFORM.GRID1.COLUMN12.CONTROLSOURCE='K51.F16'
	   THISFORM.GRID1.COLUMN13.CONTROLSOURCE='K51.F09'
	   THISFORM.GRID1.COLUMN14.CONTROLSOURCE='K51.F12'
	   THISFORM.GRID1.COLUMN15.CONTROLSOURCE='K51.F13'
	   THISFORM.GRID1.COLUMN16.CONTROLSOURCE='K51.F14'	   
	   THISFORM.GRID1.COLUMN17.CONTROLSOURCE="ROUND(K51.F10/K51.F13,3)"
	   THISFORM.GRID1.COLUMN18.CONTROLSOURCE='K51.F08'
	   THISFORM.GRID1.COLUMN19.CONTROLSOURCE="K51.F03+BILL(K51.F03)"
	   THISFORM.GRID1.COLUMN20.CONTROLSOURCE='K51.F04'    	    
	   THISFORM.GRID1.COLUMN21.CONTROLSOURCE='K51.F17'
	   THISFORM.GRID1.COLUMN22.CONTROLSOURCE='K51.F18'         
	   THISFORM.GRID1.COLUMN23.CONTROLSOURCE='K51.F20' 
      CASE THIS.DISPLAYVALUE='依對象編號+發票日期排列'
          SET ORDER TO K512
           THISFORM.GRID1.COLUMN1.WIDTH=INT_015*50
           THISFORM.GRID1.COLUMN2.WIDTH=INT_015*55
           THISFORM.GRID1.COLUMN3.WIDTH=INT_015*80
           THISFORM.GRID1.COLUMN4.WIDTH=INT_015*60
           THISFORM.GRID1.COLUMN5.WIDTH=INT_015*60
           THISFORM.GRID1.COLUMN6.WIDTH=INT_015*65
           THISFORM.GRID1.COLUMN7.WIDTH=INT_015*75
           THISFORM.GRID1.COLUMN8.WIDTH=INT_015*55
           THISFORM.GRID1.COLUMN9.WIDTH=INT_015*55
	   THISFORM.GRID1.COLUMN10.WIDTH=INT_015*60
	   THISFORM.GRID1.COLUMN11.WIDTH=INT_015*55
	   THISFORM.GRID1.COLUMN12.WIDTH=INT_015*100
           THISFORM.GRID1.COLUMN13.WIDTH=INT_015*75 
           THISFORM.GRID1.COLUMN14.WIDTH=INT_015*35
           THISFORM.GRID1.COLUMN15.WIDTH=INT_015*65
           THISFORM.GRID1.COLUMN16.WIDTH=INT_015*60       
           THISFORM.GRID1.COLUMN17.WIDTH=INT_015*75       
           THISFORM.GRID1.COLUMN18.WIDTH=INT_015*120 
           THISFORM.GRID1.COLUMN19.WIDTH=INT_015*149
           THISFORM.GRID1.COLUMN20.WIDTH=INT_015*60 
           THISFORM.GRID1.COLUMN21.WIDTH=INT_015*50
           THISFORM.GRID1.COLUMN22.WIDTH=INT_015*50	   
           THISFORM.GRID1.COLUMN23.WIDTH=INT_015*90        
           THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='對象編號'  	   
  	   THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='對象簡稱'
           THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='發票號碼'
	   THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='發票日期'
	   THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='發票總額'  
	   THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='未沖銷金額'  
	   THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='憑證單號'
  	   THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='業務人員'
  	   THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='業務助理'
  	   THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='收款日期' 
  	   THISFORM.GRID1.COLUMN11.HEADER1.CAPTION='逾期天數' 
  	   THISFORM.GRID1.COLUMN12.HEADER1.CAPTION='收款方式' 	
  	   THISFORM.GRID1.COLUMN13.HEADER1.CAPTION='開單未沖金額'    
  	   THISFORM.GRID1.COLUMN14.HEADER1.CAPTION='幣別'
  	   THISFORM.GRID1.COLUMN15.HEADER1.CAPTION='匯率' 
  	   THISFORM.GRID1.COLUMN16.HEADER1.CAPTION='外幣金額'   	   
  	   THISFORM.GRID1.COLUMN17.HEADER1.CAPTION='外幣未沖金額' 
  	   THISFORM.GRID1.COLUMN18.HEADER1.CAPTION='備        註'
  	   THISFORM.GRID1.COLUMN19.HEADER1.CAPTION='發票類別'
  	   THISFORM.GRID1.COLUMN20.HEADER1.CAPTION='統一編號'
  	   THISFORM.GRID1.COLUMN21.HEADER1.CAPTION='業務編號'
  	   THISFORM.GRID1.COLUMN22.HEADER1.CAPTION='業助編號'  	
  	   THISFORM.GRID1.COLUMN23.HEADER1.CAPTION='安全資料'   
  	   THISFORM.GRID1.COLUMN1.CONTROLSOURCE='K51.F06'
	   THISFORM.GRID1.COLUMN2.CONTROLSOURCE='K51.F11'
	   THISFORM.GRID1.COLUMN3.CONTROLSOURCE='K51.F01'
	   THISFORM.GRID1.COLUMN4.CONTROLSOURCE='K51.F02'
	   THISFORM.GRID1.COLUMN5.CONTROLSOURCE='K51.F07'
	   THISFORM.GRID1.COLUMN6.CONTROLSOURCE='K51.F10'
	   THISFORM.GRID1.COLUMN7.CONTROLSOURCE='K51.F05'
  	   THISFORM.GRID1.COLUMN8.CONTROLSOURCE="IIF(SEEK(K51.F17,'A01'),A01.F03,'')"
  	   THISFORM.GRID1.COLUMN9.CONTROLSOURCE="IIF(SEEK(K51.F18,'A01'),A01.F03,'')"
  	   THISFORM.GRID1.COLUMN10.CONTROLSOURCE='K51.F15'
  	   THISFORM.GRID1.COLUMN11.CONTROLSOURCE="IIF((DATE()-K51.F15)<0,'尚未逾期',DATE()-K51.F15)"
	   THISFORM.GRID1.COLUMN12.CONTROLSOURCE='K51.F16'
	   THISFORM.GRID1.COLUMN13.CONTROLSOURCE='K51.F09'
	   THISFORM.GRID1.COLUMN14.CONTROLSOURCE='K51.F12'
	   THISFORM.GRID1.COLUMN15.CONTROLSOURCE='K51.F13'
	   THISFORM.GRID1.COLUMN16.CONTROLSOURCE='K51.F14'	   
	   THISFORM.GRID1.COLUMN17.CONTROLSOURCE="ROUND(K51.F10/K51.F13,3)"
	   THISFORM.GRID1.COLUMN18.CONTROLSOURCE='K51.F08'
	   THISFORM.GRID1.COLUMN19.CONTROLSOURCE="K51.F03+BILL(K51.F03)"
	   THISFORM.GRID1.COLUMN20.CONTROLSOURCE='K51.F04'
	   THISFORM.GRID1.COLUMN21.CONTROLSOURCE='K51.F17'
	   THISFORM.GRID1.COLUMN22.CONTROLSOURCE='K51.F18'  
	   THISFORM.GRID1.COLUMN23.CONTROLSOURCE='K51.F20' 
	CASE THIS.DISPLAYVALUE='依對象簡稱+發票日期排列'
            SET ORDER TO K513 
           THISFORM.GRID1.COLUMN1.WIDTH=INT_015*55
           THISFORM.GRID1.COLUMN2.WIDTH=INT_015*50
           THISFORM.GRID1.COLUMN3.WIDTH=INT_015*80
           THISFORM.GRID1.COLUMN4.WIDTH=INT_015*60
           THISFORM.GRID1.COLUMN5.WIDTH=INT_015*60
           THISFORM.GRID1.COLUMN6.WIDTH=INT_015*65
           THISFORM.GRID1.COLUMN7.WIDTH=INT_015*75
           THISFORM.GRID1.COLUMN8.WIDTH=INT_015*55
           THISFORM.GRID1.COLUMN9.WIDTH=INT_015*55
	   THISFORM.GRID1.COLUMN10.WIDTH=INT_015*60
	   THISFORM.GRID1.COLUMN11.WIDTH=INT_015*55
	   THISFORM.GRID1.COLUMN12.WIDTH=INT_015*100
           THISFORM.GRID1.COLUMN13.WIDTH=INT_015*75 
           THISFORM.GRID1.COLUMN14.WIDTH=INT_015*35
           THISFORM.GRID1.COLUMN15.WIDTH=INT_015*65
           THISFORM.GRID1.COLUMN16.WIDTH=INT_015*60       
           THISFORM.GRID1.COLUMN17.WIDTH=INT_015*75       
           THISFORM.GRID1.COLUMN18.WIDTH=INT_015*120 
           THISFORM.GRID1.COLUMN19.WIDTH=INT_015*149
           THISFORM.GRID1.COLUMN20.WIDTH=INT_015*60  
           THISFORM.GRID1.COLUMN21.WIDTH=INT_015*50
           THISFORM.GRID1.COLUMN22.WIDTH=INT_015*50	  
           THISFORM.GRID1.COLUMN23.WIDTH=INT_015*90         
  	   THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='對象簡稱'
  	   THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='對象編號'  	
           THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='發票號碼'
	   THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='發票日期'
	   THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='發票總額'  
	   THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='未沖銷金額'  
	   THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='憑證單號'
  	   THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='業務人員'
  	   THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='業務助理'
  	   THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='收款日期' 
  	   THISFORM.GRID1.COLUMN11.HEADER1.CAPTION='逾期天數' 
  	   THISFORM.GRID1.COLUMN12.HEADER1.CAPTION='收款方式' 	
  	   THISFORM.GRID1.COLUMN13.HEADER1.CAPTION='開單未沖金額'    
  	   THISFORM.GRID1.COLUMN14.HEADER1.CAPTION='幣別'
  	   THISFORM.GRID1.COLUMN15.HEADER1.CAPTION='匯率' 
  	   THISFORM.GRID1.COLUMN16.HEADER1.CAPTION='外幣金額'   	   
  	   THISFORM.GRID1.COLUMN17.HEADER1.CAPTION='外幣未沖金額' 
  	   THISFORM.GRID1.COLUMN18.HEADER1.CAPTION='備        註'
  	   THISFORM.GRID1.COLUMN19.HEADER1.CAPTION='發票類別'
  	   THISFORM.GRID1.COLUMN20.HEADER1.CAPTION='統一編號'
  	   THISFORM.GRID1.COLUMN21.HEADER1.CAPTION='業務編號'
  	   THISFORM.GRID1.COLUMN22.HEADER1.CAPTION='業助編號'  
  	   THISFORM.GRID1.COLUMN23.HEADER1.CAPTION='安全資料'	   
  	   THISFORM.GRID1.COLUMN1.CONTROLSOURCE='K51.F11'
  	   THISFORM.GRID1.COLUMN2.CONTROLSOURCE='K51.F06'
	   THISFORM.GRID1.COLUMN3.CONTROLSOURCE='K51.F01'
	   THISFORM.GRID1.COLUMN4.CONTROLSOURCE='K51.F02'
	   THISFORM.GRID1.COLUMN5.CONTROLSOURCE='K51.F07'
	   THISFORM.GRID1.COLUMN6.CONTROLSOURCE='K51.F10'
	   THISFORM.GRID1.COLUMN7.CONTROLSOURCE='K51.F05'
  	   THISFORM.GRID1.COLUMN8.CONTROLSOURCE="IIF(SEEK(K51.F17,'A01'),A01.F03,'')"
  	   THISFORM.GRID1.COLUMN9.CONTROLSOURCE="IIF(SEEK(K51.F18,'A01'),A01.F03,'')"
  	   THISFORM.GRID1.COLUMN10.CONTROLSOURCE='K51.F15'
  	   THISFORM.GRID1.COLUMN11.CONTROLSOURCE="IIF((DATE()-K51.F15)<0,'尚未逾期',DATE()-K51.F15)"
	   THISFORM.GRID1.COLUMN12.CONTROLSOURCE='K51.F16'
	   THISFORM.GRID1.COLUMN13.CONTROLSOURCE='K51.F09'
	   THISFORM.GRID1.COLUMN14.CONTROLSOURCE='K51.F12'
	   THISFORM.GRID1.COLUMN15.CONTROLSOURCE='K51.F13'
	   THISFORM.GRID1.COLUMN16.CONTROLSOURCE='K51.F14'	   
	   THISFORM.GRID1.COLUMN17.CONTROLSOURCE="ROUND(K51.F10/K51.F13,3)"
	   THISFORM.GRID1.COLUMN18.CONTROLSOURCE='K51.F08'
	   THISFORM.GRID1.COLUMN19.CONTROLSOURCE="K51.F03+BILL(K51.F03)"
	   THISFORM.GRID1.COLUMN20.CONTROLSOURCE='K51.F04'    
	   THISFORM.GRID1.COLUMN21.CONTROLSOURCE='K51.F17'
	   THISFORM.GRID1.COLUMN22.CONTROLSOURCE='K51.F18'   
	   THISFORM.GRID1.COLUMN23.CONTROLSOURCE='K51.F20' 
      CASE THIS.DISPLAYVALUE='依憑證單號+發票日期排列'
           SET ORDER TO K515
           THISFORM.GRID1.COLUMN1.WIDTH=INT_015*75
           THISFORM.GRID1.COLUMN2.WIDTH=INT_015*80
	   THISFORM.GRID1.COLUMN3.WIDTH=INT_015*60
	   THISFORM.GRID1.COLUMN4.WIDTH=INT_015*60
	   THISFORM.GRID1.COLUMN5.WIDTH=INT_015*65
	   THISFORM.GRID1.COLUMN6.WIDTH=INT_015*50
	   THISFORM.GRID1.COLUMN7.WIDTH=INT_015*55
	   THISFORM.GRID1.COLUMN8.WIDTH=INT_015*55
	   THISFORM.GRID1.COLUMN9.WIDTH=INT_015*55
	   THISFORM.GRID1.COLUMN10.WIDTH=INT_015*60
	   THISFORM.GRID1.COLUMN11.WIDTH=INT_015*55
	   THISFORM.GRID1.COLUMN12.WIDTH=INT_015*100
	   THISFORM.GRID1.COLUMN13.WIDTH=INT_015*75  
           THISFORM.GRID1.COLUMN14.WIDTH=INT_015*35
           THISFORM.GRID1.COLUMN15.WIDTH=INT_015*65
           THISFORM.GRID1.COLUMN16.WIDTH=INT_015*60       
           THISFORM.GRID1.COLUMN17.WIDTH=INT_015*75       
           THISFORM.GRID1.COLUMN18.WIDTH=INT_015*120 
           THISFORM.GRID1.COLUMN19.WIDTH=INT_015*149
           THISFORM.GRID1.COLUMN20.WIDTH=INT_015*60  
           THISFORM.GRID1.COLUMN21.WIDTH=INT_015*50
           THISFORM.GRID1.COLUMN22.WIDTH=INT_015*50	     
           THISFORM.GRID1.COLUMN23.WIDTH=INT_015*90     
           THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='憑證單號'
           THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='發票號碼'
	   THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='發票日期'
	   THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='發票總額'  
	   THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='未沖銷金額'  
  	   THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='對象編號'
  	   THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='對象簡稱'
  	   THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='業務人員'
  	   THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='業務助理'
  	   THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='收款日期' 
  	   THISFORM.GRID1.COLUMN11.HEADER1.CAPTION='逾期天數' 
  	   THISFORM.GRID1.COLUMN12.HEADER1.CAPTION='收款方式' 
  	   THISFORM.GRID1.COLUMN13.HEADER1.CAPTION='開單未沖金額' 
  	   THISFORM.GRID1.COLUMN14.HEADER1.CAPTION='幣別'
  	   THISFORM.GRID1.COLUMN15.HEADER1.CAPTION='匯率' 
  	   THISFORM.GRID1.COLUMN16.HEADER1.CAPTION='外幣金額'   	   
  	   THISFORM.GRID1.COLUMN17.HEADER1.CAPTION='外幣未沖金額' 
  	   THISFORM.GRID1.COLUMN18.HEADER1.CAPTION='備        註'
  	   THISFORM.GRID1.COLUMN19.HEADER1.CAPTION='發票類別'
  	   THISFORM.GRID1.COLUMN20.HEADER1.CAPTION='統一編號'
  	   THISFORM.GRID1.COLUMN21.HEADER1.CAPTION='業務編號'
  	   THISFORM.GRID1.COLUMN22.HEADER1.CAPTION='業助編號'  	
  	   THISFORM.GRID1.COLUMN23.HEADER1.CAPTION='安全資料'   
  	   THISFORM.GRID1.COLUMN1.CONTROLSOURCE='K51.F05'
	   THISFORM.GRID1.COLUMN2.CONTROLSOURCE='K51.F01'
	   THISFORM.GRID1.COLUMN3.CONTROLSOURCE='K51.F02'
	   THISFORM.GRID1.COLUMN4.CONTROLSOURCE='K51.F07'
	   THISFORM.GRID1.COLUMN5.CONTROLSOURCE='K51.F10'
	   THISFORM.GRID1.COLUMN6.CONTROLSOURCE='K51.F06'
	   THISFORM.GRID1.COLUMN7.CONTROLSOURCE='K51.F11'
  	   THISFORM.GRID1.COLUMN8.CONTROLSOURCE="IIF(SEEK(K51.F17,'A01'),A01.F03,'')"
  	   THISFORM.GRID1.COLUMN9.CONTROLSOURCE="IIF(SEEK(K51.F18,'A01'),A01.F03,'')"
  	   THISFORM.GRID1.COLUMN10.CONTROLSOURCE='K51.F15'
  	   THISFORM.GRID1.COLUMN11.CONTROLSOURCE="IIF((DATE()-K51.F15)<0,'尚未逾期',DATE()-K51.F15)"
	   THISFORM.GRID1.COLUMN12.CONTROLSOURCE='K51.F16'
	   THISFORM.GRID1.COLUMN13.CONTROLSOURCE='K51.F09'
	   THISFORM.GRID1.COLUMN14.CONTROLSOURCE='K51.F12'
	   THISFORM.GRID1.COLUMN15.CONTROLSOURCE='K51.F13'
	   THISFORM.GRID1.COLUMN16.CONTROLSOURCE='K51.F14'	   
	   THISFORM.GRID1.COLUMN17.CONTROLSOURCE="ROUND(K51.F10/K51.F13,3)"
	   THISFORM.GRID1.COLUMN18.CONTROLSOURCE='K51.F08'
	   THISFORM.GRID1.COLUMN19.CONTROLSOURCE="K51.F03+BILL(K51.F03)"
	   THISFORM.GRID1.COLUMN20.CONTROLSOURCE='K51.F04'  	  
	   THISFORM.GRID1.COLUMN21.CONTROLSOURCE='K51.F17'
	   THISFORM.GRID1.COLUMN22.CONTROLSOURCE='K51.F18'	   
	   THISFORM.GRID1.COLUMN23.CONTROLSOURCE='K51.F20'   
      CASE THIS.DISPLAYVALUE='依業務編號+收款日期排列'
           SET ORDER TO K516
           THISFORM.GRID1.COLUMN1.WIDTH=INT_015*50
           THISFORM.GRID1.COLUMN2.WIDTH=INT_015*55
           THISFORM.GRID1.COLUMN3.WIDTH=INT_015*80
	   THISFORM.GRID1.COLUMN4.WIDTH=INT_015*60
	   THISFORM.GRID1.COLUMN5.WIDTH=INT_015*60
	   THISFORM.GRID1.COLUMN6.WIDTH=INT_015*65
	   THISFORM.GRID1.COLUMN7.WIDTH=INT_015*75
	   THISFORM.GRID1.COLUMN8.WIDTH=INT_015*50
	   THISFORM.GRID1.COLUMN9.WIDTH=INT_015*55
	   THISFORM.GRID1.COLUMN10.WIDTH=INT_015*55
	   THISFORM.GRID1.COLUMN11.WIDTH=INT_015*60
	   THISFORM.GRID1.COLUMN12.WIDTH=INT_015*55
	   THISFORM.GRID1.COLUMN13.WIDTH=INT_015*100
	   THISFORM.GRID1.COLUMN14.WIDTH=INT_015*75  
	   THISFORM.GRID1.COLUMN15.WIDTH=INT_015*35
	   THISFORM.GRID1.COLUMN16.WIDTH=INT_015*65
	   THISFORM.GRID1.COLUMN17.WIDTH=INT_015*60       
	   THISFORM.GRID1.COLUMN18.WIDTH=INT_015*75       
	   THISFORM.GRID1.COLUMN19.WIDTH=INT_015*120 
	   THISFORM.GRID1.COLUMN20.WIDTH=INT_015*149
	   THISFORM.GRID1.COLUMN21.WIDTH=INT_015*60
	   THISFORM.GRID1.COLUMN22.WIDTH=INT_015*50
	   THISFORM.GRID1.COLUMN23.WIDTH=INT_015*90
	   THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='業務編號'
	   THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='業務人員'
           THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='發票號碼'
	   THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='發票日期'
	   THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='發票總額'  
	   THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='未沖銷金額'  
	   THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='憑證單號'
  	   THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='對象編號'
  	   THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='對象簡稱'
  	   THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='業務助理'
  	   THISFORM.GRID1.COLUMN11.HEADER1.CAPTION='收款日期' 
  	   THISFORM.GRID1.COLUMN12.HEADER1.CAPTION='逾期天數' 
  	   THISFORM.GRID1.COLUMN13.HEADER1.CAPTION='收款方式' 
  	   THISFORM.GRID1.COLUMN14.HEADER1.CAPTION='開單未沖金額' 
  	   THISFORM.GRID1.COLUMN15.HEADER1.CAPTION='幣別'
  	   THISFORM.GRID1.COLUMN16.HEADER1.CAPTION='匯率' 
  	   THISFORM.GRID1.COLUMN17.HEADER1.CAPTION='外幣金額'   	   
  	   THISFORM.GRID1.COLUMN18.HEADER1.CAPTION='外幣未沖金額' 
  	   THISFORM.GRID1.COLUMN19.HEADER1.CAPTION='備        註'
  	   THISFORM.GRID1.COLUMN20.HEADER1.CAPTION='發票類別'
  	   THISFORM.GRID1.COLUMN21.HEADER1.CAPTION='統一編號'
  	   THISFORM.GRID1.COLUMN22.HEADER1.CAPTION='業助編號'
  	   THISFORM.GRID1.COLUMN23.HEADER1.CAPTION='安全資料'
	   THISFORM.GRID1.COLUMN1.CONTROLSOURCE='K51.F17'
	   THISFORM.GRID1.COLUMN2.CONTROLSOURCE="IIF(SEEK(K51.F17,'A01'),A01.F03,'')"	   
	   THISFORM.GRID1.COLUMN3.CONTROLSOURCE='K51.F01'
	   THISFORM.GRID1.COLUMN4.CONTROLSOURCE='K51.F02'
	   THISFORM.GRID1.COLUMN5.CONTROLSOURCE='K51.F07'
	   THISFORM.GRID1.COLUMN6.CONTROLSOURCE='K51.F10'
	   THISFORM.GRID1.COLUMN7.CONTROLSOURCE='K51.F05'
	   THISFORM.GRID1.COLUMN8.CONTROLSOURCE='K51.F06'
	   THISFORM.GRID1.COLUMN9.CONTROLSOURCE='K51.F11'
  	   THISFORM.GRID1.COLUMN10.CONTROLSOURCE="IIF(SEEK(K51.F18,'A01'),A01.F03,'')"
  	   THISFORM.GRID1.COLUMN11.CONTROLSOURCE='K51.F15'
  	   THISFORM.GRID1.COLUMN12.CONTROLSOURCE="IIF((DATE()-K51.F15)<0,'尚未逾期',DATE()-K51.F15)"
	   THISFORM.GRID1.COLUMN13.CONTROLSOURCE='K51.F16'
	   THISFORM.GRID1.COLUMN14.CONTROLSOURCE='K51.F09'
	   THISFORM.GRID1.COLUMN15.CONTROLSOURCE='K51.F12'
	   THISFORM.GRID1.COLUMN16.CONTROLSOURCE='K51.F13'
	   THISFORM.GRID1.COLUMN17.CONTROLSOURCE='K51.F14'	   
	   THISFORM.GRID1.COLUMN18.CONTROLSOURCE="ROUND(K51.F10/K51.F13,3)"
	   THISFORM.GRID1.COLUMN19.CONTROLSOURCE='K51.F08'
	   THISFORM.GRID1.COLUMN20.CONTROLSOURCE="K51.F03+BILL(K51.F03)"
	   THISFORM.GRID1.COLUMN21.CONTROLSOURCE='K51.F04'	   
	   THISFORM.GRID1.COLUMN22.CONTROLSOURCE='K51.F18'	
	   THISFORM.GRID1.COLUMN23.CONTROLSOURCE='K51.F20'       
      CASE THIS.DISPLAYVALUE='依業助編號+收款日期排列'
           SET ORDER TO K517
           THISFORM.GRID1.COLUMN1.WIDTH=INT_015*50
           THISFORM.GRID1.COLUMN2.WIDTH=INT_015*55
           THISFORM.GRID1.COLUMN3.WIDTH=INT_015*80
	   THISFORM.GRID1.COLUMN4.WIDTH=INT_015*60
	   THISFORM.GRID1.COLUMN5.WIDTH=INT_015*60
	   THISFORM.GRID1.COLUMN6.WIDTH=INT_015*65
	   THISFORM.GRID1.COLUMN7.WIDTH=INT_015*75
	   THISFORM.GRID1.COLUMN8.WIDTH=INT_015*50
	   THISFORM.GRID1.COLUMN9.WIDTH=INT_015*55
	   THISFORM.GRID1.COLUMN10.WIDTH=INT_015*55 
	   THISFORM.GRID1.COLUMN11.WIDTH=INT_015*60
	   THISFORM.GRID1.COLUMN12.WIDTH=INT_015*55
	   THISFORM.GRID1.COLUMN13.WIDTH=INT_015*100
	   THISFORM.GRID1.COLUMN14.WIDTH=INT_015*75  
	   THISFORM.GRID1.COLUMN15.WIDTH=INT_015*35
	   THISFORM.GRID1.COLUMN16.WIDTH=INT_015*65
	   THISFORM.GRID1.COLUMN17.WIDTH=INT_015*60       
	   THISFORM.GRID1.COLUMN18.WIDTH=INT_015*75       
	   THISFORM.GRID1.COLUMN19.WIDTH=INT_015*120 
	   THISFORM.GRID1.COLUMN20.WIDTH=INT_015*149
	   THISFORM.GRID1.COLUMN21.WIDTH=INT_015*60
	   THISFORM.GRID1.COLUMN22.WIDTH=INT_015*50
	   THISFORM.GRID1.COLUMN23.WIDTH=INT_015*90
	   THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='業助編號'
	   THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='業務助理'
           THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='發票號碼'
	   THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='發票日期'
	   THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='發票總額'  
	   THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='未沖銷金額'  
	   THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='憑證單號'
  	   THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='對象編號'
  	   THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='對象簡稱'
  	   THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='業務人員'  
  	   THISFORM.GRID1.COLUMN11.HEADER1.CAPTION='收款日期' 
  	   THISFORM.GRID1.COLUMN12.HEADER1.CAPTION='逾期天數'   
  	   THISFORM.GRID1.COLUMN13.HEADER1.CAPTION='收款方式' 
  	   THISFORM.GRID1.COLUMN14.HEADER1.CAPTION='開單未沖金額' 
  	   THISFORM.GRID1.COLUMN15.HEADER1.CAPTION='幣別'
  	   THISFORM.GRID1.COLUMN16.HEADER1.CAPTION='匯率' 
  	   THISFORM.GRID1.COLUMN17.HEADER1.CAPTION='外幣金額'   	   
  	   THISFORM.GRID1.COLUMN18.HEADER1.CAPTION='外幣未沖金額' 
  	   THISFORM.GRID1.COLUMN19.HEADER1.CAPTION='備        註'
  	   THISFORM.GRID1.COLUMN20.HEADER1.CAPTION='發票類別'
  	   THISFORM.GRID1.COLUMN21.HEADER1.CAPTION='統一編號'
  	   THISFORM.GRID1.COLUMN22.HEADER1.CAPTION='業務編號'
  	   THISFORM.GRID1.COLUMN23.HEADER1.CAPTION='安全資料'
  	   THISFORM.GRID1.COLUMN1.CONTROLSOURCE='K51.F18'
  	   THISFORM.GRID1.COLUMN2.CONTROLSOURCE="IIF(SEEK(K51.F18,'A01'),A01.F03,'')"
	   THISFORM.GRID1.COLUMN3.CONTROLSOURCE='K51.F01'
	   THISFORM.GRID1.COLUMN4.CONTROLSOURCE='K51.F02'
	   THISFORM.GRID1.COLUMN5.CONTROLSOURCE='K51.F07'
	   THISFORM.GRID1.COLUMN6.CONTROLSOURCE='K51.F10'
	   THISFORM.GRID1.COLUMN7.CONTROLSOURCE='K51.F05'
	   THISFORM.GRID1.COLUMN8.CONTROLSOURCE='K51.F06'
	   THISFORM.GRID1.COLUMN9.CONTROLSOURCE='K51.F11'
  	   THISFORM.GRID1.COLUMN8.CONTROLSOURCE="IIF(SEEK(K51.F17,'A01'),A01.F03,'')" 
  	   THISFORM.GRID1.COLUMN11.CONTROLSOURCE='K51.F15'
  	   THISFORM.GRID1.COLUMN12.CONTROLSOURCE="IIF((DATE()-K51.F15)<0,'尚未逾期',DATE()-K51.F15)"
	   THISFORM.GRID1.COLUMN13.CONTROLSOURCE='K51.F16'
	   THISFORM.GRID1.COLUMN14.CONTROLSOURCE='K51.F09'
	   THISFORM.GRID1.COLUMN15.CONTROLSOURCE='K51.F12'
	   THISFORM.GRID1.COLUMN16.CONTROLSOURCE='K51.F13'
	   THISFORM.GRID1.COLUMN17.CONTROLSOURCE='K51.F14'	   
	   THISFORM.GRID1.COLUMN18.CONTROLSOURCE="ROUND(K51.F10/K51.F13,3)"
	   THISFORM.GRID1.COLUMN19.CONTROLSOURCE='K51.F08'
	   THISFORM.GRID1.COLUMN20.CONTROLSOURCE="K51.F03+BILL(K51.F03)"
	   THISFORM.GRID1.COLUMN21.CONTROLSOURCE='K51.F04'	
	   THISFORM.GRID1.COLUMN22.CONTROLSOURCE='K51.F17'      	
	   THISFORM.GRID1.COLUMN23.CONTROLSOURCE='K51.F20'                                                                
   ENDCASE 
       JK=THISFORM.GRID1.COLUMN1.HEADER1.CAPTION
       THISFORM.GRID1.REFRESH
       THISFORM.GRID1.SETFOCUS
  ENDPROC 
********************                 
  PROC GRID1.AFTERROWCOLCHANGE
       LPARAMETERS NCOLINDEX
       THISFORM.GRID1.TOOLTIPTEXT=IIF((DATE()-K51.F15)=>0 .AND. (DATE()-K51.F15)<INT_210,'已到收款日',IIF((DATE()-K51.F15)>=INT_211,'已超過收款日'+ALLTRIM(STR(INT_211))+'天',IIF((DATE()-K51.F15)>=INT_210 .AND. (DATE()-K51.F15)<INT_211,'已超過收款日'+ALLTRIM(STR(INT_210))+'天','')))       
       THISFORM.TXTF15.VALUE=K51.F15
       THISFORM.TXTF08.VALUE=K51.F08 
        THISFORM.LBLF201.CAPTION=K51.F20      
        THISFORM.VRT_BOTT.ENABLED=IIF(A02.F09='*',.T.,.F.) AND IIF(K51.F07=K51.F10,K51.F09=0,.F.)   &&判斷有無反帳款至K17的權限        
        JK=THISFORM.GRID1.COLUMN1.HEADER1.CAPTION
       FCH=THISFORM.ACTIVECONTROL.NAME
       CHK=''
       THISFORM.REFRESH
  ENDPROC            
***********************************************反帳款至K17.發票管理
PROCEDURE VRT_BOTT.CLICK   
    IF MESSAGEBOX('是否確定要此筆發票反帳款至K17.發票管理中',4+32+256,'請確認')= 6
        IF RLOCK('K51')  
            K25='K25'+LEFT(DTOS(K51.F02),6)
            K256='K256'+LEFT(DTOS(K51.F02),6)
	    IF !USED('&K25')
	        SELECT  0
	        USE (K25) ALIA K25
            ELSE
	        SELECT  K25
	    ENDIF
	    SET ORDER TO K256   
	    SEEK K51.F06+K51.F01+K51.F03
	    IF FOUND()    
	        SELECT K25
	        REPLACE K25.F16 WITH IIF(K25.F16='5',' ','1')
	         REPLACE K25.F90 WITH DTOC(DATE())+' '+IIF(SEEK(SYS_OPER,'A01'),A01.F03,'')
	         =MESSAGEBOX('此發票號碼：'+K51.F01+'已反帳款至'+LEFT(DTOC(K51.F02),5)+'月K17.發票管理中',0+48,'提示訊息視窗')
	        SELECT K51
	        DELETE 
                SKIP -1
                IF BOF()
                    GO TOP
                ENDIF 	        
	    ELSE
	        =MESSAGEBOX('此發票號碼：'+K51.F01+'再'+LEFT(DTOC(K51.F02),5)+'月K17.發票管理中找不到,請查明後在確認!',0+48,'提示訊息視窗')
	    ENDIF
	    SELECT K25
	    USE
	ENDIF   
	SELECT K51
       THISFORM.GRID1.REFRESH
    ENDIF
    THISFORM.GRID1.SETFOCUS
ENDPROC
***********************************************列印明細
PROCEDURE LIST_BOTT.CLICK 
   FLG='0'
   SELE K51
   ANS_RANGE=CREATEOBJECT("ANS_RANGE")  
   ANS_RANGE.SHOW    
   IF FLG<>'1'
       =MESSAGEBOX('無此範圍資料',0+48,'警示')
   ENDIF    
   THISFORM.GRID1.SETFOCUS    
ENDPROC    
  **********&&修改收款日期與備註
 PROC REPLY_REMARK.CLICK  
 THISFORM.GRID1.ALLOWCELLSELECTION=.T.   
   THISFORM.KEY_LIST.ENABLED=.F.
   THISFORM.GRID1.ENABLED=.F.
   THISFORM.REPLY_REMARK.ENABLED=.F.
   THISFORM.LIST_BOTT.ENABLED=.F.
   THISFORM.VRT_BOTT.ENABLED=.F.
   THISFORM.YES.ENABLED=.T.
   THISFORM.NO.ENABLED=.T. 
   THISFORM.YES.VISIBLE=.T.
   THISFORM.NO.VISIBLE=.T.
   THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
   THISFORM.ORPGROUP.ESC_BOTT.ENABLED=.F.
   THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
   THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
   THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
   THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
   THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F. 
   THISFORM.GRID1.AFTERROWCOLCHANGE    
   THISFORM.LBLF201.VISIBLE=.F.
   THISFORM.SETALL('READONLY',.F.,'TEXTBOX') 
   THISFORM.TXTF15.SETFOCUS
   LOCK()
    IF !RLOCK()
	 DO FILE_IMPACT
	       RETURN
    ENDIF 
 ENDPROC
*********** 
 PROC YES.CLICK &&修改確認
    SELECT K51
*!*	    IF  EMPTY(THISFORM.TXTF01.VALUE)=.F.
*!*		    IF C05.F03>THISFORM.TXTF01.VALUE 
*!*		    	 =MESSAGEBOX('回覆交期不得小於預出日期!',0+64,'提示視窗')
*!*		    	 THISFORM.TXTF01.SETFOCUS
*!*		          RETURN
*!*		    ENDIF
*!*	    ENDIF	          
     IF  RLOCK()
     	  REPLACE F20 WITH DTOC(DATE())+' '+IIF(SEEK(SYS_OPER,'A01'),A01.F03,'')
     	  REPLACE F15 WITH THISFORM.TXTF15.VALUE
     	  REPLACE F08 WITH THISFORM.TXTF08.VALUE
     ELSE 
          DO     FILE_IMPACT
         RETURN
     ENDIF	  
    THISFORM.NO.CLICK
 ENDPROC
 *********
 PROC NO.CLICK &&修改取消
   THISFORM.SETALL('READONLY',.T.,'TEXTBOX') 
   THISFORM.YES.ENABLED=.F.
   THISFORM.NO.ENABLED=.F.
   THISFORM.YES.VISIBLE=.F.
   THISFORM.NO.VISIBLE=.F.
   THISFORM.KEY_LIST.ENABLED=.T.
   THISFORM.GRID1.ENABLED=.T.  
   THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
   THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
   THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
   THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
   THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T. 
   THISFORM.ORPGROUP.ESC_BOTT.ENABLED=.T.
   THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限   
   THISFORM.LIST_BOTT.ENABLED=IIF(A02.F08='*',.T.,.F.) 
   THISFORM.VRT_BOTT.ENABLED=IIF(A02.F09='*',.T.,.F.)    
   THISFORM.REPLY_REMARK.ENABLED=IIF(A02.F05='*',.T.,.F.) &&判斷有無修改回覆交期與備註的權限
   THISFORM.LBLF201.VISIBLE=.T.
   THISFORM.GRID1.SETFOCUS
   THISFORM.REFRESH
 ENDPROC
ENDDEFINE
***********************************************列印範圍選定
DEFINE CLASS ANS_RANGE AS FORM
       AUTOCENTER=.T.
       CAPTION='請輸入列印資料範圍'
       FONTSIZE=INT_015*9
       HEIGHT=INT_015*160
       WIDTH=INT_015*480
       FONTSIZE=INT_015*9
       CONTROLBOX=.F.
       BORDERSTYLE=2
       SHOWTIPS=.T.
       SHOWWINDOW=1
       WINDOWTYPE=1
       NAME='ANS_RANGE'
       ADD OBJECT LABEL1 AS LABEL WITH;
           AUTOSIZE=.T.,;
           HEIGHT=INT_015*25,;
           LEFT=INT_015*30,;
           TOP=INT_015*35,;
           NAME='LABEL1'    
       ADD OBJECT LABEL2 AS LABEL WITH;
           AUTOSIZE=.T.,;
           HEIGHT=INT_015*25,;
           LEFT=INT_015*250,;
           TOP=INT_015*35,;
           NAME='LABEL2'       
       ADD OBJECT TEXT1 AS TEXTBOX WITH;
           AUTOSIZE=.T.,;
           TOP=INT_015*30,;
           LEFT=INT_015*80,;
           HEIGHT=INT_015*25,; 
           NAME='TEXT1'
       ADD OBJECT TEXT2 AS TEXTBOX WITH;
           AUTOSIZE=.T.,;
           TOP=INT_015*30,;
           LEFT=INT_015*300,;
           HEIGHT=INT_015*25,;         
           NAME='TEXT2'    
       ADD OBJECT CMND1 AS COMMANDBUTTON WITH;
           AUTOSIZE=.T.,;
           LEFT=INT_015*120,;    
           HEIGHT=INT_015*25,;   
           TOP=INT_015*114,;  
           WIDTH=INT_015*80,;
           CAPTION='\<Y.執行',;
           TOOLTIPTEXT='確認所輸入的範圍鍵值!快速鍵->ALT+Y',;
           NAME='CMND1'
       ADD OBJECT CMND2 AS COMMANDBUTTON WITH;
           AUTOSIZE=.T.,;
           LEFT=INT_015*260,;
           TOP=INT_015*114,;
           HEIGHT=INT_015*25,;
           WIDTH=INT_015*80,;
           CAPTION='\<C.取消',;
           TOOLTIPTEXT='取消作業!快速鍵->ALT+C',;
           NAME='CMND2'
 *************          
  PROCEDURE INIT 
      THISFORM.SETALL('FONTSIZE',INT_015*9,'TEXTBOX')
      THISFORM.SETALL('FONTSIZE',INT_015*9,'LABEL')      
      THISFORM.SETALL('FONTSIZE',INT_015*9,'COMMANDBUTTON')            
      THISFORM.LABEL1.CAPTION='起始對象'
      THISFORM.LABEL2.CAPTION='截止對象'
      THISFORM.TEXT1.WIDTH=INT_015*70
      THISFORM.TEXT2.WIDTH=INT_015*70   
      THISFORM.TEXT1.MAXLENGTH=5              
      THISFORM.TEXT2.MAXLENGTH=5                                       
      THISFORM.TEXT1.VALUE=K51.F06
      THISFORM.TEXT2.VALUE=K51.F06   
  ENDPROC    
  PROCEDURE CMND1.CLICK 
	CREATE CURSOR K51B (F06 C(5),F11 C(8),F01 C(10),F02 D(8),F07 N(14,2),F10 N(14,2),F12 C(4),F13 N(11,6),F14 N(15,3),F15 N(15,3),F05 C(10),F08 C(60))
  	SELECT *  FROM K51 WHERE K51.F19='1' .AND. K51.F06>=THISFORM.TEXT1.VALUE .AND. K51.F06<=THISFORM.TEXT2.VALUE  ORDER BY K51.F06,K51.F12,K51.F02 INTO CURSOR K51_TEMP
  	SELECT K51_TEMP
  	CALC SUM(F07),SUM(F10) TO SUM_F07,SUM_F10
	GO TOP
	DTAE_LATE=ALLTRIM(LEFT(DTOS(K51_TEMP.F02),6))
	CRCY_LATE=K51_TEMP.F12
	CUR_LATE=K51_TEMP.F06
	SUM_MONTH_F07=0
	SUM_MONTH_F10=0	
	SUM_MONTH_F15=0	&&外幣未沖金額小計
	DO WHILE !EOF()
	       IF  DTAE_LATE=ALLTRIM(LEFT(DTOS(K51_TEMP.F02),6)) .AND. CRCY_LATE=K51_TEMP.F12 .AND. CUR_LATE=K51_TEMP.F06
                SELE K51B
	            APPEND BLANK
	            REPL K51B.F06 WITH K51_TEMP.F06
	            REPL K51B.F11 WITH K51_TEMP.F11
	            REPL K51B.F01 WITH K51_TEMP.F01
	            REPL K51B.F02 WITH K51_TEMP.F02
	            REPL K51B.F07 WITH K51_TEMP.F07
	            REPL K51B.F10 WITH K51_TEMP.F10
	            REPL K51B.F12 WITH K51_TEMP.F12
	            REPL K51B.F13 WITH K51_TEMP.F13	            
	            REPL K51B.F14 WITH K51_TEMP.F14
	            REPL K51B.F15 WITH IIF(K51_TEMP.F13=0,0,ROUND(K51_TEMP.F10/K51_TEMP.F13,3))
	            REPL K51B.F05 WITH K51_TEMP.F05
	            REPL K51B.F08 WITH K51_TEMP.F08	
	            SUM_MONTH_F07=SUM_MONTH_F07+K51_TEMP.F07 
	            SUM_MONTH_F10=SUM_MONTH_F10+K51_TEMP.F10
		        SUM_MONTH_F15=SUM_MONTH_F15+K51B.F15
	            DTAE_LATE=ALLTRIM(LEFT(DTOS(K51_TEMP.F02),6))
	            CRCY_LATE=K51_TEMP.F12
	            CUR_LATE=K51_TEMP.F06
		    SELE K51_TEMP
		    SKIP   
	       ELSE
	            SELE K51B
	            APPEND BLANK
	            REPLACE  K51B.F07 WITH SUM_MONTH_F07
	            REPLACE  K51B.F10 WITH SUM_MONTH_F10	
	            REPLACE  K51B.F15 WITH SUM_MONTH_F15 	            
		        SUM_MONTH_F07=0
		        SUM_MONTH_F10=0		
		        SUM_MONTH_F15=0			                 
	            SELE K51B
	            APPEND BLANK
	            REPLACE  K51B.F06 WITH K51_TEMP.F06
	            REPLACE  K51B.F11 WITH K51_TEMP.F11
	            REPLACE  K51B.F01 WITH K51_TEMP.F01
	            REPLACE  K51B.F02 WITH K51_TEMP.F02
	            REPLACE  K51B.F07 WITH K51_TEMP.F07
	            REPLACE  K51B.F10 WITH K51_TEMP.F10
	            REPLACE  K51B.F12 WITH K51_TEMP.F12
	            REPLACE  K51B.F13 WITH K51_TEMP.F13	            
*	            REPLACE  K51B.F14 WITH K51_TEMP.F14
	            REPLACE  K51B.F15 WITH ROUND(K51_TEMP.F10/K51_TEMP.F13,3)
	            REPLACE  K51B.F05 WITH K51_TEMP.F05
	            REPLACE  K51B.F08 WITH K51_TEMP.F08	
	            SUM_MONTH_F07=SUM_MONTH_F07+K51_TEMP.F07 
	            SUM_MONTH_F10=SUM_MONTH_F10+K51_TEMP.F10
		        SUM_MONTH_F15=SUM_MONTH_F15+K51B.F15	            
	            DTAE_LATE=ALLTRIM(LEFT(DTOS(K51_TEMP.F02),6))
	            CRCY_LATE=K51_TEMP.F12	        
	            CUR_LATE=K51_TEMP.F06            
		    SELE K51_TEMP
		    SKIP  	            	                        
	       ENDIF     		    
	 ENDDO  
         SELE K51B
         APPEND BLANK
         REPL K51B.F07 WITH SUM_MONTH_F07
         REPL K51B.F10 WITH SUM_MONTH_F10		
         REPL K51B.F15 WITH SUM_MONTH_F15	        	            
        IF _TALLY >0              
              REPORT FORM ALLTRIM(INT_116)+'K08C' TO PRINT PROMPT PREVIEW 
              SELECT K51_TEMP
	      USE
              SELECT K51B
              USE
              FLG='1'      
        ENDIF 
       THISFORM.RELEASE                     
  ENDPROC
  PROCEDURE CMND2.CLICK
      FLG='1'   
      THISFORM.RELEASE
  ENDPROC      
ENDDEFINE    
***********************************************列印程序
PROCEDURE PNT_PRC  
    FLG='1'
   SELECT  K51
   DO CASE
      CASE KEY()='F01+F06+DTOS(F02)'
      		    DA_STR=K51.F01+K51.F06+DTOS(K51.F02)
   	  CASE KEY()='F06+F01+DTOS(F02)'
                    DA_STR=K51.F06+K51.F01+DTOS(K51.F02)
   	  CASE KEY()='F11+DTOS(F02)'
                    DA_STR=K51.F11+DTOS(K51.F02)
   	  CASE KEY()='DTOS(F02)+F11'
                    DA_STR=DTOS(K08.F02)+K51.F01  
   	  CASE KEY()='F05+DTOS(F02)'
                    DA_STR=K51.F05+DTOS(K51.F02)    
   	  CASE KEY()='F17+DTOS(F15)'
                    DA_STR=K51.F17+DTOS(K51.F15)          
   	  CASE KEY()='F18+DTOS(F15)'
                    DA_STR=K51.F18+DTOS(K51.F15)                                                                                                
   ENDCASE  
   ANS_CHK=CREATEOBJECT("ANS_CHK")  
   ANS_CHK.SHOW    
   IF FLG<>'1'
       =MESSAGEBOX('無此範圍資料',0+48,'警示')
   ENDIF        
ENDPROC 
********************************************************
DEFINE CLASS ANS_CHK AS FORM
  AUTOCENTER=.T.
  CAPTION='請選擇所需列印之選項'
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*245
  WIDTH=INT_015*340
  FONTSIZE=INT_015*9
  CONTROLBOX=.F.
  BORDERSTYLE=2
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WINDOWTYPE=1
  NAME='ANS_CHK'
  ADD OBJECT DATA_OPTION AS DATA_OPTION WITH;
      LEFT=INT_015*17,;
      TOP=INT_015*20  
  ADD OBJECT LABEL5 AS LABEL WITH;
      LEFT=INT_015*205,;
      TOP=INT_015*105,;
      WIDTH=INT_015*75,;
      CAPTION='逾期未收天數'            
  ADD OBJECT TEXT5 AS TEXTBOX WITH;
      LEFT=INT_015*281,;
      TOP=INT_015*99,;
      WIDTH=INT_015*40,;
      HEIGHT=INT_015*25,;  
      MAXLENGTH=4,;
      NAME='TEXT5'         
  ADD OBJECT LABEL1 AS LABEL WITH;
      LEFT=INT_015*25,;
      TOP=INT_015*146,;
      WIDTH=INT_015*75,;
      CAPTION='起始業務編號'            
  ADD OBJECT TEXT1 AS TEXTBOX WITH;
      LEFT=INT_015*102,;
      TOP=INT_015*140,;
      WIDTH=INT_015*65,;
      HEIGHT=INT_015*25,;  
      MAXLENGTH=5,;
      NAME='TEXT1'           
  ADD OBJECT LABEL2 AS LABEL WITH;
      LEFT=INT_015*180,;
      TOP=INT_015*146,;
      WIDTH=INT_015*75,;
      CAPTION='截止業務編號'            
  ADD OBJECT TEXT2 AS TEXTBOX WITH;
      LEFT=INT_015*257,;
      TOP=INT_015*140,;
      WIDTH=INT_015*65,;
      HEIGHT=INT_015*25,;  
      MAXLENGTH=5,;
      NAME='TEXT2'      
  ADD OBJECT LABEL3 AS LABEL WITH;
      LEFT=INT_015*25,;
      TOP=INT_015*176,;
      WIDTH=INT_015*75,;
      CAPTION='起始收款日期'            
  ADD OBJECT TEXT3 AS TEXTBOX WITH;
      LEFT=INT_015*102,;
      TOP=INT_015*170,;
      WIDTH=INT_015*65,;
      HEIGHT=INT_015*25,;  
      NAME='TEXT3'           
  ADD OBJECT LABEL4 AS LABEL WITH;
      LEFT=INT_015*180,;
      TOP=INT_015*176,;
      WIDTH=INT_015*75,;
      CAPTION='截止收款日期'            
  ADD OBJECT TEXT4 AS TEXTBOX WITH;
      LEFT=INT_015*257,;
      TOP=INT_015*170,;
      WIDTH=INT_015*65,;
      HEIGHT=INT_015*25,;  
      NAME='TEXT4'                         
  ADD OBJECT CMND1 AS COMMANDBUTTON WITH;
      FONTSIZE=INT_015*9,;
      LEFT=INT_015*50,;     
      TOP=INT_015*205,;  
      HEIGHT=INT_015*25,;    
      WIDTH=INT_015*50,;
      CAPTION='\<P.列印',;
      TOOLTIPTEXT='確認所選擇的鍵值!快速鍵->ALT+Y',;
      NAME='CMND1'
  ADD OBJECT CMND2 AS COMMANDBUTTON WITH;
      FONTSIZE=INT_015*9,;
      LEFT=INT_015*140,;     
      TOP=INT_015*205,;  
      HEIGHT=INT_015*25,;    
      WIDTH=INT_015*65,;
      CAPTION='\<E.轉EXCEL',;
      TOOLTIPTEXT='確認所選擇的鍵值!快速鍵->ALT+Y',;
      NAME='CMND2'      
  ADD OBJECT CMND3 AS COMMANDBUTTON WITH;
      FONTSIZE=INT_015*9,;
      LEFT=INT_015*240,;
      TOP=INT_015*205,;
      HEIGHT=INT_015*25,;    
      WIDTH=INT_015*50,;
      CAPTION='\<C.取消',;
      TOOLTIPTEXT='取消作業!快速鍵->ALT+C',;
      NAME='CMND3'      
  PROCEDURE INIT 
      THISFORM.SETALL('FONTSIZE',INT_015*9,'TEXTBOX')
      THISFORM.SETALL('FONTSIZE',INT_015*9,'LABEL')      
      THISFORM.SETALL('FONTSIZE',INT_015*9,'COMMANDBUTTON')      
      THISFORM.SETALL('READONLY',.T.,'TEXTBOX')                                      
  ENDPROC          
  *****    
  PROCEDURE CMND1.CLICK   
        DAY_NO=THISFORM.TEXT5.VALUE
        IF THISFORM.DATA_OPTION.VALUE=3 .OR. THISFORM.DATA_OPTION.VALUE=4 .OR. THISFORM.DATA_OPTION.VALUE=5
              DAY_RANG=ALLTRIM(DTOC(THISFORM.TEXT3.VALUE))+' ∼ '+ALLTRIM(DTOC(THISFORM.TEXT4.VALUE))
              DAY_EXCEL=ALLTRIM(DTOS(THISFORM.TEXT3.VALUE))+'~'+ALLTRIM(DTOS(THISFORM.TEXT4.VALUE))
        ENDIF
	CREATE CURSOR  K51A (F02 C(5),F06 C(5),F10 N(18,2),F11 C(8),F04 C(8),F08 C(60),F09 N(14,2),F15 D(8),F16 C(20),F17 C(8))
	INDE ON F06 TAG K51A_1  
	SET ORDER TO K51A_1
	SELECT  K51
	GO TOP
	DO WHILE !EOF() .AND. K51.F19='1'
		   SELE K51A
		   APPEND BLANK
		   REPL K51A.F02 WITH LEFT(DTOC(K51.F02),5)
		   REPL K51A.F06 WITH K51.F06
		   REPL K51A.F10 WITH K51.F10
		   REPL K51A.F11 WITH K51.F11
		   REPL K51A.F04 WITH IIF(!EMPTY(K51.F04),K51.F04,IIF(SEEK(K51.F06,'C01'),C01.F10,IIF(SEEK(K51.F06,'D01'),D01.F06,'')))
		   REPL K51A.F08 WITH K51.F08
		   REPL K51A.F09 WITH K51.F09
		   REPL K51A.F15 WITH K51.F15
		   REPL K51A.F16 WITH K51.F16
		   REPL K51A.F17 WITH IIF(SEEK(K51.F06,'C01'),IIF(SEEK(C01.F18,'A01'),A01.F03,''),'')
		   SELE K51
		   SKIP   
	 ENDDO
	 DO CASE 
               CASE THISFORM.DATA_OPTION.VALUE=1 &&對象簡稱排列
 		         CREATE CURSOR K08C (F06 C(5),F11 C(8))	 &&相同簡稱
 		         CREATE CURSOR K08D (F06 C(5),F11 C(8))     &&一種簡稱
 		         INDE ON LEFT(F11,4) TAG K08D_1     
 		         SELECT F06,F11 FROM K51A GROUP BY F11 ORDER BY F11 INTO CURSOR K51_TEMP 
 		         SELECT K51_TEMP
 		         GO TOP
 		         PO=LEFT(ALLTRIM(K51_TEMP.F11),4)		         
 		         DO WHILE !EOF()
 		                IF  PO=LEFT(ALLTRIM(K51_TEMP.F11),4)   &&判斷簡稱前四碼
 		                     SELECT K08D
 		                     SET ORDER TO 1
 		                     SEEK LEFT(K51_TEMP.F11,4)  
 		                     IF FOUND()   				&&查看一種簡稱是否存在,若存在則加入相同簡稱
	                                 SELECT K08C
 		                         APPEND BLANK 
 		                         REPLACE K08C.F06 WITH K08D.F06
 		                         REPLACE K08C.F11 WITH K08D.F11
 		                         SELECT K08D
 		                         DELETE 
	                                 SELECT K08C
 		                         APPEND BLANK 
 		                         REPLACE K08C.F06 WITH K51_TEMP.F06
 		                         REPLACE K08C.F11 WITH K51_TEMP.F11 	
 		                         PO=LEFT(ALLTRIM(K51_TEMP.F11),4)
 		                         SELECT K51_TEMP
 		                         SKIP
 		                     ELSE    					&&若不存在一種簡稱中則直接新增至多個簡稱中
	                                 SELECT K08C
 		                         APPEND BLANK 
 		                         REPLACE K08C.F06 WITH K51_TEMP.F06
 		                         REPLACE K08C.F11 WITH K51_TEMP.F11 	
 		                         PO=LEFT(ALLTRIM(K51_TEMP.F11),4)
 		                         SELECT K51_TEMP
 		                         SKIP  		                     
 		                     ENDIF
 		                ELSE 					&&前四碼若不相同則新增至一種簡稱
	                             SELECT K08D
 		                     APPEND BLANK 
 		                     REPLACE K08D.F06 WITH K51_TEMP.F06
 		                     REPLACE K08D.F11 WITH K51_TEMP.F11 	
 		                     PO=LEFT(ALLTRIM(K51_TEMP.F11),4)
 		                     SELECT K51_TEMP
 		                     SKIP 	 		                  
 		                ENDIF
 		         ENDDO
 		         SELECT K51_TEMP  
 		         USE
 		         SELECT K08C
 		         GO TOP
 		         PO=LEFT(ALLTRIM(K08C.F11),4)
 		         SKIP
 		         IF PO<>LEFT(ALLTRIM(K08C.F11),4)     &&判斷相同簡稱之第一筆與下二筆之簡稱前四碼是否不相同
 		             SELECT K08C
 		             GO TOP
 		             SELECT K08D
 		             APPEND BLANK
 		             REPLACE K08D.F06 WITH K08C.F06
 		             REPLACE K08D.F11 WITH K08C.F11 	  		             
 		             SELECT K08C
 		             DELETE 
 		         ENDIF    
 		         *************
 		         CREATE CURSOR K08A (F02 C(5),F06 C(5),SUM_F10 N(18,2),F11 C(8),F04 C(8),F08 C(60),SUM_F09 N(15,2),F16 C(20),F17 C(8))&&相同簡稱
 		         CREATE CURSOR K08B (F02 C(5),F06 C(5),SUM_F10 N(18,2),F11 C(8),F04 C(8),F08 C(60),SUM_F09 N(15,2),F16 C(20),F17 C(8))&&一種簡稱  
 		         INDE ON F06+F02 TAG K08B_1        
 		         SELECT K51A
 		         GO TOP
 			 SELECT K51A.F02,K51A.F06,SUM(K51A.F10),K51A.F11,K51A.F04,SUM(K51A.F09),K51A.F08,F16,F17 FROM K51A ORDER BY K51A.F11,K51A.F02 GROUP BY K51A.F11,K51A.F02  INTO CURSOR K51A_TEMP
 		         SELECT K08C
 		         GO TOP
 		         DO WHILE !EOF()
 		                SELECT K51A_TEMP
 		                GO TOP
 		                DO WHILE !EOF()
 		                       IF ALLTRIM(K51A_TEMP.F06)=ALLTRIM(K08C.F06) .AND. ALLTRIM(K51A_TEMP.F11)=ALLTRIM(K08C.F11)
 		                           SELECT K08A
 		                           APPEND BLANK 
				     	   REPL K08A.F02 WITH K51A_TEMP.F02
				           REPL K08A.F06 WITH K51A_TEMP.F06
				    	   REPL K08A.SUM_F10 WITH K51A_TEMP.SUM_F10
				     	   REPL K08A.F11 WITH K51A_TEMP.F11
					   REPL K08A.F04 WITH K51A_TEMP.F04
					   REPL K08A.F08 WITH K51A_TEMP.F08
					   REPL K08A.SUM_F09 WITH K51A_TEMP.SUM_F09 
					   REPL K08A.F16 WITH K51A_TEMP.F16
					   REPL K08A.F17 WITH K51A_TEMP.F17	
 		                       ENDIF
 		                       SELECT K51A_TEMP
 		                       SKIP
 		               ENDDO 
 		               SELECT K08C
 		               SKIP
 		         ENDDO
*********************一種簡稱  
 		         SELECT K08D
 		         GO TOP
 		         DO WHILE !EOF()
 		                SELECT K51A_TEMP
 		                GO TOP
 		                DO WHILE !EOF()
 		                       IF ALLTRIM(K51A_TEMP.F06)=ALLTRIM(K08D.F06) .AND. ALLTRIM(K51A_TEMP.F11)=ALLTRIM(K08D.F11)
					   SELE K08B
					   APPEND BLANK
					   REPL K08B.F02 WITH K51A_TEMP.F02
					   REPL K08B.F06 WITH K51A_TEMP.F06
					   REPL K08B.SUM_F10 WITH K51A_TEMP.SUM_F10
					   REPL K08B.F11 WITH K51A_TEMP.F11
					   REPL K08B.F04 WITH K51A_TEMP.F04
					   REPL K08B.F08 WITH K51A_TEMP.F08
					   REPL K08B.SUM_F09 WITH K51A_TEMP.SUM_F09
					   REPL K08A.F16 WITH K51A_TEMP.F16
					   REPL K08A.F17 WITH K51A_TEMP.F17					   
 		                       ENDIF
 		                       SELECT K51A_TEMP
 		                       SKIP
 		               ENDDO 
 		               SELECT K08D
 		               SKIP
 		         ENDDO
 ****把一種簡稱資料加入相同簡稱的後面		         
 		         SELECT K08B
 		         SET ORDER TO 1
 		         GO TOP
			 DO WHILE !EOF()
 		                SELECT K08A
 		                APPEND BLANK 
		     	        REPL K08A.F02 WITH K08B.F02
		                REPL K08A.F06 WITH K08B.F06
		    	        REPL K08A.SUM_F10 WITH K08B.SUM_F10
		     	        REPL K08A.F11 WITH K08B.F11
			        REPL K08A.F04 WITH K08B.F04
			        REPL K08A.F08 WITH K08B.F08
			        REPL K08A.SUM_F09 WITH K08B.SUM_F09 	
				REPL K08A.F16 WITH K51A_TEMP.F16
				REPL K08A.F17 WITH K51A_TEMP.F17			        
 		                SELECT K08B
 		                SKIP	
 		          ENDDO             
 		          SELECT K08B
 		          USE              
 		          SELECT K08A             		 
			  GO TOP
			  IF _TALLY >0 
			      IF EXCEL_CK='N'  
 		                   REPORT FORM ALLTRIM(INT_116)+'K08A' TO PRINT PROMPT PREVIEW
 		              ELSE     
 		                    SELECT F11 對象簡稱,F06 對象編號,F04 統一編號,F02 年月份,SUM_F10 金額,SUM_F09 未沖銷金額,;
 		                                  IIF(SEEK(F06,'K51A'),K51A.F17,'') 業務人員,IIF(SEEK(F06,'K51A'),K51A.F16,'') 收款方式,F08 備註 FROM K08A NOWAIT
    			            FILENAME='立沖結餘明細帳(應收)'
			            GCDELIMFILE=PUTFILE('儲存路徑',FILENAME,'XLS')
			            IF !EMPTY(GCDELIMFILE) 
			                ON ERROR DO FILE_IMPACT
			                COPY TO (GCDELIMFILE) TYPE XL5     
			                =MESSAGEBOX('儲存成功',0+64,'提示訊息視窗') 
				    ENDIF   		              
 		              ENDIF 
 		              SELECT K08A
			      USE 		              
 		              FLG='1'
 		           ELSE
 		              FLG='0'    
 		           ENDIF              
	        CASE THISFORM.DATA_OPTION.VALUE=2	&&對象編號排列
			   SELECT K51A
 		           SELECT F02,F06,SUM(F10),F11,F04,SUM(F09),F08,F15,F16,F17 FROM K51A ORDER BY F06,F02 GROUP BY F06,F02  INTO CURSOR K51_TEMP
 		           IF _TALLY >0 
 		                IF EXCEL_CK='N'  
 		                    REPORT FORM ALLTRIM(INT_116)+'K08B' TO PRINT PROMPT PREVIEW
 		                ELSE
 		                    SELECT F06 對象編號,F11 對象簡稱,F04 統一編號,F02 年月份,SUM_F10 金額,SUM_F09 未沖銷金額,F17 業務人員,F16 收款方式,F08 備註 FROM K51_TEMP NOWAIT
    			            FILENAME='立沖結餘明細帳(應收)'
			            GCDELIMFILE=PUTFILE('儲存路徑',FILENAME,'XLS')
			            IF !EMPTY(GCDELIMFILE) 
			                ON ERROR DO FILE_IMPACT
			                COPY TO (GCDELIMFILE) TYPE XL5     
			                =MESSAGEBOX('儲存成功',0+64,'提示訊息視窗') 
				    ENDIF  
				ENDIF      
 		                SELECT K51_TEMP
				USE				
				FLG='1'		                
 		           ELSE
 		                FLG='0'    
 		           ENDIF
 		CASE THISFORM.DATA_OPTION.VALUE=3 &&對象編號別可收款項   
			   CREATE CURSOR K51B (F06 C(5),F11 C(8),F01 C(10),F02 D(8),F07 N(14,2),F10 N(14,2),F05 C(10),F12 C(4),F13 N(11,6),F14 N(15,3),F15 D(8),F16 C(20),F17 C(5),F18 C(5),F08 C(60),F19 N(18,3),F99 C(10))
			   SELECT *  FROM K51 WHERE K51.F19='1' .AND. K51.F06>=THISFORM.TEXT1.VALUE .AND. K51.F06<=THISFORM.TEXT2.VALUE;
			   .AND. K51.F15>=THISFORM.TEXT3.VALUE .AND. K51.F15<=THISFORM.TEXT4.VALUE  ORDER BY K51.F06,K51.F15 INTO CURSOR K51_TEMP
			   SELECT K51_TEMP
			   CALC SUM(F07),SUM(F10) TO SUM_F07,SUM_F10
		           GO TOP 		
			   DTAE_LATE=ALLTRIM(LEFT(DTOS(K51_TEMP.F15),6))
			   CUR_LATE=K51_TEMP.F06
			   SUM_MONTH_F07=0
			   SUM_MONTH_F10=0	
			   SUM_MONTH_F14=0	 	
			   SUM_MONTH_F19=0	
			   DO WHILE !EOF()
			          IF  DTAE_LATE=ALLTRIM(LEFT(DTOS(K51_TEMP.F15),6))  .AND. CUR_LATE=K51_TEMP.F06
		                    SELE K51B
			            APPEND BLANK
			            REPL K51B.F06 WITH K51_TEMP.F06
			            REPL K51B.F11 WITH K51_TEMP.F11
			            REPL K51B.F01 WITH K51_TEMP.F01
			            REPL K51B.F02 WITH K51_TEMP.F02
			            REPL K51B.F07 WITH K51_TEMP.F07
			            REPL K51B.F10 WITH K51_TEMP.F10
			            REPL K51B.F12 WITH K51_TEMP.F12
			            REPL K51B.F13 WITH K51_TEMP.F13
			            REPL K51B.F14 WITH K51_TEMP.F14
			            REPL K51B.F15 WITH K51_TEMP.F15
			            REPL K51B.F16 WITH K51_TEMP.F16
			            REPL K51B.F17 WITH K51_TEMP.F17
			            REPL K51B.F18 WITH K51_TEMP.F18
			            REPL K51B.F19 WITH ROUND(K51B.F10/K51B.F13,3)		&&外幣未收金額
			            REPL K51B.F05 WITH K51_TEMP.F05
			            REPL K51B.F08 WITH K51_TEMP.F08
			            REPL K51B.F99 WITH ALLTRIM(STR(DATE()-K51_TEMP.F15))+'天' 
			            SUM_MONTH_F07=SUM_MONTH_F07+K51_TEMP.F07 
			            SUM_MONTH_F10=SUM_MONTH_F10+K51_TEMP.F10
			            SUM_MONTH_F14=SUM_MONTH_F14+K51_TEMP.F14  
			            SUM_MONTH_F19=SUM_MONTH_F19+K51B.F19
			            DTAE_LATE=ALLTRIM(LEFT(DTOS(K51_TEMP.F15),6))
			            CUR_LATE=K51_TEMP.F06
				    SELE K51_TEMP
				    SKIP   
			       ELSE
			            SELECT  K51B
			            APPEND BLANK
			            REPL K51B.F07 WITH SUM_MONTH_F07
			            REPL K51B.F10 WITH SUM_MONTH_F10
			            REPL K51B.F14 WITH SUM_MONTH_F14
			            REPL K51B.F19 WITH SUM_MONTH_F19	            
				    SUM_MONTH_F07=0
				    SUM_MONTH_F10=0		
				    SUM_MONTH_F14=0
				    SUM_MONTH_F19=0			                 
			            SELECT  K51B
			            APPEND BLANK
			            REPL K51B.F06 WITH K51_TEMP.F06
			            REPL K51B.F11 WITH K51_TEMP.F11
			            REPL K51B.F01 WITH K51_TEMP.F01
			            REPL K51B.F02 WITH K51_TEMP.F02
			            REPL K51B.F07 WITH K51_TEMP.F07
			            REPL K51B.F10 WITH K51_TEMP.F10
			            REPL K51B.F12 WITH K51_TEMP.F12
			            REPL K51B.F13 WITH K51_TEMP.F13
			            REPL K51B.F14 WITH K51_TEMP.F14			            
			            REPL K51B.F15 WITH K51_TEMP.F15
			            REPL K51B.F16 WITH K51_TEMP.F16
			            REPL K51B.F17 WITH K51_TEMP.F17
			            REPL K51B.F18 WITH K51_TEMP.F18
			            REPL K51B.F19 WITH ROUND(K51B.F10/K51B.F13,3)		&&外幣未收金額
			            REPL K51B.F05 WITH K51_TEMP.F05
			            REPL K51B.F08 WITH K51_TEMP.F08	
			            REPL K51B.F99 WITH ALLTRIM(STR(DATE()-K51_TEMP.F15))+'天' 
			            SUM_MONTH_F07=SUM_MONTH_F07+K51_TEMP.F07 
			            SUM_MONTH_F10=SUM_MONTH_F10+K51_TEMP.F10    
			            SUM_MONTH_F14=SUM_MONTH_F14+K51_TEMP.F14     
			            SUM_MONTH_F19=SUM_MONTH_F19+K51B.F19
			            DTAE_LATE=ALLTRIM(LEFT(DTOS(K51_TEMP.F15),6))     
			            CUR_LATE=K51_TEMP.F06            
				    SELE K51_TEMP
				    SKIP  	            	                        
			        ENDIF     		    
			   ENDDO  
		           SELE K51B
		           APPEND BLANK
		           REPL K51B.F07 WITH SUM_MONTH_F07
		           REPL K51B.F10 WITH SUM_MONTH_F10	
		           REPL K51B.F14 WITH SUM_MONTH_F14
		           REPL K51B.F19 WITH SUM_MONTH_F19		
    			   IF _TALLY >0              
    			        IF EXCEL_CK='N'  
    			              REPORT FORM ALLTRIM(INT_116)+'K08F' TO PRINT PROMPT PREVIEW 
    			         ELSE
    			              SELECT F06 對象編號,F11 對象簡稱,F01 發票號碼,IIF(EMPTY(F15),'當月小計',DTOC(F15)) 請款日期,F07 發票總額,F10 未收金額,F12 幣別,F13 匯率,F14 外幣金額,;
    			                             F19 外幣未收金額,IIF(EMPTY(F15),'',DTOC(F02)) 發票日期,IIF(SEEK(F17,'A01'),A01.F03,'') 業務人員,IIF(SEEK(F18,'A01'),A01.F03,'') 業務助理,;
    			                             F99 逾期天數,F05 憑證單號,F16 收款方式,F08 備註 FROM K51B NOWAIT
    			              FILENAME=ALLTRIM('對象編號別可收款項 資料範圍'+DAY_EXCEL)
			              GCDELIMFILE=PUTFILE('儲存路徑',FILENAME,'XLS')
			              IF !EMPTY(GCDELIMFILE) 
			                  ON ERROR DO FILE_IMPACT
			           	  COPY TO (GCDELIMFILE) TYPE XL5     
			                  =MESSAGEBOX('儲存成功',0+64,'提示訊息視窗') 
				      ENDIF       			          
    			         ENDIF    
 		                 SELECT K51_TEMP
				 USE      			         
 		                 SELECT K51B
				 USE    			          
 		                 FLG='1'
 		           ELSE
 		                  FLG='0'    
 		           ENDIF  		
 		CASE THISFORM.DATA_OPTION.VALUE=4 &&業務員別應收未收款項
 		            IF EMPTY(THISFORM.TEXT1.VALUE)
			        =MESSAGEBOX('起始編號不得空白!',0+64,'提示視窗')   
			        THISFORM.TEXT1.SETFOCUS
			        RETURN
    			    ENDIF
 		            IF EMPTY(THISFORM.TEXT2.VALUE)
			        =MESSAGEBOX('截止編號不得空白!',0+64,'提示視窗')   
			        THISFORM.TEXT2.SETFOCUS
			        RETURN
    			    ENDIF		
    			     SELECT K51.* FROM K51 WHERE K51.F19='1' .AND. F17>=THISFORM.TEXT1.VALUE .AND. F17<=THISFORM.TEXT1.VALUE;
    			                 .AND. F15>=THISFORM.TEXT3.VALUE .AND. F15<=THISFORM.TEXT4.VALUE .AND.;    			   
    			                 (DATE()-F15)>=THISFORM.TEXT5.VALUE ORDER BY F17,F06 INTO CURSOR K51_TEMP
    			    IF _TALLY >0              
    			          IF EXCEL_CK='N'  
    			              REPORT FORM ALLTRIM(INT_116)+'K08D' TO PRINT PROMPT PREVIEW 
    			          ELSE
    			              SELECT IIF(SEEK(F17,'A01'),A01.F03,'') 業務人員,IIF(SEEK(F18,'A01'),A01.F03,'') 業務助理,F06 對象編號,F11 對象簡稱,;
    			                            F01 發票號碼,F02 發票日期,F07 發票金額,F10 未收金額,F12 幣別,F13 匯率,F14 外幣金額,F05 憑證單號,F15 收款日期,;
    			                            IIF((DATE()-F15)<0,'尚未逾期',ALLTRIM(STR(DATE()-F15))+'天') 逾期天數,F16 收款方式 FROM K51_TEMP NOWAIT
    			              FILENAME='業務員別應收未收款項 資料範圍'+DAY_EXCEL
			              GCDELIMFILE=PUTFILE('儲存路徑',FILENAME,'XLS')
			              IF !EMPTY(GCDELIMFILE) 
			                  ON ERROR DO FILE_IMPACT
			           	  COPY TO (GCDELIMFILE) TYPE XL5     
			                  =MESSAGEBOX('儲存成功',0+64,'提示訊息視窗') 
				      ENDIF       			          
    			          ENDIF    
 		                  SELECT K51_TEMP
				  USE    			          
 		                  FLG='1'
 		           ELSE
 		                  FLG='0'    
 		           ENDIF   			   
 		CASE THISFORM.DATA_OPTION.VALUE=5 &&業務助理別應收未收款項  		  
 		           IF EMPTY(THISFORM.TEXT1.VALUE)
			       =MESSAGEBOX('起始編號不得空白!',0+64,'提示視窗')   
			       THISFORM.TEXT1.SETFOCUS
			       RETURN
    			   ENDIF
 		           IF EMPTY(THISFORM.TEXT2.VALUE)
			       =MESSAGEBOX('截止編號不得空白!',0+64,'提示視窗')   
			       THISFORM.TEXT2.SETFOCUS
			       RETURN
    			   ENDIF	
    			   SELECT K51.* FROM K51 WHERE K51.F19='1' .AND. F18>=THISFORM.TEXT1.VALUE .AND. F18<=THISFORM.TEXT1.VALUE;
    			                .AND.  F15>=THISFORM.TEXT3.VALUE .AND. F15<=THISFORM.TEXT4.VALUE .AND.;
    			                 (DATE()-F15)>=THISFORM.TEXT5.VALUE ORDER BY F18,F06 INTO CURSOR K51_TEMP
    			    IF _TALLY >0            
    			          IF EXCEL_CK='N'  
    			               REPORT FORM ALLTRIM(INT_116)+'K08E' TO PRINT PROMPT PREVIEW  
    			          ELSE
 				     SELECT IIF(SEEK(F18,'A01'),A01.F03,'') 業務助理,IIF(SEEK(F17,'A01'),A01.F03,'') 業務人員,F06 對象編號,F11 對象簡稱,;
    			                            F01 發票號碼,F02 發票日期,F07 發票金額,F10 未收金額,F12 幣別,F13 匯率,F14 外幣金額,F05 憑證單號,F15 收款日期,;
    			                            IIF((DATE()-F15)<0,'尚未逾期',ALLTRIM(STR(DATE()-F15))+'天') 逾期天數,F16 收款方式 FROM K51_TEMP NOWAIT
    			              FILENAME='業務助理別應收未收款項 資料範圍'+DAY_EXCEL
			              GCDELIMFILE=PUTFILE('儲存路徑',FILENAME,'XLS')
			              IF !EMPTY(GCDELIMFILE) 
			                  ON ERROR DO FILE_IMPACT
			           	  COPY TO (GCDELIMFILE) TYPE XL5     
			                  =MESSAGEBOX('儲存成功',0+64,'提示訊息視窗') 
				      ENDIF       			               
    			          ENDIF    
 		                  SELECT K51_TEMP
				  USE    			          
 		                  FLG='1'
 		           ELSE
 		                 FLG='0'    
 		           ENDIF    			   	      
	 ENDCASE 		
	 CLEAR  
	 SELECT K51A
	 USE
	 EXCEL_CK='N'
	 SELECT  K51
  	 SEEK DA_STR
     THISFORM.RELEASE                         
  ENDPROC
*********
  PROCEDURE CMND2.CLICK
      EXCEL_CK='Y'
      THISFORM.CMND1.CLICK
  ENDPROC      
 ***** 
  PROCEDURE CMND3.CLICK
      THISFORM.RELEASE
  ENDPROC      
ENDDEFINE
**********
DEFINE CLASS DATA_OPTION AS OPTIONGROUP
      HEIGHT=INT_015*110
      WIDTH=INT_015*170
      FONTSIZE=INT_015*9
      BUTTONCOUNT=5
      OPTION1.CAPTION='依對象簡稱排列'
      OPTION1.FONTSIZE=INT_015*9
      OPTION1.TOP=INT_015*7
      OPTION1.LEFT=INT_015*5
      OPTION1.AUTOSIZE=.T.
      OPTION2.CAPTION='依對象編號排列'
      OPTION2.FONTSIZE=INT_015*9
      OPTION2.TOP=INT_015*27
      OPTION2.LEFT=INT_015*5
      OPTION2.AUTOSIZE=.T.
      OPTION3.CAPTION='對象編號別可收款項'
      OPTION3.FONTSIZE=INT_015*9
      OPTION3.TOP=INT_015*47
      OPTION3.LEFT=INT_015*5
      OPTION3.AUTOSIZE=.T.      
      OPTION4.CAPTION='業務員別應收未收款項'
      OPTION4.FONTSIZE=INT_015*9
      OPTION4.TOP=INT_015*67
      OPTION4.LEFT=INT_015*5
      OPTION4.AUTOSIZE=.T.
      OPTION5.CAPTION='業務助理別應收未收款項'
      OPTION5.FONTSIZE=INT_015*9
      OPTION5.TOP=INT_015*87
      OPTION5.LEFT=INT_015*5
      OPTION5.AUTOSIZE=.T.         
      NAME='DATA_OPTION'     
  PROCEDURE INTERACTIVECHANGE
  THISFORM.SETALL('READONLY',.F.,'TEXTBOX') 
     DO CASE
            CASE THIS.VALUE=1 .OR. THIS.VALUE=2
                       THISFORM.SETALL('READONLY',.T.,'TEXTBOX') 
		       THISFORM.TEXT1.VALUE=''
		       THISFORM.TEXT2.VALUE=''
		       THISFORM.TEXT3.VALUE=''
		       THISFORM.TEXT4.VALUE=''    
		       THISFORM.TEXT5.VALUE=''             
            CASE THIS.VALUE=3
		       THISFORM.TEXT5.READONLY=.T.
		       THISFORM.TEXT1.VALUE=K51.F06
		       THISFORM.TEXT2.VALUE=K51.F06        
		       THISFORM.TEXT3.VALUE=CTOD('')
		       THISFORM.TEXT4.VALUE=CTOD('')      
		       THISFORM.TEXT5.VALUE=''  		                  
            CASE THIS.VALUE=4
                       THISFORM.LABEL1.CAPTION='起始業務編號'
                       THISFORM.LABEL2.CAPTION='截止業務編號'
		       THISFORM.TEXT1.VALUE=K51.F17
		       THISFORM.TEXT2.VALUE=K51.F17 
		       THISFORM.TEXT3.VALUE=CTOD('')
		       THISFORM.TEXT4.VALUE=CTOD('')      
		       THISFORM.TEXT5.VALUE=0     
            CASE THIS.VALUE=5
                       THISFORM.LABEL1.CAPTION='起始業助編號'
                       THISFORM.LABEL2.CAPTION='截止業助編號'            
 	               THISFORM.TEXT1.VALUE=K51.F18
                       THISFORM.TEXT2.VALUE=K51.F18  
		       THISFORM.TEXT3.VALUE=CTOD('')
		       THISFORM.TEXT4.VALUE=CTOD('')   
		       THISFORM.TEXT5.VALUE=0                           
     ENDCASE   
  ENDPROC       
ENDDEFINE  
************************************************發票類別     
FUNC BILL
     PARA JUK
     JO=''
     DO CASE
        CASE JUK='21'
             JO='.進項三聯式. 電子計算機'
        CASE JUK='22'
             JO='.進項載有稅額之其他憑證'
        CASE JUK='23'
             JO='.三聯式. 進貨退出貨折讓'
        CASE JUK='24'
             JO='.二聯式. 進貨退出貨折讓'
        CASE JUK='25'  
             JO='.進項三聯式收銀機發票  '   
        CASE JUK='31'  
             JO='.銷項三聯式. 電子計算機'           
        CASE JUK='32'  
             JO='.銷項二聯式. 收銀機發票'   
        CASE JUK='33'  
             JO='.三聯式. 銷貨退回貨折讓'   
        CASE JUK='34'  
             JO='.二聯式. 銷貨退回貨折讓'   
        CASE JUK='35'  
             JO='.銷項三聯式收銀機發票  ' 
     ENDCASE
     RETURN JO   