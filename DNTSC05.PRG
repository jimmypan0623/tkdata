
CLEAR 
CLOSE ALL
SET DELETED ON
SET EXCLUSIVE OFF

SELECT 0
USE \\192.168.10.160\MISD2\C03 ALIAS C03
SET ORDER TO 1
SELECT 0
USE \\192.168.10.160\MISD2\C04 ALIAS C04
SET ORDER TO 1
SELECT 0
USE \\192.168.10.160\MISD2\C02 ALIAS C02
SET ORDER TO 3
CREATE CURSOR DNTSC05(F01 C(10),F02 C(43),F03 D(8),F04 N(11,0),F06 C(5),F07 N(11,6),F09 C(20),RC_DTE D(8),STCK_NO C(30),Q_DTE D(8),UNIT_PRICE N(11,6),PLS N(11,6))
*FOR I=1 TO 12
    *B04MTH='B042017'+PADL(ALLTRIM(STR(I)),2,'0')
    *B04MTH='B04201807'
    SELECT 0
    USE \\192.168.10.160\MISD2\C05
    SET ORDER TO 4


    SELECT * FROM C05 WHERE F06$'C8152C4032C4017' INTO CURSOR C05DN NOWAIT ORDER BY F01,F02
    *SELECT B04DN.*,C03.F01,LEFT(C03.F14,10) FROM B04DN,C03 WHERE  C03.F02=B04DN.f07 INTO CURSOR B04DN1 NOWAIT  
    SELECT C05DN.*,C04.F01,C04.F07,C04.F17 FROM C05DN,C04 WHERE C04.f03+C04.f04=C05DN.f01+C05DN.f02 INTO CURSOR C05DN2 NOWAIT
    
    SELECT C05DN2
    GO TOP
    DO WHILE !EOF()
       SELECT DNTSC05
       APPEND BLANK
       REPLACE F01 WITH C05DN2.F01_A
       
       REPLACE F02 WITH C05DN2.F02
       REPLACE F03 WITH C05DN2.F03
       REPLACE F04 WITH C05DN2.F04
       REPLACE F06 WITH C05DN2.F06
       REPLACE F07 WITH C05DN2.F07_B
       REPLACE F09 WITH C05DN2.F09       
       
       REPLACE RC_DTE WITH C05DN2.F01_B        
       REPLACE STCK_NO WITH C05DN2.F17
   PRICE=0
   SELECT C02
   SEEK 'C8152'+DNTSC05.F02 
   IF FOUND()
      DO WHILE F01+F03='C8152'+DNTSC05.F02
         IF DNTSC05.RC_DTE>=C02.F02 &&AND DNTS.RC_DTE<=C02.F15
            SELECT DNTSC05
            REPLACE Q_DTE WITH C02.F02
            REPLACE UNIT_PRICE WITH C02.F07
            REPLACE PLS WITH UNIT_PRICE-DNTSC05.F07
            EXIT
         ENDIF
         SELECT C02
         SKIP
      ENDDO
   ELSE
      
   ENDIF
   
   SELECT C05DN2
   SKIP
ENDDO

   SELECT C05
   USE
*ENDFOR
SELECT DNTSC05
SELECT * FROM DNTSC05 WHERE PLS<0 NOWAIT
FILENAME='DNTSC05'
COPY TO D:\TOKUTSU-MIS\&FILENAME TYPE XL5
CLOSE ALL
