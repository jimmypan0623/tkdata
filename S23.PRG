***********S23.部門 年 / 公假請作業
CLOSE ALL
CLEAR 
PRG_NO='S23'
FLG='0'
FCH=''
AREA1='S23_1'
CHK=''
CHK_IN=''
IF !USED('A01')	&&操作人員資料設定
   SELE 0
   USE A01 INDE A01
ELSE 
   SELE A01
ENDIF
SET ORDER TO A01
IF !USED('A02')	&&權限設定檔
   SELE 0
   USE A02 INDE A02
ELSE 
   SELE A02
ENDIF
SET ORDER TO A021      
SEEK sys_oper+'S23'   
IF !USED('A09')
   SELE 0
   USE A09
ELSE
   SELE A09
ENDIF
SET ORDER TO A091 
IF !USED('A14')
   SELE 0
   USE A14 INDE A14
ELSE 
   SELE A14
ENDIF
SET ORDER TO A141      
IF !USED('A23')	&&月份檔
    SELECT  0
    USE A23
ELSE 
   SELECT  A23
ENDIF
SET ORDER TO A231
A24='A24'+LEFT(DTOS(DATE()),6)     &&單號暫存檔
IF !USED('&A24')
   SELE 0
   USE (A24) ALIA A24
ELSE
   SELE A24
ENDIF
SET ORDER TO 1     
IF !USED('S00')	&&薪資參數設定
     SELE 0
     USE S00 
ELSE
     SELE S00
ENDIF
SET ORDER TO S005 
IF !USED('S13')	&&各項部門作業人員檔
   SELE 0
   USE S13 
ELSE
   SELE S13
ENDIF
SET ORDER TO S131
IF !USED('S15')	&&年度假日設定檔
   SELE 0
   USE S15 
ELSE
   SELE S15
ENDIF
SET ORDER TO S151
IF !USED('S18')	&&請假作業檔
   SELE 0
   USE S18
ELSE 
   SELE S18
ENDIF
SET ORDER TO S181  
SELECT * FROM S18 WHERE LEFT(ALLTRIM(S18.F02),2) = 'SY' ORDER BY F02 INTO CURSOR S23_1 READWRITE
INDE ON F02 TAG S23_11
INDE ON F05 TAG S23_12
SET ORDER TO S23_11
****
S23FORM=CREATEOBJECT("TKS23")
S23FORM.SHOW  
DEFINE CLASS TKS23 AS FORM
  CAPTION='S23.部門 年 / 公假請作業'
*!*	  AUTOCENTER=.T.
  CONTROLBOX=.F.
  BORDERSTYLE=1
  MAXBUTTON=.F.
  MINBUTTON=.F.
  MOVABLE=.F.
  CLOSABLE=.F.
  CONTROLCOUNT=57
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*550
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WIDTH=INT_015*791
  WINDOWTYPE=1
  NAME='TKS23'
  ADD OBJECT SHAPE1 AS SHAPE1 WITH;
      AUTOCENTER=.T.
  ADD OBJECT SHAPE2 AS SHAPE2 WITH;
      AUTOCENTER=.T.
  ADD OBJECT SHAPE3 AS SHAPE3 WITH;
      AUTOCENTER=.T.  
  ADD OBJECT ANS_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*490,;
      LEFT=INT_015*15,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*45,;      
      FONTSIZE=INT_015*9,;
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\harrow.cur',;        
      CAPTION='\<A.確認',;
      NAME='ANS_BOTT'                
  ADD OBJECT  INVERSE_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*490,;
      LEFT=INT_015*62,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*50,;      
      FONTSIZE=INT_015*9,;
      CAPTION='\<I.反確認',;
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\harrow.cur',;        
      NAME='INVERSE_BOTT'           
  ADD OBJECT OLIST_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*490,;
      LEFT=INT_015*114,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*90,;      
      FONTSIZE=INT_015*9,;
      CAPTION='\<O.修改作業人員',;
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\harrow.cur',;        
      NAME='OLIST_BOTT'         
  **********                   
  ADD OBJECT LBLF02 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*30,;
      WIDTH=INT_015*50,;
      CAPTION='單據編號'
  ADD OBJECT TXTF02 AS TEXTBOX WITH;      
      VISIBLE=.T.,;
      LEFT=INT_015*295,;
      TOP=INT_015*24,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*80,;
      MAXLENGTH=10,;
      NAME='TXTF02'          
  ADD OBJECT LBLF01 AS LABEL WITH;
      LEFT=INT_015*474,;
      TOP=INT_015*30,;
      WIDTH=INT_015*50,;
      CAPTION='填單日期'
  ADD OBJECT TXTF01 AS TEXTBOX WITH;      
      VISIBLE=.T.,;
      LEFT=INT_015*525,;
      TOP=INT_015*24,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*70,;
      NAME='TXTF01'              
  ADD OBJECT LBLF05 AS LABEL WITH;      
      LEFT=INT_015*244,;
      TOP=INT_015*55,;
      WIDTH=INT_015*50,;
      CAPTION='部門編號'
  ADD OBJECT TXTF05 AS TEXTBOX WITH;
      VISIBLE=.T.,;
      LEFT=INT_015*295,;
      TOP=INT_015*49,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*50,;
      BACKCOLOR=RGB(255,255,100),;
      MAXLENGTH=4,;
      NAME='TXTF05'             
  ADD OBJECT LBLF06 AS LABEL WITH;      
      LEFT=INT_015*244,;
      TOP=INT_015*80,;
      WIDTH=INT_015*50,;
      CAPTION='部門名稱'
  ADD OBJECT TXTF06 AS TEXTBOX WITH;
      VISIBLE=.T.,;
      LEFT=INT_015*295,;
      TOP=INT_015*74,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*70,;
      MAXLENGTH=8,;
      NAME='TXTF06'     
  ADD OBJECT TXTF07 AS TEXTBOX WITH;	&&假別編號(隱藏)
      VISIBLE=.F.,;
      LEFT=INT_015*295,;
      TOP=INT_015*74,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*50,;
      MAXLENGTH=2,;
      NAME='TXTF07'             
  ADD OBJECT LBLF08 AS LABEL WITH;      
      LEFT=INT_015*244,;
      TOP=INT_015*105,;
      WIDTH=INT_015*50,;
      CAPTION='假別名稱'        
  ADD OBJECT TXTF08 AS TEXTBOX WITH;	
      VISIBLE=.T.,;
      LEFT=INT_015*295,;
      TOP=INT_015*99,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*171,;
      MAXLENGTH=30,;
      NAME='TXTF08'                
 ADD OBJECT COMBOBOX08 AS COMBOBOX08 WITH;      
      VISIBLE=.F.,;
       LEFT=INT_015*295,; 
       TOP=INT_015*99            
  ADD OBJECT LBLF09 AS LABEL WITH;      
      VISIBLE=.F.,;
      LEFT=INT_015*494,;
      TOP=INT_015*105,;
      AUTOSIZE=.T.,;
      BACKCOLOR=RGB(0,255,255),;
      CAPTION='計數單位：'          
  ADD OBJECT TXTF09 AS TEXTBOX WITH;	&&隱藏
      VISIBLE=.F.,;
      LEFT=INT_015*520,;
      TOP=INT_015*99,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*20,;
      MAXLENGTH=1,;
      NAME='TXTF09'            
  ADD OBJECT LBLF10 AS LABEL WITH;      
      LEFT=INT_015*244,;
      TOP=INT_015*130,;
      WIDTH=INT_015*50,;
      CAPTION='起始日期'       
  ADD OBJECT TXTF10 AS TEXTBOX WITH;	
      VISIBLE=.T.,;
      LEFT=INT_015*295,;
      TOP=INT_015*124,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*70,;
      NAME='TXTF10'         
  ADD OBJECT LBLF11 AS LABEL WITH;      
      LEFT=INT_015*244,;
      TOP=INT_015*155,;
      WIDTH=INT_015*50,;
      CAPTION='截止日期'       
  ADD OBJECT TXTF11 AS TEXTBOX WITH;	
      VISIBLE=.T.,;
      LEFT=INT_015*295,;
      TOP=INT_015*149,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*70,;
      NAME='TXTF11'            
  ADD OBJECT LBLF14 AS LABEL WITH;      
      LEFT=INT_015*244,;
      TOP=INT_015*180,;
      WIDTH=INT_015*50,;
      CAPTION='請假天數'      
  ADD OBJECT TXTF14 AS TEXTBOX WITH;	
      VISIBLE=.T.,;
      LEFT=INT_015*295,;
      TOP=INT_015*174,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*45,;
      MAXLENGTH=5,;
       INPUTMASK='999.9',;
      NAME='TXTF14'          
*!*	  ADD OBJECT LBLF15 AS LABEL WITH;      
*!*	      LEFT=INT_015*244,;
*!*	      TOP=INT_015*205,;
*!*	      WIDTH=INT_015*50,;
*!*	      CAPTION='請假時數'      
*!*	  ADD OBJECT TXTF15 AS TEXTBOX WITH;	
*!*	      VISIBLE=.T.,;
*!*	      LEFT=INT_015*295,;
*!*	      TOP=INT_015*199,;
*!*	      HEIGHT=INT_015*25,;
*!*	      WIDTH=INT_015*45,;
*!*	      MAXLENGTH=5,;
*!*	       INPUTMASK='999.9',;
*!*	      NAME='TXTF15'          
  ADD OBJECT LBLF16 AS LABEL WITH;      
      LEFT=INT_015*244,;
      TOP=INT_015*205,;
      WIDTH=INT_015*50,;
      CAPTION='請假事由'      
  ADD OBJECT TXTF16 AS TEXTBOX WITH;	
      VISIBLE=.T.,;
      LEFT=INT_015*295,;
      TOP=INT_015*199,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*400,;
      MAXLENGTH=60,;
      NAME='TXTF16'           
  ADD OBJECT LBLF18 AS LABEL WITH;      
      LEFT=INT_015*244,;
      TOP=INT_015*230,;
      WIDTH=INT_015*50,;
      CAPTION='狀        態'    
  ADD OBJECT LBLF181 AS LABEL WITH;      
      LEFT=INT_015*298,;
      TOP=INT_015*230,;
      AUTOSIZE=.T.,;
      CAPTION=''       
  ADD OBJECT LBLF99 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*250,;
      WIDTH=INT_015*50,;
      CAPTION='安全資料'
  ADD OBJECT LBLF991 AS LABEL WITH;
      LEFT=INT_015*298,;
      TOP=INT_015*250,;
      AUTOSIZE=.T.,;
      CAPTION=''       
  ADD OBJECT LBLFS13 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*275,;
      AUTOSIZE=.T.,;
      CAPTION='欲帶入此作業之人員'                                                
  ADD OBJECT KEY_LIST AS KEY_LIST WITH;
      AUTOCENTER=.T.
  ADD OBJECT GRID1 AS GRID1 WITH;
      COLUMNCOUNT=3,;            
      RECORDSOURCE='S23_1',;      
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;
      COLUMN3.NAME='COLUMN3'
  ADD OBJECT GRID2 AS GRID2 WITH; 
      TOP=INT_015*295,;
      LEFT=INT_015*245,;
      HEIGHT=INT_015*220,;
      WIDTH=INT_015*150,;
      COLUMNCOUNT=2,;              
      RECORDSOURCE='S13',;
      LINKMASTER='S23_1',;
      RELATIONALEXPR='F02',;
      CHILDORDER='S131',;
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2'       
  ADD OBJECT CMDGROUP AS CMDGROUP WITH;
      AUTOSIZE=.T.              
  ADD OBJECT ORPGROUP AS ORPGROUP WITH;    
      AUTOSIZE=.T.
  ADD OBJECT SHRGROUP AS SHRGROUP WITH;
      TOP=INT_015*260,;
      LEFT=INT_015*558          
   *****   
  PROC INIT  
       SELECT S23_1
       GO BOTTOM 
       THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(S23_1.F18<>'Y',RGB(255,0,0),'')","COLUMN")        
       THISFORM.SHRGROUP.VISIBLE=.F.
       THISFORM.SHRGROUP.ENABLED=.F.
       THISFORM.SETALL('HEIGHT',INT_015*25,'TEXTBOX')
       THISFORM.SETALL('FONTSIZE',INT_015*9,'LABEL')
       THISFORM.SETALL('FONTSIZE',INT_015*9,'TEXTBOX')
       THISFORM.SETALL('HEIGHT',INT_015*17,'LABEL')       
       THISFORM.SETALL('READONLY',.T.,'TEXTBOX')
       THISFORM.SETALL('FONTSIZE',INT_015*9,'COLUMN')
       THISFORM.SETALL('FONTSIZE',INT_015*9,'HEADER')       
       THISFORM.GRID1.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)   
       THISFORM.GRID2.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146) 
       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*75
       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*50
       THISFORM.GRID1.COLUMN3.WIDTH=INT_015*60
       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='單據編號'
       THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='部門編號'
       THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='部門名稱'
       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='S23_1.F02'
       THISFORM.GRID1.COLUMN2.CONTROLSOURCE='S23_1.F05'
       THISFORM.GRID1.COLUMN3.CONTROLSOURCE='S23_1.F06'
       THISFORM.GRID2.COLUMN1.WIDTH=INT_015*50
       THISFORM.GRID2.COLUMN2.WIDTH=INT_015*70
       THISFORM.GRID2.COLUMN1.HEADER1.CAPTION='人員編號'
       THISFORM.GRID2.COLUMN2.HEADER1.CAPTION='人員姓名'
       THISFORM.GRID2.COLUMN1.CONTROLSOURCE='S13.F04'
       THISFORM.GRID2.COLUMN2.CONTROLSOURCE='S13.F05' 
       THISFORM.GRID1.READONLY=.T.       
       THISFORM.GRID2.READONLY=.T.
       THISFORM.GRID1.SETFOCUS
       IF THISFORM.GRID1.ACTIVEROW=0
          THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
          THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
          THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
          THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.       
          THISFORM.CMDGROUP.ENABLED=.F.
          THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
          THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
          THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
          THISFORM.ANS_BOTT.ENABLED=.F.
          THISFORM.INVERSE_BOTT.ENABLED=.F.     
          THISFORM.OLIST_BOTT.ENABLED=.F. 
          THISFORM.TXTF01.VALUE=''
          THISFORM.TXTF02.VALUE=''
          THISFORM.TXTF05.VALUE=''
          THISFORM.TXTF06.VALUE=''     
          THISFORM.TXTF07.VALUE=''
          THISFORM.TXTF08.VALUE=''
          THISFORM.TXTF09.VALUE=''
          THISFORM.TXTF10.VALUE=''
          THISFORM.TXTF11.VALUE=''
          THISFORM.TXTF14.VALUE=''
*!*	          THISFORM.TXTF15.VALUE=''
          THISFORM.TXTF16.VALUE=''
          THISFORM.LBLF09.CAPTION=''
          THISFORM.LBLF181.CAPTION=''
          THISFORM.LBLF991.CAPTION=''
       ELSE
          THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
          THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
          THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
          THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.            
          THISFORM.CMDGROUP.ENABLED=.T.      
          THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  AND IIF(S23_1.F18<>'Y',.T.,.F.) &&判斷有無修改的權限
          THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)   AND IIF(S23_1.F18<>'Y',.T.,.F.) &&判斷有無刪除的權限
          THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限
          THISFORM.ANS_BOTT.ENABLED=IIF(A02.F08='*',.T.,.F.)  AND IIF(S23_1.F18<>'Y',.T.,.F.)   &&判斷有無確認的權限
*!*	          THISFORM.INVERSE_BOTT.ENABLED=IIF(A02.F09='*',.T.,.F.)   AND IIF(S23_1.F18<>'Y',.F.,.T.) &&判斷有反確認的權限
	  THISFORM.INVERSE_BOTT.ENABLED=.F.
          THISFORM.OLIST_BOTT.ENABLED=IIF(A02.F08='*',.T.,.F.)  AND IIF(S23_1.F18<>'Y',.T.,.F.)
       ENDIF      
       THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.)  &&判斷有無新增的權限 
       JK='單據編號'
  ENDPROC
  ***********     
  PROC KEY_LIST.INIT 
       WITH THIS 
           .ADDITEM('依單據編號排列')
           .ADDITEM('依部門編號排列')
           .VALUE=1
       ENDWITH      
  ENDPROC 
********* 
  PROC KEY_LIST.INTERACTIVECHANGE         
       SELECT  S23_1 
       DO CASE
          CASE THIS.DISPLAYVALUE='依單據編號排列'
                     SET ORDER TO S23_11 
		     THISFORM.GRID1.COLUMN1.WIDTH=INT_015*75
		     THISFORM.GRID1.COLUMN2.WIDTH=INT_015*50
		     THISFORM.GRID1.COLUMN3.WIDTH=INT_015*60                     
		     THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='單據編號'
		     THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='部門編號'
		     THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='部門名稱'
		     THISFORM.GRID1.COLUMN1.CONTROLSOURCE='S23_1.F02'
		     THISFORM.GRID1.COLUMN2.CONTROLSOURCE='S23_1.F05'
		     THISFORM.GRID1.COLUMN3.CONTROLSOURCE='S23_1.F06'
		      JK='單據編號'
          CASE THIS.DISPLAYVALUE='依部門編號排列'
               	     SET ORDER TO S23_12
		     THISFORM.GRID1.COLUMN1.WIDTH=INT_015*50
		     THISFORM.GRID1.COLUMN2.WIDTH=INT_015*60
		     THISFORM.GRID1.COLUMN3.WIDTH=INT_015*75 
		     THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='部門編號'
		     THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='部門名稱'
		     THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='單據編號'		     
		     THISFORM.GRID1.COLUMN1.CONTROLSOURCE='S23_1.F05'    
		     THISFORM.GRID1.COLUMN2.CONTROLSOURCE='S23_1.F06'	
		     THISFORM.GRID1.COLUMN3.CONTROLSOURCE='S23_1.F02'		
		      JK='部門編號'                                                  
       ENDCASE 
        THISFORM.GRID1.SETFOCUS          
  ENDPROC          
  *********
  PROC GRID1.AFTERROWCOLCHANGE
       LPARAMETERS nColIndex
       SELECT S23_1
       THISFORM.TXTF01.VALUE=F01
       THISFORM.TXTF02.VALUE=F02
       THISFORM.TXTF05.VALUE=F05
       THISFORM.TXTF06.VALUE=F06
       THISFORM.TXTF07.VALUE=F07
       THISFORM.TXTF08.VALUE=F08
       THISFORM.TXTF09.VALUE=F09
       THISFORM.TXTF10.VALUE=F10
       THISFORM.TXTF11.VALUE=F11
       THISFORM.TXTF14.VALUE=F14
       THISFORM.TXTF16.VALUE=F16
       THISFORM.LBLF09.VISIBLE=.F.
       THISFORM.LBLF09.CAPTION='計數單位：' +ACC_BASE(S23_1.F09)+'，請假基數：'+ALLTRIM(TRANSFORM(IIF(INDEXSEEK('G'+S23_1.F07,.T.,'S00','S003'),S00.F62,0),'@R 999,999.9'))+' '+ACC_BASE(THISFORM.TXTF09.VALUE)
       THISFORM.LBLF181.CAPTION=IIF(S23_1.F18<>'Y','尚未確認','已確認') 
       THISFORM.LBLF181.BACKCOLOR=IIF(S23_1.F18<>'Y',RGB(255,0,0),RGB(58,186,152)) 
       THISFORM.LBLF991.CAPTION=F99    
       THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  AND IIF(S23_1.F18<>'Y',.T.,.F.) &&判斷有無修改的權限
       THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)   AND IIF(S23_1.F18<>'Y',.T.,.F.) &&判斷有無刪除的權限
       THISFORM.ANS_BOTT.ENABLED=IIF(A02.F08='*',.T.,.F.)  AND IIF(S23_1.F18<>'Y',.T.,.F.)   &&判斷有無確認的權限
*!*	       THISFORM.INVERSE_BOTT.ENABLED=IIF(A02.F09='*',.T.,.F.)   AND IIF(S23_1.F18<>'Y',.F.,.T.) &&判斷有反確認的權限 
       THISFORM.INVERSE_BOTT.ENABLED=.F.
       THISFORM.OLIST_BOTT.ENABLED=IIF(A02.F08='*',.T.,.F.)  AND IIF(S23_1.F18<>'Y',.T.,.F.)
       FCH=THISFORM.ACTIVECONTROL.NAME
       CHK=''
       THISFORM.REFRESH
  ENDPROC      
  ********** 
  PROCEDURE ORPGROUP.NEW_BOTT.CLICK    
       THISFORM.KEY_LIST.ENABLED=.F. 
       THISFORM.ANS_BOTT.ENABLED=.F.
       THISFORM.INVERSE_BOTT.ENABLED=.F.    
       THISFORM.OLIST_BOTT.ENABLED=.F.
       THISFORM.GRID2.COLUMN1.CONTROLSOURCE=''
       THISFORM.GRID2.COLUMN2.CONTROLSOURCE=''              
       THISFORM.GRID1.ENABLED=.F.   
       THISFORM.GRID2.ENABLED=.F. 
        H='S023 '+SUBSTR(DTOS(DATE()),3,4)
        SELECT  A24   
        SET ORDER TO 1
        SEEK H           
        IF FOUND() 
             PO_NO=F08
             RLOCK()
             DELE 
             UNLOCK
        ELSE
             SELE A09
             SEEK H            
             IF !FOUND()                                                  &&如果為本月第一張訂單則重頭開始編號
		  APPEND BLANK                                                
		  REPLACE  F01 WITH 'S023 '
		  REPLACE  F02 WITH  SUBSTR(DTOS(DATE()),3,4)
		  REPLACE  F05 WITH 'SY'+F02
		  REPLACE  F06 WITH '部門年假請假作業'
		  REPLACE  F08 WITH ALLTRIM(F05)+'0000'
	    ENDIF
	    LOCK()
	    HX=VAL(RIGHT(F08,4))+1
	    PO_NO=LEFT(F08,6)+PADL(ALLTRIM(STR(HX)),4,'0')
	    REPLACE  F08 WITH PO_NO                                             &&記錄本訂單號碼,本月份後續的訂單號碼將以此往下編
	    UNLOCK
       ENDIF 
       THISFORM.SETALL('READONLY',.F.,'TEXTBOX')
       THISFORM.LBLF09.VISIBLE=.T.
       THISFORM.TXTF01.READONLY=.T.  
       THISFORM.TXTF02.READONLY=.T.   
       THISFORM.TXTF06.READONLY=.T.  
       THISFORM.TXTF08.READONLY=.T.
       THISFORM.TXTF08.VISIBLE=.F.
       THISFORM.TXTF09.VISIBLE=.F.
       THISFORM.COMBOBOX08.VISIBLE=.T.
       THISFORM.COMBOBOX08.VALUE= 1
       THISFORM.TXTF01.VALUE=DATE()             
       THISFORM.TXTF02.VALUE=PO_NO
       THISFORM.TXTF05.VALUE=''
       THISFORM.TXTF06.VALUE=''
       THISFORM.TXTF07.VALUE='A1'
       THISFORM.TXTF08.VALUE='年假'
       THISFORM.TXTF09.VALUE=IIF(INDEXSEEK('G'+'A1',.T.,'S00','S003'),S00.F28,'D')
       THISFORM.TXTF10.VALUE=DATE()
       THISFORM.TXTF11.VALUE=DATE()
       THISFORM.TXTF14.VALUE=1
       THISFORM.TXTF16.VALUE=''
       THISFORM.LBLF09.CAPTION='計數單位：' + ACC_BASE(THISFORM.TXTF09.VALUE)+'，請假基數：'+ALLTRIM(TRANSFORM(IIF(INDEXSEEK('G'+'A1',.T.,'S00','S003'),S00.F62,0),'@R 999,999.9'))+' ' + ACC_BASE(THISFORM.TXTF09.VALUE)  
       THISFORM.LBLF181.CAPTION=''
       THISFORM.LBLF991.CAPTION=''
       THISFORM.TXTF05.SETFOCUS() 
       FLG='1'
  ENDPROC  
************
  PROCEDURE SHRGROUP.SHURE1_BOTT.CLICK
    IF EMPTY(THISFORM.TXTF02.VALUE)
       =MESSAGEBOX('單據編號不得空白,請洽系統管理人員處裡!',0+64,'提示視窗')
       THISFORM.TXTF02.SETFOCUS
       RETURN
    ENDIF  
    IF INDEXSEEK(THISFORM.TXTF02.VALUE,.F.,'S18','S181') =.T.
             SELE A24
             SEEK 'S023 '+SUBSTR(DTOS(DATE()),3,4)+THISFORM.TXTF02.VALUE
             IF FOUND()
                 DO WHILE F01+F02+F08='S023 '+SUBSTR(DTOS(DATE()),3,4)+THISFORM.TXTF02.VALUE
                        RLOCK()
                        DELE
                        UNLOCK
                        SKIP
                 ENDDO   
             ENDIF                    
             SELE A09
             SEEK 'S023 '+SUBSTR(DTOS(DATE()),3,4)
             IF FOUND()
                 RLOCK()
                 HX=VAL(RIGHT(F08,4))+1
   	         PO_NO=LEFT(F08,6)+PADL(ALLTRIM(STR(HX)),4,'0')
	         REPLACE  F08 WITH PO_NO                                             &&記錄本訂單號碼,本月份後續的訂單號碼將以此往下編
		 UNLOCK
                  THISFORM.TXTF02.VALUE=PO_NO
	          THISFORM.TXTF02.REFRESH
             ENDIF   	       
    ENDIF   
    IF EMPTY(ALLTRIM(THISFORM.TXTF05.VALUE)) OR EMPTY(ALLTRIM(THISFORM.TXTF06.VALUE))
       =MESSAGEBOX('部門編號不得空白!',0+64,'提示視窗')
       THISFORM.TXTF05.SETFOCUS
       RETURN
    ENDIF           
    IF EMPTY(THISFORM.TXTF07.VALUE)
        =MESSAGEBOX('假別名稱不得空白!',0+64,'提示視窗')
	THISFORM.TXTF07.SETFOCUS
	RETURN
    ENDIF      
    IF EMPTY(THISFORM.TXTF10.VALUE)
	 =MESSAGEBOX('請假起始日期不得空白!',0+64,'提示視窗')
	THISFORM.TXTF10.SETFOCUS
	 RETURN
    ENDIF     
   IF DOW(THISFORM.TXTF10.VALUE)=1 OR DOW(THISFORM.TXTF10.VALUE)=7 OR;
       IIF(INDEXSEEK(DTOS(THISFORM.TXTF10.VALUE),.T.,'S15','S151'),S15.F03='1',.F.)
       =MESSAGEBOX('請假起始日期不得為假日,請查明後再輸入!',0+64,'提示視窗')
        THISFORM.TXTF10.SETFOCUS
	RETURN         
   ENDIF    
    IF EMPTY(THISFORM.TXTF11.VALUE)
        =MESSAGEBOX('請假截止日期不得空白!',0+64,'提示視窗')
	THISFORM.TXTF11.SETFOCUS
	RETURN
    ENDIF  	
   IF DOW(THISFORM.TXTF11.VALUE)=1 OR DOW(THISFORM.TXTF11.VALUE)=7 OR;
       IIF(INDEXSEEK(DTOS(THISFORM.TXTF11.VALUE),.T.,'S15','S151'),S15.F03='1',.F.)
       =MESSAGEBOX('請假截止日期不得為假日,請查明後再輸入!',0+64,'提示視窗')
        THISFORM.TXTF11.SETFOCUS
	RETURN         
   ENDIF       
    IF THISFORM.TXTF10.VALUE>THISFORM.TXTF11.VALUE
	 =MESSAGEBOX('請假起始日期不得大於請假截止日期,請重新輸入!',0+64,'提示視窗')
	 THISFORM.TXTF10.SETFOCUS
	 RETURN             
    ENDIF        
    IF THISFORM.TXTF11.VALUE<THISFORM.TXTF10.VALUE
	 =MESSAGEBOX('請假截止日期不得小於請假起始日期,請重新輸入!',0+64,'提示視窗')
	THISFORM.TXTF11.SETFOCUS
	 RETURN            
    ENDIF     		 
    IF LEFT(DTOS(THISFORM.TXTF10.VALUE),6) <> LEFT(DTOS(THISFORM.TXTF11.VALUE),6)
	 =MESSAGEBOX('請假起始日期與截止日期需相同年月,請重新輸入!',0+64,'提示視窗')
	THISFORM.TXTF10.SETFOCUS
	 RETURN            
    ENDIF            
    IF EMPTY(THISFORM.TXTF14.VALUE)
	 =MESSAGEBOX('請假天數不可為零!',0+64,'提示視窗')
	THISFORM.TXTF14.SETFOCUS
	 RETURN            
    ENDIF          
    ***
    Holiday_No = 0 &&假日天數  
    FOR I = 0 TO THISFORM.TXTF11.VALUE - THISFORM.TXTF10.VALUE
            IF DOW(THISFORM.TXTF10.VALUE + I) = 1 OR DOW(THISFORM.TXTF10.VALUE + I) = 7 OR IIF(INDEXSEEK(DTOS(THISFORM.TXTF10.VALUE + I ),.T.,'S15','S151'),S15.F03='1',.F.)
                Holiday_No = Holiday_No + 1
            ENDIF                   
    ENDFOR
    IF THISFORM.TXTF14.VALUE > (THISFORM.TXTF11.VALUE - THISFORM.TXTF10.VALUE + 1) - Holiday_No
	 =MESSAGEBOX('請假天數不正確,請重新輸入!',0+64,'提示視窗')
	THISFORM.TXTF14.SETFOCUS
	 RETURN        
    ENDIF     
    IF IIF(INDEXSEEK('G'+'A1',.T.,'S00','S003'),S00.F62,0) <> 0   
        IF MOD(THISFORM.TXTF14.VALUE,S00.F62) <> 0
             =MESSAGEBOX('請假天數需為'+'請假基數'+ALLTRIM(TRANSFORM(IIF(INDEXSEEK('G'+'A1',.T.,'S00','S003'),S00.F62,0),'@R 999,999.9'))+' ' + ACC_BASE(THISFORM.TXTF09.VALUE)+'之倍數!',0+64,'提示視窗')
	     THISFORM.TXTF14.SETFOCUS
	     RETURN        
       ENDIF        
    ENDIF    
*!*	    IF  !EMPTY(THISFORM.TXTF15.VALUE)
*!*	          IF THISFORM.TXTF15.VALUE < IIF(INDEXSEEK('G'+'A1',.T.,'S00','S003'),S00.F62,0)
*!*	               =MESSAGEBOX('請假時數不可為小於'+'請假基數'+ALLTRIM(TRANSFORM(IIF(INDEXSEEK('G'+'A1',.T.,'S00','S003'),S00.F62,0),'@R 999,999.9'))+' ' + ACC_BASE(THISFORM.TXTF09.VALUE),0+64,'提示視窗')
*!*		       THISFORM.TXTF15.SETFOCUS
*!*		       RETURN          
*!*	          ENDIF 
*!*	          IF IIF(INDEXSEEK('G'+'A1',.T.,'S00','S003'),S00.F62,0) <> 0
*!*	              IF MOD(THISFORM.TXTF15.VALUE,S00.F62) <> 0
*!*	                 =MESSAGEBOX('請假時數需為'+'請假基數'+ALLTRIM(TRANSFORM(IIF(INDEXSEEK('G'+'A1',.T.,'S00','S003'),S00.F62,0),'@R 999,999.9'))+' ' + ACC_BASE(THISFORM.TXTF09.VALUE)+'之倍數!',0+64,'提示視窗')
*!*		          THISFORM.TXTF14.SETFOCUS
*!*		          RETURN        
*!*	              ENDIF
*!*	          ENDIF     
*!*	    ENDIF 
    IF EMPTY(THISFORM.TXTF16.VALUE)
       =MESSAGEBOX('請假事由不得空白!',0+64,'提示視窗')
       THISFORM.TXTF16.SETFOCUS
       RETURN
    ENDIF         
    ***
    SELECT S18
    APPEND BLANK
    LOCK()
    IF RLOCK()
       REPLACE F01 WITH THISFORM.TXTF01.VALUE
       REPLACE F02 WITH THISFORM.TXTF02.VALUE
       REPLACE F05 WITH THISFORM.TXTF05.VALUE
       REPLACE F06 WITH THISFORM.TXTF06.VALUE
       REPLACE F07 WITH THISFORM.TXTF07.VALUE
       REPLACE F08 WITH THISFORM.TXTF08.VALUE
       REPLACE F09 WITH THISFORM.TXTF09.VALUE 
       REPLACE F10 WITH THISFORM.TXTF10.VALUE
       REPLACE F11 WITH THISFORM.TXTF11.VALUE
       REPLACE F14 WITH THISFORM.TXTF14.VALUE
       REPLACE F16 WITH THISFORM.TXTF16.VALUE
       REPLACE F18 WITH 'N'
       REPLACE F19 WITH sys_oper
       REPLACE F99 WITH DTOC(DATE())+' '+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
    ENDIF          
    SELECT  S23_1
    APPEND BLANK
    LOCK()
    IF RLOCK()
       REPLACE F01 WITH THISFORM.TXTF01.VALUE
       REPLACE F02 WITH THISFORM.TXTF02.VALUE
       REPLACE F05 WITH THISFORM.TXTF05.VALUE
       REPLACE F06 WITH THISFORM.TXTF06.VALUE
       REPLACE F07 WITH THISFORM.TXTF07.VALUE
       REPLACE F08 WITH THISFORM.TXTF08.VALUE
       REPLACE F09 WITH THISFORM.TXTF09.VALUE
       REPLACE F10 WITH THISFORM.TXTF10.VALUE
       REPLACE F11 WITH THISFORM.TXTF11.VALUE	
       REPLACE F14 WITH THISFORM.TXTF14.VALUE
       REPLACE F16 WITH THISFORM.TXTF16.VALUE
       REPLACE F18 WITH 'N'
       REPLACE F19 WITH sys_oper
       REPLACE F99 WITH DTOC(DATE())+' '+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
    ENDIF
    IF !USED('S05')  &&人事薪資基本檔
        SELE 0
	USE S05 
    ELSE
        SELE S05
    ENDIF  
    SELECT F01,F02 FROM S05 WHERE ALLTRIM(F05) = ALLTRIM(THISFORM.TXTF05.VALUE) ORDER BY F01 INTO CURSOR S05_TEMP
    SELECT S05_TEMP
    GO TOP
    DO WHILE !EOF()
           SELECT S13
           APPEND BLANK
           REPLACE S13.F01 WITH 'S23'
           REPLACE S13.F02 WITH THISFORM.TXTF02.VALUE
           REPLACE S13.F03 WITH THISFORM.TXTF05.VALUE
           REPLACE S13.F04 WITH S05_TEMP.F01
           REPLACE S13.F05 WITH S05_TEMP.F02
           SELECT S05_TEMP
           SKIP
    ENDDO
    SELECT S05
    USE
    SELECT S05_TEMP
    USE
    UNLOCK
    THISFORM.GRID1.ENABLED=.T.
    THISFORM.REFRESH
    THISFORM.GRID1.SETFOCUS    
    THISFORM.SHRGROUP.ABANDON_BOTT.CLICK             
  ENDPROC
************  
  PROCEDURE ORPGROUP.EDIT_BOTT.CLICK
     SELECT S23_1
     THISFORM.KEY_LIST.ENABLED=.F. 
     THISFORM.ANS_BOTT.ENABLED=.F.
     THISFORM.INVERSE_BOTT.ENABLED=.F.   
     THISFORM.OLIST_BOTT.ENABLED=.F.         
     THISFORM.GRID1.ENABLED=.F.     
     THISFORM.GRID2.ENABLED=.F. 
     THISFORM.SETALL('READONLY',.F.,'TEXTBOX')  
     THISFORM.LBLF09.VISIBLE=.T.
     THISFORM.TXTF01.READONLY=.T.
     THISFORM.TXTF02.READONLY=.T.
     THISFORM.TXTF05.READONLY=.T.
     THISFORM.TXTF06.READONLY=.T.
     THISFORM.TXTF08.READONLY=.T.
     THISFORM.LBLF181.CAPTION=''  
     THISFORM.LBLF991.CAPTION=''     
     THISFORM.TXTF10.SETFOCUS
     LOCK()
     IF !RLOCK()
        DO FILE_IMPACT
        RETURN
     ENDIF
  ENDPROC 
************  
  PROCEDURE SHRGROUP.SHURE2_BOTT.CLICK    
    IF EMPTY(THISFORM.TXTF07.VALUE)
        =MESSAGEBOX('假別名稱不得空白!',0+64,'提示視窗')
	THISFORM.TXTF07.SETFOCUS
	RETURN
    ENDIF      
    IF EMPTY(THISFORM.TXTF10.VALUE)
	 =MESSAGEBOX('請假起始日期不得空白!',0+64,'提示視窗')
	THISFORM.TXTF10.SETFOCUS
	 RETURN
    ENDIF   
   IF DOW(THISFORM.TXTF10.VALUE)=1 OR DOW(THISFORM.TXTF10.VALUE)=7 OR;
       IIF(INDEXSEEK(DTOS(THISFORM.TXTF10.VALUE),.T.,'S15','S151'),S15.F03='1',.F.)
       =MESSAGEBOX('請假起始日期不得為假日,請查明後再輸入!',0+64,'提示視窗')
        THISFORM.TXTF10.SETFOCUS
	RETURN         
   ENDIF       
    IF EMPTY(THISFORM.TXTF11.VALUE)
        =MESSAGEBOX('請假截止日期不得空白!',0+64,'提示視窗')
	THISFORM.TXTF11.SETFOCUS
	RETURN
    ENDIF  	      
   IF DOW(THISFORM.TXTF11.VALUE)=1 OR DOW(THISFORM.TXTF11.VALUE)=7 OR;
       IIF(INDEXSEEK(DTOS(THISFORM.TXTF11.VALUE),.T.,'S15','S151'),S15.F03='1',.F.)
       =MESSAGEBOX('請假截止日期不得為假日,請查明後再輸入!',0+64,'提示視窗')
        THISFORM.TXTF11.SETFOCUS
	RETURN         
   ENDIF       
    IF THISFORM.TXTF10.VALUE>THISFORM.TXTF11.VALUE
	 =MESSAGEBOX('請假起始日期不得大於請假截止日期,請重新輸入!',0+64,'提示視窗')
	 THISFORM.TXTF10.SETFOCUS
	 RETURN             
    ENDIF        
    IF THISFORM.TXTF11.VALUE<THISFORM.TXTF10.VALUE
	 =MESSAGEBOX('請假截止日期不得小於請假起始日期,請重新輸入!',0+64,'提示視窗')
	THISFORM.TXTF11.SETFOCUS
	 RETURN            
    ENDIF       
    IF LEFT(DTOS(THISFORM.TXTF10.VALUE),6) <> LEFT(DTOS(THISFORM.TXTF11.VALUE),6)
	 =MESSAGEBOX('請假起始日期與截止日期需相同年月,請重新輸入!',0+64,'提示視窗')
	THISFORM.TXTF10.SETFOCUS
	 RETURN            
    ENDIF      
    IF EMPTY(THISFORM.TXTF14.VALUE) 
	 =MESSAGEBOX('請假天數不可為零!',0+64,'提示視窗')
	THISFORM.TXTF14.SETFOCUS
	 RETURN            
    ENDIF          
    ***
    Holiday_No = 0 &&假日天數  
    FOR I = 0 TO THISFORM.TXTF11.VALUE - THISFORM.TXTF10.VALUE
            IF DOW(THISFORM.TXTF10.VALUE + I) = 1 OR DOW(THISFORM.TXTF10.VALUE + I) = 7 OR IIF(INDEXSEEK(DTOS(THISFORM.TXTF10.VALUE + I ),.T.,'S15','S151'),S15.F03='1',.F.)
                Holiday_No = Holiday_No + 1
            ENDIF                   
    ENDFOR    
    IF THISFORM.TXTF14.VALUE > (THISFORM.TXTF11.VALUE - THISFORM.TXTF10.VALUE + 1) - Holiday_No
	 =MESSAGEBOX('請假天數不正確,請重新輸入!',0+64,'提示視窗')
	THISFORM.TXTF14.SETFOCUS
	 RETURN        
    ENDIF     
    IF IIF(INDEXSEEK('G'+'A1',.T.,'S00','S003'),S00.F62,0) <> 0   
        IF MOD(THISFORM.TXTF14.VALUE,S00.F62) <> 0
             =MESSAGEBOX('請假天數需為'+'請假基數'+ALLTRIM(TRANSFORM(IIF(INDEXSEEK('G'+'A1',.T.,'S00','S003'),S00.F62,0),'@R 999,999.9'))+' ' + ACC_BASE(THISFORM.TXTF09.VALUE)+'之倍數!',0+64,'提示視窗')
	     THISFORM.TXTF14.SETFOCUS
	     RETURN        
       ENDIF        
    ENDIF
*!*	    IF  !EMPTY(THISFORM.TXTF15.VALUE)
*!*	          IF THISFORM.TXTF15.VALUE < IIF(INDEXSEEK('G'+'A1',.T.,'S00','S003'),S00.F62,0)
*!*	               =MESSAGEBOX('請假時數不可為小於'+'請假基數'+ALLTRIM(TRANSFORM(IIF(INDEXSEEK('G'+'A1',.T.,'S00','S003'),S00.F62,0),'@R 999,999.9'))+' ' + ACC_BASE(THISFORM.TXTF09.VALUE),0+64,'提示視窗')
*!*		       THISFORM.TXTF15.SETFOCUS
*!*		       RETURN          
*!*	          ENDIF 
*!*	          IF IIF(INDEXSEEK('G'+'A1',.T.,'S00','S003'),S00.F62,0) <> 0
*!*	              IF MOD(THISFORM.TXTF15.VALUE,S00.F62) <> 0
*!*	                 =MESSAGEBOX('請假時數需為'+'請假基數'+ALLTRIM(TRANSFORM(IIF(INDEXSEEK('G'+'A1',.T.,'S00','S003'),S00.F62,0),'@R 999,999.9'))+' ' + ACC_BASE(THISFORM.TXTF09.VALUE)+'之倍數!',0+64,'提示視窗')
*!*		          THISFORM.TXTF14.SETFOCUS
*!*		          RETURN        
*!*	              ENDIF
*!*	          ENDIF     
*!*	    ENDIF  
    IF EMPTY(THISFORM.TXTF16.VALUE)
       =MESSAGEBOX('請假事由不得空白!',0+64,'提示視窗')
       THISFORM.TXTF16.SETFOCUS
       RETURN
    ENDIF      
    ***
    SELECT  S18
    SET ORDER TO S181
    SEEK THISFORM.TXTF02.VALUE
    IF FOUND()
        REPLACE F10 WITH THISFORM.TXTF10.VALUE
        REPLACE F11 WITH THISFORM.TXTF11.VALUE
        REPLACE F14 WITH THISFORM.TXTF14.VALUE
        REPLACE F16 WITH THISFORM.TXTF16.VALUE
        REPLACE F19 WITH sys_oper
        REPLACE F99 WITH DTOC(DATE())+' '+IIF(SEEK(sys_oper,'A01'),A01.F03,'')       
    ENDIF
    SELECT S23_1
    IF RLOCK()
        REPLACE F10 WITH THISFORM.TXTF10.VALUE
        REPLACE F11 WITH THISFORM.TXTF11.VALUE
        REPLACE F14 WITH THISFORM.TXTF14.VALUE
        REPLACE F16 WITH THISFORM.TXTF16.VALUE
        REPLACE F19 WITH sys_oper
        REPLACE F99 WITH DTOC(DATE())+' '+IIF(SEEK(sys_oper,'A01'),A01.F03,'')          
    ELSE
        DO file_impact
        RETURN   
    ENDIF   
    THISFORM.SHRGROUP.ABANDON_BOTT.CLICK    
  ENDPROC
*******************
  PROCEDURE ORPGROUP.DEL_BOTT.CLICK
     IF MESSAGEBOX('是否確定要刪除此筆資料',4+32+256,'請確認') = 6	      
         SELECT  S23_1
         LOCK()
         IF RLOCK()        
             SELECT  S23_1
             PO_NO=S23_1.F02 
             SELECT S18
             SET ORDER TO S181   && F02
             SEEK PO_NO
             IF FOUND()
                 SELECT S18
                 DELETE 
                 SELECT S23_1
	         DELETE 
	         UNLOCK
	         SKIP -1
	         IF BOF()
	             GO TOP
	         ENDIF                      
             ENDIF
             SELECT  A24
             SEEK 'S023 '+SUBSTR(DTOS(DATE()),3,4)+PO_NO
             IF !FOUND()
                 APPEND BLANK
                 RLOCK()
                 REPLACE  F01 WITH 'S023 '
                 REPLACE  F02 WITH SUBSTR(DTOS(DATE()),3,4)
                 REPLACE  F05 WITH 'SY'+F02
                 REPLACE  F06 WITH '部門年假請假作業'
                 REPLACE  F08 WITH PO_NO
                 UNLOCK           
             ENDIF    
             SELECT S13
             DELETE FOR F02 = PO_NO  AND F01 = 'S23' ALL
             THISFORM.GRID1.SETFOCUS
             THISFORM.SHRGROUP.ABANDON_BOTT.CLICK
        ELSE
              DO file_impact    
        ENDIF
     ENDIF        
  ENDPROC
*************   
  PROCEDURE SHRGROUP.ABANDON_BOTT.CLICK
      SELECT S23_1
      THISFORM.SHRGROUP.ENABLED=.F.
      THISFORM.SHRGROUP.VISIBLE=.F.      
      THISFORM.ORPGROUP.ENABLED=.T.
      THISFORM.ORPGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
      THISFORM.CMDGROUP.ENABLED=.T.
      THISFORM.CMDGROUP.SETALL('ENABLED',.T.,'COMMANDBUTTON')
      THISFORM.CMDGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
      THISFORM.SETALL('READONLY',.T.,'TEXTBOX')   
      THISFORM.KEY_LIST.ENABLED=.T.     
      THISFORM.TXTF09.VISIBLE=.F.
      THISFORM.LBLF09.VISIBLE=.F.
      THISFORM.TXTF08.VISIBLE=.T.
      THISFORM.COMBOBOX08.VISIBLE=.F.      
      THISFORM.GRID1.ENABLED=.T. 
      THISFORM.GRID2.ENABLED=.T. 
      THISFORM.GRID2.COLUMN1.CONTROLSOURCE='S13.F04'
      THISFORM.GRID2.COLUMN2.CONTROLSOURCE='S13.F05' 
      THISFORM.GRID1.SETFOCUS   
      IF THISFORM.GRID1.ACTIVEROW=0
          THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
          THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
          THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
          THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.       
          THISFORM.CMDGROUP.ENABLED=.F.
          THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
          THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
          THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
          THISFORM.ANS_BOTT.ENABLED=.F.
	  THISFORM.INVERSE_BOTT.ENABLED=.F.
	  THISFORM.OLIST_BOTT.ENABLED=.F.
          THISFORM.TXTF01.VALUE=''
          THISFORM.TXTF02.VALUE=''
          THISFORM.TXTF05.VALUE=''
          THISFORM.TXTF06.VALUE=''
          THISFORM.TXTF07.VALUE=''
          THISFORM.TXTF08.VALUE=''
          THISFORM.TXTF09.VALUE=''
          THISFORM.TXTF10.VALUE=''
          THISFORM.TXTF11.VALUE=''
          THISFORM.TXTF14.VALUE=''
          THISFORM.TXTF16.VALUE=''
          THISFORM.LBLF09.CAPTION=''
          THISFORM.LBLF181.CAPTION=''
          THISFORM.LBLF991.CAPTION=''
       ELSE
          THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
          THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
          THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
          THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.            
          THISFORM.CMDGROUP.ENABLED=.T.      
          THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  AND IIF(S23_1.F18<>'Y',.T.,.F.) &&判斷有無修改的權限
          THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)   AND IIF(S23_1.F18<>'Y',.T.,.F.) &&判斷有無刪除的權限
          THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限
          THISFORM.ANS_BOTT.ENABLED=IIF(A02.F08='*',.T.,.F.)  AND IIF(S23_1.F18<>'Y',.T.,.F.)   &&判斷有無確認的權限
*!*	          THISFORM.INVERSE_BOTT.ENABLED=IIF(A02.F09='*',.T.,.F.)   AND IIF(S23_1.F18<>'Y',.F.,.T.) &&判斷有反確認的權限
          THISFORM.INVERSE_BOTT.ENABLED=.F.
          THISFORM.OLIST_BOTT.ENABLED=IIF(A02.F08='*',.T.,.F.)  AND IIF(S23_1.F18<>'Y',.T.,.F.)
       ENDIF     
       UNLOCK ALL  
  ENDPROC
  ********
  PROCEDURE SHRGROUP.FINISH_BOTT.CLICK 
       SELECT  A24         
       SEEK 'S023 '+SUBSTR(DTOS(DATE()),3,4)+PO_NO
       IF !FOUND()
           APPEND BLANK
           RLOCK()
           REPLACE  F01 WITH 'S023 '
           REPLACE  F02 WITH SUBSTR(DTOS(DATE()),3,4)
           REPLACE  F05 WITH 'SY'+F02
           REPLACE  F06 WITH '部門年假請假作業'
           REPLACE  F08 WITH PO_NO
           UNLOCK  
       ENDIF    
       SELECT S23_1
       THISFORM.SHRGROUP.ABANDON_BOTT.CLICK
  ENDPROC    
  ***部門編號
  PROCEDURE TXTF05.DBLCLICK
      IF  THIS.ReadOnly =.F.
           SELECT F01,F02 FROM A14 INTO CURSOR DEPART ORDER BY F01 WHERE LEN(ALLTRIM(F01))=4
           DEPART_SEEK=CREATEOBJECT("DEPART_SEEK")  
           DEPART_SEEK.SHOW    
           THIS.VALUE=FLG
           THIS.REFRESH
           FLG='0'
           THISFORM.TXTF06.VALUE=IIF(SEEK(THIS.VALUE,'A14'),A14.F02,'')  
      ENDIF 
  ENDPROC      
  PROCEDURE TXTF05.INTERACTIVECHANGE
    IF AT('?',ALLTRIM(THIS.VALUE))<>0
       IF AT('?',ALLTRIM(THIS.VALUE))>1             
          SELECT F01,F02 FROM A14 INTO CURSOR DEPART ORDER BY F01 WHERE LEFT(F01,AT('?',THIS.VALUE)-1)=LEFT(THIS.VALUE,AT('?',THIS.VALUE)-1) AND LEN(ALLTRIM(F01))=4
       ELSE
          SELECT F01,F02 FROM A14 INTO CURSOR DEPART ORDER BY F01 WHERE LEN(ALLTRIM(F01))=4
       ENDIF   
       DEPART_SEEK=CREATEOBJECT("DEPART_SEEK")  
       DEPART_SEEK.SHOW    
       THIS.VALUE=FLG
       THIS.REFRESH
       FLG='0'
    ENDIF   
       THISFORM.TXTF06.VALUE=IIF(SEEK(THIS.VALUE,'A14'),A14.F02,'')  
  ENDPROC   
  *****請假起始日期   
  PROCEDURE  TXTF10.INTERACTIVECHANGE
       IF EMPTY(THIS.VALUE) = .F. AND EMPTY(THISFORM.TXTF11.VALUE) = .F.
            Holiday_No = 0 &&假日天數  
            FOR I = 0 TO THISFORM.TXTF11.VALUE - THIS.VALUE
           	    IF DOW(THIS.VALUE + I) = 1 OR DOW(THIS.VALUE + I) = 7 OR IIF(INDEXSEEK(DTOS(THIS.VALUE + I ),.T.,'S15','S151'),S15.F03='1',.F.)
           	          Holiday_No = Holiday_No + 1
           	    ENDIF                   
            ENDFOR
            THISFORM.TXTF14.VALUE = (THISFORM.TXTF11.VALUE -THIS.VALUE +1) - Holiday_No 
       ENDIF		
  ENDPROC   
  *****請假截止日期   
  PROCEDURE  TXTF11.INTERACTIVECHANGE         
       IF EMPTY(THIS.VALUE) = .F. AND EMPTY(THISFORM.TXTF10.VALUE) = .F.
            Holiday_No = 0 &&假日天數  
            FOR I = 0 TO THIS.VALUE - THISFORM.TXTF10.VALUE
           	    IF DOW(THISFORM.TXTF10.VALUE + I) = 1 OR DOW(THISFORM.TXTF10.VALUE+ I) = 7 OR IIF(INDEXSEEK(DTOS(THISFORM.TXTF10.VALUE + I ),.T.,'S15','S151'),S15.F03='1',.F.)
           	          Holiday_No = Holiday_No + 1
           	    ENDIF                   
            ENDFOR
            THISFORM.TXTF14.VALUE = (THIS.VALUE -THISFORM.TXTF10.VALUE +1) - Holiday_No 
       ENDIF	
  ENDPROC      
********** 確認程序
****此請假作業確認後與S10.薪資計算作業中的缺勤項目不同,兩者將各自寫到S0A.年度缺勤紀錄中,但在S10中則可新增由S18所確認之請假資料
  PROC ANS_BOTT.CLICK     
       IF MESSAGEBOX('是否要確認此筆資料?',4+32+256,'請確認') = 6	   
           SELECT S23_1
           IF S23_1.F13='Y'
               =MESSAGEBOX('此筆資料已確認過,請查明後再作確認!',0+64,'提示訊息視窗')
           ELSE    
               SELECT S23_1
               LOCK()
               IF RLOCK()          
                    IF !USED('S0A')	&&年度缺勤天數累計
                         SELECT  0
                         USE S0A 
		    ELSE
			  SELECT  S0A
		    ENDIF
		    SET ORDER TO S0A1    && F01+F05+DTOS(F08)+F09+F10    
		    IF !USED('S05')  &&人事薪資基本檔
			 SELE 0
			 USE S05 
		    ELSE
			 SELE S05
		    ENDIF
		    SET ORDER TO S051
		    SELECT S13.* FROM S13 WHERE S13.F01 = 'S23' AND S13.F02 = ALLTRIM(THISFORM.TXTF02.VALUE) ORDER BY S13.F04  INTO CURSOR S13_TEMP READWRITE 
		    INDE ON F04 TAG S13_TEMP1
		    SELECT S13_TEMP
		    SET ORDER TO S13_TEMP1
		    GO TOP
		    IF _TALLY > 0
		        CREATE CURSOR S23_TEMP (F01 C(4),F02 C(8),F03 C(40))
		        INDE ON F01 TAG S23_TEMP1
		        ***判斷已無年假之人員
		        IF THISFORM.TXTF07.VALUE = 'A1'
		              SELECT S13_TEMP
		              GO TOP
		              DO WHILE !EOF()
		                     SELECT  S05
		                     SEEK  S13_TEMP.F04
		                     IF FOUND()
		                         IF  (S05.F11 - (S05.F12 + S23_1.F14)) < 0
		                              SELECT S23_TEMP
					      APPEND BLANK 	
					      REPLACE S23_TEMP.F01 WITH S13_TEMP.F04 
					      REPLACE S23_TEMP.F02 WITH S13_TEMP.F05 	
					      REPLACE S23_TEMP.F03 WITH '已超過可休年假之天數' 
					      SELECT S13
					      SET ORDER TO S131   && F02+F01+F04
					      SEEK S23_1.F02 + 'S23' + S13_TEMP.F04
					      IF FOUND()
					           SELECT S13
					           DELETE 
					      ENDIF
		                         ENDIF
		                     ENDIF
		                     SELECT S13_TEMP
		                     SKIP
		              ENDDO
		        ENDIF
			SELECT  S23_TEMP
			GO TOP
			DO WHILE !EOF()
			       SELECT S13_TEMP
			       SEEK S23_TEMP.F01
			       IF FOUND()
			           SELECT S13_TEMP
			           DELETE 
			       ENDIF 
			       SELECT S23_TEMP
			       SKIP
			ENDDO	
		        ****判斷S10.薪資計算是否有資料
	                S10 = 'S10' + LEFT(DTOS(S23_1.F10),6)
	                S101 = 'S101' + LEFT(DTOS(S23_1.F10),6)
	                IF FILE(S10+'.DBF') = .T.
	                    IF !USED('&S10')
	                        SELECT  0
		                USE (S10) ALIA S10
	                    ELSE
		                 SELECT  S10
		            ENDIF
		            SET ORDER TO S101	
		            SELECT S13_TEMP
		            GO TOP	        
		            DO  WHILE !EOF()
				    SELECT S10	
				    SEEK S13_TEMP.F04
				    IF FOUND()
					 SELECT S23_TEMP
					 APPEND BLANK 	
					 REPLACE S23_TEMP.F01 WITH S13_TEMP.F04 
					 REPLACE S23_TEMP.F02 WITH S13_TEMP.F05 					 			    
					 IF S10.F98 =' Y'
					      REPLACE S23_TEMP.F03 WITH 'S10.薪資計算作業中已確認' 
					 ELSE 
					      REPLACE S23_TEMP.F03 WITH 'S10.薪資計算作業中已有資料' 
					 ENDIF   
				    ENDIF 
				    SELECT S13_TEMP
				    SKIP
			    ENDDO
			    SELECT S10
			    USE
			ENDIF    
			SELECT  S23_TEMP
			GO TOP
			DO WHILE !EOF()
			       SELECT S13_TEMP
			       SEEK S23_TEMP.F01
			       IF FOUND()
			           SELECT S13_TEMP
			           DELETE 
			       ENDIF 
			       SELECT S23_TEMP
			       SKIP
			ENDDO
		        *****
	                S16 = 'S16'+LEFT(DTOS(S23_1.F10),6)
		        S161 = 'S161'+LEFT(DTOS(S23_1.F10),6)
		        IF FILE(S16+'.DBF')=.T.
		            IF !USED('&S16')	&&上下班紀錄檔
		                 SELE 0
			         USE (S16) ALIA S16
		            ELSE
			         SELE S16
		            ENDIF
		            SET ORDER TO S161	
		            SELECT S13_TEMP
		            SET ORDER TO S13_TEMP1
		            GO TOP
		            DO  WHILE !EOF()
				    SELECT S16	
				    SEEK S13_TEMP.F04		            
		                    IF FOUND() AND S16.F19 = 'Y'
					 SELECT S23_TEMP
					 APPEND BLANK 	
					 REPLACE S23_TEMP.F01 WITH S13_TEMP.F04 
					 REPLACE S23_TEMP.F02 WITH S13_TEMP.F05 	
					 REPLACE S23_TEMP.F03 WITH 'S16.上下班紀錄作業中已確認'    
				    ENDIF
				    SELECT S13_TEMP
				    SKIP     	                             
		             ENDDO
		         ENDIF
			 SELECT  S23_TEMP
			 GO TOP
			 DO WHILE !EOF()
			       SELECT S13_TEMP
			       SEEK S23_TEMP.F01
			       IF FOUND()
			           SELECT S13_TEMP
			           DELETE 
			       ENDIF 
			       SELECT S23_TEMP
			       SKIP
			 ENDDO	
			**判斷S13是否已無資料
			SELECT S13
			SEEK S23_1.F02 + 'S23'
			IF !FOUND()
			     =MESSAGEBOX('此作業已無人員可供確認,請察明後再確認!',0+64,'提示視窗')
                             IF RECCOUNT('S23_TEMP') > 0
                                  NO_SEEK=CREATEOBJECT("NO_SEEK")  
                                  NO_SEEK.SHOW 			     
                             ENDIF     
			     THISFORM.GRID1.SETFOCUS
	                     RETURN   
			ENDIF			 	         
			 *****
		         SELECT S05.* FROM S05,S13_TEMP WHERE S05.F01 = S13_TEMP.F04 AND S05.F05 = S13_TEMP.F03 ORDER BY S05.F05 INTO CURSOR S05_TEMP READWRITE 
		         SELECT S13_TEMP
		         USE
		         SELECT S05_TEMP
		         GO TOP
		         DO WHILE !EOF()  
				Day_Hour = IIF(INDEXSEEK('I' + S05_TEMP.F29,.T.,'S00','S005'),S00.F57,0)	&&上班總時數 
				S00_F50 = IIF(INDEXSEEK('I' + S05_TEMP.F29,.T.,'S00','S005'),S00.F50,'')	&&班別:上班時段
				S00_F51 = IIF(INDEXSEEK('I' + S05_TEMP.F29,.T.,'S00','S005'),S00.F51,'')	&&班別:下班時段	 
				S00_F52 = IIF(INDEXSEEK('I'+S05_TEMP.F29,.T.,'S00','S005'),S00.F52,'')		&&班別:休息時段起	
				S00_F53 = IIF(INDEXSEEK('I'+S05_TEMP.F29,.T.,'S00','S005'),S00.F53,'')		&&班別:休息時段止    
				F54T = IIF(INDEXSEEK('I'+S05_TEMP.F29,.T.,'S00','S005'),S00.F54,'')		&&上班遲到緩衝時間
				F54_H = VAL(LEFT(ALLTRIM(F54T),2))		&&上班遲到緩衝時間(時)
				F54_M = VAL(RIGHT(ALLTRIM(F54T),2))   	&&上班遲到緩衝時間(分)	
				F55T = IIF(INDEXSEEK('I'+S05_TEMP.F29,.T.,'S00','S005'),S00.F55,'')		&&下班早退緩衝時間
				F55_H = VAL(LEFT(ALLTRIM(F55T),2))		&&下班早退緩衝時間(時)
				F55_M = VAL(RIGHT(ALLTRIM(F55T),2))   	&&下班早退緩衝時間(分)	
				******					
				H = 'S018 ' + SUBSTR(DTOS(DATE()),3,4)
				SELECT  A24   
				SET ORDER TO 1
				SEEK H           
				IF FOUND() 
				    PO_NO = F08
				    RLOCK()
				    DELETE  
				    UNLOCK
				ELSE
				    SELE A09
				    SEEK H            
				    IF  !FOUND()                                                  &&如果為本月第一張訂單則重頭開始編號
				         APPEND BLANK                                                
				         REPLACE  F01 WITH 'S018 '
					 REPLACE  F02 WITH  SUBSTR(DTOS(DATE()),3,4)
					 REPLACE  F05 WITH 'SB'+F02
					 REPLACE  F06 WITH '請假作業'
					 REPLACE  F08 WITH ALLTRIM(F05)+'0000'
				    ENDIF
				    LOCK()
				    HX = VAL(RIGHT(F08,4)) + 1
				    PO_NO = LEFT(F08,6) + PADL(ALLTRIM(STR(HX)),4,'0')
				    REPLACE  F08 WITH PO_NO                                             &&記錄本訂單號碼,本月份後續的訂單號碼將以此往下編
				    UNLOCK
				ENDIF 
				***上下班記錄檔  
		                FOR I = 0 TO DAY(S23_1.F11) - DAY(S23_1.F10)
		                        SELECT S16
		                        SEEK S05_TEMP.F01 + PADL(ALLTRIM(STR(I+DAY(S23_1.F10))),2,'0')
		                        IF FOUND()  AND S16.F18 <> 1 AND S16.F18 <> 7 AND ;
		                            IIF(INDEXSEEK(LEFT(DTOS(S23_1.F10),6) + PADL(ALLTRIM(STR(I + DAY(S23_1.F10))),2,'0'),.T.,'S15','S151'),S15.F03 <> '1',.T.) && AND EMPTY(S16.F23)
		                            REPLACE S16.F13 WITH ''
		                            REPLACE S16.F14 WITH ''
		                            REPLACE S16.F15 WITH 0
		                            REPLACE S16.F16 WITH 0
		                            REPLACE S16.F17 WITH 0
		                            REPLACE S16.F26 WITH ''
		                            REPLACE S16.F27 WITH ''
		                            REPLACE S16.F28 WITH ''
		                            REPLACE S16.F23 WITH PO_NO 
		                            IF I = (DAY(S23_1.F11) - DAY(S23_1.F10)) AND  MOD(S23_1.F14,1) <> 0
		                                REPLACE S16.F24 WITH ALLTRIM(S00_F50)	&&請假起始時間
		                                REPLACE S16.F25 WITH ALLTRIM(S00_F52)	&&休息時段起   
		                            ELSE
		                                REPLACE S16.F24 WITH ALLTRIM(S00_F50)	&&請假起始時間 
		                                REPLACE S16.F25 WITH ALLTRIM(S00_F51)	&&請假截止時間   		                            
		                            ENDIF    
		                            REPLACE S16.F29 WITH S16.F11		&&請假前之上班時間  
		                            REPLACE S16.F30 WITH S16.F12		&&請假前之下班時間  
		                           *****調整上下班時間
		                            DO CASE
		                                  CASE ALLTRIM(S16.F24 )= ALLTRIM(S00_F50) AND ALLTRIM(S16.F25) = ALLTRIM(S00_F51)	&&請整天
	                                                     REPLACE S16.F11 WITH ''
		                                             REPLACE S16.F12 WITH ''	                                              
		                                  CASE ALLTRIM(S16.F24 )<> ALLTRIM(S00_F50) AND ALLTRIM(S16.F25) = ALLTRIM(S00_F51) 	
		                                             REPLACE S16.F12 WITH S16.F24
		                                  CASE ALLTRIM(S16.F24) = ALLTRIM(S00_F50) AND ALLTRIM(S16.F25) <> ALLTRIM(S00_F51) 
		                                             REPLACE S16.F11 WITH S16.F25                                	                                   	      
		                            ENDCASE  	
		                            IF  !EMPTY(ALLTRIM(S16.F11)) AND !EMPTY(ALLTRIM(S16.F12)) AND !EMPTY(ALLTRIM(S00_F52)) AND !EMPTY(ALLTRIM(S00_F53))
		                                  IF BETWEEN(ALLTRIM(S16.F11),ALLTRIM(S00_F52),ALLTRIM(S00_F53)) AND ALLTRIM(S16.F12) > ALLTRIM(S00_F53)
		                                       REPLACE S16.F11 WITH S00_F53
		                                  ENDIF
		                                  IF BETWEEN(ALLTRIM(S16.F12),ALLTRIM(S00_F52),ALLTRIM(S00_F53)) AND ALLTRIM(S16.F11) < ALLTRIM(S00_F52)
		                                      REPLACE S16.F12 WITH S00_F52
		                                  ENDIF		                                   
		                            ENDIF
		                            ****計算遲到分鐘數
				            IF ALLTRIM(S16.F11) <= ALLTRIM(S16.F24) AND !EMPTY(ALLTRIM(S16.F11))
				                F11_H = VAL(LEFT(ALLTRIM(S16.F11),2))		&&上班時間(時)
				                F11_M = VAL(RIGHT(ALLTRIM(S16.F11),2))		&&上班時間(分)
					        IF ALLTRIM(S16.F11) >= ALLTRIM(F54T) AND  !EMPTY(ALLTRIM(S16.F11)) AND !EMPTY(ALLTRIM(F54T))
					            DO CASE
					                  CASE F11_M >= F54_M
					                            REPLACE S16.F15 WITH ((F11_H - F54_H) * 60) + (F11_M - F54_M)
					                 CASE F12_M < F54_M
					                            REPLACE S16.F15 WITH ((F11_H - F08_H) * 60) - (F08_M - F11_M)
					            ENDCASE
					        ENDIF    
					    ENDIF 
					    ****計算早退分鐘數  
					    IF ALLTRIM(S16.F12) >= ALLTRIM(S16.F25) AND !EMPTY(ALLTRIM(S16.F12))
					         F12_H = VAL(LEFT(ALLTRIM(S16.F12),2))		&&下班時間(時)
					         F12_M = VAL(RIGHT(ALLTRIM(S16.F12),2))		&&下班時間(分)
					         IF ALLTRIM(S16.F12) <= ALLTRIM(F55T) AND  !EMPTY(ALLTRIM(S16.F12)) AND !EMPTY(ALLTRIM(F55T))
					             DO CASE
					                   CASE F12_M <= F55_M
					                             REPLACE S16.F16 WITH ((F55_H - F12_H) * 60) + (F55_M - F12_M)
					                  CASE F12_M > F55_M
					                             REPLACE S16.F16 WITH ((F55_H - F12_H) * 60) - (F12_M - F55_M)
					             ENDCASE
					         ENDIF
					    ENDIF					    
	                                    ***調整遲到早退分鐘數
		                            DO CASE
		                                  CASE EMPTY(ALLTRIM(S16.F11)) AND EMPTY(ALLTRIM(S16.F12))
		                                             REPLACE S16.F15 WITH 0
		                                             REPLACE S16.F16 WITH 0
		                                  CASE ALLTRIM(S16.F11) >= ALLTRIM(S16.F25)   
		                                             REPLACE S16.F15 WITH 0
		                                  CASE ALLTRIM(S16.F12) <= ALLTRIM(S16.F24)     
		                                             REPLACE S16.F16 WITH 0
		                             ENDCASE   						   	                             		                            	                            
		                        ENDIF
		                ENDFOR        				
				***	
				SELECT  S18
				APPEND BLANK 
				REPLACE S18.F01 WITH S23_1.F01
				REPLACE S18.F02 WITH PO_NO
				REPLACE S18.F03 WITH S05_TEMP.F01
				REPLACE S18.F04 WITH S05_TEMP.F02
				REPLACE S18.F05 WITH S23_1.F05
				REPLACE S18.F06 WITH S23_1.F06
				REPLACE S18.F07 WITH S23_1.F07
				REPLACE S18.F08 WITH S23_1.F08
				REPLACE S18.F09 WITH S23_1.F09
				REPLACE S18.F10 WITH S23_1.F10
				REPLACE S18.F11 WITH S23_1.F11
				IF  MOD(S23_1.F14,1) <> 0
				     REPLACE S18.F12 WITH ALLTRIM(S00_F50)
				     REPLACE S18.F13 WITH ALLTRIM(S00_F52) 
				ELSE
				     REPLACE S18.F12 WITH  ALLTRIM(S00_F50)
				     REPLACE S18.F13 WITH  ALLTRIM(S00_F51)				
				ENDIF     
				REPLACE S18.F14 WITH S23_1.F14
				REPLACE S18.F16 WITH S23_1.F16
				REPLACE S18.F17 WITH S23_1.F17
				REPLACE S18.F18 WITH 'Y'
				REPLACE S18.F19 WITH sys_oper
				REPLACE S18.F20 WITH S23_1.F20
				REPLACE S18.F21 WITH S23_1.F02
				REPLACE S18.F99 WITH DTOC(DATE())+' '+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
	                        ***若為年假則寫入S05.人事薪資基本檔年假紀錄中
		                IF S23_1.F07 = 'A1'
		                    SELECT S05
		                    SET ORDER TO S051
		                    SEEK  S05_TEMP.F01
		                    IF FOUND()	
		                         REPLACE S05.F12 WITH S05.F12 + S23_1.F14   
		                    ENDIF
		                ENDIF   
		                ***      	                 
			        SELECT S0A
				SEEK S05_TEMP.F01 + 'A1' + ALLTRIM(LEFT(DTOS(THISFORM.TXTF10.VALUE),6) + '01') + S23_1.F09 + PO_NO
				IF FOUND()
				    DO CASE		&&缺勤單位 D=日,H=小時,S=次
			                  CASE S0A.F09='D'
			                            REPLACE S0A.F07 WITH S0A.F07 + (S05.F11 - S05.F12)
			                  CASE S0A.F09='H'
			                            REPLACE S0A.F07 WITH S0A.F07 + (Day_Hour * (S05.F11 - S05.F12))
			                  CASE S0A.F09='S'
			                            REPLACE S0A.F07 WITH S0A.F07 + 1
			            ENDCASE
			        ELSE 
			            SELECT S0A
			            APPEND BLANK 
			            REPLACE S0A.F01 WITH S05_TEMP.F01
			            REPLACE S0A.F02 WITH S05_TEMP.F02
			            REPLACE S0A.F03 WITH S23_1.F05
			            REPLACE S0A.F04 WITH S23_1.F06
			            REPLACE S0A.F05 WITH S23_1.F07
			            REPLACE S0A.F06 WITH S23_1.F08
			            REPLACE S0A.F08 WITH CTOD(LEFT(DTOC(THISFORM.TXTF10.VALUE),6)+'01')
			            REPLACE S0A.F09 WITH S23_1.F09
			            DO CASE		&&缺勤單位 D=日,H=小時,S=次
			                  CASE S0A.F09='D'
			                            REPLACE S0A.F07 WITH  (S05.F11 - S05.F12)
			                  CASE S0A.F09='H'
			                             REPLACE S0A.F07 WITH Day_Hour * (S05.F11 - S05.F12)
			                  CASE S0A.F09='S'
			                             REPLACE S0A.F07 WITH  1
			             ENDCASE		     
			             REPLACE S0A.F10 WITH PO_NO
			             REPLACE S0A.F99 WITH DTOC(DATE())+' '+IIF(SEEK(sys_oper,'A01'),A01.F03,'') 	
			        ENDIF       		             			
		                ****        
                                SELECT S05_TEMP
		                SKIP
		        ENDDO 
		        SELECT S05_TEMP
		        USE 
                        SELECT S18
                        SET ORDER TO S181
                        SEEK S23_1.F02
                        IF FOUND()
                             REPLACE F18 WITH 'Y'
                             REPLACE F99 WITH DTOC(DATE())+' '+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
                        ENDIF  	  
                        SELECT S23_1
                        REPLACE F18 WITH 'Y'
                        REPLACE F99 WITH DTOC(DATE())+' '+IIF(SEEK(sys_oper,'A01'),A01.F03,'')		
                        SELECT S23_TEMP
                        SET ORDER TO S23_TEMP1
                        GO TOP
                        IF RECCOUNT('S23_TEMP') > 0
                             =MESSAGEBOX('此確認作業已成功,尚有人員未符合確認條件,請按確定後查看!',0+64,'提示視窗')  
                             NO_SEEK=CREATEOBJECT("NO_SEEK")  
                             NO_SEEK.SHOW    
                        ELSE
                            =MESSAGEBOX('此確認作業已成功,薪資計算部分請至S10.薪資計算作業中新增!',0+64,'提示視窗')
                        ENDIF    
                        SELECT S16
                        USE 
                        SELECT S23_TEMP
                        USE         
                        SELECT S23_1                		        
		    ELSE
		         =MESSAGEBOX('S05.人事薪資基本檔中無此部門之人員,請查明後在確認!',0+64,'提示訊息視窗') 
		    ENDIF 
		    SELECT S0A
		    USE
		    SELECT S05
		    USE    
	       ELSE
	            DO file_impact
                    UNLOCK ALL
                    RETURN
	       ENDIF 
	   ENDIF
      ENDIF 
      UNLOCK ALL     
      THISFORM.GRID1.SETFOCUS     	    
 ENDPROC    		    
*********************  反確認程序
  PROC INVERSE_BOTT.CLICK    
       IF MESSAGEBOX('是否要反確認此筆資料?',4+32+256,'請確認') = 6	   
           SELECT S23_1
           IF S23_1.F18 = 'N'
               =MESSAGEBOX('此筆資料尚未確認過,請查明後再作反確認!',0+64,'提示訊息視窗')
           ELSE    
               LOCK()
               IF RLOCK()           
                    IF !USED('S0A')	&&年度缺勤天數累計
                         SELECT  0
                         USE S0A 
		    ELSE
			  SELECT  S0A
		    ENDIF
		    SET ORDER TO S0A1    && F01+F05+DTOS(F08)+F09+F10                      
		    IF !USED('S05')  &&人事薪資基本檔
			 SELE 0
			 USE S05 
		    ELSE
			 SELE S05
		    ENDIF
		    SET ORDER TO S051                      
		    CREATE CURSOR S23_TEMP (F01 C(4),F02 C(8),F03 C(40))
		    INDE ON F01 TAG S23_TEMP1               
         	    SELECT S18.F02,S18.F03,S18.F04 FROM S18 WHERE  !EMPTY(S18.F21) AND ALLTRIM(S18.F21) = ALLTRIM(S23_1.F02) AND S18.F18 = 'Y' ORDER BY S18.F02 INTO CURSOR S18_TEMP READWRITE 
         	    INDE ON F03 TAG S18_TEMP1
         	    SELECT S18_TEMP
         	    SET ORDER TO S18_TEMP1
	            S10 = 'S10' + LEFT(DTOS(S23_1.F10),6)
	            S101 = 'S101' + LEFT(DTOS(S23_1.F10),6)
	            IF FILE(S10+'.DBF') = .T.
	                 IF !USED('&S10')
	                      SELECT  0
		              USE (S10) ALIA S10
	                 ELSE
		              SELECT  S10
		         ENDIF
		         SET ORDER TO S101	
		         SELECT S18_TEMP
		         GO TOP        	    
         	         DO WHILE !EOF()
         	           	SELECT S10
         	           	SET ORDER TO S101
         	           	SEEK S18_TEMP.F03
         	           	IF FOUND()
				    SELECT S23_TEMP
				    APPEND BLANK 	
				    REPLACE S23_TEMP.F01 WITH S18_TEMP.F03 
				    REPLACE S23_TEMP.F02 WITH S18_TEMP.F04 					 			    
				    IF S10.F98 =' Y'
				        REPLACE S23_TEMP.F03 WITH 'S10.薪資計算作業中已確認' 
				    ELSE 
				        REPLACE S23_TEMP.F03 WITH 'S10.薪資計算作業中已有資料' 					     
				    ENDIF            	           	     
         	           	ENDIF       	           
         	                SELECT S18_TEMP
         	                SKIP
         	          ENDDO
         	          SELECT S10
         	          USE
         	    ENDIF     
	            SELECT  S23_TEMP
		    GO TOP
		    DO WHILE !EOF()
			   SELECT S18_TEMP
			   SEEK S23_TEMP.F01
			   IF FOUND()
			        SELECT S18_TEMP
			        DELETE 
			   ENDIF 
			   SELECT S23_TEMP
			   SKIP
	            ENDDO
		    *****
	            S16 = 'S16'+LEFT(DTOS(S23_1.F10),6)
		    S161 = 'S161'+LEFT(DTOS(S23_1.F10),6)	    
		    IF FILE(S16+'.DBF')=.T.
		         IF !USED('&S16')	&&上下班紀錄檔
		              SELE 0
			      USE (S16) ALIA S16
		         ELSE
			      SELE S16
		         ENDIF
		         SET ORDER TO S161	    
         	         SELECT S18_TEMP
         	         GO TOP
         	         DO WHILE !EOF()		    
				SELECT S16	
				SEEK S18_TEMP.F03		            
		                IF FOUND() 
				    SELECT S23_TEMP
				    APPEND BLANK 	
			   	    REPLACE S23_TEMP.F01 WITH S18_TEMP.F03 
				    REPLACE S23_TEMP.F02 WITH S18_TEMP.F04 	
				    IF S16.F19 = 'Y'
				        REPLACE S23_TEMP.F03 WITH 'S16.上下班紀錄作業中已確認' 
				    ELSE
				        REPLACE S23_TEMP.F03 WITH 'S16.上下班紀錄作業中已有資料' 
				    ENDIF   
			        ENDIF         	                   	           
         	                SELECT S18_TEMP
         	                SKIP
         	          ENDDO  
         	    ENDIF
	            SELECT  S23_TEMP
		    GO TOP
		    DO WHILE !EOF()
			   SELECT S18_TEMP
			   SEEK S23_TEMP.F01
			   IF FOUND()
			        SELECT S18_TEMP
			        DELETE 
			   ENDIF 
			   SELECT S23_TEMP
			   SKIP
	            ENDDO         	    
         	    ****
         	    SELECT S18_TEMP
         	    GO TOP
         	    DO WHILE !EOF()
			   S05_F29 = IIF(INDEXSEEK(S18_TEMP.F03,.T.,'S05','S051'),S05.F29,'')
			   Day_Hour = IIF(INDEXSEEK('I' + S05_F29,.T.,'S00','S005'),S00.F57,0)	&&上班總時數 
			   S00_F50 = IIF(INDEXSEEK('I' + S05_F29,.T.,'S00','S005'),S00.F50,'')	&&班別:上班時段
			   S00_F51 = IIF(INDEXSEEK('I' + S05_F29,.T.,'S00','S005'),S00.F51,'')	&&班別:下班時段	 
			   S00_F52 = IIF(INDEXSEEK('I' + S05_F29,.T.,'S00','S005'),S00.F52,'')	&&班別:休息時段起	
			   S00_F53 = IIF(INDEXSEEK('I' + S05_F29,.T.,'S00','S005'),S00.F53,'')	&&班別:休息時段止    
			   F54T = IIF(INDEXSEEK('I' + S05_F29,.T.,'S00','S005'),S00.F54,'')		&&上班遲到緩衝時間
			   F54_H = VAL(LEFT(ALLTRIM(F54T),2))							&&上班遲到緩衝時間(時)
			   F54_M = VAL(RIGHT(ALLTRIM(F54T),2))   						&&上班遲到緩衝時間(分)	
			   F55T = IIF(INDEXSEEK('I' + S05_F29,.T.,'S00','S005'),S00.F55,'')		&&下班早退緩衝時間
			   F55_H = VAL(LEFT(ALLTRIM(F55T),2))							&&下班早退緩衝時間(時)
			   F55_M = VAL(RIGHT(ALLTRIM(F55T),2))   						&&下班早退緩衝時間(分)	         	    
			   ***上下班記錄檔  
		           FOR I = 0 TO DAY(S23_1.F11) - DAY(S23_1.F10)         	    
		                   SELECT S16
		                   SEEK S18_TEMP.F03 + PADL(ALLTRIM(STR(I + DAY(S23_1.F10))),2,'0')
		                   IF FOUND() AND ALLTRIM(S16.F23) = ALLTRIM(S18_TEMP.F02)	
		                       REPLACE S16.F11 WITH S16.F29	
		                       REPLACE S16.F12 WITH S16.F30
		                       REPLACE S16.F15 WITH 0
		                       REPLACE S16.F16 WITH 0
		                       REPLACE S16.F23 WITH  ''
		                       REPLACE S16.F24 WITH  ''
		                       REPLACE S16.F25 WITH  ''
		                       REPLACE S16.F29 WITH  ''
		                       REPLACE S16.F30 WITH  ''		&&請假前之上班時間  
		                       REPLACE S16.F31 WITH  ''		&&請假前之下班時間  	
	                               *****調整上下班時間 
	                               IF  !EMPTY(ALLTRIM(S16.F11)) AND !EMPTY(ALLTRIM(S16.F12)) AND !EMPTY(ALLTRIM(S00_F52)) AND !EMPTY(ALLTRIM(S00_F53))
	                                     IF BETWEEN(ALLTRIM(S16.F11),ALLTRIM(S00_F52),ALLTRIM(S00_F53)) AND ALLTRIM(S16.F12)>ALLTRIM(S00_F53)
	                                          REPLACE S16.F11 WITH S00_F53
	                                     ENDIF
	                                     IF BETWEEN(ALLTRIM(S16.F12),ALLTRIM(S00_F52),ALLTRIM(S00_F53)) AND ALLTRIM(S16.F11)<ALLTRIM(S00_F52)
	                                         REPLACE S16.F12 WITH S00_F52
	                                     ENDIF		                                   
	                               ENDIF	
	                               ****計算遲到分鐘數
			               IF ALLTRIM(S16.F11)<=ALLTRIM(S16.F24) AND !EMPTY(ALLTRIM(S16.F11))
			                    F11_H=VAL(LEFT(ALLTRIM(S16.F11),2))		&&上班時間(時)
			                    F11_M=VAL(RIGHT(ALLTRIM(S16.F11),2))		&&上班時間(分)
				            IF ALLTRIM(S16.F11)>=ALLTRIM(F54T) AND  !EMPTY(ALLTRIM(S16.F11)) AND !EMPTY(ALLTRIM(F54T))
				                DO CASE
				                      CASE F11_M>=F54_M
				                                 REPLACE S16.F15 WITH ((F11_H-F54_H)*60)+(F11_M-F54_M)
				                      CASE F12_M<F54_M
				                                 REPLACE S16.F15 WITH ((F11_H-F08_H)*60)-(F08_M-F11_M)
				                ENDCASE
				            ENDIF    
				       ENDIF 		                                
                                       ***調整遲到早退分鐘數
	                               DO CASE
	                                     CASE EMPTY(ALLTRIM(S16.F11)) AND EMPTY(ALLTRIM(S16.F12))
	                                                REPLACE S16.F15 WITH 0
	                                                REPLACE S16.F16 WITH 0
	                                     CASE ALLTRIM(S16.F11) >= ALLTRIM(S16.F25)   
	                                                REPLACE S16.F15 WITH 0
	                                     CASE ALLTRIM(S16.F12) <= ALLTRIM(S16.F24)     
	                                                REPLACE S16.F16 WITH 0
	                                ENDCASE  		                                          		                       	                       
		                   ENDIF                   
		           ENDFOR
		           ***
		           S0A_F08 =  S23_1.F10
                           SELECT S05
                           SET ORDER TO S051
                           SEEK S18_TEMP.F03
                           IF FOUND()	
                                IF S05.F11 - S05.F12 < 0
                                    S0A_F08 = CTOD(ALLTRIM(STR(YEAR(S23_1.F10) + 1)) + '/01/01')
                                ENDIF
                                 REPLACE S05.F12 WITH S05.F12 - S23_1.F14
                           ENDIF 
                           ***		           
         	           SELECT S0A
	                   SET ORDER TO S0A1
	                   SEEK S18_TEMP.F03 + 'A1' + ALLTRIM(LEFT(DTOS(S0A_F08),6) + '01') +S23_1.F09 + S23_1.F02
	                   IF FOUND()
	                       DO CASE		&&缺勤單位 D=日,H=小時,S=次
	                             CASE S0A.F09='D'
	                                        REPLACE S0A.F07 WITH S0A.F07 - S23_1.F14
	                             CASE S0A.F09='H'
	                                        REPLACE S0A.F07 WITH  S0A.F07 - (Day_Hour * S23_1.F14)
	                             CASE S0A.F09='S'
	                   	               REPLACE S0A.F07 WITH S0A.F07 - 1
	                       ENDCASE
	                       REPLACE S0A.F99 WITH DTOC(DATE())+' '+IIF(SEEK(sys_oper,'A01'),A01.F03,'')  
	                       IF S0A.F07 = 0
	                           DELETE 
	                       ENDIF
                           ENDIF  
                           **
                           SELECT S18
                           SET ORDER TO S181
                           SEEK S18_TEMP.F02
                           IF FOUND()        	           
                                IF  '20'+SUBSTR(S18.F02,3,4) = LEFT(DTOS(DATE()),6)
                                      SELECT A24
				      SEEK 'S018 ' + SUBSTR(S18.F02,3,4) + S18.F02
		                      IF !FOUND()
		                          APPEND BLANK
		                          RLOCK()
		                          REPLACE  F01 WITH 'S018 '
		                          REPLACE  F02 WITH SUBSTR(S18.F02,3,4)
		                          REPLACE  F05 WITH 'SB'+F02
		                          REPLACE  F06 WITH '請假作業'
		                          REPLACE  F08 WITH S18.F02
		                          UNLOCK           
		                      ENDIF   
		                ELSE     
                                    A24A='A2420'+SUBSTR(S18.F02,3,4)	&&單號暫存檔
				    IF !USED('&A24A')
				         SELE 0
				         USE (A24A) 
			  	    ELSE
				         SELE &A24A
				    ENDIF
				    SET ORDER TO 1    
				    SELECT &A24A
				    SEEK 'S018 ' + SUBSTR(S18.F02,3,4) + S18.F02
		                    IF !FOUND()
		                        APPEND BLANK
		                        RLOCK()
		                        REPLACE  F01 WITH 'S018 '
		                        REPLACE  F02 WITH SUBSTR(S18.F02,3,4)
		                        REPLACE  F05 WITH 'SB'+F02
		                        REPLACE  F06 WITH '請假作業'
		                        REPLACE  F08 WITH S18.F02
		                        UNLOCK           
		                    ENDIF    
		                    SELECT &A24A
		                    USE 
		                ENDIF    
				SELECT S18
				DELETE 
                           ENDIF                        
         	           SELECT S18_TEMP
         	           SKIP
         	    ENDDO
         	    ***
         	    SELECT S0A
         	    USE
         	    SELECT S05
         	    USE
         	    SELECT S16
         	    USE
                    SELECT S18_TEMP
                    USE 	
                    SELECT S18
                    SEEK S23_1.F02
                    IF FOUND()
                        REPLACE S18.F18 WITH 'N'
                    ENDIF
                    SELECT S23_1
                    REPLACE F18 WITH 'N'
                    REPLACE F99 WITH DTOC(DATE())+' '+IIF(SEEK(sys_oper,'A01'),A01.F03,'')	
                    SELECT S23_TEMP
                    SET ORDER TO S23_TEMP1
                    GO TOP
                     IF RECCOUNT('S23_TEMP') > 0
                         =MESSAGEBOX('此反確認作業已成功,尚有人員未符合反確認條件,請按確定後查看!',0+64,'提示視窗')  
                         NO_SEEK=CREATEOBJECT("NO_SEEK")  
                         NO_SEEK.SHOW    
                    ELSE
                        =MESSAGEBOX('此反確認作業已成功!',0+64,'提示視窗')  
                    ENDIF    
                    SELECT S23_TEMP
                    USE
                    SELECT S23_1                    	    
               ELSE
                    DO file_impact
                    UNLOCK ALL
                    RETURN
               ENDIF   
               UNLOCK ALL   
           ENDIF
     ENDIF   
     THISFORM.GRID1.SETFOCUS   
  ENDPROC  
  ***********************修改作業人員
  PROC OLIST_BOTT.CLICK    
    IF !USED('S05')  &&人事薪資基本檔
        SELE 0
	USE S05 
    ELSE
        SELE S05
    ENDIF    
    SELECT 0,F01,F02 FROM S05 WHERE ALLTRIM(F05) = ALLTRIM(THISFORM.TXTF05.VALUE) ORDER BY F01 INTO CURSOR S05_TEMP READWRITE 
    INDE ON F01 TAG S05_TEMP1
    SELECT S05_TEMP
    SET ORDER TO S05_TEMP1
    SELECT S05
    USE
    SELECT F04 FROM S13 WHERE F02 =THISFORM.TXTF02.VALUE AND F01 = 'S23' ORDER BY F01 INTO CURSOR S13_TEMP
    SELECT S13_TEMP
    GO TOP
    DO WHILE !EOF()
           SELECT S05_TEMP
           SEEK S13_TEMP.F04
           IF FOUND()
               REPLACE S05_TEMP.EXP_1 WITH 1
           ENDIF
           SELECT S13_TEMP
           SKIP
    ENDDO
    SELECT S13_TEMP
    USE
    SELECT S05_TEMP
    GO TOP
*!*	    IF _TALLY > 0
   IF !EOF()
        OLIST_SEEK=CREATEOBJECT("OLIST_SEEK")  
        OLIST_SEEK.SHOW 
        IF CHK_IN=''   
        SELECT S05_TEMP
        GO TOP
        DO WHILE !EOF()
               SELECT S13
               SET ORDER TO S131   && F02+F01+F04
               SEEK THISFORM.TXTF02.VALUE + 'S23' + S05_TEMP.F01
               IF FOUND()
                   IF S05_TEMP.EXP_1 = 0
                        SELECT S13
                        DELETE  
                   ENDIF
               ELSE
                   IF S05_TEMP.EXP_1 = 1
                       SELECT S13
                       APPEND BLANK
                       REPLACE S13.F01 WITH 'S23'
                       REPLACE S13.F02 WITH THISFORM.TXTF02.VALUE
                       REPLACE S13.F03 WITH THISFORM.TXTF05.VALUE
                       REPLACE S13.F04 WITH S05_TEMP.F01
                       REPLACE S13.F05 WITH S05_TEMP.F02
                   ENDIF 
               ENDIF
               SELECT S05_TEMP
               SKIP
        ENDDO 
        ENDIF
    ELSE
        =MESSAGEBOX('查無此部門之人員!',0+64,'提示視窗') 
    ENDIF
    SELECT S05_TEMP
    USE
    SELECT S13
    GO TOP
    THISFORM.GRID2.SETFOCUS  
    THISFORM.GRID1.SETFOCUS       
  ENDPROC   
ENDDEFINE    
***********************************************列印程序
PROCEDURE PNT_PRC  
 
ENDPROC
**************************************確認或反確認未符合條件之人員畫面
DEFINE CLASS NO_SEEK AS FORM
*!*	  AUTOCENTER=.T.
  CAPTION='無法確認或反確認之人員一欄表'
  TOP=INT_015*150
  LEFT=INT_015*200      
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*250
  WIDTH=INT_015*350
  MAXBUTTON=.F.
  MINBUTTON=.F.    
  CLOSABLE=.F.
  CONTROLBOX=.F.
  BORDERSTYLE=2
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WINDOWTYPE=1
  NAME='NO_SEEK'
  ADD OBJECT GRDD01 AS GRID WITH;          
      AUTOCENTER=.T.,;
      TOP=0,;
      WIDTH=INT_015*350,;      
      HEIGHT=INT_015*220,;      
      ROWHEIGHT=INT_015*18,;
      HEADERHEIGHT=INT_015*19,;
      ALLOWCELLSELECTION=.F.,;
      DELETEMARK=.F.,;
      READONLY=.T.,;
      RECORDSOURCETYPE=1,;
      COLUMNCOUNT=3,;            
      RECORDSOURCE='S23_TEMP',;      
      NAME='GRDD01',;
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;      
      COLUMN3.NAME='COLUMN3'  
  ADD OBJECT CMND1 AS COMMANDBUTTON WITH;
      AUTOSIZE=.T.,;
      LEFT=INT_015*75,;    
      HEIGHT=INT_015*25,;   
      TOP=INT_015*223,;        
      WIDTH=INT_015*80,;
      FONTSIZE=INT_015*9,;
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\HARROW.CUR',;        
      CAPTION='\<E.轉EXCEL',;
      TOOLTIPTEXT='選擇游標所指的紀錄!快速鍵->ALT+S'
      NAME='CMND1'
  ADD OBJECT CMND2 AS COMMANDBUTTON WITH;
      AUTOSIZE=.T.,;
      LEFT=INT_015*200,;
      TOP=INT_015*223,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*80,;
      FONTSIZE=INT_015*9,;     
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\HARROW.CUR',;         
      CAPTION='\<C.離   開',;
      TOOLTIPTEXT='離開此搜尋畫面!快速鍵->ALT+C'
      NAME='CMND2'
 PROCEDURE INIT 
         SELECT S23_TEMP
         GO TOP
         THISFORM.SETALL('MOVABLE',.F.,'COLUMN')
         THISFORM.GRDD01.SETALL('FONTSIZE',INT_015*9,'COLUMN') 
         THISFORM.GRDD01.SETALL('FONTSIZE',INT_015*9,'HEADER')          
         THISFORM.GRDD01.COLUMN1.HEADER1.CAPTION='人員編號'
         THISFORM.GRDD01.COLUMN1.WIDTH=INT_015*50
         THISFORM.GRDD01.COLUMN1.CONTROLSOURCE='S23_TEMP.F01'
         THISFORM.GRDD01.COLUMN2.HEADER1.CAPTION='人員姓名'
         THISFORM.GRDD01.COLUMN2.WIDTH=INT_015*50
         THISFORM.GRDD01.COLUMN2.CONTROLSOURCE='S23_TEMP.F02'
         THISFORM.GRDD01.COLUMN3.HEADER1.CAPTION='無法確認或反確認之原因'
         THISFORM.GRDD01.COLUMN3.WIDTH=INT_015*210
         THISFORM.GRDD01.COLUMN3.CONTROLSOURCE='S23_TEMP.F03'
         THISFORM.GRDD01.SETFOCUS
         IF THISFORM.GRDD01.ACTIVEROW<>0
              THISFORM.GRDD01.AFTERROWCOLCHANGE 
         ENDIF 
 ENDPROC
 PROCEDURE  GRDD01.AFTERROWCOLCHANGE
     LPARAMETERS NCOLINDEX
 ENDPROC 
 PROCEDURE CMND1.CLICK                               
	  FILE_NAME = 'S23 無法確認或反確認之人員清單'
	  GCDELIMFILE=PUTFILE('儲存路徑',FILE_NAME,'XLS')
	  IF EMPTY(GCDELIMFILE)  && ESC PRESSED
	        RETURN
	   ELSE
	        SELECT S23_TEMP
	        COPY TO (GCDELIMFILE) TYPE XL5   
	         =MESSAGEBOX('儲存成功',0+64,'提示訊息視窗')                           
	   ENDIF         
	   THISFORM.CMND2.SETFOCUS
 ENDPROC
 PROCEDURE CMND2.CLICK
          THISFORM.RELEASE
  ENDPROC      
ENDDEFINE  
****
DEFINE CLASS OLIST_SEEK AS FORM
*!*	  AUTOCENTER=.T.
  CAPTION='修改欲帶入此作業之人員  部門：' + S23_1.F05 + SPACE(2) + S23_1.F06
  TOP=INT_015*150
  LEFT=INT_015*250      
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*230
  WIDTH=INT_015*285
  MAXBUTTON=.F.
  MINBUTTON=.F.  
*!*	  MOVABLE=.F.
  CLOSABLE=.F.
  CONTROLBOX=.F.
  BORDERSTYLE=2
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WINDOWTYPE=1
  NAME='OLIST_SEEK'
  ADD OBJECT GRDD01 AS GRID WITH;     
      AUTOCENTER=.T.,;
      HIGHLIGHTROWLINEWIDTH=4,;
      TOP=INT_015*3,;      
      WIDTH=INT_015*180,;      
      HEIGHT=INT_015*220,;      
      ROWHEIGHT=INT_015*18,;
      HEADERHEIGHT=INT_015*19,;
      DELETEMARK=.F.,;
      READONLY=.T.,;
      RECORDSOURCETYPE=1,;
      COLUMNCOUNT=3,;            
      RECORDSOURCE='S05_TEMP',;    
      NAME='GRDD01',;
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;  
      COLUMN3.NAME='COLUMN3'      
  ADD OBJECT CMND1 AS COMMANDBUTTON WITH;
      AUTOSIZE=.T.,;
      LEFT=INT_015*200,;    
      HEIGHT=INT_015*25,;   
      TOP=INT_015*120,;        
      WIDTH=INT_015*80,;    
      FONTSIZE=INT_015*9,;
      CAPTION='\<S.確定',;
      TOOLTIPTEXT='選擇游標所指的紀錄!快速鍵->ALT+S'
      NAME='CMND1'
  ADD OBJECT CMND2 AS COMMANDBUTTON WITH;
      AUTOSIZE=.T.,;
      LEFT=INT_015*200,;
      TOP=INT_015*170,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*80,;     
      FONTSIZE=INT_015*9,;      
      CAPTION='\<X.離開',;
      TOOLTIPTEXT='取消此搜尋畫面!快速鍵->ALT+X'
      NAME='CMND2'
  ADD OBJECT CMND3 AS COMMANDBUTTON WITH;
      AUTOSIZE=.T.,;
      LEFT=INT_015*200,;    
      HEIGHT=INT_015*25,;   
      TOP=INT_015*20,;        
      WIDTH=INT_015*80,;    
      FONTSIZE=INT_015*9,;
      CAPTION='\<A.全選',;
      TOOLTIPTEXT='全選所有資料!快速鍵->ALT+A'
      NAME='CMND3'
  ADD OBJECT CMND4 AS COMMANDBUTTON WITH;
      AUTOSIZE=.T.,;
      LEFT=INT_015*200,;    
      HEIGHT=INT_015*25,;   
      TOP=INT_015*70,;        
      WIDTH=INT_015*80,;  
      FONTSIZE=INT_015*9,;
      CAPTION='\<C.清除',;
      TOOLTIPTEXT='清除已全選之資料!快速鍵->ALT+C'
      NAME='CMND4'            
 PROCEDURE INIT 
         CHK_IN=''
         THISFORM.SETALL('HEIGHT',INT_015*25,'TEXTBOX')
         THISFORM.SETALL('HEIGHT',INT_015*17,'LABEL')
         THISFORM.SETALL('FONTSIZE',INT_015*9,'TEXTBOX')
         THISFORM.SETALL('FONTSIZE',INT_015*9,'LABEL')       
         THISFORM.SETALL('READONLY',.T.,'TEXTBOX')
         THISFORM.SETALL('MOUSEPOINTER',99,'COMMANDBUTTON')
         THISFORM.SETALL('MOUSEICON','BMPS\harrow.cur','COMMANDBUTTON')                
         THISFORM.GRDD01.SETALL('FONTSIZE',INT_015*9,'COLUMN') 
         THISFORM.GRDD01.SETALL('FONTSIZE',INT_015*9,'HEADER')
         THISFORM.SETALL('MOVABLE',.F.,'COLUMN')   
         THISFORM.GRDD01.SETALL("DYNAMICBACKCOLOR","IIF(S05_TEMP.EXP_1=1,RGB(255,255,128),'')","COLUMN") 
         THISFORM.GRDD01.COLUMN1.HEADER1.CAPTION=''
         THISFORM.GRDD01.COLUMN1.WIDTH=INT_015*20
         THISFORM.GRDD01.COLUMN1.CONTROLSOURCE='S05_TEMP.EXP_1'
         THISFORM.GRDD01.COLUMN2.HEADER1.CAPTION='人員編號'
         THISFORM.GRDD01.COLUMN2.WIDTH=INT_015*50
         THISFORM.GRDD01.COLUMN2.CONTROLSOURCE='S05_TEMP.F01'
         THISFORM.GRDD01.COLUMN3.HEADER1.CAPTION='人員姓名'
         THISFORM.GRDD01.COLUMN3.WIDTH=INT_015*80
         THISFORM.GRDD01.COLUMN3.CONTROLSOURCE='S05_TEMP.F02'   
         THISFORM.GRDD01.SETFOCUS                  
         SELECT S05_TEMP
         GO TOP
 ENDPROC 
 PROC GRDD01.INIT
	THISFORM.GRDD01.COLUMN1.READONLY=.F.
	THISFORM.GRDD01.COLUMN2.READONLY=.T.
	THISFORM.GRDD01.COLUMN3.READONLY=.T.
	THISFORM.GRDD01.COLUMN1.removeobject("TEXT1")
	THISFORM.GRDD01.COLUMN1.AddObject("CheckBox1","CheckBox1") 
	THISFORM.GRDD01.COLUMN1.CurrentControl="CheckBox1" 
	THISFORM.GRDD01.COLUMN1.Sparse=.F.
	THISFORM.GRDD01.COLUMN1.CheckBox1.Visible=.T.
	THISFORM.GRDD01.COLUMN1.CheckBox1.CAPTION=''
	THISFORM.GRDD01.COLUMN1.CheckBox1.AUTOSIZE=.T.
	THISFORM.GRDD01.COLUMN1.CheckBox1.CENTERED=.T.
	THISFORM.GRDD01.COLUMN1.CheckBox1.BACKSTYLE=0
	THISFORM.GRDD01.COLUMN1.CheckBox1.LEFT=5
  ENDPROC 
  PROC GRDD01.AFTERROWCOLCHANGE
       LPARAMETERS NCOLINDEX
   ENDPROC 
   **
 PROCEDURE CMND1.CLICK
     THISFORM.RELEASE 
 ENDPROC
 PROCEDURE CMND2.CLICK
       CHK_IN='0'
      THISFORM.RELEASE
 ENDPROC  
 **
 PROCEDURE CMND3.CLICK     
      SELECT S05_TEMP
      RE=RECNO('S05_TEMP')
      REPLACE S05_TEMP.EXP_1 WITH 1  ALL 
      GO RE 
     THISFORM.GRDD01.SETFOCUS 
 ENDPROC      
  PROCEDURE CMND4.CLICK
      SELECT S05_TEMP
      RE=RECNO('S05_TEMP')
      REPLACE S05_TEMP.EXP_1 WITH 0  ALL 
      GO RE 
     THISFORM.GRDD01.SETFOCUS 
 ENDPROC 
ENDDEFINE 
****
DEFINE CLASS CheckBox1 AS CheckBox
      PROCEDURE CLICK
         SELECT S05_TEMP
         IF THIS.VALUE=1
              REPLACE S05_TEMP.EXP_1 WITH 1
         ELSE
              REPLACE S05_TEMP.EXP_1 WITH 0
         ENDIF
         THISFORM.GRDD01.SETFOCUS     
   ENDPROC 
ENDDEFINE 
*************************************************假別名稱
DEFINE CLASS COMBOBOX08 AS COMBOBOX 
       VISIBLE=.F.
       HEIGHT=INT_015*25
       WIDTH=INT_015*171
       FONTSIZE=INT_015*9   
       BOUNDCOLUMN=1
       ROWSOURCETYPE=1
       STYLE=2    
       VALUE=1
       NAME='COMBOBOX08'
 PROCEDURE INIT    
       THIS.ADDITEM('A1'+SPACE(5)+'年假')
       THIS.ADDITEM('A8'+SPACE(5)+'公假')
  ENDPROC 
   PROCEDURE INTERACTIVECHANGE
      THISFORM.TXTF07.VALUE=LEFT(ALLTRIM(THIS.DISPLAYVALUE),2)
      THISFORM.TXTF08.VALUE=RIGHT(ALLTRIM(THIS.DISPLAYVALUE),LEN(ALLTRIM(THIS.DISPLAYVALUE))-7)  
      THISFORM.TXTF09.VALUE=IIF(INDEXSEEK('G'+ALLTRIM(THISFORM.TXTF07.VALUE),.T.,'S00','S003'),S00.F28,'')
      THISFORM.LBLF09.CAPTION='計數單位：' +ACC_BASE(THISFORM.TXTF09.VALUE)+'，請假基數：'+ALLTRIM(TRANSFORM(S00.F62,'@R 999,999.9'))+' '+ACC_BASE(THISFORM.TXTF09.VALUE)      
      THISFORM.TXTF07.REFRESH  
      THISFORM.TXTF08.REFRESH
      THISFORM.TXTF09.REFRESH
    ENDPROC   
ENDDEFINE    
************************************************薪資/扣款類別    
FUNCTION ACC_BASE
     PARA JUK
     JO=''
     DO CASE
        CASE JUK='D'
             JO='天'     
        CASE JUK='H'
             JO='小時'
        CASE JUK='S'
             JO='次' 
     ENDCASE
     RETURN JO   