 
CLOS DATA ALL
CLOS TABL ALL
SET TALK OFF
SET EXCL OFF
SET DELE ON
SET CENT OFF
SET SAFE OFF
SET DECIMALS TO 6
SET ENGINEBEHAVIOR 70 
SET REPORTBEHAVIOR 80
SET REPROCESS TO 1
 
SET MULTILOCKS ON
SET DEFAULT TO H:\TKMIS
SELECT 0
USE DOWANPN ALIAS DOWANPN

CREATE CURSOR INVRT;
   (F01 C(5),F02 C(43),FIN N(16,4),FQY N(16,4),FND N(16,4),RTE N(11,6))
   INDEX ON F01+F02 TAG INVRT
   B25='B25'+LEFT(DTOS(DATE()),6)   &&本月庫存月報表檔    
   SELECT 0
   USE \\192.168.10.213\TKDATA\&B25 ALIA B25       
   SET ORDER TO 1     
  GO TOP
  DO WHILE !EOF()
         SELECT INVRT
         APPEND BLANK
         REPLACE FIN WITH B25.F03
         REPLACE F01 WITH B25.F01
         REPLACE F02 WITH B25.F02
         REPLACE FQY WITH B25.F05+B25.F06+B25.F09+B25.F11+B25.F14+B25.F17+B25.F19+B25.F20
         REPLACE FND WITH B25.F15
         SELECT B25
         SKIP
  ENDDO
  SELECT B25
  USE
  SELECT 0
  USE \\192.168.10.213\TKDATA\A23 ALIAS A23
  SET ORDER TO 1
  SEEK LEFT(DTOS(DATE()),6)+'01'
  SKIP -1 
  IF !BOF()  
      B25='B25'+LEFT(DTOS(F01),6)  &&上個月庫存月報
      SELECT 0                 
      USE \\192.168.10.213\TKDATA\&B25 ALIA B25      
      SET ORDER TO 1      
      SELECT INVRT
      GO TOP
      DO WHILE !EOF()
             SELECT B25
             SEEK INVRT.F01+INVRT.F02
             IF FOUND()
                 SELECT INVRT
                 REPLACE FIN  WITH B25.F03
                 REPLACE FQY WITH FQY+(B25.F05+B25.F06+B25.F09+B25.F11+B25.F14+B25.F17+B25.F19+B25.F20)
                 REPLACE FND WITH FND+B25.F15        
             ELSE
                SELECT INVRT
                REPLACE FIN WITH 0             
             ENDIF     
             SELECT INVRT
             SKIP
      ENDDO
      SELECT B25
      USE
      SELECT A23
      SKIP -1
      IF BOF()
          USE
      ELSE
          B25='B25'+LEFT(DTOS(F01),6)   &&上上個月庫存月報表
           
               SELE 0
              USE \\192.168.10.213\TKDATA\&B25 ALIA B25   
         
          SET ORDER TO 1      
          SELECT INVRT
          GO TOP
          DO WHILE !EOF()
                 SELECT B25
                 SEEK INVRT.F01+INVRT.F02
                 IF FOUND()
                     SELECT INVRT
                     REPLACE FIN  WITH B25.F03
                     REPLACE FQY WITH FQY+(B25.F05+B25.F06+B25.F09+B25.F11+B25.F14+B25.F17+B25.F19+B25.F20)
                     REPLACE FND WITH FND+B25.F15    
                 ELSE
                     SELECT INVRT
                     REPLACE FIN WITH 0                                      
                 ENDIF     
                 SELECT INVRT
                 SKIP
          ENDDO
          SELECT B25
          USE      
          SELECT A23
          USE      
      ENDIF    
  ELSE
       SELECT A23
       USE
  ENDIF
  SELECT INVRT
  REPLACE RTE WITH FQY/IIF(FIN+FND<>0,(FIN+FND)/4,1)  ALL
SELECT 0
USE \\192.168.10.213\TKDATA\A23
SET ORDER TO 1
SEEK 'DTOS(DATE())'
IF FOUND()
   
ENDIF
SELECT 0
USE \\192.168.10.160\MISD2\D10 ALIAS D10
SET ORDER TO 4
SELECT 0
USE \\192.168.10.160\MISD2\B11 ALIAS B11
SET ORDER TO 1
SELECT 0
USE \\192.168.10.160\MISD2\C04 ALIAS C04
SET ORDER TO 1
SELECT B11.F03 料號,B11.F04 庫存數量,B11.F05 最後異動日,B11.F06 採購用途,C04.F07 出貨單價,C04.F17 客戶料號,IIF(SEEK(B11.F03,'D10'),D10.F03,'') 最後進貨日,IIF(SEEK(B11.F01+B11.F03,'INVRT'),INVRT.RTE,1) 三個月存貨週轉率 FROM B11,C04 WHERE B11.f03=ANY(SELE F04 FROM DOWANPN) AND C04.F04=B11.f03 AND C04.F02$'C4017C4032C8152' AND C04.f10>0 AND B11.f01='I000 '  ORDER BY B11.f03  GROUP BY B11.F03
&&SELECT B11.F03 料號,B11.F04 庫存數量,B11.F05 最後異動日,B11.F06 採購用途,C04.F07 出貨單價,C04.F17 客戶料號,IIF(SEEK(B11.F03,'D10'),D10.F03,'') 最後進貨日,IIF(SEEK(B11.F01+B11.F03,'INVRT'),INVRT.RTE,1) 三個月存貨週轉率 FROM B11,C04 WHERE B11.f03=ANY(SELE F04 FROM DOWANPN) AND C04.F04=B11.f03 AND C04.F02='C4032' AND C04.f10>0 AND B11.f01='I000 '  ORDER BY B11.f03  GROUP BY B11.F03
COPY TO c:\users\jimmy\desktop\光寶目前庫存.xls TYPE XL5