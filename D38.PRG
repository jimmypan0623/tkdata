**程式名稱:D38.採購交期異動表
set excl off
close all
clear 
AREA1='D38'
FLG='0'
FCH=''
CHK=''
IF !USED('A01')
   SELE 0
   USE A01
ELSE 
  SELE A01
ENDIF
SET ORDER TO 1
IF !USED('A02')
   SELE 0
   USE A02 INDE A02
ELSE
   SELE A02
ENDIF
SET ORDER TO A021      
SEEK sys_oper+'D38'      
IF !USED('A23')
    SELE 0
    USE A23
ELSE 
   SELE A23
ENDIF
SET ORDER TO 1 
IF !USED ('B01')
   SELE 0
   USE B01 
ELSE 
   SELE B01
ENDIF
SET ORDER TO 1              

IF !USED('D38')
   SELE 0
   USE D38
ELSE
   SELE D38
ENDIF
SET ORDER TO D381                
SET FILTER TO !EMPTY(F05)
GO TOP
D38form=createobject("tkD38")
D38form.show  
define class tkD38 as form
  caption='D38.採購交期異動紀錄'
  autocenter=.t.
  controlbox=.F.
  BORDERSTYLE=3  
  MAXBUTTON=.F.
  MINBUTTON=.F.
  MOVABLE=.F.
  CLOSABLE=.F.
  controlcount=57
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*550
  showtips=.t.
  showwindow=1
  WIDTH=INT_015*789
  windowtype=1
  ADD OBJECT KEY_LIST AS KEY_LIST WITH;
      AUTOCENTER=.T.
  ADD OBJECT GRID1 AS GRID1 WITH;
      columncount=8,;            
      RECORDSOURCE='D38',; 
      HEIGHT=INT_015*500,;     
      WIDTH=INT_015*780,;     
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;
      COLUMN3.NAME='COLUMN3',; 
      COLUMN4.NAME='COLUMN4',; 
      COLUMN5.NAME='COLUMN5',;             
      COLUMN6.NAME='COLUMN6',;       
      COLUMN7.NAME='COLUMN7',;       
      COLUMN8.NAME='COLUMN8'     
  ADD OBJECT ORPGROUP AS ORPGROUP WITH;      
      TOP=INT_015*0,;
      LEFT=INT_015*350              
  ADD OBJECT CMDGROUP AS CMDGROUP WITH;
      TOP=INT_015*0,;
      LEFT=INT_015*250,;
      ENABLED=.T.,;
      VISIBLE=.T.                 
  PROCEDURE INIT
       SELE D38
       GO TOP
       THISFORM.ORPGROUP.NEW_BOTT.VISIBLE=.F.
       THISFORM.ORPGROUP.EDIT_BOTT.VISIBLE=.F.
       THISFORM.ORPGROUP.DEL_BOTT.VISIBLE=.F.
       THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限     
       THISFORM.GRID1.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'COLUMN')
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'HEADER')   
       THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(DATE()-CTOD(LEFT(D07.F08,8))<=5 ,RGB(0,255,255),''))","COLUMN")                                      
       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*80
       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*149
       THISFORM.GRID1.COLUMN3.WIDTH=INT_015*60
       THISFORM.GRID1.COLUMN4.WIDTH=INT_015*85
       THISFORM.GRID1.COLUMN5.WIDTH=INT_015*60
       THISFORM.GRID1.COLUMN6.WIDTH=INT_015*85
       THISFORM.GRID1.COLUMN7.WIDTH=INT_015*149
       THISFORM.GRID1.COLUMN8.WIDTH=INT_015*60
       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='採購單號'	          
       THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='料        號'	                 
	   THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='原交期'
	   THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='原數量'	   	   
  	   THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='新交期' 
  	   THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='新數量'   	   
  	   THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='採購用途'   	     	   
  	   THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='最初交期'   	     	      
       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='D38.F01'
       THISFORM.GRID1.COLUMN2.CONTROLSOURCE='D38.F02'
       THISFORM.GRID1.COLUMN3.CONTROLSOURCE='D38.F03'
       THISFORM.GRID1.COLUMN4.CONTROLSOURCE='D38.F04'
       THISFORM.GRID1.COLUMN5.CONTROLSOURCE='D38.F05'
       THISFORM.GRID1.COLUMN6.CONTROLSOURCE='D38.F06'
       THISFORM.GRID1.COLUMN7.CONTROLSOURCE='D38.F07'
       THISFORM.GRID1.COLUMN8.CONTROLSOURCE='D38.F09'
       THISFORM.GRID1.READONLY=.T.       
       JK='採購單號'
       THISFORM.GRID1.SETFOCUS    
  ENDPROC          
  PROC GRID1.AFTERROWCOLCHANGE
       LPARAMETERS nColIndex       
       FCH=THISFORM.ACTIVECONTROL.NAME
       CHK=''
       thisform.refresh
  ENDPROC      
  PROC KEY_LIST.INIT
       with this 
           .additem('依採購單號+料號+  原交期排列')
           .additem('依料號+採購單號+最初交期排列')
           .additem('依採購用途+料號+最初交期排列')
       endwith     
  ENDPROC
  PROC KEY_LIST.INTERACTIVECHANGE
       SELE D38
       DO CASE
          CASE THIS.DISPLAYVALUE='依採購單號+料號+  原交期排列'
               SET ORDER TO D381
               THISFORM.GRID1.COLUMN1.WIDTH=INT_015*80
               THISFORM.GRID1.COLUMN2.WIDTH=INT_015*149
               THISFORM.GRID1.COLUMN3.WIDTH=INT_015*60
               THISFORM.GRID1.COLUMN4.WIDTH=INT_015*85
               THISFORM.GRID1.COLUMN5.WIDTH=INT_015*60
               THISFORM.GRID1.COLUMN6.WIDTH=INT_015*85
               THISFORM.GRID1.COLUMN7.WIDTH=INT_015*149
               THISFORM.GRID1.COLUMN8.WIDTH=INT_015*60
               THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='採購單號'	          
               THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='料        號'	                 
       	       THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='原交期'
        	   THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='原數量'	   	   
  	           THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='新交期' 
        	   THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='新數量'   	   
  	           THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='採購用途'   	     	   
        	   THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='最初交期'   	     	      
               THISFORM.GRID1.COLUMN1.CONTROLSOURCE='D38.F01'
               THISFORM.GRID1.COLUMN2.CONTROLSOURCE='D38.F02'
               THISFORM.GRID1.COLUMN3.CONTROLSOURCE='D38.F03'
               THISFORM.GRID1.COLUMN4.CONTROLSOURCE='D38.F04'
               THISFORM.GRID1.COLUMN5.CONTROLSOURCE='D38.F05'
               THISFORM.GRID1.COLUMN6.CONTROLSOURCE='D38.F06'
               THISFORM.GRID1.COLUMN7.CONTROLSOURCE='D38.F07'
               THISFORM.GRID1.COLUMN8.CONTROLSOURCE='D38.F09'               
          CASE THIS.DISPLAYVALUE='依料號+採購單號+最初交期排列'
               SET ORDER TO D384
               THISFORM.GRID1.COLUMN1.WIDTH=INT_015*149
               THISFORM.GRID1.COLUMN2.WIDTH=INT_015*80
               THISFORM.GRID1.COLUMN3.WIDTH=INT_015*60               
               THISFORM.GRID1.COLUMN4.WIDTH=INT_015*60
               THISFORM.GRID1.COLUMN5.WIDTH=INT_015*85
               THISFORM.GRID1.COLUMN6.WIDTH=INT_015*60
               THISFORM.GRID1.COLUMN7.WIDTH=INT_015*85
               THISFORM.GRID1.COLUMN8.WIDTH=INT_015*149
               THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='料        號'	                 	          
               THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='採購單號'
       	       THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='最初交期'
        	   THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='原交期'	   	   
  	           THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='原數量' 
        	   THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='新交期'   	   
  	           THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='新數量'   	     	   
        	   THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='採購用途'   	     	      
               THISFORM.GRID1.COLUMN1.CONTROLSOURCE='D38.F02'
               THISFORM.GRID1.COLUMN2.CONTROLSOURCE='D38.F01'
               THISFORM.GRID1.COLUMN3.CONTROLSOURCE='D38.F09'                                             
               THISFORM.GRID1.COLUMN4.CONTROLSOURCE='D38.F03'
               THISFORM.GRID1.COLUMN5.CONTROLSOURCE='D38.F04'
               THISFORM.GRID1.COLUMN6.CONTROLSOURCE='D38.F05'
               THISFORM.GRID1.COLUMN7.CONTROLSOURCE='D38.F06'
               THISFORM.GRID1.COLUMN8.CONTROLSOURCE='D38.F07'
          CASE THIS.DISPLAYVALUE='依採購用途+料號+最初交期排列'
               SET ORDER TO D383
               THISFORM.GRID1.COLUMN1.WIDTH=INT_015*149               
               THISFORM.GRID1.COLUMN2.WIDTH=INT_015*149
               THISFORM.GRID1.COLUMN3.WIDTH=INT_015*60                              
               THISFORM.GRID1.COLUMN4.WIDTH=INT_015*80
               THISFORM.GRID1.COLUMN5.WIDTH=INT_015*60
               THISFORM.GRID1.COLUMN6.WIDTH=INT_015*85
               THISFORM.GRID1.COLUMN7.WIDTH=INT_015*60
               THISFORM.GRID1.COLUMN8.WIDTH=INT_015*85
        	   THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='採購用途'   	     	                     
               THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='料        號'	                 	          
       	       THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='最初交期'
               THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='採購單號'       	       
        	   THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='原交期'	   	   
  	           THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='原數量' 
        	   THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='新交期'   	   
  	           THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='新數量'   	     	   
               THISFORM.GRID1.COLUMN1.CONTROLSOURCE='D38.F07'                 	           
               THISFORM.GRID1.COLUMN2.CONTROLSOURCE='D38.F02'
               THISFORM.GRID1.COLUMN3.CONTROLSOURCE='D38.F09'                                                            
               THISFORM.GRID1.COLUMN4.CONTROLSOURCE='D38.F01'
               THISFORM.GRID1.COLUMN5.CONTROLSOURCE='D38.F03'
               THISFORM.GRID1.COLUMN6.CONTROLSOURCE='D38.F04'
               THISFORM.GRID1.COLUMN7.CONTROLSOURCE='D38.F05'
               THISFORM.GRID1.COLUMN8.CONTROLSOURCE='D38.F06'
       ENDCASE  
       JK=THISFORM.GRID1.COLUMN1.HEADER1.CAPTION       
       THISFORM.GRID1.SETFOCUS      
  ENDPROC
enddefine        
***********************************************列印程序
PROCEDURE PNT_PRC     
          
*              REPORT FORM D38 TO PRINT PROMPT PREVIEW
*              report form D38 to print prompt        
          
ENDPROC

****************************************搜尋畫面
