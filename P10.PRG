***業務出貨需求預估
close all
clear 
FLG='0'
FCH=''
CHK=''
R=0
AREA1='C01'
AREA2='P10'
IF ! USED('A01')
   SELE 0
   USE A01 INDE A01
ELSE
   SELE A01
ENDIF      
SET ORDER TO A01
IF !USED('A02')
   SELE 0
   USE A02 INDE A02
ELSE
   SELE A02
ENDIF
SET ORDER TO A021      
SEEK sys_oper+'P10'

IF !USED('B01')
   SELE 0
   USE B01 INDE B01
ELSE
   SELE B01
ENDIF
*set filter to RIGHT(f98,1)='*'
SET ORDER TO 1
IF !USED('C01')
   SELE 0
   USE C01 INDE C01
ELSE
   SELE C01
ENDIF
SET ORDER TO C011
if !used('P10')
   SELE 0
   USE P10
ELSE
   SELE P10
ENDIF
SET ORDER TO P101      
SET RELA TO F03 INTO B01 ADDI
P10form=createobject("tkP10")
P10form.show  
define class tkP10 as form
  caption='P10.業務出貨需求預估'
  controlbox=.F.
  BORDERSTYLE=3  
  MAXBUTTON=.F.
  MINBUTTON=.F.
  MOVABLE=.F.
  CLOSABLE=.F.
  controlcount=57
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*550
  showtips=.t.
  showwindow=1
  WIDTH=INT_015*789
  windowtype=1
  NAME='TKP10'
  add object shape1 as shape1 with;
      autocenter=.t.

  ADD OBJECT LBL_REC AS LBL_REC WITH;
      AUTOCENTER =.T.
  ADD OBJECT REC_COUNT AS REC_COUNT  with;
      caption=str(reccount())        
  add object shape2 as shape2 with;
      autocenter=.t.
  add object shape3 as shape3 with;
      autocenter=.t.
  ADD OBJECT PAGEFRAME1 AS PAGEFRAME WITH;
      LEFT=INT_015*236,;
      WIDTH=INT_015*540,;
      HEIGHT=INT_015*200,;
      FONTSIZE=INT_015*9,;      
      PAGECOUNT=2,;
      TABSTRETCH=1,;
      ACTIVEPAGE=1,;
      VISIBLE=.T.,;
      PAGE1.NAME='PAGE1',;
      PAGE1.VISIBLE=.T.,;
      PAGE1.CAPTION='依照客戶搜尋紀錄',;
      PAGE2.NAME='PAGE2',;
      PAGE2.VISIBLE=.T.,;
      PAGE2.CAPTION='詳細資料內容'   
  ADD OBJECT KEY_LIST AS KEY_LIST WITH;
      AUTOCENTER=.T.
  ADD OBJECT grid1 AS grid1 WITH;
      columncount=2,;            
      RECORDSOURCE='C01',;
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2'      
  ADD OBJECT grid2 AS grid2 WITH;
      columncount=6,;            
      RECORDSOURCE='P10',;
      LINKMASTER='C01',;
      RELATIONALEXPR='F01',;
      CHILDORDER='P101',;      
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;
      COLUMN3.NAME='COLUMN3',;
      COLUMN4.NAME='COLUMN4',;
      COLUMN5.NAME='COLUMN5',;
      COLUMN6.NAME='COLUMN6'      
  ADD OBJECT CMDGROUP AS CMDGROUP WITH;
      AUTOSIZE=.T.              
  ADD OBJECT ORPGROUP AS ORPGROUP WITH;    
      AUTOSIZE=.T.              
  ADD OBJECT SHRGROUP AS SHRGROUP WITH;
      TOP=INT_015*173,;
      LEFT=INT_015*558          
  ADD OBJECT ANS_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*490,;
      LEFT=INT_015*15,;
      HEIGHT=INT_015*25,;
      FONTSIZE=INT_015*9,;
      AUTOSIZE=.T.,;      
      CAPTION='\<A.預估總表',;
      NAME='ANS_BOTT'                        
  ADD OBJECT DIV_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*490,;
      LEFT=INT_015*100,;
      HEIGHT=INT_015*25,;
      FONTSIZE=INT_015*9,;      
      AUTOSIZE=.T.,;      
      CAPTION='\<B.差異總表',;
      NAME='DIV_BOTT'                             
  PROCEDURE PAGEFRAME1.PAGE1.INIT     
     THIS.ADDOBJECT('LBLF01','LABEL')
     WITH THIS.LBLF01
          .VISIBLE=.T.
          .LEFT=INT_015*14
          .TOP=INT_015*27
          .WIDTH=INT_015*50
          .CAPTION='客戶編號'          
     ENDWITH
     THIS.ADDOBJECT('LBLF011','LABEL')     
     WITH THIS.LBLF011
          .VISIBLE=.T.
          .LEFT=INT_015*140
          .TOP=INT_015*27
          .AUTOSIZE=.T.  
     ENDWITH            
     THIS.ADDOBJECT('TXTF01','TEXTBOX')     
     WITH THIS.TXTF01
          .VISIBLE=.T.
          .LEFT=INT_015*64
          .TOP=INT_015*23
          .WIDTH=INT_015*74
          .HEIGHT=INT_015*25
          .MAXLENGTH=5
     ENDWITH        

  ENDPROC   
  PROCEDURE PAGEFRAME1.PAGE2.INIT
	THIS.ADDOBJECT('LBLF01','LABEL')
	WITH THIS.LBLF01  
         .LEFT=INT_015*14
         .TOP=INT_015*13
	     .WIDTH=INT_015*50
         .CAPTION='客戶編號'
    ENDWITH  
    THIS.ADDOBJECT('LBLF011','LABEL')
    WITH THIS.LBLF011
         .LEFT=INT_015*126
	     .TOP=INT_015*14
	     .autosize=.t.
	ENDWITH     
    THIS.ADDOBJECT('LBLF03','LABEL')
    WITH THIS.LBLF03
         .VISIBLE=.T.
	     .LEFT=INT_015*14
	     .TOP=INT_015*14
	     .WIDTH=INT_015*50
	     .CAPTION='料品編號'
	ENDWITH     
    THIS.ADDOBJECT('LBLF031','Label')
    WITH THIS.LBLF031
         .VISIBLE=.T.
         .LEFT=INT_015*306
         .TOP=INT_015*14
         .AUTOSIZE=.T.
    ENDWITH     
    THIS.ADDOBJECT('LBLF04','LABEL')
    WITH THIS.LBLF04
         .VISIBLE=.T.
	     .LEFT=INT_015*14
	     .TOP=INT_015*39
	     .WIDTH=INT_015*50
	     .CAPTION='備註說明'
	ENDWITH     
    THIS.ADDOBJECT('LBLF02','LABEL')      
    WITH THIS.LBLF02
         .VISIBLE=.T.       
         .LEFT=INT_015*328
         .TOP=INT_015*39
         .WIDTH=INT_015*50
         .CAPTION='需求月份'
    ENDWITH     

    THIS.ADDOBJECT('LBLF08','LABEL')
    WITH THIS.LBLF08
        .VISIBLE=.T.           
        .LEFT=INT_015*328
        .TOP=INT_015*64
        .WIDTH=INT_015*50
        .CAPTION='預估數量'         
    ENDWITH    
    THIS.ADDOBJECT('LBLF09','LABEL')    
    WITH THIS.LBLF09
        .VISIBLE=.T.           
        .LEFT=INT_015*328
        .TOP=INT_015*89
        .WIDTH=INT_015*50
        .CAPTION='實際出貨'         
    ENDWITH    
    THIS.ADDOBJECT('LBLF091','LABEL')    
    WITH THIS.LBLF091
        .VISIBLE=.T.           
        .LEFT=INT_015*380
        .TOP=INT_015*89
        .AUTOSIZE=.T.
        .CAPTION=''
    ENDWITH            
    THIS.ADDOBJECT('LBLDIV','LABEL')    
    WITH THIS.LBLDIV
        .VISIBLE=.T.           
        .LEFT=INT_015*328
        .TOP=INT_015*114
        .WIDTH=INT_015*50
        .CAPTION='差異數量'
    ENDWITH     
    THIS.ADDOBJECT('LBLDIV1','LABEL')    
    WITH THIS.LBLDIV1
        .VISIBLE=.T.           
        .LEFT=INT_015*380
        .TOP=INT_015*114
        .AUTOSIZE=.T.
        .CAPTION=''
    ENDWITH                    
    THIS.ADDOBJECT('LBLF11','LABEL')
    WITH THIS.LBLF11
         .VISIBLE=.T.           
         .LEFT=INT_015*14
         .TOP=INT_015*139
         .WIDTH=INT_015*50
         .CAPTION='安全資料'          
    ENDWITH     
    THIS.ADDOBJECT('LBLF111','LABEL')
    WITH THIS.LBLF111
         .VISIBLE=.T.           
         .LEFT=INT_015*65
         .TOP=INT_015*139
         .AUTOSIZE=.T.          
    ENDWITH     
	THIS.ADDOBJECT('TXTF01','TXTF01')
	WITH THIS.TXTF01      
	     .LEFT=INT_015*65
	     .TOP=INT_015*10
	     .WIDTH=INT_015*60
	     .HEIGHT=INT_015*25
	     .MAXLENGTH=5
	     .NAME='TXTF01'  
	ENDWITH     
	THIS.ADDOBJECT('TXTF03','TXTF03')
	WITH THIS.TXTF03
	     .VISIBLE=.T.
	     .LEFT=INT_015*65
	     .TOP=INT_015*10
	     .WIDTH=INT_015*216
	     .HEIGHT=INT_015*25
	     .MAXLENGTH=43
	     .NAME='TXTF03'	    
	ENDWITH     
    THIS.ADDOBJECT('TXTF04','TEXTBOX')
    WITH THIS.TXTF04
         .VISIBLE=.T.           
         .LEFT=INT_015*65
         .TOP=INT_015*35
         .WIDTH=INT_015*149
         .MAXLENGTH=20
         .NAME='TXTF04'
    ENDWITH     
    THIS.ADDOBJECT('TXTF02','TEXTBOX')
    WITH THIS.TXTF02
         .VISIBLE=.T.           
         .LEFT=INT_015*379
         .TOP=INT_015*35
         .WIDTH=INT_015*60
         .HEIGHT=INT_015*25
         .INPUTMASK='####/##'
         .NAME='TXTF02'                            
    ENDWITH           
    THIS.ADDOBJECT('TXTF08','TEXTBOX')
    WITH THIS.TXTF08
         .VISIBLE=.T.           
         .LEFT=INT_015*379
         .TOP=INT_015*60
         .WIDTH=INT_015*118
         .INPUTMASK='99999999.99'
         .NAME='TXTF08'
    ENDWITH     
  PROCEDURE PAGEFRAME1.PAGE1.activate
     R=0
     IF THISFORM.KEY_LIST.DISPLAYVALUE='依客戶編號排列'
        SELE C01
     ELSE
        SELE B01
     ENDIF      
     SEEK THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE     
     THISFORM.GRID1.ENABLED=.T.          
     THISFORM.GRID1.SETFOCUS     
     IF THISFORM.GRID1.ACTIVEROW=0
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
        THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=''
        THISFORM.PAGEFRAME1.PAGE1.LBLF011.CAPTION=''
     ELSE
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.
     ENDIF   
     THISFORM.ORPGROUP.NEW_BOTT.ENABLED=.F. 
     THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
     THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
     THISFORM.KEY_LIST.ENABLED=.T.
  ENDPROC
  PROCEDURE PAGEFRAME1.PAGE2.activate
     SELE P10
     IF THISFORM.SHRGROUP.ENABLED=.F.
        THISFORM.GRID2.SETFOCUS 
        THISFORM.GRID2.READONLY=.T.  
     ENDIF   
     IF THISFORM.GRID2.ACTIVEROW=0 .and. thisform.SHRGROUP.ENABLED=.F.
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
        THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
        THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
        THISFORM.PAGEFRAME1.PAGE2.SETALL('VALUE','','TEXTBOX')
        THISFORM.PAGEFRAME1.PAGE2.TXTF01.VALUE=''
        THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=''
        THISFORM.PAGEFRAME1.PAGE2.LBLF091.CAPTION='' 
        THISFORM.PAGEFRAME1.PAGE2.LBLDIV1.CAPTION=''        
        THISFORM.PAGEFRAME1.PAGE2.LBLF011.CAPTION=''
        THISFORM.PAGEFRAME1.PAGE2.LBLF031.CAPTION=''
        THISFORM.PAGEFRAME1.PAGE2.LBLF111.CAPTION=''
     ELSE
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.
        THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  .AND. IIF(PADL(LEFT(DTOC(DATE()),5),7,'0')<P10.F02,.T.,.F.)  &&判斷有無修改的權限
        THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)   .AND. IIF(PADL(LEFT(DTOC(DATE()),5),7,'0')<P10.F02,.T.,.F.)  &&判斷有無刪除的權限
        THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限  
     ENDIF   
     R=RECNO('&AREA1')
     THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(RECNO('&AREA1')=R,RGB(255,255,0),'')","COLUMN")
     THISFORM.GRID1.ENABLED=.F.     
     THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.)   &&判斷有無新增的權限
     THISFORM.KEY_LIST.ENABLED=.F.     
  ENDPROC   

  PROC INIT              
       THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限  
       thisform.setall('height',INT_015*25,'textbox')
       thisform.setall('height',INT_015*17,'label')
       thisform.setall('FONTSIZE',INT_015*9,'textbox')
       thisform.setall('FONTSIZE',INT_015*9,'label')       
       THISFORM.SETALL('READONLY',.T.,'TEXTBOX')
       THISFORM.SHRGROUP.VISIBLE=.F.
       THISFORM.SHRGROUP.ENABLED=.F.
       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*50
       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*50
       THISFORM.GRID1.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)
       THISFORM.GRID2.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)
       thisform.GRID1.setall('FONTSIZE',INT_015*9,'COLUMN')
       thisform.GRID1.setall('FONTSIZE',INT_015*9,'HEADER')         
       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='客戶編號'
       THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='客戶簡稱'
       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='C01.F01'
       THISFORM.GRID1.COLUMN2.CONTROLSOURCE='C01.F04'
       thisform.GRID2.setall('FONTSIZE',INT_015*9,'COLUMN')
       thisform.GRID2.setall('FONTSIZE',INT_015*9,'HEADER')       
       THISFORM.grid2.COLUMN1.HEADER1.CAPTION='料品編號'
       THISFORM.grid2.COLUMN2.HEADER1.CAPTION='品名規格'
	   THISFORM.grid2.COLUMN3.HEADER1.CAPTION='需求月份'
	   THISFORM.grid2.COLUMN4.HEADER1.CAPTION='預估數量'
	   THISFORM.grid2.COLUMN5.HEADER1.CAPTION='實際需求'	   
	   THISFORM.grid2.COLUMN6.HEADER1.CAPTION='備註說明'
	   THISFORM.grid2.COLUMN1.CONTROLSOURCE='P10.F03'
	   THISFORM.grid2.COLUMN2.CONTROLSOURCE='B01.F02'
	   THISFORM.grid2.COLUMN3.CONTROLSOURCE='P10.F02'
	   THISFORM.grid2.COLUMN4.CONTROLSOURCE='P10.F08'
	   THISFORM.grid2.COLUMN5.CONTROLSOURCE='P10.F09'	   
	   THISFORM.grid2.COLUMN6.CONTROLSOURCE='P10.F04'
	   THISFORM.grid2.COLUMN1.WIDTH=INT_015*149
	   THISFORM.GRID2.COLUMN2.WIDTH=INT_015*149
       THISFORM.grid2.COLUMN3.WIDTH=INT_015*65
       THISFORM.GRID2.COLUMN4.WIDTH=INT_015*100
       THISFORM.GRID2.COLUMN5.WIDTH=INT_015*100       
       THISFORM.GRID2.COLUMN6.WIDTH=INT_015*149
       THISFORM.grid1.READONLY=.T.  
       THISFORM.GRID2.READONLY=.T.     
       THISFORM.grid1.SETFOCUS
       IF THISFORM.GRID1.ACTIVEROW=0
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
       ELSE
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.      
       ENDIF          
       THISFORM.KEY_LIST.DISPLAYVALUE='依客戶編號排列'       
       JK='客戶編號'
       SELE C01
       GO TOP
       THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=C01.F01
       THISFORM.PAGEFRAME1.PAGE1.LBLF011.CAPTION=C01.F04
  ENDPROC           
  PROC KEY_LIST.INIT 
       with this 
           .additem('依客戶編號排列')
           .additem('依料品編號排列')
       endwith      
  ENDPROC 
  PROC KEY_LIST.INTERACTIVECHANGE                 
       SELE C01
       SET RELA OFF INTO P10
       SELE B01
       SET RELA OFF INTO P10
       SELE P10
       SET RELA OFF INTO C01
       SET RELA OFF INTO B01       
       THISFORM.GRID1.RECORDSOURCE=''
       THISFORM.GRID1.CHILDORDER=''
       DO CASE
          CASE THIS.DISPLAYVALUE='依客戶編號排列'
               THISFORM.PAGEFRAME1.PAGE1.CAPTION='依照客戶搜尋紀錄'
               SELE C01
               GO TOP
               AREA1='C01'
               SELE P10
               SET ORDER TO P101     
               SET RELA TO F03 INTO B01       
               THISFORM.PAGEFRAME1.PAGE1.LBLF01.CAPTION='客戶編號'
               THISFORM.PAGEFRAME1.PAGE1.TXTF01.WIDTH=INT_015*74
               THISFORM.PAGEFRAME1.PAGE1.TXTF01.MAXLENGTH=5
               THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=C01.F01
               THISFORM.PAGEFRAME1.PAGE1.LBLF011.LEFT=INT_015*140
               THISFORM.PAGEFRAME1.PAGE1.LBLF011.CAPTION=C01.F04
               THISFORM.PAGEFRAME1.PAGE2.LBLF01.VISIBLE=.F.
               THISFORM.PAGEFRAME1.PAGE2.LBLF011.VISIBLE=.F.
               THISFORM.PAGEFRAME1.PAGE2.TXTF01.VISIBLE=.F.
               THISFORM.PAGEFRAME1.PAGE2.TXTF01.ENABLED=.F.
               THISFORM.PAGEFRAME1.PAGE2.LBLF03.VISIBLE=.T.
               THISFORM.PAGEFRAME1.PAGE2.LBLF031.VISIBLE=.T.
               THISFORM.PAGEFRAME1.PAGE2.TXTF03.VISIBLE=.T.
               THISFORM.PAGEFRAME1.PAGE2.TXTF03.ENABLED=.T.
               THISFORM.GRID1.RECORDSOURCE='C01'
               THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='客戶編號'
               THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='客戶簡稱'
               THISFORM.GRID1.COLUMN1.CONTROLSOURCE='C01.F01'
               THISFORM.GRID1.COLUMN2.CONTROLSOURCE='C01.F04'   
               THISFORM.GRID1.COLUMN1.WIDTH=INT_015*50
               THISFORM.GRID1.COLUMN2.WIDTH=INT_015*50
               THISFORM.GRID2.LINKMASTER='C01'
               THISFORM.GRID2.RELATIONALEXPR='F01'
               THISFORM.GRID2.CHILDORDER='P101'            
               THISFORM.grid2.COLUMN1.HEADER1.CAPTION='料品編號'
               THISFORM.grid2.COLUMN1.CONTROLSOURCE='P10.F03'
               THISFORM.grid2.COLUMN1.WIDTH=INT_015*149
               THISFORM.grid2.COLUMN2.HEADER1.CAPTION='品名規格'
               THISFORM.grid2.COLUMN2.CONTROLSOURCE='B01.F02'   
               THISFORM.grid2.COLUMN2.WIDTH=INT_015*100                     
          CASE THIS.DISPLAYVALUE='依料品編號排列'
               THISFORM.PAGEFRAME1.PAGE1.CAPTION='依照料號搜尋紀錄'          
               SELE B01
               GO TOP
               AREA1='B01'
               SELE P10
               SET ORDER TO P102
               SET RELA TO F01 INTO C01
               THISFORM.PAGEFRAME1.PAGE1.LBLF01.CAPTION='料品編號'
               THISFORM.PAGEFRAME1.PAGE1.TXTF01.WIDTH=INT_015*261
               THISFORM.PAGEFRAME1.PAGE1.TXTF01.MAXLENGTH=43
               THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=B01.F01
               THISFORM.PAGEFRAME1.PAGE1.LBLF011.LEFT=INT_015*327
               THISFORM.PAGEFRAME1.PAGE1.LBLF011.CAPTION=B01.F02
               THISFORM.PAGEFRAME1.PAGE2.LBLF01.VISIBLE=.T.
               THISFORM.PAGEFRAME1.PAGE2.LBLF011.VISIBLE=.T.
               THISFORM.PAGEFRAME1.PAGE2.TXTF01.VISIBLE=.T.
               THISFORM.PAGEFRAME1.PAGE2.TXTF01.ENABLED=.T.
               THISFORM.PAGEFRAME1.PAGE2.LBLF03.VISIBLE=.F.
               THISFORM.PAGEFRAME1.PAGE2.LBLF031.VISIBLE=.F.
               THISFORM.PAGEFRAME1.PAGE2.TXTF03.VISIBLE=.F.
               THISFORM.PAGEFRAME1.PAGE2.TXTF03.ENABLED=.F.                
               THISFORM.GRID1.RECORDSOURCE='B01'
               THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='料品編號'
               THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='品名規格'
               THISFORM.GRID1.COLUMN1.CONTROLSOURCE='B01.F01'
               THISFORM.GRID1.COLUMN2.CONTROLSOURCE='B01.F02'
               THISFORM.GRID1.COLUMN1.WIDTH=INT_015*149
               THISFORM.GRID1.COLUMN2.WIDTH=INT_015*149   
               THISFORM.GRID2.LINKMASTER='B01'
               THISFORM.GRID2.RELATIONALEXPR='F01'
               THISFORM.GRID2.CHILDORDER='P102'  
               THISFORM.grid2.COLUMN1.HEADER1.CAPTION='客戶編號'
               THISFORM.grid2.COLUMN1.CONTROLSOURCE='P10.F01'
               THISFORM.grid2.COLUMN1.WIDTH=INT_015*50               
               THISFORM.grid2.COLUMN2.HEADER1.CAPTION='客戶簡稱'
               THISFORM.grid2.COLUMN2.CONTROLSOURCE='C01.F04'       
               THISFORM.grid2.COLUMN2.WIDTH=INT_015*50                                        
       ENDCASE 
        THISFORM.PAGEFRAME1.ACTIVEPAGE=2
        THISFORM.PAGEFRAME1.ACTIVEPAGE=1
        SELE &AREA1
        THISFORM.grid1.SETFOCUS
  ENDPROC      
  PROC grid1.AFTERROWCOLCHANGE
       LPARAMETERS nColIndex
       IF THISFORM.KEY_list.DISPLAYVALUE='依客戶編號排列'
          THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=C01.F01
          THISFORM.PAGEFRAME1.PAGE1.LBLF011.CAPTION=C01.F04
       ELSE          
          THISFORM.PAGEFRAME1.page1.TXTF01.VALUE=B01.F01
          THISFORM.PAGEFRAME1.PAGE1.LBLF011.CAPTION=B01.F02
       ENDif

       FCH=THISFORM.ACTIVECONTROL.NAME
       JK=THIS.COLUMN1.HEADER1.CAPTION  
       IF THIS.ACTIVEROW=0
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
       ELSE
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.
       ENDIF   
       CHK=''     
       thisform.refresh
  ENDPROC     
  PROC grid2.AFTERROWCOLCHANGE
       LPARAMETERS nColIndex
       THISFORM.PAGEFRAME1.PAGE2.TXTF01.VALUE=F01
       THISFORM.PAGEFRAME1.PAGE2.LBLF011.CAPTION=C01.F04
       THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE=F02
       THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=F03
       THISFORM.PAGEFRAME1.PAGE2.LBLF031.CAPTION=LEFT(B01.F02,20)
       THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE=F04
       THISFORM.PAGEFRAME1.PAGE2.TXTF08.VALUE=F08
       THISFORM.PAGEFRAME1.PAGE2.LBLF09.VISIBLE=IIF(PADL(LEFT(DTOC(DATE()),5),7,'0')>=P10.F02,.T.,.F.)
       THISFORM.PAGEFRAME1.PAGE2.LBLF091.VISIBLE=IIF(PADL(LEFT(DTOC(DATE()),5),7,'0')>=P10.F02,.T.,.F.)
       THISFORM.PAGEFRAME1.PAGE2.LBLDIV.VISIBLE=IIF(PADL(LEFT(DTOC(DATE()),5),7,'0')>=P10.F02,.T.,.F.)
       THISFORM.PAGEFRAME1.PAGE2.LBLDIV1.VISIBLE=IIF(PADL(LEFT(DTOC(DATE()),5),7,'0')>=P10.F02,.T.,.F.)  
       THISFORM.PAGEFRAME1.PAGE2.LBLF091.CAPTION=TRANSFORM(P10.F09,'@R ########.##')
       THISFORM.PAGEFRAME1.PAGE2.LBLDIV1.CAPTION=TRANSFORM(P10.F08-P10.F09,'@R ########.##')                	   
       THISFORM.PAGEFRAME1.PAGE2.LBLF111.CAPTION=F11
        THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  .AND. IIF(PADL(LEFT(DTOC(DATE()),5),7,'0')<P10.F02,.T.,.F.)  &&判斷有無修改的權限
        THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)   .AND. IIF(PADL(LEFT(DTOC(DATE()),5),7,'0')<P10.F02,.T.,.F.)  &&判斷有無刪除的權限       
       FCH=THISFORM.ACTIVECONTROL.NAME
       JK=THIS.COLUMN1.HEADER1.CAPTION
       CHK=THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
       if thisform.pageframe1.activepage=1
          thisform. CMDGROUP.SEEK_BOTT.ENABLED=.F.
       ENDIF   
  ENDPROC 
  PROCEDURE ORPGROUP.NEW_BOTT.CLICK    
    THISFORM.SETALL('READONLY',.F.,'TEXTBOX')       
    THISFORM.PAGEFRAME1.PAGE1.ENABLED=.F.
    THISFORM.GRID2.ENABLED=.F. 
    IF AREA1='C01'
        THISFORM.PAGEFRAME1.PAGE2.TXTF03.READONLY=.F.    
        THISFORM.PAGEFRAME1.PAGE2.TXTF03.SETFOCUS     
        THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=''
        THISFORM.PAGEFRAME1.PAGE2.LBLF031.CAPTION=''
     ELSE
        THISFORM.PAGEFRAME1.PAGE2.TXTF01.READONLY=.F. 
        THISFORM.PAGEFRAME1.PAGE2.TXTF01.SETFOCUS
        THISFORM.PAGEFRAME1.PAGE2.TXTF01.VALUE=''   
        THISFORM.PAGEFRAME1.PAGE2.LBLF091.CAPTION=''     
        THISFORM.PAGEFRAME1.PAGE2.LBLDIV1.CAPTION=''          
        THISFORM.PAGEFRAME1.PAGE2.LBLF011.CAPTION=''          
     ENDIF   
     THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE=''
     THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE=''
     THISFORM.PAGEFRAME1.PAGE2.TXTF08.VALUE=0
     THISFORM.PAGEFRAME1.PAGE2.LBLF111.CAPTION=''
     THISFORM.PAGEFRAME1.PAGE2.LBLF09.VISIBLE=.F.
     THISFORM.PAGEFRAME1.PAGE2.LBLF091.VISIBLE=.F.     
     THISFORM.PAGEFRAME1.PAGE2.LBLDIV.VISIBLE=.F.     
     THISFORM.PAGEFRAME1.PAGE2.LBLDIV1.VISIBLE=.F.          
  ENDPROC  
  PROCEDURE ORPGROUP.EDIT_BOTT.CLICK
     THISFORM.PAGEFRAME1.PAGE1.ENABLED=.F.
     THISFORM.GRID2.ENABLED=.F.

     IF AREA1='C01'
        THISFORM.PAGEFRAME1.PAGE2.TXTF03.SETFOCUS     
     ELSE
        THISFORM.PAGEFRAME1.PAGE2.TXTF01.SETFOCUS     
     ENDIF   
     LOCK()
     IF !RLOCK()
        DO file_impact
        return
     endif
  endproc 
  PROCEDURE ORPGROUP.DEL_BOTT.CLICK
     if messagebox('是否確定要刪除此筆資料',4+32+256,'請確認') = 6	      
        SELE P10   
        LOCK()
        IF RLOCK()
           DELE
           unlock ALL
           SKIP -1
           IF BOF()
             GO TOP
           ENDIF   
           THISFORM.GRID2.SETFOCUS
           IF THISFORM.GRID2.ACTIVEROW=0
              THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
              THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
              THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
              THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
              THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
              THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
              THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
              THISFORM.PAGEFRAME1.PAGE2.SETALL('VALUE','','TEXTBOX') 
              THISFORM.PAGEFRAME1.PAGE2.TXTF01.VALUE=''
              THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=''
              THISFORM.PAGEFRAME1.PAGE2.LBLF091.CAPTION=''
              THISFORM.PAGEFRAME1.PAGE2.LBLDIV1.CAPTION=''
              THISFORM.PAGEFRAME1.PAGE2.LBLF011.CAPTION=''
              THISFORM.PAGEFRAME1.PAGE2.LBLF031.CAPTION=''
              THISFORM.PAGEFRAME1.PAGE2.LBLF111.CAPTION=''                                         
            ELSE
              THISFORM.CMDGROUP.ENABLED=.T.
              THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.) .AND. IIF(PADL(LEFT(DTOC(DATE()),5),7,'0')<P10.F02,.T.,.F.) &&判斷有無修改的權限
              THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)  .AND. IIF(PADL(LEFT(DTOC(DATE()),5),7,'0')<P10.F02,.T.,.F.) &&判斷有無刪除的權限
              THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限              
           ENDIF
        ELSE
          DO file_impact    
        ENDIF          
     ENDIF        
  ENDPROC     
  PROCEDURE SHRGROUP.SHURE1_BOTT.CLICK
    DO CASE
       CASE AREA1='C01'
            IF SEEK(THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE,'B01')=.F.
               =MESSAGEBOX('物料基本主檔中歸屬類別設定錯誤或是根本無此料號!',0+64,'提示訊息視窗')
               THISFORM.PAGEFRAME1.PAGE2.TXTF03.SETFOCUS
               RETURN
            ELSE
               THISFORM.PAGEFRAME1.PAGE2.TXTF01.VALUE=THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE   
            ENDIF   
            IF SEEK(THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE,'P10')=.T.
               =MESSAGEBOX('此料號已經在'+THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE+'輸入預估數量,請直接去該筆修改',0+64,'提示訊息視窗')
               THISFORM.PAGEFRAME1.PAGE2.TXTF02.SETFOCUS
               RETURN
            ENDIF   
       CASE AREA1='B01'
            IF SEEK(THISFORM.PAGEFRAME1.PAGE2.TXTF01.VALUE,'C01')=.F. 
               =MESSAGEBOX('客戶基本主檔無此編號請先建立!',0+64,'提示訊息視窗')
               THISFORM.PAGEFRAME1.PAGE2.TXTF01.SETFOCUS
               RETURN
            ELSE
               THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE    
            ENDIF
            IF SEEK(THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF01.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE,'P10')=.T.
               =MESSAGEBOX('此客戶已經在'+THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE+'輸入預估數量,請直接去該筆修改',0+64,'提示訊息視窗')
               THISFORM.PAGEFRAME1.PAGE2.TXTF02.SETFOCUS
               RETURN
            ENDIF               
    ENDCASE       
    IF EMPTY(THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE) .OR. VAL(RIGHT(THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE,2))>12 .OR. VAL(RIGHT(THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE,2))=0
       =MESSAGEBOX('需求月份輸入錯誤!',0+64,'提示訊息視窗')
       THISFORM.PAGEFRAME1.PAGE2.TXTF02.SETFOCUS
       RETURN
    ENDIF    
    IF CTOD(THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE+'/01')<=DATE()
       =MESSAGEBOX('輸入月份早於目前月份!請改由未來的其他月份做預估的輸入資料!',0+64,'已經逾期不得再輸入此月份預估資料')
       THISFORM.PAGEFRAME1.PAGE2.TXTF02.SETFOCUS
       RETURN
    ENDIF           
    SELE P10
    APPEND BLANK
    LOCK()
    IF RLOCK()
       REPLACE F01 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF01.VALUE
       REPLACE F02 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE
       REPLACE F03 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE
       REPLACE F04 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE
       REPLACE F08 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF08.VALUE
       REPLACE F11 WITH dtoc(DATE())+' '+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
    ENDIF
    UNLOCK
    IF AREA1='C01'
       SEEK THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE
    ELSE
       SEEK THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF01.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE
    ENDIF   
    THISFORM.grid2.ENABLED=.T.    
    THISFORM.grid2.SETFOCUS        
    THISFORM.ORPGROUP.NEW_BOTT.CLICK            
  ENDPROC
  PROCEDURE SHRGROUP.SHURE2_BOTT.CLICK
    IF AREA1='C01'
       THISFORM.PAGEFRAME1.PAGE2.TXTF01.VALUE=THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
    ELSE
       THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
    ENDIF      
    IF EMPTY(THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE) .OR. VAL(RIGHT(THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE,2))>12 .OR. VAL(RIGHT(THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE,2))=0
       =MESSAGEBOX('需求月份輸入錯誤!',0+64,'提示訊息視窗')
       THISFORM.PAGEFRAME1.PAGE2.TXTF02.SETFOCUS
       RETURN
    ENDIF        
    SELE P10
    IF RLOCK()
       REPLACE F01 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF01.VALUE
       REPLACE F02 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE
       REPLACE F03 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE
       REPLACE F04 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE
       REPLACE F08 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF08.VALUE
       REPLACE F11 WITH DTOC(DATE())+' '+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
    ELSE
      DO file_impact
      return   
    ENDIF   
    THISFORM.SHRGROUP.ABANDON_BOTT.CLICK    
  ENDPROC   
  procedure SHRGROUP.ABANDON_BOTT.CLICK
      THISFORM.SHRGROUP.ENABLED=.F.
      THISFORM.SHRGROUP.VISIBLE=.F.      
      THISFORM.ORPGROUP.ENABLED=.T.
      THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.)   &&判斷有無新增的權限
      THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  .AND. IIF(PADL(LEFT(DTOC(DATE()),5),7,'0')<P10.F02,.T.,.F.)&&判斷有無修改的權限
      THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)   .AND. IIF(PADL(LEFT(DTOC(DATE()),5),7,'0')<P10.F02,.T.,.F.)&&判斷有無刪除的權限
      THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限
      THISFORM.ORPGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
      THISFORM.CMDGROUP.ENABLED=.T.
      THISFORM.CMDGROUP.SETALL('ENABLED',.T.,'COMMANDBUTTON')
      THISFORM.CMDGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
      THISFORM.SETALL('READONLY',.T.,'TEXTBOX')  
      THISFORM.PAGEFRAME1.PAGE2.TXTF01.READONLY=.T.
      THISFORM.PAGEFRAME1.PAGE2.TXTF03.READONLY=.T.
      UNLOCK ALL
      SELE P10
      THISFORM.PAGEFRAME1.PAGE1.ENABLED=.T.
      THISFORM.grid2.ENABLED=.T.
      THISFORM.grid2.SETFOCUS
      UNLOCK ALL
  ENDPROC
  PROCEDURE SHRGROUP.FINISH_BOTT.CLICK
       SELE P10
       THISFORM.SHRGROUP.ABANDON_BOTT.CLICK
  ENDPROC     
  PROCEDURE ANS_BOTT.CLICK &&列印預估總表程序
     CHK_STR='1'
     ANS_TRNG=createobject("ANS_TRNG")  
     ANS_TRNG.SHOW    
     IF FLG<>'1'
         =MESSAGEBOX('無此月份範圍資料',0+48,'警示')
     ENDIF   
     FLG='0'  
  ENDPROC
  PROCEDURE DIV_BOTT.CLICK &&列印差異總表程序
     CHK_STR='2'
     ANS_TRNG=createobject("ANS_TRNG")  
     ANS_TRNG.SHOW    
     IF FLG<>'1'
         =MESSAGEBOX('無此月份範圍資料',0+48,'警示')
     ENDIF   
     FLG='0'  
  ENDPROC  
ENDDEFINE    
************************************************************************列印總表月份範圍選取畫面
define class ANS_TRNG as form
  autocenter=.t.
  caption='請輸入列印月份範圍'
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*190
  WIDTH=INT_015*375
  FONTSIZE=INT_015*9
  CONTROLBOX=.F.
  BORDERSTYLE=2
  SHOWTIPS=.T.
  showwindow=1
  windowtype=1
  name='ANS_TRNG'
  add object label1 as label with;
      autosize=.t.,;
      HEIGHT=INT_015*25,;
      LEFT=INT_015*100,;
      TOP=INT_015*75,;
      FONTSIZE=INT_015*9,;
      name='label1',;
      CAPTION='起始月份'      
  add object text1 as textbox with;
      autosize=.t.,;
      TOP=INT_015*70,;
      WIDTH=INT_015*70,;
      LEFT=INT_015*150,;
      HEIGHT=INT_015*25,; 
      FONTSIZE=INT_015*9,;      
      INPUTMASK='####/##',;        
      name='text1'
  add object cmnd1 as commandbutton with;
      autosize=.t.,;
      LEFT=INT_015*60,;    
      HEIGHT=INT_015*25,;   
      TOP=INT_015*144,;  
      WIDTH=INT_015*80,;
      FONTSIZE=INT_015*9,;      
      caption='\<Y.執行',;
      TOOLTIPTEXT='確認所輸入的範圍鍵值!快速鍵->ALT+Y',;
      name='cmnd1'
  add object cmnd2 as commandbutton with;
      autosize=.t.,;
      LEFT=INT_015*200,;
      TOP=INT_015*144,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*80,;
      FONTSIZE=INT_015*9,;      
      caption='\<C.取消',;
      TOOLTIPTEXT='取消作業!快速鍵->ALT+C',;
      name='cmnd2'
  procedure init 
      THISFORM.TEXT1.VALUE=''
  ENDPROC    
   procedure cmnd1.click 
      ENDMTH1=VAL(RIGHT(THISFORM.TEXT1.VALUE,2))+5
      IF ENDMTH1-12>0
         ENDMTH2=ALLTRIM(STR(VAL(LEFT(THISFORM.TEXT1.VALUE,4))+1))
         ENDMTH3=PADL(ALLTRIM(STR(ENDMTH1-12)),2,'0')
         ENDMTH=PADL(ENDMTH2+'/'+ENDMTH3,7, '0')
      ELSE
         ENDMTH=LEFT(THISFORM.TEXT1.VALUE,5)+PADL(ALLTRIM(STR(ENDMTH1)),2,'0')
      ENDIF   

         SELE F03,F02,SUM(F08),SUM(F08-F09) FROM P10 GROUP BY F03,F02 ORDER BY F03,F02 INTO CURSOR P10TMP1;
         WHERE F02>=THISFORM.TEXT1.VALUE  AND F02<=ENDMTH
      IF _TALLY>0
         CREATE CURSOR P10TMP2;
         (F01 C(43),F02 N(11,2),F03 N(11,2),F04 N(11,2),F05 N(11,2),F06 N(11,2),F07 N(11,2))
         INDE ON F01 TAG P10TMP21
         SELE P10TMP2
         SET ORDER TO 1      
         STCK_NO=SPACE(20)
         SELE P10TMP1
         GO TOP
         DO WHILE !EOF()
            SELE P10TMP2
            IF P10TMP1.F03<>STCK_NO
              APPEND BLANK
            ENDIF  
            REPL F01 WITH P10TMP1.F03
            QTY=VAL(RIGHT(P10TMP1.F02,2))-VAL(RIGHT(THISFORM.TEXT1.VALUE,2))
            IF QTY<0
               QTY=QTY+12
            ENDIF
            SQ=FIELD( QTY+2) 
            REPL (SQ) WITH  IIF(CHK_STR='2',P10TMP1.SUM_EXP_4,P10TMP1.SUM_F08)   
            SELE P10TMP1
            STCK_NO=F03
            SKIP
         ENDDO
         SELE P10TMP2
         COPY TO P10ANS.DBF
         BEGMTH=THISFORM.TEXT1.VALUE
         TTLE=IIF(CHK_STR='1','業務出貨需求預估總表','業務出貨預估－實際出貨差異總表')
*         REPORT FORM P10C TO PRINTER PROMPT
         REPORT FORM ALLTRIM(INT_116)+'P10C' PREVIEW   
         FLG='1'
         SELE P10TMP2
         USE
         SELE P10TMP1
         USE
         CLEAR
      ENDIF  
         THISFORM.RELEASE                               
  endproc
  procedure cmnd2.click
      FLG='1'   
      thisform.release
  endproc      
enddefine            
***********************************************單筆客戶或料號列印程序
PROCEDURE PNT_PRC  
     IF AREA1='C01'
        LK=C01.F01
     ELSE   
        LK=B01.F01   
     ENDIF   
     ANS_RANGE=createobject("ANS_RANGE")  
     ANS_RANGE.SHOW    
     IF FLG='0'
         =MESSAGEBOX('無此日期範圍資料',0+48,'警示')
     ENDIF   
     FLG='0'
ENDPROC

***********************************************列印日期選定
define class ANS_RANGE as form
  autocenter=.t.
  caption='請輸入列印月份範圍'
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*190
  WIDTH=INT_015*375
  FONTSIZE=INT_015*9
  CONTROLBOX=.F.
  BORDERSTYLE=2
  SHOWTIPS=.T.
  showwindow=1
  windowtype=1
  name='ANS_RANGE'
  add object label1 as label with;
      autosize=.t.,;
      HEIGHT=INT_015*25,;
      LEFT=INT_015*30,;
      TOP=INT_015*75,;
      FONTSIZE=INT_015*9,;      
      name='label1',;
      CAPTION='起始月份'      
  ADD OBJECT LABEL2 AS LABEL WITH;
      AUTOSIZE=.T.,;
      HEIGHT=INT_015*25,;
      LEFT=INT_015*190,;
      TOP=INT_015*75,;
      NAME='LABEL2',;
      FONTSIZE=INT_015*9,;      
      CAPTION='截止月份'          
  add object text1 as textbox with;
      autosize=.t.,;
      TOP=INT_015*70,;
      WIDTH=INT_015*70,;
      LEFT=INT_015*80,;
      HEIGHT=INT_015*25,; 
      FONTSIZE=INT_015*9,;      
      INPUTMASK='####/##',;        
      name='text1'
  add object text2 as textbox with;
      autosize=.t.,;
      TOP=INT_015*70,;
      WIDTH=INT_015*70,;
      LEFT=INT_015*240,;
      HEIGHT=INT_015*25,; 
      FONTSIZE=INT_015*9,;              
      INPUTMASK='####/##',;
      name='text2'    
  add object cmnd1 as commandbutton with;
      autosize=.t.,;
      LEFT=INT_015*60,;    
      HEIGHT=INT_015*25,;   
      TOP=INT_015*144,;  
      WIDTH=INT_015*80,;
      FONTSIZE=INT_015*9,;      
      caption='\<Y.執行',;
      TOOLTIPTEXT='確認所輸入的範圍鍵值!快速鍵->ALT+Y',;
      name='cmnd1'
  add object cmnd2 as commandbutton with;
      autosize=.t.,;
      LEFT=INT_015*200,;
      TOP=INT_015*144,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*80,;
      FONTSIZE=INT_015*9,;      
      caption='\<C.取消',;
      TOOLTIPTEXT='取消作業!快速鍵->ALT+C',;
      name='cmnd2'
  procedure init 
      THISFORM.TEXT1.VALUE=''
      THISFORM.TEXT2.VALUE=''
  ENDPROC    
   procedure cmnd1.click 
      IF LK=C01.F01
         SELECT P10.F01,;       
         P10.F02,;
         P10.F03,;
         P10.F08,;
         P10.F09,;         
         B01.F02,;
         C01.F04;
         FROM P10,B01,C01;     
         WHERE P10.F01=LK  AND B01.F01=P10.F03 AND C01.F01=LK AND P10.F02>=THISFORM.TEXT1.VALUE;
         AND  P10.F02<=THISFORM.TEXT2.VALUE  ORDER BY P10.F03,P10.F02 NOWAIT 
         BROW
         IF _tally >0
            FLG='1'
*            REPORT FORM P10A TO PRINTER PROMPT
           REPORT FORM ALLTRIM(INT_116)+'P10A' PREVIEW
         ENDIF  
      ELSE
         SELECT P10.F01,;
         P10.F03,;
         P10.F02,;
         P10.F08,;
         P10.F09,;         
         B01.F02,;
         C01.F04;
         FROM P10,B01,C01;     
         WHERE P10.F03=LK  AND C01.F01=P10.F01 AND B01.F01=LK AND P10.F02>=THISFORM.TEXT1.VALUE;
         AND  P10.F02<=THISFORM.TEXT2.VALUE  ORDER BY P10.F01,P10.F02 NOWAIT 
         IF _tally >0
            FLG='1'
*            REPORT FORM ALLTRIM(INT_116)+'P10B' TO PRINTER PROMPT
            REPORT FORM ALLTRIM(INT_116)+'P10B' PREVIEW
         ENDIF             
      ENDIF   
         THISFORM.RELEASE                         
  endproc
  procedure cmnd2.click
      FLG='1'   
      thisform.release
  endproc      
enddefine            

************************************************特殊輸入欄位的設定----料號
DEFINE CLASS TXTF03 AS TEXTBOX
  READONLY=.T.
  MAXLENGTH=20
  FONTSIZE=INT_015*9
  PROCEDURE INTERACTIVECHANGE
    IF AT('?',ALLTRIM(THIS.VALUE))<>0
       IF AT('?',ALLTRIM(THIS.VALUE))>1             
          SELECT F01,F02 FROM B01 INTO CURSOR MTR ORDER BY F01 WHERE  LEFT(F01,AT('?',THIS.VALUE)-1)=LEFT(THIS.VALUE,AT('?',THIS.VALUE)-1)
       ELSE
          SELECT F01,F02 FROM B01 INTO CURSOR MTR ORDER BY F01 
       ENDIF   
       MAN_SEEK=createobject("MTR_SEEK")  
       MAN_SEEK.SHOW    
       THIS.VALUE=FLG
       THIS.REFRESH
       FLG='0'        
    ENDIF  
       THISFORM.PAGEFRAME1.PAGE2.LBLF031.CAPTION=IIF(SEEK(THIS.VALUE,'B01'),B01.F02,'')  
  ENDPROC
ENDDEFINE
***************************************************特殊輸入欄位設定-----------客戶
DEFINE CLASS TXTF01 AS TEXTBOX
  READONLY=.T.
  MAXLENGTH=5
  FONTSIZE=INT_015*9  
  PROCEDURE INTERACTIVECHANGE
    IF AT('?',ALLTRIM(THIS.VALUE))<>0
       IF AT('?',ALLTRIM(THIS.VALUE))>1             
          SELECT F02,F01,F04 FROM C01 INTO CURSOR VDR ORDER BY F02 WHERE LEFT(F02,AT('?',THIS.VALUE)-1)=LEFT(THIS.VALUE,AT('?',THIS.VALUE)-1)
       ELSE
          SELECT F02,F01,F04 FROM C01 INTO CURSOR VDR ORDER BY F02 
       ENDIF   
       IF _TALLY>0
          VDR_SEEK=createobject("VDR_SEEK")  
          VDR_SEEK.SHOW    
          THIS.VALUE=FLG
          THIS.REFRESH
          FLG='0'        
       ENDIF
    ELSE
       IF LEN(ALLTRIM(THIS.VALUE))=4
          SELECT F02,F01,F04 FROM C01 INTO CURSOR VDR ORDER BY F02 WHERE F02=ALLTRIM(THIS.VALUE)
          DO CASE
             CASE _TALLY=1
                  THIS.VALUE=VDR.F01
                  THIS.REFRESH
             CASE _TALLY>1
                  VDR_SEEK=createobject("VDR_SEEK")  
                  VDR_SEEK.SHOW    
                  THIS.VALUE=FLG
                  THIS.REFRESH
                  FLG='0'        
          ENDCASE      
       ENDIF              
    ENDIF  
       THISFORM.PAGEFRAME1.PAGE2.LBLF011.CAPTION=IIF(SEEK(THIS.VALUE,'C01'),C01.F04,'')  
  ENDPROC
ENDDEFINE
