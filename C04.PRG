close all
clear 
FLG='0'
FCH=''
CHK=''
R=0
FTR_STR=''
UKEF=''
ZINSU=''
QTY=0
TQTY=0
COD=''
DONBIN=''
AREA1='C03'
AREA2='C04'
IF !USED('E08')
   SELECT 0
   USE E08
ELSE
   SELECT E08
ENDIF
SET ORDER TO E083      
IF !USED('C00')
   SELE 0
   USE C00
ELSE
   SELE C00
ENDIF
SET ORDER TO C001
IF ! USED('A01')
   SELE 0
   USE A01 INDE A01
ELSE
   SELE A01
ENDIF      
SET ORDER TO A01
IF !USED('A02')
   SELE 0
   USE A02 INDE A02
ELSE
   SELE A02
ENDIF
SET ORDER TO A021      
SEEK sys_oper+'C04'
IF !USED('B0A')
   SELE 0
   USE B0A 
ELSE
   SELE B0A
ENDIF
SET ORDER TO B0A1  
IF !USED('B01')
   SELE 0
   USE B01 INDE B01
ELSE
   SELE B01
ENDIF
SET ORDER TO B011  
IF !USED('K51')
   SELE 0
   USE K51 
ELSE 
   SELE K51 
ENDIF    
SET ORDER TO K511
IF !USED('C01')
   SELE 0
   USE C01 INDE C01
ELSE
   SELE C01
ENDIF
SET ORDER TO C011
IF EMPTY(A02.F12)
   SET FILTER TO F18=sys_oper
ENDIF   
IF !USED('C21')    &&特價描述檔
   SELE 0
   USE C21 INDE C21
ELSE
   SELE C21
ENDIF
SET ORDER TO C211
IF !USED('C02')
   SELE 0
   USE C02 INDE C02
ELSE
   SELE C02
ENDIF
SET ORDER TO C023

IF !USED('C05')
   SELE 0
   USE C05 INDE C05
ELSE
   SELE C05
ENDIF
SET ORDER TO C054
IF EMPTY(A02.F12)
   SET FILTER TO F08=sys_oper
ENDIF   
IF !USED('C03')
   SELE 0
   USE C03 INDE C03
ELSE
   SELE C03
ENDIF
SET ORDER TO C031
IF EMPTY(A02.F12)
   SET FILTER TO F07=sys_oper
ENDIF   
SET RELATION  TO F03 INTO C01
SET RELA TO F07 INTO a01 addi
SET RELATION TO F12 INTO C00 ADDI
if !used('C04')
   SELE 0
   USE C04 INDE C04
ELSE
   SELE C04
ENDIF
SET ORDER TO C041      
SET RELA TO F04 INTO B01
SET RELATION TO C01.F45+F04+F06+F13 INTO C21 ADDI
C04FORM=CREATEOBJECT("TKC04")
C04FORM.SHOW  
DEFINE CLASS TKC04 AS FORM
  CAPTION='C04.客戶訂單'
*!*	  AUTOCENTER=.T.
  CONTROLBOX=.F.
  BORDERSTYLE=1 
  MAXBUTTON=.F.
  MINBUTTON=.F.
  MOVABLE=.F.
  CLOSABLE=.F.
  CONTROLCOUNT=57
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*550
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WIDTH=INT_015*789
  WINDOWTYPE=1
  NAME='TKC04'
  ADD OBJECT SHAPE1 AS SHAPE1 WITH;
      AUTOCENTER=.T.
  ADD OBJECT LBL_REC AS LBL_REC WITH;
      AUTOCENTER =.T.
  ADD OBJECT REC_COUNT AS REC_COUNT  WITH;
      CAPTION=STR(RECCOUNT())        
  ADD OBJECT SHAPE2 AS SHAPE2 WITH;
      AUTOCENTER=.T.
  ADD OBJECT SHAPE3 AS SHAPE3 WITH;
      AUTOCENTER=.T.
  ADD OBJECT PAGEFRAME1 AS PAGEFRAME WITH;
      LEFT=INT_015*236,;
      WIDTH=INT_015*540,;
      HEIGHT=INT_015*250,;
      FONTSIZE=INT_015*9,;
      PAGECOUNT=2,;
      TABSTRETCH=1,;
      ACTIVEPAGE=1,;
      VISIBLE=.T.,;
      PAGE1.NAME='PAGE1',;
      PAGE1.VISIBLE=.T.,;
      PAGE1.CAPTION='表頭資料',;
      PAGE2.NAME='PAGE2',;
      PAGE2.VISIBLE=.T.,;
      PAGE2.CAPTION='表身詳細資料內容'   
  ADD OBJECT KEY_LIST AS KEY_LIST WITH;
      AUTOCENTER=.T.
  ADD OBJECT grid1 AS grid1 WITH;
      columncount=4,;            
      RECORDSOURCE='C03',;
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;      
      COLUMN3.NAME='COLUMN3',;      
      COLUMN4.NAME='COLUMN4'      
  ADD OBJECT grid2 AS grid2 WITH;
      TOP=INT_015*230,;
      HEIGHT=INT_015*286,;  
      COLUMNCOUNT=7,;            
      RECORDSOURCE='C04',;
      LINKMASTER='C03',;
      RELATIONALEXPR='F02',;
      CHILDORDER='C041',;
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;
      COLUMN3.NAME='COLUMN3',;
      COLUMN4.NAME='COLUMN4',;
      COLUMN5.NAME='COLUMN5',;
      COLUMN6.NAME='COLUMN6',;
      COLUMN7.NAME='COLUMN7'
  ADD OBJECT CMDGROUP AS CMDGROUP WITH;
      AUTOSIZE=.T.              
  ADD OBJECT ORPGROUP AS ORPGROUP WITH;    
      AUTOSIZE=.T.              
  ADD OBJECT SHRGROUP AS SHRGROUP WITH;
      TOP=INT_015*190,;
      LEFT=INT_015*683          
  ADD OBJECT ANS_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*490,;
      LEFT=INT_015*15,;
      HEIGHT=INT_015*25,;
      FONTSIZE=INT_015*9,;
      WIDTH=INT_015*68,;
      CAPTION='\<A.出貨計劃',;
      TOOLTIPTEXT='查看或增修刪出貨方式'
      NAME='ANS_BOTT'      
  ADD OBJECT RCC_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*490,;
      LEFT=INT_015*85,;
      HEIGHT=INT_015*25,;
      FONTSIZE=INT_015*9,;
      WIDTH=INT_015*68,;      
      CAPTION='\<B.出貨紀錄',;
      TOOLTIPTEXT='查看此筆之出貨紀錄',;
      NAME='RCC_BOTT'                        
  ADD OBJECT TRN_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*490,;
      LEFT=INT_015*155,;
      HEIGHT=INT_015*25,;
      FONTSIZE=INT_015*9,;      
      WIDTH=INT_015*68,;
      CAPTION='\<T.轉單據',;
      TOOLTIPTEXT='將此張訂單轉入P03材料請購單與E04製造工單或預購轉正式訂單或空頭轉預購訂單',;
      NAME='TRN_BOTT'            
  PROCEDURE PAGEFRAME1.PAGE1.INIT     
     THIS.ADDOBJECT('LBLF02','LABEL')
     WITH THIS.LBLF02
          .VISIBLE=.T.
          .LEFT=INT_015*14
          .TOP=INT_015*13
          .WIDTH=INT_015*50
          .CAPTION='訂單編號'          
     ENDWITH
     THIS.ADDOBJECT('LBLF15','LABEL')
     WITH THIS.LBLF15
          .VISIBLE=.T.
          .LEFT=INT_015*165
          .TOP=INT_015*13
          .WIDTH=INT_015*30
          .CAPTION='類別'          
     ENDWITH   
    THIS.ADDOBJECT('LBLF151','LABEL')
     WITH THIS.LBLF151
          .VISIBLE=.T.
          .LEFT=INT_015*212
          .TOP=INT_015*13
          .AUTOSIZE=.T.
          .CAPTION=''          
     ENDWITH        
     THIS.ADDOBJECT('LBLF14','LABEL')     
     WITH THIS.LBLF14
          .VISIBLE=.T.
          .LEFT=INT_015*14
          .TOP=INT_015*38
          .WIDTH=INT_015*50  
          .CAPTION='客戶P/O:'
     ENDWITH            
     THIS.ADDOBJECT('LBLF03','LABEL')
     WITH THIS.LBLF03
         .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*63
         .WIDTH=INT_015*50
         .CAPTION='客戶編號'
     ENDWITH
     THIS.ADDOBJECT('LBLF031','LABEL')
     WITH THIS.LBLF031
         .VISIBLE=.T.
         .LEFT=INT_015*115
         .TOP=INT_015*63
         .AUTOSIZE=.T.
     ENDWITH
     THIS.ADDOBJECT('LBLF07','LABEL')
     WITH THIS.LBLF07
         .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*88
         .WIDTH=INT_015*50
         .CAPTION='業  務  員'
     ENDWITH    
     THIS.ADDOBJECT('LBLF071','LABEL')
     WITH THIS.LBLF071
         .VISIBLE=.T.
         .LEFT=INT_015*115
         .TOP=INT_015*88
         .AUTOSIZE=.T.        
     ENDWITH
     THIS.ADDOBJECT('LBLF06','LABEL')
     WITH THIS.LBLF06
         .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*113
         .WIDTH=INT_015*50
         .CAPTION='交貨地點'
     ENDWITH    
     THIS.ADDOBJECT('LBLF09','LABEL')
     WITH THIS.LBLF09
         .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*138
         .WIDTH=INT_015*50
         .CAPTION='備註說明'
     ENDWITH    
     THIS.ADDOBJECT('LBLF24','LABEL')
     WITH THIS.LBLF24
         .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*163
         .WIDTH=INT_015*50
         .CAPTION='付款方式'
     ENDWITH         
     THIS.ADDOBJECT('LBLF241','LABEL')
     WITH THIS.LBLF241
         .VISIBLE=.T.
         .LEFT=INT_015*65
         .TOP=INT_015*163
         .AUTOSIZE=.T.
         .CAPTION=''
     ENDWITH         
     THIS.ADDOBJECT('LBLF01','LABEL')
     WITH THIS.LBLF01
         .VISIBLE=.T.
         .LEFT=INT_015*368
         .TOP=INT_015*13
         .WIDTH=INT_015*50
         .CAPTION='訂貨日期'
     ENDWITH    
     THIS.ADDOBJECT('LBLF05','LABEL')
     WITH THIS.LBLF05
         .VISIBLE=.T.
         .LEFT=INT_015*368
         .TOP=INT_015*38
         .WIDTH=INT_015*50
         .CAPTION='交貨日期'
     ENDWITH    
     THIS.ADDOBJECT('LBLF13','LABEL')
     WITH THIS.LBLF13
         .VISIBLE=.T.
         .LEFT=INT_015*368
         .TOP=INT_015*63
         .WIDTH=INT_015*50
         .CAPTION='出貨指示'
     ENDWITH    
     THIS.ADDOBJECT('LBLF12','LABEL')
     WITH THIS.LBLF12
         .VISIBLE=.T.
         .LEFT=INT_015*368
         .TOP=INT_015*88
         .WIDTH=INT_015*50
         .CAPTION='幣        別'
     ENDWITH    
     THIS.ADDOBJECT('LBLF04','LABEL')
     WITH THIS.LBLF04
         .VISIBLE=.T.
         .LEFT=INT_015*368
         .TOP=INT_015*113
         .WIDTH=INT_015*50
         .CAPTION='訂單總價'         
     ENDWITH    
     THIS.ADDOBJECT('LBLF041','LABEL')
     WITH THIS.LBLF041
         .VISIBLE=.T.
         .LEFT=INT_015*418
         .TOP=INT_015*113
         .autosize=.t.
     ENDWITH         
     THIS.ADDOBJECT('LBLF10','LABEL')
     WITH THIS.LBLF10
         .VISIBLE=.T.
         .LEFT=INT_015*368
         .TOP=INT_015*138
         .WIDTH=INT_015*50
         .CAPTION='安全資料'
     ENDWITH    
     THIS.ADDOBJECT('LBLF101','LABEL')
     WITH THIS.LBLF101
         .VISIBLE=.T.
         .LEFT=INT_015*419
         .TOP=INT_015*138
         .autosize=.t.
     ENDWITH         
     THIS.ADDOBJECT('TXTF02','TEXTBOX')          
     WITH THIS.TXTF02
          .VISIBLE=.T.
          .LEFT=INT_015*64
          .TOP=INT_015*9
          .WIDTH=INT_015*81
          .HEIGHT=INT_015*25
          .MAXLENGTH=10
     ENDWITH        
     THIS.ADDOBJECT('TXTF15','TEXTBOX')          
     WITH THIS.TXTF15
          .VISIBLE=.T.
          .LEFT=INT_015*190
          .TOP=INT_015*9
          .WIDTH=INT_015*20
          .HEIGHT=INT_015*25
          .MAXLENGTH=1
     ENDWITH             
     THIS.ADDOBJECT('ODR_TYPE','ODR_TYPE')
     THIS.ADDOBJECT('TXTF14','TEXTBOX')          
     WITH THIS.TXTF14
          .VISIBLE=.T.
          .LEFT=INT_015*64
          .TOP=INT_015*34
          .WIDTH=INT_015*220
          .HEIGHT=INT_015*25
          .MAXLENGTH=25
     ENDWITH        
     THIS.ADDOBJECT('TXTF03','TXTF03')          
     WITH THIS.TXTF03
          .VISIBLE=.T.
          .LEFT=INT_015*64
          .TOP=INT_015*59
          .WIDTH=INT_015*49
          .HEIGHT=INT_015*25
          .MAXLENGTH=5
     ENDWITH        
     THIS.ADDOBJECT('TXTF07','TXTF07')          
     WITH THIS.TXTF07
          .VISIBLE=.T.
          .LEFT=INT_015*64
          .TOP=INT_015*84
          .WIDTH=INT_015*49
          .HEIGHT=INT_015*25
          .MAXLENGTH=5
     ENDWITH     
     THIS.ADDOBJECT('TXTF06','TEXTBOX')          
     WITH THIS.TXTF06
          .VISIBLE=.T.
          .LEFT=INT_015*64
          .TOP=INT_015*109
          .WIDTH=INT_015*288
          .HEIGHT=INT_015*25
          .MAXLENGTH=40
     ENDWITH           
     THIS.ADDOBJECT('TXTF09','TEXTBOX')          
     WITH THIS.TXTF09
          .VISIBLE=.T.
          .LEFT=INT_015*64
          .TOP=INT_015*134
          .WIDTH=INT_015*288
          .HEIGHT=INT_015*25
          .MAXLENGTH=40
     ENDWITH      
     THIS.ADDOBJECT('TXTF01','TEXTBOX')          
     WITH THIS.TXTF01
          .VISIBLE=.T.
          .LEFT=INT_015*418
          .TOP=INT_015*9
          .WIDTH=INT_015*73
          .HEIGHT=INT_015*25
     ENDWITH        
     THIS.ADDOBJECT('TXTF05','TEXTBOX')          
     WITH THIS.TXTF05
          .VISIBLE=.T.
          .LEFT=INT_015*418
          .TOP=INT_015*34
          .WIDTH=INT_015*73
          .HEIGHT=INT_015*25
     ENDWITH      
     THIS.ADDOBJECT('TXTF13','TEXTBOX')          
     WITH THIS.TXTF13
          .VISIBLE=.T.
          .LEFT=INT_015*418
          .TOP=INT_015*59
          .WIDTH=INT_015*55
          .HEIGHT=INT_015*25
          .MAXLENGTH=12
     ENDWITH      
     THIS.ADDOBJECT('TXTF12','TEXTBOX')          
     WITH THIS.TXTF12
          .VISIBLE=.T.
          .LEFT=INT_015*418
          .TOP=INT_015*84
          .WIDTH=INT_015*38
          .HEIGHT=INT_015*25
          .MAXLENGTH=4
     ENDWITH      
     THIS.ADDOBJECT('CRCY','CRCY')
  ENDPROC   
  PROCEDURE PAGEFRAME1.PAGE2.INIT
	THIS.ADDOBJECT('LBLF04','LABEL')
	WITH THIS.LBLF04  
	     .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*7
	     .WIDTH=INT_015*50
         .CAPTION='料品編號'
    ENDWITH  
    THIS.ADDOBJECT('LBLF041','LABEL')
    WITH THIS.LBLF041
         .VISIBLE=.T.
         .LEFT=INT_015*326
	     .TOP=INT_015*7
	     .autosize=.t.
	ENDWITH     
    THIS.ADDOBJECT('LBLF17','LABEL')
    WITH THIS.LBLF17
         .VISIBLE=.T.
	     .LEFT=INT_015*14
	     .TOP=INT_015*31
	     .WIDTH=INT_015*50
	     .CAPTION='客戶品號'
	ENDWITH     
    THIS.ADDOBJECT('LBLF15','Label')
    WITH THIS.LBLF15
         .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*56
         .WIDTH=INT_015*50
         .CAPTION='計價數量'         
    ENDWITH     
 
    THIS.ADDOBJECT('LBLF16','LABEL')
    WITH THIS.LBLF16
         .VISIBLE=.T.    
         .LEFT=INT_015*14
         .TOP=INT_015*81
         .WIDTH=INT_015*50
         .CAPTION='無價數量'       
    ENDWITH        
    THIS.ADDOBJECT('LBLF07','LABEL')      
    WITH THIS.LBLF07
         .VISIBLE=.T.       
         .LEFT=INT_015*14
         .TOP=INT_015*106
         .WIDTH=INT_015*50
         .CAPTION='單        價'
    ENDWITH     
    THIS.ADDOBJECT('LBLF131','LABEL')      
    WITH THIS.LBLF131
         .LEFT=INT_015*190
         .TOP=INT_015*106
         .WIDTH=INT_015*134
         .WORDWRAP=.T.
         .BACKSTYLE=0
         .caption=''                      
         .VISIBLE=.T.
    ENDWITH         
    THIS.ADDOBJECT('LBLF08','LABEL')
    WITH THIS.LBLF08
         .VISIBLE=.T.           
         .LEFT=INT_015*14
         .TOP=INT_015*131
         .WIDTH=INT_015*50
         .CAPTION='金額小計'
    ENDWITH  
    THIS.ADDOBJECT('LBLF081','LABEL')    
    WITH THIS.LBLF081
         .VISIBLE=.T.           
         .LEFT=INT_015*66
         .TOP=INT_015*131
         .AUTOSIZE=.T.
    ENDWITH     
    THIS.ADDOBJECT('LBLF11','LABEL')
    WITH THIS.LBLF11
        .VISIBLE=.T.           
        .LEFT=INT_015*328
        .TOP=INT_015*31
        .WIDTH=INT_015*50
        .CAPTION='已排數量'         
    ENDWITH    
    THIS.ADDOBJECT('LBLF111','LABEL')
    WITH THIS.LBLF111
        .VISIBLE=.T.           
        .LEFT=INT_015*380
        .TOP=INT_015*31
        .AUTOSIZE=.T.
    ENDWITH    
    THIS.ADDOBJECT('LBLF18','LABEL')
    WITH THIS.LBLF18
         .VISIBLE=.T.           
         .LEFT=INT_015*328
         .TOP=INT_015*56
         .WIDTH=INT_015*50
         .CAPTION='計價已出'
    ENDWITH     
    THIS.ADDOBJECT('LBLF181','LABEL')
    WITH THIS.LBLF181
         .VISIBLE=.T.           
         .LEFT=INT_015*380
         .TOP=INT_015*56
         .AUTOSIZE=.T.
    ENDWITH     
    THIS.ADDOBJECT('LBLF19','LABEL')
    WITH THIS.LBLF19
         .VISIBLE=.T.           
         .LEFT=INT_015*328
         .TOP=INT_015*81
         .WIDTH=INT_015*50
         .CAPTION='無價已出'               
    ENDWITH  
    THIS.ADDOBJECT('LBLF191','LABEL')
    WITH THIS.LBLF191
         .VISIBLE=.T.           
         .LEFT=INT_015*380
         .TOP=INT_015*81
         .AUTOSIZE=.T.
    ENDWITH      
    THIS.ADDOBJECT('LBLF21','LABEL')
    WITH THIS.LBLF21
         .VISIBLE=.T.           
         .LEFT=INT_015*328
         .TOP=INT_015*106
         .WIDTH=INT_015*50
         .CAPTION='取消數量'                           
    ENDWITH     
    THIS.ADDOBJECT('LBLF211','LABEL')
    WITH THIS.LBLF211
         .VISIBLE=.T.           
         .LEFT=INT_015*380
         .TOP=INT_015*106
         .AUTOSIZE=.T.
    ENDWITH             
    THIS.ADDOBJECT('LBLF12','LABEL')
    WITH THIS.LBLF12
         .VISIBLE=.T.           
         .LEFT=INT_015*328
         .TOP=INT_015*131
         .WIDTH=INT_015*50
         .CAPTION='安全資料'                           
    ENDWITH     
    THIS.ADDOBJECT('LBLF121','LABEL')
    WITH THIS.LBLF121
         .VISIBLE=.T.           
         .LEFT=INT_015*380
         .TOP=INT_015*131
         .AUTOSIZE=.T.
    ENDWITH         
    THIS.ADDOBJECT('LBLDLVD','LABEL')
    WITH THIS.LBLDLVD
         .VISIBLE=.T.           
         .LEFT=INT_015*14
         .TOP=INT_015*156
         .WIDTH=INT_015*50
         .CAPTION='交        期'
    ENDWITH       
   THIS.ADDOBJECT('RTGBOX','EDITBOX')&&文書編輯EDITBOX
      WITH THIS.RTGBOX
          .LEFT=INT_015*65
         .TOP=INT_015*152
         .WIDTH=INT_015*380
         .HEIGHT=INT_015*48
         .FONTSIZE=INT_015*8
         .VISIBLE=.T.
         .READONLY=.T.
         .MAXLENGTH=600
         .NAME='RTGBOX'           
    ENDWITH             
	THIS.ADDOBJECT('TXTF04','TXTF04')
	WITH THIS.TXTF04      
	     .VISIBLE=.T.
	     .LEFT=INT_015*65
	     .TOP=INT_015*2
	     .WIDTH=INT_015*261
	     .HEIGHT=INT_015*25
	     .MAXLENGTH=43
	     .NAME='TXTF04'  
	ENDWITH     
	THIS.ADDOBJECT('TXTF17','TEXTBOX')
	WITH THIS.TXTF17
	     .VISIBLE=.T.
	     .LEFT=INT_015*65
	     .TOP=INT_015*27
	     .WIDTH=INT_015*261
	     .HEIGHT=INT_015*25
	     .MAXLENGTH=30
	     .NAME='TXTF17'	    
	ENDWITH     
    THIS.ADDOBJECT('TXTF15','TEXTBOX')
    WITH THIS.TXTF15
         .VISIBLE=.T.           
         .LEFT=INT_015*65
         .TOP=INT_015*52
         .WIDTH=INT_015*100
         .INPUTMASK='999999999999'
         .ALIGNMENT=3                  
         .NAME='TXTF15'
    ENDWITH     
    THIS.ADDOBJECT('TXTF16','TEXTBOX')
    WITH THIS.TXTF16
         .VISIBLE=.T.           
         .LEFT=INT_015*65
         .TOP=INT_015*77
         .WIDTH=INT_015*100
         .HEIGHT=INT_015*25
         .INPUTMASK='999999999999'
         .ALIGNMENT=3         
         .NAME='TXTF16'                            
    ENDWITH     
    THIS.ADDOBJECT('TXTF07','TEXTBOX')
    WITH THIS.TXTF07     
         .VISIBLE=.T.           
         .LEFT=INT_015*65
         .TOP=INT_015*103
         .WIDTH=INT_015*100
         .INPUTMASK='9999999.999999'
         .ALIGNMENT=3
         .NAME='TXTF07'
    ENDWITH     
    THIS.ADDOBJECT('TXTF13','TXTF13')
    WITH THIS.TXTF13     
         .VISIBLE=.T.           
         .LEFT=INT_015*166
         .TOP=INT_015*103
         .WIDTH=INT_015*20
         .MAXLENGTH=1
         .NAME='TXTF13'
         .BACKCOLOR=RGB(255,255,100)
         .MOUSEPOINTER=99
         .MOUSEICON='BMPS\harrow.cur'                  
    ENDWITH         
    THIS.ADDOBJECT('CMB1','CMB1')
    WITH THIS.CMB1
         .LEFT=INT_015*168
         .TOP=INT_015*103
         .HEIGHT=INT_015*25
         .NAME='CMB1'
    ENDWITH
    THIS.ADDOBJECT('CMB2','CMB2')
    WITH THIS.CMB2
         .LEFT=INT_015*228
         .TOP=INT_015*103
         .HEIGHT=INT_015*25
         .NAME='CMB2'
    ENDWITH
  ENDPROC       
  PROCEDURE PAGEFRAME1.PAGE1.activate
     R=0
      SELE C03
     IF THISFORM.SHRGROUP.VISIBLE=.F.
        THISFORM.GRID1.ENABLED=.T.   
        THISFORM.GRID1.SETFOCUS 
        THISFORM.KEY_LIST.ENABLED=.T.
     ELSE
       THISFORM.KEY_LIST.ENABLED=.F.   
     ENDIF                  
    IF THISFORM.GRID1.ACTIVEROW=0 .AND. thisform.SHRGROUP.ENABLED=.F.
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
        THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
        THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
        THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
        THISFORM.TRN_BOTT.ENABLED=.F.
        THISFORM.PAGEFRAME1.PAGE1.SETALL('VALUE','','TEXTBOX')        
        THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE=''
        THISFORM.PAGEFRAME1.PAGE1.TXTF15.VALUE=''
        THISFORM.PAGEFRAME1.PAGE1.LBLF041.CAPTION=''
        THISFORM.PAGEFRAME1.PAGE1.LBLF241.CAPTION=''
        THISFORM.PAGEFRAME1.PAGE1.TXTF03.VALUE=''
        THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE=''
        THISFORM.PAGEFRAME1.PAGE1.TXTF12.VALUE=''
        THISFORM.PAGEFRAME1.PAGE1.LBLF031.CAPTION=''
        THISFORM.PAGEFRAME1.PAGE1.LBLF071.CAPTION=''
        THISFORM.PAGEFRAME1.PAGE1.LBLF151.CAPTION=''
        THISFORM.PAGEFRAME1.PAGE1.LBLF101.CAPTION=''  
        THISFORM.PAGEFRAME1.PAGE2.ENABLED=.F.      
     ELSE
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.
        THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  &&判斷有無修改的權限
        THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)   .AND. C03.F11=0 &&判斷有無刪除的權限
        THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限        
        THISFORM.PAGEFRAME1.PAGE2.ENABLED=.T.
        
     ENDIF   
     THISFORM.ANS_BOTT.ENABLED=.F.
     THISFORM.RCC_BOTT.ENABLED=.F.
  ENDPROC
  PROCEDURE PAGEFRAME1.PAGE2.activate
       SELE C04 
     IF THISFORM.SHRGROUP.ENABLED=.F.
        THISFORM.GRID2.READONLY=.T.       
        THISFORM.GRID2.SETFOCUS   
        THISFORM.ANS_BOTT.ENABLED=.T.
        THISFORM.RCC_BOTT.ENABLED=IIF(C04.F09>0,.T.,.F.)
     ENDIF  
     IF THISFORM.GRID2.ACTIVEROW=0 .and. thisform.SHRGROUP.ENABLED=.F.
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
        THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
        THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
        THISFORM.PAGEFRAME1.PAGE2.SETALL('VALUE','','TEXTBOX')
        THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE=''
        THISFORM.PAGEFRAME1.PAGE2.TXTF17.VALUE=''
        THISFORM.PAGEFRAME1.PAGE2.LBLF081.CAPTION='0'
        THISFORM.PAGEFRAME1.PAGE2.LBLF121.CAPTION=''
        THISFORM.PAGEFRAME1.PAGE2.RTGBOX.VALUE=''
        THISFORM.ANS_BOTT.ENABLED=.F.
        THISFORM.RCC_BOTT.ENABLED=.F.
        THISFORM.TRN_BOTT.ENABLED=.F.
     ELSE
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.
        THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  &&判斷有無修改的權限
        THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)  .AND. C04.F11=0 &&判斷有無刪除的權限
        THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限  
     ENDIF   
     R=RECNO('&AREA1')
     THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(RECNO('&AREA1')=R,RGB(255,255,0),'')","COLUMN")
     THISFORM.GRID1.ENABLED=.F.     
     THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.)   &&判斷有無新增的權限
     THISFORM.TRN_BOTT.ENABLED=(C03.F15>'1') AND (C04.F10-C04.F23>0)
     THISFORM.KEY_LIST.ENABLED=.F.     
  ENDPROC   
  
  PROC INIT      
      SELE C03
      COD=SYS(21)
      GO BOTTOM   
       THISFORM.PAGEFRAME1.PAGE1.FONTSIZE=INT_015*9
       THISFORM.PAGEFRAME1.PAGE2.FONTSIZE=INT_015*9    
       THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.)   &&判斷有無新增的權限
       THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限  
       THISFORM.PAGEFRAME1.PAGE1.LBLF04.VISIBLE=!EMPTY(A02.F10)      &&判斷能否查看單價       
       THISFORM.PAGEFRAME1.PAGE1.LBLF041.VISIBLE=!EMPTY(A02.F10)
       THISFORM.PAGEFRAME1.PAGE2.LBLF07.VISIBLE=!EMPTY(A02.F10)
       THISFORM.PAGEFRAME1.PAGE2.TXTF07.VISIBLE=!EMPTY(A02.F10)
       THISFORM.PAGEFRAME1.PAGE2.LBLF08.VISIBLE=!EMPTY(A02.F10)
       THISFORM.PAGEFRAME1.PAGE2.LBLF081.VISIBLE=!EMPTY(A02.F10)
       thisform.setall('height',INT_015*25,'textbox')
       thisform.setall('height',INT_015*17,'label')
       thisform.setall('FONTSIZE',INT_015*9,'textbox')
       thisform.setall('FONTSIZE',INT_015*9,'label')       
       THISFORM.SETALL('READONLY',.T.,'TEXTBOX')
       THISFORM.PAGEFRAME1.PAGE2.LBLF131.HEIGHT=75                           
       THISFORM.SHRGROUP.VISIBLE=.F.
       THISFORM.SHRGROUP.ENABLED=.F.
       thisform.GRID1.setall('FONTSIZE',INT_015*9,'COLUMN')
       thisform.GRID1.setall('FONTSIZE',INT_015*9,'HEADER')      
       THISFORM.GRID1.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)
       THISFORM.GRID2.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)   
       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='訂單編號'
       THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='客戶編號'
       THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='客戶簡稱'
       THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='客戶單號'
       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='C03.F02'
       THISFORM.GRID1.COLUMN2.CONTROLSOURCE='C03.F03'
       THISFORM.GRID1.COLUMN3.CONTROLSOURCE='C01.F05'
       THISFORM.GRID1.COLUMN4.CONTROLSOURCE='C03.F14'
       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*81
       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*49
       THISFORM.GRID1.COLUMN3.WIDTH=INT_015*68
       THISFORM.GRID1.COLUMN4.WIDTH=INT_015*115
       thisform.GRID2.setall('FONTSIZE',INT_015*9,'COLUMN')
       thisform.GRID2.setall('FONTSIZE',INT_015*9,'HEADER')        
       THISFORM.grid2.COLUMN1.HEADER1.CAPTION='料品編號'
       THISFORM.grid2.COLUMN2.HEADER1.CAPTION='品名規格'
	   THISFORM.grid2.COLUMN3.HEADER1.CAPTION='計價數量'
	   THISFORM.grid2.COLUMN4.HEADER1.CAPTION='無價數量'
	   THISFORM.grid2.COLUMN5.HEADER1.CAPTION='已出數量'
	   THISFORM.grid2.COLUMN6.HEADER1.CAPTION='已排數量'
	   THISFORM.grid2.COLUMN7.HEADER1.CAPTION='取消數量'
	   THISFORM.grid2.COLUMN1.CONTROLSOURCE='C04.F04'
	   THISFORM.grid2.COLUMN2.CONTROLSOURCE='C04.F25'
	   THISFORM.grid2.COLUMN3.CONTROLSOURCE='C04.F15'
	   THISFORM.grid2.COLUMN4.CONTROLSOURCE='C04.F16'
	   THISFORM.grid2.COLUMN5.CONTROLSOURCE='C04.F09'
	   THISFORM.grid2.COLUMN6.CONTROLSOURCE='C04.F11'
	   THISFORM.grid2.COLUMN7.CONTROLSOURCE='C04.F21'
	   THISFORM.grid2.COLUMN1.WIDTH=INT_015*149
	   THISFORM.GRID2.COLUMN2.WIDTH=INT_015*100
       THISFORM.grid2.COLUMN3.WIDTH=INT_015*100
       THISFORM.GRID2.COLUMN4.WIDTH=INT_015*100
       THISFORM.GRID2.COLUMN5.WIDTH=INT_015*100
       THISFORM.GRID2.COLUMN6.WIDTH=INT_015*100
       THISFORM.GRID2.COLUMN7.WIDTH=INT_015*135
       IF A02.F11='*'
          THISFORM.GRID2.SETALL("DYNAMICBACKCOLOR","IIF((C04.F07*C00.F02-B01.F37)/(C04.F07*C00.F02)<0.08,RGB(255,0,0),'')","COLUMN")        
       ENDIF                
       THISFORM.grid1.READONLY=.T.       
       THISFORM.grid2.READONLY=.T.    
       THISFORM.grid1.SETFOCUS
       IF THISFORM.GRID1.ACTIVEROW=0
          THISFORM.CMDGROUP.ENABLED=.F.
          THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
          THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
          THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
          THISFORM.TRN_BOTT.ENABLED=.F.
       ELSE
          THISFORM.CMDGROUP.ENABLED=.T.      
          THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  &&判斷有無修改的權限
          THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)   .AND. C03.F11=0 &&判斷有無刪除的權限
          THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限 
          THISFORM.TRN_BOTT.ENABLED=IIF(C03.F11=0,.T.,.F.) .AND. !C03.F08  .AND. C03.F11=0
       ENDIF          
       THISFORM.KEY_LIST.DISPLAYVALUE='依訂單編號排列'       
       JK='訂單編號'
       SELE C03
       THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE=C03.F02
  ENDPROC                  
  PROC KEY_LIST.INIT 
       with this 
           .additem('依訂單編號排列')
           .additem('依客戶單號排列')
           .additem('依客戶編號排列')
       endwith      
  ENDPROC 
  PROC KEY_LIST.INTERACTIVECHANGE                 
       SELE C03 
       DO CASE
          CASE THIS.DISPLAYVALUE='依訂單編號排列'
               set order to c031 
               THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='訂單編號'
               THISFORM.GRID1.COLUMN1.CONTROLSOURCE='C03.F02'
               THISFORM.GRID1.COLUMN1.WIDTH=INT_015*81
               THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='客戶編號'
               THISFORM.GRID1.COLUMN2.CONTROLSOURCE='C03.F03'
               THISFORM.GRID1.COLUMN2.WIDTH=INT_015*49
               THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='客戶簡稱'
               THISFORM.GRID1.COLUMN3.CONTROLSOURCE='C01.F05'
               THISFORM.GRID1.COLUMN3.WIDTH=INT_015*68
               THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='客戶單號'
               THISFORM.GRID1.COLUMN4.CONTROLSOURCE='C03.F14'
               THISFORM.GRID1.COLUMN4.WIDTH=INT_015*115               
          CASE THIS.DISPLAYVALUE='依客戶單號排列'
               set order to c032
               THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='客戶單號'
               THISFORM.GRID1.COLUMN1.CONTROLSOURCE='C03.F14'
               THISFORM.GRID1.COLUMN1.WIDTH=INT_015*115
               THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='客戶編號'
               THISFORM.GRID1.COLUMN2.CONTROLSOURCE='C03.F03'
               THISFORM.GRID1.COLUMN2.WIDTH=INT_015*49
               THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='客戶簡稱'
               THISFORM.GRID1.COLUMN3.CONTROLSOURCE='C01.F05'
               THISFORM.GRID1.COLUMN3.WIDTH=INT_015*68               
               THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='訂單編號'
               THISFORM.GRID1.COLUMN4.CONTROLSOURCE='C03.F02'
               THISFORM.GRID1.COLUMN4.WIDTH=INT_015*81      
          CASE THIS.DISPLAYVALUE='依客戶編號排列'
               set order to c033
               THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='客戶編號'
               THISFORM.GRID1.COLUMN1.CONTROLSOURCE='C03.F03'
               THISFORM.GRID1.COLUMN1.WIDTH=INT_015*49
               THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='客戶簡稱'
               THISFORM.GRID1.COLUMN2.CONTROLSOURCE='C01.F05'
               THISFORM.GRID1.COLUMN2.WIDTH=INT_015*68
               THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='訂單編號'
               THISFORM.GRID1.COLUMN3.CONTROLSOURCE='C03.F02'
               THISFORM.GRID1.COLUMN3.WIDTH=INT_015*81                                                   
               THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='客戶單號'
               THISFORM.GRID1.COLUMN4.CONTROLSOURCE='C03.F14'
               THISFORM.GRID1.COLUMN4.WIDTH=INT_015*115                              
       ENDCASE 
       COD=SYS(21)
        *SELE &AREA1
        THISFORM.grid1.SETFOCUS
  ENDPROC      
  PROC grid1.AFTERROWCOLCHANGE
       LPARAMETERS nColIndex
       THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE=C03.F02
       THISFORM.PAGEFRAME1.PAGE1.TXTF15.VALUE=C03.F15
       THISFORM.PAGEFRAME1.PAGE1.TXTF14.VALUE=C03.F14
       THISFORM.PAGEFRAME1.PAGE1.TXTF03.VALUE=C03.F03
       THISFORM.PAGEFRAME1.PAGE1.LBLF031.CAPTION=C01.F04
       THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE=C03.F07
       THISFORM.PAGEFRAME1.PAGE1.LBLF071.CAPTION=A01.F03
       THISFORM.PAGEFRAME1.PAGE1.LBLF151.CAPTION=ICASE(C03.F15='3','空頭訂單',C03.F15='2','預購訂單','正式訂單')
       THISFORM.PAGEFRAME1.PAGE1.TXTF06.VALUE=C03.F06
       THISFORM.PAGEFRAME1.PAGE1.TXTF09.VALUE=C03.F09
       THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=C03.F01
       THISFORM.PAGEFRAME1.PAGE1.TXTF05.VALUE=C03.F05
       THISFORM.PAGEFRAME1.PAGE1.TXTF13.VALUE=C03.F13
       THISFORM.PAGEFRAME1.PAGE1.TXTF12.VALUE=C03.F12
       THISFORM.PAGEFRAME1.PAGE1.lblf041.caption=transform(C03.F04,'99999999999.99')
       THISFORM.PAGEFRAME1.PAGE1.lblf241.caption=C01.F24
       THISFORM.PAGEFRAME1.PAGE1.lblf101.caption=C03.F10
       DONBIN=C01.F45
       THISFORM.TRN_BOTT.ENABLED=IIF(C03.F11=0,.T.,.F.) .AND. !C03.F08 
       THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)  .AND. C04.F11=0 &&判斷有無刪除的權限               
       FCH=THISFORM.ACTIVECONTROL.NAME
       JK=THIS.COLUMN1.HEADER1.CAPTION  
       IF THIS.ACTIVEROW=0
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
       ELSE
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.
       ENDIF   
       CHK=''     
  ENDPROC     
  PROC grid2.AFTERROWCOLCHANGE
       LPARAMETERS nColIndex       
       THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE=F04
       THISFORM.PAGEFRAME1.PAGE2.LBLF041.CAPTION=C04.F25
       THISFORM.PAGEFRAME1.PAGE2.TXTF17.VALUE=F17       
       THISFORM.PAGEFRAME1.PAGE2.TXTF15.VALUE=F15
       THISFORM.PAGEFRAME1.PAGE2.TXTF16.VALUE=F16
       THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE=F07
       THISFORM.PAGEFRAME1.PAGE2.TXTF13.VISIBLE=!EMPTY(F13)
       THISFORM.PAGEFRAME1.PAGE2.TXTF13.VALUE=F13              
       THISFORM.PAGEFRAME1.PAGE2.LBLF081.CAPTION=TRANSFORM(F08,'999999999.99')
       THISFORM.PAGEFRAME1.PAGE2.LBLF111.CAPTION=TRANSFORM(F11,'999999999.99')
       THISFORM.PAGEFRAME1.PAGE2.LBLF181.CAPTION=TRANSFORM(F18,'999999999.99')
       THISFORM.PAGEFRAME1.PAGE2.LBLF191.CAPTION=TRANSFORM(F19,'999999999.99')
       THISFORM.PAGEFRAME1.PAGE2.LBLF211.CAPTION=TRANSFORM(F21,'999999999.99')
       THISFORM.PAGEFRAME1.PAGE2.LBLF121.CAPTION=F12
       THISFORM.PAGEFRAME1.PAGE2.LBLF131.CAPTION=C21.F05              
       THISFORM.PAGEFRAME1.PAGE2.RTGBOX.VALUE=ALLTRIM(DELIVER(F03,F04))
       THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)  .AND. C04.F11=0 &&判斷有無刪除的權限       
       FCH=THISFORM.ACTIVECONTROL.NAME
       JK=THIS.COLUMN1.HEADER1.CAPTION
       CHK=THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE
       if thisform.pageframe1.activepage=1
          thisform. CMDGROUP.SEEK_BOTT.ENABLED=.F.
       ENDIF   
       THISFORM.TRN_BOTT.ENABLED=(C03.F15>'1') AND (C04.F10-C04.F23>0) AND THISFORM.PAGEFRAME1.ACTIVEPAGE=2
       THISFORM.ANS_BOTT.ENABLED=.T.
       THISFORM.RCC_BOTT.ENABLED=IIF(C04.F09>0,.T.,.F.)
  ENDPROC 
  PROCEDURE ORPGROUP.NEW_BOTT.CLICK    
    THISFORM.KEY_LIST.ENABLED=.F. 
    THISFORM.TRN_BOTT.ENABLED=.F.    
    IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1       
       THISFORM.GRID2.RECORDSOURCE=''
       THISFORM.GRID2.CHILDORDER=''
       THISFORM.PAGEFRAME1.PAGE1.SETALL('READONLY',.F.,'TEXTBOX')     &&處理表頭新增
       THISFORM.GRID1.ENABLED=.F.   
       THISFORM.GRID2.ENABLED=.F.   
       IF INT_013=.T.
          HD='C001 '+SUBSTR(DTOS(DATE()),3,4)
          HD1='C001 '
          HD2='CA'
          HD3='業務訂單'
          IF !USED('A09')
             SELE 0
             USE A09
          ELSE
             SELE A09
          ENDIF
          SET ORDER TO A091
          A24='A24'+LEFT(DTOS(DATE()),6)
          IF !USED('&A24')
             SELE 0
             USE (A24) ALIA A24
          ELSE
            SELE A24
          ENDIF
          SET ORDER TO 1      
          DO ODR_CRT    &&執行主程式中之單據新增
          SELECT A24
          USE 
          SELECT A09
          USE
          THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE=PO_NO
          THISFORM.PAGEFRAME1.PAGE1.TXTF02.REFRESH
          thisform.PAGEFRAME1.PAGE1.txtf02.readonly=.t.
          THISFORM.PAGEFRAME1.PAGE1.TXTF14.SETFOCUS
       ELSE
          THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE=''
          THISFORM.PAGEFRAME1.PAGE1.TXTF02.SETFOCUS   
       ENDIF           
        THISFORM.PAGEFRAME1.PAGE2.ENABLED=.F.
        THISFORM.PAGEFRAME1.PAGE1.TXTF03.READONLY=.F.
        THISFORM.PAGEFRAME1.PAGE1.TXTF07.READONLY=.F.        
        THISFORM.PAGEFRAME1.PAGE1.ODR_TYPE.VISIBLE=.T.
        THISFORM.PAGEFRAME1.PAGE1.ODR_TYPE.VALUE=1
        THISFORM.PAGEFRAME1.PAGE1.CRCY.VISIBLE=.T.
        THISFORM.PAGEFRAME1.PAGE1.CRCY.DISPLAYVALUE=INT_011
        THISFORM.PAGEFRAME1.PAGE1.TXTF14.VALUE=''    
        THISFORM.PAGEFRAME1.PAGE1.TXTF15.VALUE='1'
        THISFORM.PAGEFRAME1.PAGE1.TXTF03.VALUE=''
        THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE=''
        THISFORM.PAGEFRAME1.PAGE1.TXTF06.VALUE=''
        THISFORM.PAGEFRAME1.PAGE1.TXTF09.VALUE=''
        THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=DATE()
        THISFORM.PAGEFRAME1.PAGE1.TXTF05.VALUE=DATE()
        THISFORM.PAGEFRAME1.PAGE1.TXTF12.VALUE=THISFORM.PAGEFRAME1.PAGE1.CRCY.DISPLAYVALUE        
        
        THISFORM.PAGEFRAME1.PAGE1.TXTF13.VALUE=''        
        THISFORM.PAGEFRAME1.PAGE1.LBLF031.CAPTION=''
        THISFORM.PAGEFRAME1.PAGE1.LBLF041.CAPTION=''
        THISFORM.PAGEFRAME1.PAGE1.LBLF241.CAPTION=''
        THISFORM.PAGEFRAME1.PAGE1.LBLF071.CAPTION=''
        THISFORM.PAGEFRAME1.PAGE1.LBLF151.CAPTION=''        
        THISFORM.PAGEFRAME1.PAGE1.LBLF101.CAPTION=''
     ELSE
        THISFORM.PAGEFRAME1.PAGE1.ENABLED=.F.              &&處理表身新增
        THISFORM.GRID2.ENABLED=.F.   
        THISFORM.ANS_BOTT.ENABLED=.F.
        THISFORM.RCC_BOTT.ENABLED=.F.
        THISFORM.PAGEFRAME1.PAGE2.CMB1.VISIBLE=.F. 
        THISFORM.PAGEFRAME1.PAGE2.SETALL('READONLY',.F.,'TEXTBOX')        
        THISFORM.PAGEFRAME1.PAGE2.TXTF04.READONLY=.F.
        THISFORM.PAGEFRAME1.PAGE2.TXTF04.SETFOCUS
        THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE=''          
        THISFORM.PAGEFRAME1.PAGE2.lblF041.caption=''          
        THISFORM.PAGEFRAME1.PAGE2.TXTF17.VALUE=''
        THISFORM.PAGEFRAME1.PAGE2.TXTF15.VALUE=0
        THISFORM.PAGEFRAME1.PAGE2.TXTF16.VALUE=0
        THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE=0
        THISFORM.PAGEFRAME1.PAGE2.TXTF07.READONLY=EMPTY(A02.F09)
        THISFORM.PAGEFRAME1.PAGE2.TXTF13.READONLY=.F.                    
        THISFORM.PAGEFRAME1.PAGE2.TXTF13.VALUE=SPACE(1)             
        THISFORM.PAGEFRAME1.PAGE2.LBLF081.CAPTION=TRANSFORM(0,'9999999999.99')
        THISFORM.PAGEFRAME1.PAGE2.LBLF111.CAPTION=TRANSFORM(0,'9999999999.99')
        THISFORM.PAGEFRAME1.PAGE2.LBLF181.CAPTION=TRANSFORM(0,'9999999999.99')
        THISFORM.PAGEFRAME1.PAGE2.LBLF191.CAPTION=TRANSFORM(0,'9999999999.99')
        THISFORM.PAGEFRAME1.PAGE2.LBLF211.CAPTION=TRANSFORM(0,'9999999999.99')
        THISFORM.PAGEFRAME1.PAGE2.LBLF121.CAPTION=''
        THISFORM.PAGEFRAME1.PAGE2.LBLF131.CAPTION=''                
        THISFORM.PAGEFRAME1.PAGE2.RTGBOX.VALUE=''
     ENDIF   

  ENDPROC  
  PROCEDURE ORPGROUP.EDIT_BOTT.CLICK
     THISFORM.KEY_LIST.ENABLED=.F. 
     THISFORM.GRID1.ENABLED=.F.   
     THISFORM.GRID2.ENABLED=.F.   
     THISFORM.TRN_BOTT.ENABLED=.F.
     IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
        SELE C03
        LOCK()
        IF !RLOCK()
           DO file_impact
           THISFORM.SHRGROUP.ABANDON_BOTT.CLICK
        ELSE
           THISFORM.PAGEFRAME1.PAGE1.SETALL('READONLY',.F.,'TEXTBOX')     &&處理表頭修改
           THISFORM.PAGEFRAME1.PAGE1.TXTF02.READONLY=.T.
           THISFORM.PAGEFRAME1.PAGE1.TXTF03.READONLY=.T.
           THISFORM.PAGEFRAME1.PAGE1.TXTF15.READONLY=.T.
           THISFORM.PAGEFRAME1.PAGE1.TXTF13.READONLY=EMPTY(A02.F11)
           THISFORM.PAGEFRAME1.PAGE1.TXTF14.READONLY=!(INT_159)
           THISFORM.PAGEFRAME1.PAGE1.TXTF07.READONLY=.F.
           THISFORM.PAGEFRAME1.PAGE1.CRCY.DISPLAYVALUE=THISFORM.PAGEFRAME1.PAGE1.TXTF12.VALUE
           THISFORM.PAGEFRAME1.PAGE1.CRCY.VISIBLE=.T.
           THISFORM.PAGEFRAME1.PAGE2.ENABLED=.F.
           THISFORM.PAGEFRAME1.PAGE1.TXTF07.SETFOCUS
        endif   
     ELSE                                                                &&處理表身修改
        THISFORM.PAGEFRAME1.PAGE1.ENABLED=.F.         
        SELE C04
        IF F23>0
           =MESSAGEBOX('此筆已有開單未過帳之出貨單,不能修改!',0+64,'提示訊息視窗')
           THISFORM.SHRGROUP.ABANDON_BOTT.CLICK
           return
        endif   
        LOCK()
        IF !RLOCK()
           DO file_impact 
           THISFORM.SHRGROUP.ABANDON_BOTT.CLICK
        ELSE  
           THISFORM.PAGEFRAME1.PAGE2.SETALL('READONLY',.F.,'TEXTBOX') 
           THISFORM.PAGEFRAME1.PAGE2.TXTF07.READONLY=EMPTY(A02.F09)          
           THISFORM.PAGEFRAME1.PAGE2.TXTF13.READONLY=.F.                         
           THISFORM.PAGEFRAME1.PAGE2.TXTF17.SETFOCUS  
           THISFORM.PAGEFRAME1.PAGE2.CMB1.VISIBLE=SEEK(DONBIN+C04.F04+C03.F12,'C02')   
           THISFORM.PAGEFRAME1.PAGE2.CMB2.VISIBLE=SEEK(DONBIN+C04.F04+C03.F12,'C02')      
           THISFORM.ANS_BOTT.ENABLED=.F.
           THISFORM.RCC_BOTT.ENABLED=.F.
       endif        
     ENDIF   
  endproc    
  PROC ORPGROUP.DEL_BOTT.CLICK                    &&刪除資料程序
       IF messagebox('是否確定要刪除此筆資料',4+32+256,'請確認') = 6	        
          if ALIA()='C03'           &&刪除整張訂單
             SELE C03
             IF F08=.T.
                =MESSAGEBOX('此張訂單已有出貨行為無法整張刪除!',0+64,'提示訊息視窗')              
                RETURN
             ENDIF
             IF F11>0
                =MESSAGEBOX('此張訂單已有請購單或製令無法整張刪除!',0+64,'提示訊息視窗')              
                RETURN
             ENDIF   
                PO_NO=C03.F02
                SELE RECNO() FROM C05 WHERE C05.F01=C03.F02 INTO ARRAY BK1
                JJ1=''                
                IF _TALLY>0                   
                    FOR I= 1 TO ALEN(BK1)
                        JJ1=JJ1+ALLTRIM(STR(BK1(I)))+','
                    ENDFOR  
                    KK1=STUFF(JJ1,RAT(',',JJ1,1),1,'')
                    RLOCK(KK1,'C05')
                    LL1=RLOCK(KK1,'C05')
                ELSE
                   LL1=.T.   
                ENDIF   
                SELE RECNO() FROM C04 WHERE C04.F03=C03.F02  INTO ARRAY BK2              
                JJ2=''                
                IF _TALLY>0   
                   FOR I= 1 TO ALEN(BK2)
                       JJ2=JJ2+ALLTRIM(STR(BK2(I)))+','
                   ENDFOR    
                   KK2=STUFF(JJ2,RAT(',',JJ2,1),1,'')              
                   RLOCK(KK2,'C04')
                   LL2=RLOCK(KK2,'C04')
                ELSE
                   LL2=.T.   
                ENDIF   
                IF RLOCK('C03') .AND. LL1 .AND. LL2=.T.
                   SELECT C05    &&計算MRP檔的最後預期結餘量
                   SEEK C03.F02
                   IF FOUND()
                      DO WHILE F01=C03.F02
                         SELECT E08
                         SEEK C05.F02
                         IF FOUND()
                            REPLACE F20 WITH F20+C05.F04
                         ELSE
                            APPEND BLANK
                            REPLACE F01 WITH C05.F03
                            REPLACE F02 WITH C05.F02
                            REPLACE F20 WITH C05.F04
                         ENDIF
                         SELECT C05
                         SKIP
                      ENDDO
                   ENDIF
                   DELE FROM C05 WHERE C05.F01=C03.F02
                   DELE FROM C04 WHERE C04.F03=C03.F02
                   SELE C03
                   DELE                   
                   SKIP -1
                   IF BOF()
                      GO TOP
                   ENDIF   
                   UNLOCK ALL
                  IF INT_013=.T. .AND. SUBSTR(PO_NO,3,4)=SUBSTR(DTOS(DATE()),3,4)
                     
                        HD='C001 '+SUBSTR(DTOS(DATE()),3,4)+PO_NO
                        HD2='CA'
                        HD3='客戶訂單'
                     A24='A24'+LEFT(DTOS(DATE()),6)
                     IF !USED('&A24')
                        SELE 0
                        USE (A24) ALIA A24
                     ELSE
                        SELE A24
                     ENDIF
                     SET ORDER TO 1      
                     DO ODR_RJT
                     SELECT A24
                     USE 
                  ENDIF  
                ELSE
                   DO file_impact                  
                ENDIF
             
             THISFORM.GRID1.SETFOCUS
             IF THISFORM.GRID1.ACTIVEROW=0
                THISFORM.CMDGROUP.ENABLED=.F.
                THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
                THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.               
                THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
             ELSE      
                THISFORM.CMDGROUP.ENABLED=.T.
                THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  &&判斷有無修改的權限
                THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)   .AND. C03.F11=0 &&判斷有無刪除的權限
                THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限
             ENDIF     
          ELSE        
              SELE C04                                                      &&刪除單筆資料及其出貨計劃   
              IF F09>0 .OR. F23>0
                =MESSAGEBOX('此筆記錄已有出貨行為無法刪除!',0+64,'提示訊息視窗')
                RETURN
              ENDIF
              IF F11>0
                =MESSAGEBOX('此筆記錄已請購或排入製令無法刪除!',0+64,'提示訊息視窗')              
                RETURN
              ENDIF           
                 SELE RECNO() FROM C05 WHERE C05.F01=C04.F03 AND C05.F02=C04.F04 INTO ARRAY BK3 ORDER BY C05.F01,C05.F02 
                 JJ1=''
                 IF _TALLY>0         
                    FOR I= 1 TO ALEN(BK3)
                        JJ1=JJ1+ALLTRIM(STR(BK3(I)))+','
                    ENDFOR    
                    KK1=STUFF(JJ1,RAT(',',JJ1,1),1,'')           
                    RLOCK(KK1,'C05')
                    LL1=RLOCK(KK1,'C05')
                 ELSE
                    LL1=.T.
                 ENDIF      
                 IF RLOCK('C04') .AND. LL1=.T. .AND. RLOCK('C03')       
                    SELECT C05    &&計算MRP檔的最後預期結餘量
                    SEEK C04.F03+C04.F04
                    IF FOUND()
                       DO WHILE F01+F02=C04.F03+C04.F04
                          SELECT E08
                          SEEK C05.F02
                         IF FOUND()
                            REPLACE F20 WITH F20+C05.F04
                         ELSE
                            APPEND BLANK
                            REPLACE F01 WITH C05.F03
                            REPLACE F02 WITH C05.F02
                            REPLACE F20 WITH C05.F04
                         ENDIF
                         SELECT C05
                         SKIP
                      ENDDO
                   ENDIF
                    DELE FROM C05 WHERE C05.F01=C04.F03 AND C05.F02=C04.F04
                    SELECT C03
                    REPLACE F04 WITH F04+C04.F08*(-1)
                    SELE C04
                    DELE
                    SKIP -1
                    IF BOF()
                       GO TOP
                    ENDIF   
                 ELSE
                    DO file_impact                  
                 ENDIF     
              
              THISFORM.GRID2.SETFOCUS
              IF THISFORM.GRID2.ACTIVEROW=0
                 SELE C03
                 PO_NO=C03.F02
                 DELE
                 IF INT_013=.T. .AND. SUBSTR(PO_NO,3,4)=SUBSTR(DTOS(DATE()),3,4)
                      HD='C001 '+SUBSTR(DTOS(DATE()),3,4)+PO_NO
                      HD2='CA'
                      HD3='客戶訂單'              
                 ENDIF
                 SELE C03
                 SKIP -1
                 IF BOF()
                    GO TOP
                 ENDIF                    
                 THISFORM.PAGEFRAME1.ACTIVEPAGE=1 
                 THISFORM.REFRESH          
              ENDIF
          ENDIF
       ENDIF  
       RELEASE ALL LIKE BK* 
  ENDPROC  
  PROCEDURE SHRGROUP.SHURE1_BOTT.CLICK               &&新增確認
    IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
       THISFORM.GRID2.RECORDSOURCE='C04'
       THISFORM.GRID2.CHILDORDER='C041'
	   THISFORM.grid2.COLUMN1.CONTROLSOURCE='C04.F04'
	   THISFORM.grid2.COLUMN2.CONTROLSOURCE='C04.F25'
	   THISFORM.grid2.COLUMN3.CONTROLSOURCE='C04.F15'
	   THISFORM.grid2.COLUMN4.CONTROLSOURCE='C04.F16'
	   THISFORM.grid2.COLUMN5.CONTROLSOURCE='C04.F09'
	   THISFORM.grid2.COLUMN6.CONTROLSOURCE='C04.F11'
	   THISFORM.grid2.COLUMN7.CONTROLSOURCE='C04.F12'       
       SELE C03 
       SET ORDER TO C031
       IF SEEK(THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE,'C03')=.T.     &&單號重複
          IF INT_013=.T.  &&自動編單號
                SELECT MAX(F02) FROM C03 WHERE SUBSTR(F02,3,4)=SUBSTR(DTOS(DATE()),3,4) INTO ARRAY GB NOWAIT                
                HD='C001 '+SUBSTR(DTOS(DATE()),3,4)+THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE
                HD1='C001 '
                HD2='CA'
                HD3='業務訂單'
             IF !USED('A09')
                SELECT 0
                USE A09
             ELSE
                SELECT A09
             ENDIF
             SET ORDER TO 1      
             A24='A24'+LEFT(DTOS(DATE()),6)
             IF !USED('&A24')
                SELE 0
                USE (A24) ALIA A24
             ELSE
                SELE A24
             ENDIF
             SET ORDER TO 1      
             DO ODR_RPT   &&執行主程式中單據編號重複程序
             SELECT A24
             USE
             SELECT A09
             USE
		     THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE=PO_NO
		     THISFORM.PAGEFRAME1.PAGE1.TXTF02.REFRESH                                
          ELSE
             =MESSAGEBOX('訂單編號重複!',0+64,'提示訊息視窗')
             THISFORM.PAGEFRAME1.PAGE1.TXTF02.SETFOCUS
             SET ORDER TO &COD
             RETURN
          ENDIF   
       ENDIF       
       IF SEEK(THISFORM.PAGEFRAME1.PAGE1.TXTF03.VALUE,'C01')=.F. .OR. EMPTY(THISFORM.PAGEFRAME1.PAGE1.TXTF03.VALUE)
          =MESSAGEBOX('客戶基本主檔中無此編號請先建立!',0+64,'提示訊息視窗')
          THISFORM.PAGEFRAME1.PAGE1.TXTF03.SETFOCUS
          SET ORDER TO &COD
          RETURN            
       ENDIF
       IF INT_159=.F. .AND. !EMPTY(THISFORM.PAGEFRAME1.PAGE1.TXTF14.VALUE)
          SELE C03
          LOCATE FOR F14=THISFORM.PAGEFRAME1.PAGE1.TXTF14.VALUE .AND. F03=THISFORM.PAGEFRAME1.PAGE1.TXTF03.VALUE
          IF FOUND()
             =MESSAGEBOX('客戶單號重複!',0+64,'提示訊息視窗')
             THISFORM.PAGEFRAME1.PAGE1.TXTF14.SETFOCUS
             SET ORDER TO &COD
             RETURN
          ENDIF    
       ENDIF       
       IF SEEK(THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE,'A01')=.F.
          =MESSAGEBOX('無此人員編號請重新輸入!',0+64,'提示訊息視窗')
          THISFORM.PAGEFRAME1.PAGE1.TXTF07.SETFOCUS
          SET ORDER TO &COD          
          RETURN
       ENDIF   
       IF EMPTY(THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE)
          =MESSAGEBOX('訂貨日期不得空白!',0+64,'提示訊息視窗') 
          THISFORM.PAGEFRAME1.PAGE1.TXTF02.SETFOCUS
          SET ORDER TO &COD          
          RETURN
       ENDIF   
       IF EMPTY(THISFORM.PAGEFRAME1.PAGE1.TXTF05.VALUE)
          =MESSAGEBOX('交貨日期不得空白!',0+64,'提示訊息視窗') 
          THISFORM.PAGEFRAME1.PAGE1.TXTF02.SETFOCUS
          SET ORDER TO &COD          
          RETURN
       ENDIF        
       IF THISFORM.PAGEFRAME1.PAGE1.TXTF05.VALUE<THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
          =MESSAGEBOX('交貨日期不得小於訂貨日期!',0+64,'提示訊息視窗') 
          THISFORM.PAGEFRAME1.PAGE1.TXTF05.SETFOCUS
          SET ORDER TO &COD          
          RETURN
       ENDIF  
       SELE C03          
       APPEND BLANK
       LOCK()
       IF RLOCK()
          REPLACE F02 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE
          REPLACE F14 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF14.VALUE          
          REPLACE F03 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF03.VALUE
          REPLACE F15 WITH IIF(F03='C6666','2',THISFORM.PAGEFRAME1.PAGE1.TXTF15.VALUE)
          REPLACE F01 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
          REPLACE F05 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF05.VALUE
          REPLACE F06 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF06.VALUE
          REPLACE F07 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE
          REPLACE F09 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF09.VALUE
          REPLACE F10 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')   
          REPLACE F12 WITH THISFORM.PAGEFRAME1.PAGE1.CRCY.DISPLAYVALUE
          REPLACE F13 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF13.VALUE
          DONBIN=IIF(SEEK(F03,'C01'),C01.F45,F03)
       ENDIF
       SEEK THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE
       SET ORDER TO &COD
       THISFORM.PAGEFRAME1.PAGE1.ENABLED=.F.
       THISFORM.PAGEFRAME1.PAGE2.ENABLED=.T.  
       THISFORM.PAGEFRAME1.ACTIVEPAGE=2
       THISFORM.ORPGROUP.NEW_BOTT.CLICK
       THISFORM.REFRESH
    ELSE                         &&表身新增確認
       IF SEEK(THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE,'B01')=.F.
          =MESSAGEBOX('物料基本主檔中無此料號!',0+48,'提示訊息視窗')
          THISFORM.PAGEFRAME1.PAGE2.TXTF04.SETFOCUS
          RETURN
       ENDIF   
       IF SEEK(THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE,'C04')=.T. 
          =MESSAGEBOX('此料號在此張訂單重複!',0+48,'提示訊息視窗')
          THISFORM.PAGEFRAME1.PAGE2.TXTF04.SETFOCUS
          RETURN            
       ENDIF    
       IF THISFORM.PAGEFRAME1.PAGE2.TXTF15.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF16.VALUE<=0
          =MESSAGEBOX('計價量與無價量總合不得小於等於 0 !',0+48,'提示訊息視窗')
          THISFORM.PAGEFRAME1.PAGE2.TXTF15.SETFOCUS
          RETURN
       ENDIF 
       IF C03.F15='1' AND THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE=0
          =MESSAGEBOX('正式訂單銷售單價不可以為 0 !',0+48,'提示訊息視窗')
          THISFORM.PAGEFRAME1.PAGE2.TXTF07.SETFOCUS
          RETURN
       ENDIF
        IF !EMPTY(THISFORM.PAGEFRAME1.PAGE2.TXTF13.VALUE)
           IF !SEEK(DONBIN+THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE+C03.F12+THISFORM.PAGEFRAME1.PAGE2.TXTF13.VALUE,'C21','C211')
              =MESSAGEBOX('無此特價項目!',0+48,'提示訊息視窗')
              THISFORM.PAGEFRAME1.PAGE2.TXTF13.SETFOCUS 
              RETURN                    
           ENDIF
        ENDIF                 
       IF SEEK(THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE,'B0A')=.T.
          =MESSAGEBOX('此料號目前已改為'+IIF(SEEK(THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE,'B0A'),B0A.F02,'')+'請最好改為正式料號,若不改庫存計算仍以正式料號為準',0+48,'提示訊息視窗')
       ENDIF
       SELECT C04
       APPEND BLANK
       LOCK()
       IF RLOCK()
          REPLACE F01 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
          REPLACE F03 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE
          REPLACE F02 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF03.VALUE
          REPLACE F06 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF12.VALUE
          REPLACE F04 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE
          REPLACE F15 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF15.VALUE
          REPLACE F16 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF16.VALUE
          REPLACE F05 WITH F15+F16
          REPLACE F07 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE
          REPLACE F08 WITH F15*F07
          REPLACE F10 WITH F05
          REPLACE F12 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')   
          REPLACE F13 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF13.VALUE                    
          REPLACE F17 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF17.VALUE
          REPLACE F22 WITH F07      
          REPLACE F25 WITH THISFORM.PAGEFRAME1.PAGE2.LBLF041.CAPTION
          SELECT C03   &&回頭寫回去訂單總價
          REPLACE F04 WITH F04+C04.F08
      ENDIF
      UNLOCK          
      SELECT C04
      seek thisform.pageframe1.page1.txtf02.value+thisform.pageframe1.page2.txtf04.value                  
      thisform.grid2.enabled=.t.
      thisform.grid2.setfocus            
      SELE C05                                                                           &&寫入出貨計劃
      APPEND BLANK
      LOCK()
      IF RLOCK()
         REPLACE F01 WITH C04.F03
         REPLACE F02 WITH C04.F04
         REPLACE F03 WITH C03.F05
         REPLACE F04 WITH C04.F05
         REPLACE F06 WITH C04.F02
         REPLACE F07 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')           
         REPLACE F08 WITH C03.F07    
         REPLACE F09 WITH C03.F14   
         REPLACE F15 WITH C03.F15
         REPLACE F13 WITH IIF(SEEK(C05.F06,'C01'),C01.F23,'') 
         SELECT E08    &&再寫入最終結餘量
         SEEK C05.F02
         IF FOUND()
            REPLACE F20 WITH F20+C05.F04*(-1)
         ELSE
            APPEND BLANK
            REPLACE F01 WITH C05.F03
            REPLACE F02 WITH C05.F02
            REPLACE F20 WITH C05.F04*(-1)
         ENDIF
      ENDIF        
      UNLOCK

      IF THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE<>IIF(SEEK(DONBIN+C04.F04+C03.F12+C04.F13,'C02'),C02.F07,0)   &&判斷是否與歷史單價不同
*!*	         IF C03.F15='1' AND THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE<IIF(SEEK(DONBIN+C04.F04+C03.F12+C04.F13,'C02'),C02.F07,0)
*!*	            =MESSAGEBOX('此筆單價小於前次售價!',0+48,'訊息提示')
*!*	            SELECT C04
*!*	            THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE=IIF(SEEK(DONBIN+C04.F04+C03.F12+C04.F13,'C02'),C02.F07,0) 
*!*	            REPLACE F07 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE
*!*	            REPLACE F22 WITH F07
*!*	         ENDIF   
         IF !INT_125
            SELE C02
            APPEND BLANK
            REPLACE  F01 WITH DONBIN
            REPLACE  F02 WITH C04.F01
            REPLACE  F03 WITH C04.F04
            REPLACE  F04 WITH C04.F17
            REPLACE  F06 WITH C03.F12
            REPLACE  F07 WITH C04.F07
            REPLACE  F08 WITH 1
            REPLACE  F09 WITH 1
            REPLACE  F11 WITH C04.F03
            REPLACE F12 WITH C04.F13
            REPL F13 WITH 1
            REPLACE F15 WITH C03.F01+INT_126   
            REPLACE F16 WITH C04.F25     
         ENDIF
      ENDIF   
      if messagebox('是否分批出貨?',4+32+256,'請確認') = 6	 
         SELE C05     
         THISFORM.ANS_BOTT.CLICK
      endif       
      SELE C04          
      THISFORM.ORPGROUP.NEW_BOTT.CLICK      
    ENDIF                 
  ENDPROC
  PROCEDURE SHRGROUP.SHURE2_BOTT.CLICK                          &&修改確認
     IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
        IF SEEK(THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE,'A01')=.F.
           =MESSAGEBOX('無此人員編號請重新輸入!',0+48,'提示訊息視窗')
           THISFORM.PAGEFRAME1.PAGE1.TXTF07.SETFOCUS
           RETURN
        ENDIF        
        IF EMPTY(THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE)
           =MESSAGEBOX('訂貨日期不得空白!',0+48,'提示訊息視窗') 
           THISFORM.PAGEFRAME1.PAGE1.TXTF02.SETFOCUS
           RETURN
        ENDIF   
        IF EMPTY(THISFORM.PAGEFRAME1.PAGE1.TXTF05.VALUE)
           =MESSAGEBOX('交貨日期不得空白!',0+48,'提示訊息視窗') 
           THISFORM.PAGEFRAME1.PAGE1.TXTF02.SETFOCUS
           RETURN
        ENDIF        
        IF THISFORM.PAGEFRAME1.PAGE1.TXTF05.VALUE<THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
           =MESSAGEBOX('交貨日期不得小於訂貨日期!',0+48,'提示訊息視窗') 
           THISFORM.PAGEFRAME1.PAGE1.TXTF05.SETFOCUS
           RETURN
        ENDIF                        
        IF THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE<>C03.F07
           SELE C05
           SEEK C03.F02
           IF FOUND()
              DO WHILE F01=C03.F02
                 REPL F08 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE
                 SKIP
              ENDDO    
           ENDIF
        ENDIF   
        IF THISFORM.PAGEFRAME1.PAGE1.TXTF12.VALUE<>C03.F12
           SELE C04
           SEEK C03.F02
           IF FOUND()
              DO WHILE F03=C03.F02
                 REPL F06 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF12.VALUE
                 SKIP
              ENDDO
           ENDIF
        ENDIF          
        SELE C03
        IF RLOCK() 
           REPL F14 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF14.VALUE
           REPL F07 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE
           REPL F01 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
           REPL F05 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF05.VALUE
           REPL F06 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF06.VALUE
           REPL F12 WITH THISFORM.PAGEFRAME1.PAGE1.CRCY.DISPLAYVALUE
           REPL F09 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF09.VALUE
           REPL F13 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF13.VALUE
           REPL F10 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')   
           UNLOCK ALL
        ELSE
           DO file_impact
          return   
       ENDIF    
     ELSE     
        IF THISFORM.PAGEFRAME1.PAGE2.TXTF15.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF16.VALUE<C04.F09+C04.F23+C04.F21
           =MESSAGEBOX('訂單總數量不得小於已出貨數+開單未過帳量+取消量!',0+48,'提示訊息視窗')
           THISFORM.PAGEFRAME1.PAGE2.TXTF15.SETFOCUS
           RETURN 
        ENDIF 
        IF C04.F11>0 .AND. THISFORM.PAGEFRAME1.PAGE2.TXTF15.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF16.VALUE<C04.F11
           =MESSAGEBOX('訂單總數量不得小於已排製令數!',0+48,'提示訊息視窗')
           THISFORM.PAGEFRAME1.PAGE2.TXTF15.SETFOCUS 
           RETURN         
        ENDIF         
        IF C03.F15='1' AND THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE=0
          =MESSAGEBOX('正式訂單銷售單價不可以為 0 !',0+48,'提示訊息視窗')
          THISFORM.PAGEFRAME1.PAGE2.TXTF07.SETFOCUS
          RETURN
       ENDIF
*!*	       IF C03.F15='1' AND THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE<C04.F22
*!*	          =MESSAGEBOX('正式訂單銷售單價不得小於最後報價 !',0+48,'提示訊息視窗')
*!*	          THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE=C04.F22
*!*	          THISFORM.PAGEFRAME1.PAGE2.TXTF07.SETFOCUS
*!*	          RETURN
*!*	       ENDIF
        IF !EMPTY(THISFORM.PAGEFRAME1.PAGE2.TXTF13.VALUE)
           IF !SEEK(DONBIN+THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE+C03.F12+THISFORM.PAGEFRAME1.PAGE2.TXTF13.VALUE,'C21','C211')
              =MESSAGEBOX('無此特價項目!',0+48,'提示訊息視窗')
              THISFORM.PAGEFRAME1.PAGE2.TXTF13.SETFOCUS 
              RETURN                    
           ENDIF
        ENDIF           
        IF RLOCK('C03') .AND. RLOCK('C04')
           SELECT C03
           REPLACE  F04 WITH F04+(C04.F08)*(-1)+THISFORM.PAGEFRAME1.PAGE2.TXTF15.VALUE*THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE
           SELE C04                    
           REPLACE F10 WITH F10+(F15+F16)*(-1)+THISFORM.PAGEFRAME1.PAGE2.TXTF15.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF16.VALUE
           REPLACE F05 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF15.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF16.VALUE
           REPLACE F04 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE
           REPLACE F07 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE
           REPLACE F08 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF15.VALUE*F07
           REPLACE F13 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF13.VALUE                      
           REPLACE F17 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF17.VALUE
           REPLACE F12 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')      
           REPLACE F25 WITH THISFORM.PAGEFRAME1.PAGE2.LBLF041.CAPTION
           IF (C04.F15+C04.F16)<>(THISFORM.PAGEFRAME1.PAGE2.TXTF15.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF16.VALUE)
              =MESSAGEBOX('訂單數量與原數量不同,請同時修改出貨計劃',0+48,'提示訊息視窗')
              IF (THISFORM.PAGEFRAME1.PAGE2.TXTF15.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF16.VALUE)>(C04.F15+C04.F16)
                 SELECT E08
                 SEEK C04.F04
                 IF FOUND()
                    REPLACE F20 WITH F20+((THISFORM.PAGEFRAME1.PAGE2.TXTF15.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF16.VALUE)-(C04.F15+C04.F16))*(-1)
                 ELSE
                    APPEND BLANK
                    REPLACE F01 WITH C03.F05
                    REPLACE F02 WITH C04.F04
                    REPLACE F20 WITH ((THISFORM.PAGEFRAME1.PAGE2.TXTF15.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF16.VALUE)-(C04.F15+C04.F16))*(-1)
                 ENDIF
              ENDIF
              SELECT C04
              REPLACE F15 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF15.VALUE
              REPLACE F16 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF16.VALUE
              THISFORM.ANS_BOTT.CLICK
           ELSE
              REPLACE F15 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF15.VALUE
              REPLACE F16 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF16.VALUE
           ENDIF           
          IF F07<>F22 AND !INT_125
             REPL F22 WITH F07
             SELE C02
             APPEND BLANK
             RLOCK()
             REPL F01 WITH DONBIN
             REPL F02 WITH C04.F01
             REPL F03 WITH C04.F04
             REPL F04 WITH C04.F17
             REPL F06 WITH C03.F12
             REPL F07 WITH C04.F07
             REPL F08 WITH 1
             REPL F09 WITH 1
             REPL F11 WITH C04.F03
             REPLACE F12 WITH C04.F13             
             REPL F13 WITH 1              
             REPLACE F15 WITH C03.F01+INT_126       
             REPLACE F16 WITH C04.F25  
          ENDIF   
             UNLOCK ALL
       ELSE
         DO file_impact
          return   
       ENDIF   
    ENDIF   
    THISFORM.SHRGROUP.ABANDON_BOTT.CLICK    
  ENDPROC   
  procedure SHRGROUP.ABANDON_BOTT.CLICK
      THISFORM.SHRGROUP.ENABLED=.F.
      THISFORM.SHRGROUP.VISIBLE=.F.      
      THISFORM.ORPGROUP.ENABLED=.T.
      THISFORM.ORPGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
      THISFORM.CMDGROUP.ENABLED=.T.
      THISFORM.CMDGROUP.SETALL('ENABLED',.T.,'COMMANDBUTTON')
      THISFORM.CMDGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
      THISFORM.SETALL('READONLY',.T.,'TEXTBOX')  
      THISFORM.PAGEFRAME1.PAGE1.SETALL('READONLY',.T.,'TEXTBOX')  
      THISFORM.PAGEFRAME1.PAGE2.SETALL('READONLY',.T.,'TEXTBOX')  
      THISFORM.PAGEFRAME1.PAGE1.TXTF03.READONLY=.T.
      THISFORM.PAGEFRAME1.PAGE1.TXTF07.READONLY=.T.
      THISFORM.PAGEFRAME1.PAGE2.TXTF04.READONLY=.T.
      THISFORM.PAGEFRAME1.PAGE2.TXTF13.READONLY=.T.       
      THISFORM.PAGEFRAME1.PAGE1.CRCY.VISIBLE=.F.
      THISFORM.PAGEFRAME1.PAGE1.ODR_TYPE.VISIBLE=.F.
      THISFORM.PAGEFRAME1.PAGE1.ENABLED=.T.
      THISFORM.PAGEFRAME1.PAGE2.ENABLED=.T.
      THISFORM.TRN_BOTT.ENABLED=IIF(C03.F11=0,.T.,.F.) .AND. !C03.F08  
      IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1        
           THISFORM.GRID1.ENABLED=.T.
           THISFORM.GRID2.ENABLED=.T.      
           THISFORM.GRID1.SETFOCUS
           THISFORM.KEY_LIST.ENABLED=.T.
      ELSE      
           THISFORM.GRID1.ENABLED=.F.
           THISFORM.GRID2.ENABLED=.T.               
           THISFORM.PAGEFRAME1.PAGE2.CMB1.VISIBLE=.F.
           THISFORM.PAGEFRAME1.PAGE2.CMB2.VISIBLE=.F.
           THISFORM.ANS_BOTT.ENABLED=.T.
           THISFORM.RCC_BOTT.ENABLED=IIF(C04.F09>0,.T.,.F.)
           THISFORM.GRID2.SETFOCUS
         IF THISFORM.GRID2.ACTIVEROW=0
            IF INT_013            
               IF SUBSTR(PO_NO,3,4)=SUBSTR(DTOS(DATE()),3,4)
                  HD='C001 '+SUBSTR(DTOS(DATE()),3,4)+PO_NO
                  HD2='CA'
                  HD3='客戶訂單'
                  A24='A24'+LEFT(DTOS(DATE()),6)
                  IF !USED('&A24')
                     SELE 0
                     USE (A24) ALIA A24
                  ELSE
                     SELE A24
                  ENDIF
                  SET ORDER TO 1      
                  DO ODR_RJT   &&執行主程式單據編號重用程序 
                  SELECT A24
                  USE
               ENDIF   
            ENDIF   
            SELE C03               
            DELE
            SKIP -1
            IF BOF()
               GO TOP
            ENDIF               
            THISFORM.PAGEFRAME1.ACTIVEPAGE=1
            THISFORM.REFRESH
         ENDIF   
      ENDIF       
      UNLOCK ALL
  ENDPROC
  PROCEDURE SHRGROUP.FINISH_BOTT.CLICK
      IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
         IF THISFORM.GRID2.RECORDSOURCE<>'C04'
            THISFORM.GRID2.RECORDSOURCE='C04'
            THISFORM.GRID2.CHILDORDER='C041'
            THISFORM.grid2.COLUMN1.CONTROLSOURCE='C04.F04'
	        THISFORM.grid2.COLUMN2.CONTROLSOURCE='C04.F25'
	        THISFORM.grid2.COLUMN3.CONTROLSOURCE='C04.F15'
	        THISFORM.grid2.COLUMN4.CONTROLSOURCE='C04.F16'
	        THISFORM.grid2.COLUMN5.CONTROLSOURCE='C04.F09'
	        THISFORM.grid2.COLUMN6.CONTROLSOURCE='C04.F11'
	        THISFORM.grid2.COLUMN7.CONTROLSOURCE='C04.F12'         
	     ENDIF   
	     IF INT_013=.T.
	        IF SUBSTR(PO_NO,3,4)=SUBSTR(DTOS(DATE()),3,4)
               HD='C001 '+SUBSTR(DTOS(DATE()),3,4)+PO_NO
               HD2='CA'
               HD3='客戶訂單'
               A24='A24'+LEFT(DTOS(DATE()),6)
               IF !USED('&A24')
                  SELE 0
                  USE (A24) ALIA A24
               ELSE
                  SELE A24
               ENDIF
               SET ORDER TO 1      
               DO ODR_RJT   &&執行主程式單據編號重用程序
               SELECT A24
               USE
            ENDIF  
         ENDIF   
         SELE C03
         DO CASE 
            CASE THISFORM.KEY_LIST.DISPLAYVALUE='依訂單編號排列'
                 SET ORDER TO C031
            CASE THISFORM.KEY_LIST.DISPLAYVALUE='依客戶單號排列'
                 SET ORDER TO C032
            CASE THISFORM.KEY_LIST.DISPLAYVALUE='依客戶編號排列'
                 SET ORDER TO C033
         ENDCASE   
       ENDIF  
       THISFORM.SHRGROUP.ABANDON_BOTT.CLICK
  ENDPROC     
  PROC ANS_BOTT.CLICK
    DO CASE
           CASE  C04.F23 <> 0
                      =MESSAGEBOX('已有開單未出量,請至B04出貨單中查詢',16,'請確認') 
                      THISFORM.GRID2.SETFOCUS
                      RETURN
           CASE  C04.F10 = 0
                      =MESSAGEBOX('此料號已有未出貨累計量',16,'請確認') 
                      THISFORM.GRID2.SETFOCUS
                      RETURN      
           OTHERWISE
		      OUT_SEEK=CREATEOBJECT("OUT_SEEK")  
		      OUT_SEEK.SHOW                
		      FLG='0'                    
		      AREA1='C03'
		      SELECT  C04                                       
    ENDCASE          
  ENDPROC
  PROC RCC_BOTT.CLICK
       SELE F03,F04,F05 FROM C06 WHERE F01+F02=C04.F03+C04.F04  INTO CURSOR RCC ORDER BY F03
       IF _TALLY>0
         RCC_SEEK=createobject("RCC_SEEK")  
         RCC_SEEK.SHOW                                      
         AREA1='C03'
         THISFORM.GRID1.SETFOCUS
       ENDIF  
  ENDPROC
  PROC TRN_BOTT.CLICK          &&轉入請購單製令或正式訂單
       IF THISFORM.PAGEFRAME1.ACTIVEPAGE=2   &&如果是預購或空頭單號單號表身
          SELECT C04
          IF C04.F23=0 AND C04.F24=0
                FTR_STR=C03.F02         
                RK=C03.F03      
                CKS=C03.F12
                ADV=C03.F15
                STK_NO=C04.F04
                UNIT_PRICE=C04.F07
                SPECIAL_DSCRP=C04.F13
                CUS_STCK=C04.F17
                ZINSU=C04.F25
                CUS_PO=SUBSTR(C03.F14,5-IIF(ADV='3',4,0),21+IIF(ADV='3',4,0))+SPACE(4-IIF(ADV='3',4,0))                       
             if messagebox('是否確認轉入'+IIF(C03.F15='2','正式','預購')+'訂單?',4+32+256,'請確認') = 6	   
                IF C03.F15='2' AND C04.F07=0
                   =MESSAGEBOX('訂單單價不得為零，請修正後再轉入正式訂單！',0+48,'提示訊息式窗')
                   RETURN
                ENDIF
   		        REAL_SEEK=CREATEOBJECT("REAL_SEEK")  
		        REAL_SEEK.SHOW                         
             ENDIF   
          ELSE
             =MESSAGEBOX('有開單未過帳量!請先去出貨單或出貨退回單刪除本筆資料!',0+48,'提示訊息視窗')
             RETURN
          ENDIF     
       ELSE     &&轉請購單或製造令
          if messagebox('是否確認資料無誤可以轉請購單或製造工單?',4+32+256,'請確認') = 6	       
***************************************    &&轉請購單
                           IF !USED('C20')
                               SELECT 0
                               USE C20
                           ELSE
                                SELECT C20 
                           ENDIF
                           SET ORDER TO 1                       

                               IF !USED('P05')
                                    SELE 0
                                    USE P05
                               ELSE
                                    SELE P05
                               ENDIF
                               SET ORDER TO P051
                               IF !USED('P06')
                                   SELE 0
                                   USE P06
                               ELSE
                                   SELE P06
                               ENDIF   
                               SET ORDER TO 1                             
                              FOR I= 1 TO 2
                                      SELECT C04
                                      SET ORDER TO C041
                                      SEEK C03.F02
                                      IF FOUND()
                                         HD='P001 '+SUBSTR(DTOS(DATE()),3,4)
                                         HD1='P001 '
                                         HD2='PA'
                                         HD3='材料請購單'
                                         IF !USED('A09')
                                            SELECT 0
                                            USE A09
                                         ELSE
                                            SELECT A09
                                         ENDIF
                                         SET ORDER TO 1      
                                         A24='A24'+LEFT(DTOS(DATE()),6)
                                         IF !USED('&A24')
                                            SELE 0
                                            USE (A24) ALIA A24
                                         ELSE
                                            SELE A24
                                         ENDIF
                                         SET ORDER TO 1      
                                         DO ODR_CRT    &&執行主程式中之單據新增   
                                         SELECT A24
                                         USE 
                                         SELECT A09
                                         USE
                                          IF SEEK(PO_NO,'P05')=.T.      &&如果單號重複
                                             SELECT MAX(F01) FROM P05 INTO ARRAY GB NOWAIT
                                             HD='P001 '+SUBSTR(DTOS(DATE()),3,4)+PO_NO
                                             IF !USED('A09')
                                                SELECT 0
                                                USE A09
                                             ELSE
                                                SELECT A09
                                             ENDIF
                                             SET ORDER TO 1      
                                             A24='A24'+LEFT(DTOS(DATE()),6)
                                             IF !USED('&A24')
                                                SELE 0
                                                USE (A24) ALIA A24
                                             ELSE
                                                SELE A24
                                             ENDIF
                                             SET ORDER TO 1      
                                             DO ODR_RPT   &&執行主程式單據編號重複程序 
                                             SELECT A24
                                             USE
                                             SELECT A09
                                             USE              
                                          ENDIF                      
                                          V=0
                                          SELE C04
                                          SET ORDER TO C041
                                          DO WHILE C04.F03=C03.F02
                                                 IF IIF(SEEK(C04.F04,'B01'),B01.F97,'')<>'Y' AND !EMPTY(IIF(SEEK(C04.F04,'B01'),B01.F98,'')) AND IIF(I=1,LEFT(B01.F02,4)='JST ',LEFT(B01.F02,4)<>'JST ')
                                                     SELE P06
                                                     APPEND BLANK
                                                     REPLACE  F01 WITH PO_NO
                                                     REPLACE  F02 WITH C04.F04
                                                     REPLACE  F03 WITH C04.F05-C04.F09-C04.F21-C04.F23
                                                     REPLACE  F05 WITH C03.F05
                                                     REPLACE  F06 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')   
                                                     REPLACE  F07 WITH C04.F03
                                                     SELECT C20
                                                     SEEK P06.F02
                                                     IF FOUND()
                                                          SELECT P06
                                                          IF C20.F15=0
                                                               REPLACE F04 WITH F03
                                                          ELSE
                                                               REPLACE  F04 WITH CEILING(F03/C20.F15)*C20.F15                              
                                                          ENDIF  
                                                     ELSE
                                                          SELECT P06
                                                          REPLACE F04 WITH F03
                                                     ENDIF                     
                                                     SELE C04 
                                                     REPLACE  F11 WITH C04.F05-C04.F09-C04.F21-C04.F23 
                                                     SELE C03
                                                     REPLACE  F11 WITH F11+1               
                                                     V=V+1                               
                                                 ENDIF
                                                 SELECT C04    
                                                 SKIP
                                          ENDDO
                                          IF V>0  &&如果有部品已轉入請購單表身
                                              SELE P05    &&再寫入請購單表頭
                                              APPEND BLANK
                                              REPLACE  F01 WITH PO_NO
                                              REPLACE  F02 WITH DATE()
                                              REPLACE  F03 WITH '1'
                                              REPLACE  F04 WITH C03.F03
                                              REPLACE  F05 WITH IIF(SEEK(C03.F03,'C01','C011'),C01.F05,'')
                                              REPLACE  F06 WITH C03.F02
                                              REPLACE  F07 WITH sys_oper
                                              REPLACE  F08 WITH .F.
                                              REPLACE  F09 WITH  DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')   
                                              REPLACE  F11 WITH '1'
                                              REPLACE F12 WITH C03.F15
                                          ELSE                          &&若連一筆都沒轉入請購單表身則產生之請購單編號寫回暫存檔                                          
                                              HD='P001 '+SUBSTR(DTOS(DATE()),3,4)+PO_NO
                                              HD2='PA'
                                              HD3='材料請購單'
                                              A24='A24'+LEFT(DTOS(DATE()),6)
                                              IF !USED('&A24')
                                                 SELE 0
                                                 USE (A24) ALIA A24
                                              ELSE
                                                 SELE A24
                                              ENDIF
                                              SET ORDER TO 1      
                                              DO ODR_RJT  
                                              SELECT A24
                                              USE                                   
                                         ENDIF   
                                   ENDIF   
                                   IF V>0
                                          =MESSAGEBOX(IIF(I=1,'JST部品','非JST部品')+'已轉入請購單單號'+PO_NO,0+48,'請至P03請購單再次確認')                                                                                 
                                   ENDIF        
                               ENDFOR 
                               UNLOCK ALL                               
                               SELECT C20
                               USE
                               SELE P05
                               USE
                               SELE P06
                               USE
****************************************************                                         && 轉製造令
                           IF !USED('F01')
                                SELECT 0
                                USE F01
                           ELSE
                               SELECT F01
                           ENDIF
                           SET ORDER TO F013         
                           IF !USED('F02')
                                SELECT 0
                                USE F02
                           ELSE
                                SELECT 0
                                USE F02
                            ENDIF
                            SET ORDER TO F021
                            IF !USED('F07')
                                  SELECT 0
                                  USE F07
                            ELSE
                                 SELECT F07
                            ENDIF
                            SET ORDER TO F071
                            IF !USED('E00')
                                  SELECT 0
                                  USE E00
                            ELSE
                                  SELECT E00
                            ENDIF
                            SET ORDER TO E001                            
                            IF !USED('E03')
                                  SELECT 0
                                  USE E03
                            ELSE
                                  SELECT E03
                            ENDIF
                            SET ORDER TO E031
                            IF !USED('E05')
                                 SELECT 0
                                 USE E05
                            ELSE
                                 SELECT E05
                            ENDIF
                            SET ORDER TO E051
                            IF !USED('E06')
                                 SELECT 0
                                 USE E06
                            ELSE
                                 SELECT E06
                            ENDIF
                            SET ORDER TO E061                            
                            IF !USED('E07')
                                 SELECT 0
                                 USE E07
                            ELSE
                                 SELECT E07
                            ENDIF
                            SET ORDER TO E071
                            IF !USED('E11')
                                 SELECT 0
                                 USE E11
                            ELSE
                                 SELECT E11
                            ENDIF
                            SET ORDER TO E111    
                           V=0                                                                                        
                           SELE C04
                           SET ORDER TO C041
                           SEEK C03.F02
                           IF FOUND()
                               DO WHILE C04.F03=C03.F02
                                  SELECT F01
                                  SEEK C04.F04    &&檢查是否有建BOM表
                                  IF FOUND()  AND F01.F05=.T. &&AND IIF(SEEK(C04.F04,'B01'),B01.F97='Y','')   &&如果已建BOM且已經過確認且為要展開   A
                                     IF IIF(SEEK(C04.F04,'B01'),B01.F97='Y','')       &&原本即設為成品者馬上展製令  B
                                        SELECT C05  &&依照出貨計劃分批
                                        SET ORDER TO C054         
                                        SEEK C04.F03+C04.F04
                                        IF FOUND()
                                           DO WHILE C05.F01+C05.F02=C04.F03+C04.F04
                                              SELECT C03 
                                              REPLACE F11 WITH F11+1
                                              SELECT C04
                                              REPLACE  F11 WITH F10
                                              REPLACE  F14 WITH F14+1                                                                                            
                                              VERS_NO=F01.F02         
                                              DPT=F01.F07
                                              DO MANUFACTURE_OD WITH C03.F02,C04.F04,VERS_NO,C05.F04,C05.F03,DPT,'1'      &&呼叫主程式中製令展開程序        
                                              V=V+1           
                                              SELECT C05
                                              SKIP
                                           ENDDO   
                                        ENDIF
                                     ELSE                    &&否則再判斷是否再做額外加工B
                                     
                                        IF MESSAGEBOX(F01.F01+'是否需要再產生額外加工或包裝製令?',4+32+256,'請確認') = 6	
                                           SELECT C05  &&依照出貨計劃分批
                                           SET ORDER TO C054         
                                           SEEK C04.F03+C04.F04
                                           IF FOUND()
                                              DO WHILE C05.F01+C05.F02=C04.F03+C04.F04
                                                 SELECT C03 
                                                 REPLACE F11 WITH F11+1
                                                 SELECT C04
                                                 REPLACE  F11 WITH F10
                                                 REPLACE  F14 WITH F14+1                                                                                            
                                                 VERS_NO=F01.F02         
                                                 DPT=F01.F07
                                                 DO MANUFACTURE_OD WITH C03.F02,C04.F04,VERS_NO,C05.F04,C05.F03,DPT,' '      &&呼叫主程式中製令展開程序        
                                                 V=V+1           
                                                 SELECT C05
                                                 SKIP
                                              ENDDO   
                                           ENDIF
                                        ENDIF 
                                        
                                     ENDIF                     &&B
                                                                                                
                                  ENDIF                                       &&A
                                     
                                  SELECT C04                                  
                                  SKIP
                               ENDDO        
                           ENDIF   
                           SELECT F01
                           USE 
                           SELECT F02
                           USE 
                           SELECT F07
                           USE 
                           SELECT E03
                           USE 
                           SELECT E05
                           USE 
                           SELECT E06
                           USE 
                           SELECT E07
                           USE 
                           SELECT E11
                           USE
                           SELECT E00
                           USE
                           IF V>0
                                =MESSAGEBOX('已有'+ALLTRIM(STR(V))+'筆轉入E04製造工單',0+48,'提示訊息視窗')
                           ENDIF     
***************************************************************************************  轉製造令結束               
             THISFORM.TRN_BOTT.ENABLED=.F.       
       ENDIF     
    ENDIF   
       IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
          SELECT C03
          SET ORDER TO &COD
          THISFORM.GRID1.SETFOCUS
        ELSE
          SELECT C04
          SEEK FTR_STR+STK_NO
          THISFORM.GRID2.SETFOCUS
          IF THISFORM.GRID2.ACTIVEROW=0
             SELECT C03 
             DELETE
             SET ORDER TO C031
             SEEK PO_NO
             SET ORDER TO &COD     
             THISFORM.PAGEFRAME1.ACTIVEPAGE=1                   
             THISFORM.GRID1.SETFOCUS
          ENDIF
       ENDIF                                
  ENDPROC  
enddefine    

***********************************************列印程序
PROCEDURE PNT_PRC  
     LK=C03.F02     
     SELECT C05.F01,;
            C05.F02,;
            C05.F03,;
            C05.F04,;
            C05.F06,;
            C05.F08;                    
     FROM C05 WHERE C05.F01=LK INTO CURSOR C05TMP ORDER BY F02,F03
     SELECT C05TMP.F01,;
            C05TMP.F02,;
            C05TMP.F03,;
            C05TMP.F04,;
            C05TMP.F06,;
            C05TMP.F08,;                      
            C04.F07,;
            C04.F08,;
            C04.F15,;
            C04.F16,;
            C04.F17,;
            C04.F25;
            FROM C05TMP,C04 WHERE C04.F03=LK AND C04.F04=C05TMP.F02 ORDER BY C05TMP.F02,C05TMP.F03 INTO CURSOR C04TMP
      SELECT C04TMP.F01,;
             C04TMP.F02,;
             C04TMP.F03,;
             C04TMP.F04,;
             C04TMP.F06,;
             C04TMP.F08_A,;                         
             C04TMP.F07,;
             C04TMP.F08_B,;
             C04TMP.F15,;
             C04TMP.F16,;
             C04TMP.F17,;
             C04TMP.F25,;
             C03.F01,;
             C03.F04,;
             C03.F05,;
             C03.F06,;
             C03.F09,;             
             C03.F12,;
             C03.F13,;
             C03.F14,;
             B01.F02,;
             C01.F04,;
             C01.F13,;
             A01.F03;
             FROM C04TMP,C03,B01,C01,A01 WHERE C03.F02=C04TMP.F01 AND B01.F01=C04TMP.F02;
             AND C01.F01=C04TMP.F06 AND A01.F01=C04TMP.F08_A;
             ORDER BY C04TMP.F02,C04TMP.F03 INTO CURSOR C03TMP
     IF _tally >0
*      REPORT FORM ALLTRIM(INT_116)+'C04' PREVIEW
        REPORT FORM ALLTRIM(INT_116)+'C04' TO PRINTER PROMPT
     ELSE
        =MESSAGEBOX('此訂單已全部出清無法列印',0+64,'提示訊息視窗')   
     ENDIF  
     SELE C05TMP
     USE
     SELE C04TMP
     USE
     SELE C03TMP
     USE
ENDPROC
************************************************特殊輸入欄位的設定----料號
DEFINE CLASS TXTF04 AS TEXTBOX
  READONLY=.T.
  MAXLENGTH=20
  FONTSIZE=INT_015*9
  PROCEDURE INTERACTIVECHANGE
    IF AT('?',ALLTRIM(THIS.VALUE))<>0
       IF AT('?',ALLTRIM(THIS.VALUE))>1             
          SELECT F01,F02 FROM B01 INTO CURSOR MTR ORDER BY F01 WHERE LEFT(F01,AT('?',THIS.VALUE)-1)=LEFT(THIS.VALUE,AT('?',THIS.VALUE)-1)    
       ELSE
          SELECT F01,F02 FROM B01 INTO CURSOR MTR ORDER BY F01   
       ENDIF 
       IF _TALLY>0  
          MAN_SEEK=createobject("MTR_SEEK")  
          MAN_SEEK.SHOW    
          THIS.VALUE=FLG
          THIS.REFRESH
          FLG='0'        
       ENDIF    
    ENDIF  
       THISFORM.PAGEFRAME1.PAGE2.LBLF041.CAPTION=IIF(SEEK(THIS.VALUE,'B01'),B01.F02,'')  
       IF !EMPTY(THISFORM.PAGEFRAME1.PAGE2.LBLF041.CAPTION)
          IF SEEK(DONBIN+THIS.VALUE+C03.F12,'C21')
             THISFORM.PAGEFRAME1.PAGE2.TXTF13.VISIBLE=.T.
             IF messagebox('此項料號有特價是否查看其他報價',4+32+256,'請確認') = 6	       
                THISFORM.PAGEFRAME1.PAGE2.CMB1.CLICK
             ELSE                 
                THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE=IIF(SEEK(DONBIN+THIS.VALUE+C03.F12+SPACE(1),'C02'),IIF(C02.F15>=C03.F01,C02.F07,0),0)
                THISFORM.PAGEFRAME1.PAGE2.TXTF17.VALUE=IIF(SEEK(DONBIN+THIS.VALUE+C03.F12+SPACE(1),'C02'),C02.F04,'')
                THISFORM.PAGEFRAME1.PAGE2.LBLF041.CAPTION=IIF(SEEK(DONBIN+THIS.VALUE+C03.F12+SPACE(1),'C02'),C02.F16,THISFORM.PAGEFRAME1.PAGE2.LBLF041.CAPTION)
             ENDIF
           ELSE
             THISFORM.PAGEFRAME1.PAGE2.TXTF13.VISIBLE=.F.
             THISFORM.PAGEFRAME1.PAGE2.TXTF13.VALUE=''
             THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE=IIF(SEEK(DONBIN+THIS.VALUE+C03.F12+SPACE(1),'C02'),IIF(C02.F15>=C03.F01,C02.F07,0),0)
             THISFORM.PAGEFRAME1.PAGE2.TXTF17.VALUE=IIF(SEEK(DONBIN+THIS.VALUE+C03.F12+SPACE(1),'C02'),C02.F04,'')  
             THISFORM.PAGEFRAME1.PAGE2.LBLF041.CAPTION=IIF(SEEK(DONBIN+THIS.VALUE+C03.F12+SPACE(1),'C02'),C02.F16,THISFORM.PAGEFRAME1.PAGE2.LBLF041.CAPTION)           
           ENDIF

       ELSE      
             THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE=0
             THISFORM.PAGEFRAME1.PAGE2.TXTF17.VALUE=''
             THISFORM.PAGEFRAME1.PAGE2.TXTF13.VALUE=''             
       ENDIF    
       THISFORM.PAGEFRAME1.PAGE2.TXTF17.REFRESH
       THISFORM.PAGEFRAME1.PAGE2.TXTF07.REFRESH
       IF THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE>0
          THISFORM.PAGEFRAME1.PAGE2.CMB1.VISIBLE=.t.
       ELSE    
          THISFORM.PAGEFRAME1.PAGE2.CMB1.VISIBLE=.F.
       ENDIF    
  ENDPROC
ENDDEFINE
***************************************************特殊輸入欄位設定-----------客戶
DEFINE CLASS TXTF03 AS TEXTBOX
  READONLY=.T.
  MAXLENGTH=5
      FONTSIZE=INT_015*9  
  PROCEDURE INTERACTIVECHANGE
    IF AT('?',ALLTRIM(THIS.VALUE))<>0 
       IF AT('?',ALLTRIM(THIS.VALUE))>1             
          if empty(a02.f12)
             SELECT F02,F01,F04 FROM C01 INTO CURSOR VDR ORDER BY F02 WHERE LEFT(F02,AT('?',THIS.VALUE)-1)=LEFT(THIS.VALUE,AT('?',THIS.VALUE)-1) and f18=sys_oper
          else
             SELECT F02,F01,F04 FROM C01 INTO CURSOR VDR ORDER BY F02 WHERE LEFT(F02,AT('?',THIS.VALUE)-1)=LEFT(THIS.VALUE,AT('?',THIS.VALUE)-1)
          endif
       ELSE
          if empty(a02.f12)
             SELECT F02,F01,F04 FROM C01 INTO CURSOR VDR ORDER BY F02 WHERE F18=sys_oper   
          else   
            SELECT F02,F01,F04 FROM C01 INTO CURSOR VDR ORDER BY F02 
          endif   
       ENDIF          
       VDR_SEEK=createobject("VDR_SEEK")  
       VDR_SEEK.SHOW    
       THIS.VALUE=FLG
       THIS.REFRESH
       FLG='0'        
    ELSE
       IF LEN(ALLTRIM(THIS.VALUE))=4
          SELECT F02,F01,F04 FROM C01 INTO CURSOR VDR ORDER BY F02 WHERE F02=ALLTRIM(THIS.VALUE)
          DO CASE
             CASE _TALLY=1
                  THIS.VALUE=VDR.F01
                  THIS.REFRESH
             CASE _TALLY>1
                  VDR_SEEK=createobject("VDR_SEEK")  
                  VDR_SEEK.SHOW    
                  THIS.VALUE=FLG
                  THIS.REFRESH
                  FLG='0'        
          ENDCASE      
       ENDIF
    
    ENDIF      
       DONBIN=IIF(SEEK(THIS.Value,'C01'),C01.F45,THIS.Value)
       THISFORM.PAGEFRAME1.PAGE1.LBLF031.CAPTION=IIF(SEEK(THIS.VALUE,'C01'),C01.F04,'')  
       THISFORM.PAGEFRAME1.PAGE1.TXTF06.VALUE=IIF(SEEK(THIS.VALUE,'C01'),C01.F07,'')   
       THISFORM.PAGEFRAME1.PAGE1.TXTF06.REFRESH
       THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE=IIF(SEEK(THIS.VALUE,'C01'),IIF(INT_209 = 'B',C01.F33,C01.F18),'')   
       THISFORM.PAGEFRAME1.PAGE1.TXTF07.REFRESH      
       THISFORM.PAGEFRAME1.PAGE1.LBLF071.CAPTION=IIF(SEEK(THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE,'A01'),A01.F03,'')    
       THISFORM.PAGEFRAME1.PAGE1.CRCY.DISPLAYVALUE=IIF(SEEK(DONBIN,'C02'),C02.F06,INT_011)
       THISFORM.PAGEFRAME1.PAGE1.TXTF12.VALUE=THISFORM.PAGEFRAME1.PAGE1.CRCY.DISPLAYVALUE
       THISFORM.PAGEFRAME1.PAGE1.CRCY.REFRESH
       THISFORM.PAGEFRAME1.PAGE1.TXTF12.REFRESH  
       IF INT_212='N'
          SELECT RECNO() FROM K51 WHERE THIS.VALUE = K51.F06 AND DATE()-K51.F15 > 0 INTO ARRAY RC1
          IF _TALLY > 0 
            =MESSAGEBOX('此客戶尚有逾期貨款未收!',0+64,'提示訊息視窗')                  
            THIS.VALUE = ''
            THISFORM.PAGEFRAME1.PAGE1.LBLF031.CAPTION = ''
            THISFORM.PAGEFRAME1.PAGE1.TXTF06.VALUE = ''
            THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE = ''
            THISFORM.PAGEFRAME1.PAGE1.LBLF071.CAPTION = ''
          ENDIF
          THIS.SETFOCUS
       ENDIF   
       IF INT_214 = 'N'
	      SELECT SUM(C03.f04) FROM C03 WHERE C03.f03 = THIS.VALUE AND C03.f02 = ANY(SELECT C05.f01 FROM C05 WHERE C05.f06 = THIS.VALUE AND C01.f01 <> '備料紀錄' GROUP BY C05.f01) INTO CURSOR C03_TEMP
	      IF SEEK(THIS.VALUE,'C01') = .T. AND C03_TEMP.SUM_F04 >= C01.F27 
	        =MESSAGEBOX('此客戶未出貨金額已超過該客戶之信用額度 ' + ALLTRIM(TRANSFORM(C01.F27,"@R 9,999,999,999,999,999")) + ' 請修改C01.客戶基本資料之信用額度!',0+64,'提示訊息視窗')               
            THIS.VALUE = ''
            THISFORM.PAGEFRAME1.PAGE1.LBLF031.CAPTION = ''
            THISFORM.PAGEFRAME1.PAGE1.TXTF06.VALUE = ''
            THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE = ''
            THISFORM.PAGEFRAME1.PAGE1.LBLF071.CAPTION = ''                     
         ENDIF
         THIS.SETFOCUS
       ENDIF        
  ENDPROC
ENDDEFINE
***************************************************特殊輸入欄位設定-----------業務員
DEFINE CLASS TXTF07 AS TEXTBOX
   READONLY=.T.
   MAXLENGTH=5
   FONTSIZE=INT_015*9   
   PROCEDURE INTERACTIVECHANGE
     IF AT('?',ALLTRIM(THIS.VALUE))<>0
        IF AT('?',ALLTRIM(THIS.VALUE))>1             
           SELECT F01,F03 FROM A01 INTO CURSOR MAN ORDER BY F01 WHERE LEFT(F01,AT('?',THIS.VALUE)-1)=LEFT(THIS.VALUE,AT('?',THIS.VALUE)-1)
        ELSE
           SELECT F01,F03 FROM A01 INTO CURSOR MAN ORDER BY F01    
        ENDIF   
        VDR_SEEK=createobject("MAN_SEEK")  
        VDR_SEEK.SHOW    
        THIS.VALUE=FLG
        THIS.REFRESH
        FLG='0'        
     ENDIF  
      THISFORM.PAGEFRAME1.PAGE1.LBLF071.CAPTION=IIF(SEEK(THIS.VALUE,'A01'),A01.F03,'')  
  ENDPROC
ENDDEFINE
***************************************************訂單類別
DEFINE CLASS ODR_TYPE AS COMBOBOX
  HEIGHT=INT_015*25
  AUTOSIZE=.T.
  TOP=INT_015*9
  LEFT=INT_015*190
  FONTSIZE=INT_015*9
  BOUNDCOLUMN=1
  COLUMNCOUNT=1
  WIDTH=INT_015*84
  ROWSOURCETYPE=1
  STYLE=2
  NAME='ODR_TYPE'
  PROCEDURE INIT        
       THIS.ADDITEM('正式訂單')
       THIS.ADDITEM('預購訂單')
       THIS.ADDITEM('空頭訂單')   
  ENDPROC
  PROCEDURE INTERACTIVECHANGE
    THISFORM.PAGEFRAME1.PAGE1.TXTF15.VALUE=ALLTRIM(STR(THIS.VALUE))
    THISFORM.PAGEFRAME1.PAGE1.TXTF15.REFRESH
    IF THIS.VALUE=2
       THISFORM.PAGEFRAME1.PAGE1.TXTF14.VALUE='預購'       
    ELSE
       THISFORM.PAGEFRAME1.PAGE1.TXTF14.VALUE=''       
    ENDIF
  ENDPROC
ENDDEFINE  
***************************************************幣別設定
DEFINE CLASS CRCY AS COMBOBOX
  HEIGHT=INT_015*25
  AUTOSIZE=.T.
  TOP=INT_015*84
  LEFT=INT_015*418
  FONTSIZE=INT_015*9
  BOUNDCOLUMN=1
  COLUMNCOUNT=1
  WIDTH=INT_015*84
  ROWSOURCETYPE=1
  STYLE=2
  NAME='CRCY'
  PROCEDURE INIT
    SELECT C00
    GO TOP 
    DO WHILE .NOT. EOF()
       L=4-LEN(ALLTRIM(F01))
       THIS.ADDITEM(F01)
       SKIP
    ENDDO
  ENDPROC
  PROCEDURE INTERACTIVECHANGE
    THISFORM.PAGEFRAME1.PAGE1.TXTF12.VALUE=THIS.DISPLAYVALUE
    THISFORM.PAGEFRAME1.PAGE1.TXTF12.REFRESH
  ENDPROC
ENDDEFINE  
*******************
DEFINE CLASS CMB1 AS COMMANDBUTTON
   HEIGHT=INT_015*25
   WIDTH=INT_015*55
   TOP=INT_015*108
   LEFT=INT_015*195
   FONTSIZE=INT_015*9
   NAME='CMB1'
   CAPTION='報價紀錄'
   TOOLTIPTEXT='查看報價紀錄資料'
   PROC CLICK
        SELE C02
        
        GF=THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE

             SLP_SEEK=createobject("SLP_SEEK")  
             SLP_SEEK.SHOW    
             IF !EMPTY(FLG)
                THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE=FLG
                THISFORM.PAGEFRAME1.PAGE2.TXTF13.VALUE=CHK_STR
                THISFORM.PAGEFRAME1.PAGE2.TXTF17.VALUE=UKEF
                THISFORM.PAGEFRAME1.PAGE2.LBLF041.CAPTION=ZINSU
            ENDIF      
             ZINSU=''         
             FLG=''        
             CHK_STR=''            
             AREA1='C03'
             SELE C04
*          endif 
  ENDPROC     
ENDDEFINE      
*******************************************************報價紀錄
define class SLP_SEEK as form
  autocenter=.t.
  caption='報價紀錄'
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*340
  WIDTH=INT_015*800
  FONTSIZE=INT_015*9
  CONTROLBOX=.F.
  BORDERSTYLE=2
  SHOWTIPS=.T.
  showwindow=1
  windowtype=1
  name='SLP_SEEK'
  add object GRID1 as GRID with;          
      AUTOCENTER=.T.,;
      ALLOWCELLSELECTION=.F.,;
      TOP=INT_015*0,;
      WIDTH=INT_015*800,;      
      HEIGHT=INT_015*310,;      
      ROWHEIGHT=INT_015*18,;
      HEADERHEIGHT=INT_015*19,;
      deletemark=.f.,;
      READONLY=.T.,;
      recordsourcetype=1,;
      columncount=10,;            
      NAME='GRID1',;
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;      
      COLUMN3.NAME='COLUMN3',;      
      COLUMN4.NAME='COLUMN4',;      
      COLUMN5.NAME='COLUMN5',;      
      COLUMN6.NAME='COLUMN6',;      
      COLUMN7.NAME='COLUMN7',;      
      COLUMN8.NAME='COLUMN8',;
      COLUMN9.NAME='COLUMN9',;            
      COLUMN10.NAME='COLUMN10'
  add object cmdgroup as cmdgroup with;      
      TOP=INT_015*310,;
      LEFT=INT_015*130,;
      visible=.t.      
  add object cmnd1 as commandbutton with;
      LEFT=INT_015*303,;    
      HEIGHT=INT_015*25,;   
      TOP=INT_015*315,;  
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;
      caption='\<S.選取',;
      TOOLTIPTEXT='選擇游標所指的紀錄!快速鍵->ALT+S'
      name='cmnd1'
  add object cmnd2 as commandbutton with;
      LEFT=INT_015*345,;
      TOP=INT_015*315,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;      
      caption='\<C.取消',;
      TOOLTIPTEXT='取消此搜尋畫面!快速鍵->ALT+C'
      name='cmnd2'
      procedure init 
         AREA1='C02' 
        SELE C02
        SET FILTER TO F01=DONBIN .AND. F03=GF .AND. F06=C03.F12 .AND. F15>=C03.F01 
        SET RELATION TO C01.F45+F03+F06+F12 INTO C21        
        SEEK DONBIN+GF
         THISFORM.GRID1.READONLY=.T. 
         thisform.grid1.recordsource='C02'         
         THISFORM.CMDGROUP.SEEK_BOTT.VISIBLE=.F.
         THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'COLUMN')
         THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'HEADER')         
         THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='異動日期'
         THISFORM.GRID1.COLUMN1.WIDTH=INT_015*73
         THISFORM.GRID1.COLUMN1.CONTROLSOURCE='C02.F02'
         THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='代碼'
         THISFORM.GRID1.COLUMN2.WIDTH=INT_015*20
         THISFORM.GRID1.COLUMN2.CONTROLSOURCE='C02.F12'         
         THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='特價描述'
         THISFORM.GRID1.COLUMN3.CONTROLSOURCE='C21.F05'
         THISFORM.GRID1.COLUMN3.WIDTH=INT_015*100
         THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='單        價'
         THISFORM.GRID1.COLUMN4.CONTROLSOURCE='C02.F07'
         THISFORM.GRID1.COLUMN4.WIDTH=INT_015*83
         THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='失效期限'
         THISFORM.GRID1.COLUMN5.CONTROLSOURCE='C02.F15'
         THISFORM.GRID1.COLUMN5.WIDTH=INT_015*75
         THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='客戶料號'
         THISFORM.GRID1.COLUMN6.CONTROLSOURCE='C02.F04'
         THISFORM.GRID1.COLUMN6.WIDTH=INT_015*100
         THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='最小訂貨量'        
         THISFORM.GRID1.COLUMN7.CONTROLSOURCE='C02.F08'
         THISFORM.GRID1.COLUMN7.WIDTH=INT_015*83
         THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='交易條件'
         THISFORM.GRID1.COLUMN8.CONTROLSOURCE='C02.F10'
         THISFORM.GRID1.COLUMN8.WIDTH=INT_015*103
         THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='安全資料'
         THISFORM.GRID1.COLUMN9.CONTROLSOURCE='C02.F11'
         THISFORM.GRID1.COLUMN9.WIDTH=INT_015*74
         THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='品名規格'
         THISFORM.GRID1.COLUMN10.CONTROLSOURCE='C02.F16'
         THISFORM.GRID1.COLUMN10.WIDTH=INT_015*100
         THISFORM.GRID1.SETFOCUS
         IF THISFORM.GRID1.ACTIVEROW<>0
              THISFORM.GRID1.AFTERROWCOLCHANGE 
         ENDIF         
      ENDPROC
      PROC GRID1.AFTERROWCOLCHANGE
       LPARAMETERS XColIndex     
         FCH=THISFORM.ACTIVECONTROL.NAME  
         FLG=C02.F07
         CHK_STR=C02.F12
         UKEF=C02.F04
         ZINSU=C02.F16
      ENDPROC 
      procedure cmnd1.click  
          THISFORM.RELEASE           
          SET RELATION OFF INTO C21     
          SET FILTER TO                                   
      endproc
      procedure cmnd2.click
          FLG=''   
          CHK_STR=''
          ZINSU=''
          SET RELATION OFF INTO C21
          thisform.release
          SET FILTER TO
      endproc      
enddefine            
*******************
DEFINE CLASS CMB2 AS COMMANDBUTTON
   HEIGHT=INT_015*25
   WIDTH=INT_015*55
   TOP=INT_015*108
   LEFT=INT_015*195
   FONTSIZE=INT_015*9
   NAME='CMB2'
   CAPTION='最新價格'
   TOOLTIPTEXT='帶出最新報價紀錄單價'
   PROC CLICK
        
        SELE C04
        REPLACE F22 WITH IIF(SEEK(DONBIN+THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE+C03.F12+THISFORM.PAGEFRAME1.PAGE2.TXTF13.VALUE,'C02'),IIF(C02.F15>=C03.F01,C02.F07,0),0) 
       THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE=IIF(SEEK(DONBIN+THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE+C03.F12+THISFORM.PAGEFRAME1.PAGE2.TXTF13.VALUE,'C02'),IIF(C02.F15>=C03.F01,C02.F07,0),0)   
       THISFORM.PAGEFRAME1.PAGE2.TXTF17.VALUE=IIF(SEEK(DONBIN+THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE+C03.F12+THISFORM.PAGEFRAME1.PAGE2.TXTF13.VALUE,'C02'),C02.F04,'')  
  ENDPROC     
ENDDEFINE      
*********************************************************************出貨計劃
define class OUT_SEEK as form
  autocenter=.t.
  caption='出貨計劃'
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*370
  WIDTH=INT_015*280
  FONTSIZE=INT_015*9
  CONTROLBOX=.F.
  BORDERSTYLE=2
  SHOWTIPS=.T.
  showwindow=1
  windowtype=1
  name='OUT_SEEK'
  ADD OBJECT SHAPE1 AS SHAPE1 WITH;
      LEFT=INT_015*3,;
      WIDTH=INT_015*273,;
      HEIGHT=INT_015*65
  ADD OBJECT SHAPE2 AS SHAPE2 WITH;    
      LEFT=INT_015*3,;
      TOP=INT_015*67,;
      WIDTH=INT_015*273,;
      HEIGHT=INT_015*265
  ADD OBJECT SHAPE3 AS SHAPE3 WITH;
      LEFT=INT_015*3,;
      TOP=INT_015*334,;
      WIDTH=INT_015*273,;
      HEIGHT=INT_015*35    
  add object cmdgroup as cmdgroup with;      
      TOP=INT_015*299,;
      LEFT=INT_015*10
  ADD OBJECT ORPGROUP AS ORPGROUP WITH;    
      TOP=INT_015*335,;
      LEFT=INT_015*10
  ADD OBJECT KEY_LIST AS KEY_LIST WITH;
      VISIBLE=.F.    
  ADD OBJECT LBLF03 AS LABEL WITH;
      TOP=INT_015*8,;
      LEFT=INT_015*5,;
      HEIGHT=INT_015*17,;
      WIDTH=INT_015*50,;
      CAPTION='出貨日期'
  ADD OBJECT LBLF04 AS LABEL WITH;
      TOP=INT_015*8,;
      LEFT=INT_015*150,;
      WIDTH=INT_015*50,;
      HEIGHT=INT_015*17,;
      CAPTION='出貨數量'
  ADD OBJECT LBLF07 AS LABEL WITH;
      TOP=INT_015*36,;
      LEFT=INT_015*5,;
      WIDTH=INT_015*50,;
      HEIGHT=INT_015*17,;
      CAPTION='安全資料'        
  ADD OBJECT LBLF071 AS LABEL WITH;
      TOP=INT_015*36,;
      LEFT=INT_015*56,;
      AUTOSIZE=.T.              
  ADD OBJECT LBLQTY AS LABEL WITH;
      TOP=INT_015*315,;
      LEFT=INT_015*200,;
      AUTOSIZE=.T.,;
      CAPTION='未排入量：'    
  ADD OBJECT LBLTQTY AS LABEL WITH;
      TOP=INT_015*345,;
      LEFT=INT_015*200,;
      AUTOSIZE=.T.
  ADD OBJECT TXTF03 AS TEXTBOX WITH;
      TOP=INT_015*4,;
      LEFT=INT_015*56,;
      WIDTH=INT_015*73,;
      HEIGHT=INT_015*25,;
      NAME='TXTF03'
  ADD OBJECT TXTF04 AS TEXTBOX WITH;
      TOP=INT_015*4,;
      LEFT=INT_015*201,;
      WIDTH=INT_015*73,;
      HEIGHT=INT_015*25,;
      INPUTMASK='99999999999',;
      NAME='TXTF04'      
  ADD OBJECT SHRGROUP AS SHRGROUP WITH;
      TOP=INT_015*30,;
      LEFT=INT_015*180                
  ADD OBJECT GRID1 AS GRID WITH;        
      AUTOCENTER=.T.,;
      LEFT=INT_015*10,;
      TOP=INT_015*71,;
      WIDTH=INT_015*260,;      
      HEIGHT=INT_015*230,;      
      ROWHEIGHT=INT_015*18,;
      HEADERHEIGHT=INT_015*19,;      
      DELETEMARK=.F.,;
      READONLY=.T.,;
      RECORDSOURCETYPE=1,;
      COLUMNCOUNT=3,;            
      NAME='GRID1',;
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;      
      COLUMN3.NAME='COLUMN3'      
  add object cmnd2 as commandbutton with;
      LEFT=INT_015*141,;
      TOP=INT_015*339,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;
      caption='\<X.離開',;
      TOOLTIPTEXT='取消此作業畫面!快速鍵->ALT+X'
      name='cmnd2'
      procedure init 
         THISFORM.SETALL('FONTSIZE',INT_015*9,'TEXTBOX') 
         THISFORM.SETALL('FONTSIZE',INT_015*9,'LABEL')          
         AREA1='C05' 
        SELE C05
        SET FILTER TO F01=C04.F03 .AND. F02=C04.F04
        CALC SUM(F04) TO TQTY
        SEEK C04.F03+C04.F04
         THISFORM.GRID1.READONLY=.T. 
         thisform.grid1.recordsource='c05'
         THISFORM.CMDGROUP.SEEK_BOTT.VISIBLE=.F.
         THISFORM.ORPGROUP.PNT_BOTT.VISIBLE=.F.
         THISFORM.ORPGROUP.ESC_BOTT.VISIBLE=.F.
         THISFORM.SHRGROUP.VISIBLE=.F.
         THISFORM.SHRGROUP.ENABLED=.F.         
         thisform.setall('readonly',.t.,'textbox')
         THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'COLUMN')
         THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'HEADER')         
         THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='出貨日期'
         THISFORM.GRID1.COLUMN1.WIDTH=INT_015*73
         THISFORM.GRID1.COLUMN1.CONTROLSOURCE='C05.F03'
         THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='出貨數量'
         THISFORM.GRID1.COLUMN2.CONTROLSOURCE='C05.F04'
         THISFORM.GRID1.COLUMN2.WIDTH=INT_015*83
         THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='安全資料'
         THISFORM.GRID1.COLUMN3.CONTROLSOURCE='C05.F07'
         THISFORM.GRID1.COLUMN3.WIDTH=INT_015*74
         THISFORM.GRID1.SETALL("DYNAMICFORECOLOR","IIF(EMPTY(C05.F15),RGB(205,102,29),'')",'COLUMN')
         THISFORM.GRID1.SETFOCUS       
         FCH='GRID1'
         IF THISFORM.GRID1.ACTIVEROW=0
            THISFORM.CMDGROUP.ENABLED=.F.
            THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
            THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
            THISFORM.LBLF071.CAPTION=''
         ELSE
            THISFORM.CMDGROUP.ENABLED=.T.         
            THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=(IIF(C04.F10-TQTY>=0,.T.,.F.) .OR. THISFORM.GRID1.ACTIVEROW=1) AND !EMPTY(C05.F15)                                
            THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.T. AND !EMPTY(C05.F15)
         ENDIF                     
         THISFORM.LBLTQTY.CAPTION=ALLTRIM(STR(C04.F10-TQTY)) 
         THISFORM.CMND2.ENABLED=.T.                               
         THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(C04.F10-TQTY<>0,.T.,.F.)               
      ENDPROC
      PROC GRID1.AFTERROWCOLCHANGE
         LPARAMETERS XColIndex     
         THISFORM.TXTF03.VALUE=C05.F03
         THISFORM.TXTF04.VALUE=C05.F04
         THISFORM.LBLF071.CAPTION=C05.F07
         FCH=THISFORM.ACTIVECONTROL.NAME 
         IF THIS.ACTIVEROW=0
            THISFORM.CMDGROUP.ENABLED=.F.
            THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
            THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
         ELSE
            THISFORM.CMDGROUP.ENABLED=.T.         
            THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=(IIF(C04.F10-TQTY>=0,.T.,.F.)  .OR. THISFORM.GRID1.ACTIVEROW=1) AND !EMPTY(C05.F15)                            
            THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.T. AND !EMPTY(C05.F15)      
         ENDIF            
         IF C04.F10-TQTY>0
            THISFORM.ORPGROUP.NEW_BOTT.ENABLED=.T.            
         ELSE
            THISFORM.ORPGROUP.NEW_BOTT.ENABLED=.F.                     
         ENDIF
      ENDPROC  
      procedure cmnd2.click
         IF C04.F10-TQTY>0
            IF MESSAGEBOX('尚有'+STR(C04.F10-TQTY)+'未排入出貨計劃是否取消?',4+32+256,'請確認') = 6	 
               IF A02.F06=SPACE(1)
                  =MESSAGEBOX('您沒有取消訂單的權限,請重新新增出貨計劃',0+64,'提示訊息視窗')                     
                  RETURN
               ENDIF              
               IF C04.F11>0
                  =MESSAGEBOX('此筆記錄已請購或排程,無法取消,請重新新增出貨計劃',0+64,'提示訊息視窗')    
                  RETURN
               ENDIF                  
               SELECT E08
               SEEK C04.F04
               IF FOUND()
                  REPLACE F20 WITH F20+(C04.F10-TQTY)
               ELSE
                  APPEND BLANK
                  REPLACE F01 WITH C03.F05
                  REPLACE F02 WITH C04.F04
                  REPLACE F20 WITH (C04.F10-TQTY)
               ENDIF                   
               SELE C04     
               REPL C04.F21 WITH C04.F21+C04.F10-TQTY
               REPL C04.F10 WITH TQTY           
               REPL C04.F12 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')   
               SELE C05
            ELSE
               SELE C05               
               THISFORM.GRID1.SETFOCUS
               THISFORM.ORPGROUP.NEW_BOTT.ENABLED=.T.
               RETURN   
            ENDIF               
         ENDIF 
         SELE C05
         SET FILTER TO
         thisform.release         
      endproc    
      PROC ORPGROUP.NEW_BOTT.CLICK
           THISFORM.CMND2.ENABLED=.F.
           SELE C05
           CALC SUM(F04) TO TQTY
           THISFORM.TXTF03.READONLY=.F.
           THISFORM.TXTF04.READONLY=.F.
           THISFORM.TXTF03.VALUE=DATE()
           THISFORM.TXTF04.VALUE=C04.F10-TQTY
           THISFORM.TXTF03.SETFOCUS
           QTY=C04.F10-TQTY
           THISFORM.LBLTQTY.CAPTION=ALLTRIM(STR(QTY))
      ENDPROC
      PROC ORPGROUP.EDIT_BOTT.CLICK
           THISFORM.CMND2.ENABLED=.F.      
           SELE C05
           RLOCK()
           IF !RLOCK()
              DO file_impact
              THISFORM.GRID1.SETFOCUS
              THISFORM.SHRGROUP.ABANDON_BOTT.CLICK 
           ELSE
              THISFORM.TXTF03.READONLY=.F.
              THISFORM.TXTF04.READONLY=.F.
              THISFORM.TXTF03.SETFOCUS
              QTY=C05.F04           
           ENDIF                 
      ENDPROC        
      PROC ORPGROUP.DEL_BOTT.CLICK
           IF messagebox('是否確定要刪除此筆資料',4+32+256,'請確認') = 6	            
              SELE C05                
              IF RLOCK()                
                 SELE C05 
                 DELE
                 UNLOCK             
                 IF BOF()
                    GO TOP
                 ELSE
                   SKIP -1   
                 ENDIF
                 BK=RECNO()
                 CALC SUM(F04) to TQTY
                 IF TQTY>0
                    GO BK
                 ENDIF        
              ELSE
                 DO file_impact                             
              ENDIF         
              THISFORM.GRID1.SETFOCUS
              IF THISFORM.GRID1.ACTIVEROW=0
                 THISFORM.CMDGROUP.ENABLED=.F.
                 THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
                 THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.   
                 THISFORM.ORPGROUP.NEW_BOTT.ENABLED=.T.            
                 THISFORM.SETALL('VALUE','','TEXTBOX')
                 THISFORM.LBLF071.CAPTION=''
              ELSE      
                 THISFORM.CMDGROUP.ENABLED=.T.
                 THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=iif(C04.F10-TQTY>=0,.T.,.F.) .OR. THISFORM.GRID1.ACTIVEROW=1
                 THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.T.
              ENDIF           
           ENDIF   
           THISFORM.LBLTQTY.CAPTION=ALLTRIM(STR(C04.F10-TQTY))
           thisform.CMND2.enabled=iif(C04.F10-TQTY>=0,.T.,.F.)
      ENDPROC
      PROC SHRGROUP.SHURE1_BOTT.CLICK
           IF SEEK(C04.F03+C04.F04+DTOS(THISFORM.TXTF03.VALUE),'C05')=.T.
              =MESSAGEBOX('出貨日期重複!',0+64,'提示訊息視窗')
              THISFORM.TXTF03.SETFOCUS
              RETURN              
           ENDIF
           SELE C05
           APPEND BLANK
           RLOCK()
           REPLACE  F01 WITH C04.F03
           REPLACE  F02 WITH C04.F04
           REPLACE  F03 WITH THISFORM.TXTF03.VALUE
           REPLACE  F04 WITH THISFORM.TXTF04.VALUE
           REPLACE  F06 WITH C04.F02           
           REPLACE  F07 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')   
           REPLACE  F08 WITH C03.F07
           REPLACE  F09 WITH C03.F14
           REPLACE  F13 WITH IIF(SEEK(C05.F06,'C01'),C01.F23,'')
           REPLACE  F15 WITH C03.F15
           UNLOCK
           CALC SUM(F04) TO TQTY      
           SEEK C04.F03+C04.F04+DTOS(THISFORM.TXTF03.VALUE)
              THISFORM.SHRGROUP.ABANDON_BOTT.CLICK    
      ENDPROC         
      PROC SHRGROUP.SHURE2_BOTT.CLICK
           SELE C05
           REPL F03 WITH THISFORM.TXTF03.VALUE
           REPL F04 WITH THISFORM.TXTF04.VALUE
           REPL F07 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')   
           CALC SUM(F04) TO TQTY     
           SEEK C04.F03+C04.F04+DTOS(THISFORM.TXTF03.VALUE)
           THISFORM.SHRGROUP.ABANDON_BOTT.CLICK    
      ENDPROC
      PROC SHRGROUP.ABANDON_BOTT.CLICK
           THISFORM.SHRGROUP.ENABLED=.F.
           THISFORM.SHRGROUP.VISIBLE=.F.      
           THISFORM.ORPGROUP.ENABLED=.T.
           THISFORM.ORPGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
           THISFORM.CMDGROUP.ENABLED=.T.
           THISFORM.CMDGROUP.SETALL('ENABLED',.T.,'COMMANDBUTTON')
           THISFORM.CMDGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
           THISFORM.SETALL('READONLY',.T.,'TEXTBOX') 
           THISFORM.LBLTQTY.CAPTION=ALLTRIM(STR(C04.F10-TQTY)) 
           THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(C04.F10-TQTY<>0,.T.,.F.)                          
           THISFORM.CMND2.ENABLED=IIF(C04.F10-TQTY>=0,.T.,.F.)   
           THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(C04.F10-TQTY>=0,.T.,.F.) .OR. THISFORM.GRID1.ACTIVEROW=1                                                                          
           THISFORM.GRID1.ENABLED=.T.
           THISFORM.GRID1.SETFOCUS     
           UNLOCK ALL      
      ENDPROC
      PROC SHRGROUP.FINISH_BOTT.CLICK
           THISFORM.SHRGROUP.ABANDON_BOTT.CLICK           
      ENDPROC
      PROCEDURE TXTF04.VALID
         LPARAMETERS  NINDEX
         IF THIS.VALUE<=C04.F10-TQTY+IIF(THISFORM.SHRGROUP.ENABLED=.T.,QTY,C05.F04)
            NINDEX=.T.
         ELSE
            =MESSAGEBOX("出貨數量不得大於"+STR(C04.F10-TQTY+QTY),0+64,"提示視窗") 
            IF C04.F10-TQTY+QTY<0
               NINDEX=.T.
            ELSE     
               NINDEX=.F.
            ENDIF   
         ENDIF
         RETURN NINDEX
      ENDPROC 
      PROCEDURE TXTF03.VALID
         LPARAMETERS  NINDEX
         IF !EMPTY(THIS.VALUE) .AND. THIS.VALUE>=C03.F01
            NINDEX=.T.
         ELSE
            =MESSAGEBOX("出貨日期不得空白且不能小於"+DTOC(C03.F01),0+64,"提示視窗")    
            NINDEX=.F.
         ENDIF
         RETURN NINDEX
      ENDPROC                
enddefine            
************************************************出貨紀錄
define class RCC_SEEK as form
  autocenter=.t.
  caption='出貨紀錄'
  fontsize=INT_015*9
  height=INT_015*340
  width=INT_015*275
  CONTROLBOX=.F.
  BORDERSTYLE=2
  SHOWTIPS=.T.
  showwindow=1
  windowtype=1
  name='RCC_SEEK'
  add object GRID1 as GRID with;    
  ALLOWCELLSELECTION=.F.,;      
      AUTOCENTER=.T.,;
      ALLOWCELLSELECTION=.F.,;
      top=0,;
      width=INT_015*275,;      
      height=INT_015*310,;      
      deletemark=.f.,;
      READONLY=.T.,;
      ROWHEIGHT=INT_015*18,;
      HEADERHEIGHT=INT_015*19,;
      recordsourcetype=1,;
      columncount=3,;            
      NAME='GRID1',;
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;      
      COLUMN3.NAME='COLUMN3'           
  add object cmdgroup as cmdgroup with;      
      top=INT_015*310,;
      left=INT_015*2,;
      visible=.t.      
  add object cmnd2 as commandbutton with;
      left=INT_015*210,;
      top=INT_015*315,;
      height=INT_015*25,;
      width=INT_015*40,;
      FONTSIZE=INT_015*9,;
      caption='\<X.離開',;
      TOOLTIPTEXT='離開此查詢尋畫面!快速鍵->ALT+X'
      name='cmnd2'
      procedure init 
         AREA1='RCC' 
         THISFORM.GRID1.READONLY=.T. 
         thisform.grid1.recordsource='RCC'
         THISFORM.CMDGROUP.SEEK_BOTT.VISIBLE=.F.
         THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'COLUMN')
         THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'HEADER')         
         THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='出貨日期'
         THISFORM.GRID1.COLUMN1.CONTROLSOURCE='F03'         
         THISFORM.GRID1.COLUMN1.WIDTH=INT_015*65      
         THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='出(退)貨單號'
         THISFORM.GRID1.COLUMN2.CONTROLSOURCE='F04'         
         THISFORM.GRID1.COLUMN2.WIDTH=INT_015*80
         THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='出(退)貨數量'
         THISFORM.GRID1.COLUMN3.CONTROLSOURCE='F05'
         THISFORM.GRID1.COLUMN3.WIDTH=INT_015*100
         THISFORM.GRID1.SETFOCUS
	IF THISFORM.GRID1.ACTIVEROW<>0
	   THISFORM.GRID1.AFTERROWCOLCHANGE  
	ENDIF         
      ENDPROC
      PROC GRID1.AFTERROWCOLCHANGE
       LPARAMETERS XColIndex     
         FCH=THISFORM.ACTIVECONTROL.NAME  
      ENDPROC 
      procedure cmnd2.click
          FLG=''   
          thisform.release
      endproc      
enddefine            
**************************************************************************************
DEFINE CLASS ANS_CHOICE AS FORM
              AUTOCENTER=.T.
              CAPTION='請選擇轉請購單之依據'
              FONTSIZE=INT_015*9
              HEIGHT=INT_015*115
              WIDTH=INT_015*210
               FONTSIZE=INT_015*9
              CONTROLBOX=.F.
              BORDERSTYLE=2
              SHOWTIPS=.T.
              SHOWWINDOW=1
             WINDOWTYPE=1
              NAME='ANS_CHOICE'
              ADD OBJECT DATA_OPTION AS OPTIONGROUP WITH;
                       LEFT=INT_015*28,;
                      TOP=INT_015*20,;
                      AUTOSIZE=.T.,;
                      FONTSIZE=INT_015*12,;
                      BUTTONCOUNT=2,;
                      OPTION1.CAPTION='轉入請購單',;
                      OPTION1.TOP=0,;
                      OPTION1.AUTOSIZE=.T.,;
                      OPTION1.FONTSIZE=INT_015*9,;
                      OPTION1.HEIGHT=INT_015*17,;
                      OPTION2.CAPTION='轉入製造令',;
                      OPTION2.TOP=20,;
                      OPTION2.AUTOSIZE=.T.,;
                      OPTION2.FONTSIZE=INT_015*9,;  
                      OPTION2.HEIGHT=INT_015*17,;
                      NAME='DATA_OPTION'           
             ADD OBJECT CMND1 AS COMMANDBUTTON WITH;
                      LEFT=INT_015*130,;     
                     TOP=INT_015*11,;  
                     HEIGHT=INT_015*25,;    
                     WIDTH=INT_015*50,;
                     FONTSIZE=INT_015*9,;      
                     CAPTION='\<Y.確定',;
                     TOOLTIPTEXT='確認所選擇的鍵值!快速鍵->ALT+Y',;
                     NAME='CMND1'
            ADD OBJECT CMND2 AS COMMANDBUTTON WITH;
                     LEFT=INT_015*130,;
                    TOP=INT_015*51,;
                    HEIGHT=INT_015*25,;    
                    WIDTH=INT_015*50,;
                    FONTSIZE=INT_015*9,;
                    CAPTION='\<C.取消',;
                   TOOLTIPTEXT='取消作業!快速鍵->ALT+C',;
                   NAME='CMND2'      
  *****    
            PROCEDURE CMND1.CLICK                    

*           
                   THIS.Enabled=.F.                
                   THISFORM.RELEASE 
           ENDPROC
 ***** 
           PROCEDURE CMND2.CLICK
                 THISFORM.RELEASE
           ENDPROC      
ENDDEFINE      

***************************************************特殊輸入欄位設定-----------特價代碼
DEFINE CLASS TXTF13 AS TEXTBOX
  FONTSIZE=INT_015*9
  READONLY=.T.
  MAXLENGTH=1
  HEIGHT=INT_015*25
  PROCEDURE INTERACTIVECHANGE
    IF AT('?',ALLTRIM(THIS.VALUE))<>0
       THIS.DBLCLICK
    ELSE
           
          THISFORM.PAGEFRAME1.PAGE2.LBLF131.CAPTION=IIF(SEEK(DONBIN+THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE;
          +C03.F12+THIS.VALUE,'C21'),C21.F05,'') 

    ENDIF  
    THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE=IIF(SEEK(DONBIN+THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE+C03.F12+THIS.VALUE,'C02'),IIF(C02.F15>=C03.F01,C02.F07,0),0)
    THISFORM.PAGEFRAME1.PAGE2.TXTF17.VALUE=IIF(SEEK(DONBIN+THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE+C03.F12+THIS.VALUE,'C02'),C02.F04,'')
  ENDPROC
  PROCEDURE DBLCLICK
          DELETE FROM C21 WHERE F01+F02+F03+F04 NOT IN (SELE F01+F03+F06+F12 FROM C02)
          SELECT F04,F05,F06 FROM C21 WHERE F01+F02+F03=DONBIN+THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE;
          +C03.F12 INTO CURSOR SPC ORDER BY F02      
       IF _TALLY>0
          tAREA1=AREA1         
          SPC_SEEK=createobject("SPC_SEEK")  
          SPC_SEEK.SHOW    
          IF !EMPTY(FLG)
             THIS.VALUE=FLG
             THISFORM.PAGEFRAME1.PAGE2.LBLF131.CAPTION=CHK_STR
          ENDIF    
          FLG=''
          CHK_STR=''        
          AREA1=tAREA1
       ENDIF      
       THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE=IIF(SEEK(DONBIN+THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE+C03.F12+THIS.VALUE,'C02'),IIF(C02.F15>=C03.F01,C02.F07,0),0)   
       THISFORM.PAGEFRAME1.PAGE2.TXTF17.VALUE=IIF(SEEK(DONBIN+THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE+C03.F12+THIS.VALUE,'C02'),C02.F04,'')        
  ENDPROC
ENDDEFINE
*******************************************************特價描述紀錄
define class SPC_SEEK as form
  autocenter=.t.
  caption='特價描述紀錄'
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*340
  WIDTH=INT_015*336
  FONTSIZE=INT_015*9
  CONTROLBOX=.F.
  BORDERSTYLE=2
  SHOWTIPS=.T.
  showwindow=1
  windowtype=1
  name='SPC_SEEK'
  add object GRID1 as GRID with;          
      AUTOCENTER=.T.,;
      ALLOWCELLSELECTION=.F.,;
      TOP=INT_015*0,;
      WIDTH=INT_015*336,;      
      HEIGHT=INT_015*310,;      
      ROWHEIGHT=INT_015*18,;
      HEADERHEIGHT=INT_015*19,;
      deletemark=.f.,;
      READONLY=.T.,;
      recordsourcetype=1,;
      columncount=3,;            
      NAME='GRID1',;
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;
      COLUMN3.NAME='COLUMN3'
  add object cmdgroup as cmdgroup with;      
      TOP=INT_015*310,;
      LEFT=INT_015*30,;
      visible=.t.      
  add object cmnd1 as commandbutton with;
      LEFT=INT_015*203,;    
      HEIGHT=INT_015*25,;   
      TOP=INT_015*315,;  
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;
      caption='\<S.選取',;
      TOOLTIPTEXT='選擇游標所指的紀錄!快速鍵->ALT+S'
      name='cmnd1'
  add object cmnd2 as commandbutton with;
      LEFT=INT_015*245,;
      TOP=INT_015*315,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;      
      caption='\<C.取消',;
      TOOLTIPTEXT='取消此搜尋畫面!快速鍵->ALT+C'
      name='cmnd2'
      procedure init 
         AREA1='SPC' 
         SELE SPC
         THISFORM.GRID1.READONLY=.T. 
         thisform.grid1.recordsource='SPC'         
         THISFORM.CMDGROUP.SEEK_BOTT.VISIBLE=.F.
         THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'COLUMN')
         THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'HEADER')         
         THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='代碼'
         THISFORM.GRID1.COLUMN1.WIDTH=INT_015*25
         THISFORM.GRID1.COLUMN1.CONTROLSOURCE='F04'              
         THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='描述說明'
         THISFORM.GRID1.COLUMN2.WIDTH=INT_015*210
         THISFORM.GRID1.COLUMN2.CONTROLSOURCE='F05'
         THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='首次報價'
         THISFORM.GRID1.COLUMN3.CONTROLSOURCE='F06'
         THISFORM.GRID1.COLUMN3.WIDTH=INT_015*80
         THISFORM.GRID1.SETFOCUS
         IF THISFORM.GRID1.ACTIVEROW<>0
              THISFORM.GRID1.AFTERROWCOLCHANGE 
         ENDIF         
      ENDPROC
      PROC GRID1.AFTERROWCOLCHANGE
       LPARAMETERS XColIndex     
         FCH=THISFORM.ACTIVECONTROL.NAME  
         FLG=SPC.F04
         CHK_STR=F05
      ENDPROC 
      procedure cmnd1.click  
          THISFORM.RELEASE                
      endproc
      procedure cmnd2.click
          FLG=''   
          CHK_STR=''
          thisform.release
      endproc      
enddefine          
*********************************************************************轉正式訂單輸入畫面
define class REAL_SEEK as form
  autocenter=.t.
  caption='轉入正式訂單'
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*236
  WIDTH=INT_015*280
  FONTSIZE=INT_015*9
  CONTROLBOX=.F.
  BORDERSTYLE=2
  SHOWTIPS=.T.
  showwindow=1
  windowtype=1
  name='REAL_SEEK'
  ADD OBJECT SHAPE1 AS SHAPE1 WITH;
      LEFT=INT_015*3,;
      WIDTH=INT_015*273,;
      HEIGHT=INT_015*35
  ADD OBJECT SHAPE2 AS SHAPE2 WITH;    
      LEFT=INT_015*3,;
      TOP=INT_015*37,;
      WIDTH=INT_015*273,;
      HEIGHT=INT_015*160
  ADD OBJECT SHAPE3 AS SHAPE3 WITH;
      LEFT=INT_015*3,;
      TOP=INT_015*200,;
      WIDTH=INT_015*273,;
      HEIGHT=INT_015*35    
 ADD OBJECT REL_TPE AS OPTIONGROUP WITH;
      LEFT=INT_015*65,;
      TOP=INT_015*40,;
      HEIGHT=INT_015*40,;    
      WIDTH=INT_015*135,;      
      BUTTONCOUNT=2,;
      OPTION1.CAPTION='重新產生訂單號碼',;
      OPTION1.FONTSIZE=INT_015*9,;
      OPTION1.LEFT=INT_015*4,;
      OPTION1.TOP=INT_015*3,;
      OPTION1.AUTOSIZE=.T.,;
      OPTION2.CAPTION='轉入現有'+IIF(ADV='2','正式','預購')+'訂單',;
      OPTION2.FONTSIZE=INT_015*9,;
      OPTION2.LEFT=INT_015*4,;
      OPTION2.TOP=INT_015*23,;
      OPTION2.AUTOSIZE=.T.,;          
      NAME='REL_TPE'                   
ADD OBJECT PO_TPE AS OPTIONGROUP WITH;
      LEFT=INT_015*65,;
      TOP=INT_015*120,;
      HEIGHT=INT_015*40,;    
      WIDTH=INT_015*135,;      
      BUTTONCOUNT=2,;
      OPTION1.CAPTION='延用'+IIF(ADV='2','預購','空頭')+'PO號碼',;
      OPTION1.FONTSIZE=INT_015*9,;
      OPTION1.LEFT=INT_015*4,;
      OPTION1.TOP=INT_015*3,;
      OPTION1.AUTOSIZE=.T.,;
      OPTION2.CAPTION='重新輸入客戶PO',;
      OPTION2.FONTSIZE=INT_015*9,;
      OPTION2.LEFT=INT_015*4,;
      OPTION2.TOP=INT_015*23,;
      OPTION2.AUTOSIZE=.T.,;          
      NAME='PO_TPE'                        

  ADD OBJECT LBLF02 AS LABEL WITH;
      TOP=INT_015*90,;
      LEFT=INT_015*5,;
      WIDTH=INT_015*90,;
      CAPTION='請輸入現有單號'
  ADD OBJECT LBLF14 AS LABEL WITH;
      TOP=INT_015*170,;
      LEFT=INT_015*5,;
      WIDTH=INT_015*90,;
      CAPTION='請輸入客戶單號'
  ADD OBJECT LBLF03 AS LABEL WITH;
      TOP=INT_015*8,;
      LEFT=INT_015*5,;
      WIDTH=INT_015*50,;
      CAPTION='出貨日期'
  ADD OBJECT LBLF04 AS LABEL WITH;
      TOP=INT_015*8,;
      LEFT=INT_015*150,;
      WIDTH=INT_015*50,;
      CAPTION='轉入數量'
  ADD OBJECT TXTF03 AS TEXTBOX WITH;
      TOP=INT_015*4,;
      LEFT=INT_015*56,;
      WIDTH=INT_015*73,;
      HEIGHT=INT_015*25,;
      NAME='TXTF03'
  ADD OBJECT TXTF04 AS TEXTBOX WITH;
      TOP=INT_015*4,;
      LEFT=INT_015*201,;
      WIDTH=INT_015*73,;
      HEIGHT=INT_015*25,;
      INPUTMASK='99999999999',;
      NAME='TXTF04'      
   ADD OBJECT TXTF02 AS TEXTBOX WITH;
      TOP=INT_015*87,;
      LEFT=INT_015*96,;
      WIDTH=INT_015*80,;
      HEIGHT=INT_015*25,;
      MAXLENGTH=10,;
      NAME='TXTF02'
  ADD OBJECT TXTF14 AS TEXTBOX WITH;
      TOP=INT_015*167,;
      LEFT=INT_015*96,;
      WIDTH=INT_015*120,;
      HEIGHT=INT_015*25,;
      MAXLENGTH=25,;
      NAME='TXTF14'           
   add object cmnd1 as commandbutton with;
      LEFT=INT_015*100,;
      TOP=INT_015*205,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;
      caption='\<S.確認',;
      TOOLTIPTEXT='取消此作業畫面!快速鍵->ALT+X'
      name='cmnd2'
  add object cmnd2 as commandbutton with;
      LEFT=INT_015*141,;
      TOP=INT_015*205,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;
      caption='\<X.離開',;
      TOOLTIPTEXT='取消此作業畫面!快速鍵->ALT+X'
      name='cmnd2'
      procedure init 
         THISFORM.SETALL('FONTSIZE',INT_015*9,'TEXTBOX') 
         THISFORM.SETALL('FONTSIZE',INT_015*9,'LABEL')      
         IF RK='C6666'
            
            THISFORM.REL_TPE.OPTION1.ENABLED=.F.
            THISFORM.REL_TPE.VALUE=2
            THISFORM.LBLF02.VISIBLE=.T.
            THISFORM.TXTF02.VISIBLE=.T.
            THISFORM.PO_TPE.VISIBLE=.F.
            THISFORM.PO_TPE.ENABLED=.F.
         ELSE
            THISFORM.LBLF02.VISIBLE=.F.            
            THISFORM.TXTF02.VISIBLE=.F.                                           
         ENDIF   
         THISFORM.TXTF03.VALUE=C03.F01
         THISFORM.LBLF14.VISIBLE=.F.
         THISFORM.TXTF14.VISIBLE=.F.
         THISFORM.TXTF04.VALUE=C04.F10-C04.F23 
      ENDPROC
      PROCEDURE REL_TPE.INTERACTIVECHANGE
          IF THIS.VALUE=1
             THISFORM.LBLF02.VISIBLE=.F.
             THISFORM.TXTF02.VISIBLE=.F.
             THISFORM.PO_TPE.VISIBLE=.T.
             THISFORM.PO_TPE.VALUE=1
          ELSE
             THISFORM.LBLF02.VISIBLE=.T.
             THISFORM.TXTF02.VISIBLE=.T.
             THISFORM.PO_TPE.VISIBLE=.F.
             THISFORM.LBLF14.VISIBLE=.F.
             THISFORM.TXTF14.VISIBLE=.F.           
             THISFORM.TXTF02.VALUE=IIF(SEEK(CUS_PO,'C03','C032'),C03.F02,'')           
          ENDIF
      ENDPROC
      PROCEDURE PO_TPE.INTERACTIVECHANGE
          IF THIS.VALUE=1
             THISFORM.LBLF14.VISIBLE=.F.
             THISFORM.TXTF14.VISIBLE=.F.
          ELSE
             THISFORM.LBLF14.VISIBLE=.T.
             THISFORM.TXTF14.VISIBLE=.T.
          ENDIF
      ENDPROC      
      PROCEDURE TXTF03.VALID
         LPARAMETERS  NINDEX
         IF !EMPTY(THIS.VALUE) .AND. THIS.VALUE>=C03.F01
            NINDEX=.T.
         ELSE
            =MESSAGEBOX("出貨日期不得空白且不能小於"+DTOC(C03.F01),0+48,"提示視窗")    
            NINDEX=.F.
         ENDIF
         RETURN NINDEX
      ENDPROC                      
      PROCEDURE CMND1.CLICK
          IF THISFORM.TXTF04.VALUE<=0
             =MESSAGEBOX('數量不得為0!','提示訊息視窗')
             THISFORM.TXTF04.SETFOCUS
             RETURN
          ENDIF
          IF THISFORM.TXTF04.VALUE>IIF(SEEK(FTR_STR+STK_NO,'C04','C041'),C04.F10-C04.F23,0)
             =MESSAGEBOX('數量不得大於'+TRANSFORM(C04.F10-C04.F23,'@R 999999999'),'提示訊息視窗 ')
               THISFORM.TXTF04.SETFOCUS
             RETURN         
          ENDIF
          IF THISFORM.REL_TPE.VALUE=2 AND EMPTY(THISFORM.TXTF02.VALUE)
             =MESSAGEBOX('訂單號碼不得空白',0+48,'提示訊息視窗')
             THISFORM.TXTF02.SETFOCUS
             RETURN
          ENDIF
          IF THISFORM.PO_TPE.VALUE=2 AND !EMPTY(THISFORM.TXTF14.VALUE)
             IF SEEK(THISFORM.TXTF14.VALUE,'C03','C032')=.T.
                =MESSAGEBOX('客戶單號重覆!',0+48,'提示訊息視窗')
                THISFORM.TXTF14.SETFOCUS
                RETURN
             ENDIF
          ENDIF          
          IF THISFORM.REL_TPE.VALUE=2  &&如果使用現行單號
             IF RK='C6666'  &&如果是業務部自己備料
                 &&直接加入取消訂單
                 =MESSAGEBOX('直接轉取消單功能尚未完成,請直接去C08作業',0+48,'提示訊息視窗')
                 RETURN
             ELSE                     
                IF SEEK(THISFORM.TXTF02.VALUE,'C03','C031')=.F. OR IIF(SEEK(THISFORM.TXTF02.VALUE,'C03','C031'),C03.F15,'')<>IIF(ADV='2','1','2') OR IIF(SEEK(THISFORM.TXTF02.VALUE,'C03','C031'),C03.F03,'')<>RK
                   =MESSAGEBOX('現有'+IIF(ADV='2','正式','預購')+'訂單無此單據編號!',0+48,'提示訊息視窗')
                   THISFORM.TXTF02.SETFOCUS
                   RETURN
                ELSE
                   SELECT C04
                   SET ORDER TO C041
                   SEEK THISFORM.TXTF02.VALUE+STK_NO
                   IF FOUND()
                      REPLACE F05 WITH F05+THISFORM.TXTF04.VALUE
                      REPLACE F08 WITH F08+F07*THISFORM.TXTF04.VALUE
                      REPLACE F10 WITH F10+THISFORM.TXTF04.VALUE
                      REPLACE F15 WITH F15+THISFORM.TXTF04.VALUE                       
                   ELSE
                      APPEND BLANK
                      REPLACE F01 WITH DATE()
                      REPLACE F02 WITH RK
                      REPLACE F03 WITH THISFORM.TXTF02.VALUE
                      REPLACE F04 WITH STK_NO
                      REPLACE F05 WITH THISFORM.TXTF04.VALUE
                      REPLACE F06 WITH CKS
                      REPLACE F07 WITH UNIT_PRICE
                      REPLACE F08 WITH THISFORM.TXTF04.VALUE*UNIT_PRICE     
                      REPLACE F10 WITH THISFORM.TXTF04.VALUE
                      REPLACE F12 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')   
                      REPLACE F13 WITH SPECIAL_DSCRP
                      REPLACE F15 WITH THISFORM.TXTF04.VALUE  
                      REPLACE F17 WITH CUS_STCK       
                      REPLACE F25 WITH ZINSU                    
                   ENDIF   
                   SELECT C03
                   SET ORDER TO C031
                   SEEK THISFORM.TXTF02.VALUE
                   IF FOUND()
                      REPLACE F04 WITH F04+C04.F08               
                   ENDIF 
                   SELECT C05
                   SET ORDER TO C054
                   SEEK THISFORM.TXTF02.VALUE+STK_NO+DTOS(THISFORM.TXTF03.VALUE)
                   IF FOUND()
                      REPLACE F04 WITH F04+THISFORM.TXTF04.VALUE
                   ELSE
                      APPEND BLANK
                      REPLACE F01 WITH THISFORM.TXTF02.VALUE
                      REPLACE F02 WITH STK_NO
                      REPLACE F03 WITH THISFORM.TXTF03.VALUE
                      REPLACE F04 WITH THISFORM.TXTF04.VALUE
                      REPLACE F06 WITH RK
                      REPLACE F07 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')   
                      REPLACE F08 WITH C03.F07
                      REPLACE F09 WITH IIF(ADV='2','','預購')+C03.F14
                      REPLACE F13 WITH IIF(SEEK(F06,'C01'),C01.F23,'')
                      REPLACE F15 WITH IIF(ADV='2','1','2')    
                   ENDIF                         
                ENDIF                                                  
             ENDIF   
          ELSE       &&如果重新產生單號
             IF THISFORM.PO_TPE.VALUE=1 AND SEEK(CUS_PO,'C03','C032')  &&判斷客戶PO是否會重覆
                =MESSAGEBOX('此客戶PO目前已有正式單號!請選擇轉入現有正式單號',0+48,'提視訊息視窗')
                THISFORM.REL_TPE.VALUE=2
                THISFORM.PO_TPE.VALUE=1
                THISFORM.PO_TPE.VISIBLE=.F.
                THISFORM.TXTF14.VALUE=''
                THISFORM.TXTF14.VISIBLE=.F.
                THISFORM.LBLF02.VISIBLE=.T.
                THISFORM.TXTF02.VISIBLE=.T.
                THISFORM.TXTF02.VALUE=IIF(SEEK(CUS_PO,'C03','C032'),C03.F02,'')
                THISFORM.TXTF02.SETFOCUS 
                RETURN
             ELSE         
                HD='C001 '+SUBSTR(DTOS(DATE()),3,4)
                HD1='C001 '
                HD2='CA'
                HD3='業務訂單'
                IF !USED('A09')
                   SELECT 0
                   USE A09
                ELSE
                   SELECT A09
                ENDIF
                SET ORDER TO 1      
                A24='A24'+LEFT(DTOS(DATE()),6)
                IF !USED('&A24')
                   SELE 0
                   USE (A24) ALIA A24
                ELSE
                   SELE A24
                ENDIF
                SET ORDER TO 1                                     
                DO ODR_CRT  &&執行主程式單據流水編號
                SELECT A24
                USE
                SELECT A09
                USE
                IF SEEK(PO_NO,'C03')=.T.   &&如果單號重複
                   SELECT MAX(F02) FROM C03 INTO ARRAY GB NOWAIT
                   HD='C001 '+SUBSTR(DTOS(DATE()),3,4)+PO_NO
                   IF !USED('A09')
                      SELECT 0
                      USE A09
                   ELSE
                      SELECT A09
                   ENDIF
                   SET ORDER TO 1      
                   A24='A24'+LEFT(DTOS(DATE()),6)
                   IF !USED('&A24')
                      SELE 0
                      USE (A24) ALIA A24
                   ELSE
                      SELE A24
                   ENDIF
                   SET ORDER TO 1                                     
                   DO ODR_RPT   &&執行主程式中單據編號重複程序
                   SELECT A24
                   USE
                   SELECT A09
                   USE
                 ENDIF
                 SELE C03
                 SET ORDER TO C031
                 SEEK FTR_STR
                 CREATE CURSOR C03_K (F06 C(40),F07 C(5),F12 C(4),F13 C(20))                                 
                 SELECT C03_K
                 APPEND BLANK
                 REPLACE F06 WITH C03.F06
                 REPLACE F07 WITH C03.F07
                 REPLACE F12 WITH C03.F12
                 REPLACE F13 WITH C03.F13                 
                 SELECT C03
                 APPEND BLANK
                 REPLACE F01 WITH DATE()
                 REPLACE F02 WITH PO_NO
                 REPLACE F03 WITH RK
                 REPLACE F04 WITH F04+THISFORM.TXTF04.VALUE*UNIT_PRICE
                 REPLACE F05 WITH THISFORM.TXTF03.VALUE
                 REPLACE F06 WITH C03_K.F06
                 REPLACE F07 WITH C03_K.F07
                 REPLACE F09 WITH '由'+FTR_STR+'轉入'
                 REPLACE F10 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')   
                 REPLACE F12 WITH C03_K.F12
                 REPLACE F13 WITH C03_K.F13
                 REPLACE F14 WITH IIF(ADV='3','預購','')+IIF(THISFORM.PO_TPE.VALUE=1,CUS_PO,THISFORM.TXTF14.VALUE)
                 REPLACE F15 WITH IIF(ADV='2','1','2')
                 SELECT C04
                 APPEND BLANK
                 REPLACE F01 WITH DATE()
                 REPLACE F02 WITH RK
                 REPLACE F03 WITH PO_NO
                 REPLACE F04 WITH STK_NO
                 REPLACE F05 WITH THISFORM.TXTF04.VALUE
                 REPLACE F06 WITH C03_K.F12
                 REPLACE F07 WITH UNIT_PRICE
                 REPLACE F08 WITH F05*F07
                 REPLACE F10 WITH THISFORM.TXTF04.VALUE
                 REPLACE F13 WITH SPECIAL_DSCRP
                 REPLACE F15 WITH THISFORM.TXTF04.VALUE
                 REPLACE F17 WITH CUS_STCK
                 REPLACE F22 WITH UNIT_PRICE
                 REPLACE F25 WITH ZINSU
                 SELECT C05
                 APPEND BLANK
                 REPLACE F01 WITH PO_NO
                 REPLACE F02 WITH STK_NO
                 REPLACE F03 WITH THISFORM.TXTF03.VALUE
                 REPLACE F04 WITH THISFORM.TXTF04.VALUE
                 REPLACE F06 WITH RK
                 REPLACE F07 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')   
                 REPLACE F08 WITH C03.F07
                 REPLACE F09 WITH IIF(ADV='3','預購','')+IIF(THISFORM.PO_TPE.VALUE=1,CUS_PO,THISFORM.TXTF14.VALUE)
                 REPLACE F13 WITH IIF(SEEK(F06,'C01'),C01.F23,'')
                 REPLACE F15 WITH IIF(ADV='2','1','2')
                 SELECT C03_K
                 USE    
              ENDIF                
          ENDIF
          SELE C05                                            &&出貨計劃
          SET ORDER TO C054                 
          SEEK FTR_STR+STK_NO
          IF FOUND()
             QTY=THISFORM.TXTF04.VALUE
             DO WHILE F01+F02=FTR_STR+STK_NO
                DO CASE 
                   CASE QTY=F04 
                         DELETE 
                         EXIT
                   CASE QTY>F04                     
                        QTY=QTY+F04*(-1)  
                        DELETE      
                        SKIP
                   CASE QTY<F04                               
                        REPLACE  F04 WITH F04+QTY*(-1)             
                        IF F04<F14
                           REPLACE F14 WITH F04   &&已轉至HUB倉數量記錄
                        ENDIF                   
                        EXIT
                 ENDCASE
              ENDDO                                  
          ENDIF                                           
          SELECT C03
          SET ORDER TO C031
          SEEK FTR_STR
          SELECT C04
          SEEK FTR_STR+STK_NO
          IF FOUND()
             REPLACE F10 WITH F10+THISFORM.TXTF04.VALUE*(-1)
             REPLACE F21 WITH F21+THISFORM.TXTF04.VALUE 
             REPLACE F12 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')   
             IF F10<=0
                IF messagebox('此筆資料已全部轉入正式訂單是否直接刪除?',4+32+256,'請確認') = 6	 
                   SELECT C03
                   REPLACE F04 WITH F04+C04.F08*(-1)
                   SELECT C04
                   DELE 
                   SKIP -1
                   IF BOF()
                      GO TOP
                   ENDIF              
                ENDIF
             ENDIF
          ENDIF                               
          =MESSAGEBOX('已轉入正式訂單'+IIF(THISFORM.REL_TPE.VALUE=1,PO_NO,THISFORM.TXTF02.VALUE),0+48,'提示訊息視窗')
          IF THISFORM.REL_TPE.VALUE=2
             PO_NO=THISFORM.TXTF02.VALUE
          ENDIF
          THISFORM.CMND2.CLICK          
      ENDPROC
      procedure cmnd2.click      
          SELECT C03
          SET ORDER TO C031
          SEEK FTR_STR     
          SET ORDER TO &COD
          SELECT C04
         thisform.release         
      endproc     
enddefine            
*****************************交期自訂函數
FUNC DELIVER
     PARA BKK_NO,MAT
     qt_od=SPACE(0)
     sele C05
     SET ORDER TO  C054
     SEEK BKK_NO+MAT
     IF FOUND()
        DO WHILE F01+F02=BKK_NO+MAT
           IF INT_012=1
              qt_od=qt_od+TRANSFORM(VAL(LEFT(DTOS(F03),4))-1911,'@R ###')+RIGHT(DTOC(F03),6)+'->'+ALLTRIM(TRANSFORM(F04,'@J 99999999.99'))+SPACE(3)
           ELSE   
              qt_od=qt_od+DTOC(F03)+'→'+ALLTRIM(TRANSFORM(F04,'@J 9999999.99'))+SPACE(4)
           ENDIF   
           SKIP
        ENDDO
     ELSE
       qt_od=SPACE(0)
     ENDIF
     SELE C04
     RETURN qt_od