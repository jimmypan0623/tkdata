***客戶報價資料
close all
clear 
PRG_NO='C02'
FLG='0'
FCH=''
CHK=''
O_TP=''
R=0
AREA1='C01'
AREA2='C02'
IF !USED('C00')
   SELE 0
   USE C00
ELSE
   SELE C00
ENDIF
SET ORDER TO 1
IF ! USED('A01')
   SELE 0
   USE A01 INDE A01
ELSE
   SELE A01
ENDIF      
SET ORDER TO A01
IF !USED('A02')
   SELE 0
   USE A02 INDE A02
ELSE
   SELE A02
ENDIF
SET ORDER TO A021      
SEEK sys_oper+'C02'

IF !USED('B01')
   SELE 0
   USE B01 INDE B01
ELSE
   SELE B01
ENDIF
SET ORDER TO 1
IF !USED('C01')
   SELE 0
   USE C01 INDE C01
ELSE
   SELE C01
ENDIF
SET ORDER TO C011
 
IF !USED('C20')
   SELE 0
   USE C20 INDE C20
ELSE
   SELE C20
ENDIF
SET ORDER TO C201
IF !USED('C21')
   SELE 0
   USE C21 INDE C21
ELSE
   SELE C21
ENDIF
SET ORDER TO C211
if !used('C0B')
   SELE 0
   USE C0B
ELSE
   SELE C0B
ENDIF
SET ORDER TO 1    
if !used('C02')
   SELE 0
   USE C02
ELSE
   SELE C02
ENDIF
SET ORDER TO C021      
SET RELA TO F03 INTO B01 ADDI
SET RELATION TO F01+F03+F06+F12 INTO C21 ADDI
C02form=createobject("tkC02")
C02form.show  
define class tkC02 as form
  caption='C02.客戶報價紀錄'
*!*	  autocenter=.t.
  controlbox=.F.
  BORDERSTYLE=1  
  MAXBUTTON=.F.
  MINBUTTON=.F.
  MOVABLE=.F.
  CLOSABLE=.F.
  controlcount=57
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*550
  showtips=.t.
  showwindow=1
  WIDTH=INT_015*789
  windowtype=1
  NAME='TKC02'
  add object shape1 as shape1 with;
      autocenter=.t.

  ADD OBJECT LBL_REC AS LBL_REC WITH;
      AUTOCENTER =.T.
  ADD OBJECT REC_COUNT AS REC_COUNT  with;
      caption=str(reccount())        
  add object shape2 as shape2 with;
      autocenter=.t.
  add object shape3 as shape3 with;
      autocenter=.t.
  ADD OBJECT PAGEFRAME1 AS PAGEFRAME WITH;
      LEFT=INT_015*236,;
      WIDTH=INT_015*540,;
      HEIGHT=INT_015*210,;
      FONTSIZE=INT_015*9,;
      PAGECOUNT=2,;
      TABSTRETCH=1,;
      ACTIVEPAGE=1,;
      VISIBLE=.T.,;
      PAGE1.NAME='PAGE1',;
      PAGE1.VISIBLE=.T.,;
      PAGE1.CAPTION='依照客戶搜尋紀錄',;
      PAGE2.NAME='PAGE2',;
      PAGE2.VISIBLE=.T.,;
      PAGE2.CAPTION='詳細資料內容'   
  ADD OBJECT KEY_LIST AS KEY_LIST WITH;
      AUTOCENTER=.T.
  ADD OBJECT grid1 AS grid1 WITH;
      columncount=3,;            
      RECORDSOURCE='C01',;
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;
      COLUMN3.NAME='COLUMN3'      
  ADD OBJECT grid2 AS grid2 WITH;
      columncount=10,;            
      RECORDSOURCE='C02',;
      LINKMASTER='C01',;
      RELATIONALEXPR='F45',;
      CHILDORDER='C021',;      
      TOP=INT_015*210,;
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;
      COLUMN3.NAME='COLUMN3',;
      COLUMN4.NAME='COLUMN4',;
      COLUMN5.NAME='COLUMN5',;
      COLUMN6.NAME='COLUMN6',;
      COLUMN7.NAME='COLUMN7',;
      COLUMN8.NAME='COLUMN8',;
      COLUMN9.NAME='COLUMN9',;
      COLUMN10.NAME='COLUMN10'
  ADD OBJECT CMDGROUP AS CMDGROUP WITH;
      AUTOSIZE=.T.              
  ADD OBJECT ORPGROUP AS ORPGROUP WITH;    
      AUTOSIZE=.T.              
  ADD OBJECT SHRGROUP AS SHRGROUP WITH;
      TOP=INT_015*173,;
      LEFT=INT_015*558         
 ADD OBJECT TRNOD_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*490,;
      LEFT=INT_015*15,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*65,;
      FONTSIZE=INT_015*9,;    
      CAPTION='\<G.移至舊檔',;
      NAME='TRNOD_BOTT'                          
 ADD OBJECT ODCHK_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*490,;
      LEFT=INT_015*85,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*65,;
      FONTSIZE=INT_015*9,;    
      CAPTION='\<V.查詢舊檔',;
      NAME='ODCHK_BOTT'                          
 ADD OBJECT EXCEL_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*490,;
      LEFT=INT_015*152,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*65,;
      FONTSIZE=INT_015*9,;    
      CAPTION='\<T.轉EXCEL',;
      NAME='EXCEL_BOTT'                            
  PROCEDURE PAGEFRAME1.PAGE1.INIT     
     THIS.ADDOBJECT('LBLF01','LABEL')
     WITH THIS.LBLF01
          .VISIBLE=.T.
          .LEFT=INT_015*14
          .TOP=INT_015*27
          .WIDTH=INT_015*50
          .CAPTION='客戶編號'          
     ENDWITH
     THIS.ADDOBJECT('LBLF011','LABEL')     
     WITH THIS.LBLF011
          .VISIBLE=.T.
          .LEFT=INT_015*140
          .TOP=INT_015*27
          .AUTOSIZE=.T.  
     ENDWITH            
     THIS.ADDOBJECT('TXTF01','TEXTBOX')     
     WITH THIS.TXTF01
          .VISIBLE=.T.
          .LEFT=INT_015*64
          .TOP=INT_015*23
          .WIDTH=INT_015*74
          .HEIGHT=INT_015*25
          .MAXLENGTH=5
     ENDWITH        
      THIS.ADDOBJECT('LBLF45','LABEL')     
          WITH THIS.LBLF45
          .VISIBLE=.T.
          .LEFT=INT_015*14
          .TOP=INT_015*77
          .WIDTH=INT_015*50
          .CAPTION='報價統編'          
     ENDWITH
     
     THIS.ADDOBJECT('TXTF45','TEXTBOX')     
     WITH THIS.TXTF45
          .VISIBLE=.T.
          .LEFT=INT_015*64
          .TOP=INT_015*73
          .WIDTH=INT_015*74
          .HEIGHT=INT_015*25
          .MAXLENGTH=5
     ENDWITH        
  ENDPROC   
  PROCEDURE PAGEFRAME1.PAGE2.INIT
	THIS.ADDOBJECT('LBLF01','LABEL')
	WITH THIS.LBLF01  
         .LEFT=INT_015*14
         .TOP=INT_015*13
	     .WIDTH=INT_015*50
         .CAPTION='客戶編號'
    ENDWITH  
    THIS.ADDOBJECT('LBLF011','LABEL')
    WITH THIS.LBLF011
         .LEFT=INT_015*126
	     .TOP=INT_015*14
	     .autosize=.t.
	ENDWITH     
    THIS.ADDOBJECT('LBLF03','LABEL')
    WITH THIS.LBLF03
         .VISIBLE=.T.
	     .LEFT=INT_015*14
	     .TOP=INT_015*14
	     .WIDTH=INT_015*50
	     .CAPTION='品        號'
	ENDWITH     
    THIS.ADDOBJECT('LBLF031','Label')
    WITH THIS.LBLF031
         .VISIBLE=.T.
         .LEFT=INT_015*327
         .TOP=INT_015*14
         .WIDTH=INT_015*144         
    ENDWITH     
    THIS.ADDOBJECT('LBLF04','LABEL')
    WITH THIS.LBLF04
         .VISIBLE=.T.    
         .LEFT=INT_015*14
         .TOP=INT_015*39
         .WIDTH=INT_015*50
         .CAPTION='客戶品號'       
    ENDWITH     
    THIS.ADDOBJECT('LBLF02','LABEL')      
    WITH THIS.LBLF02
         .VISIBLE=.T.       
         .LEFT=INT_015*328
         .TOP=INT_015*39
         .WIDTH=INT_015*50
         .CAPTION='生效日期'
    ENDWITH     
    THIS.ADDOBJECT('LBLF05','LABEL')
    WITH THIS.LBLF05
         .VISIBLE=.T.           
         .LEFT=INT_015*14
         .TOP=INT_015*64
         .WIDTH=INT_015*50
         .CAPTION='單        位'
    ENDWITH     
    THIS.ADDOBJECT('LBLF06','LABEL')
    WITH THIS.LBLF06
         .VISIBLE=.T.           
         .LEFT=INT_015*170
         .TOP=INT_015*64
         .WIDTH=INT_015*50
         .CAPTION='幣        別'
    ENDWITH     
    THIS.ADDOBJECT('LBLF07','LABEL')
    WITH THIS.LBLF07
         .VISIBLE=.T.           
         .LEFT=INT_015*328
         .TOP=INT_015*64
         .WIDTH=INT_015*50
         .CAPTION='單        價'
    ENDWITH     
    THIS.ADDOBJECT('LBLF13','LABEL')
    WITH THIS.LBLF13
         .VISIBLE=.T.           
         .LEFT=INT_015*14
         .TOP=INT_015*89
         .WIDTH=INT_015*50
         .CAPTION='包裝基量'               
    ENDWITH  
    THIS.ADDOBJECT('LBLF14','LABEL')
    WITH THIS.LBLF14
         .VISIBLE=.T.           
         .LEFT=INT_015*170
         .TOP=INT_015*89
         .WIDTH=INT_015*50
         .CAPTION='包裝數量'               
    ENDWITH 
    THIS.ADDOBJECT('LBLF08','LABEL')
    WITH THIS.LBLF08
        .VISIBLE=.T.           
        .LEFT=INT_015*328
        .TOP=INT_015*89
        .WIDTH=INT_015*50
        .CAPTION='最少出貨'         
    ENDWITH    
    THIS.ADDOBJECT('LBLF09','LABEL')
    WITH THIS.LBLF09
         .VISIBLE=.T.           
         .LEFT=INT_015*14
         .TOP=INT_015*114
         .WIDTH=INT_015*50
         .CAPTION='前置日數'         
    ENDWITH     
    THIS.ADDOBJECT('LBLF15','LABEL')
    WITH THIS.LBLF15
         .VISIBLE=.T.           
         .LEFT=INT_015*170
         .TOP=INT_015*114
         .WIDTH=INT_015*50
         .CAPTION='有效期限'         
    ENDWITH         
    THIS.ADDOBJECT('LBLF12','LABEL')
    WITH THIS.LBLF12
         .VISIBLE=.T.           
         .LEFT=INT_015*14
         .TOP=INT_015*139
         .WIDTH=INT_015*50
         .CAPTION='特價代碼'         
    ENDWITH             

    THIS.ADDOBJECT('LBLF121','LABEL')
    WITH THIS.LBLF121
         .VISIBLE=.T.           
         .LEFT=INT_015*85
         .TOP=INT_015*139
         .AUTOSIZE=.T.
         .CAPTION=''         
    ENDWITH                     
    THIS.ADDOBJECT('LBLF10','LABEL')
    WITH THIS.LBLF10
         .VISIBLE=.T.           
         .LEFT=INT_015*328
         .TOP=INT_015*114
         .WIDTH=INT_015*50
         .CAPTION='其他備註'         
    ENDWITH     
    THIS.ADDOBJECT('LBLF11','LABEL')
    WITH THIS.LBLF11
         .VISIBLE=.T.           
         .LEFT=INT_015*14
         .TOP=INT_015*164
         .WIDTH=INT_015*50
         .CAPTION='報價單號'          
    ENDWITH     
     
    THIS.ADDOBJECT('LBLTRAT','LABEL')
    WITH THIS.LBLTRAT
         .VISIBLE=IIF(A02.F08='*',.T.,.F.)
         .LEFT=INT_015*328
         .TOP=INT_015*139
         .WIDTH=INT_015*50
         .CAPTION='毛利率%'          
    ENDWITH     
    THIS.ADDOBJECT('LBLTRAT1','LABEL')
    WITH THIS.LBLTRAT1
         .VISIBLE=IIF(A02.F08='*',.T.,.F.)   
         .LEFT=INT_015*379
         .TOP=INT_015*139
         .AUTOSIZE=.T.          
    ENDWITH     
    THIS.ADDOBJECT('LBLF99','LABEL')
    WITH THIS.LBLF99
         .VISIBLE=.T.           
         .LEFT=INT_015*328
         .TOP=INT_015*164
         .WIDTH=INT_015*50
         .CAPTION='安全資料'          
    ENDWITH     
    THIS.ADDOBJECT('LBLF991','LABEL')
    WITH THIS.LBLF991
         .VISIBLE=.T.           
         .LEFT=INT_015*379
         .TOP=INT_015*164
         .AUTOSIZE=.T.          
    ENDWITH     
	THIS.ADDOBJECT('TXTF01','TXTF01')
	WITH THIS.TXTF01      
	     .LEFT=INT_015*65
	     .TOP=INT_015*10
	     .WIDTH=INT_015*60
	     .HEIGHT=INT_015*25
	     .MAXLENGTH=5
	     .NAME='TXTF01'  
	ENDWITH     
	THIS.ADDOBJECT('TXTF03','TXTF03')
	WITH THIS.TXTF03
	     .VISIBLE=.T.
	     .LEFT=INT_015*65
	     .TOP=INT_015*10
	     .WIDTH=INT_015*261
	     .HEIGHT=INT_015*25
	     .MAXLENGTH=43
	     .NAME='TXTF03'	    
	ENDWITH     
    THIS.ADDOBJECT('TXTF04','TEXTBOX')
    WITH THIS.TXTF04
         .VISIBLE=.T.           
         .LEFT=INT_015*65
         .TOP=INT_015*35
         .WIDTH=INT_015*261
         .MAXLENGTH=30
         .NAME='TXTF04'
    ENDWITH     
    THIS.ADDOBJECT('TXTF02','TEXTBOX')
    WITH THIS.TXTF02
         .VISIBLE=.T.           
         .LEFT=INT_015*379
         .TOP=INT_015*35
         .WIDTH=INT_015*74
         .HEIGHT=INT_015*25
         .NAME='TXTF02'                            
    ENDWITH     
    THIS.ADDOBJECT('TXTF05','TEXTBOX')
    WITH THIS.TXTF05     
         .VISIBLE=.T.           
         .LEFT=INT_015*65
         .TOP=INT_015*60
         .WIDTH=INT_015*44
         .MAXLENGTH=4
         .NAME='TXTF05'
    ENDWITH     
    THIS.ADDOBJECT('TXTF06','TEXTBOX')
    WITH THIS.TXTF06
         .VISIBLE=.T.           
         .LEFT=INT_015*220
         .TOP=INT_015*60
         .WIDTH=INT_015*70
         .MAXLENGTH=4
         .NAME='TXTF06'                 
    ENDWITH     
    THIS.ADDOBJECT('CRCY','CRCY')
    THIS.ADDOBJECT('TXTF07','TEXTBOX')
    WITH THIS.TXTF07
         .VISIBLE=.T.           
         .LEFT=INT_015*379
         .TOP=INT_015*60
         .WIDTH=INT_015*118
         .INPUTMASK='999999999.999999'
         .NAME='TXTF07'
    ENDWITH     
    THIS.ADDOBJECT('TXTF13','TEXTBOX')
    WITH THIS.TXTF13
         .VISIBLE=.T.           
         .LEFT=INT_015*65
         .TOP=INT_015*85
         .WIDTH=INT_015*70
         .INPUTMASK='99999999.99'
         .NAME='TXTF13'                       
    ENDWITH  
    THIS.ADDOBJECT('TXTF14','TEXTBOX')
    WITH THIS.TXTF14
         .VISIBLE=.T.           
         .LEFT=INT_015*220
         .TOP=INT_015*85
         .WIDTH=INT_015*70
         .INPUTMASK='9999999999'
         .NAME='TXTF14'                       
    ENDWITH  
    THIS.ADDOBJECT('TXTF08','TEXTBOX')
    WITH THIS.TXTF08
         .VISIBLE=.T.           
         .LEFT=INT_015*379
         .TOP=INT_015*85
         .WIDTH=INT_015*118
         .INPUTMASK='99999999.99'
         .NAME='TXTF08'
    ENDWITH     
    THIS.ADDOBJECT('TXTF09','TEXTBOX')    
    WITH THIS.TXTF09
         .VISIBLE=.T.           
         .LEFT=INT_015*65
         .TOP=INT_015*110
         .WIDTH=INT_015*74
         .INPUTMASK='999'
         .NAME='TXTF09'              
    ENDWITH     
    THIS.ADDOBJECT('TXTF15','TEXTBOX')    
    WITH THIS.TXTF15
         .VISIBLE=.T.           
         .LEFT=INT_015*220
         .TOP=INT_015*110
         .WIDTH=INT_015*80          
         .NAME='TXTF15'              
    ENDWITH         
    THIS.ADDOBJECT('TXTF10','TEXTBOX')
    WITH THIS.TXTF10
         .VISIBLE=.T.           
         .LEFT=INT_015*379
         .TOP=INT_015*110
         .WIDTH=INT_015*80
         .MAXLENGTH=10
         .NAME='TXTF10'                   
    ENDWITH
    THIS.ADDOBJECT('TXTF12','TXTF12')
    WITH THIS.TXTF12
         .VISIBLE=.T.           
         .LEFT=INT_015*65
         .TOP=INT_015*135
         .WIDTH=INT_015*20
         .HEIGHT=INT_015*25
         .MAXLENGTH=1
         .NAME='TXTF12'                   
         .BACKCOLOR=RGB(255,255,100)
         .MOUSEPOINTER=99
         .MOUSEICON='BMPS\harrow.cur'         
    ENDWITH        
    THIS.ADDOBJECT('TXTF11','TEXTBOX')
    WITH THIS.TXTF11
         .VISIBLE=.T.           
         .LEFT=INT_015*65
         .TOP=INT_015*160
         .WIDTH=INT_015*80
         .MAXLENGTH=10
         .NAME='TXTF11'                   
    ENDWITH
  ENDPROC       
  PROCEDURE PAGEFRAME1.PAGE1.activate
     R=0
     IF THISFORM.KEY_LIST.DISPLAYVALUE='依客戶編號排列'
        SELE C01
     ELSE
        SELE B01
     ENDIF      
     SEEK THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE     
     THISFORM.GRID1.ENABLED=.T.          
     THISFORM.GRID1.SETFOCUS     
     IF THISFORM.GRID1.ACTIVEROW=0
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
        THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=''
        THISFORM.PAGEFRAME1.PAGE1.LBLF011.CAPTION=''
        THISFORM.EXCEL_BOTT.ENABLED=.F.
     ELSE
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.
        THISFORM.EXCEL_BOTT.ENABLED=IIF(A02.F09='*',.T.,.F.)      
        THISFORM.TRNOD_BOTT.ENABLED=(A02.F10='*') OR ((sys_oper=C01.F18 OR sys_oper=C01.F23 OR sys_oper=C01.F33) AND AREA1='C01')
     ENDIF   
     THISFORM.ORPGROUP.NEW_BOTT.ENABLED=.F. 
     THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
     THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
     THISFORM.ODCHK_BOTT.ENABLED=.T.
     THISFORM.KEY_LIST.ENABLED=.T.
  ENDPROC
  PROCEDURE PAGEFRAME1.PAGE2.activate
       SELE C02 
     IF THISFORM.SHRGROUP.ENABLED=.F.
        THISFORM.GRID2.READONLY=.T.    
        THISFORM.GRID2.SETFOCUS    
     ENDIF 
     IF THISFORM.GRID2.ACTIVEROW=0 .and. thisform.SHRGROUP.ENABLED=.F.
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
        THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
        THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
        THISFORM.TRNOD_BOTT.ENABLED=.F.
        THISFORM.ODCHK_BOTT.ENABLED=.F.
        THISFORM.PAGEFRAME1.PAGE2.SETALL('VALUE','','TEXTBOX')
        THISFORM.PAGEFRAME1.PAGE2.TXTF01.VALUE=''
        THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=''
        THISFORM.PAGEFRAME1.PAGE2.LBLF011.CAPTION=''
        THISFORM.PAGEFRAME1.PAGE2.LBLF031.CAPTION=''         
        THISFORM.PAGEFRAME1.PAGE2.LBLTRAT1.CAPTION=''        
     ELSE
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.
        THISFORM.TRNOD_BOTT.ENABLED=(A02.F10='*') OR ((sys_oper=C01.F18 OR sys_oper=C01.F23 OR sys_oper=C01.F33) AND AREA1='C01')
        THISFORM.ODCHK_BOTT.ENABLED=.T.
        THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  &&判斷有無修改的權限
        THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)   &&判斷有無刪除的權限
        THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限  
        IF AREA1='C01'
           CHK=THISFORM.PAGEFRAME1.PAGE1.TXTF45.VALUE
        ELSE
           CHK=THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
        ENDIF
     ENDIF   
     R=RECNO('&AREA1')
     THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(RECNO('&AREA1')=R,RGB(255,255,0),'')","COLUMN")
     THISFORM.GRID1.ENABLED=.F.     
     THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.)   &&判斷有無新增的權限
     THISFORM.KEY_LIST.ENABLED=.F.     
     THISFORM.EXCEL_BOTT.ENABLED=.F.
  ENDPROC   

  PROC INIT              
       THISFORM.PAGEFRAME1.PAGE1.FONTSIZE=INT_015*9
       THISFORM.PAGEFRAME1.PAGE2.FONTSIZE=INT_015*9    
       THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限  
       THISFORM.SETALL('HEIGHT',INT_015*25,'TEXTBOX')
       THISFORM.SETALL('HEIGHT',INT_015*17,'LABEL')
       THISFORM.SETALL('FONTSIZE',INT_015*9,'TEXTBOX')
       THISFORM.SETALL('FONTSIZE',INT_015*9,'LABEL')       
       THISFORM.SETALL('READONLY',.T.,'TEXTBOX')
       THISFORM.SHRGROUP.VISIBLE=.F.
       THISFORM.SHRGROUP.ENABLED=.F.
       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*50
       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*129
       THISFORM.GRID1.COLUMN3.WIDTH=INT_015*50
       THISFORM.GRID1.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)
       THISFORM.GRID2.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)
       thisform.GRID1.setall('FONTSIZE',INT_015*9,'COLUMN')
       thisform.GRID1.setall('FONTSIZE',INT_015*9,'HEADER')         
       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='客戶編號'
       THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='客戶簡稱'
       THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='報價統編'
       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='C01.F01'
       THISFORM.GRID1.COLUMN2.CONTROLSOURCE='C01.F04'
       THISFORM.GRID1.COLUMN3.CONTROLSOURCE='C01.F45'
       THISFORM.grid2.COLUMN1.HEADER1.CAPTION='料品編號'
       THISFORM.grid2.COLUMN2.HEADER1.CAPTION='品名規格'
	   THISFORM.grid2.COLUMN3.HEADER1.CAPTION='生效日期'
	   THISFORM.grid2.COLUMN4.HEADER1.CAPTION='特價原因描述'
	   THISFORM.grid2.COLUMN5.HEADER1.CAPTION='幣別'
	   THISFORM.grid2.COLUMN6.HEADER1.CAPTION='單       價'
	   THISFORM.grid2.COLUMN7.HEADER1.CAPTION='包裝基量'
	   THISFORM.grid2.COLUMN8.HEADER1.CAPTION='最少採購'
	   THISFORM.grid2.COLUMN9.HEADER1.CAPTION='採購前置'
	   THISFORM.grid2.COLUMN10.HEADER1.CAPTION='其他備註'  
       thisform.GRID2.setall('FONTSIZE',INT_015*9,'COLUMN')
       thisform.GRID2.setall('FONTSIZE',INT_015*9,'HEADER')	        	   
	   THISFORM.grid2.COLUMN1.CONTROLSOURCE='C02.F03'
	   THISFORM.grid2.COLUMN2.CONTROLSOURCE='C02.F16'
	   THISFORM.grid2.COLUMN3.CONTROLSOURCE='C02.F02'
	   THISFORM.grid2.COLUMN4.CONTROLSOURCE='C21.F05'
	   THISFORM.grid2.COLUMN5.CONTROLSOURCE='C02.F06'
	   THISFORM.grid2.COLUMN6.CONTROLSOURCE='C02.F07'
	   THISFORM.grid2.COLUMN7.CONTROLSOURCE='C02.F13'
	   THISFORM.grid2.COLUMN8.CONTROLSOURCE='C02.F08'
	   THISFORM.grid2.COLUMN9.CONTROLSOURCE='C02.F09'
	   THISFORM.grid2.COLUMN10.CONTROLSOURCE='C02.F10'
	   THISFORM.grid2.COLUMN1.WIDTH=INT_015*149
	   THISFORM.GRID2.COLUMN2.WIDTH=INT_015*100
       THISFORM.grid2.COLUMN3.WIDTH=INT_015*65
       THISFORM.GRID2.COLUMN4.WIDTH=INT_015*100
       THISFORM.GRID2.COLUMN5.WIDTH=INT_015*30
       THISFORM.GRID2.COLUMN6.WIDTH=INT_015*100
        THISFORM.EXCEL_BOTT.VISIBLE=IIF(A02.F09='*',.T.,.F.)             
       IF A02.F08='*'
           THISFORM.GRID2.SETALL("DYNAMICBACKCOLOR","IIF(C02.F15<DATE(),RGB(255,255,0),IIF(C02.F07*IIF(SEEK(C02.F06,'C00'),C00.F02,1)-B01.F38<0,RGB(255,0,0),''))","COLUMN")        
        ELSE
           THISFORM.GRID2.SETALL("DYNAMICBACKCOLOR","IIF(C02.F15<DATE(),RGB(255,255,0),'')","COLUMN") 
        ENDIF   
       THISFORM.grid1.READONLY=.T.  
       THISFORM.GRID2.READONLY=.T.     
       THISFORM.grid1.SETFOCUS
       IF THISFORM.GRID1.ACTIVEROW=0
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
       ELSE
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.      
       ENDIF          
       THISFORM.KEY_LIST.DISPLAYVALUE='依客戶編號排列'       
       JK='客戶編號'
       SELE C01
       GO TOP
       THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=C01.F01
       THISFORM.PAGEFRAME1.PAGE1.LBLF011.CAPTION=C01.F04
  ENDPROC     
  PROC KEY_LIST.INIT 
       with this 
           .additem('依客戶編號排列')
           .additem('依料品編號排列')
       endwith      
  ENDPROC 
  PROC KEY_LIST.INTERACTIVECHANGE                
     
       SELE C01
       SET RELA OFF INTO C02
       SELE B01
       SET RELA OFF INTO C02
       SELE C02
       SET RELA OFF INTO C01
       SET RELA OFF INTO B01       
       SET RELATION OFF INTO C21
       THISFORM.GRID1.RECORDSOURCE=''
       THISFORM.GRID1.CHILDORDER=''
       THISFORM.GRID2.LINKMASTER=''
       THISFORM.GRID2.RELATIONALEXPR=''
       THISFORM.GRID2.CHILDORDER=''
       DO CASE
          CASE THIS.DISPLAYVALUE='依客戶編號排列'
               THISFORM.PAGEFRAME1.PAGE1.CAPTION='依照客戶搜尋紀錄'
               SELE C01
               GO TOP
               AREA1='C01'
               SELE C02
               SET ORDER TO C021     
               SET RELATION  TO F03 INTO B01       
               SET RELATION TO F01+F03+F06+F12 INTO C21 ADDI                  
               THISFORM.PAGEFRAME1.PAGE1.LBLF01.CAPTION='客戶編號'
               THISFORM.PAGEFRAME1.PAGE1.TXTF01.WIDTH=INT_015*74
               THISFORM.PAGEFRAME1.PAGE1.TXTF01.MAXLENGTH=5
               THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=C01.F01
               THISFORM.PAGEFRAME1.PAGE1.LBLF011.LEFT=INT_015*140
               THISFORM.PAGEFRAME1.PAGE1.LBLF011.CAPTION=C01.F04
               THISFORM.PAGEFRAME1.PAGE2.LBLF01.VISIBLE=.F.
               THISFORM.PAGEFRAME1.PAGE2.LBLF011.VISIBLE=.F.
               THISFORM.PAGEFRAME1.PAGE2.TXTF01.VISIBLE=.F.
               THISFORM.PAGEFRAME1.PAGE2.TXTF01.ENABLED=.F.
               THISFORM.PAGEFRAME1.PAGE2.LBLF03.VISIBLE=.T.
               THISFORM.PAGEFRAME1.PAGE2.LBLF031.VISIBLE=.T.
               THISFORM.PAGEFRAME1.PAGE2.TXTF03.VISIBLE=.T.
               THISFORM.PAGEFRAME1.PAGE2.TXTF03.ENABLED=.T.
               THISFORM.GRID1.RECORDSOURCE='C01'
                THISFORM.PAGEFRAME1.PAGE1.LBLF45.VISIBLE=.T.
               THISFORM.PAGEFRAME1.PAGE1.TXTF45.VISIBLE=.T.
               THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='客戶編號'
               THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='客戶簡稱'
               THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='報價統編'
               THISFORM.GRID1.COLUMN1.CONTROLSOURCE='C01.F01'
               THISFORM.GRID1.COLUMN2.CONTROLSOURCE='C01.F04'   
               THISFORM.GRID1.COLUMN3.CONTROLSOURCE='C01.F45'   
               THISFORM.GRID1.COLUMN1.WIDTH=INT_015*50
               THISFORM.GRID1.COLUMN2.WIDTH=INT_015*129
               THISFORM.GRID1.COLUMN3.WIDTH=INT_015*50
               THISFORM.TRNOD_BOTT.ENABLED=(A02.F10='*') OR ((sys_oper=C01.F18 OR sys_oper=C01.F23 OR sys_oper=C01.F33) AND AREA1='C01')
               THISFORM.GRID2.LINKMASTER='C01'
               THISFORM.GRID2.RELATIONALEXPR='F45'
               THISFORM.GRID2.CHILDORDER='C021'            
               THISFORM.grid2.COLUMN1.HEADER1.CAPTION='料品編號'
               THISFORM.grid2.COLUMN1.CONTROLSOURCE='C02.F03'
               THISFORM.grid2.COLUMN1.WIDTH=INT_015*149
               THISFORM.grid2.COLUMN2.HEADER1.CAPTION='品名規格'
               THISFORM.grid2.COLUMN2.CONTROLSOURCE='C02.F16'   
               THISFORM.grid2.COLUMN2.WIDTH=INT_015*100           
	           THISFORM.grid2.COLUMN3.HEADER1.CAPTION='生效日期'
	           THISFORM.grid2.COLUMN4.HEADER1.CAPTION='特價原因描述'
	           THISFORM.grid2.COLUMN5.HEADER1.CAPTION='幣別'
	           THISFORM.grid2.COLUMN6.HEADER1.CAPTION='單       價'
	           THISFORM.grid2.COLUMN7.HEADER1.CAPTION='包裝基量'
	           THISFORM.grid2.COLUMN8.HEADER1.CAPTION='最少採購'
	           THISFORM.grid2.COLUMN9.HEADER1.CAPTION='採購前置'
	           THISFORM.grid2.COLUMN10.HEADER1.CAPTION='其他備註'      
	           THISFORM.grid2.COLUMN3.CONTROLSOURCE='C02.F02'
	           THISFORM.grid2.COLUMN4.CONTROLSOURCE='C21.F05'
	           THISFORM.grid2.COLUMN5.CONTROLSOURCE='C02.F06'
	           THISFORM.grid2.COLUMN6.CONTROLSOURCE='C02.F07'
	           THISFORM.grid2.COLUMN7.CONTROLSOURCE='C02.F13'
	           THISFORM.grid2.COLUMN8.CONTROLSOURCE='C02.F08'
	           THISFORM.grid2.COLUMN9.CONTROLSOURCE='C02.F09'
	           THISFORM.grid2.COLUMN10.CONTROLSOURCE='C02.F10'      
	           THISFORM.grid2.COLUMN3.WIDTH=INT_015*65
               THISFORM.GRID2.COLUMN4.WIDTH=INT_015*100
               THISFORM.GRID2.COLUMN5.WIDTH=INT_015*30
               THISFORM.GRID2.COLUMN6.WIDTH=INT_015*100
          CASE THIS.DISPLAYVALUE='依料品編號排列'
               THISFORM.PAGEFRAME1.PAGE1.CAPTION='依照料號搜尋紀錄'          
               SELE B01
               GO TOP
               AREA1='B01'
               SELE C02
               SET ORDER TO C022
               SET RELATION  TO F01 INTO C01
               SET RELATION TO F01+F03+F06+F12 INTO C21 ADDI                                 
               THISFORM.PAGEFRAME1.PAGE1.LBLF01.CAPTION='料品編號'
               THISFORM.PAGEFRAME1.PAGE1.TXTF01.WIDTH=INT_015*261
               THISFORM.PAGEFRAME1.PAGE1.TXTF01.MAXLENGTH=43
               THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=B01.F01
               THISFORM.PAGEFRAME1.PAGE1.LBLF011.LEFT=INT_015*337
               THISFORM.PAGEFRAME1.PAGE1.LBLF011.CAPTION=B01.F02
               THISFORM.PAGEFRAME1.PAGE1.LBLF45.VISIBLE=.F.
               THISFORM.PAGEFRAME1.PAGE1.TXTF45.VISIBLE=.F.
               THISFORM.PAGEFRAME1.PAGE2.LBLF01.VISIBLE=.T.
               THISFORM.PAGEFRAME1.PAGE2.LBLF011.VISIBLE=.T.
               THISFORM.PAGEFRAME1.PAGE2.TXTF01.VISIBLE=.T.
               THISFORM.PAGEFRAME1.PAGE2.TXTF01.ENABLED=.T.
               THISFORM.PAGEFRAME1.PAGE2.LBLF03.VISIBLE=.F.
               THISFORM.PAGEFRAME1.PAGE2.LBLF031.VISIBLE=.F.
               THISFORM.PAGEFRAME1.PAGE2.TXTF03.VISIBLE=.F.
               THISFORM.PAGEFRAME1.PAGE2.TXTF03.ENABLED=.F.           
               THISFORM.GRID1.RECORDSOURCE='B01'
               THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='料品編號'
               THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='品名規格'
               THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='前置天數'
               THISFORM.GRID1.COLUMN1.CONTROLSOURCE='B01.F01'
               THISFORM.GRID1.COLUMN2.CONTROLSOURCE='B01.F02'
               THISFORM.GRID1.COLUMN3.CONTROLSOURCE='B01.F28'
               THISFORM.GRID1.COLUMN1.WIDTH=INT_015*149
               THISFORM.GRID1.COLUMN2.WIDTH=INT_015*149 
               THISFORM.GRID1.COLUMN2.WIDTH=INT_015*50   
               THISFORM.GRID2.LINKMASTER='B01'
               THISFORM.GRID2.RELATIONALEXPR='F01'
               THISFORM.GRID2.CHILDORDER='C022'  
               THISFORM.grid2.COLUMN1.HEADER1.CAPTION='客戶編號'
               THISFORM.grid2.COLUMN1.CONTROLSOURCE='C02.F01'
               THISFORM.grid2.COLUMN1.WIDTH=INT_015*50               
               THISFORM.grid2.COLUMN2.HEADER1.CAPTION='客戶簡稱'
               THISFORM.grid2.COLUMN2.CONTROLSOURCE='C01.F04'       
               THISFORM.grid2.COLUMN2.WIDTH=INT_015*50        
               THISFORM.grid2.COLUMN3.HEADER1.CAPTION='生效日期'
	           THISFORM.grid2.COLUMN4.HEADER1.CAPTION='特價原因描述'
	           THISFORM.grid2.COLUMN5.HEADER1.CAPTION='其他備註'  
	           THISFORM.grid2.COLUMN6.HEADER1.CAPTION='幣別'
	           THISFORM.grid2.COLUMN7.HEADER1.CAPTION='單       價'
	           THISFORM.grid2.COLUMN8.HEADER1.CAPTION='包裝基量'
	           THISFORM.grid2.COLUMN9.HEADER1.CAPTION='最少採購'
	           THISFORM.grid2.COLUMN10.HEADER1.CAPTION='採購前置'
	               
	           THISFORM.grid2.COLUMN3.CONTROLSOURCE='C02.F02'
	           THISFORM.grid2.COLUMN4.CONTROLSOURCE='C21.F05'
	           THISFORM.grid2.COLUMN5.CONTROLSOURCE='C02.F10'      
	           THISFORM.grid2.COLUMN6.CONTROLSOURCE='C02.F06'
	           THISFORM.grid2.COLUMN7.CONTROLSOURCE='C02.F07'
	           THISFORM.grid2.COLUMN8.CONTROLSOURCE='C02.F13'
	           THISFORM.grid2.COLUMN9.CONTROLSOURCE='C02.F08'
	           THISFORM.grid2.COLUMN10.CONTROLSOURCE='C02.F09'
	           
	           THISFORM.grid2.COLUMN3.WIDTH=INT_015*65
               THISFORM.GRID2.COLUMN4.WIDTH=INT_015*100
               THISFORM.GRID2.COLUMN5.WIDTH=INT_015*100
               THISFORM.GRID2.COLUMN6.WIDTH=INT_015*30
               THISFORM.GRID2.COLUMN7.WIDTH=INT_015*100              
               THISFORM.TRNOD_BOTT.ENABLED=.F.                  
       ENDCASE 
        THISFORM.PAGEFRAME1.ACTIVEPAGE=2
        THISFORM.PAGEFRAME1.ACTIVEPAGE=1
        SELE &AREA1
        THISFORM.grid1.SETFOCUS
  ENDPROC      
  PROC grid1.AFTERROWCOLCHANGE
       LPARAMETERS nColIndex
       IF THISFORM.KEY_list.DISPLAYVALUE='依客戶編號排列'
          THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=C01.F01
          THISFORM.PAGEFRAME1.PAGE1.LBLF011.CAPTION=C01.F04
          THISFORM.PAGEFRAME1.PAGE1.TXTF45.VALUE=C01.F45
           JK=THIS.COLUMN3.HEADER1.CAPTION  
       ELSE          
          THISFORM.PAGEFRAME1.page1.TXTF01.VALUE=B01.F01
          THISFORM.PAGEFRAME1.PAGE1.LBLF011.CAPTION=B01.F02
          JK=THIS.COLUMN1.HEADER1.CAPTION  
       ENDIF
       FCH=THISFORM.ACTIVECONTROL.NAME
       JK=THIS.COLUMN1.HEADER1.CAPTION  
       IF THIS.ACTIVEROW=0
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
       ELSE
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.
          THISFORM.TRNOD_BOTT.ENABLED=(A02.F10='*') OR ((sys_oper=C01.F18 OR sys_oper=C01.F23 OR sys_oper=C01.F33) AND AREA1='C01')
       ENDIF   
       CHK=''     
       thisform.refresh
  ENDPROC     
  PROC grid2.AFTERROWCOLCHANGE
       LPARAMETERS nColIndex
       THISFORM.PAGEFRAME1.PAGE2.TXTF01.VALUE=F01
       THISFORM.PAGEFRAME1.PAGE2.LBLF011.CAPTION=C01.F04
       THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE=F02
       THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=F03
       THISFORM.PAGEFRAME1.PAGE2.LBLF031.CAPTION=LEFT(C02.F16,20)
       THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE=F04
       THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE=F05
       THISFORM.PAGEFRAME1.PAGE2.TXTF06.VALUE=F06
       THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE=F07
       THISFORM.PAGEFRAME1.PAGE2.TXTF08.VALUE=F08
       THISFORM.PAGEFRAME1.PAGE2.TXTF09.VALUE=F09
       THISFORM.PAGEFRAME1.PAGE2.TXTF10.VALUE=F10
       THISFORM.PAGEFRAME1.PAGE2.TXTF11.VALUE=F11
       THISFORM.PAGEFRAME1.PAGE2.TXTF12.VALUE=F12  
       THISFORM.PAGEFRAME1.PAGE2.TXTF14.VALUE=F14  
       THISFORM.PAGEFRAME1.PAGE2.TXTF15.VALUE=F15                
       THISFORM.PAGEFRAME1.PAGE2.LBLF121.CAPTION=C21.F05                             
       THISFORM.PAGEFRAME1.PAGE2.LBLF991.CAPTION=F99
       THISFORM.PAGEFRAME1.PAGE2.LBLTRAT1.CAPTION=TRANSFORM(ROUND(100*(C02.F07*IIF(SEEK(C02.F06,'C00'),C00.F02,1)-B01.F38)/(C02.F07*IIF(SEEK(C02.F06,'C00'),C00.F02,1)),4),'@R 9999.9999')
       THISFORM.PAGEFRAME1.PAGE2.TXTF13.VALUE=F13       
       FCH=THISFORM.ACTIVECONTROL.NAME
       JK=THIS.COLUMN1.HEADER1.CAPTION
       IF AREA1='C01'
          CHK=THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
       ELSE
            CHK=THISFORM.PAGEFRAME1.PAGE1.TXTF45.VALUE
       ENDIF   
       if thisform.pageframe1.activepage=1
          thisform. CMDGROUP.SEEK_BOTT.ENABLED=.F.
       ENDIF   
  ENDPROC 
  PROCEDURE ORPGROUP.NEW_BOTT.CLICK    
    THISFORM.SETALL('READONLY',.F.,'TEXTBOX')       
    THISFORM.PAGEFRAME1.PAGE1.ENABLED=.F.
    THISFORM.GRID2.ENABLED=.F. 
    THISFORM.PAGEFRAME1.PAGE2.CRCY.VISIBLE=.T.
    THISFORM.PAGEFRAME1.PAGE2.CRCY.DISPLAYVALUE=INT_011
    THISFORM.PAGEFRAME1.PAGE2.TXTF06.VALUE=INT_011
    IF AREA1='C01'
        THISFORM.PAGEFRAME1.PAGE2.TXTF03.READONLY=.F.    
        THISFORM.PAGEFRAME1.PAGE2.TXTF03.SETFOCUS     
        THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=''
     ELSE
        THISFORM.PAGEFRAME1.PAGE2.TXTF01.READONLY=.F. 
        THISFORM.PAGEFRAME1.PAGE2.TXTF01.SETFOCUS
        THISFORM.PAGEFRAME1.PAGE2.TXTF01.VALUE=''     
     ENDIF   
     THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE=DATE()
     THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE=''
     THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE=''
     THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE=0
     THISFORM.PAGEFRAME1.PAGE2.TXTF08.VALUE=1
     THISFORM.PAGEFRAME1.PAGE2.TXTF09.VALUE=1
     THISFORM.PAGEFRAME1.PAGE2.TXTF10.VALUE=''
     THISFORM.PAGEFRAME1.PAGE2.TXTF11.VALUE=''
     THISFORM.PAGEFRAME1.PAGE2.TXTF13.VALUE=1000
     THISFORM.PAGEFRAME1.PAGE2.TXTF12.VALUE=''   
     THISFORM.PAGEFRAME1.PAGE2.TXTF14.VALUE=1000
     THISFORM.PAGEFRAME1.PAGE2.TXTF15.VALUE=CTOD('')              
     THISFORM.PAGEFRAME1.PAGE2.TXTF12.READONLY=.F.         
     THISFORM.PAGEFRAME1.PAGE2.LBLF121.CAPTION=''            
     THISFORM.PAGEFRAME1.PAGE2.LBLTRAT1.CAPTION=''     
  ENDPROC  
  PROCEDURE ORPGROUP.EDIT_BOTT.CLICK
     THISFORM.PAGEFRAME1.PAGE1.ENABLED=.F.
     THISFORM.GRID2.ENABLED=.F.
     THISFORM.PAGEFRAME1.PAGE2.CRCY.VISIBLE=.T.
     THISFORM.PAGEFRAME1.PAGE2.CRCY.DISPLAYVALUE=THISFORM.PAGEFRAME1.PAGE2.TXTF06.VALUE
     THISFORM.PAGEFRAME1.PAGE2.TXTF12.READONLY=.F.     
     IF AREA1='C01'
        THISFORM.PAGEFRAME1.PAGE2.TXTF03.SETFOCUS     
     ELSE
        THISFORM.PAGEFRAME1.PAGE2.TXTF01.SETFOCUS     
     ENDIF   
     LOCK()
     IF !RLOCK()
        DO file_impact
        return
     endif
  endproc 
  PROCEDURE ORPGROUP.DEL_BOTT.CLICK
     if messagebox('是否確定要刪除此筆資料',4+32+256,'請確認') = 6	      
        SELE C02   
        LOCK()
        IF RLOCK()
           DELE
           unlock
           SKIP -1
           IF BOF()
             GO TOP
           ENDIF   
           THISFORM.GRID2.SETFOCUS
           IF THISFORM.GRID2.ACTIVEROW=0
              THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
              THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
              THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
              THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
              THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
              THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
              THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
              THISFORM.PAGEFRAME1.PAGE2.SETALL('VALUE','','TEXTBOX') 
              THISFORM.PAGEFRAME1.PAGE2.TXTF01.VALUE=''
              THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=''
              THISFORM.PAGEFRAME1.PAGE2.LBLF011.CAPTION=''
              THISFORM.PAGEFRAME1.PAGE2.LBLF031.CAPTION=''         
              THISFORM.EXCEL_BOTT.ENABLED=.F.
              THISFORM.TRNOD_BOTT.ENABLED=.F.                                   
           ELSE
              THISFORM.CMDGROUP.ENABLED=.T.
              THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  &&判斷有無修改的權限
              THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)   &&判斷有無刪除的權限
              THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限              
           ENDIF
        ELSE
          DO file_impact    
        ENDIF          
     ENDIF        
  ENDPROC     
  PROCEDURE SHRGROUP.SHURE1_BOTT.CLICK
    SELECT C02
    
    DO CASE
       CASE AREA1='C01'
            IF SEEK(THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE,'B01')=.F.
               =MESSAGEBOX('物料基本主檔中歸屬類別設定錯誤或是根本無此料號!',0+48,'提示訊息視窗')
               THISFORM.PAGEFRAME1.PAGE2.TXTF03.SETFOCUS
               RETURN
            ELSE
               THISFORM.PAGEFRAME1.PAGE2.TXTF01.VALUE=THISFORM.PAGEFRAME1.PAGE1.TXTF45.VALUE   
            ENDIF   
            IF !EMPTY(THISFORM.PAGEFRAME1.PAGE2.TXTF12.VALUE)
               IF !SEEK(THISFORM.PAGEFRAME1.PAGE1.TXTF45.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF06.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF12.VALUE,'C21','C211')
                  =MESSAGEBOX('無此特別價原因描述紀錄',0+48,'提示訊息視窗')            
                  THISFORM.PAGEFRAME1.PAGE2.TXTF12.SETFOCUS
                  RETURN
               ENDIF
            ENDIF            
       CASE AREA1='B01'
            IF !(THISFORM.PAGEFRAME1.PAGE2.TXTF01.VALUE=IIF(SEEK(THISFORM.PAGEFRAME1.PAGE2.TXTF01.VALUE,'C01'),C01.F45,'')) OR EMPTY(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF01.VALUE))
               =MESSAGEBOX('客戶基本主檔中無此編號或是必須以統制客戶編號'+IIF(SEEK(THISFORM.PAGEFRAME1.PAGE2.TXTF01.VALUE,'C01'),C01.F45,'')+'作業'),0+64,'提示訊息視窗')
               THISFORM.PAGEFRAME1.PAGE2.TXTF01.VALUE=''
               THISFORM.PAGEFRAME1.PAGE2.TXTF01.SETFOCUS
               RETURN
            ELSE
               THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE    
            ENDIF
            IF !EMPTY(THISFORM.PAGEFRAME1.PAGE2.TXTF12.VALUE)
               IF !SEEK(THISFORM.PAGEFRAME1.PAGE2.TXTF01.VALUE+THISFORM.PAGEFRAME1.PAGE1.TXTF45.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF06.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF12.VALUE,'C21','C211')
                  =MESSAGEBOX('無此特別價原因描述紀錄',0+48,'提示訊息視窗')            
                  THISFORM.PAGEFRAME1.PAGE2.TXTF12.SETFOCUS
                  RETURN
               ENDIF            
            ENDIF            
    ENDCASE           
    IF THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE<=0
         =MESSAGEBOX('單價不得小於等於 0',0+48,'提示訊息視窗')
         THISFORM.PAGEFRAME1.PAGE2.TXTF07.SETFOCUS
         RETURN
     ENDIF    
     IF THISFORM.PAGEFRAME1.PAGE2.TXTF15.VALUE<THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE  OR THISFORM.PAGEFRAME1.PAGE2.TXTF15.VALUE>THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE+INT_126
        =MESSAGEBOX('有效期效不合規定',0+48,'提示訊息視窗')
        THISFORM.PAGEFRAME1.PAGE2.TXTF15.VALUE=THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE+INT_126
        THISFORM.PAGEFRAME1.PAGE2.TXTF15.SETFOCUS
        RETURN
     ENDIF 
     
    SELE C02
    APPEND BLANK
   
       
       REPLACE F01 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF01.VALUE
       REPLACE F02 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE
       REPLACE F03 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE
       REPLACE F04 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE
       REPLACE F05 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE
       REPLACE F06 WITH THISFORM.PAGEFRAME1.PAGE2.CRCY.DISPLAYVALUE
       REPLACE F07 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE
       REPLACE F08 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF08.VALUE
       REPLACE F09 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF09.VALUE
       REPLACE F10 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF10.VALUE
       REPLACE F11 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF11.VALUE
       REPLACE F99 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
       REPLACE F12 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF12.VALUE              
       REPLACE F13 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF13.VALUE
       REPLACE F14 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF14.VALUE
       REPLACE F15 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF15.VALUE              
     
    IF AREA1='C01'
        REPLACE F16 WITH IIF(SEEK(C02.F03,'B01'),B01.F02,'')
        REPLACE F01 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF45.VALUE
       SEEK THISFORM.PAGEFRAME1.PAGE1.TXTF45.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF12.VALUE+DTOS(THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE)
    ELSE
       REPLACE F01 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF01.VALUE
       REPLACE F16 WITH THISFORM.PAGEFRAME1.PAGE1.LBLF011.CAPTION
       SEEK THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF01.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF12.VALUE+DTOS(THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE)
    ENDIF   
    
    THISFORM.grid2.ENABLED=.T.    
    THISFORM.grid2.SETFOCUS        
    THISFORM.ORPGROUP.NEW_BOTT.CLICK            
  ENDPROC
  PROCEDURE SHRGROUP.SHURE2_BOTT.CLICK
    IF AREA1='C01'
       THISFORM.PAGEFRAME1.PAGE2.TXTF01.VALUE=THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
       IF !EMPTY(THISFORM.PAGEFRAME1.PAGE2.TXTF12.VALUE)
          IF !SEEK(THISFORM.PAGEFRAME1.PAGE1.TXTF45.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF06.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF12.VALUE,'C21','C211')
             =MESSAGEBOX('無此特別價原因描述紀錄',0+48,'提示訊息視窗')            
             THISFORM.PAGEFRAME1.PAGE2.TXTF12.SETFOCUS
             RETURN
          ENDIF                  
       ENDIF   
    ELSE
       THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE    
       IF !EMPTY(THISFORM.PAGEFRAME1.PAGE2.TXTF12.VALUE)       
          IF !SEEK(THISFORM.PAGEFRAME1.PAGE2.TXTF01.VALUE+THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF06.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF12.VALUE,'C21','C211')
             =MESSAGEBOX('無此特別價原因描述紀錄',0+48,'提示訊息視窗')            
             THISFORM.PAGEFRAME1.PAGE2.TXTF12.SETFOCUS
             RETURN
          ENDIF              
       ENDIF      
    ENDIF         
    IF THISFORM.PAGEFRAME1.PAGE2.TXTF15.VALUE<THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE  OR THISFORM.PAGEFRAME1.PAGE2.TXTF15.VALUE>THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE+INT_126
        =MESSAGEBOX('有效期效不合規定',0+48,'提示訊息視窗')
        THISFORM.PAGEFRAME1.PAGE2.TXTF15.VALUE=THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE+INT_126
        THISFORM.PAGEFRAME1.PAGE2.TXTF15.SETFOCUS
        RETURN
     ENDIF 
     
    SELE C02
    IF RLOCK()
      * REPLACE F01 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF01.VALUE
       REPLACE F02 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE
       REPLACE F03 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE
       REPLACE F04 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE
       REPLACE F05 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE
       REPLACE F06 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF06.VALUE
       REPLACE F07 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE
       REPLACE F08 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF08.VALUE
       REPLACE F09 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF09.VALUE
       REPLACE F10 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF10.VALUE
       REPLACE F11 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF11.VALUE
       REPLACE F99 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
       REPLACE F12 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF12.VALUE       
       REPLACE F13 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF13.VALUE
       REPLACE F14 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF14.VALUE
       REPLACE F15 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF15.VALUE                   
    ELSE
      DO file_impact
      return   
    ENDIF   
    THISFORM.SHRGROUP.ABANDON_BOTT.CLICK    
  ENDPROC   
  procedure SHRGROUP.ABANDON_BOTT.CLICK
      THISFORM.SHRGROUP.ENABLED=.F.
      THISFORM.SHRGROUP.VISIBLE=.F.      
      THISFORM.ORPGROUP.ENABLED=.T.
      THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.)   &&判斷有無新增的權限
      THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  &&判斷有無修改的權限
      THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)   &&判斷有無刪除的權限
      THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限
      THISFORM.PAGEFRAME1.PAGE2.CRCY.VISIBLE=.F.
      THISFORM.ORPGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
      THISFORM.CMDGROUP.ENABLED=.T.
      THISFORM.CMDGROUP.SETALL('ENABLED',.T.,'COMMANDBUTTON')
      THISFORM.CMDGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
      THISFORM.SETALL('READONLY',.T.,'TEXTBOX')  
      THISFORM.PAGEFRAME1.PAGE2.TXTF01.READONLY=.T.
      THISFORM.PAGEFRAME1.PAGE2.TXTF03.READONLY=.T.
      THISFORM.PAGEFRAME1.PAGE2.TXTF12.READONLY=.T.            
      UNLOCK ALL
      SELE C02
      
      THISFORM.PAGEFRAME1.PAGE1.ENABLED=.T.
      THISFORM.grid2.ENABLED=.T.
      THISFORM.grid2.SETFOCUS
      UNLOCK ALL
  ENDPROC
  PROCEDURE SHRGROUP.FINISH_BOTT.CLICK
       SELE C02
       THISFORM.SHRGROUP.ABANDON_BOTT.CLICK
  ENDPROC     
  PROCEDURE TRNOD_BOTT.CLICK
     if messagebox('是否確定匯出舊紀錄',4+32+256,'請確認') = 6	 
        IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
           OLD_RANGE=CREATEOBJECT("OLD_RANGE")  
           OLD_RANGE.SHOW    
           THISFORM.PAGEFRAME1.ACTIVEPAGE=2  
           THISFORM.PAGEFRAME1.ACTIVEPAGE=1
           THISFORM.GRID1.SETFOCUS
        ELSE
           IF THISFORM.PAGEFRAME1.PAGE2.TXTF15.VALUE>DATE()
              IF MESSAGEBOX('此筆報價未超過有效期限,是否仍要移至舊檔?',4+32+256,'請確認')<>6
                 THISFORM.GRID2.SETFOCUS
                 RETURN
              ENDIF
           ENDIF   
           SELECT C02
           IF RLOCK()
              SELECT C0B
              APPEND BLANK
              REPLACE F01 WITH C02.F01
              REPLACE F02 WITH C02.F02
              REPLACE F03 WITH C02.F03
              REPLACE F04 WITH C02.F04
              REPLACE F05 WITH C02.F05
              REPLACE F06 WITH C02.F06
              REPLACE F07 WITH C02.F07
              REPLACE F08 WITH C02.F08
              REPLACE F09 WITH C02.F09
              REPLACE F10 WITH C02.F10
              REPLACE F11 WITH C02.F11
              REPLACE F12 WITH C02.F12
              REPLACE F13 WITH C02.F13
              REPLACE F14 WITH C02.F14
              REPLACE F15 WITH C02.F15
              REPLACE F16 WITH C02.F16
              REPLACE F99 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
              SELECT C02
              DELETE
              SKIP -1
              IF BOF()
                 GO TOP
              ENDIF
           ELSE 
              DO file_impact
              THISFORM.PAGEFRAME1.ACTIVEPAGE=2
           ENDIF   
           
            THISFORM.GRID2.SETFOCUS
            IF THISFORM.GRID2.ACTIVEROW=0
               THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
               THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
               THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
               THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
               THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
               THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
               THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
               THISFORM.PAGEFRAME1.PAGE2.SETALL('VALUE','','TEXTBOX') 
               THISFORM.PAGEFRAME1.PAGE2.TXTF01.VALUE=''
               THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=''
               THISFORM.PAGEFRAME1.PAGE2.LBLF011.CAPTION=''
               THISFORM.PAGEFRAME1.PAGE2.LBLF031.CAPTION=''               
               THISFORM.EXCEL_BOTT.ENABLED=.F.
               THISFORM.TRNOD_BOTT.ENABLED=.F.                                   
            ELSE
               THISFORM.CMDGROUP.ENABLED=.T.
               THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  &&判斷有無修改的權限
               THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)   &&判斷有無刪除的權限
               THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限              
            ENDIF
         ENDIF   
     ENDIF    
     UNLOCK ALL
  ENDPROC  
  PROC ODCHK_BOTT.CLICK
       DO CASE
          CASE AREA1='C01' AND THISFORM.PAGEFRAME1.ACTIVEPAGE=1
               SELECT * FROM C0B WHERE F01=THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE INTO CURSOR C0B_1 READWRITE NOWAIT
               INDEX ON F03 + DTOS(F02) + F04 TAG C0B_11
               INDEX ON F04 + DTOS(F02) + F03 TAG C0B_12               
               OP_S='1'              
          CASE AREA1='B01' AND THISFORM.PAGEFRAME1.ACTIVEPAGE=1
               SELECT * FROM C0B WHERE F03=THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE INTO CURSOR C0B_1 READWRITE NOWAIT
               INDEX ON F01+DTOS(F02) TAG C0B_11               
               OP_S='2'
          CASE AREA1='C01' AND THISFORM.PAGEFRAME1.ACTIVEPAGE=2
               SELECT * FROM C0B WHERE F01+F03+F06+F12=THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE+;
               THISFORM.PAGEFRAME1.PAGE2.TXTF06.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF12.VALUE INTO CURSOR C0B_1 READWRITE NOWAIT  
               INDEX ON F03+DTOS(F02)  TAG C0B_11               
               OP_S='3'
          CASE AREA1='B01' AND THISFORM.PAGEFRAME1.ACTIVEPAGE=2
                SELECT * FROM C0B WHERE F03+F01+F06+F12=THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF01.VALUE+;
                THISFORM.PAGEFRAME1.PAGE2.TXTF06.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF12.VALUE INTO CURSOR C0B_1 READWRITE NOWAIT
                INDEX ON F01+DTOS(F02) TAG C0B_11                
                OP_S='4'
       ENDCASE   
       
       IF _TALLY>0
         TAREA1=AREA1
         SLP_SEEK=CREATEOBJECT("SLP_SEEK")  
         SLP_SEEK.SHOW                                      
         AREA1=TAREA1
       ELSE
         =MESSAGEBOX('無此範圍報價舊紀錄',0+64,'提示視窗')   
         IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
            THISFORM.GRID1.SETFOCUS
         ELSE
           THISFORM.GRID2.SETFOCUS
         ENDIF   
         RETURN       
       ENDIF
       IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
          THISFORM.GRID1.SETFOCUS
       ELSE
          THISFORM.GRID2.SETFOCUS
       ENDIF   
  ENDPROC    
  PROCEDURE EXCEL_BOTT.CLICK
     FLG = '0'
     O_TP='2'
     ANS_RANGE=CREATEOBJECT("ANS_RANGE")  
     ANS_RANGE.SHOW    
     IF FLG <> '1'
        =MESSAGEBOX('無此範圍資料',0+48,'警示')
     ENDIF   
     FLG = '0'  
  ENDPROC
ENDDEFINE    
***********************************************列印程序
PROCEDURE PNT_PRC  
   FLG = '0'
   O_TP='1'
   ANS_RANGE=CREATEOBJECT("ANS_RANGE")  
   ANS_RANGE.SHOW    
   IF FLG <> '1'
       =MESSAGEBOX('無此範圍資料',0+48,'警示')
   ENDIF   
   FLG = '0'      
ENDPROC
*************************************************轉入舊檔範圍選定
DEFINE CLASS OLD_RANGE AS FORM
  AUTOCENTER=.T.
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*175
  WIDTH=INT_015*290
  FONTSIZE=INT_015*9
  MAXBUTTON=.F.
  MINBUTTON=.F.
  MOVABLE=.F.
  CLOSABLE=.F.    
  CONTROLBOX=.F.
  BORDERSTYLE=2
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WINDOWTYPE=1
  NAME='OLD_RANGE'
ADD OBJECT OLD_OPTION AS OPTIONGROUP WITH;
      LEFT=INT_015*17,;
      TOP=INT_015*20,;
      AUTOSIZE=.T.,;
      FONTSIZE=INT_015*12,;
      BUTTONCOUNT=2,;
      OPTION1.TOP=INT_015*0,;
      OPTION1.FONTSIZE=INT_015*9,;
      OPTION1.AUTOSIZE=.T.,;
      OPTION2.TOP=INT_015*30,;
      OPTION2.FONTSIZE=INT_015*9,;
      OPTION2.AUTOSIZE=.T.,;         
      NAME='OLD_OPTION'    
  ADD OBJECT LABEL1 AS LABEL WITH;
      WIDTH=INT_015*120,;
      HEIGHT=INT_015*25,;
      LEFT=INT_015*20,;
      TOP=INT_015*110,;
      CAPTION='截止失效日期',;
      NAME='LABEL1'
  ADD OBJECT TEXT1 AS TEXTBOX WITH;
      WIDTH=INT_015*70,;
      TOP=INT_015*106,;
      LEFT=INT_015*100,;
      HEIGHT=INT_015*25,; 
      NAME='TEXT1'      
  ADD OBJECT CMND1 AS COMMANDBUTTON WITH;
      LEFT=INT_015*200,;     
      TOP=INT_015*50,;  
      HEIGHT=INT_015*25,;    
      WIDTH=INT_015*70,;
      FONTSIZE=INT_015*10,;
      CAPTION='\<P.執   行',;
      TOOLTIPTEXT='確認所選擇的鍵值!快速鍵->ALT+Y',;
      NAME='CMND1'    
  ADD OBJECT CMND3 AS COMMANDBUTTON WITH;
      LEFT=INT_015*200,;
      TOP=INT_015*135,;
      HEIGHT=INT_015*25,;    
      WIDTH=INT_015*70,;
      FONTSIZE=INT_015*10,;
      CAPTION='\<C.取   消',;
      TOOLTIPTEXT='取消作業!快速鍵->ALT+C',;
      NAME='CMND3'   
   ****
 PROCEDURE INIT 
      THISFORM.CAPTION='請輸入轉檔資料範圍' 
      THISFORM.SETALL('FONTSIZE',INT_015*9,'TEXTBOX')
      THISFORM.SETALL('FONTSIZE',INT_015*9,'LABEL')      
      THISFORM.SETALL('FONTSIZE',INT_015*9,'COMMANDBUTTON') 
      THISFORM.SETALL('READONLY',.T.,'TEXTBOX')
      THISFORM.SETALL('VALUE','','TEXTBOX')
      THISFORM.OLD_OPTION.OPTION1.CAPTION='全部失效日期紀錄'  
      THISFORM.OLD_OPTION.OPTION2.CAPTION='指定失效截止日期'
      THISFORM.TEXT1.VALUE=DATE()
      THISFORM.CMND1.SETFOCUS
 ENDPROC    
 PROCEDURE OLD_OPTION.INTERACTIVECHANGE
   DO CASE
      CASE THISFORM.OLD_OPTION.VALUE = 1
           THISFORM.SETALL('READONLY',.T.,'TEXTBOX')
           THISFORM.SETALL('VALUE','','TEXTBOX')
           THISFORM.TEXT1.VALUE=DATE()
           THISFORM.CMND1.SETFOCUS
      CASE THISFORM.OLD_OPTION.VALUE = 2
           THISFORM.SETALL('READONLY',.F.,'TEXTBOX')
           THISFORM.SETALL('VALUE',DATE(),'TEXTBOX')
           THISFORM.LABEL1.CAPTION='起始失效日期'
           THISFORM.TEXT1.SETFOCUS
   ENDCASE
 ENDPROC   
 PROCEDURE CMND1.CLICK 
    IF THISFORM.TEXT1.VALUE>DATE()
       =MESSAGEBOX('截止失效日期不得大於今天,否則請去表身逐筆匯出舊檔',0+48,'提示訊息視窗')
       THISFORM.TEXT1.SETFOCUS
       RETURN
    ENDIF
    IF AREA1='C01'
       LK=C01.F01                
       SELECT RECNO() FROM C02 WHERE F01=LK AND F15<=THISFORM.TEXT1.VALUE INTO ARRAY BK1
    ELSE
       LK=B01.F01
       SELECT RECNO() FROM C02 WHERE F03=LK AND F15<=THISFORM.TEXT1.VALUE INTO ARRAY BK1
    ENDIF   
    JJ1=''                
    IF _TALLY>0   
       FOR I= 1 TO ALEN(BK1)
           JJ1=JJ1+ALLTRIM(STR(BK1(I)))+','
       ENDFOR    
       KK1=STUFF(JJ1,RAT(',',JJ1,1),1,'')              
       RLOCK(KK1,'C02')
       LL1=RLOCK(KK1,'C02')
    ELSE
      =MESSAGEBOX('無此範圍資料!',0+48,'提示訊息視窗')
      SELECT &AREA1
      RETURN
    ENDIF                     
    IF LL1=.T.     
         SELE C02    
         FOR I= 1 TO ALEN(BK1)                      
             GO BK1(I)       
             SELECT C0B
             APPEND BLANK
             REPLACE F01 WITH C02.F01
             REPLACE F02 WITH C02.F02
             REPLACE F03 WITH C02.F03
             REPLACE F04 WITH C02.F04
             REPLACE F05 WITH C02.F05
             REPLACE F06 WITH C02.F06
             REPLACE F07 WITH C02.F07
             REPLACE F08 WITH C02.F08
             REPLACE F09 WITH C02.F09
             REPLACE F10 WITH C02.F10
             REPLACE F11 WITH C02.F11
             REPLACE F12 WITH C02.F12
             REPLACE F13 WITH C02.F13
             REPLACE F14 WITH C02.F14
             REPLACE F15 WITH C02.F15
             REPLACE F16 WITH C02.F16             
             REPLACE F99 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
             SELECT C02
             DELETE 
         ENDFOR   
         IF AREA1='C01'
            SEEK C01.F01
         ELSE
            SEEK B01.F01
         ENDIF      
    ELSE
       DO FILE_IMPACT
       UNLOCK ALL
       RETURN   
    ENDIF
    RELEASE ALL LIKE BK*       
    SELECT &AREA1
    THISFORM.RELEASE
 ENDPROC
 PROCEDURE CMND3.CLICK
   THISFORM.REFRESH
   THISFORM.RELEASE
 ENDPROC         
ENDDEFINE 
***********************************************列印範圍選定
DEFINE CLASS ANS_RANGE AS FORM
  AUTOCENTER=.T.
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*175
  WIDTH=INT_015*290
  FONTSIZE=INT_015*9
  MAXBUTTON=.F.
  MINBUTTON=.F.
  MOVABLE=.F.
  CLOSABLE=.F.    
  CONTROLBOX=.F.
  BORDERSTYLE=2
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WINDOWTYPE=1
  NAME='ANS_RANGE'
ADD OBJECT DATA_OPTION AS OPTIONGROUP WITH;
      LEFT=INT_015*17,;
      TOP=INT_015*20,;
      AUTOSIZE=.T.,;
      FONTSIZE=INT_015*12,;
      BUTTONCOUNT=3,;
      OPTION1.TOP=INT_015*0,;
      OPTION1.FONTSIZE=INT_015*9,;
      OPTION1.AUTOSIZE=.T.,;
      OPTION2.TOP=INT_015*30,;
      OPTION2.FONTSIZE=INT_015*9,;
      OPTION2.AUTOSIZE=.T.,;         
      OPTION3.TOP=INT_015*60,;
      OPTION3.FONTSIZE=INT_015*9,;
      OPTION3.AUTOSIZE=.T.,;          
      NAME='DATA_OPTION'    
  ADD OBJECT LABEL1 AS LABEL WITH;
      WIDTH=INT_015*120,;
      HEIGHT=INT_015*25,;
      LEFT=INT_015*20,;
      TOP=INT_015*110,;
      CAPTION='起始生效日期',;
      NAME='LABEL1'
  ADD OBJECT TEXT1 AS TEXTBOX WITH;
      WIDTH=INT_015*70,;
      TOP=INT_015*106,;
      LEFT=INT_015*100,;
      HEIGHT=INT_015*25,; 
      NAME='TEXT1'      
  ADD OBJECT LABEL2 AS LABEL WITH;
      WIDTH=INT_015*120,;
      HEIGHT=INT_015*25,;
      LEFT=INT_015*20,;
      TOP=INT_015*140,;
      CAPTION='截止生效日期',;
      NAME='LABEL2'
  ADD OBJECT TEXT2 AS TEXTBOX WITH;
      WIDTH=INT_015*70,;
      TOP=INT_015*136,;
      LEFT=INT_015*100,;
      HEIGHT=INT_015*25,; 
      NAME='TEXT2'         
  ADD OBJECT CMND1 AS COMMANDBUTTON WITH;
      LEFT=INT_015*200,;     
      TOP=INT_015*50,;  
      HEIGHT=INT_015*25,;    
      WIDTH=INT_015*70,;
      FONTSIZE=INT_015*10,;
      CAPTION='\<P.執   行',;
      TOOLTIPTEXT='確認所選擇的鍵值!快速鍵->ALT+Y',;
      NAME='CMND1'    
  ADD OBJECT CMND3 AS COMMANDBUTTON WITH;
      LEFT=INT_015*200,;
      TOP=INT_015*135,;
      HEIGHT=INT_015*25,;    
      WIDTH=INT_015*70,;
      FONTSIZE=INT_015*10,;
      CAPTION='\<C.取   消',;
      TOOLTIPTEXT='取消作業!快速鍵->ALT+C',;
      NAME='CMND3'   
   ****
 PROCEDURE INIT 
      THISFORM.CAPTION='請輸入'+IIF(O_TP='1','列印','轉檔')+'資料範圍' 
      THISFORM.SETALL('FONTSIZE',INT_015*9,'TEXTBOX')
      THISFORM.SETALL('FONTSIZE',INT_015*9,'LABEL')      
      THISFORM.SETALL('FONTSIZE',INT_015*9,'COMMANDBUTTON') 
      THISFORM.SETALL('READONLY',.T.,'TEXTBOX')
      THISFORM.SETALL('VALUE','','TEXTBOX')
      THISFORM.DATA_OPTION.OPTION1.CAPTION=IIF(O_TP='1','列印','轉檔')+'全部生效日期 '  
      THISFORM.DATA_OPTION.OPTION2.CAPTION='自訂'+IIF(O_TP='1','列印','轉檔')+'生效日期 '
      THISFORM.DATA_OPTION.OPTION3.CAPTION='最新報價未入轉檔'
      THISFORM.DATA_OPTION.OPTION3.VISIBLE=(AREA1='B01') AND O_TP='2'
      THISFORM.DATA_OPTION.OPTION3.ENABLED=(AREA1='B01') AND O_TP='2'
      THISFORM.CMND1.SETFOCUS
 ENDPROC    
 PROCEDURE DATA_OPTION.INTERACTIVECHANGE
   DO CASE
      CASE THISFORM.DATA_OPTION.VALUE = 1
           THISFORM.SETALL('READONLY',.T.,'TEXTBOX')
           THISFORM.SETALL('VALUE','','TEXTBOX')
           THISFORM.CMND1.SETFOCUS
      CASE THISFORM.DATA_OPTION.VALUE = 2
           THISFORM.SETALL('READONLY',.F.,'TEXTBOX')
           THISFORM.SETALL('VALUE',DATE(),'TEXTBOX')
           THISFORM.LABEL1.CAPTION='起始生效日期'
           THISFORM.LABEL2.CAPTION='截止生效日期'
           THISFORM.TEXT1.SETFOCUS
      CASE THISFORM.DATA_OPTION.VALUE = 3
           THISFORM.SETALL('READONLY',.F.,'TEXTBOX')
           THISFORM.LABEL1.CAPTION='起始報價天數'
           THISFORM.LABEL2.CAPTION='截止報價天數'           
           THISFORM.TEXT1.VALUE=90
           THISFORM.TEXT2.VALUE=180
           THISFORM.TEXT1.SETFOCUS           
   ENDCASE
 ENDPROC   
 PROCEDURE CMND1.CLICK 
   IF AREA1='C01'  
      LK=C01.F01   
      IF O_TP='1'
         SELECT C02.F01,C02.F02,C02.F03,C02.F05,C02.F06,C02.F07,C02.F08,C02.F09,C02.F10,C02.F12,C02.F13,C02.F15,B01.F02,C01.F04 FROM C02,B01,C01;
             WHERE C02.F01 = LK AND B01.F01 = C02.F03 AND C01.F01 = C02.F01 AND IIF(THISFORM.DATA_OPTION.VALUE = 1,.T.,C02.F02 >= THISFORM.TEXT1.VALUE AND C02.F02 <= THISFORM.TEXT2.VALUE) ORDER BY C02.F03,C02.F02 NOWAIT            
         IF _tally >0            
               REPORT FORM ALLTRIM(INT_116)+'C02A' TO PRINT PROMPT PREVIEW 
            FLG = '1'
         ELSE
            FLG = '0'   
         ENDIF               
      ELSE  
         
            SELECT C02.F01 客戶編號,C01.F04 客戶簡稱,C02.F11 報價單號,C02.F03 料品編號,B01.F02 品名規格,C02.F04 客戶品號,C02.F02 生效日期,C02.F06 幣別,C02.F07 單價,C02.F08 最小訂購量,C02.F09 交貨天數,C02.F13 包裝基量,C02.F15 有效期限,C02.F10 其他備註,IIF(SEEK(C02.F01+C02.F03+C02.F06+C02.F12,'C21'),C21.F05,SPACE(30)) 特價原因 FROM C02,B01,C01 ORDER BY C02.F03,C02.F02;
                WHERE C02.F01 = LK AND B01.F01 = C02.F03 AND C01.F01 = C02.F01 AND IIF(THISFORM.DATA_OPTION.VALUE = 1,.T.,C02.F02 >= THISFORM.TEXT1.VALUE AND C02.F02 <= THISFORM.TEXT2.VALUE)  NOWAIT
	        IF _TALLY>0               
               FILE_NAME=LK+ALLTRIM(IIF(SEEK(LK,'C01'),C01.F05,''))+'報價紀錄'   	           	        
   	           GCDELIMFILE=PUTFILE('儲存路徑',FILE_NAME,'XLS')
	           IF EMPTY(GCDELIMFILE)  && ESC PRESSED	          
                  RETURN
               ELSE
                 ON ERROR DO FILE_IMPACT
                 COPY TO (GCDELIMFILE) TYPE XL5   
		         =MESSAGEBOX('儲存成功',0+64,'提示訊息視窗')              
               ENDIF    
               FLG='1'
            ELSE
               FLG='0'   
            ENDIF   
        
       ENDIF     

   ELSE
      LK=B01.F01   
      IF O_TP='1'
         SELECT C02.F01,C02.F02,C02.F03,C02.F05,C02.F06,C02.F07,C02.F08,C02.F09,C02.F10,C02.F12,C02.F13,C02.F15,B01.F02,C01.F04 FROM C02,B01,C01;     
             WHERE C02.F03 = LK AND B01.F01 = C02.F03 AND C01.F01 = C02.F01 AND IIF(THISFORM.DATA_OPTION.VALUE = 1,.T.,C02.F02 >= THISFORM.TEXT1.VALUE AND C02.F02 <= THISFORM.TEXT2.VALUE) ORDER BY C02.F01,C02.F02 NOWAIT
         IF _tally >0
            REPORT FORM ALLTRIM(INT_116)+'C02B' TO PRINT PROMPT PREVIEW
            FLG = '1'
         ELSE
            FLG = '0'
         ENDIF  
      ELSE
         IF THISFORM.DATA_OPTION.VALUE<>3
            SELECT C02.F03 料品編號,B01.F02 品名規格,C02.F11 報價單號,C02.F01 客戶編號,C01.F04 客戶簡稱,C02.F02 生效日期,C02.F06 幣別,C02.F07 單價,C02.F08 最小採購量,C02.F09 交貨天數,C02.F10 其他備註,C02.F13 包裝基量,C02.F15 有效期限,IIF(SEEK(C02.F01+C02.F03+C02.F06+C02.F12,'C21'),C21.F05,SPACE(30)) 特價原因 FROM C02,B01,C01;     
            WHERE C02.F03 = LK AND B01.F01 = C02.F03 AND C01.F01 = C02.F01 AND IIF(THISFORM.DATA_OPTION.VALUE = 1,.T.,C02.F02 >= THISFORM.TEXT1.VALUE AND C02.F02 <= THISFORM.TEXT2.VALUE) ORDER BY C02.F01,C02.F02 NOWAIT      
	        IF _TALLY>0               
               FILE_NAME=ALLTRIM(LK)+'報價紀錄'   	           	        
   	           GCDELIMFILE=PUTFILE('儲存路徑',FILE_NAME,'XLS')
	           IF EMPTY(GCDELIMFILE)  && ESC PRESSED	          
                  RETURN
               ELSE
                 ON ERROR DO FILE_IMPACT
                 COPY TO (GCDELIMFILE) TYPE XL5   
		         =MESSAGEBOX('儲存成功',0+64,'提示訊息視窗')              
               ENDIF    
               FLG='1'
            ELSE
               FLG='0'   
            ENDIF   
          ELSE  
             SELECT F02,F03 GROUP BY F02 ORDER BY F03 DESC FROM D10 WHERE DATE()-F03 <= THISFORM.TEXT1.VALUE INTO CURSOR C02W1 NOWAIT
             SELECT C02.F03,C02.F02,C02.F01,C02.F11 GROUP BY C02.F03 ORDER BY C02.F03,C02.F02 DESC FROM C02 WHERE DATE()-F02>=THISFORM.TEXT1.VALUE AND DATE()-F02<=THISFORM.TEXT2.VALUE INTO CURSOR C02W2 NOWAIT
             IF _TALLY>0
                SELECT C02W2.F03,C02W2.F02,C02W2.F01,C01.F05,C01.F33,C01.F23,C02W2.F11 FROM C02W2,C01 WHERE C02W2.F03 NOT IN(SELECT F02 FROM C02W1) AND C02W2.F03=ANY(SELE F01 FROM B01 WHERE F97<>'Y' AND !EMPTY(F98)) AND C01.F01=C02W2.F01 INTO CURSOR C02W3 NOWAIT
                SELECT C02W3.F03 料號,C02W3.F02 最新報價日,C02W3.F01 客戶編號,C02W3.F05 客戶簡稱,C02W3.F11 報價單號,C02W3.F33 業務編號,IIF(SEEK(C02W3.F33,'A01'),A01.F03,'') 業務姓名,C02W3.F23 業助編號,IIF(SEEK(C02W3.F23,'A01'),A01.F03,'') 業助姓名 FROM C02W3 NOWAIT ORDER BY C02W3.F03
                FILE_NAME='未入貨報價紀錄'   	           	        
   	            GCDELIMFILE=PUTFILE('儲存路徑',FILE_NAME,'XLS')
	            IF EMPTY(GCDELIMFILE)  && ESC PRESSED	          
                   RETURN
                ELSE
                  ON ERROR DO FILE_IMPACT
                  COPY TO (GCDELIMFILE) TYPE XL5   
		          =MESSAGEBOX('儲存成功',0+64,'提示訊息視窗')              
                ENDIF                   
                FLG='1'
             ELSE
                FLG='0'   
             ENDIF
         ENDIF  
       ENDIF           
   ENDIF  
   O_TP=''
   THISFORM.RELEASE 
 ENDPROC      
 PROCEDURE CMND3.CLICK
   O_TP='' 
   FLG='1'   
   THISFORM.REFRESH
   THISFORM.RELEASE
 ENDPROC        
ENDDEFINE        
************************************************特殊輸入欄位的設定----料號
DEFINE CLASS TXTF03 AS TEXTBOX
  READONLY=.T.
  MAXLENGTH=43
  FONTSIZE=INT_015*9
  PROCEDURE INTERACTIVECHANGE
    IF AT('?',ALLTRIM(THIS.VALUE))<>0
       IF AT('?',ALLTRIM(THIS.VALUE))>1             
          SELECT F01,F02 FROM B01 INTO CURSOR MTR ORDER BY F01 WHERE  LEFT(F01,AT('?',THIS.VALUE)-1)=LEFT(THIS.VALUE,AT('?',THIS.VALUE)-1)
       ELSE
          SELECT F01,F02 FROM B01 INTO CURSOR MTR ORDER BY F01 
       ENDIF
       IF _TALLY>0   
          MAN_SEEK=createobject("MTR_SEEK")  
          MAN_SEEK.SHOW    
          THIS.VALUE=FLG
          THIS.REFRESH
          FLG='0'        
       ENDIF   
    ENDIF  
       THISFORM.PAGEFRAME1.PAGE2.LBLF031.CAPTION=IIF(SEEK(THIS.VALUE,'B01'),B01.F02,'')  
       THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE=IIF(SEEK(THIS.VALUE,'B01'),B01.F03,'')  
       THISFORM.PAGEFRAME1.PAGE2.TXTF13.VALUE=IIF(SEEK(THIS.VALUE,'C20'),VAL(C20.F03),1000)
       THISFORM.PAGEFRAME1.PAGE2.TXTF14.VALUE=IIF(SEEK(THIS.VALUE,'C20'),C20.F11,1000)
       THISFORM.PAGEFRAME1.PAGE2.TXTF05.REFRESH       
  ENDPROC
ENDDEFINE
***************************************************特殊輸入欄位設定-----------客戶
DEFINE CLASS TXTF01 AS TEXTBOX
  FONTSIZE=INT_015*9
  READONLY=.T.
  MAXLENGTH=5
  PROCEDURE INTERACTIVECHANGE
    IF AT('?',ALLTRIM(THIS.VALUE))<>0
       IF AT('?',ALLTRIM(THIS.VALUE))>1             
          SELECT F02,F01,F04 FROM C01 INTO CURSOR VDR ORDER BY F02 WHERE F01=F45 AND LEFT(F02,AT('?',THIS.VALUE)-1)=LEFT(THIS.VALUE,AT('?',THIS.VALUE)-1)
       ELSE
          SELECT F02,F01,F04 FROM C01 INTO CURSOR VDR ORDER BY F02 WHERE F01=F45
       ENDIF   
       IF _TALLY>0
          VDR_SEEK=createobject("VDR_SEEK")  
          VDR_SEEK.SHOW    
          THIS.VALUE=FLG
          THIS.REFRESH
          FLG='0'        
       ENDIF   
    ENDIF  
       
       THISFORM.PAGEFRAME1.PAGE2.LBLF011.CAPTION=IIF(SEEK(THIS.VALUE,'C01'),C01.F04,'')  
       THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE=IIF(SEEK(THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE,'B01'),B01.F03,'')  
       THISFORM.PAGEFRAME1.PAGE2.TXTF05.REFRESH       
  ENDPROC
ENDDEFINE
***************************************************幣別設定
DEFINE CLASS CRCY AS COMBOBOX
  HEIGHT=INT_015*25
  FONTSIZE=INT_015*9  
  AUTOSIZE=.T.
  TOP=INT_015*60
  LEFT=INT_015*220
  BOUNDCOLUMN=1
  COLUMNCOUNT=1
  WIDTH=INT_015*84
  ROWSOURCETYPE=1
  STYLE=2
  NAME='CRCY'
  PROCEDURE INIT
    SELECT C00
    GO TOP 
    DO WHILE .NOT. EOF()
       L=4-LEN(ALLTRIM(F01))
       THIS.ADDITEM(F01)
       SKIP
    ENDDO
    THIS.DISPLAYVALUE=C00.F01
  ENDPROC  
  PROCEDURE INTERACTIVECHANGE
    THISFORM.PAGEFRAME1.PAGE2.TXTF06.VALUE=THIS.DISPLAYVALUE
  ENDPROC  
ENDDEFINE      
***************************************************
***************************************************特殊輸入欄位設定-----------特價代碼
DEFINE CLASS TXTF12 AS TEXTBOX
  FONTSIZE=INT_015*9
  READONLY=.T.
  MAXLENGTH=1
  PROCEDURE INTERACTIVECHANGE
    IF AT('?',ALLTRIM(THIS.VALUE))<>0
       THIS.DBLCLICK
    ELSE
       IF AREA1='C01'
          THISFORM.PAGEFRAME1.PAGE2.LBLF121.CAPTION=IIF(SEEK(THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE;
          +THISFORM.PAGEFRAME1.PAGE2.TXTF06.VALUE +THIS.VALUE,'C21'),C21.F05,'') 
       ELSE
          THISFORM.PAGEFRAME1.PAGE2.LBLF121.CAPTION=IIF(SEEK(THISFORM.PAGEFRAME1.PAGE2.TXTF01.VALUE+THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE;
          +THISFORM.PAGEFRAME1.PAGE2.TXTF06.VALUE +THIS.VALUE,'C21'),C21.F05,'')     
        ENDIF          
    ENDIF  
  ENDPROC
  PROCEDURE DBLCLICK
       IF AREA1='C01'
          SELECT F04,F05,F06 FROM C21 WHERE F01+F02+F03=THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE;
          +THISFORM.PAGEFRAME1.PAGE2.TXTF06.VALUE INTO CURSOR SPC ORDER BY F02      
       ELSE
          SELECT F04,F05,F06 FROM C21 WHERE F01+F02+F03=THISFORM.PAGEFRAME1.PAGE2.TXTF01.VALUE+THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE;
          +THISFORM.PAGEFRAME1.PAGE2.TXTF06.VALUE INTO CURSOR SPC ORDER BY F02             
       ENDIF   
       IF _TALLY>0
          tAREA1=AREA1         
          SPC_SEEK=createobject("SPC_SEEK")  
          SPC_SEEK.SHOW    
          IF !EMPTY(FLG)
             THIS.VALUE=FLG
             THISFORM.PAGEFRAME1.PAGE2.LBLF121.CAPTION=CHK_STR
          ENDIF   
          FLG=''
          CHK_STR=''        
          AREA1=tAREA1
       ENDIF      
  ENDPROC
ENDDEFINE
*******************************************************特價描述紀錄
define class SPC_SEEK as form
  autocenter=.t.
  caption='特價描述紀錄'
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*340
  WIDTH=INT_015*336
  FONTSIZE=INT_015*9
  CONTROLBOX=.F.
  BORDERSTYLE=2
  SHOWTIPS=.T.
  showwindow=1
  windowtype=1
  name='SPC_SEEK'
  add object GRID1 as GRID with;          
      AUTOCENTER=.T.,;
      ALLOWCELLSELECTION=.F.,;
      TOP=INT_015*0,;
      WIDTH=INT_015*336,;      
      HEIGHT=INT_015*310,;      
      ROWHEIGHT=INT_015*18,;
      HEADERHEIGHT=INT_015*19,;
      deletemark=.f.,;
      READONLY=.T.,;
      recordsourcetype=1,;
      columncount=3,;            
      NAME='GRID1',;
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;
      COLUMN3.NAME='COLUMN3'
  add object cmdgroup as cmdgroup with;      
      TOP=INT_015*310,;
      LEFT=INT_015*30,;
      visible=.t.      
  add object cmnd1 as commandbutton with;
      LEFT=INT_015*203,;    
      HEIGHT=INT_015*25,;   
      TOP=INT_015*315,;  
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;
      caption='\<S.選取',;
      TOOLTIPTEXT='選擇游標所指的紀錄!快速鍵->ALT+S'
      name='cmnd1'
  add object cmnd2 as commandbutton with;
      LEFT=INT_015*245,;
      TOP=INT_015*315,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;      
      caption='\<C.取消',;
      TOOLTIPTEXT='取消此搜尋畫面!快速鍵->ALT+C'
      name='cmnd2'
      procedure init 
         AREA1='SPC' 
         SELE SPC
         THISFORM.GRID1.READONLY=.T. 
         thisform.grid1.recordsource='SPC'         
         THISFORM.CMDGROUP.SEEK_BOTT.VISIBLE=.F.
         THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'COLUMN')
         THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'HEADER')         
         THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='代碼'
         THISFORM.GRID1.COLUMN1.WIDTH=INT_015*25
         THISFORM.GRID1.COLUMN1.CONTROLSOURCE='F04'              
         THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='描述說明'
         THISFORM.GRID1.COLUMN2.WIDTH=INT_015*210
         THISFORM.GRID1.COLUMN2.CONTROLSOURCE='F05'
         THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='首次報價'
         THISFORM.GRID1.COLUMN3.CONTROLSOURCE='F06'
         THISFORM.GRID1.COLUMN3.WIDTH=INT_015*80
         THISFORM.GRID1.SETFOCUS
         IF THISFORM.GRID1.ACTIVEROW<>0
              THISFORM.GRID1.AFTERROWCOLCHANGE 
         ENDIF         
      ENDPROC
      PROC GRID1.AFTERROWCOLCHANGE
       LPARAMETERS XColIndex     
         FCH=THISFORM.ACTIVECONTROL.NAME  
         FLG=SPC.F04
         CHK_STR=F05
      ENDPROC 
      procedure cmnd1.click  
          THISFORM.RELEASE                
      endproc
      procedure cmnd2.click
          FLG=''   
          CHK_STR=''
          thisform.release
      endproc      
enddefine          
************************
************************************************舊檔紀錄
DEFINE CLASS SLP_SEEK AS FORM
  AUTOCENTER=.T.
  CAPTION='C0B.報價舊檔紀錄'
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*340
  WIDTH=INT_015*792
  MAXBUTTON=.F.
  MINBUTTON=.F.
  MOVABLE=.F.
  CLOSABLE=.F.
  CONTROLBOX=.F.
  BORDERSTYLE=2
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WINDOWTYPE=1
  NAME='SLP_SEEK'
  
  ADD OBJECT GRID1 AS GRID WITH;          
      AUTOCENTER=.T.,;
      TOP=INT_015*0,;
      WIDTH=INT_015*792,;      
      HEIGHT=INT_015*310,;      
      DELETEMARK=.F.,;
      READONLY=.T.,;
      ROWHEIGHT=INT_015*18,;
      HEADERHEIGHT=INT_015*19,;
      ALLOWCELLSELECTION=.T.,;
      HIGHLIGHTROWLINEWIDTH=4,;
      ALLOWROWSIZING=.F.,;
      RECORDSOURCETYPE=1,; 
      COLUMNCOUNT=10,;            
      NAME='GRID1',;
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;      
      COLUMN3.NAME='COLUMN3',;      
      COLUMN4.NAME='COLUMN4',;      
      COLUMN5.NAME='COLUMN5',;      
      COLUMN6.NAME='COLUMN6',;      
      COLUMN7.NAME='COLUMN7',;      
      COLUMN8.NAME='COLUMN8',;      
      COLUMN9.NAME='COLUMN9',;      
      COLUMN10.NAME='COLUMN10'  
   ADD OBJECT ORPGROUP AS ORPGROUP WITH;
      NEW_BOTT.VISIBLE=.F.,;
      EDIT_BOTT.VISIBLE=.F.,;
      PNT_BOTT.VISIBLE=.F.,;
      ESC_BOTT.VISIBLE=.F.,;
      TOP=INT_015*310,;
      LEFT=INT_015*455,;
      VISIBLE=.T.         
  ADD OBJECT CMDGROUP AS CMDGROUP WITH;      
      TOP=INT_015*310,;
      LEFT=INT_015*330,;
      VISIBLE=.T.    
  ADD OBJECT CMND2 AS COMMANDBUTTON WITH;
      LEFT=INT_015*585,;
      TOP=INT_015*314,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;
      CAPTION='\<X.離開',;
      TOOLTIPTEXT='離開此查詢尋畫面!快速鍵->ALT+X'
      NAME='CMND2'
  ADD OBJECT CMND3 AS COMMANDBUTTON WITH;
      LEFT=INT_015*230,;
      TOP=INT_015*314,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*100,;
      FONTSIZE=INT_015*9,;
      CAPTION='\<T.匯回正式報價',;
      TOOLTIPTEXT='將舊檔資料匯回正式報價紀錄!快速鍵->ALT+T'
      NAME='CMND3'      
  ADD OBJECT KEY_LIST AS KEY_LIST WITH;
      TOP=INT_015*313,;
      AUTOSIZE=.T.,;
      AUTOCENTER=.T.      
      PROCEDURE INIT 
         AREA1='C0B_1' 
         SELECT C0B_1
         SET ORDER TO C0B_11
         THISFORM.GRID1.READONLY=.T. 
         THISFORM.GRID1.RECORDSOURCE='C0B_1'
         THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'COLUMN')
         THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'HEADER')         
         THISFORM.GRID1.COLUMN1.HEADER1.CAPTION=IIF(OP_S$'13','料品編號','客戶編號')
         THISFORM.GRID1.COLUMN1.CONTROLSOURCE="IIF(OP_S$'13',F03,F01)"         
         THISFORM.GRID1.COLUMN1.WIDTH=INT_015*IIF(OP_S$'13',160,70)  
         THISFORM.GRID1.COLUMN2.HEADER1.CAPTION=IIF(OP_S$'13','客戶品號','客戶簡稱')
         THISFORM.GRID1.COLUMN2.CONTROLSOURCE="IIF(OP_S$'13',F04,IIF(SEEK(F01,'C01'),C01.F05,''))"         
         THISFORM.GRID1.COLUMN2.WIDTH=INT_015*IIF(OP_S$'13',100,80)   
         THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='生效日期'
         THISFORM.GRID1.COLUMN3.CONTROLSOURCE='F02'         
         THISFORM.GRID1.COLUMN3.WIDTH=INT_015*60
         THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='幣別'
         THISFORM.GRID1.COLUMN4.CONTROLSOURCE='F06'
         THISFORM.GRID1.COLUMN4.WIDTH=INT_015*35
         THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='單價'
         THISFORM.GRID1.COLUMN5.CONTROLSOURCE='F07'
         THISFORM.GRID1.COLUMN5.WIDTH=INT_015*80
         THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='最小訂貨量'        
         THISFORM.GRID1.COLUMN6.CONTROLSOURCE='F08'
         THISFORM.GRID1.COLUMN6.WIDTH=INT_015*65
         THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='特價原因'
         THISFORM.GRID1.COLUMN7.CONTROLSOURCE="IIF(SEEK(F01+F03+F06+F12,'C21'),C21.F05,'')"
         THISFORM.GRID1.COLUMN7.WIDTH=INT_015*70
         THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='交易條件'
         THISFORM.GRID1.COLUMN8.CONTROLSOURCE='F10'
         THISFORM.GRID1.COLUMN8.WIDTH=INT_015*80
         THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='報價單號'
         THISFORM.GRID1.COLUMN9.CONTROLSOURCE='F11'
         THISFORM.GRID1.COLUMN9.WIDTH=INT_015*80         
         THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='安全資料'
         THISFORM.GRID1.COLUMN10.CONTROLSOURCE='F99'
         THISFORM.GRID1.COLUMN10.WIDTH=INT_015*90
         THISFORM.GRID1.SETFOCUS
         IF THISFORM.GRID1.ACTIVEROW<>0
              THISFORM.GRID1.AFTERROWCOLCHANGE 
         ENDIF
         JK=IIF(OP_S$'13','料品編號','客戶編號')
         THISFORM.KEY_LIST.ENABLED=(OP_S='1')
         THISFORM.KEY_LIST.VISIBLE=(OP_S='1')
      ENDPROC
      PROC KEY_LIST.INIT 
            WITH THIS 
                .ADDITEM('依料品編號+生效日期排列')
                .ADDITEM('依客戶品號+生效日期排列')
                .VALUE=1      
            ENDWITH      
      ENDPROC       
      PROC GRID1.AFTERROWCOLCHANGE
       LPARAMETERS XCOLINDEX     
         FCH=THISFORM.ACTIVECONTROL.NAME  
      ENDPROC 
  PROC KEY_LIST.INTERACTIVECHANGE                 
       SELECT  C0B_1
       DO CASE
       	  CASE THIS.DISPLAYVALUE='依料品編號+生效日期排列' 
       	       SET ORDER TO C0B_11
	           THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='料品編號'
	           THISFORM.GRID1.COLUMN1.CONTROLSOURCE='F03'         
	           THISFORM.GRID1.COLUMN1.WIDTH=INT_015*160   
	           THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='客戶品號'
	           THISFORM.GRID1.COLUMN2.CONTROLSOURCE='F04'         
	           THISFORM.GRID1.COLUMN2.WIDTH=INT_015*100   
	           THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='生效日期'
	           THISFORM.GRID1.COLUMN3.CONTROLSOURCE='F02'         
	           THISFORM.GRID1.COLUMN3.WIDTH=INT_015*60
	           THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='幣別'
	           THISFORM.GRID1.COLUMN4.CONTROLSOURCE='F06'
	           THISFORM.GRID1.COLUMN4.WIDTH=INT_015*35
	           THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='單價'
	           THISFORM.GRID1.COLUMN5.CONTROLSOURCE='F07'
	           THISFORM.GRID1.COLUMN5.WIDTH=INT_015*80
	           THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='最小訂貨量'        
	           THISFORM.GRID1.COLUMN6.CONTROLSOURCE='F08'
	           THISFORM.GRID1.COLUMN6.WIDTH=INT_015*65
	           THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='特價原因'
	           THISFORM.GRID1.COLUMN7.CONTROLSOURCE="IIF(SEEK(F01+F03+F06+F12,'C21'),C21.F05,'')"
	           THISFORM.GRID1.COLUMN7.WIDTH=INT_015*70
	           THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='交易條件'
	           THISFORM.GRID1.COLUMN8.CONTROLSOURCE='F10'
	           THISFORM.GRID1.COLUMN8.WIDTH=INT_015*80
	           THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='報價單號'
	           THISFORM.GRID1.COLUMN9.CONTROLSOURCE='F11'
	           THISFORM.GRID1.COLUMN9.WIDTH=INT_015*80	           
	           THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='安全資料'
	           THISFORM.GRID1.COLUMN10.CONTROLSOURCE='F99'
	           THISFORM.GRID1.COLUMN10.WIDTH=INT_015*90
       	  CASE THIS.DISPLAYVALUE='依客戶品號+生效日期排列'
       	       SET ORDER TO C0B_12
	           THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='客戶品號'
	           THISFORM.GRID1.COLUMN1.CONTROLSOURCE='F04'         
	           THISFORM.GRID1.COLUMN1.WIDTH=INT_015*100   
	           THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='料品編號'
	           THISFORM.GRID1.COLUMN2.CONTROLSOURCE='F03'         
	           THISFORM.GRID1.COLUMN2.WIDTH=INT_015*160   
	           THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='生效日期'
	           THISFORM.GRID1.COLUMN3.CONTROLSOURCE='F02'         
	           THISFORM.GRID1.COLUMN3.WIDTH=INT_015*60
	           THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='幣別'
	           THISFORM.GRID1.COLUMN4.CONTROLSOURCE='F06'
	           THISFORM.GRID1.COLUMN4.WIDTH=INT_015*35
	           THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='單價'
	           THISFORM.GRID1.COLUMN5.CONTROLSOURCE='F07'
	           THISFORM.GRID1.COLUMN5.WIDTH=INT_015*80
	           THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='最小訂貨量'        
	           THISFORM.GRID1.COLUMN6.CONTROLSOURCE='F08'
	           THISFORM.GRID1.COLUMN6.WIDTH=INT_015*65
	           THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='特價原因'
	           THISFORM.GRID1.COLUMN7.CONTROLSOURCE="IIF(SEEK(F01+F03+F06+F12,'C21'),C21.F05,'')"
	           THISFORM.GRID1.COLUMN7.WIDTH=INT_015*70
	           THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='交易條件'
	           THISFORM.GRID1.COLUMN8.CONTROLSOURCE='F10'
	           THISFORM.GRID1.COLUMN8.WIDTH=INT_015*80
	           THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='報價單號'
	           THISFORM.GRID1.COLUMN9.CONTROLSOURCE='F11'
	           THISFORM.GRID1.COLUMN9.WIDTH=INT_015*80	           
	           THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='安全資料'
	           THISFORM.GRID1.COLUMN10.CONTROLSOURCE='F99'
	           THISFORM.GRID1.COLUMN10.WIDTH=INT_015*90
       ENDCASE
       JK=THISFORM.GRID1.COLUMN1.HEADER1.CAPTION
       THISFORM.GRID1.REFRESH
       THISFORM.GRID1.SETFOCUS
  ENDPROC 
      PROCEDURE CMND2.CLICK
          SELECT C0B_1
          USE
          FLG=''   
          THISFORM.RELEASE
      ENDPROC      
      PROCEDURE CMND3.CLICK
         if messagebox('是否確定要將此筆舊資料匯回正式報價紀錄',4+32+256,'請確認') = 6	
            SELECT C02
            APPEND BLANK
            REPLACE F01 WITH C0B_1.F01
            REPLACE F02 WITH C0B_1.F02
            REPLACE F03 WITH C0B_1.F03
            REPLACE F04 WITH C0B_1.F04
            REPLACE F05 WITH C0B_1.F05
            REPLACE F06 WITH C0B_1.F06
            REPLACE F07 WITH C0B_1.F07
            REPLACE F08 WITH C0B_1.F08
            REPLACE F10 WITH C0B_1.F10
            REPLACE F11 WITH C0B_1.F11
            REPLACE F12 WITH C0B_1.F12
            REPLACE F13 WITH C0B_1.F13
            REPLACE F14 WITH C0B_1.F14
            REPLACE F15 WITH C0B_1.F15
            REPLACE F16 WITH C0B_1.F16            
            REPLACE F99 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
            SELECT C0B
            DELETE FROM C0B WHERE C0B.F01+C0B.F03+C0B.F06+C0B.F12+DTOS(C0B.F02)+C0B.F11=C0B_1.F01+C0B_1.F03+C0B_1.F06+C0B_1.F12+DTOS(C0B_1.F02)+C0B_1.F11
            SELECT C0B_1
            DELETE
            SKIP -1
            IF BOF()
               GO TOP
            ENDIF          
         ENDIF 
         THISFORM.GRID1.SETFOCUS
      ENDPROC            
      PROCEDURE ORPGROUP.DEL_BOTT.CLICK
         if messagebox('是否確定要刪除此筆資料',4+32+256,'請確認') = 6	 
            SELECT C0B
            DELETE FROM C0B WHERE C0B.F01+C0B.F03+C0B.F06+C0B.F12+DTOS(C0B.F02)+C0B.F11=C0B_1.F01+C0B_1.F03+C0B_1.F06+C0B_1.F12+DTOS(C0B_1.F02)+C0B_1.F11
            SELECT C0B_1
            DELETE
            SKIP -1
            IF BOF()
               GO TOP
            ENDIF
         ENDIF
         THISFORM.GRID1.SETFOCUS
     ENDPROC  
ENDDEFINE   