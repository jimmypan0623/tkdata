***程式名稱:C97E.業務助理別年度出貨毛利分析
C97EFORM=CREATEOBJECT("TKC97E")
C97EFORM.SHOW  
DEFINE CLASS TKC97E AS FORM
*!*	  AUTOCENTER=.T.  
  MOVABLE=.F.
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*550
  WIDTH=INT_015*792
  MAXBUTTON=.F.
  MINBUTTON=.F.    
  CONTROLBOX=.F.
  BORDERSTYLE=1
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WINDOWTYPE=1
  NAME='C97EFORM'
  ADD OBJECT KEY_LIST AS KEY_LIST WITH;
      AUTOCENTER=.T. 
  ADD OBJECT ORPGROUP AS ORPGROUP WITH;            
      TOP=0,;
      LEFT=INT_015*400                  
 ADD OBJECT CMDGROUP AS CMDGROUP WITH;
      TOP=0,;
      ENABLED=.T.,;
      LEFT=INT_015*245
   ADD OBJECT CMND2 AS COMMANDBUTTON WITH;
      LEFT=INT_015*462,;
      TOP=INT_015*5,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*65,; 
      FONTSIZE=INT_015*9,;
      CAPTION='\<E.轉EXCEL',;
      TOOLTIPTEXT='將資料轉成EXCEL'           
 ADD OBJECT LBL_REC AS LBL_REC WITH;
      TOP=INT_015*10,;
      AUTOCENTER =.T.
 ADD OBJECT REC_COUNT AS REC_COUNT  WITH;
      TOP=INT_015*10,;
      LEFT=INT_015*700,;  
      CAPTION=STR(RECCOUNT('YCO'))
  ADD OBJECT GRID1 AS GRID1 WITH;          
      AUTOCENTER=.T.,;
      TOP=INT_015*30,;
      WIDTH=INT_015*789,;      
      HEIGHT=INT_015*500,;  
      ROWHEIGHT=INT_015*18,;
      HEADERHEIGHT=INT_015*18,;          
      DELETEMARK=.F.,;
      READONLY=.T.,;
      RECORDSOURCETYPE=1,;
      COLUMNCOUNT=15,;
      BACKCOLOR=RGB(58,186,152),;           
      NAME='GRID1',;
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;      
      COLUMN3.NAME='COLUMN3',;
      COLUMN4.NAME='COLUMN4',;
      COLUMN5.NAME='COLUMN5',;
      COLUMN6.NAME='COLUMN6',;
      COLUMN7.NAME='COLUMN7',;
      COLUMN8.NAME='COLUMN8',;
      COLUMN9.NAME='COLUMN9',;
      COLUMN10.NAME='COLUMN10',;
      COLUMN11.NAME='COLUMN11',;
      COLUMN12.NAME='COLUMN12',;
      COLUMN13.NAME='COLUMN13',;
      COLUMN14.NAME='COLUMN14',;  
      COLUMN15.NAME='COLUMN15'      
*********************************************      
  PROCEDURE INIT
  	 SELE YCO
  	 GO TOP
 	 THISFORM.KEY_LIST.DISPLAYVALUE='依業助編號排列'
         THISFORM.CAPTION='C97E.業務助理別年度出貨'+IIF(FLG='0','毛利率%分析','毛利分析')+'('+IIF(UKEF='Y','部品',IIF(UKEF='N','線材','全部'))+')'+'          資料年度:'+YEAR_STR+'年'  
         THISFORM.GRID1.RECORDSOURCE='YCO' 
         THISFORM.GRID1.READONLY=.T. 
         THISFORM.ORPGROUP.NEW_BOTT.VISIBLE=.F.
         THISFORM.ORPGROUP.EDIT_BOTT.VISIBLE=.F.
         THISFORM.ORPGROUP.DEL_BOTT.VISIBLE=.F.
         THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'COLUMN')
         THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'HEADER')
         THISFORM.GRID1.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)
         THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限  
         THISFORM.CMND2.ENABLED=IIF(A02.F07='*',.T.,.F.)      
              THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='業助編號'
              THISFORM.GRID1.COLUMN1.CONTROLSOURCE='YCO.F23'
              THISFORM.GRID1.COLUMN1.WIDTH=INT_015*50                 
              THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='業助姓名'
              THISFORM.GRID1.COLUMN2.CONTROLSOURCE='YCO.F231'
              THISFORM.GRID1.COLUMN2.WIDTH=INT_015*50
              THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='一月'
              THISFORM.GRID1.COLUMN3.CONTROLSOURCE='YCO.JAN'
              THISFORM.GRID1.COLUMN3.WIDTH=INT_015*70                   
              THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='二月'
              THISFORM.GRID1.COLUMN4.CONTROLSOURCE='YCO.FEB'
              THISFORM.GRID1.COLUMN4.WIDTH=INT_015*70
              THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='三月'
              THISFORM.GRID1.COLUMN5.CONTROLSOURCE='YCO.MAR'
              THISFORM.GRID1.COLUMN5.WIDTH=INT_015*70
              THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='四月'
              THISFORM.GRID1.COLUMN6.CONTROLSOURCE='YCO.APR'
              THISFORM.GRID1.COLUMN6.WIDTH=INT_015*70
              THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='五月'
              THISFORM.GRID1.COLUMN7.CONTROLSOURCE='YCO.MAY'
              THISFORM.GRID1.COLUMN7.WIDTH=INT_015*70               
              THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='六月'
              THISFORM.GRID1.COLUMN8.CONTROLSOURCE='YCO.JUN'
              THISFORM.GRID1.COLUMN8.WIDTH=INT_015*70
              THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='七月'
              THISFORM.GRID1.COLUMN9.CONTROLSOURCE='YCO.JUL'
              THISFORM.GRID1.COLUMN9.WIDTH=INT_015*70
              THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='八月'
              THISFORM.GRID1.COLUMN10.CONTROLSOURCE='YCO.AUG'
              THISFORM.GRID1.COLUMN10.WIDTH=INT_015*70
              THISFORM.GRID1.COLUMN11.HEADER1.CAPTION='九月'
              THISFORM.GRID1.COLUMN11.CONTROLSOURCE='YCO.SEP'
              THISFORM.GRID1.COLUMN11.WIDTH=INT_015*70
              THISFORM.GRID1.COLUMN12.HEADER1.CAPTION='十月'
              THISFORM.GRID1.COLUMN12.CONTROLSOURCE='YCO.OCT'
              THISFORM.GRID1.COLUMN12.WIDTH=INT_015*70
              THISFORM.GRID1.COLUMN13.HEADER1.CAPTION='十一月'
              THISFORM.GRID1.COLUMN13.CONTROLSOURCE='YCO.NOV'
              THISFORM.GRID1.COLUMN13.WIDTH=INT_015*70
              THISFORM.GRID1.COLUMN14.HEADER1.CAPTION='十二月'
              THISFORM.GRID1.COLUMN14.CONTROLSOURCE='YCO.DEC'
              THISFORM.GRID1.COLUMN14.WIDTH=INT_015*70 
              THISFORM.GRID1.COLUMN15.HEADER1.CAPTION=IIF(FLG='0','出貨平均毛利率','毛利合計')
              THISFORM.GRID1.COLUMN15.CONTROLSOURCE='YCO.SUM_TOL'
              THISFORM.GRID1.COLUMN15.WIDTH=INT_015*70      
         THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(YCO.SUM_TOL<0,RGB(255,0,0),'')","COLUMN")                                   
         JK='業助編號'         
         THISFORM.GRID1.SETFOCUS  
  ENDPROC
***************************************      
  PROC KEY_LIST.INIT 
       WITH THIS 
           .ADDITEM('依業助編號排列')
           .ADDITEM(IIF(FLG='0','依平均毛利率%(由大到小)排列','依毛利合計(由大到小)排列'))
       ENDWITH      
  ENDPROC
*************搜尋排列************************** 
PROC KEY_LIST.INTERACTIVECHANGE                 
     IF THIS.DISPLAYVALUE='依業助編號排列' 
              SELE YCO       
              SET ORDER TO 1
              GO TOP
              AREA1='YCO'
              THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限
              THISFORM.CMND2.ENABLED=IIF(A02.F07='*',.T.,.F.)  
              THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.
              THISFORM.GRID1.RECORDSOURCE='YCO'   
              THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='業助編號'
              THISFORM.GRID1.COLUMN1.CONTROLSOURCE='YCO.F23'
              THISFORM.GRID1.COLUMN1.WIDTH=INT_015*50              
              THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='業助姓名'
              THISFORM.GRID1.COLUMN2.CONTROLSOURCE='YCO.F231'
              THISFORM.GRID1.COLUMN2.WIDTH=INT_015*50
              THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='一月'
              THISFORM.GRID1.COLUMN3.CONTROLSOURCE='YCO.JAN'
              THISFORM.GRID1.COLUMN3.WIDTH=INT_015*70                   
              THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='二月'
              THISFORM.GRID1.COLUMN4.CONTROLSOURCE='YCO.FEB'
              THISFORM.GRID1.COLUMN4.WIDTH=INT_015*70
              THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='三月'
              THISFORM.GRID1.COLUMN5.CONTROLSOURCE='YCO.MAR'
              THISFORM.GRID1.COLUMN5.WIDTH=INT_015*70
              THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='四月'
              THISFORM.GRID1.COLUMN6.CONTROLSOURCE='YCO.APR'
              THISFORM.GRID1.COLUMN6.WIDTH=INT_015*70
              THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='五月'
              THISFORM.GRID1.COLUMN7.CONTROLSOURCE='YCO.MAY'
              THISFORM.GRID1.COLUMN7.WIDTH=INT_015*70               
              THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='六月'
              THISFORM.GRID1.COLUMN8.CONTROLSOURCE='YCO.JUN'
              THISFORM.GRID1.COLUMN8.WIDTH=INT_015*70
              THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='七月'
              THISFORM.GRID1.COLUMN9.CONTROLSOURCE='YCO.JUL'
              THISFORM.GRID1.COLUMN9.WIDTH=INT_015*70
              THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='八月'
              THISFORM.GRID1.COLUMN10.CONTROLSOURCE='YCO.AUG'
              THISFORM.GRID1.COLUMN10.WIDTH=INT_015*70
              THISFORM.GRID1.COLUMN11.HEADER1.CAPTION='九月'
              THISFORM.GRID1.COLUMN11.CONTROLSOURCE='YCO.SEP'
              THISFORM.GRID1.COLUMN11.WIDTH=INT_015*70
              THISFORM.GRID1.COLUMN12.HEADER1.CAPTION='十月'
              THISFORM.GRID1.COLUMN12.CONTROLSOURCE='YCO.OCT'
              THISFORM.GRID1.COLUMN12.WIDTH=INT_015*70
              THISFORM.GRID1.COLUMN13.HEADER1.CAPTION='十一月'
              THISFORM.GRID1.COLUMN13.CONTROLSOURCE='YCO.NOV'
              THISFORM.GRID1.COLUMN13.WIDTH=INT_015*70
              THISFORM.GRID1.COLUMN14.HEADER1.CAPTION='十二月'
              THISFORM.GRID1.COLUMN14.CONTROLSOURCE='YCO.DEC'
              THISFORM.GRID1.COLUMN14.WIDTH=INT_015*70 
              THISFORM.GRID1.COLUMN15.HEADER1.CAPTION=IIF(FLG='0','出貨平均毛利率','毛利合計')
              THISFORM.GRID1.COLUMN15.CONTROLSOURCE='YCO.SUM_TOL'
              THISFORM.GRID1.COLUMN15.WIDTH=INT_015*70      
              THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(YCO.SUM_TOL<0,RGB(255,0,0),'')","COLUMN")                                 
              THISFORM.GRID1.SETFOCUS   
   ELSE  
	      	 SELE * ORDER BY SUM_TOL DESC FROM YCO INTO CURSOR YCO2
*!*		 		 INDEX ON F23  TAG YCO2
		     GO TOP
      	      AREA1='YCO2'
      	      THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
      	      THISFORM.CMND2.ENABLED=.F. 
      	      THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
              THISFORM.GRID1.RECORDSOURCE='YCO2'  
              THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='業助編號'
              THISFORM.GRID1.COLUMN1.CONTROLSOURCE='YCO2.F23'
              THISFORM.GRID1.COLUMN1.WIDTH=INT_015*50
              THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='業助姓名'
              THISFORM.GRID1.COLUMN2.CONTROLSOURCE='YCO2.F231'
              THISFORM.GRID1.COLUMN2.WIDTH=INT_015*50              
              THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='一月'
              THISFORM.GRID1.COLUMN3.CONTROLSOURCE='YCO2.JAN'
              THISFORM.GRID1.COLUMN3.WIDTH=INT_015*70                   
              THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='二月'
              THISFORM.GRID1.COLUMN4.CONTROLSOURCE='YCO2.FEB'
              THISFORM.GRID1.COLUMN4.WIDTH=INT_015*70
              THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='三月'
              THISFORM.GRID1.COLUMN5.CONTROLSOURCE='YCO2.MAR'
              THISFORM.GRID1.COLUMN5.WIDTH=INT_015*70
              THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='四月'
              THISFORM.GRID1.COLUMN6.CONTROLSOURCE='YCO2.APR'
              THISFORM.GRID1.COLUMN6.WIDTH=INT_015*70
              THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='五月'
              THISFORM.GRID1.COLUMN7.CONTROLSOURCE='YCO2.MAY'
              THISFORM.GRID1.COLUMN7.WIDTH=INT_015*70               
              THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='六月'
              THISFORM.GRID1.COLUMN8.CONTROLSOURCE='YCO2.JUN'
              THISFORM.GRID1.COLUMN8.WIDTH=INT_015*70
              THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='七月'
              THISFORM.GRID1.COLUMN9.CONTROLSOURCE='YCO2.JUL'
              THISFORM.GRID1.COLUMN9.WIDTH=INT_015*70
              THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='八月'
              THISFORM.GRID1.COLUMN10.CONTROLSOURCE='YCO2.AUG'
              THISFORM.GRID1.COLUMN10.WIDTH=INT_015*70
              THISFORM.GRID1.COLUMN11.HEADER1.CAPTION='九月'
              THISFORM.GRID1.COLUMN11.CONTROLSOURCE='YCO2.SEP'
              THISFORM.GRID1.COLUMN11.WIDTH=INT_015*70
              THISFORM.GRID1.COLUMN12.HEADER1.CAPTION='十月'
              THISFORM.GRID1.COLUMN12.CONTROLSOURCE='YCO2.OCT'
              THISFORM.GRID1.COLUMN12.WIDTH=INT_015*70
              THISFORM.GRID1.COLUMN13.HEADER1.CAPTION='十一月'
              THISFORM.GRID1.COLUMN13.CONTROLSOURCE='YCO2.NOV'
              THISFORM.GRID1.COLUMN13.WIDTH=INT_015*70
              THISFORM.GRID1.COLUMN14.HEADER1.CAPTION='十二月'
              THISFORM.GRID1.COLUMN14.CONTROLSOURCE='YCO2.DEC'
              THISFORM.GRID1.COLUMN14.WIDTH=INT_015*70 
              THISFORM.GRID1.COLUMN15.HEADER1.CAPTION=IIF(FLG='0','出貨平均毛利率','毛利合計')
              THISFORM.GRID1.COLUMN15.CONTROLSOURCE='YCO2.SUM_TOL'
              THISFORM.GRID1.COLUMN15.WIDTH=INT_015*70      
              THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(YCO2.SUM_TOL<0,RGB(255,0,0),'')","COLUMN")                                 
              THISFORM.GRID1.SETFOCUS  
   ENDIF
   JK=THISFORM.GRID1.COLUMN1.HEADER1.CAPTION
   THISFORM.GRID1.REFRESH
   THISFORM.GRID1.SETFOCUS
  ENDPROC
**********************************************************                      
    PROC GRID1.AFTERROWCOLCHANGE
       LPARAMETERS XCOLINDEX 
         FCH=THISFORM.ACTIVECONTROL.NAME  
         CHK=''         
         THISFORM.REFRESH
    ENDPROC
    ***轉EXCEL 
    PROC CMND2.CLICK
       SELECT YCO
       FILENAME='業務助理別'+YEAR_STR+'年度'+IIF(UKEF='Y','部品',IIF(UKEF='N','製品','全部'))+'出貨毛利'+IIF(FLG='0','率','')+'分析'   
       IF FLG='0'
            SELECT  YCO.F23 業助編號,YCO.F231 業助姓名,YCO.JAN 一月,YCO.FEB 二月,YCO.MAR 三月,YCO.APR 四月,YCO.MAY 五月,YCO.JUN 六月,;
                           YCO.JUL 七月,YCO.AUG 八月,YCO.SEP 九月,YCO.OCT 十月,YCO.NOV 十一月,YCO.DEC 十二月,YCO.SUM_TOL 出貨平均毛利率;
                           FROM YCO ORDER BY YCO.F23  NOWAIT
       ELSE
            SELECT  YCO.F23 業助編號,YCO.F231 業助姓名,YCO.JAN 一月,YCO.FEB 二月,YCO.MAR 三月,YCO.APR 四月,YCO.MAY 五月,YCO.JUN 六月,;
                           YCO.JUL 七月,YCO.AUG 八月,YCO.SEP 九月,YCO.OCT 十月,YCO.NOV 十一月,YCO.DEC 十二月,YCO.SUM_TOL 毛利合計;
                           FROM YCO ORDER BY YCO.F23  NOWAIT       
       ENDIF                    
       GCDELIMFILE=PUTFILE('儲存路徑',FILENAME,'XLS')
       IF !EMPTY(GCDELIMFILE) 
	    ON ERROR DO FILE_IMPACT
	    COPY TO (GCDELIMFILE) TYPE XL5     
	    =MESSAGEBOX('儲存成功',0+64,'提示訊息視窗') 
      ENDIF   
    ENDPROC    
ENDDEFINE     
*************************************************************列印
PROCEDURE PNT_PRC
    SELECT  YCO
    NOW_POINT=YCO.F23 
    CALCULATE SUM(JAN) TO T1
    CALCULATE SUM(FEB) TO T2
    CALCULATE SUM(MAR) TO T3
    CALCULATE SUM(APR) TO T4
    CALCULATE SUM(MAY) TO T5
    CALCULATE SUM(JUN) TO T6
    CALCULATE SUM(JUL) TO T7
    CALCULATE SUM(AUG) TO T8
    CALCULATE SUM(SEP) TO T9
    CALCULATE SUM(OCT) TO T10
    CALCULATE SUM(NOV) TO T11
    CALCULATE SUM(DEC) TO T12      
    REPORT FORM ALLTRIM(INT_116)+'C97E' PREVIEW 
    CLEAR
    SELE YCO
    SET ORDER TO YCO_1
    SEEK NOW_POINT    
ENDPROC