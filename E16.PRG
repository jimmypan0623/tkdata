**程式名稱:E16.生產領料計劃
SET EXCL OFF
CLOSE ALL
CLEAR 
AREA1='E16'
FLG='0'
FCH=''
CHK=''
IF !USED('A01')
   SELE 0
   USE A01
ELSE 
   SELE A01
ENDIF
SET ORDER TO A01      
IF !USED('A02')
   SELE 0
   USE A02 INDE A02
ELSE
   SELE A02
ENDIF
SET ORDER TO A021      
SEEK SYS_OPER+'E16'   
CHA = IIF(SEEK(SYS_OPER+'C66','A02'),.T.,.F.)
SELE 0
IF !USED('B11')
   SELE 0
   USE B11
ELSE 
   SELE B11
ENDIF
SET FILTER TO F01<>INT_190
SET ORDER TO B112      
IF !USED ('B01')
   SELE 0
   USE B01 
ELSE 
   SELE B01
ENDIF
SET ORDER TO 1
SET RELA TO F01+F07 INTO B11
IF !USED('C01')
   SELE 0
   USE C01
ELSE 
   SELE C01 
ENDIF
SET ORDER TO 1
IF !USED('E00')
   SELE 0
   USE E00 
ELSE 
   SELE E00 
ENDIF
SET ORDER TO E001
IF !USED('E03')
   SELE 0
   USE E03
ELSE 
   SELE E03 
ENDIF
SET ORDER TO 1
SET RELA TO F08 INTO C01
IF !USED('C03')
   SELE 0
   USE C03 
ELSE 
   SELE C03 
ENDIF
SET ORDER TO 1
IF !USED('D01')
   SELE 0
   USE D01
ELSE
   SELE D01
ENDIF
SET ORDER TO D011 
IF !USED('D03')
   SELE 0
   USE D03
ELSE
   SELE D03
ENDIF
SET ORDER TO 1
IF !USED('P04')
   SELE 0
   USE P04
ELSE
  SELE P04
ENDIF
SET ORDER TO 1           
IF !USED('P05')
   SELE 0
   USE P05
ELSE
  SELE P05
ENDIF
SET ORDER TO 1
IF !USED('P06')
   SELE 0
   USE P06
ELSE
  SELE P06
ENDIF
SET ORDER TO 1  
IF !USED('D07')
   SELE 0
   USE D07
ELSE
   SELE D07
ENDIF
SET ORDER TO D071
IF !USED('C66')
   SELECT 0
   USE C66
ELSE 
   SELECT C66
ENDIF
SET ORDER TO C661
IF !USED('A14')
   SELE 0
   USE A14
ELSE 
   SELE A14
ENDIF
SET ORDER TO 1                       
IF !USED('E16')
   SELE 0
   USE E16 
ELSE
   SELE E16
ENDIF
SET ORDER TO E161
DELETE FROM E16 WHERE F04=0
SET RELA TO F02 INTO B01
SET RELA TO F06 INTO A14 ADDI
SET RELA TO F12 INTO E00 ADDI
SET RELA TO F01 INTO E03 ADDI


             SELE F01,F02,F03,F04 FROM D07 UNION ALL SELE F01,F02,F03,F04*(-1) FROM C05 WHERE F02= ANY(SELE F02 FROM E16) AND !EMPTY(C05.F15) INTO CURSOR TKE081             
             SELE F01,F02,F03,F04 FROM E06 UNION ALL SELE F01,F02,F03,F04*(-1) FROM E16 WHERE F02= ANY(SELE F02 FROM E16) INTO CURSOR TKE082
             CREATE CURSOR TKE08 (F01 C(12),F02 C(43),F03 D(8),F04 N(13,4))
             INDEX ON F02+DTOS(F03)+F01 TAG TKE08
             SET ORDER TO 1
             SELE TKE081
             GO TOP
             DO WHILE !EOF()
                SELE TKE08
                APPEND BLANK
                REPL F01 WITH TKE081.F01
                REPL F02 WITH TKE081.F02
                REPL F03 WITH TKE081.F03
                REPL F04 WITH TKE081.F04
                SELE TKE081
                SKIP
             ENDDO
             SELE TKE081
             USE
             SELE TKE082
             GO TOP
             DO WHILE !EOF()
                SELE TKE08
                APPEND BLANK
                REPL F01 WITH TKE082.F01
                REPL F02 WITH TKE082.F02
                REPL F03 WITH TKE082.F03
                REPL F04 WITH TKE082.F04
                SELE TKE082
                SKIP
             ENDDO             
             SELE TKE082
             USE
SELE E16
GO TOP
E16FORM=CREATEOBJECT("TKE16")
E16FORM.SHOW  
DEFINE CLASS TKE16 AS FORM
  CAPTION='E16.生產領料計劃'
*!*	  AUTOCENTER=.T.
  CONTROLBOX=.F.
  BORDERSTYLE=3  
  MAXBUTTON=.F.
  MINBUTTON=.F.
  MOVABLE=.F.
  CLOSABLE=.F.
  CONTROLCOUNT=57
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*550
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WIDTH=INT_015*789
  WINDOWTYPE=1
*!*	  ADD OBJECT SHAPE1 AS SHAPE1 WITH;
*!*	      AUTOCENTER=.T.
*!*	  ADD OBJECT SHAPE2 AS SHAPE2 WITH;
*!*	      AUTOCENTER=.T.
*!*	  ADD OBJECT SHAPE3 AS SHAPE3 WITH;
*!*	      AUTOCENTER=.T.
  ADD OBJECT LBL_REC AS LBL_REC WITH;
      AUTOCENTER =.T.,;
      CAPTION='總庫存量',;
      TOP=INT_015*39
  ADD OBJECT REC_COUNT AS REC_COUNT  WITH;
      TOP=INT_015*39
  ADD OBJECT KEY_LIST AS KEY_LIST WITH;
      AUTOCENTER=.T.,;
      WIDTH=INT_015*170
  ADD OBJECT GRID1 AS GRID1 WITH;
      COLUMNCOUNT=13,;            
      RECORDSOURCE='E16',; 
      TOP=INT_015*61,;  
      HEIGHT=INT_015*465,;     
      WIDTH=INT_015*780,;      
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;
      COLUMN3.NAME='COLUMN3',; 
      COLUMN4.NAME='COLUMN4',; 
      COLUMN5.NAME='COLUMN5',;             
      COLUMN6.NAME='COLUMN6',;       
      COLUMN7.NAME='COLUMN7',;       
      COLUMN8.NAME='COLUMN8',;
      COLUMN9.NAME='COLUMN9',;
      COLUMN10.NAME='COLUMN10',;
      COLUMN11.NAME='COLUMN11',;
      COLUMN12.NAME='COLUMN12',;
      COLUMN13.NAME='COLUMN13'
  ADD OBJECT ORPGROUP AS ORPGROUP WITH;      
      TOP=INT_015*0,;
      LEFT=INT_015*435             
  ADD OBJECT CMDGROUP AS CMDGROUP WITH;
      TOP=INT_015*0,;
      LEFT=INT_015*180,;
      ENABLED=.T.,;
     VISIBLE=.T.           
  ADD OBJECT INSCH AS COMMANDBUTTON WITH;
      TOP=INT_015*33,;
      LEFT=INT_015*105,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*65,;
      FONTSIZE=INT_015*9,;
      CAPTION='\<A.進貨計劃'      

    ADD OBJECT INV_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*5,;
      LEFT=INT_015*695,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*65,;
      FONTSIZE=INT_015*9,;
      CAPTION='\<V.庫存明細'  
  
  ADD OBJECT REPLY_REMARK AS COMMANDBUTTON WITH;
      TOP=INT_015*5,;
      LEFT=INT_015*525,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;
      CAPTION='\<E.修改'           
   ADD OBJECT LBLF01 AS LABEL WITH;
      TOP=INT_015*39,;
      LEFT=INT_015*185,;
      HEIGHT=INT_015*23,;      
      WIDTH=INT_015*50,;
      FONTSIZE=INT_015*9,;
       CAPTION='回覆交期'            
  ADD OBJECT TXTF01 AS TEXTBOX WITH;
      TOP=INT_015*33,;
      LEFT=INT_015*235,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*70,;
      MAXLENGTH=8,;
      FONTSIZE=INT_015*9
  ADD OBJECT LBLF02 AS LABEL WITH;
      TOP=INT_015*39,;
      LEFT=INT_015*310,;
      HEIGHT=INT_015*23,;      
      WIDTH=INT_015*30,;
      FONTSIZE=INT_015*9,;
      CAPTION='備 註'     
  ADD OBJECT TXTF02 AS TEXTBOX WITH;
      TOP=INT_015*33,;
      LEFT=INT_015*340,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*200,;
      MAXLENGTH=30,;
      FONTSIZE=INT_015*9
  ADD OBJECT YES AS COMMANDBUTTON WITH;
      TOP=INT_015*33,;
      LEFT=INT_015*566,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;
      CAPTION='\<Y.確定'
  ADD OBJECT NO AS COMMANDBUTTON WITH;
      TOP=INT_015*33,;
      LEFT=INT_015*608,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;
      CAPTION='\<N.取消' 
*!*	  ADD OBJECT LBLF07 AS LABEL WITH;
*!*	      TOP=INT_015*39,;
*!*	      LEFT=INT_015*555,;
*!*	      HEIGHT=INT_015*23,;      
*!*	      WIDTH=INT_015*50,;
*!*	      FONTSIZE=INT_015*9,;
*!*	      CAPTION='安全資料'
  ADD OBJECT LBLF071 AS LABEL WITH;
      TOP=INT_015*39,;
      LEFT=INT_015*555,;
      FONTSIZE=INT_015*9,;
	  VISIBLE=.T.,;
      AUTOSIZE=.T.,;
      CAPTION=''                                        
  ADD OBJECT IODT_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*5,;
      LEFT=INT_015*460,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*65,;
      CAPTION='\<Z.預期異動',;
      FONTSIZE=INT_015*9,;
      ENABLED=.T.,;
      VISIBLE=.T.      
  PROCEDURE INIT
       THISFORM.ORPGROUP.NEW_BOTT.VISIBLE=.F.
       THISFORM.ORPGROUP.EDIT_BOTT.VISIBLE=.F.
       THISFORM.ORPGROUP.DEL_BOTT.VISIBLE=.F.
       THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限    
       
       
       THISFORM.REPLY_REMARK.ENABLED=IIF(A02.F05='*',.T.,.F.) &&判斷有無修改回覆交期與備註的權
       THISFORM.YES.ENABLED=.F.
       THISFORM.NO.ENABLED=.F.
       THISFORM.YES.VISIBLE=.F.
       THISFORM.NO.VISIBLE=.F.
       THISFORM.SETALL('READONLY',.T.,'TEXTBOX') 
       THISFORM.GRID1.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'COLUMN')
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'HEADER')
       THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(EMPTY(E16.F10),IIF(DATE()-CTOD(LEFT(E16.F07,9))>=VAL(INT_205) .AND. DATE()-CTOD(LEFT(E16.F07,9))>=-VAL(INT_205),RGB(255,255,0),''),IIF(DATE()-E16.F10>=VAL(INT_206),RGB(255,0,0),IIF(E16.F10>DATE(),'',RGB(0,255,255))))","COLUMN")
       *THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(E16.F03>=DATE()-30 .AND. E16.F03<DATE(),RGB(255,0,0),IIF(E16.F03<DATE()-30,RGB(255,0,0),''))","COLUMN")                   
       *THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(SEEK(E16.F01+E16.F02,'PPP'),'',IIF(EMPTY(E16.F10),IIF(DATE()-E16.F03>=21 .AND. DATE()-E16.F03>=-21,RGB(255,255,0),''),IIF(DATE()-E16.F10>=14,RGB(255,0,0),'')))","COLUMN")
       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*80
       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*55
       THISFORM.GRID1.COLUMN3.WIDTH=INT_015*149
       THISFORM.GRID1.COLUMN4.WIDTH=INT_015*70
       THISFORM.GRID1.COLUMN5.WIDTH=INT_015*55
       THISFORM.GRID1.COLUMN6.WIDTH=INT_015*55
       THISFORM.GRID1.COLUMN7.WIDTH=INT_015*120
       THISFORM.GRID1.COLUMN8.WIDTH=INT_015*60       
       THISFORM.GRID1.COLUMN9.WIDTH=INT_015*55 
       THISFORM.GRID1.COLUMN10.WIDTH=INT_015*60 
       THISFORM.GRID1.COLUMN11.WIDTH=INT_015*70 
       THISFORM.GRID1.COLUMN12.WIDTH=INT_015*55
       THISFORM.GRID1.COLUMN13.WIDTH=INT_015*150       
       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='製令編號'
	   THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='領用日期'
	   THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='領用料號'
  	   THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='領用數量'
  	   THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='部門編號'  	   
  	   THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='部門名稱'
  	   THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='完成品號'
	   THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='需求客戶'	     	   
  	   THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='回覆交期'
  	   THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='開單未耗'
  	   THISFORM.GRID1.COLUMN11.HEADER1.CAPTION='預期結餘' 
  	   THISFORM.GRID1.COLUMN12.HEADER1.CAPTION='投入製程' 
  	   THISFORM.GRID1.COLUMN13.HEADER1.CAPTION='備註'   	   
	   THISFORM.GRID1.COLUMN1.CONTROLSOURCE='E16.F01'
	   THISFORM.GRID1.COLUMN2.CONTROLSOURCE='E16.F03'
	   THISFORM.GRID1.COLUMN3.CONTROLSOURCE='E16.F02'
	   THISFORM.GRID1.COLUMN4.CONTROLSOURCE='E16.F04'
	   THISFORM.GRID1.COLUMN5.CONTROLSOURCE='E16.F06'
	   THISFORM.GRID1.COLUMN6.CONTROLSOURCE='A14.F02'
  	   THISFORM.GRID1.COLUMN7.CONTROLSOURCE='E16.F09'
	   THISFORM.GRID1.COLUMN8.CONTROLSOURCE='C01.F05'  	   
	   THISFORM.GRID1.COLUMN9.CONTROLSOURCE='E16.F10'
	   THISFORM.GRID1.COLUMN10.CONTROLSOURCE='E16.F05'                              
	   THISFORM.GRID1.COLUMN11.CONTROLSOURCE="ALTT(E16.F02,'1')+MRP_QTY(E16.F02,E16.F03,E16.F01)"
	   THISFORM.GRID1.COLUMN11.ALIGNMENT=5
	   THISFORM.GRID1.COLUMN12.CONTROLSOURCE="IIF(SEEK(E16.F12,'E00'),E00.F04,'')"
	   THISFORM.GRID1.COLUMN13.CONTROLSOURCE='E16.F11'	   
       THISFORM.GRID1.READONLY=.T.       
       THISFORM.GRID1.SETFOCUS
       JK='製令編號'
  ENDPROC     
  PROC KEY_LIST.INIT 
       WITH THIS 
           .ADDITEM('依製令編號+領用日期排列')
           .ADDITEM('依領用日期+製令編號排列')
           .ADDITEM('依部門編號+完成品號排列')           
           .ADDITEM('依製令編號+領用料號排列')           
           .ADDITEM('依領用料號+領用日期排列')  
           .ADDITEM('依部門編號+領用料號排列')
           .ADDITEM('依完成品號+領用料號排列')
           .ADDITEM('依部門編號+領用日期排列')
*!*	           .ADDITEM('依製令編號+製程編號排列')           
       ENDWITH      
  ENDPROC 
  PROC KEY_LIST.INTERACTIVECHANGE                 
       SELE E16
       DO CASE
          CASE THIS.DISPLAYVALUE='依製令編號+領用日期排列'
               SET ORDER TO E161 
               THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='製令編號'
               THISFORM.GRID1.COLUMN1.CONTROLSOURCE='E16.F01'
               THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='領用日期'
               THISFORM.GRID1.COLUMN2.CONTROLSOURCE='E16.F03'      
               THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='領用料號'	                   
               THISFORM.GRID1.COLUMN3.CONTROLSOURCE='E16.F02'
        	   THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='領用數量'        	   
        	   THISFORM.GRID1.COLUMN4.CONTROLSOURCE='E16.F04'        	   
        	   THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='部門編號'  	           	   
        	   THISFORM.GRID1.COLUMN5.CONTROLSOURCE='E16.F06'
        	   THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='部門名稱'
	           THISFORM.GRID1.COLUMN6.CONTROLSOURCE='A14.F02'
        	   THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='完成品號'  	           	   
        	   THISFORM.GRID1.COLUMN7.CONTROLSOURCE='E16.F09'	           
               THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='需求客戶'	                   
               THISFORM.GRID1.COLUMN8.CONTROLSOURCE='C01.F05'        	   	   
  	           THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='回覆交期'  	           	   
        	   THISFORM.GRID1.COLUMN9.CONTROLSOURCE='E16.F10'
  	           THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='開單未耗'        	   	                   	   
        	   THISFORM.GRID1.COLUMN10.CONTROLSOURCE='E16.F05'
        	   THISFORM.GRID1.COLUMN11.HEADER1.CAPTION='預期結餘'        	   	           
        	   THISFORM.GRID1.COLUMN11.CONTROLSOURCE="ALTT(E16.F02,'1')+MRP_QTY(E16.F02,E16.F03,E16.F01)"
        	   THISFORM.GRID1.COLUMN12.HEADER1.CAPTION='投入製程'        	   	           
        	   THISFORM.GRID1.COLUMN12.CONTROLSOURCE="IIF(SEEK(E16.F12,'E00'),E00.F04,'')"
        	   THISFORM.GRID1.COLUMN13.HEADER1.CAPTION='備註'  	           	   
        	   THISFORM.GRID1.COLUMN13.CONTROLSOURCE='E16.F11' 	           	   
               THISFORM.GRID1.COLUMN1.WIDTH=INT_015*80
               THISFORM.GRID1.COLUMN2.WIDTH=INT_015*55
               THISFORM.GRID1.COLUMN3.WIDTH=INT_015*149
               THISFORM.GRID1.COLUMN4.WIDTH=INT_015*70
               THISFORM.GRID1.COLUMN5.WIDTH=INT_015*55
               THISFORM.GRID1.COLUMN6.WIDTH=INT_015*55
               THISFORM.GRID1.COLUMN7.WIDTH=INT_015*120
               THISFORM.GRID1.COLUMN8.WIDTH=INT_015*60               
               THISFORM.GRID1.COLUMN9.WIDTH=INT_015*55      	
               THISFORM.GRID1.COLUMN10.WIDTH=INT_015*60
               THISFORM.GRID1.COLUMN11.WIDTH=INT_015*70                
               THISFORM.GRID1.COLUMN12.WIDTH=INT_015*55
               THISFORM.GRID1.COLUMN13.WIDTH=INT_015*150                              
          CASE THIS.DISPLAYVALUE='依領用日期+製令編號排列'
               SET ORDER TO E162          
               THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='領用日期'
               THISFORM.GRID1.COLUMN1.CONTROLSOURCE='E16.F03'
               THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='製令編號'
               THISFORM.GRID1.COLUMN2.CONTROLSOURCE='E16.F01'                  
               THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='領用料號'	                   
               THISFORM.GRID1.COLUMN3.CONTROLSOURCE='E16.F02'
        	   THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='領用數量'        	   
        	   THISFORM.GRID1.COLUMN4.CONTROLSOURCE='E16.F04'        	   
        	   THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='部門編號'  	           	   
        	   THISFORM.GRID1.COLUMN5.CONTROLSOURCE='E16.F06'
        	   THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='部門名稱'
	           THISFORM.GRID1.COLUMN6.CONTROLSOURCE='A14.F02'
        	   THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='完成品號'  	           	   
        	   THISFORM.GRID1.COLUMN7.CONTROLSOURCE='E16.F09'	          
               THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='需求客戶'	                   
               THISFORM.GRID1.COLUMN8.CONTROLSOURCE='C01.F05'        	    	           
  	           THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='回覆交期'  	           	   
        	   THISFORM.GRID1.COLUMN9.CONTROLSOURCE='E16.F10'
  	           THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='開單未耗'        	   	                   	   
        	   THISFORM.GRID1.COLUMN10.CONTROLSOURCE='E16.F05'
        	   THISFORM.GRID1.COLUMN11.HEADER1.CAPTION='預期結餘'        	   	           
        	   THISFORM.GRID1.COLUMN11.CONTROLSOURCE="ALTT(E16.F02,'1')+MRP_QTY(E16.F02,E16.F03,E16.F01)"     
        	   THISFORM.GRID1.COLUMN12.HEADER1.CAPTION='投入製程'        	   	           
        	   THISFORM.GRID1.COLUMN12.CONTROLSOURCE="IIF(SEEK(E16.F12,'E00'),E00.F04,'')"
        	   THISFORM.GRID1.COLUMN13.HEADER1.CAPTION='備註'  	           	   
        	   THISFORM.GRID1.COLUMN13.CONTROLSOURCE='E16.F11'	           	           	      	        	                  
               THISFORM.GRID1.COLUMN1.WIDTH=INT_015*55
               THISFORM.GRID1.COLUMN2.WIDTH=INT_015*80 
               THISFORM.GRID1.COLUMN3.WIDTH=INT_015*149
               THISFORM.GRID1.COLUMN4.WIDTH=INT_015*70
               THISFORM.GRID1.COLUMN5.WIDTH=INT_015*55               
               THISFORM.GRID1.COLUMN6.WIDTH=INT_015*55
               THISFORM.GRID1.COLUMN7.WIDTH=INT_015*120
               THISFORM.GRID1.COLUMN8.WIDTH=INT_015*60               
               THISFORM.GRID1.COLUMN9.WIDTH=INT_015*55              
               THISFORM.GRID1.COLUMN10.WIDTH=INT_015*60 
               THISFORM.GRID1.COLUMN11.WIDTH=INT_015*70 
               THISFORM.GRID1.COLUMN12.WIDTH=INT_015*55
               THISFORM.GRID1.COLUMN13.WIDTH=INT_015*150                                                                       
          CASE THIS.DISPLAYVALUE='依部門編號+完成品號排列'
               SET ORDER TO E163                                     	                                       
               THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='部門編號'
               THISFORM.GRID1.COLUMN1.CONTROLSOURCE='E16.F06'               
               THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='部門名稱'
               THISFORM.GRID1.COLUMN2.CONTROLSOURCE='A14.F02'        
        	   THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='完成品號'  	           	   
        	   THISFORM.GRID1.COLUMN3.CONTROLSOURCE='E16.F09'	        
        	   THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='需求客戶'	                   
               THISFORM.GRID1.COLUMN4.CONTROLSOURCE='C01.F05'                                  	      	                                 
               THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='製令編號'
               THISFORM.GRID1.COLUMN5.CONTROLSOURCE='E16.F01'	 
               THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='領用日期'
               THISFORM.GRID1.COLUMN6.CONTROLSOURCE='E16.F03'                    
        	   THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='領用料號'	                  
        	   THISFORM.GRID1.COLUMN7.CONTROLSOURCE='E16.F02'                                      
        	   THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='領用數量'        	   
        	   THISFORM.GRID1.COLUMN8.CONTROLSOURCE='E16.F04'                	   	   	   
  	           THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='回覆交期'  	           	   
        	   THISFORM.GRID1.COLUMN9.CONTROLSOURCE='E16.F10'
  	           THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='開單未耗'        	   	                   	   
        	   THISFORM.GRID1.COLUMN10.CONTROLSOURCE='E16.F05'
        	   THISFORM.GRID1.COLUMN11.HEADER1.CAPTION='預期結餘'        	   	           
        	   THISFORM.GRID1.COLUMN11.CONTROLSOURCE="ALTT(E16.F02,'1')+MRP_QTY(E16.F02,E16.F03,E16.F01)"       
        	   THISFORM.GRID1.COLUMN12.HEADER1.CAPTION='投入製程'        	   	           
        	   THISFORM.GRID1.COLUMN12.CONTROLSOURCE="IIF(SEEK(E16.F12,'E00'),E00.F04,'')"
        	   THISFORM.GRID1.COLUMN13.HEADER1.CAPTION='備註'  	           	   
        	   THISFORM.GRID1.COLUMN13.CONTROLSOURCE='E16.F11'     	           	           	    	   
               THISFORM.GRID1.COLUMN1.WIDTH=INT_015*55
               THISFORM.GRID1.COLUMN2.WIDTH=INT_015*55 
               THISFORM.GRID1.COLUMN3.WIDTH=INT_015*120    
               THISFORM.GRID1.COLUMN4.WIDTH=INT_015*60            
               THISFORM.GRID1.COLUMN5.WIDTH=INT_015*80                             
               THISFORM.GRID1.COLUMN6.WIDTH=INT_015*55
               THISFORM.GRID1.COLUMN7.WIDTH=INT_015*149
               THISFORM.GRID1.COLUMN8.WIDTH=INT_015*70
               THISFORM.GRID1.COLUMN9.WIDTH=INT_015*55            
               THISFORM.GRID1.COLUMN10.WIDTH=INT_015*60 
               THISFORM.GRID1.COLUMN11.WIDTH=INT_015*70  
               THISFORM.GRID1.COLUMN12.WIDTH=INT_015*55
               THISFORM.GRID1.COLUMN13.WIDTH=INT_015*150                                                                                                    
          CASE THIS.DISPLAYVALUE='依製令編號+領用料號排列'
               SET ORDER TO E164          
               THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='製令編號'
               THISFORM.GRID1.COLUMN1.CONTROLSOURCE='E16.F01'          
               THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='領用料號'
               THISFORM.GRID1.COLUMN2.CONTROLSOURCE='E16.F02'   
               THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='領用日期'
               THISFORM.GRID1.COLUMN3.CONTROLSOURCE='E16.F03'          
        	   THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='領用數量'        	   
        	   THISFORM.GRID1.COLUMN4.CONTROLSOURCE='E16.F04'                             
               THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='部門編號'
               THISFORM.GRID1.COLUMN5.CONTROLSOURCE='E16.F06'	        	   	                  
               THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='部門名稱'
               THISFORM.GRID1.COLUMN6.CONTROLSOURCE='A14.F02'              
        	   THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='完成品號'  	           	   
        	   THISFORM.GRID1.COLUMN7.CONTROLSOURCE='E16.F09'	       
               THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='需求客戶'	                   
               THISFORM.GRID1.COLUMN8.CONTROLSOURCE='C01.F05'                  	             	       	                                             
  	           THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='回覆交期'  	           	   
        	   THISFORM.GRID1.COLUMN9.CONTROLSOURCE='E16.F10'
  	           THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='開單未耗'        	   	                   	   
        	   THISFORM.GRID1.COLUMN10.CONTROLSOURCE='E16.F05'
        	   THISFORM.GRID1.COLUMN11.HEADER1.CAPTION='預期結餘'        	   	           
        	   THISFORM.GRID1.COLUMN11.CONTROLSOURCE="ALTT(E16.F02,'1')+MRP_QTY(E16.F02,E16.F03,E16.F01)"        
        	   THISFORM.GRID1.COLUMN12.HEADER1.CAPTION='投入製程'        	   	           
        	   THISFORM.GRID1.COLUMN12.CONTROLSOURCE="IIF(SEEK(E16.F12,'E00'),E00.F04,'')"
        	   THISFORM.GRID1.COLUMN13.HEADER1.CAPTION='備註'  	           	   
        	   THISFORM.GRID1.COLUMN13.CONTROLSOURCE='E16.F11'	           	           	   	   
               THISFORM.GRID1.COLUMN1.WIDTH=INT_015*80
               THISFORM.GRID1.COLUMN2.WIDTH=INT_015*149 
               THISFORM.GRID1.COLUMN3.WIDTH=INT_015*55     
               THISFORM.GRID1.COLUMN4.WIDTH=INT_015*70                                                 
               THISFORM.GRID1.COLUMN5.WIDTH=INT_015*55
               THISFORM.GRID1.COLUMN6.WIDTH=INT_015*55
               THISFORM.GRID1.COLUMN7.WIDTH=INT_015*120
               THISFORM.GRID1.COLUMN8.WIDTH=INT_015*60                     
               THISFORM.GRID1.COLUMN9.WIDTH=INT_015*55       	
               THISFORM.GRID1.COLUMN10.WIDTH=INT_015*60
               THISFORM.GRID1.COLUMN11.WIDTH=INT_015*70                  
               THISFORM.GRID1.COLUMN12.WIDTH=INT_015*55
               THISFORM.GRID1.COLUMN13.WIDTH=INT_015*150                                 
          CASE THIS.DISPLAYVALUE='依領用料號+領用日期排列'
               SET ORDER TO E165                         
               THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='領用料號'
               THISFORM.GRID1.COLUMN1.CONTROLSOURCE='E16.F02'   
               THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='領用日期'
               THISFORM.GRID1.COLUMN2.CONTROLSOURCE='E16.F03'         
        	   THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='領用數量'        	   
        	   THISFORM.GRID1.COLUMN3.CONTROLSOURCE='E16.F04'                           
               THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='製令編號'
               THISFORM.GRID1.COLUMN4.CONTROLSOURCE='E16.F01'          
               THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='部門編號'
               THISFORM.GRID1.COLUMN5.CONTROLSOURCE='E16.F06'	        	   	                  
               THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='部門名稱'
               THISFORM.GRID1.COLUMN6.CONTROLSOURCE='A14.F02'    
        	   THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='完成品號'  	           	   
        	   THISFORM.GRID1.COLUMN7.CONTROLSOURCE='E16.F09'	         
               THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='需求客戶'	                   
               THISFORM.GRID1.COLUMN8.CONTROLSOURCE='C01.F05'                              	     	                                                 
  	           THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='回覆交期'  	           	   
        	   THISFORM.GRID1.COLUMN9.CONTROLSOURCE='E16.F10'
  	           THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='開單未耗'        	   	                   	   
        	   THISFORM.GRID1.COLUMN10.CONTROLSOURCE='E16.F05'
        	   THISFORM.GRID1.COLUMN11.HEADER1.CAPTION='預期結餘'        	   	           
        	   THISFORM.GRID1.COLUMN11.CONTROLSOURCE="ALTT(E16.F02,'1')+MRP_QTY(E16.F02,E16.F03,E16.F01)"  
        	   THISFORM.GRID1.COLUMN12.HEADER1.CAPTION='投入製程'        	   	           
        	   THISFORM.GRID1.COLUMN12.CONTROLSOURCE="IIF(SEEK(E16.F12,'E00'),E00.F04,'')"
        	   THISFORM.GRID1.COLUMN13.HEADER1.CAPTION='備註'  	           	   
        	   THISFORM.GRID1.COLUMN13.CONTROLSOURCE='E16.F11' 	           	           	         	   
               THISFORM.GRID1.COLUMN1.WIDTH=INT_015*149
               THISFORM.GRID1.COLUMN2.WIDTH=INT_015*55
               THISFORM.GRID1.COLUMN3.WIDTH=INT_015*70               
               THISFORM.GRID1.COLUMN4.WIDTH=INT_015*80
               THISFORM.GRID1.COLUMN5.WIDTH=INT_015*55
               THISFORM.GRID1.COLUMN6.WIDTH=INT_015*55
               THISFORM.GRID1.COLUMN7.WIDTH=INT_015*120
               THISFORM.GRID1.COLUMN8.WIDTH=INT_015*60               
               THISFORM.GRID1.COLUMN9.WIDTH=INT_015*55
               THISFORM.GRID1.COLUMN10.WIDTH=INT_015*60
               THISFORM.GRID1.COLUMN11.WIDTH=INT_015*70
               THISFORM.GRID1.COLUMN12.WIDTH=INT_015*55
               THISFORM.GRID1.COLUMN13.WIDTH=INT_015*150      
          CASE THIS.DISPLAYVALUE='依部門編號+領用料號排列'
               SET ORDER TO E166
               THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='部門編號'
               THISFORM.GRID1.COLUMN1.CONTROLSOURCE='E16.F06'	        	   	                  
               THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='部門名稱'      
               THISFORM.GRID1.COLUMN2.CONTROLSOURCE='A14.F02'                            
               THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='領用料號'
               THISFORM.GRID1.COLUMN3.CONTROLSOURCE='E16.F02'   
               THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='領用日期'
               THISFORM.GRID1.COLUMN4.CONTROLSOURCE='E16.F03'                    
        	   THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='領用數量'        	   
        	   THISFORM.GRID1.COLUMN5.CONTROLSOURCE='E16.F04'        
               THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='製令編號'
               THISFORM.GRID1.COLUMN6.CONTROLSOURCE='E16.F01'           	   
        	   THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='完成品號'  	           	   
        	   THISFORM.GRID1.COLUMN7.CONTROLSOURCE='E16.F09'	          
               THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='需求客戶'	                   
               THISFORM.GRID1.COLUMN8.CONTROLSOURCE='C01.F05'                              	    	                                                 
  	           THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='回覆交期'  	           	   
        	   THISFORM.GRID1.COLUMN9.CONTROLSOURCE='E16.F10'
  	           THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='開單未耗'        	   	                   	   
        	   THISFORM.GRID1.COLUMN10.CONTROLSOURCE='E16.F05'
        	   THISFORM.GRID1.COLUMN11.HEADER1.CAPTION='預期結餘'        	   	           
        	   THISFORM.GRID1.COLUMN11.CONTROLSOURCE="ALTT(E16.F02,'1')+MRP_QTY(E16.F02,E16.F03,E16.F01)"  
        	   THISFORM.GRID1.COLUMN12.HEADER1.CAPTION='投入製程'        	   	           
        	   THISFORM.GRID1.COLUMN12.CONTROLSOURCE="IIF(SEEK(E16.F12,'E00'),E00.F04,'')"
        	   THISFORM.GRID1.COLUMN13.HEADER1.CAPTION='備註'  	           	   
        	   THISFORM.GRID1.COLUMN13.CONTROLSOURCE='E16.F11' 
               THISFORM.GRID1.COLUMN1.WIDTH=INT_015*55  
               THISFORM.GRID1.COLUMN2.WIDTH=INT_015*55                     	   	           	           	         	   
               THISFORM.GRID1.COLUMN3.WIDTH=INT_015*149
               THISFORM.GRID1.COLUMN4.WIDTH=INT_015*55
               THISFORM.GRID1.COLUMN5.WIDTH=INT_015*70
               THISFORM.GRID1.COLUMN6.WIDTH=INT_015*80               
               THISFORM.GRID1.COLUMN7.WIDTH=INT_015*120
               THISFORM.GRID1.COLUMN8.WIDTH=INT_015*60               
               THISFORM.GRID1.COLUMN9.WIDTH=INT_015*55
               THISFORM.GRID1.COLUMN10.WIDTH=INT_015*60
               THISFORM.GRID1.COLUMN11.WIDTH=INT_015*70
               THISFORM.GRID1.COLUMN12.WIDTH=INT_015*55
               THISFORM.GRID1.COLUMN13.WIDTH=INT_015*150                     
          CASE THIS.DISPLAYVALUE='依完成品號+領用料號排列'
               SET ORDER TO E167    
               THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='完成品號'
               THISFORM.GRID1.COLUMN1.CONTROLSOURCE='E16.F09'          
               THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='領用料號'
               THISFORM.GRID1.COLUMN2.CONTROLSOURCE='E16.F02' 
               THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='領用日期'
               THISFORM.GRID1.COLUMN3.CONTROLSOURCE='E16.F03'                      
        	   THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='領用數量'        	   
        	   THISFORM.GRID1.COLUMN4.CONTROLSOURCE='E16.F04'                       
        	   THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='製令編號'
        	   THISFORM.GRID1.COLUMN5.CONTROLSOURCE='E16.F01'                           
               THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='需求客戶'	                   
               THISFORM.GRID1.COLUMN6.CONTROLSOURCE='C01.F05'            
               THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='部門編號'
               THISFORM.GRID1.COLUMN7.CONTROLSOURCE='E16.F06'        	   	                  
               THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='部門名稱'
               THISFORM.GRID1.COLUMN8.CONTROLSOURCE='A14.F02'                    	                                 
  	           THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='回覆交期'
        	   THISFORM.GRID1.COLUMN9.CONTROLSOURCE='E16.F10' 
  	           THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='開單未耗'
        	   THISFORM.GRID1.COLUMN10.CONTROLSOURCE='E16.F05'
        	   THISFORM.GRID1.COLUMN11.HEADER1.CAPTION='預期結餘'
        	   THISFORM.GRID1.COLUMN11.CONTROLSOURCE="ALTT(E16.F02,'1')+MRP_QTY(E16.F02,E16.F03,E16.F01)"
        	   THISFORM.GRID1.COLUMN12.HEADER1.CAPTION='投入製程'
        	   THISFORM.GRID1.COLUMN12.CONTROLSOURCE="IIF(SEEK(E16.F12,'E00'),E00.F04,'')"
        	   THISFORM.GRID1.COLUMN13.HEADER1.CAPTION='備註'
        	   THISFORM.GRID1.COLUMN13.CONTROLSOURCE='E16.F11'   
               THISFORM.GRID1.COLUMN1.WIDTH=INT_015*120
               THISFORM.GRID1.COLUMN2.WIDTH=INT_015*149
               THISFORM.GRID1.COLUMN3.WIDTH=INT_015*55   
               THISFORM.GRID1.COLUMN4.WIDTH=INT_015*70    
               THISFORM.GRID1.COLUMN5.WIDTH=INT_015*80                                      
               THISFORM.GRID1.COLUMN6.WIDTH=INT_015*60
               THISFORM.GRID1.COLUMN7.WIDTH=INT_015*55
               THISFORM.GRID1.COLUMN8.WIDTH=INT_015*55
               THISFORM.GRID1.COLUMN9.WIDTH=INT_015*55
               THISFORM.GRID1.COLUMN10.WIDTH=INT_015*60
               THISFORM.GRID1.COLUMN11.WIDTH=INT_015*70               
               THISFORM.GRID1.COLUMN12.WIDTH=INT_015*55
               THISFORM.GRID1.COLUMN13.WIDTH=INT_015*150                  
      CASE THIS.DISPLAYVALUE='依部門編號+領用日期排列'
               SET ORDER TO E168                                    	                                       
               THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='部門編號'
               THISFORM.GRID1.COLUMN1.CONTROLSOURCE='E16.F06'
               THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='部門名稱'
               THISFORM.GRID1.COLUMN2.CONTROLSOURCE='A14.F02'      
               THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='領用日期'
               THISFORM.GRID1.COLUMN3.CONTROLSOURCE='E16.F03'                           
               THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='製令編號'
               THISFORM.GRID1.COLUMN4.CONTROLSOURCE='E16.F01'	   
        	   THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='領用料號'	                  
        	   THISFORM.GRID1.COLUMN5.CONTROLSOURCE='E16.F02'                                      
        	   THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='領用數量'        	   
        	   THISFORM.GRID1.COLUMN6.CONTROLSOURCE='E16.F04'        
        	   THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='完成品號'  	           	   
        	   THISFORM.GRID1.COLUMN7.CONTROLSOURCE='E16.F09'	      
        	   THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='需求客戶'	                   
               THISFORM.GRID1.COLUMN8.CONTROLSOURCE='C01.F05'                                  	        	               	   	   	   
  	           THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='回覆交期'  	           	   
        	   THISFORM.GRID1.COLUMN9.CONTROLSOURCE='E16.F10'
  	           THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='開單未耗'        	   	                   	   
        	   THISFORM.GRID1.COLUMN10.CONTROLSOURCE='E16.F05'
        	   THISFORM.GRID1.COLUMN11.HEADER1.CAPTION='預期結餘'        	   	           
        	   THISFORM.GRID1.COLUMN11.CONTROLSOURCE="ALTT(E16.F02,'1')+MRP_QTY(E16.F02,E16.F03,E16.F01)"       
        	   THISFORM.GRID1.COLUMN12.HEADER1.CAPTION='投入製程'        	   	           
        	   THISFORM.GRID1.COLUMN12.CONTROLSOURCE="IIF(SEEK(E16.F12,'E00'),E00.F04,'')"
        	   THISFORM.GRID1.COLUMN13.HEADER1.CAPTION='備註'  	           	   
        	   THISFORM.GRID1.COLUMN13.CONTROLSOURCE='E16.F11'     	           	           	    	   
               THISFORM.GRID1.COLUMN1.WIDTH=INT_015*55
               THISFORM.GRID1.COLUMN2.WIDTH=INT_015*55               
               THISFORM.GRID1.COLUMN3.WIDTH=INT_015*55 
               THISFORM.GRID1.COLUMN4.WIDTH=INT_015*80
               THISFORM.GRID1.COLUMN5.WIDTH=INT_015*149
               THISFORM.GRID1.COLUMN6.WIDTH=INT_015*70
               THISFORM.GRID1.COLUMN7.WIDTH=INT_015*120
               THISFORM.GRID1.COLUMN8.WIDTH=INT_015*60               
               THISFORM.GRID1.COLUMN9.WIDTH=INT_015*55            
               THISFORM.GRID1.COLUMN10.WIDTH=INT_015*60 
               THISFORM.GRID1.COLUMN11.WIDTH=INT_015*70  
               THISFORM.GRID1.COLUMN12.WIDTH=INT_015*55
               THISFORM.GRID1.COLUMN13.WIDTH=INT_015*150          
       ENDCASE 
       JK=THISFORM.GRID1.COLUMN1.HEADER1.CAPTION
       THISFORM.GRID1.REFRESH
       THISFORM.GRID1.SETFOCUS
  ENDPROC                
  PROC GRID1.AFTERROWCOLCHANGE
       LPARAMETERS NCOLINDEX
       THISFORM.REC_COUNT.CAPTION=TRANSFORM(ALTT(E16.F02,'1'),'@R 9999999999.99')
       THISFORM.GRID1.TOOLTIPTEXT=IIF(EMPTY(E16.F10),IIF(DATE()-CTOD(LEFT(E16.F07,9))>=VAL(INT_205) .AND. DATE()-CTOD(LEFT(E16.F07,9))>=-VAL(INT_205),'超過'+INT_205+'天未回覆交期' ,''),IIF(DATE()-E16.F10>=VAL(INT_206),'超過'+INT_206+'天未出貨 ',IIF(E16.F10>DATE(),'','已到貨2天')))
       THISFORM.TXTF01.VALUE=E16.F10
       THISFORM.TXTF02.VALUE=E16.F11
       THISFORM.LBLF071.CAPTION=E16.F07
       JK=THISFORM.GRID1.COLUMN1.HEADER1.CAPTION
       FCH=THISFORM.ACTIVECONTROL.NAME
       CHK=''
       THISFORM.REFRESH
  ENDPROC  
  PROC INV_BOTT.CLICK
       IF !USED('B1A')
          SELECT 0
          USE B1A
       ELSE
          SELECT B1A
       ENDIF
       SET ORDER TO 1     
	     THISFORM.CMDGROUP.SETALL('FORECOLOR',RGB(128,128,128),'COMMANDBUTTON')
         THISFORM.ORPGROUP.SETALL('FORECOLOR',RGB(128,128,128),'COMMANDBUTTON')
         THISFORM.INSCH.FORECOLOR=RGB(128,128,128)
         
         THISFORM.REPLY_REMARK.FORECOLOR=RGB(128,128,128)
         THISFORM.INV_BOTT.FORECOLOR=RGB(128,128,128)
         SELE B11.F01,B11.F03,A14.F02,B11.F04,B11.F05,B11.F06,B11.F08 FROM B11,A14 WHERE B11.F01<>INT_190 AND B11.F03=E16.F02 AND A14.F01=B11.F01  INTO CURSOR INV ORDER BY B11.F01
         INV_SEEK=CREATEOBJECT("INV_SEEK")  
         INV_SEEK.SHOW                  
         AREA1='E16'
         THISFORM.CMDGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
         THISFORM.ORPGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON') 
         THISFORM.INSCH.FORECOLOR=RGB(0,0,0)   
         
         THISFORM.REPLY_REMARK.FORECOLOR=RGB(0,0,0)
         THISFORM.INV_BOTT.FORECOLOR=RGB(0,0,0)
         THISFORM.GRID1.SETFOCUS
  ENDPROC   

  PROC INSCH.CLICK    &&查看進貨計劃
       LK=E16.F02
       *******************新加進來的
       IF B01.F97 = 'Y'
       	  SELECT E06.*,'E' AS DE_CK FROM E06 WHERE E06.F02=E16.F02 ORDER BY E06.F03 INTO CURSOR INSCH READWRITE
       ELSE
       	  SELE D07.F01,D07.F02,D07.F03,D07.F04,D07.F05,D07.F07,D07.F08,D07.F09,D07.F13,D07.F14,D07.F15,D07.F17,'D' AS DE_CK FROM D07 WHERE D07.F02=E16.F02 ORDER BY D07.F03 INTO CURSOR INSCH READWRITE
       ENDIF
      ******************** 
       
       *SELE D07.F01,D07.F02,D07.F03,D07.F04,D07.F07,D07.F08,D07.F09 FROM D07 WHERE D07.F02=E16.F02 INTO CURSOR INSCH ORDER BY D07.F03 //暫時DISABLE
       IF _TALLY>0
          INSCH_SEEK=CREATEOBJECT("INSCH_SEEK")  
          INSCH_SEEK.SHOW           
       ELSE
          =MESSAGEBOX('此項料品已無採購訂單,請洽採購人員查詢',0+48,'提示訊息視窗')
       ENDIF
       SELE E16
       THISFORM.GRID1.SETFOCUS
  ENDPROC
*********************************查看進出明細
  PROC IODT_BOTT.CLICK
            LK=E16.F02
            LV=E16.F03
            SELE D07.F01,D07.F03,D07.F04,D07.F05,D07.F07,D07.F09 FROM D07 WHERE D07.F02=LK   INTO CURSOR IODT1 ORDER BY D07.F03 NOWAIT&&
            SELE E06.F01,E06.F03,E06.F04,E06.F05,E06.F07,E06.F09 FROM E06 WHERE E06.F02=LK   INTO CURSOR IODT3  ORDER BY E06.F03 NOWAIT&&            
            SELE C05.F01,C05.F03,C05.F04,C05.F06,C05.F09 FROM C05 WHERE C05.F02=LK AND !EMPTY(C05.F15) INTO CURSOR IODT2  ORDER BY C05.F03 NOWAIT&&
            SELE E16.F01,E16.F03,E16.F04,E16.F06,E16.F09 FROM E16 WHERE E16.F02=LK  INTO CURSOR IODT4 ORDER BY E16.F03 NOWAIT&&         
            CREATE CURSOR IODT(F01 C(12),F03 D(8),F04 N(13,3),F08 N(13,3),F05 C(50))
            INDE ON DTOS(F03)+F01 TAG IODT
            SET ORDER TO 1
            SELE IODT1
            GO TOP
            DO WHILE !EOF()
               SELE IODT
               APPEND BLANK
               REPL F01 WITH IODT1.F01
               REPL F03 WITH IODT1.F03
               REPL F04 WITH IODT1.F04
               REPL F05 WITH '採:'+IODT1.F05+PADL(IIF(SEEK(IODT1.F05,'D01'),D01.F04,''),8,' ')+IIF(IODT1.F09='1','  ','><')+IIF(!EMPTY(IODT1.F07),'請:','')+IODT1.F07
               SELE IODT1
               SKIP
            ENDDO   
            USE
            SELE IODT3
            GO TOP
            DO WHILE !EOF()
               SELE IODT
               APPEND BLANK
               REPL F01 WITH IODT3.F01
               REPL F03 WITH IODT3.F03
               REPL F04 WITH IODT3.F04
               REPL F05 WITH '產:'+IODT3.F05+PADL(IIF(SEEK(IODT3.F05,'A14'),A14.F02,''),8,' ')+IIF(IODT3.F09='1','  ','><')+'出:'+IODT3.F07+IIF(SEEK(IODT3.F07,'C01'),C01.F05,'')
               SELE IODT3
               SKIP
            ENDDO   
            USE
            SELE IODT2
            GO TOP
            DO WHILE !EOF()
               SELE IODT
               APPEND BLANK
               REPL F01 WITH IODT2.F01
               REPL F03 WITH IODT2.F03
               REPL F04 WITH IODT2.F04*(-1)
               REPL F05 WITH '出:'+IODT2.F06+IIF(SEEK(IODT2.F06,'C01'),C01.F05,'')+'  單:'+IODT2.F09
               SELE IODT2
               SKIP
            ENDDO   
            USE
            SELE IODT4
            GO TOP
            DO WHILE !EOF()
               SELE IODT
               APPEND BLANK
               REPL F01 WITH IODT4.F01
               REPL F03 WITH IODT4.F03
               REPL F04 WITH IODT4.F04*(-1)
               REPL F05 WITH '領:'+IODT4.F06+IIF(SEEK(IODT4.F06,'A14'),A14.F02,'')+'  成:'+IODT4.F09           
               SELE IODT4
               SKIP
            ENDDO       
            USE                               
                ORD_NO=E16.F01
                STD_NO=E16.F02            
                DTE_NO=E16.F03
               IODT_SEEK=CREATEOBJECT("IODT_SEEK")  
               IODT_SEEK.SHOW           
            AREA1='E16' 
            SELE E16
           THISFORM.GRID1.SETFOCUS    
**********
  
  **********
 PROC REPLY_REMARK.CLICK &&修改回覆交期與備註 
 IF ALLTRIM(C01.F23)=IIF(SEEK(SYS_OPER,'A01'),ALLTRIM(A01.F03),'');
     OR ALLTRIM(C01.F18)=IIF(SEEK(SYS_OPER,'A01'),ALLTRIM(A01.F01),'') OR IIF(A02.F09='*',.T.,.F.)   &&判斷有無修改回覆與備註的權限    
   THISFORM.KEY_LIST.ENABLED=.F.
   THISFORM.GRID1.ENABLED=.F.
   THISFORM.REPLY_REMARK.ENABLED=.F.
   
   THISFORM.YES.ENABLED=.T.
   THISFORM.NO.ENABLED=.T. 
   THISFORM.YES.VISIBLE=.T.
   THISFORM.NO.VISIBLE=.T.
   THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
   THISFORM.ORPGROUP.ESC_BOTT.ENABLED=.F.
   THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
   THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
   THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
   THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
   THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F. 
   THISFORM.LBLF071.CAPTION=''
   THISFORM.INSCH.ENABLED=.F.
   
   THISFORM.SETALL('READONLY',.F.,'TEXTBOX') 
   THISFORM.TXTF01.SETFOCUS
   LOCK()
    IF !RLOCK()
	 DO FILE_IMPACT
	       RETURN
    ENDIF 
 ELSE
    =MESSAGEBOX('您不是此筆訂單之負責人員,無權修改資料!',0+64,'提示視窗')
    THISFORM.GRID1.SETFOCUS
 ENDIF   
 ENDPROC
*********** 
 PROC YES.CLICK &&修改確認
    SELECT E16
*!*	    IF  EMPTY(THISFORM.TXTF01.VALUE)=.F.
*!*		    IF E16.F03>THISFORM.TXTF01.VALUE 
*!*		    	 =MESSAGEBOX('回覆交期不得小於領用日期!',0+64,'提示視窗')
*!*		    	 THISFORM.TXTF01.SETFOCUS
*!*		          RETURN
*!*		    ENDIF
*!*	    ENDIF	          
     IF  RLOCK()
     	  REPLACE F07 WITH DTOC(DATE())+' '+IIF(SEEK(SYS_OPER,'A01'),A01.F03,'')
     	  REPLACE F10 WITH THISFORM.TXTF01.VALUE
     	  REPLACE F11 WITH THISFORM.TXTF02.VALUE
     ELSE 
          DO     FILE_IMPACT
         RETURN
     ENDIF	  
    THISFORM.NO.CLICK
 ENDPROC
 *********
 PROC NO.CLICK &&修改取消
   THISFORM.SETALL('READONLY',.T.,'TEXTBOX') 
   THISFORM.YES.ENABLED=.F.
   THISFORM.NO.ENABLED=.F.
   THISFORM.YES.VISIBLE=.F.
   THISFORM.NO.VISIBLE=.F.
   THISFORM.KEY_LIST.ENABLED=.T.
   THISFORM.GRID1.ENABLED=.T.  
   THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
   THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
   THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
   THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
   THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T. 
   THISFORM.ORPGROUP.ESC_BOTT.ENABLED=.T.
   THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限    
   
  
   THISFORM.REPLY_REMARK.ENABLED=IIF(A02.F05='*',.T.,.F.) &&判斷有無修改回覆交期與備註的權限
   THISFORM.INSCH.ENABLED=.T.&&出貨計劃
   THISFORM.GRID1.SETFOCUS
   THISFORM.REFRESH
 ENDPROC
ENDDEFINE        

***********************************************列印程序
PROCEDURE PNT_PRC  
   FLG='0'
   SELE E16
   ANS_RANGE=CREATEOBJECT("ANS_RANGE")  
   ANS_RANGE.SHOW    
   IF FLG<>'1'
       =MESSAGEBOX('無此範圍資料',0+48,'警示')
   ENDIF   
   FLG='0'     
ENDPROC
***********************************************列印範圍選定
DEFINE CLASS ANS_RANGE AS FORM
  AUTOCENTER=.T.
  CAPTION='請輸入列印資料範圍'
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*190
  WIDTH=INT_015*480
  FONTSIZE=INT_015*9
  CONTROLBOX=.F.
  BORDERSTYLE=2
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WINDOWTYPE=1
  NAME='ANS_RANGE'
  ADD OBJECT LABEL1 AS LABEL WITH;
      AUTOSIZE=.T.,;
      HEIGHT=INT_015*25,;
      LEFT=INT_015*30,;
      TOP=INT_015*75,;
      NAME='LABEL1'
  ADD OBJECT LABEL2 AS LABEL WITH;
      AUTOSIZE=.T.,;
      HEIGHT=INT_015*25,;
      LEFT=INT_015*250,;
      TOP=INT_015*75,;
      NAME='LABEL2'
  ADD OBJECT TEXT1 AS TEXTBOX WITH;
      AUTOSIZE=.T.,;
      TOP=INT_015*70,;
      LEFT=INT_015*80,;
      HEIGHT=INT_015*25,; 
      NAME='TEXT1'
  ADD OBJECT TEXT2 AS TEXTBOX WITH;
      AUTOSIZE=.T.,;
      TOP=INT_015*70,;
      LEFT=INT_015*300,;
      HEIGHT=INT_015*25,;         
      NAME='TEXT2'    
  ADD OBJECT CMND1 AS COMMANDBUTTON WITH;
      AUTOSIZE=.T.,;
      LEFT=INT_015*60,;    
      HEIGHT=INT_015*25,;   
      TOP=INT_015*144,;  
      WIDTH=INT_015*80,;
      CAPTION='\<Y.執行',;
      TOOLTIPTEXT='確認所輸入的範圍鍵值!快速鍵->ALT+Y',;
      NAME='CMND1'
  ADD OBJECT CMND2 AS COMMANDBUTTON WITH;
      AUTOSIZE=.T.,;
      LEFT=INT_015*200,;
      TOP=INT_015*144,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*80,;
      CAPTION='\<C.取消',;
      TOOLTIPTEXT='取消作業!快速鍵->ALT+C',;
      NAME='CMND2'
  PROCEDURE INIT 
      THISFORM.SETALL('FONTSIZE',INT_015*9,'TEXTBOX')
      THISFORM.SETALL('FONTSIZE',INT_015*9,'LABEL')      
      THISFORM.SETALL('FONTSIZE',INT_015*9,'COMMANDBUTTON')            
      DO CASE
         CASE KEY()='F01+DTOS(F03)'    
              THISFORM.LABEL1.CAPTION='起始單號'
              THISFORM.LABEL2.CAPTION='截止單號'
              THISFORM.TEXT1.WIDTH=INT_015*80
              THISFORM.TEXT2.WIDTH=INT_015*80   
              THISFORM.TEXT1.MAXLENGTH=12              
              THISFORM.TEXT2.MAXLENGTH=12                                      
              THISFORM.TEXT1.VALUE=E16.F01
              THISFORM.TEXT2.VALUE=E16.F01              
         CASE KEY()='DTOS(F03)+F01'
              THISFORM.LABEL1.CAPTION='起始日期'
              THISFORM.LABEL2.CAPTION='截止日期'
              THISFORM.TEXT1.WIDTH=INT_015*70
              THISFORM.TEXT2.WIDTH=INT_015*70              
              THISFORM.TEXT1.VALUE=E16.F03
              THISFORM.TEXT2.VALUE=E16.F03               
         CASE KEY()='F06+F09'       
              THISFORM.LABEL1.CAPTION='起始部門'
              THISFORM.LABEL2.CAPTION='截止部門'
              THISFORM.TEXT1.WIDTH=INT_015*60
              THISFORM.TEXT2.WIDTH=INT_015*60   
              THISFORM.TEXT1.MAXLENGTH=5              
              THISFORM.TEXT2.MAXLENGTH=5                                       
              THISFORM.TEXT1.VALUE=E16.F06
              THISFORM.TEXT2.VALUE=E16.F06               
         CASE KEY()='F01+F02+DTOS(F03)'   
              THISFORM.LABEL1.CAPTION='起始單號'
              THISFORM.LABEL2.CAPTION='截止單號'
              THISFORM.TEXT1.WIDTH=INT_015*80
              THISFORM.TEXT2.WIDTH=INT_015*80              
              THISFORM.TEXT1.MAXLENGTH=12           
              THISFORM.TEXT2.MAXLENGTH=12                            
              THISFORM.TEXT1.VALUE=E16.F01
              THISFORM.TEXT2.VALUE=E16.F01                        
         CASE KEY()='F02+DTOS(F03)'             
              THISFORM.LABEL1.CAPTION='起始料號'
              THISFORM.LABEL2.CAPTION='截止料號'
              THISFORM.TEXT1.WIDTH=INT_015*149
              THISFORM.TEXT2.WIDTH=INT_015*149
              THISFORM.TEXT1.MAXLENGTH=43             
              THISFORM.TEXT2.MAXLENGTH=43                            
              THISFORM.TEXT1.VALUE=E16.F02
              THISFORM.TEXT2.VALUE=E16.F02
         CASE KEY()='F06+F02'             
              THISFORM.LABEL1.CAPTION='起始部門'
              THISFORM.LABEL2.CAPTION='截止部門'
              THISFORM.TEXT1.WIDTH=INT_015*60
              THISFORM.TEXT2.WIDTH=INT_015*60
              THISFORM.TEXT1.MAXLENGTH=5             
              THISFORM.TEXT2.MAXLENGTH=5                            
              THISFORM.TEXT1.VALUE=E16.F06
              THISFORM.TEXT2.VALUE=E16.F06                              
         CASE KEY()='F09+F02+DTOS(F03)'   
              THISFORM.LABEL1.CAPTION='起始品號'
              THISFORM.LABEL2.CAPTION='截止品號'
              THISFORM.TEXT1.WIDTH=INT_015*149
              THISFORM.TEXT2.WIDTH=INT_015*149              
              THISFORM.TEXT1.MAXLENGTH=43             
              THISFORM.TEXT2.MAXLENGTH=43                            
              THISFORM.TEXT1.VALUE=E16.F09
              THISFORM.TEXT2.VALUE=E16.F09 
         CASE KEY()='F06+DTOS(F03)'       
              THISFORM.LABEL1.CAPTION='起始部門'
              THISFORM.LABEL2.CAPTION='截止部門'
              THISFORM.TEXT1.WIDTH=INT_015*60
              THISFORM.TEXT2.WIDTH=INT_015*60   
              THISFORM.TEXT1.MAXLENGTH=5              
              THISFORM.TEXT2.MAXLENGTH=5                                       
              THISFORM.TEXT1.VALUE=E16.F06
              THISFORM.TEXT2.VALUE=E16.F06                                                                           
      ENDCASE   
  ENDPROC    
  PROCEDURE CMND1.CLICK 
     FILE_NAME='E16生產領料計畫'
      DO CASE
      CASE KEY()='F01+DTOS(F03)'   
           SELECT E16.F01,;    &&製令編號         
                  E16.F02,;    &&使用料號
                  E16.F03,;    &&領用日期
                  E16.F04,;    &&領用數量 
                  E16.F05,;    &&開單未耗
                  E16.F06,;    &&領用部門編號
                  E16.F09,;    &&完成品號
                  E16.F10,;    &&回覆交期
                  E16.F11,;    &&備註說明
                  E03.F08,;    &&製令表頭編號(帶出客戶名稱用)
                  A14.F02,;    &&領用部門名稱
                  C01.F05,;    &&需求客戶
                  E00.F04;     &&製程名稱 
           FROM E16,E03,A14,C01,E00 WHERE  E03.F03=E16.F01 AND A14.F01=E16.F06 AND C01.F01=E03.F08 AND E00.F01=E16.F12;
           AND  E16.F01>=THISFORM.TEXT1.VALUE AND E16.F01<=THISFORM.TEXT2.VALUE ;
           ORDER BY E16.F01,E16.F03,E16.F02 INTO CURSOR E16A
           IF _TALLY >0              
              SELE E16A 
              REPORT FORM ALLTRIM(INT_116)+'E16A' TO PRINTER PROMPT PREVIEW 
*               REPORT FORM E16A TO PRINT PROMPT        
              SELECT F01 製令編號,F03 領用日期,F02_A  領用料號,F04_A 領用數量,F06 部門編號,F02_B 部門名稱,F09 完成品號,F05_B 需求客戶,F10 回覆交期,F05_A 開單未耗,ALTT(F02_A,'1')+MRP_QTY(F02_A,F03,F01) 預期結餘,F04_B 投入製程,F11 備註說明;
               FROM  E16A  INTO CURSOR CE16A
               COPY TO &FILE_NAME TYPE XL5
              FLG='1'
           ENDIF  
      CASE KEY()='DTOS(F03)+F01'   
           SELECT E16.F01,;    &&製令編號         
                  E16.F02,;    &&使用料號
                  E16.F03,;    &&領用日期
                  E16.F04,;    &&領用數量 
                  E16.F05,;    &&開單未耗
                  E16.F06,;    &&領用部門編號
                  E16.F09,;    &&完成品號
                  E16.F10,;    &&回覆交期
                  E16.F11,;    &&備註說明
                  E03.F08,;    &&製令表頭編號(帶出客戶名稱用)
                  A14.F02,;    &&領用部門名稱
                  C01.F05,;     &&需求客戶
                  E00.F04;     &&製程名稱
           FROM E16,E03,A14,C01,E00 WHERE  E03.F03=E16.F01 AND A14.F01=E16.F06 AND C01.F01=E03.F08 AND E00.F01=E16.F12;
           AND  E16.F03>=THISFORM.TEXT1.VALUE AND E16.F03<=THISFORM.TEXT2.VALUE ;
           ORDER BY E16.F03,E16.F01,E16.F02 INTO CURSOR E16B
           IF _TALLY >0
              REPORT FORM ALLTRIM(INT_116)+'E16B' TO PRINTER PROMPT PREVIEW
*               REPORT FORM E16B TO PRINT PROMPT   
              SELECT F03 領用日期,F01 製令編號,F02_A  領用料號,F04_A 領用數量,F06 部門編號,F02_B 部門名稱,F09 完成品號,F05_B 需求客戶,F10 回覆交期,F05_A 開單未耗,ALTT(F02_A,'1')+MRP_QTY(F02_A,F03,F01) 預期結餘,F04_B 投入製程,F11 備註說明;
              FROM  E16B  INTO CURSOR CE16B
              COPY TO &FILE_NAME TYPE XL5     
              FLG='1'
           ENDIF             
      CASE KEY()='F06+F09'   
           SELECT E16.F01,;    &&製令編號         
                  E16.F02,;    &&使用料號
                  E16.F03,;    &&領用日期
                  E16.F04,;    &&領用數量 
                  E16.F05,;    &&開單未耗
                  E16.F06,;    &&領用部門編號
                  E16.F09,;    &&完成品號
                  E16.F10,;    &&回覆交期
                  E16.F11,;    &&備註說明
                  E03.F08,;    &&製令表頭編號(帶出客戶名稱用)
                  A14.F02,;    &&領用部門名稱
                  C01.F05,;     &&需求客戶
                  E00.F04;     &&製程名稱
           FROM E16,E03,A14,C01,E00 WHERE  E03.F03=E16.F01 AND A14.F01=E16.F06 AND C01.F01=E03.F08 AND E00.F01=E16.F12;
           AND  E16.F06>=THISFORM.TEXT1.VALUE AND E16.F06<=THISFORM.TEXT2.VALUE ;
           ORDER BY E16.F06,E16.F09 INTO CURSOR E16C
             IF _TALLY >0
              REPORT FORM ALLTRIM(INT_116)+'E16C' TO PRINTER PROMPT PREVIEW
*              REPORT FORM E16C TO PRINT PROMPT 
              SELECT F06 部門編號,F02_B 部門名稱,F09 完成品號,F05_B 需求客戶,F01 製令編號,F02_A  領用料號,F03 領用日期,F04_A 領用數量,F10 回覆交期,F05_A 開單未耗,ALTT(F02_A,'1')+MRP_QTY(F02_A,F03,F01) 預期結餘,F04_B 投入製程,F11 備註說明;
              FROM  E16C  INTO CURSOR CE16C
              COPY TO &FILE_NAME TYPE XL5  
              FLG='1'
           ENDIF                  
      CASE KEY()='F01+F02+DTOS(F03)'   
           SELECT E16.F01,;    &&製令編號         
                  E16.F02,;    &&使用料號
                  E16.F03,;    &&領用日期
                  E16.F04,;    &&領用數量 
                  E16.F05,;    &&開單未耗
                  E16.F06,;    &&領用部門編號
                  E16.F09,;    &&完成品號
                  E16.F10,;    &&回覆交期
                  E16.F11,;    &&備註說明
                  E03.F08,;    &&製令表頭編號(帶出客戶名稱用)
                  A14.F02,;    &&領用部門名稱
                  C01.F05,;     &&需求客戶
                  E00.F04;     &&製程名稱
           FROM E16,E03,A14,C01,E00 WHERE  E03.F03=E16.F01 AND A14.F01=E16.F06 AND C01.F01=E03.F08 AND E00.F01=E16.F12;
           AND  E16.F01>=THISFORM.TEXT1.VALUE AND E16.F01<=THISFORM.TEXT2.VALUE ;
           ORDER BY E16.F01,E16.F02,E16.F03 INTO CURSOR E16D
           IF _TALLY >0
              REPORT FORM ALLTRIM(INT_116)+'E16D' TO PRINTER PROMPT PREVIEW
*              REPORT FORM E16D TO PRINT PROMPT 
              SELECT F01 製令編號,F02_A  領用料號,F03 領用日期,F04_A 領用數量,F06 部門編號,F02_B 部門名稱,F09 完成品號,F05_B 需求客戶,F10 回覆交期,F05_A 開單未耗,ALTT(F02_A,'1')+MRP_QTY(F02_A,F03,F01) 預期結餘,F04_B 投入製程,F11 備註說明;
              FROM  E16D  INTO CURSOR CE16D
              COPY TO &FILE_NAME TYPE XL5         
              FLG='1'
           ENDIF                       
      CASE KEY()='F02+DTOS(F03)'   
           SELECT E16.F01,;    &&製令編號         
                  E16.F02,;    &&使用料號
                  E16.F03,;    &&領用日期
                  E16.F04,;    &&領用數量 
                  E16.F05,;    &&開單未耗
                  E16.F06,;    &&領用部門編號
                  E16.F09,;    &&完成品號
                  E16.F10,;    &&回覆交期
                  E16.F11,;    &&備註說明
                  E03.F08,;    &&製令表頭編號(帶出客戶名稱用)
                  A14.F02,;    &&領用部門名稱
                  C01.F05,;     &&需求客戶
                  E00.F04;     &&製程名稱
           FROM E16,E03,A14,C01,E00 WHERE  E03.F03=E16.F01 AND A14.F01=E16.F06 AND C01.F01=E03.F08 AND E00.F01=E16.F12;
           AND  E16.F02>=THISFORM.TEXT1.VALUE AND E16.F02<=THISFORM.TEXT2.VALUE ;
           ORDER BY E16.F02,E16.F03 INTO CURSOR E16E
           IF _TALLY >0
              REPORT FORM ALLTRIM(INT_116)+'E16E' TO PRINTER PROMPT PREVIEW
*             REPORT FORM E16E TO PRINT PROMPT   
              SELECT F02_A  領用料號,F03 領用日期,F04_A 領用數量,F01 製令編號,F06 部門編號,F02_B 部門名稱,F09 完成品號,F05_B 需求客戶,F10 回覆交期,F05_A 開單未耗,ALTT(F02_A,'1')+MRP_QTY(F02_A,F03,F01) 預期結餘,F04_B 投入製程,F11 備註說明;
              FROM  E16E  INTO CURSOR CE16E
              COPY TO &FILE_NAME TYPE XL5      
              FLG='1'
           ENDIF                   
      CASE KEY()='F06+F02'   
           SELECT E16.F01,;    &&製令編號         
                  E16.F02,;    &&使用料號
                  E16.F03,;    &&領用日期
                  E16.F04,;    &&領用數量 
                  E16.F05,;    &&開單未耗
                  E16.F06,;    &&領用部門編號
                  E16.F09,;    &&完成品號
                  E16.F10,;    &&回覆交期
                  E16.F11,;    &&備註說明
                  E03.F08,;    &&製令表頭編號(帶出客戶名稱用)
                  A14.F02,;    &&領用部門名稱
                  C01.F05,;     &&需求客戶
                  E00.F04;     &&製程名稱
           FROM E16,E03,A14,C01,E00 WHERE  E03.F03=E16.F01 AND A14.F01=E16.F06 AND C01.F01=E03.F08 AND E00.F01=E16.F12;
           AND  E16.F06>=THISFORM.TEXT1.VALUE AND E16.F06<=THISFORM.TEXT2.VALUE ;
           ORDER BY E16.F06,E16.F02 INTO CURSOR E16F
           IF _TALLY >0
              REPORT FORM ALLTRIM(INT_116)+'E16F' TO PRINTER PROMPT PREVIEW
*             REPORT FORM E16E TO PRINT PROMPT   
              SELECT F06 部門編號,F02_B 部門名稱,F02_A  領用料號,F03 領用日期,F04_A 領用數量,F01 製令編號,F09 完成品號,F05_B 需求客戶,F10 回覆交期,F05_A 開單未耗,ALTT(F02_A,'1')+MRP_QTY(F02_A,F03,F01) 預期結餘,F04_B 投入製程,F11 備註說明;
              FROM  E16F  INTO CURSOR CE16F
              COPY TO &FILE_NAME TYPE XL5      
              FLG='1'
           ENDIF                              
      CASE KEY()='F09+F02+DTOS(F03)'   
           SELECT E16.F01,;    &&製令編號         
                  E16.F02,;    &&使用料號
                  E16.F03,;    &&領用日期
                  E16.F04,;    &&領用數量 
                  E16.F05,;    &&開單未耗
                  E16.F06,;    &&領用部門編號
                  E16.F09,;    &&完成品號
                  E16.F10,;    &&回覆交期
                  E16.F11,;    &&備註說明
                  E03.F08,;    &&製令表頭編號(帶出客戶名稱用)
                  A14.F02,;    &&領用部門名稱
                  C01.F05,;     &&需求客戶
                  E00.F04;     &&製程名稱
           FROM E16,E03,A14,C01,E00 WHERE  E03.F03=E16.F01 AND A14.F01=E16.F06 AND C01.F01=E03.F08 AND E00.F01=E16.F12;
           AND  E16.F09>=THISFORM.TEXT1.VALUE AND E16.F09<=THISFORM.TEXT2.VALUE ;
           ORDER BY E16.F09,E16.F02,E16.F03 INTO CURSOR E16G
           IF _TALLY >0
              REPORT FORM ALLTRIM(INT_116)+'E16G' TO PRINTER PROMPT PREVIEW
*              REPORT FORM E16D TO PRINT PROMPT  
              SELECT F09 完成品號,F02_A  領用料號,F03 領用日期,F04_A 領用數量,F01 製令編號,F05_B 需求客戶,F06 部門編號,F02_B 部門名稱,F10 回覆交期,F05_A 開單未耗,ALTT(F02_A,'1')+MRP_QTY(F02_A,F03,F01) 預期結餘,F04_B 投入製程,F11 備註說明;
              FROM  E16G  INTO CURSOR CE16G
              COPY TO &FILE_NAME TYPE XL5        
              FLG='1'
           ENDIF 
   CASE KEY()='F06+DTOS(F03)'        
           SELECT E16.F01,;    &&製令編號         
                  E16.F02,;    &&使用料號
                  E16.F03,;    &&領用日期
                  E16.F04,;    &&領用數量 
                  E16.F05,;    &&開單未耗
                  E16.F06,;    &&領用部門編號
                  E16.F09,;    &&完成品號
                  E16.F10,;    &&回覆交期
                  E16.F11,;    &&備註說明
                  E03.F08,;    &&製令表頭編號(帶出客戶名稱用)
                  A14.F02,;    &&領用部門名稱
                  C01.F05,;     &&需求客戶
                  E00.F04;     &&製程名稱
           FROM E16,E03,A14,C01,E00 WHERE  E03.F03=E16.F01 AND A14.F01=E16.F06 AND C01.F01=E03.F08 AND E00.F01=E16.F12;
           AND  E16.F06>=THISFORM.TEXT1.VALUE AND E16.F06<=THISFORM.TEXT2.VALUE ;
           ORDER BY E16.F06,E16.F03,E16.F01,E16.F02 INTO CURSOR E16H
           IF _TALLY >0
              REPORT FORM ALLTRIM(INT_116)+'E16H' TO PRINTER PROMPT PREVIEW
*              REPORT FORM E16C TO PRINT PROMPT  
              SELECT F06 部門編號,F02_B 部門名稱,F03 領用日期,F01 製令編號,F02_A  領用料號,F04_A 領用數量,F09 完成品號,F05_B 需求客戶,F10 回覆交期,F05_A 開單未耗,ALTT(F02_A,'1')+MRP_QTY(F02_A,F03,F01) 預期結餘,F04_B 投入製程,F11 備註說明;
              FROM  E16H  INTO CURSOR CE16H
              COPY TO &FILE_NAME TYPE XL5        
              FLG='1'
           ENDIF             
                                                                   
       ENDCASE 
       THISFORM.RELEASE                         
  ENDPROC
  PROCEDURE CMND2.CLICK
      FLG='1'   
      THISFORM.RELEASE
  ENDPROC      
ENDDEFINE   

***************************************進貨計劃
*!*	DEFINE CLASS INSCH_SEEK AS FORM
*!*	  AUTOCENTER=.T.
*!*	  FONTSIZE=INT_015*9
*!*	  HEIGHT=INT_015*320
*!*	  WIDTH=INT_015*700
*!*	  FONTSIZE=INT_015*9
*!*	  CONTROLBOX=.F.
*!*	  BORDERSTYLE=2
*!*	  SHOWTIPS=.T.
*!*	  SHOWWINDOW=1
*!*	  WINDOWTYPE=1
*!*	  NAME='INSCH_SEEK'
*!*	  ADD OBJECT CMDGROUP AS CMDGROUP WITH;      
*!*	      TOP=INT_015*290,;
*!*	      LEFT=INT_015*210
*!*	  ADD OBJECT GRID1 AS GRID WITH;        
*!*	      HIGHLIGHTROWLINEWIDTH=4,;     
*!*	      AUTOCENTER=.T.,;
*!*	      WIDTH=INT_015*700,;      
*!*	      HEIGHT=INT_015*293,;     
*!*	      ROWHEIGHT=INT_015*18,;
*!*	      HEADERHEIGHT=INT_015*19,; 
*!*	      DELETEMARK=.F.,;
*!*	      READONLY=.T.,;
*!*	      RECORDSOURCETYPE=1,;
*!*	      COLUMNCOUNT=7,;            
*!*	      NAME='GRID1',;
*!*	      COLUMN1.NAME='COLUMN1',;
*!*	      COLUMN2.NAME='COLUMN2',;      
*!*	      COLUMN3.NAME='COLUMN3',; 
*!*	      COLUMN4.NAME='COLUMN4',;      
*!*	      COLUMN5.NAME='COLUMN5',;
*!*	      COLUMN6.NAME='COLUMN6',;  
*!*	      COLUMN7.NAME='COLUMN7'            
*!*	  ADD OBJECT CMND2 AS COMMANDBUTTON WITH;
*!*	      LEFT=INT_015*425,;
*!*	      TOP=INT_015*295,;
*!*	      HEIGHT=INT_015*25,;
*!*	      WIDTH=INT_015*40,;
*!*	      FONTSIZE=INT_015*9,;
*!*	      CAPTION='\<X.離開',;
*!*	      TOOLTIPTEXT='取消此作業畫面!快速鍵->ALT+C'
*!*	      NAME='CMND2'
*!*	      PROCEDURE INIT 
*!*	         THISFORM.CAPTION='進貨計劃'+'---->'+E16.F02+SPACE(5)+B01.F02      
*!*	         AREA1='INSCH'  
*!*	         SELE INSCH
*!*	         THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'COLUMN')
*!*	         THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'HEADER')
*!*	         THISFORM.GRID1.READONLY=.T. 
*!*	         THISFORM.GRID1.RECORDSOURCE='INSCH'
*!*	         THISFORM.CMDGROUP.SEEK_BOTT.VISIBLE=.F.         
*!*	         THISFORM.SETALL('READONLY',.T.,'TEXTBOX')
*!*	*!*	         THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(DATE()-CTOD(LEFT(INSCH.F08,8))<=5,RGB(0,255,255),IIF(INSCH.F03<DATE(),RGB(255,0,0),''))","COLUMN")
*!*	         THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(DATE()-CTOD(LEFT(INSCH.F08,9))<=5 AND INSCH.F09='1',RGB(0,255,255),IIF(INSCH.F09<>'1',RGB(255,255,0),IIF(INSCH.F03<DATE() AND INSCH.F09='1',RGB(255,0,0),'')))","COLUMN")
*!*	         THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='訂單號碼'
*!*	         THISFORM.GRID1.COLUMN1.CONTROLSOURCE='INSCH.F01'
*!*	         THISFORM.GRID1.COLUMN1.WIDTH=INT_015*83
*!*	         THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='進貨日期'
*!*	         THISFORM.GRID1.COLUMN2.WIDTH=INT_015*60
*!*	         THISFORM.GRID1.COLUMN2.CONTROLSOURCE='INSCH.F03'         
*!*	         THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='進貨數量'
*!*	         THISFORM.GRID1.COLUMN3.CONTROLSOURCE='INSCH.F04'
*!*	         THISFORM.GRID1.COLUMN3.WIDTH=INT_015*90
*!*	         THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='採購用途'         
*!*	         THISFORM.GRID1.COLUMN4.CONTROLSOURCE='INSCH.F07'
*!*	         THISFORM.GRID1.COLUMN4.WIDTH=INT_015*149
*!*	         THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='運貨方式'         
*!*	         THISFORM.GRID1.COLUMN5.CONTROLSOURCE="IIF(SEEK(INSCH.F01,'D03'),D03.F13,IIF(SEEK(INSCH.F01+INSCH.F02,'P04'),P04.F23,''))" 
*!*	         THISFORM.GRID1.COLUMN5.WIDTH=INT_015*50    
*!*	         THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='客戶PO/NO'         
*!*	         THISFORM.GRID1.COLUMN6.CONTROLSOURCE="IIF(SEEK(LEFT(ALLTRIM(INSCH.F07),10),'P05'),IIF(SEEK(P05.F06,'C03'),C03.F14,''),'')"
*!*	         THISFORM.GRID1.COLUMN6.WIDTH=INT_015*120
*!*	         THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='安全資料'         
*!*	         THISFORM.GRID1.COLUMN7.CONTROLSOURCE='INSCH.F08'
*!*	         THISFORM.GRID1.COLUMN7.WIDTH=INT_015*120                        
*!*	         THISFORM.GRID1.SETFOCUS 
*!*	      ENDPROC 
*!*	      PROC GRID1.AFTERROWCOLCHANGE
*!*	           LPARAMETERS XCOLINDEX
*!*	           THISFORM.GRID1.TOOLTIPTEXT=IIF(DATE()-CTOD(LEFT(INSCH.F08,9))<=5 AND INSCH.F09='1','剛回覆交期',IIF(INSCH.F09<>'1','超過10天未回覆交期',IIF(INSCH.F03<DATE() AND INSCH.F09='1','應到貨而未到貨','')))
*!*	      ENDPROC 
*!*	      PROCEDURE CMND2.CLICK
*!*	          SELE INSCH
*!*	          USE
*!*	          AREA1='E16'
*!*	         THISFORM.RELEASE
*!*	      ENDPROC    
*!*	ENDDEFINE   
***************
*****************************
***************************************進貨計劃/生產計劃 
DEFINE CLASS INSCH_SEEK AS FORM
*!*	  AUTOCENTER=.T.
  FONTSIZE=INT_015*9
  TOP=INT_015*110
  LEFT=INT_015*10    
  HEIGHT=INT_015*320
  WIDTH=INT_015*770
  FONTSIZE=INT_015*9
  MOVABLE=.T.
  MAXBUTTON=.F.
  MINBUTTON=.F.      
  CONTROLBOX=.F.
  BORDERSTYLE=2
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WINDOWTYPE=1
  NAME='INSCH_SEEK'
  ADD OBJECT CMDGROUP AS CMDGROUP WITH;      
      TOP=INT_015*290,;
      LEFT=INT_015*210
  ADD OBJECT GRID1 AS GRID WITH;       
      HIGHLIGHTROWLINEWIDTH=4,; 
      AUTOCENTER=.T.,;
      WIDTH=INT_015*770,;      
      HEIGHT=INT_015*293,;     
      ROWHEIGHT=INT_015*18,;
      HEADERHEIGHT=INT_015*19,; 
      DELETEMARK=.F.,;
      READONLY=.T.,;
      RECORDSOURCETYPE=1,;
      COLUMNCOUNT=8,;            
      NAME='GRID1',;
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;      
      COLUMN3.NAME='COLUMN3',; 
      COLUMN4.NAME='COLUMN4',;      
      COLUMN5.NAME='COLUMN5',;
      COLUMN6.NAME='COLUMN6',; 
      COLUMN7.NAME='COLUMN7',;  
      COLUMN8.NAME='COLUMN8'            
  ADD OBJECT CMND1 AS COMMANDBUTTON WITH;
      LEFT=INT_015*425,;
      TOP=INT_015*295,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\harrow.CUR',;
      CAPTION='\<X.離開',;
      TOOLTIPTEXT='取消此作業畫面!快速鍵->ALT+X'
      NAME='CMND1'
  ADD OBJECT CMND2 AS COMMANDBUTTON WITH;
      LEFT=INT_015*383,;
      TOP=INT_015*295,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\harrow.CUR',;
      CAPTION='\<C.異動',;
      TOOLTIPTEXT='取消此作業畫面!快速鍵->ALT+X'
      NAME='CMND2'      
      PROCEDURE INIT    
         AREA1='INSCH'  
         SELE INSCH
         THISFORM.GRID1.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)
         THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'COLUMN')
         THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'HEADER')
         THISFORM.GRID1.READONLY=.T. 
         THISFORM.GRID1.RECORDSOURCE='INSCH'
         THISFORM.CMDGROUP.SEEK_BOTT.VISIBLE=.F.     
         THISFORM.CMND2.ENABLED=CHA
         THISFORM.SETALL('READONLY',.T.,'TEXTBOX')
         THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(DATE()-CTOD(LEFT(INSCH.F08,9))<=5 AND INSCH.F09='1',RGB(0,255,255),IIF(INSCH.F09<>'1',RGB(255,255,0),IIF(INSCH.F03<DATE() AND INSCH.F09='1',RGB(255,0,0),'')))","COLUMN")
         IF INSCH.DE_CK = 'D'
	         THISFORM.CAPTION='D08.進貨計劃'+'---->'+E16.F02+SPACE(5)+B01.F02 
	         THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='訂單號碼'
	         THISFORM.GRID1.COLUMN1.CONTROLSOURCE='INSCH.F01'
	         THISFORM.GRID1.COLUMN1.WIDTH=INT_015*75
	         THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='進貨日期'
	         THISFORM.GRID1.COLUMN2.WIDTH=INT_015*60
	         THISFORM.GRID1.COLUMN2.CONTROLSOURCE='INSCH.F03'         
	         THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='進貨數量'
	         THISFORM.GRID1.COLUMN3.CONTROLSOURCE='INSCH.F04'
	         THISFORM.GRID1.COLUMN3.WIDTH=INT_015*70
	         THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='採購用途'         
	         THISFORM.GRID1.COLUMN4.CONTROLSOURCE='INSCH.F07'
	         THISFORM.GRID1.COLUMN4.WIDTH=INT_015*130
	         THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='運貨方式'         
	         THISFORM.GRID1.COLUMN5.CONTROLSOURCE="INSCH.F13 + IIF(EMPTY(INSCH.F17),'','(' + ALLTRIM(INSCH.F17) + ')')"
	         THISFORM.GRID1.COLUMN5.WIDTH=INT_015*90    
	         IF A02.F12='*'
	            THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='採購單價'         
	            THISFORM.GRID1.COLUMN6.CONTROLSOURCE="TRANSFORM(IIF(SEEK(INSCH.F01+E16.F02,'P04'),P04.F05*IIF(SEEK(P04.F04,'D00'),D00.F02,1),0),'@R 99999.999999')"
	            THISFORM.GRID1.COLUMN6.WIDTH=INT_015*80	         
	         ELSE
	            THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='客戶PO/NO'         
	            THISFORM.GRID1.COLUMN6.CONTROLSOURCE="IIF(SEEK(LEFT(ALLTRIM(INSCH.F07),10),'P05'),IIF(SEEK(P05.F06,'C03'),C03.F14,''),'')"
	            THISFORM.GRID1.COLUMN6.WIDTH=INT_015*130
	         ENDIF   
	         THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='異動狀態與日期'         
	         THISFORM.GRID1.COLUMN7.CONTROLSOURCE="ICASE(INSCH.F14 = '1','提前中 / ',INSCH.F14 = '2','延後中 / ',INSCH.F14 = '3','取消中 / ',INSCH.F14 = '4','異動資料已回覆','') + IIF(EMPTY(INSCH.F15),'',IIF(INT_012=2,DATE(),ALLTRIM(STR(VAL(LEFT(DTOS(DATE()),4))-1911))+RIGHT(DTOC(DATE()),6)))"
	         THISFORM.GRID1.COLUMN7.WIDTH=INT_015*105 
	         THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='安全資料'         
	         THISFORM.GRID1.COLUMN8.CONTROLSOURCE='INSCH.F08'
	         THISFORM.GRID1.COLUMN8.WIDTH=INT_015*120 
	         THISFORM.CMND2.VISIBLE=.T.
	     ELSE
	         THISFORM.CAPTION='E06.生產計劃'+'---->'+E16.F02+SPACE(5)+B01.F02 
	         THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='母製令號碼'
	         THISFORM.GRID1.COLUMN1.CONTROLSOURCE='INSCH.F01'
	         THISFORM.GRID1.COLUMN1.WIDTH=INT_015*100
	         THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='完工日期 '
	         THISFORM.GRID1.COLUMN2.WIDTH=INT_015*70
	         THISFORM.GRID1.COLUMN2.CONTROLSOURCE='INSCH.F03'         
	         THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='預計產出 '
	         THISFORM.GRID1.COLUMN3.CONTROLSOURCE='INSCH.F04'
	         THISFORM.GRID1.COLUMN3.WIDTH=INT_015*80
	         THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='加工部門'         
	         THISFORM.GRID1.COLUMN4.CONTROLSOURCE="IIF(SEEK(INSCH.F05,'A14'),A14.F02,INSCH.F05)"
	         THISFORM.GRID1.COLUMN4.WIDTH=INT_015*60
	         THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='已完成量'         
	         THISFORM.GRID1.COLUMN5.CONTROLSOURCE='INSCH.F04'
	         THISFORM.GRID1.COLUMN5.WIDTH=INT_015*80    
	         THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='客戶名稱'          
	         THISFORM.GRID1.COLUMN6.CONTROLSOURCE="IIF(SEEK(INSCH.F07,'C01'),C01.F04,INSCH.F07)"
	         THISFORM.GRID1.COLUMN6.WIDTH=INT_015*180
	         THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='安全資料'      
			 THISFORM.GRID1.COLUMN7.CONTROLSOURCE='INSCH.F08'
	         THISFORM.GRID1.COLUMN7.WIDTH=INT_015*120
	         THISFORM.GRID1.COLUMN8.HEADER1.CAPTION=''         
	         THISFORM.GRID1.COLUMN8.CONTROLSOURCE=''
	         THISFORM.GRID1.COLUMN8.WIDTH=INT_015*50  
	         THISFORM.CMND2.VISIBLE=.F.                         
	     ENDIF                           
         THISFORM.GRID1.SETFOCUS 
      ENDPROC 
      PROC GRID1.AFTERROWCOLCHANGE
           LPARAMETERS XCOLINDEX
           THISFORM.GRID1.TOOLTIPTEXT=IIF(DATE()-CTOD(LEFT(INSCH.F08,9))<=5 AND INSCH.F09='1','剛回覆交期',IIF(INSCH.F09<>'1','超過10天未回覆交期',IIF(INSCH.F03<DATE() AND INSCH.F09='1','應到貨而未到貨','')))
           THISFORM.CMND2.ENABLED = CHA AND INSCH.DE_CK = 'D'
      ENDPROC 
      PROCEDURE CMND1.CLICK
          SELE INSCH
          USE
          AREA1='E16'
         THISFORM.RELEASE
      ENDPROC  
 PROCEDURE CMND2.CLICK
 	  SELECT A02
 	  SEEK SYS_OPER+'C66'
      SELECT IIF(C66.F01 = 0,1,0) AS EXP_1,C66.*,ICASE(F08 = 'A','海運    ',F08 = 'B','海運提前',F08 = 'C','空運    ',F08 = 'D','空運提前',F08 = 'E','快遞    ',F08 = 'F','快遞提前',F08 = 'G','海運延後',F08 = 'H','空運延後',F08 = 'J','快遞延後',SPACE(8)) AS F088;
      FROM C66 WHERE C66.F04 = INSCH.F02 AND C66.F12 = INSCH.F01 AND C66.F11 = IIF(SEEK(LEFT(ALLTRIM(INSCH.F07),10),'P05'),P05.F04,E16.F06)  ORDER BY C66.F03 INTO CURSOR C66_TEMP READWRITE
      SELECT C66_TEMP
      GO TOP
      CH_SEEK=CREATEOBJECT("CH_SEEK")  
      CH_SEEK.SHOW     
 	  SELECT A02
 	  SEEK SYS_OPER+'E16'     
      AREA1='INSCH'
      SELECT INSCH
      THISFORM.GRID1.SETFOCUS 
   ENDPROC            
ENDDEFINE       
**************************************異動 
DEFINE CLASS CH_SEEK AS FORM
  AUTOCENTER=.T.
  FONTSIZE=INT_015*9 
  TOP=INT_015*110
  LEFT=INT_015*40    
  HEIGHT=INT_015*350
  WIDTH=INT_015*550
  FONTSIZE=INT_015*9
  MOVABLE=.T.
  MAXBUTTON=.F.
  MINBUTTON=.F.      
  CONTROLBOX=.F.
  BORDERSTYLE=2
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WINDOWTYPE=1
  NAME='CH_SEEK'      
  ADD OBJECT GRID1 AS GRID WITH;        
      LEFT=INT_015*10,;
      TOP=INT_015*165,;
      WIDTH=INT_015*540,;      
      HEIGHT=INT_015*150,;      
      ROWHEIGHT=INT_015*18,;
      HEADERHEIGHT=INT_015*19,;  
      RECORDSOURCE='C66_TEMP',;    
      DELETEMARK=.F.,;
      READONLY=.T.,;
      RECORDSOURCETYPE=1,;
      ALLOWCELLSELECTION=.T.,;
      HIGHLIGHTROWLINEWIDTH=4,;
      ALLOWROWSIZING=.F.,;
      COLUMNCOUNT=9,;            
      NAME='GRID1',;
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;      
      COLUMN3.NAME='COLUMN3',; 
      COLUMN4.NAME='COLUMN4',;
      COLUMN5.NAME='COLUMN5',;      
      COLUMN6.NAME='COLUMN6',;
      COLUMN7.NAME='COLUMN7',;
      COLUMN8.NAME='COLUMN8',;
      COLUMN9.NAME='COLUMN9'    
  ADD OBJECT KEY_LIST AS KEY_LIST WITH;
      AUTOCENTER=.T.
  ADD OBJECT CMDGROUP AS CMDGROUP WITH;
      AUTOSIZE=.T.  
  ADD OBJECT LBLF03 AS LABEL WITH;
      TOP=INT_015*10,;
      LEFT=INT_015*10,;
      HEIGHT=INT_015*17,;      
      WIDTH=INT_015*60,;
      CAPTION='異動日期'            
  ADD OBJECT TXTF03 AS TEXTBOX WITH;
      TOP=INT_015*5,;
      LEFT=INT_015*65,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*80,;
      MAXLENGTH=8   
  ADD OBJECT LBLF08 AS LABEL WITH;
      TOP=INT_015*10,;
      LEFT=INT_015*390,;
      HEIGHT=INT_015*17,;      
      WIDTH=INT_015*60,;
      CAPTION='運貨方式'   
 ADD OBJECT COMBOBOX08 AS COMBOBOX WITH;      
      TOP=INT_015*5,;
      LEFT=INT_015*445,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*80,;
      STYLE=2,;
      FONTSIZE=INT_015*9   
  ADD OBJECT TXTF08 AS TEXTBOX WITH;
      TOP=INT_015*5,;
      LEFT=INT_015*445,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*80,; 
      MAXLENGTH=10       
  ADD OBJECT LBLF02 AS LABEL WITH;
      TOP=INT_015*36,;
      LEFT=INT_015*10,;
      HEIGHT=INT_015*17,;      
      WIDTH=INT_015*60,;
      CAPTION='異動類別'      
 ADD OBJECT COMBOBOX02 AS COMBOBOX WITH;      
      TOP=INT_015*31,;
      LEFT=INT_015*65,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*80,;
      STYLE=2,;
      FONTSIZE=INT_015*9    
  ADD OBJECT TXTF02 AS TEXTBOX WITH;
      TOP=INT_015*31,;
      LEFT=INT_015*65,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*80              
  ADD OBJECT LBLF10 AS LABEL WITH;
      TOP=INT_015*36,;
      LEFT=INT_015*390,;
      HEIGHT=INT_015*17,;      
      WIDTH=INT_015*60,;
       CAPTION='運費對象'    
 ADD OBJECT COMBOBOX10 AS COMBOBOX WITH;      
      TOP=INT_015*31,;
      LEFT=INT_015*445,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*80,;
      STYLE=2,;
      FONTSIZE=INT_015*9         
  ADD OBJECT TXTF10 AS TEXTBOX WITH;
      TOP=INT_015*31,;
      LEFT=INT_015*445,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*80,; 
      MAXLENGTH=10  
  ADD OBJECT LBLF06 AS LABEL WITH;
      TOP=INT_015*62,;
      LEFT=INT_015*10,;
      HEIGHT=INT_015*17,;      
      WIDTH=INT_015*60,;
       CAPTION='原訂交期'            
  ADD OBJECT TXTF06 AS TEXTBOX WITH;
      TOP=INT_015*57,;
      LEFT=INT_015*65,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*80,;
      MAXLENGTH=8
  ADD OBJECT LBLF05 AS LABEL WITH;
      TOP=INT_015*62,;
      LEFT=INT_015*390,;
      HEIGHT=INT_015*17,;      
      WIDTH=INT_015*60,;
      CAPTION='異動數量'            
  ADD OBJECT TXTF05 AS TEXTBOX WITH;
      TOP=INT_015*57,;
      LEFT=INT_015*445,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*80,;
      MAXLENGTH=13      
  ADD OBJECT LBLF07 AS LABEL WITH;
      TOP=INT_015*88,;
      LEFT=INT_015*10,;
      HEIGHT=INT_015*17,;      
      WIDTH=INT_015*60,;
      CAPTION='希望交期'            
  ADD OBJECT TXTF07 AS TEXTBOX WITH;
      TOP=INT_015*83,;
      LEFT=INT_015*65,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*80,;
      MAXLENGTH=8                
  ADD OBJECT LBLF14 AS LABEL WITH;
      TOP=INT_015*114,;
      LEFT=INT_015*10,;
      HEIGHT=INT_015*17,;      
      WIDTH=INT_015*60,;
      CAPTION='備註說明'            
  ADD OBJECT TXTF14 AS TEXTBOX WITH;
      TOP=INT_015*109,;
      LEFT=INT_015*65,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*460,;
      MAXLENGTH=80     
  ADD OBJECT LBLF99 AS LABEL WITH;
      TOP=INT_015*140,;
      LEFT=INT_015*10,;
      HEIGHT=INT_015*17,;      
      AUTOSIZE=.T.,;
      CAPTION=''     
  ADD OBJECT ORPGROUP AS ORPGROUP WITH;    
      TOP=INT_015*316,;
      LEFT=INT_015*70
  ADD OBJECT SHRGROUP AS SHRGROUP WITH;
      TOP=INT_015*316,;
      LEFT=INT_015*370    
  ADD OBJECT PNT_BT AS COMMANDBUTTON WITH;
      LEFT=INT_015*200,;
      TOP=INT_015*321,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\harrow.CUR',;
      CAPTION='\<P.列印',;
      TOOLTIPTEXT='列印資料!快速鍵->ALT+P'
      NAME='PNT_BT' 
  ADD OBJECT CMND1 AS COMMANDBUTTON WITH;
      LEFT=INT_015*243,;
      TOP=INT_015*321,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\harrow.CUR',;
      CAPTION='\<X.離開',;
      TOOLTIPTEXT='取消此作業畫面!快速鍵->ALT+X'
      NAME='CMND1'
 PROC INIT   
       THISFORM.CAPTION='C66.入貨異動單' + '   料號：' + ALLTRIM(E16.F02) + '   客戶：' + ALLTRIM(IIF(SEEK(IIF(SEEK(LEFT(ALLTRIM(INSCH.F07),10),'P05'),P05.F04,E16.F06),'C01'),C01.F05,'')) + '   採購單號：' + INSCH.F01
       THISFORM.SETALL('HEIGHT',INT_015*25,'TEXTBOX')
       THISFORM.SETALL('HEIGHT',INT_015*17,'LABEL')
       THISFORM.SETALL('FONTSIZE',INT_015*9,'TEXTBOX')
       THISFORM.SETALL('FONTSIZE',INT_015*9,'LABEL')       
       THISFORM.SETALL('READONLY',.T.,'TEXTBOX')  
	   THISFORM.KEY_LIST.VISIBLE=.F.                
	   THISFORM.CMDGROUP.VISIBLE=.F.
       THISFORM.SHRGROUP.VISIBLE=.F.
       THISFORM.SHRGROUP.ENABLED=.F.
       THISFORM.ORPGROUP.ESC_BOTT.VISIBLE=.F.
       THISFORM.ORPGROUP.PNT_BOTT.VISIBLE=.F.
       THISFORM.COMBOBOX02.VISIBLE = .T.
       THISFORM.COMBOBOX08.VISIBLE = .T.
       THISFORM.COMBOBOX10.VISIBLE = .T. 
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'COLUMN')
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'HEADER')  
       THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(C66_TEMP.F01 = 0,RGB(255,0,0),'')","COLUMN") 
       THISFORM.GRID1.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)
       THISFORM.GRID1.COLUMN4.BACKCOLOR = RGB(255,255,0)
       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION=''
       THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='列印狀態'    
       THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='異動日期'
       THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='異動類別'
       THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='原定交期'
       THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='希望交期'
       THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='異動數量'
       THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='運貨方式'
       THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='運費對象'
       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='C66_TEMP.EXP_1'
       THISFORM.GRID1.COLUMN2.CONTROLSOURCE="IIF(C66_TEMP.F01 = 0,'尚未列印','已列印')"
       THISFORM.GRID1.COLUMN3.CONTROLSOURCE='C66_TEMP.F03'
       THISFORM.GRID1.COLUMN4.CONTROLSOURCE="ICASE(C66_TEMP.F02 = '1','提前交期',C66_TEMP.F02 = '2','延後交期','取消請購')"
       THISFORM.GRID1.COLUMN5.CONTROLSOURCE="IIF(!EMPTY(C66_TEMP.F09),C66_TEMP.F09,IIF(C66_TEMP.F17 = '1',C66_TEMP.F06,'尚未回覆'))"
       THISFORM.GRID1.COLUMN6.CONTROLSOURCE='C66_TEMP.F07'
       THISFORM.GRID1.COLUMN7.CONTROLSOURCE='C66_TEMP.F05'
       THISFORM.GRID1.COLUMN8.CONTROLSOURCE='C66_TEMP.F088'
       THISFORM.GRID1.COLUMN9.CONTROLSOURCE="ICASE(C66_TEMP.F10 = '1','客戶負擔',C66_TEMP.F10 = '2','公司負擔','')"
       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*20
       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*55
       THISFORM.GRID1.COLUMN3.WIDTH=INT_015*65
       THISFORM.GRID1.COLUMN4.WIDTH=INT_015*55
       THISFORM.GRID1.COLUMN5.WIDTH=INT_015*65
       THISFORM.GRID1.COLUMN6.WIDTH=INT_015*65
       THISFORM.GRID1.COLUMN7.WIDTH=INT_015*70
       THISFORM.GRID1.COLUMN8.WIDTH=INT_015*55
       THISFORM.GRID1.COLUMN9.WIDTH=INT_015*55      
       THISFORM.GRID1.SETFOCUS
       IF THISFORM.GRID1.ACTIVEROW=0
		  THISFORM.SETALL('VALUE','','TEXTBOX') 
		  THISFORM.LBLF99.CAPTION = ''
	      THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
	      THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
	      THISFORM.PNT_BT.ENABLED=.F.
       ELSE
	      THISFORM.ORPGROUP.EDIT_BOTT.ENABLED = IIF(A02.F05 = '*',.T.,.F.)
	      THISFORM.ORPGROUP.DEL_BOTT.ENABLED = IIF(A02.F06 = '*',.T.,.F.)
	      THISFORM.PNT_BT.ENABLED = IIF(A02.F07 = '*',.T.,.F.)
	      THISFORM.TXTF02.VALUE = ICASE(C66_TEMP.F02 = '1','提前交期',C66_TEMP.F02 = '2','延後交期','取消請購')
	      THISFORM.TXTF03.VALUE = C66_TEMP.F03
	      THISFORM.TXTF05.VALUE = C66_TEMP.F05
	      THISFORM.TXTF06.VALUE = IIF(!EMPTY(C66_TEMP.F09),C66_TEMP.F09,IIF(C66_TEMP.F17 = '1',C66_TEMP.F06,'尚未回覆'))
	      THISFORM.TXTF07.VALUE = C66_TEMP.F07
	      THISFORM.TXTF08.VALUE = C66_TEMP.F088
	      THISFORM.TXTF10.VALUE = ICASE(C66_TEMP.F10 = '1','客戶負擔',C66_TEMP.F10 = '2','公司負擔','')
	      THISFORM.TXTF14.VALUE = C66_TEMP.F14
	      THISFORM.LBLF99.CAPTION = '安全資料 ' + C66_TEMP.F99
       ENDIF
       THISFORM.ORPGROUP.NEW_BOTT.ENABLED = IIF(A02.F04 = '*',.T.,.F.)
   ENDPROC   
  PROC GRID1.INIT      
	 THISFORM.GRID1.COLUMN1.READONLY=.F.
	 THISFORM.GRID1.COLUMN2.READONLY=.T.
	 THISFORM.GRID1.COLUMN3.READONLY=.T.
	 THISFORM.GRID1.COLUMN4.READONLY=.T.
	 THISFORM.GRID1.COLUMN5.READONLY=.T.
	 THISFORM.GRID1.COLUMN6.READONLY=.T.
	 THISFORM.GRID1.COLUMN7.READONLY=.T.
	 THISFORM.GRID1.COLUMN8.READONLY=.T.
	 THISFORM.GRID1.COLUMN9.READONLY=.T.
	 THISFORM.GRID1.COLUMN1.removeobject("TEXT1")
	 THISFORM.GRID1.COLUMN1.AddObject("CheckBox1","CheckBox1") 
	 THISFORM.GRID1.COLUMN1.CurrentControl="CheckBox1" 
	 THISFORM.GRID1.COLUMN1.Sparse=.F.
	 THISFORM.GRID1.COLUMN1.CheckBox1.Visible=.T.
	 THISFORM.GRID1.COLUMN1.CheckBox1.CAPTION=''
	 THISFORM.GRID1.COLUMN1.CheckBox1.AUTOSIZE=.T.
	 THISFORM.GRID1.COLUMN1.CheckBox1.CENTERED=.T.
	 THISFORM.GRID1.COLUMN1.CheckBox1.BACKSTYLE=0
	 THISFORM.GRID1.COLUMN1.CheckBox1.LEFT=5	 
  ENDPROC 
  PROCEDURE GRID1.AFTERROWCOLCHANGE
       LPARAMETERS NCOLINDEX
          THISFORM.GRID1.TOOLTIPTEXT = IIF(C66_TEMP.F01 = 0,'尚未列印','已列印')
	      THISFORM.TXTF02.VALUE = ICASE(C66_TEMP.F02 = '1','提前交期',C66_TEMP.F02 = '2','延後交期','取消請購')
	      THISFORM.TXTF03.VALUE = C66_TEMP.F03
	      THISFORM.TXTF05.VALUE = C66_TEMP.F05
	      THISFORM.TXTF06.VALUE = IIF(!EMPTY(C66_TEMP.F09),C66_TEMP.F09,IIF(C66_TEMP.F17 = '1',C66_TEMP.F06,'尚未回覆'))
	      THISFORM.TXTF07.VALUE = C66_TEMP.F07
	      THISFORM.TXTF08.VALUE = C66_TEMP.F088
	      THISFORM.TXTF10.VALUE = ICASE(C66_TEMP.F10 = '1','客戶負擔',C66_TEMP.F10 = '2','公司負擔','')
	      THISFORM.TXTF14.VALUE = C66_TEMP.F14 
	      THISFORM.LBLF99.CAPTION = '安全資料 ' + C66_TEMP.F99
  ENDPROC 
   PROCEDURE COMBOBOX02.INIT
		WITH THIS
   			.ADDITEM('提前交期')
   			.ADDITEM('延後交期')
   			.ADDITEM('取消請購')
   			.VALUE = 1
    	ENDWITH
   ENDPROC     
PROCEDURE COMBOBOX02.INTERACTIVECHANGE 
	 THISFORM.COMBOBOX08.CLEAR
	 THISFORM.TXTF08.VISIBLE = .F.
	 THISFORM.TXTF10.VISIBLE = .T.
	 THISFORM.COMBOBOX08.VISIBLE = .T.
	 THISFORM.COMBOBOX10.VISIBLE = .F.	
	 THISFORM.COMBOBOX08.VALUE = 1
	 THISFORM.TXTF07.ENABLED = .T.
	 THISFORM.TXTF07.VALUE = DATE()
	 THISFORM.TXTF10.VALUE = ''
	 DO CASE
	 	CASE  THISFORM.COMBOBOX02.VALUE = 1
	 	      THISFORM.COMBOBOX08.ADDITEM('海運')
	 	      THISFORM.COMBOBOX08.ADDITEM('海運提前')
	 	      THISFORM.COMBOBOX08.ADDITEM('空運')
	 	      THISFORM.COMBOBOX08.ADDITEM('空運提前')
	 	      THISFORM.COMBOBOX08.ADDITEM('快遞')
	 	      THISFORM.COMBOBOX08.ADDITEM('快遞提前')
	 	      THISFORM.TXTF08.VALUE = IIF(THISFORM.COMBOBOX08.VALUE = 1 OR THISFORM.COMBOBOX08.VALUE = 2,'',THISFORM.COMBOBOX10.DISPLAYVALUE)
	 	CASE  THISFORM.COMBOBOX02.VALUE = 2
	 		  THISFORM.COMBOBOX08.ADDITEM('海運延後') 
	 	      THISFORM.COMBOBOX08.ADDITEM('空運延後') 
	 	      THISFORM.COMBOBOX08.ADDITEM('快遞延後')
	 	      THISFORM.TXTF08.VALUE = IIF(THISFORM.COMBOBOX08.VALUE = 1,'',THISFORM.COMBOBOX10.DISPLAYVALUE)
	 	CASE  THISFORM.COMBOBOX02.VALUE = 3
	 		  THISFORM.TXTF07.ENABLED = .F.
	 		  THISFORM.TXTF07.VALUE = ''
	 	      THISFORM.TXTF08.VISIBLE = .T.
	 	      THISFORM.COMBOBOX08.VISIBLE = .F.
	 	      THISFORM.TXTF08.VALUE = ''
			  THISFORM.TXTF10.VISIBLE = .T.
			  THISFORM.COMBOBOX10.VISIBLE = .F.
	 ENDCASE   
ENDPROC    
   PROCEDURE COMBOBOX08.INIT
		WITH THIS
   			.ADDITEM('海運')
   			.ADDITEM('海運提前')
   			.ADDITEM('空運')
   			.ADDITEM('空運提前')
   			.ADDITEM('快遞')
   			.ADDITEM('快遞提前')
   			.VALUE = 1
    	ENDWITH           
   ENDPROC  
PROCEDURE COMBOBOX08.INTERACTIVECHANGE   
      IF THISFORM.COMBOBOX08.DISPLAYVALUE = '海運' OR THISFORM.COMBOBOX08.DISPLAYVALUE = '海運提前' OR THISFORM.COMBOBOX08.DISPLAYVALUE = '海運延後'
		 THISFORM.TXTF10.VISIBLE = .T.
		 THISFORM.COMBOBOX10.VISIBLE = .F. 
	  ELSE
		 THISFORM.TXTF10.VISIBLE = .F.
		 THISFORM.COMBOBOX10.VISIBLE = .T. 
		 THISFORM.COMBOBOX10.VALUE = 1  
	  ENDIF
 ENDPROC 
   PROCEDURE COMBOBOX10.INIT
		WITH THIS
   			.ADDITEM('客戶負擔')
   			.ADDITEM('公司負擔')
   			.VALUE = 1
    	ENDWITH           
   ENDPROC     
PROCEDURE ORPGROUP.NEW_BOTT.CLICK 
	   THISFORM.ORPGROUP.ENABLED = .F.
	   THISFORM.CMND1.ENABLED =.F.
       THISFORM.GRID1.ENABLED=.F.
       THISFORM.PNT_BT.ENABLED = .F.
       THISFORM.SETALL('READONLY',.F.,'TEXTBOX') 
       THISFORM.TXTF02.VISIBLE = .F.
       THISFORM.TXTF08.VISIBLE = .F.      
       THISFORM.TXTF03.READONLY= .T.
       THISFORM.TXTF06.READONLY= .T.
       THISFORM.TXTF08.READONLY= .T.
       THISFORM.TXTF10.READONLY= .T.
       THISFORM.COMBOBOX02.VISIBLE = .T.
       THISFORM.COMBOBOX08.VISIBLE = .T.
       THISFORM.COMBOBOX10.VISIBLE = .F.
       THISFORM.COMBOBOX02.VALUE = 1
       THISFORM.TXTF02.VALUE = ''
       THISFORM.TXTF03.VALUE = DATE()
       THISFORM.TXTF05.VALUE = INSCH.F04
       THISFORM.TXTF06.VALUE = IIF(INSCH.F09 = '1',INSCH.F03,'尚未回覆')
       THISFORM.TXTF07.VALUE = DATE()
       THISFORM.TXTF08.VALUE = ''
       THISFORM.TXTF10.VALUE = ''
       THISFORM.TXTF14.VALUE = ''
       THISFORM.LBLF99.CAPTION = ''
       THISFORM.COMBOBOX02.SETFOCUS 
 ENDPROC
 PROCEDURE SHRGROUP.SHURE1_BOTT.CLICK  
      IF EMPTY(THISFORM.TXTF07.VALUE) = .T. AND THISFORM.COMBOBOX02.VALUE <> 3
          =MESSAGEBOX('希望交期不得空白!',0+64,'提示訊息視窗')
          THISFORM.TXTF07.SETFOCUS
          RETURN            
      ENDIF 
      IF INSCH.F09 = '1'
         IF THISFORM.COMBOBOX02.VALUE = 2 AND THISFORM.TXTF07.VALUE <= INSCH.F03
            =MESSAGEBOX('延後之希望交期不得小於原定交期!',0+64,'提示訊息視窗')
            THISFORM.TXTF07.SETFOCUS
            RETURN            
         ENDIF     
      ENDIF
      IF THISFORM.TXTF05.VALUE <= 0
          =MESSAGEBOX('異動數量不得小於等於零!',0+64,'提示訊息視窗')
          THISFORM.TXTF05.SETFOCUS
          RETURN            
      ENDIF     
      IF THISFORM.TXTF05.VALUE > INSCH.F04
          =MESSAGEBOX('異動數量不得大於訂購數量!',0+64,'提示訊息視窗')
          THISFORM.TXTF05.SETFOCUS
          RETURN            
      ENDIF
      SELECT C66
      APPEND BLANK
      REPLACE C66.F02 WITH ALLTRIM(STR(THISFORM.COMBOBOX02.VALUE))
      REPLACE C66.F03 WITH THISFORM.TXTF03.VALUE
      REPLACE C66.F04 WITH INSCH.F02
      REPLACE C66.F05 WITH THISFORM.TXTF05.VALUE
      REPLACE C66.F06 WITH INSCH.F03
      REPLACE C66.F07 WITH IIF(C66.F02 = '3',CTOD(''),THISFORM.TXTF07.VALUE)
      REPLACE C66.F08 WITH IIF(C66.F02 = '3','',CHR(IIF(C66.F02 = '1',64,70) + THISFORM.COMBOBOX08.VALUE))
      REPLACE C66.F10 WITH IIF(THISFORM.COMBOBOX10.VISIBLE = .T.,ALLTRIM(STR(THISFORM.COMBOBOX10.VALUE)),'')
      REPLACE C66.F11 WITH IIF(SEEK(LEFT(ALLTRIM(INSCH.F07),10),'P05'),P05.F04,E16.F06)
      REPLACE C66.F12 WITH INSCH.F01
      REPLACE C66.F13 WITH IIF(SEEK(C66.F11,'C01'),IIF(ALLTRIM(INT_209) = 'A',C01.F18,C01.F33),sys_oper)
      REPLACE C66.F14 WITH THISFORM.TXTF14.VALUE
      REPLACE C66.F17 WITH INSCH.F09
      REPLACE C66.F18 WITH INSCH.F05
      REPLACE C66.F20 WITH IIF(SEEK(C66.F11,'C01'),C01.F23,sys_oper)
      REPLACE C66.F99 WITH IIF(INT_012=1,PADL(ALLTRIM(STR(YEAR(DATE())-1911)),3,' ')+RIGHT(DTOC(DATE()),6),dtoc(DATE())+' ')+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
   	  SELECT C66_TEMP
      APPEND BLANK
      REPLACE C66_TEMP.EXP_1 WITH 1
      REPLACE C66_TEMP.F02 WITH ALLTRIM(STR(THISFORM.COMBOBOX02.VALUE))
      REPLACE C66_TEMP.F03 WITH THISFORM.TXTF03.VALUE
      REPLACE C66_TEMP.F04 WITH INSCH.F02
      REPLACE C66_TEMP.F05 WITH THISFORM.TXTF05.VALUE
      REPLACE C66_TEMP.F06 WITH INSCH.F03
      REPLACE C66_TEMP.F07 WITH IIF(C66_TEMP.F02 = '3',CTOD(''),THISFORM.TXTF07.VALUE)
      REPLACE C66_TEMP.F08 WITH IIF(C66_TEMP.F02 = '3','',CHR(IIF(C66_TEMP.F02 = '1',64,70) + THISFORM.COMBOBOX08.VALUE))
      REPLACE C66_TEMP.F088 WITH IIF(C66_TEMP.F02 = '3','',ALLTRIM(THISFORM.COMBOBOX08.DISPLAYVALUE))
      REPLACE C66_TEMP.F10 WITH IIF(THISFORM.COMBOBOX10.VISIBLE = .T.,ALLTRIM(STR(THISFORM.COMBOBOX10.VALUE)),'')
      REPLACE C66_TEMP.F11 WITH IIF(SEEK(LEFT(ALLTRIM(INSCH.F07),10),'P05'),P05.F04,E16.F06)
      REPLACE C66_TEMP.F12 WITH INSCH.F01
      REPLACE C66_TEMP.F13 WITH IIF(SEEK(C66_TEMP.F11,'C01'),IIF(ALLTRIM(INT_209) = 'A',C01.F18,C01.F33),sys_oper)
      REPLACE C66_TEMP.F14 WITH THISFORM.TXTF14.VALUE
      REPLACE C66_TEMP.F17 WITH INSCH.F09
      REPLACE C66_TEMP.F18 WITH INSCH.F05
      REPLACE C66_TEMP.F20 WITH IIF(SEEK(C66_TEMP.F11,'C01'),C01.F23,sys_oper)
      REPLACE C66_TEMP.F99 WITH IIF(INT_012=1,PADL(ALLTRIM(STR(YEAR(DATE())-1911)),3,' ')+RIGHT(DTOC(DATE()),6),dtoc(DATE())+' ')+IIF(SEEK(sys_oper,'A01'),A01.F03,'') 
	  SELECT INSCH
	  REPLACE INSCH.F14 WITH ALLTRIM(STR(THISFORM.COMBOBOX02.VALUE))
	  REPLACE INSCH.F15 WITH THISFORM.TXTF03.VALUE
	  SELECT D07
	  SET ORDER TO D074   && F01+F02+DTOS(F03)
	  SEEK INSCH.F01 + INSCH.F02 + DTOS(INSCH.F03)
	  IF FOUND()
	     REPLACE D07.F14 WITH ALLTRIM(STR(THISFORM.COMBOBOX02.VALUE))
	     REPLACE D07.F15 WITH THISFORM.TXTF03.VALUE
	  ENDIF
	  SELECT C66_TEMP
	  UNLOCK ALL
	  THISFORM.GRID1.ENABLED=.T.
	  THISFORM.GRID1.SETFOCUS  
	  THISFORM.ORPGROUP.NEW_BOTT.CLICK
 ENDPROC
 PROCEDURE ORPGROUP.EDIT_BOTT.CLICK 
	   THISFORM.ORPGROUP.ENABLED = .F.
	   THISFORM.CMND1.ENABLED =.F.
	   THISFORM.PNT_BT.ENABLED = .F.
       THISFORM.GRID1.ENABLED=.F.
       THISFORM.SETALL('READONLY',.F.,'TEXTBOX') 
       THISFORM.TXTF02.VISIBLE = .F.
       THISFORM.TXTF08.VISIBLE = .F.
       THISFORM.TXTF03.READONLY= .T.
       THISFORM.TXTF06.READONLY= .T.
       THISFORM.TXTF08.READONLY= .T.
       THISFORM.TXTF10.READONLY= .T.
       THISFORM.COMBOBOX02.VISIBLE = .T.
       THISFORM.COMBOBOX08.VISIBLE = .T.
       THISFORM.COMBOBOX10.VISIBLE = .F.
       THISFORM.COMBOBOX02.VALUE = VAL(C66_TEMP.F02)
       THISFORM.COMBOBOX02.INTERACTIVECHANGE
       THISFORM.COMBOBOX08.VALUE = ASC(C66_TEMP.F08) - IIF(C66_TEMP.F02 = '1',64,70)
       THISFORM.TXTF10.VISIBLE = IIF(EMPTY(C66_TEMP.F10),.T.,.F.)
       THISFORM.COMBOBOX10.VISIBLE = IIF(EMPTY(C66_TEMP.F10),.F.,.T.)
       THISFORM.COMBOBOX10.VALUE = VAL(C66_TEMP.F10)
       THISFORM.TXTF07.VALUE = C66_TEMP.F07
       THISFORM.TXTF10.VALUE = ICASE(C66_TEMP.F10 = '1','客戶負擔',C66_TEMP.F10 = '1','公司負擔','')
       THISFORM.COMBOBOX02.SETFOCUS 
 ENDPROC 
 PROCEDURE SHRGROUP.SHURE2_BOTT.CLICK  
      IF EMPTY(THISFORM.TXTF07.VALUE) = .T. AND THISFORM.COMBOBOX02.VALUE <> 3
          =MESSAGEBOX('希望交期不得空白!',0+64,'提示訊息視窗')
          THISFORM.TXTF07.SETFOCUS
          RETURN            
      ENDIF 
      IF INSCH.F09 = '1'
         IF THISFORM.COMBOBOX02.VALUE = 2 AND THISFORM.TXTF07.VALUE <= IIF(EMPTY(C66_TEMP.F09),C66_TEMP.F06,C66_TEMP.F09)
            =MESSAGEBOX('延後之希望交期不得小於原定交期!',0+64,'提示訊息視窗')
            THISFORM.TXTF07.SETFOCUS
            RETURN            
         ENDIF     
      ENDIF
      IF THISFORM.TXTF05.VALUE <= 0
          =MESSAGEBOX('異動數量不得小於等於零!',0+64,'提示訊息視窗')
          THISFORM.TXTF05.SETFOCUS
          RETURN            
      ENDIF     
      IF THISFORM.TXTF05.VALUE > INSCH.F04
          =MESSAGEBOX('異動數量不得大於訂購數量!',0+64,'提示訊息視窗')
          THISFORM.TXTF05.SETFOCUS
          RETURN            
      ENDIF
      SELECT C66
      SET ORDER TO C661 &&F02+DTOS(F03)+F04+ALLTRIM(TRANSFORM(F05,"@R 99,999,999.99"))+F08+F10+F11+F12+F13
      SEEK C66_TEMP.F02 + DTOS(C66_TEMP.F03) + C66_TEMP.F04 + ALLTRIM(TRANSFORM(C66_TEMP.F05,"@R 99,999,999.99")) + C66_TEMP.F08 + C66_TEMP.F10 + C66_TEMP.F11 + C66_TEMP.F12 + C66_TEMP.F13
	  IF FOUND()
	     REPLACE C66.F01 WITH 0
	     REPLACE C66.F02 WITH ALLTRIM(STR(THISFORM.COMBOBOX02.VALUE))
	     REPLACE C66.F04 WITH INSCH.F02
	     REPLACE C66.F05 WITH THISFORM.TXTF05.VALUE
	     REPLACE C66.F06 WITH INSCH.F03
	     REPLACE C66.F07 WITH IIF(C66.F02 = '3',CTOD(''),THISFORM.TXTF07.VALUE)
	     REPLACE C66.F08 WITH IIF(C66.F02 = '3','',CHR(IIF(C66.F02 = '1',64,70) + THISFORM.COMBOBOX08.VALUE))
	     REPLACE C66.F10 WITH IIF(THISFORM.COMBOBOX10.VISIBLE = .T.,ALLTRIM(STR(THISFORM.COMBOBOX10.VALUE)),'')
	     REPLACE C66.F14 WITH THISFORM.TXTF14.VALUE
	     REPLACE C66.F17 WITH INSCH.F09
	     REPLACE C66.F99 WITH IIF(INT_012=1,PADL(ALLTRIM(STR(YEAR(DATE())-1911)),3,' ')+RIGHT(DTOC(DATE()),6),dtoc(DATE())+' ')+IIF(SEEK(sys_oper,'A01'),A01.F03,'')    
	  ENDIF
   	  SELECT C66_TEMP
      LOCK()
      IF RLOCK()
	      REPLACE C66_TEMP.EXP_1 WITH 1
	      REPLACE C66_TEMP.F01 WITH 0
	      REPLACE C66_TEMP.F02 WITH ALLTRIM(STR(THISFORM.COMBOBOX02.VALUE))
	      REPLACE C66_TEMP.F04 WITH INSCH.F02
	      REPLACE C66_TEMP.F05 WITH THISFORM.TXTF05.VALUE
	      REPLACE C66_TEMP.F06 WITH INSCH.F03
	      REPLACE C66_TEMP.F07 WITH IIF(C66_TEMP.F02 = '3',CTOD(''),THISFORM.TXTF07.VALUE)
	      REPLACE C66_TEMP.F08 WITH IIF(C66_TEMP.F02 = '3','',CHR(IIF(C66_TEMP.F02 = '1',64,70) + THISFORM.COMBOBOX08.VALUE))
	      REPLACE C66_TEMP.F088 WITH IIF(C66_TEMP.F02 = '3','',ALLTRIM(THISFORM.COMBOBOX08.DISPLAYVALUE))
	      REPLACE C66_TEMP.F10 WITH IIF(THISFORM.COMBOBOX10.VISIBLE = .T.,ALLTRIM(STR(THISFORM.COMBOBOX10.VALUE)),'')
	      REPLACE C66_TEMP.F14 WITH THISFORM.TXTF14.VALUE
	      REPLACE C66_TEMP.F17 WITH INSCH.F09
	      REPLACE C66_TEMP.F99 WITH IIF(INT_012=1,PADL(ALLTRIM(STR(YEAR(DATE())-1911)),3,' ')+RIGHT(DTOC(DATE()),6),dtoc(DATE())+' ')+IIF(SEEK(sys_oper,'A01'),A01.F03,'')       
      ENDIF
	  SELECT INSCH
	  REPLACE INSCH.F14 WITH ALLTRIM(STR(THISFORM.COMBOBOX02.VALUE))
	  REPLACE INSCH.F15 WITH THISFORM.TXTF03.VALUE
	  SELECT D07
	  SET ORDER TO D074   && F01+F02+DTOS(F03)
	  SEEK INSCH.F01 + INSCH.F02 + DTOS(INSCH.F03)
	  IF FOUND()
	     REPLACE D07.F14 WITH ALLTRIM(STR(THISFORM.COMBOBOX02.VALUE))
	     REPLACE D07.F15 WITH THISFORM.TXTF03.VALUE
	  ENDIF
	  SELECT C66_TEMP
	  UNLOCK ALL
	  THISFORM.GRID1.ENABLED=.T.
	  THISFORM.GRID1.SETFOCUS  
	  THISFORM.SHRGROUP.ABANDON_BOTT.CLICK  
 ENDPROC  
 PROCEDURE ORPGROUP.DEL_BOTT.CLICK
      IF MESSAGEBOX('是否確定要刪除此筆資料',4+32+256,'請確認') = 6
	     SELECT C66
	     SET ORDER TO C661 &&F02+DTOS(F03)+F04+ALLTRIM(TRANSFORM(F05,"@R 99,999,999.99"))+F08+F10+F11+F12+F13
	     SEEK C66_TEMP.F02 + DTOS(C66_TEMP.F03) + C66_TEMP.F04 + ALLTRIM(TRANSFORM(C66_TEMP.F05,"@R 99,999,999.99")) + C66_TEMP.F08 + C66_TEMP.F10 + C66_TEMP.F11 + C66_TEMP.F12 + C66_TEMP.F13
		 IF FOUND()
		    SELECT C66
		    DELETE 
		    SELECT C66_TEMP
		    DELETE 
		 ENDIF
      ENDIF
      THISFORM.GRID1.SETFOCUS 
      IF THISFORM.GRID1.ACTIVEROW=0
		  SELECT INSCH
		  REPLACE INSCH.F14 WITH ''
		  REPLACE INSCH.F15 WITH CTOD('')
		  SELECT D07
		  SET ORDER TO D074   && F01+F02+DTOS(F03)
		  SEEK INSCH.F01 + INSCH.F02 + DTOS(INSCH.F03)
		  IF FOUND()
		     REPLACE D07.F14 WITH ''
		     REPLACE D07.F15 WITH CTOD('')
		  ENDIF
		  THISFORM.SETALL('VALUE','','TEXTBOX') 
	      THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
	      THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
	      THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
      ENDIF
      SELECT C66_TEMP
 ENDPROC
 PROCEDURE SHRGROUP.ABANDON_BOTT.CLICK
	  SELECT C66_TEMP 
	  THISFORM.CMND1.ENABLED=.T.
	  THISFORM.ORPGROUP.ENABLED=.T.
      THISFORM.ORPGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
	  THISFORM.SHRGROUP.ENABLED=.F.
      THISFORM.SHRGROUP.VISIBLE=.F.
      THISFORM.TXTF07.ENABLED = .T.
      THISFORM.COMBOBOX02.VISIBLE = .T.
      THISFORM.COMBOBOX08.VISIBLE = .T.
      THISFORM.COMBOBOX10.VISIBLE = .T.
      THISFORM.SETALL('READONLY',.T.,'TEXTBOX')
      THISFORM.SETALL('VISIBLE',.T.,'TEXTBOX') 
	  THISFORM.GRID1.ENABLED=.T.
	  THISFORM.GRID1.SETFOCUS  
      IF THISFORM.GRID1.ACTIVEROW=0
	     THISFORM.SETALL('VALUE','','TEXTBOX') 
	     THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
	     THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
	     THISFORM.PNT_BT.ENABLED=.F. 
      ELSE
	     THISFORM.ORPGROUP.EDIT_BOTT.ENABLED = IIF(A02.F05 = '*',.T.,.F.)
	     THISFORM.ORPGROUP.DEL_BOTT.ENABLED = IIF(A02.F06 = '*',.T.,.F.)
	     THISFORM.PNT_BT.ENABLED = IIF(A02.F07 = '*',.T.,.F.)
      ENDIF
      THISFORM.ORPGROUP.NEW_BOTT.ENABLED = IIF(A02.F04 = '*',.T.,.F.)
 ENDPROC
 PROCEDURE SHRGROUP.FINISH_BOTT.CLICK
   THISFORM.SHRGROUP.ABANDON_BOTT.CLICK
 ENDPROC
 PROCEDURE CMND1.CLICK
     THISFORM.RELEASE
     RETURN 
 ENDPROC  
 PROCEDURE PNT_BT.CLICK  
 	CH_F02 = '' 
 	MAIL_TEXT = ''
    SELECT * FROM C66_TEMP WHERE C66_TEMP.EXP_1 = 1 INTO CURSOR C66_1	
    SELECT C66_1
    GO TOP
    IF _TALLY > 0
       SELECT C66_1.F02,C66_1.F11,C66_1.F18 FROM C66_1 GROUP BY C66_1.F02 ORDER BY C66_1.F02 INTO CURSOR C66_2
       SELECT C66_2
       IF RECCOUNT('C66_2') > 1
          DO WHILE !EOF()
             CH_F02 = CH_F02 + ICASE(C66_2.F02 = '1','提前交期、',C66_2.F02 = '2','延後交期、','取消請購、')
             SELECT C66_2
             SKIP
          ENDDO
          =MESSAGEBOX('此列印作業將會預覽列印共 ' + ALLTRIM(STR(RECCOUNT('C66_2'))) + ' 張入貨異動申請單，異動類別包含：' + LEFT(ALLTRIM(CH_F02),LEN(ALLTRIM(CH_F02)) - 2),0+64,'提示訊息視窗')
       ENDIF
	   SELECT C66_2
	   GO TOP
	   DO WHILE !EOF()
	      SELECT C66_TEMP.* FROM C66_TEMP WHERE C66_TEMP.EXP_1 = 1 AND C66_TEMP.F02 = C66_2.F02 ORDER BY C66_TEMP.F03 INTO CURSOR C66ABC
	      REPORT FORM ALLTRIM(INT_116)+'C66' TO PRINT PROMPT PREVIEW 
	      CLEAR    
	      ******傳送MAIL給該廠商負責之採購人員
	      WAIT WINDOW "傳送郵件,請稍後!" AT 0,150 NOWAIT NOCLEAR  
	      SELECT C66ABC
	      GO TOP
	      DO WHILE !EOF()
	         MAIL_TEXT = MAIL_TEXT + '廠商簡稱：' + IIF(SEEK(C66ABC.F18,'D01'),D01.F04,C66ABC.F18) + CHR(13) + CHR(10) + ;
	         			 '採購單號：' + C66ABC.F12 + CHR(13) + CHR(10) + ;
	         			 '料品編號：' + C66ABC.F04 + CHR(13) + CHR(10) + ;
	         			 '異動類別：' + ICASE(C66ABC.F02 = '1','提前交期',C66ABC.F02 = '2','延後交期','取消請購') + CHR(13) + CHR(10) + ;
	         			 '異動數量：' + ALLTRIM(TRANSFORM(C66ABC.F05,'@R 99,999,999.99'))  + CHR(13) + CHR(10) + ;
	         			 '希望交期：' + DTOC(C66ABC.F07) + CHR(13) + CHR(10) + ;
	         			 '載運方式：' + C66ABC.F088 + CHR(13) + CHR(10) + ;
	         			 '運費對象：' + ICASE(C66ABC.F10 = '1','客戶負擔',C66ABC.F10 = '1','公司負擔','') + CHR(13) + CHR(10) + ;
	         			 '備註說明：' + C66ABC.F14 + CHR(13) + CHR(10) + ;
	         			 '************************************************' + CHR(13) + CHR(10)
 	         SELECT C66ABC
 	         SKIP
 	      ENDDO
 	      ****傳送MAIL給負責此廠商之採購
 	      IF SEEK(C66_1.F18,'D01') = .T. AND EMPTY(D01.F39) = .F. AND SEEK(D01.F39,'A01') = .T. AND ALLTRIM(A01.F06) = 'Y' AND AT('@',A01.F10) <> 0 AND EMPTY(MAIL_TEXT) = .F.
             SEND_MAIL(ALLTRIM(INT_MAI),ALLTRIM(A01.F10),ALLTRIM(INT_DNS),'系統通知：C66.入貨異動申請單、客戶簡稱：' + IIF(SEEK(C66_2.F11,'C01'),C01.F05,C66_2.F11) + '、異動類別：' + ICASE(C66_2.F02 = '1','提前交期',C66_2.F02 = '2','延後交期','取消請購'),'TEXT',MAIL_TEXT)
          ENDIF
 	      ****傳送MAIL給負責此廠商之採購主管
 	      IF SEEK(C66_1.F18,'D01') = .T. AND EMPTY(D01.F25) = .F. AND SEEK(LEFT(D01.F25,5),'A01') = .T. AND ALLTRIM(A01.F06) = 'Y' AND AT('@',A01.F10) <> 0 AND EMPTY(MAIL_TEXT) = .F.
             SEND_MAIL(ALLTRIM(INT_MAI),ALLTRIM(A01.F10),ALLTRIM(INT_DNS),'系統通知：C66.入貨異動申請單、客戶簡稱：' + IIF(SEEK(C66_2.F11,'C01'),C01.F05,C66_2.F11) + '、異動類別：' + ICASE(C66_2.F02 = '1','提前交期',C66_2.F02 = '2','延後交期','取消請購'),'TEXT',MAIL_TEXT)
          ENDIF
          
          ****傳送MAIL給負責業務A
 	      IF SEEK(C66_1.F11,'C01') = .T. AND EMPTY(C01.F18) = .F. AND ALLTRIM(SYS_OPER) <> ALLTRIM(C01.F18) AND SEEK(C01.F18,'A01') = .T. AND ALLTRIM(A01.F06) = 'Y' AND AT('@',A01.F10) <> 0 AND EMPTY(MAIL_TEXT) = .F.
             SEND_MAIL(ALLTRIM(INT_MAI),ALLTRIM(A01.F10),ALLTRIM(INT_DNS),'系統通知：C66.入貨異動申請單、客戶簡稱：' + IIF(SEEK(C66_2.F11,'C01'),C01.F05,C66_2.F11) + '、異動類別：' + ICASE(C66_2.F02 = '1','提前交期',C66_2.F02 = '2','延後交期','取消請購'),'TEXT',MAIL_TEXT)
          ENDIF
          ****傳送MAIL給負責業務B
 	      IF SEEK(C66_1.F11,'C01') = .T. AND EMPTY(C01.F33) = .F. AND ALLTRIM(SYS_OPER) <> ALLTRIM(C01.F33) AND SEEK(C01.F33,'A01') = .T. AND ALLTRIM(A01.F06) = 'Y' AND AT('@',A01.F10) <> 0 AND EMPTY(MAIL_TEXT) = .F.
             SEND_MAIL(ALLTRIM(INT_MAI),ALLTRIM(A01.F10),ALLTRIM(INT_DNS),'系統通知：C66.入貨異動申請單、客戶簡稱：' + IIF(SEEK(C66_2.F11,'C01'),C01.F05,C66_2.F11) + '、異動類別：' + ICASE(C66_2.F02 = '1','提前交期',C66_2.F02 = '2','延後交期','取消請購'),'TEXT',MAIL_TEXT)
          ENDIF
          ****傳送MAIL給負責業助
 	      IF SEEK(C66_1.F11,'C01') = .T. AND EMPTY(C01.F23) = .F. AND ALLTRIM(SYS_OPER) <> ALLTRIM(C01.F23) AND SEEK(C01.F23,'A01') = .T. AND ALLTRIM(A01.F06) = 'Y' AND AT('@',A01.F10) <> 0 AND EMPTY(MAIL_TEXT) = .F.
             SEND_MAIL(ALLTRIM(INT_MAI),ALLTRIM(A01.F10),ALLTRIM(INT_DNS),'系統通知：C66.入貨異動申請單、客戶簡稱：' + IIF(SEEK(C66_2.F11,'C01'),C01.F05,C66_2.F11) + '、異動類別：' + ICASE(C66_2.F02 = '1','提前交期',C66_2.F02 = '2','延後交期','取消請購'),'TEXT',MAIL_TEXT)
          ENDIF
          WAIT CLEAR
	      SELECT C66_2
	      SKIP 
	   ENDDO
	   SELECT C66_2
	   USE
	   SELECT C66_TEMP
	   GO TOP
	   DO WHILE !EOF()
	      IF C66_TEMP.EXP_1 = 1
	         REPLACE C66_TEMP.EXP_1 WITH 0
	         REPLACE C66_TEMP.F01 WITH 1
	         REPLACE C66_TEMP.F03 WITH DATE()
	     	 SELECT C66
	     	 SET ORDER TO C661 &&F02+DTOS(F03)+F04+ALLTRIM(TRANSFORM(F05,"@R 99,999,999.99"))+F08+F10+F11+F12+F13
	     	 SEEK C66_TEMP.F02 + DTOS(C66_TEMP.F03) + C66_TEMP.F04 + ALLTRIM(TRANSFORM(C66_TEMP.F05,"@R 99,999,999.99")) + C66_TEMP.F08 + C66_TEMP.F10 + C66_TEMP.F11 + C66_TEMP.F12 + C66_TEMP.F13
		 	 IF FOUND()
		    	REPLACE C66.F01 WITH 1
		    	REPLACE C66.F03 WITH DATE()
		    	REPLACE C66.F15 WITH ''
		    	REPLACE C66.F16 WITH 0
		    	REPLACE C66.F98 WITH ''
		 	 ENDIF 
	      ENDIF
	      SELECT C66_TEMP
	      SKIP   
	   ENDDO
    ELSE
      =MESSAGEBOX('請選擇欲列印之資料!',0+64,'提示訊息視窗')
      THISFORM.GRID1.SETFOCUS 
      RETURN
    ENDIF
    SELECT C66_1
    USE
    SELECT C66_TEMP                                                                                    
    THISFORM.GRID1.SETFOCUS 
 ENDPROC 
ENDDEFINE   
**********
  DEFINE CLASS CheckBox1 AS CheckBox
      PROCEDURE CLICK
        IF THIS.VALUE=1
           REPLACE C66_TEMP.EXP_1 WITH 1
        ELSE
           REPLACE C66_TEMP.EXP_1 WITH 0      
        ENDIF
        THISFORM.GRID1.SETFOCUS     
   ENDPROC  
  ENDDEFINE 
************************************************特殊輸入欄位的設定----料號
DEFINE CLASS TXTF02 AS TEXTBOX
  READONLY=.T.
  MAXLENGTH=43
  FONTSIZE=INT_015*9
  PROCEDURE INTERACTIVECHANGE
    IF AT('?',ALLTRIM(THIS.VALUE))<>0
       IF AT('?',ALLTRIM(THIS.VALUE))>1             
          SELECT F01,F02 FROM B01 INTO CURSOR MTR ORDER BY F01 WHERE !EMPTY(F98) AND LEFT(F01,AT('?',THIS.VALUE)-1)=LEFT(THIS.VALUE,AT('?',THIS.VALUE)-1)    
       ELSE
          SELECT F01,F02 FROM B01 INTO CURSOR MTR ORDER BY F01 WHERE !EMPTY(F98)   
       ENDIF        
       IF _TALLY>0
          MTR_SEEK=createobject("MTR_SEEK")  
          MTR_SEEK.SHOW    
          THIS.VALUE=FLG
          THIS.REFRESH
          FLG='0'     
       ENDIF          
    ENDIF  
       THISFORM.LBLF021.CAPTION=IIF(SEEK(THIS.VALUE,'B01'),B01.F02,'')     
  ENDPROC
ENDDEFINE
***************************************************特殊輸入欄位設定-----------客戶
DEFINE CLASS TXTF06 AS TEXTBOX
  READONLY=.T.
  MAXLENGTH=5
  FONTSIZE=INT_015*9
  PROCEDURE INTERACTIVECHANGE
    IF AT('?',ALLTRIM(THIS.VALUE))<>0 
       IF AT('?',ALLTRIM(THIS.VALUE))>1             
          SELECT F02,F01,F04 FROM C01 INTO CURSOR VDR ORDER BY F02 WHERE LEFT(F02,AT('?',THIS.VALUE)-1)=LEFT(THIS.VALUE,AT('?',THIS.VALUE)-1) 
       ELSE
          SELECT F02,F01,F04 FROM C01 INTO CURSOR VDR ORDER BY F02 
       ENDIF
       IF _TALLY>0          
          VDR_SEEK=createobject("VDR_SEEK")  
          VDR_SEEK.SHOW    
          THIS.VALUE=FLG
          THIS.REFRESH
          FLG='0'        
       ENDIF   
    ELSE
       IF LEN(ALLTRIM(THIS.VALUE))=4
          SELECT F02,F01,F04 FROM C01 INTO CURSOR VDR ORDER BY F02 WHERE F02=ALLTRIM(THIS.VALUE)
          DO CASE
             CASE _TALLY=1
                  THIS.VALUE=VDR.F01
                  THIS.REFRESH
             CASE _TALLY>1
                  VDR_SEEK=createobject("VDR_SEEK")  
                  VDR_SEEK.SHOW    
                  THIS.VALUE=FLG
                  THIS.REFRESH
                  FLG='0'        
          ENDCASE      
       ENDIF    
    ENDIF      
       THISFORM.LBLF061.CAPTION=IIF(SEEK(THIS.VALUE,'C01'),C01.F04,'')  
  ENDPROC
ENDDEFINE   
