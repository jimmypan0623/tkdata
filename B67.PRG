******B67.借入還入月報表
CLOSE ALL
CLEAR 
FLG='0'
FCH=''
CHK=''
R=0
MTH_STR=''
AREA1='B67_1'
AREA2='B67_3'
IF ! USED('A01')
   SELE 0
   USE A01 INDE A01
ELSE
   SELE A01
ENDIF      
SET ORDER TO A01
IF !USED('A02')
   SELE 0
   USE A02 INDE A02
ELSE
   SELE A02
ENDIF
SET ORDER TO A021      
SEEK SYS_OPER+'B67'
IF !USED('A23')
    SELE 0
    USE A23
ELSE 
   SELE A23
ENDIF
SET ORDER TO 1     
IF !USED('B01')
   SELE 0
   USE B01 INDE B01
ELSE
   SELE B01
ENDIF
SET ORDER TO 1     
IF !USED('D01')
   SELE 0
   USE D01 INDE D01
ELSE
   SELE D01
ENDIF
SET ORDER TO D011
IF !USED('C01')
   SELE 0
   USE C01 INDE C01
ELSE
   SELE C01
ENDIF
SET ORDER TO C011
B61='B61'+LEFT(DTOS(DATE()),6)&&借入單
 IF FILE(B61+'.DBF')=.T.
       IF !USED('&B61')
          SELE 0 
          USE (B61) ALIA B61
       ELSE
          SELE B61
       ENDIF
          SET ORDER TO 1
ELSE
	CREATE CURSOR B61;
 	(F01 C(1),F02 C(1),F03 C(1),F04 N(1),F05 C(1),F06 C(1),F07 C(1),F08 C(1),F09 C(1),F10 C(1),F11 C(1),F12 C(1),F13 C(1),F14 D(1))       
ENDIF
B64='B64'+LEFT(DTOS(DATE()),6)&&還入單
IF FILE(B64+'.DBF')=.T.
       IF !USED('&B64')
          SELE 0 
          USE (B64) ALIA B64
       ELSE
          SELE B64
       ENDIF
          SET ORDER TO 1
ELSE
	CREATE CURSOR B64;
 	(F01 C(1),F02 C(1),F03 C(1),F04 N(1),F05 C(1),F06 C(1),F07 C(1),F08 C(1),F09 C(1),F10 C(1),F11 C(1),F12 C(1),F13 C(1),F14 D(1))       
ENDIF
*******************************表身
CREATE CURSOR B67_2;
(F01 C(10),F02 C(2),F03 C(43),F04 N(11),F07 C(100),F10 C(5),F14 D(8),EXP_8 B(2),F38 B(4),F08 C(10))
INDE ON F10 TAG B67_21
SELECT  B61.F01,B61.F02,B61.F03,B61.F04,B61.F07,B61.F10,B61.F14,B01.F38*B61.F04,B01.F38,B61.F08 FROM B01,B61  WHERE B01.F01=B61.F03   INTO CURSOR B671
SELECT B671
GO TOP
DO WHILE !EOF()
	SELECT B67_2
	APPEND BLANK
	REPLACE F01 WITH B671.F01
	REPLACE F02 WITH B671.F02
	REPLACE F03 WITH B671.F03
	REPLACE F04 WITH B671.F04
	REPLACE F07 WITH B671.F07
	REPLACE F10 WITH B671.F10
	REPLACE F14 WITH B671.F14
	REPLACE EXP_8 WITH B671.EXP_8
	REPLACE F38 WITH B671.F38
	SELECT B671
   	SKIP
ENDDO
SELECT B671
USE
SELECT B67_2
SET ORDER TO 1
**************************
SELECT  B64.F01,B64.F02,B64.F03,B64.F04,B64.F07,B64.F10,B01.F38*B64.F04,B01.F38,B64.F08 FROM B01,B64  WHERE B01.F01=B64.F03   INTO CURSOR B674
SELECT B674
GO TOP
DO WHILE !EOF()
	SELECT B67_2
	APPEND BLANK
	REPLACE F01 WITH B674.F01
	REPLACE F02 WITH B674.F02
	REPLACE F03 WITH B674.F03
	REPLACE F04 WITH B674.F04
	REPLACE F07 WITH B674.F07
	REPLACE F10 WITH B674.F10
	REPLACE EXP_8 WITH B674.EXP_7
	REPLACE F38 WITH B674.F38
	REPLACE F08 WITH B674.F08
	SELECT B674
   	SKIP
ENDDO
SELECT B674
USE
SELECT B67_2
SET ORDER TO 1
******************
SELECT  B67_2.*,B01.F02 FROM B67_2,B01 WHERE B67_2.F03=B01.F01  INTO CURSOR B673
SELECT  B673.*,C01.F05 FROM B673,C01 WHERE B673.F10=C01.F01 INTO CURSOR C01B
SELECT  B673.*,D01.F04 FROM B673,D01 WHERE B673.F10=D01.F01 INTO CURSOR D01B
CREATE CURSOR B67_3;
(F01 C(10),F02 C(2),F03 C(43),F04 N(11),F07 C(100),F10 C(5),F14 D(8),EXP_8 B(2),F38 B(4),F021 C(40),F54 C(10),F08 C(10),F99 C(15))
INDE ON F54+F03 TAG B67_31
SELECT C01B
BROW
GO TOP
DO WHILE !EOF()
	SELECT B67_3
	APPEND BLANK
	REPLACE F01 WITH C01B.F01
	REPLACE F02 WITH C01B.F02_A
	REPLACE F03 WITH C01B.F03
	REPLACE F04 WITH C01B.F04
	REPLACE F07 WITH C01B.F07
	REPLACE F10 WITH C01B.F10
	REPLACE F14 WITH C01B.F14
	REPLACE EXP_8 WITH C01B.EXP_8
	REPLACE F38 WITH C01B.F38
	REPLACE F021 WITH C01B.F02_B
	REPLACE F54 WITH C01B.F05
	REPLACE F08 WITH C01B.F08
	DO CASE
	       CASE LEFT(ALLTRIM(C01B.F01),2)='BX'
	   	          REPLACE F99 WITH '還入'
	       CASE LEFT(ALLTRIM(C01B.F01),2)='BU'
	       		  REPLACE F99 WITH '借入'
	ENDCASE
	SELECT C01B
   	SKIP
ENDDO
SELECT C01B
USE
SELECT B67_3
SET ORDER TO 1
SELECT D01B
GO TOP
DO WHILE !EOF()
	SELECT B67_3
	APPEND BLANK
	REPLACE F01 WITH D01B.F01
	REPLACE F02 WITH D01B.F02_A
	REPLACE F03 WITH D01B.F03
	REPLACE F04 WITH D01B.F04_A
	REPLACE F07 WITH D01B.F07
	REPLACE F10 WITH D01B.F10
	REPLACE F14 WITH D01B.F14
	REPLACE EXP_8 WITH D01B.EXP_8
	REPLACE F38 WITH D01B.F38
	REPLACE F021 WITH D01B.F02_B
	REPLACE F54 WITH D01B.F04_B
	REPLACE F08 WITH D01B.F08
	DO CASE
	       CASE LEFT(ALLTRIM(D01B.F01),2)='BX'
	   	          REPLACE F99 WITH '還入'
	       CASE LEFT(ALLTRIM(D01B.F01),2)='BU'
	       		  REPLACE F99 WITH '借入'
	ENDCASE
	SELECT D01B
   	SKIP
ENDDO
SELECT D01B
SELECT  * FROM B67_3  ORDER BY F02 INTO CURSOR B67_3
INDE ON F54+F03 TAG B67_31
GO TOP
SET ORDER TO 1
**************************表頭
CREATE CURSOR B67_1 (F54 C(10),F43 C(40))
INDE ON F54 TAG B67_11
SELECT C01.F05,C01.F04 FROM B67_3,C01 WHERE  B67_3.F10=C01.F01 INTO CURSOR B67C
SELECT B67C
GO TOP
DO WHILE !EOF()
	SELECT B67_1
	APPEND BLANK
	REPLACE F54 WITH B67C.F05
	REPLACE F43 WITH B67C.F04
	SELECT B67C
   	SKIP
ENDDO
SELECT B67C
USE
SELECT D01.F04,D01.F03 FROM B67_3,D01 WHERE  B67_3.F10=D01.F01 INTO CURSOR B67D
SELECT B67D
GO TOP
DO WHILE !EOF()
	SELECT B67_1
	APPEND BLANK
	REPLACE F54 WITH B67D.F04
	REPLACE F43 WITH B67D.F03
	SELECT B67D
   	SKIP
ENDDO
SELECT B67D
USE
SELECT B67_1
SELECT  DISTINCT F54,F43 FROM  B67_1   INTO CURSOR B67_1
INDE ON F54 TAG B67_11
SELECT B67_1
GO TOP
SET ORDER TO 1
**************************
B67FORM=CREATEOBJECT("TKB67")
B67FORM.SHOW  
DEFINE CLASS TKB67 AS FORM
  CAPTION='B67.借入還入月報表'
*!*	  AUTOCENTER=.T.
  CONTROLBOX=.F.
  BORDERSTYLE=1  
  MAXBUTTON=.F.
  MINBUTTON=.F.
  MOVABLE=.F.
  CLOSABLE=.F.
  CONTROLCOUNT=57
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*550
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WIDTH=INT_015*789
  WINDOWTYPE=1
  NAME='TKB67'
  ADD OBJECT SHAPE1 AS SHAPE1 WITH;
      AUTOCENTER=.T.
  ADD OBJECT LBL_REC AS LBL_REC WITH;
      AUTOCENTER =.T.
  ADD OBJECT SHAPE2 AS SHAPE2 WITH;
      AUTOCENTER=.T.
  ADD OBJECT SHAPE3 AS SHAPE3 WITH;
      AUTOCENTER=.T.
  ADD OBJECT PAGEFRAME1 AS PAGEFRAME WITH;
      LEFT=INT_015*236,;
      WIDTH=INT_015*540,;
      HEIGHT=INT_015*200,;
      FONTSIZE=INT_015*9,;
      PAGECOUNT=2,;
      TABSTRETCH=1,;
      ACTIVEPAGE=1,;
      VISIBLE=.T.,;
      PAGE1.NAME='PAGE1',;
      PAGE1.VISIBLE=.T.,;
      PAGE1.CAPTION='表頭資料',;
      PAGE2.NAME='PAGE2',;
      PAGE2.VISIBLE=.T.,;
      PAGE2.CAPTION='表身詳細資料內容'   
  ADD OBJECT KEY_LIST AS KEY_LIST WITH;
      AUTOCENTER=.T.,;
      WIDTH=INT_015*130
  ADD OBJECT MTH_LIST AS MTH_LIST WITH;
      AUTOCENTER=.T.
  ADD OBJECT GRID1 AS GRID1 WITH;
      COLUMNCOUNT=1,;            
      RECORDSOURCE='B67_1',;      
      COLUMN1.NAME='COLUMN1'
  ADD OBJECT GRID2 AS GRID2 WITH;
      COLUMNCOUNT=9,;            
      RECORDSOURCE='B67_3',; 
      LINKMASTER='B67_1',;
      RELATIONALEXPR='F54',;
      CHILDORDER='B67_31',;  
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;
      COLUMN3.NAME='COLUMN3',;
      COLUMN4.NAME='COLUMN4',;
      COLUMN5.NAME='COLUMN5',;
      COLUMN6.NAME='COLUMN6',;
      COLUMN7.NAME='COLUMN7',;
      COLUMN8.NAME='COLUMN8',;
      COLUMN9.NAME='COLUMN9'
 ADD OBJECT CMDGROUP AS CMDGROUP WITH;
      TOP=INT_015*415,;
      LEFT=INT_015*10,;
      ENABLED=.T.,;
      VISIBLE=.T.  
  ADD OBJECT ORPGROUP AS ORPGROUP WITH;
      TOP=INT_015*455,;
      LEFT=INT_015*10  
 ADD OBJECT PNT_MTH AS COMMANDBUTTON WITH;
      TOP=INT_015*460,;
      LEFT=INT_015*55,;
      HEIGHT=INT_015*25,; 
      WIDTH=INT_015*83,;
      CAPTION='\<M.本月份列印',;   
      NAME='PNT_MTH'
***************************PAGEFRAME1.PAGE1
PROCEDURE PAGEFRAME1.PAGE1.INIT   
     THIS.ADDOBJECT('LBLF43','LABEL')
     WITH THIS.LBLF43
          .VISIBLE=.T.
          .LEFT=INT_015*14
          .TOP=INT_015*27
          .WIDTH=INT_015*50
          .CAPTION='公司名稱'          
     ENDWITH
     THIS.ADDOBJECT('TXTF43','TEXTBOX')     
     WITH THIS.TXTF43
          .VISIBLE=.T.
          .LEFT=INT_015*64
          .TOP=INT_015*23
          .WIDTH=INT_015*180
          .HEIGHT=INT_015*25
          .MAXLENGTH=40
     ENDWITH
***********************PAGEFRAME1.PAGE2                  
PROCEDURE PAGEFRAME1.PAGE2.INIT
     THIS.ADDOBJECT('LBLF02','LABEL')
     WITH THIS.LBLF02
          .VISIBLE=.T.
          .LEFT=INT_015*14
          .TOP=INT_015*13
          .WIDTH=INT_015*50
          .CAPTION='日        期'          
     ENDWITH
THIS.ADDOBJECT('TXTF02','TEXTBOX')          
     WITH THIS.TXTF02
          .VISIBLE=.T.
          .LEFT=INT_015*65
          .TOP=INT_015*9
          .WIDTH=INT_015*50
          .HEIGHT=INT_015*25
          .MAXLENGTH=8
ENDWITH        
THIS.ADDOBJECT('LBLF01','LABEL')
     WITH THIS.LBLF01
         .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*45
         .WIDTH=INT_015*60
         .CAPTION='單據編號'
ENDWITH
THIS.ADDOBJECT('LBLF011','LABEL')     
     WITH THIS.LBLF011
          .VISIBLE=.T.
          .LEFT=INT_015*166
          .TOP=INT_015*45
          .AUTOSIZE=.T.
ENDWITH
THIS.ADDOBJECT('TXTF01','TEXTBOX')          
     WITH THIS.TXTF01
          .VISIBLE=.T.
          .LEFT=INT_015*65
          .TOP=INT_015*41
          .WIDTH=INT_015*100
          .HEIGHT=INT_015*25
          .MAXLENGTH=10
ENDWITH    
THIS.ADDOBJECT('LBLF03','LABEL')     
     WITH THIS.LBLF03
          .VISIBLE=.T.
          .LEFT=INT_015*14
          .TOP=INT_015*77
          .WIDTH=INT_015*50  
          .CAPTION='品        號'
ENDWITH            
THIS.ADDOBJECT('LBLF031','LABEL')     
     WITH THIS.LBLF031
          .VISIBLE=.T.
          .LEFT=INT_015*337
          .TOP=INT_015*77
          .AUTOSIZE=.T.
ENDWITH
THIS.ADDOBJECT('TXTF03','TEXTBOX')          
     WITH THIS.TXTF03
          .VISIBLE=.T.
          .LEFT=INT_015*65
          .TOP=INT_015*73
          .WIDTH=INT_015*261
          .HEIGHT=INT_015*25
          .MAXLENGTH=43
ENDWITH                              
THIS.ADDOBJECT('LBLF04','LABEL')
     WITH THIS.LBLF04
         .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*109
         .WIDTH=INT_015*50
         .CAPTION='數        量'
ENDWITH
THIS.ADDOBJECT('TXTF04','TEXTBOX')          
     WITH THIS.TXTF04
          .VISIBLE=.T.
          .LEFT=INT_015*65
          .TOP=INT_015*105
          .WIDTH=INT_015*70
          .HEIGHT=INT_015*25
          .MAXLENGTH=15
ENDWITH 
THIS.ADDOBJECT('LBLF38','LABEL')
     WITH THIS.LBLF38
         .VISIBLE=.F.
         .LEFT=INT_015*14
         .TOP=INT_015*141
         .WIDTH=INT_015*50
         .CAPTION='單        價'
ENDWITH
THIS.ADDOBJECT('TXTF38','TEXTBOX')          
     WITH THIS.TXTF38
          .VISIBLE=.F.
          .LEFT=INT_015*65
          .TOP=INT_015*137
          .WIDTH=INT_015*70
          .HEIGHT=INT_015*25
          .MAXLENGTH=15
ENDWITH 
 THIS.ADDOBJECT('LBLFEXP8','LABEL')
     WITH THIS.LBLFEXP8
         .VISIBLE=.F.
         .LEFT=INT_015*338
         .TOP=INT_015*13
         .WIDTH=INT_015*50
         .CAPTION='小        計'
ENDWITH
THIS.ADDOBJECT('TXTFEXP8','TEXTBOX')          
     WITH THIS.TXTFEXP8
          .VISIBLE=.F.
          .LEFT=INT_015*389
          .TOP=INT_015*9
          .WIDTH=INT_015*100
          .HEIGHT=INT_015*25
          .MAXLENGTH=20
ENDWITH           
THIS.ADDOBJECT('LBLF14','LABEL')
     WITH THIS.LBLF14
         .VISIBLE=.T.
         .LEFT=INT_015*338
         .TOP=INT_015*45
         .WIDTH=INT_015*50
         .CAPTION='歸還日期'
ENDWITH
THIS.ADDOBJECT('LBLF141','LABEL')
     WITH THIS.LBLF141
         .VISIBLE=.F.
         .LEFT=INT_015*338
         .TOP=INT_015*45
         .WIDTH=INT_015*50
         .CAPTION='借入單號'
ENDWITH
THIS.ADDOBJECT('LBLF142','LABEL')
     WITH THIS.LBLF142
         .VISIBLE=.F.
         .LEFT=INT_015*338
         .TOP=INT_015*45
         .WIDTH=INT_015*50
         .CAPTION='借出單號'
ENDWITH
THIS.ADDOBJECT('TXTF14','TEXTBOX')          
     WITH THIS.TXTF14
          .VISIBLE=.T.
          .LEFT=INT_015*389
          .TOP=INT_015*41
          .WIDTH=INT_015*100
          .HEIGHT=INT_015*25
          .MAXLENGTH=10
ENDWITH
THIS.ADDOBJECT('LBLF07','LABEL')
     WITH THIS.LBLF07
         .VISIBLE=.T.
         .LEFT=INT_015*338
         .TOP=INT_015*109
         .WIDTH=INT_015*50
         .CAPTION='備        註'
ENDWITH
THIS.ADDOBJECT('TXTF07','TEXTBOX')          
     WITH THIS.TXTF07
          .VISIBLE=.T.
          .LEFT=INT_015*389
          .TOP=INT_015*105
          .WIDTH=INT_015*120
          .HEIGHT=INT_015*25
          .MAXLENGTH=100    
ENDWITH
THIS.ADDOBJECT('LBLF98','LABEL')
     WITH THIS.LBLF98
         .VISIBLE=.T.
         .LEFT=INT_015*338
         .TOP=INT_015*141
         .WIDTH=INT_015*50
         .CAPTION='說        明'
ENDWITH
THIS.ADDOBJECT('TXTF98','TEXTBOX')          
     WITH THIS.TXTF98
          .VISIBLE=.T.
          .LEFT=INT_015*389
          .TOP=INT_015*137
          .WIDTH=INT_015*120
          .HEIGHT=INT_015*25
          .MAXLENGTH=20    
ENDWIT
ENDPROC
******************設定PAGE1之動態動作******************        
  PROCEDURE PAGEFRAME1.PAGE1.ACTIVATE
    R=0
     THISFORM.GRID1.ENABLED=.T.          
     THISFORM.GRID1.SETFOCUS     
     IF THISFORM.GRID1.ACTIVEROW=0
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
        THISFORM.PAGEFRAME1.PAGE1.TXTF43.VALUE=''
     ELSE
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.
     ENDIF
     THISFORM.KEY_LIST.ENABLED=.T.
     THISFORM.MTH_LIST.ENABLED=.T.    
       ENDPROC
*****************設定PAGE2之動態動作****************** 
 PROCEDURE PAGEFRAME1.PAGE2.ACTIVATE
     SELE B67_3
     THISFORM.GRID2.ENABLED=.T.
     THISFORM.GRID2.SETFOCUS 
     IF IIF(SEEK(SYS_OPER,'A01'),A01.F04,'')='P000'
      	  THISFORM.PAGEFRAME1.PAGE2.LBLF38.VISIBLE=.T.
      	  THISFORM.PAGEFRAME1.PAGE2.TXTF38.VISIBLE=.T.
      	  THISFORM.PAGEFRAME1.PAGE2.LBLFEXP8.VISIBLE=.T.
      	  THISFORM.PAGEFRAME1.PAGE2.TXTFEXP8.VISIBLE=.T.
     ENDIF 	  	
     IF THISFORM.GRID2.ACTIVEROW=0 
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
        THISFORM.PAGEFRAME1.PAGE2.SETALL('VALUE','','TEXTBOX')
    ELSE
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.  
     ENDIF   
     R=RECNO('&AREA1')
     THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(RECNO('&AREA1')=R,RGB(255,255,0),'')","COLUMN")
     THISFORM.GRID1.ENABLED=.F.     
     THISFORM.KEY_LIST.ENABLED=.F.
     THISFORM.MTH_LIST.ENABLED=.F.     
      FCH=THISFORM.ACTIVECONTROL.NAME
       JK='品        號'
       CHK=B67_3.F54
  ENDPROC 
 ****************************************
  PROC INIT       
       THISFORM.SETALL('HEIGHT',INT_015*25,'TEXTBOX')
       THISFORM.SETALL('HEIGHT',INT_015*17,'LABEL')
       THISFORM.SETALL('FONTSIZE',INT_015*9,'TEXTBOX')
       THISFORM.SETALL('FONTSIZE',INT_015*9,'LABEL')       
       THISFORM.SETALL('READONLY',.T.,'TEXTBOX')
       THISFORM.ORPGROUP.NEW_BOTT.VISIBLE=.F.
       THISFORM.ORPGROUP.EDIT_BOTT.VISIBLE=.F.
       THISFORM.ORPGROUP.DEL_BOTT.VISIBLE=.F. 
       THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限    
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'COLUMN')
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'HEADER')        
       THISFORM.GRID1.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)
       THISFORM.GRID2.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)  
       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='公司簡稱'
       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='B67_1.F54'
       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*60
       THISFORM.GRID2.SETALL('FONTSIZE',INT_015*9,'COLUMN')
       THISFORM.GRID2.SETALL('FONTSIZE',INT_015*9,'HEADER')
   IF IIF(SEEK(SYS_OPER,'A01'),A01.F04,'')='P000'      
       THISFORM.GRID2.COLUMN1.HEADER1.CAPTION='品號'  
       THISFORM.GRID2.COLUMN2.HEADER1.CAPTION='日期'
       THISFORM.GRID2.COLUMN3.HEADER1.CAPTION='單據編號'
       THISFORM.GRID2.COLUMN4.HEADER1.CAPTION='數        量'
       THISFORM.GRID2.COLUMN5.HEADER1.CAPTION='單        價'
       THISFORM.GRID2.COLUMN6.HEADER1.CAPTION='小        計'
       THISFORM.GRID2.COLUMN7.HEADER1.CAPTION='歸還日期'
       THISFORM.GRID2.COLUMN8.HEADER1.CAPTION='借出(入)單號'
       THISFORM.GRID2.COLUMN9.HEADER1.CAPTION='備        註'
	   THISFORM.GRID2.COLUMN1.CONTROLSOURCE='B67_3.F03'
	   THISFORM.GRID2.COLUMN2.CONTROLSOURCE='B67_3.F02'
	   THISFORM.GRID2.COLUMN3.CONTROLSOURCE='B67_3.F01'
	   THISFORM.GRID2.COLUMN4.CONTROLSOURCE='B67_3.F04'
	   THISFORM.GRID2.COLUMN5.CONTROLSOURCE='B67_3.F38'
	   THISFORM.GRID2.COLUMN6.CONTROLSOURCE='B67_3.EXP_8'
	   THISFORM.GRID2.COLUMN7.CONTROLSOURCE='B67_3.F14'
	   THISFORM.GRID2.COLUMN8.CONTROLSOURCE='B67_3.F08'
           THISFORM.GRID2.COLUMN9.CONTROLSOURCE='B67_3.F07'
       THISFORM.GRID2.COLUMN1.WIDTH=INT_015*110
       THISFORM.GRID2.COLUMN2.WIDTH=INT_015*30
       THISFORM.GRID2.COLUMN3.WIDTH=INT_015*80
       THISFORM.GRID2.COLUMN4.WIDTH=INT_015*60
       THISFORM.GRID2.COLUMN5.WIDTH=INT_015*70
        THISFORM.GRID2.COLUMN6.WIDTH=INT_015*90
       THISFORM.GRID2.COLUMN7.WIDTH=INT_015*60
       THISFORM.GRID2.COLUMN8.WIDTH=INT_015*80
       THISFORM.GRID2.COLUMN9.WIDTH=INT_015*100
     ELSE
       THISFORM.GRID2.COLUMN1.HEADER1.CAPTION='品號'  
       THISFORM.GRID2.COLUMN2.HEADER1.CAPTION='日期'
       THISFORM.GRID2.COLUMN3.HEADER1.CAPTION='單據編號'
       THISFORM.GRID2.COLUMN4.HEADER1.CAPTION='數        量'
       THISFORM.GRID2.COLUMN5.HEADER1.CAPTION='歸還日期'
       THISFORM.GRID2.COLUMN6.HEADER1.CAPTION='借出(入)單號'
       THISFORM.GRID2.COLUMN7.HEADER1.CAPTION='備        註'
       THISFORM.GRID2.COLUMN8.HEADER1.CAPTION=''
       THISFORM.GRID2.COLUMN9.HEADER1.CAPTION=''
	   THISFORM.GRID2.COLUMN1.CONTROLSOURCE='B67_3.F03'
	   THISFORM.GRID2.COLUMN2.CONTROLSOURCE='B67_3.F02'
	   THISFORM.GRID2.COLUMN3.CONTROLSOURCE='B67_3.F01'
	   THISFORM.GRID2.COLUMN4.CONTROLSOURCE='B67_3.F04'
	   THISFORM.GRID2.COLUMN5.CONTROLSOURCE='B67_3.F14'
	   THISFORM.GRID2.COLUMN6.CONTROLSOURCE='B67_3.F08'
           THISFORM.GRID2.COLUMN7.CONTROLSOURCE='B67_3.F07'
           THISFORM.GRID2.COLUMN8.CONTROLSOURCE=''
           THISFORM.GRID2.COLUMN9.CONTROLSOURCE=''
       THISFORM.GRID2.COLUMN1.WIDTH=INT_015*110
       THISFORM.GRID2.COLUMN2.WIDTH=INT_015*30
       THISFORM.GRID2.COLUMN3.WIDTH=INT_015*80
       THISFORM.GRID2.COLUMN4.WIDTH=INT_015*90
       THISFORM.GRID2.COLUMN5.WIDTH=INT_015*60
       THISFORM.GRID2.COLUMN6.WIDTH=INT_015*80
       THISFORM.GRID2.COLUMN7.WIDTH=INT_015*100
       THISFORM.GRID2.COLUMN8.WIDTH=INT_015*10
       THISFORM.GRID2.COLUMN9.WIDTH=INT_015*10
     ENDIF  
       THISFORM.GRID1.READONLY=.T.      
       THISFORM.GRID2.READONLY=.T.            
       THISFORM.GRID1.SETFOCUS
        IF THISFORM.GRID1.ACTIVEROW=0
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
       ELSE
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.      
       ENDIF          
       THISFORM.KEY_LIST.DISPLAYVALUE='依公司簡稱排列'       
       JK='公司簡稱'
       SELE B67_1
       GO TOP
       THISFORM.PAGEFRAME1.PAGE1.TXTF43.VALUE=B67_1.F43
  ENDPROC            
***************GRID1動態改變*********
 PROC GRID1.AFTERROWCOLCHANGE
       LPARAMETERS NCOLINDEX 
       THISFORM.PAGEFRAME1.PAGE1.TXTF43.VALUE=B67_1.F43
        FCH=THISFORM.ACTIVECONTROL.NAME
       JK=THIS.COLUMN1.HEADER1.CAPTION
       IF THIS.ACTIVEROW=0
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
       ELSE
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.
       ENDIF   
       CHK=''
       THISFORM.REFRESH
  ENDPROC     
***************GRID2動態改變*************** 
PROC GRID2.AFTERROWCOLCHANGE
      LPARAMETERS NCOLINDEX
       THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE=THISFORM.MTH_LIST.DISPLAYVALUE+'/'+B67_3.F02
       THISFORM.PAGEFRAME1.PAGE2.TXTF01.VALUE=B67_3.F01
       THISFORM.PAGEFRAME1.PAGE2.LBLF011.CAPTION=BILL(LEFT(ALLTRIM(B67_3.F01),2))
       THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=B67_3.F03
       THISFORM.PAGEFRAME1.PAGE2.LBLF031.CAPTION=B67_3.F021
       THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE=B67_3.F04
       THISFORM.PAGEFRAME1.PAGE2.TXTF38.VALUE=B67_3.F38
       THISFORM.PAGEFRAME1.PAGE2.TXTFEXP8.VALUE=B67_3.EXP_8
       THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE=B67_3.F07
      IF EMPTY(B67_3.F08)
       	   THISFORM.PAGEFRAME1.PAGE2.LBLF141.VISIBLE=.F.
       	   THISFORM.PAGEFRAME1.PAGE2.LBLF142.VISIBLE=.F.
       	   THISFORM.PAGEFRAME1.PAGE2.LBLF14.VISIBLE=.T.
       	   THISFORM.PAGEFRAME1.PAGE2.TXTF14.VALUE=DTOC(B67_3.F14)
      ELSE
      	   IF LEFT(ALLTRIM(B67_3.F01),2)='BV'
      	       THISFORM.PAGEFRAME1.PAGE2.LBLF14.VISIBLE=.F.
      	       THISFORM.PAGEFRAME1.PAGE2.LBLF142.VISIBLE=.F.
      	       THISFORM.PAGEFRAME1.PAGE2.LBLF141.VISIBLE=.T.
       	       THISFORM.PAGEFRAME1.PAGE2.TXTF14.VALUE=B67_3.F08
       	  ELSE
       	       THISFORM.PAGEFRAME1.PAGE2.LBLF14.VISIBLE=.F.
      	       THISFORM.PAGEFRAME1.PAGE2.LBLF141.VISIBLE=.F.
      	       THISFORM.PAGEFRAME1.PAGE2.LBLF142.VISIBLE=.T.
       	       THISFORM.PAGEFRAME1.PAGE2.TXTF14.VALUE=B67_3.F08
       	  ENDIF
      ENDIF 
      DO CASE
      	     CASE  LEFT(ALLTRIM(B67_3.F01),2)='BU'
      	     		THISFORM.PAGEFRAME1.PAGE2.TXTF98.VALUE='從'+ALLTRIM(B67_1.F54)+'借入'
      	     		RETURN
             CASE  LEFT(ALLTRIM(B67_3.F01),2)='BX'
       	     		THISFORM.PAGEFRAME1.PAGE2.TXTF98.VALUE=ALLTRIM(B67_1.F54)+'還入'
      	     		RETURN	 		
       ENDCASE
       IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
          THISFORM. CMDGROUP.SEEK_BOTT.ENABLED=.F.
       ENDIF   
  ENDPROC 
**************************************            
 PROC KEY_LIST.INIT 
       WITH THIS 
           .ADDITEM('依公司簡稱排列')
       ENDWITH      
  ENDPROC 
****************************  
  PROC KEY_LIST.INTERACTIVECHANGE                 
       SELE B67_1 
       SET ORDER TO B67_11
               THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='公司簡稱'
               THISFORM.GRID1.COLUMN1.CONTROLSOURCE='B67_1.F54'
               THISFORM.GRID1.COLUMN1.WIDTH=INT_015*60                                             
       THISFORM.GRID1.SETFOCUS
  ENDPROC  
**************************
PROC MTH_LIST.INIT        
       WITH THIS
            SELECT * FROM A23 WHERE F01>CTOD('91/10/01') INTO CURSOR A231
            GO TOP
            K=0
            S=0
            DO WHILE !EOF()                
               K=K+1
		.ADDITEM(LEFT(DTOC(A231.F01),5))
            IF LEFT(DTOC(DATE()),5)=LEFT(DTOC(A231.F01),5)
                  S=K
               ENDIF       
               SKIP
            ENDDO   
            .VALUE=S
       ENDWITH
       MTH_STR=THIS.DISPLAYVALUE   
  ENDPROC 
 **************************       
  PROC MTH_LIST.INTERACTIVECHANGE
       THISFORM.GRID1.RECORDSOURCE=''
       THISFORM.GRID2.RECORDSOURCE=''
       THISFORM.GRID2.LINKMASTER=''
       THISFORM.GRID2.RELATIONALEXPR=''
       THISFORM.GRID2.CHILDORDER=''
       CLOSE ALL
       SET EXCL OFF  
IF ! USED('A01')
   SELE 0
   USE A01 INDE A01
ELSE
   SELE A01
ENDIF      
SET ORDER TO A01       
B61='B61'+LEFT(DTOS(CTOD(THIS.DISPLAYVALUE+'/01')),6)&&借入單
IF FILE(B61+'.DBF')=.T.
       IF !USED('&B61')
             SELE 0 
             USE (B61) ALIA B61
       ELSE
       	      SELE B61 
       ENDIF
       SET ORDER TO 1 
 ELSE
 	CREATE CURSOR B61;
 	(F01 C(1),F02 C(1),F03 C(1),F04 N(1),F05 C(1),F06 C(1),F07 C(1),F08 C(1),F09 C(1),F10 C(1),F11 C(1),F12 C(1),F13 C(1),F14 D(1))  
 ENDIF
B64='B64'+LEFT(DTOS(CTOD(THIS.DISPLAYVALUE+'/01')),6)&&還入單
 IF FILE(B64+'.DBF')=.T.
       IF !USED('&B64')
          SELE 0
          USE (B64) ALIA B64
       ELSE
          SELE B64
       ENDIF
       SET ORDER TO 1
 ELSE
 	CREATE CURSOR B64;
 	(F01 C(1),F02 C(1),F03 C(1),F04 N(1),F05 C(1),F06 C(1),F07 C(1),F08 C(1),F09 C(1),F10 C(1),F11 C(1),F12 C(1),F13 C(1))  
 ENDIF 
 CREATE CURSOR B67_2;
(F01 C(10),F02 C(2),F03 C(43),F04 N(11),F07 C(20),F10 C(5),F14 D(8),EXP_8 B(2),F38 B(4),F08 C(10))
INDE ON F10 TAG B67_21
**********************
SELECT  B61.F01,B61.F02,B61.F03,B61.F04,B61.F07,B61.F10,B61.F14,B01.F38*B61.F04,B01.F38,B61.F08 FROM B01,B61  WHERE B01.F01=B61.F03   INTO CURSOR B671
SELECT B671
GO TOP
DO WHILE !EOF()
	SELECT B67_2
	APPEND BLANK
	REPLACE F01 WITH B671.F01
	REPLACE F02 WITH B671.F02
	REPLACE F03 WITH B671.F03
	REPLACE F04 WITH B671.F04
	REPLACE F07 WITH B671.F07
	REPLACE F10 WITH B671.F10
	REPLACE F14 WITH B671.F14
	REPLACE EXP_8 WITH B671.EXP_8
	REPLACE F38 WITH B671.F38
	SELECT B671
   	SKIP
ENDDO
SELECT B671
USE
SELECT B67_2
SET ORDER TO 1
**************************
SELECT  B64.F01,B64.F02,B64.F03,B64.F04,B64.F07,B64.F10,B01.F38*B64.F04,B01.F38,B64.F08 FROM B01,B64  WHERE B01.F01=B64.F03   INTO CURSOR B674
SELECT B674
GO TOP
DO WHILE !EOF()
	SELECT B67_2
	APPEND BLANK
	REPLACE F01 WITH B674.F01
	REPLACE F02 WITH B674.F02
	REPLACE F03 WITH B674.F03
	REPLACE F04 WITH B674.F04
	REPLACE F07 WITH B674.F07
	REPLACE F10 WITH B674.F10
	REPLACE EXP_8 WITH B674.EXP_7
	REPLACE F38 WITH B674.F38
	REPLACE F08 WITH B674.F08
	SELECT B674
   	SKIP
ENDDO
SELECT B674
USE
SELECT B67_2
SET ORDER TO 1
******************
SELECT  B67_2.*,B01.F02 FROM B67_2,B01 WHERE B67_2.F03=B01.F01  INTO CURSOR B673
SELECT  B673.*,C01.F05 FROM B673,C01 WHERE B673.F10=C01.F01 INTO CURSOR C01B
SELECT  B673.*,D01.F04 FROM B673,D01 WHERE B673.F10=D01.F01 INTO CURSOR D01B
 CREATE CURSOR B67_3;
(F01 C(10),F02 C(2),F03 C(43),F04 N(11),F07 C(20),F10 C(5),F14 D(8),EXP_8 B(2),F38 B(4),F021 C(40),F54 C(10),F08 C(10),F99 C(15))
INDE ON F54+F03 TAG B67_31
SELECT C01B
GO TOP
DO WHILE !EOF()
	SELECT B67_3
	APPEND BLANK
	REPLACE F01 WITH C01B.F01
	REPLACE F02 WITH C01B.F02_A
	REPLACE F03 WITH C01B.F03
        REPLACE F04 WITH C01B.F04
	REPLACE F07 WITH C01B.F07
	REPLACE F10 WITH C01B.F10
	REPLACE F14 WITH C01B.F14
	REPLACE EXP_8 WITH C01B.EXP_8
	REPLACE F38 WITH C01B.F38
	REPLACE F021 WITH C01B.F02_B
	REPLACE F54 WITH C01B.F05
	REPLACE F08 WITH C01B.F08
	DO CASE
	       CASE LEFT(ALLTRIM(C01B.F01),2)='BX'
	   	          REPLACE F99 WITH '還入'
	       CASE LEFT(ALLTRIM(C01B.F01),2)='BU'
	       		  REPLACE F99 WITH '借入'
	ENDCASE
	SELECT C01B
   	SKIP
ENDDO
SELECT C01B
USE
SELECT B67_3
SET ORDER TO 1
SELECT D01B
GO TOP
DO WHILE !EOF()
	SELECT B67_3
	APPEND BLANK
	REPLACE F01 WITH D01B.F01
	REPLACE F02 WITH D01B.F02_A
	REPLACE F03 WITH D01B.F03
	REPLACE F04 WITH D01B.F04_A
	REPLACE F07 WITH D01B.F07
	REPLACE F10 WITH D01B.F10
	REPLACE F14 WITH D01B.F14
	REPLACE EXP_8 WITH D01B.EXP_8
	REPLACE F38 WITH D01B.F38
	REPLACE F021 WITH D01B.F02_B
	REPLACE F54 WITH D01B.F04_B
	REPLACE F08 WITH D01B.F08
	DO CASE
	       CASE LEFT(ALLTRIM(D01B.F01),2)='BX'
	   	          REPLACE F99 WITH '還入'
	       CASE LEFT(ALLTRIM(D01B.F01),2)='BU'
	       		  REPLACE F99 WITH '借入'
	ENDCASE
	SELECT D01B
   	SKIP
ENDDO
SELECT D01B
SELECT  * FROM B67_3  ORDER BY F02 INTO CURSOR B67_3
INDE ON F54+F03 TAG B67_31
GO TOP
SET ORDER TO 1
**************************表頭
CREATE CURSOR B67_1 (F54 C(10),F43 C(40))
INDE ON F54 TAG B67_11
SELECT C01.F05,C01.F04 FROM B67_3,C01 WHERE  B67_3.F10=C01.F01 INTO CURSOR B67C
SELECT B67C
GO TOP
DO WHILE !EOF()
	SELECT B67_1
	APPEND BLANK
	REPLACE F54 WITH B67C.F05
	REPLACE F43 WITH B67C.F04
	SELECT B67C
   	SKIP
ENDDO
SELECT B67C
USE
SELECT D01.F04,D01.F03 FROM B67_3,D01 WHERE  B67_3.F10=D01.F01 INTO CURSOR B67D
SELECT B67D
GO TOP
DO WHILE !EOF()
	SELECT B67_1
	APPEND BLANK
	REPLACE F54 WITH B67D.F04
	REPLACE F43 WITH B67D.F03
	SELECT B67D
   	SKIP
ENDDO
SELECT B67D
USE
SELECT B67_1
SELECT  DISTINCT F54,F43 FROM  B67_1   INTO CURSOR B67_1
INDE ON F54 TAG B67_11
SELECT B67_1
GO TOP
SET ORDER TO 1
********************
       THISFORM.GRID1.RECORDSOURCE='B67_1'
       THISFORM.GRID2.RECORDSOURCE='B67_3'
       THISFORM.GRID2.LINKMASTER='B67_1'
       THISFORM.GRID2.RELATIONALEXPR='F54'      
       THISFORM.GRID2.CHILDORDER='B67_31'  
       IF IIF(SEEK(SYS_OPER,'A01'),A01.F04,'')='P000'     
           THISFORM.GRID2.COLUMN1.CONTROLSOURCE='B67_3.F03'
	   THISFORM.GRID2.COLUMN2.CONTROLSOURCE='B67_3.F02'
	   THISFORM.GRID2.COLUMN3.CONTROLSOURCE='B67_3.F01'
	   THISFORM.GRID2.COLUMN4.CONTROLSOURCE='B67_3.F04'
	   THISFORM.GRID2.COLUMN5.CONTROLSOURCE='B67_3.F38'
	   THISFORM.GRID2.COLUMN6.CONTROLSOURCE='B67_3.EXP_8'
	   THISFORM.GRID2.COLUMN7.CONTROLSOURCE='B67_3.F14'
	   THISFORM.GRID2.COLUMN8.CONTROLSOURCE='B67_3.F08' 
           THISFORM.GRID2.COLUMN9.CONTROLSOURCE='B67_3.F07'
        ELSE
           THISFORM.GRID2.COLUMN1.CONTROLSOURCE='B67_3.F03'
	   THISFORM.GRID2.COLUMN2.CONTROLSOURCE='B67_3.F02'
	   THISFORM.GRID2.COLUMN3.CONTROLSOURCE='B67_3.F01'
	   THISFORM.GRID2.COLUMN4.CONTROLSOURCE='B67_3.F04'
	   THISFORM.GRID2.COLUMN5.CONTROLSOURCE='B67_3.F14'
	   THISFORM.GRID2.COLUMN6.CONTROLSOURCE='B67_3.F08' 
           THISFORM.GRID2.COLUMN7.CONTROLSOURCE='B67_3.F07'
           THISFORM.GRID2.COLUMN8.CONTROLSOURCE=''
	   THISFORM.GRID2.COLUMN9.CONTROLSOURCE=''     
	ENDIF   
       THISFORM.KEY_LIST.INTERACTIVECHANGE
	   THISFORM.PAGEFRAME1.ACTIVEPAGE=1
	   THISFORM.REFRESH
	   THISFORM.GRID1.SETFOCUS        
       IF THISFORM.GRID1.ACTIVEROW=0
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
       ELSE
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.      
       ENDIF 
       MTH_STR=THIS.DISPLAYVALUE
 ENDPROC
 *************************************************************列印
 PROCEDURE PNT_MTH.CLICK
 	SELECT * FROM B67_3 ORDER BY F54 INTO CURSOR B67
 	REPORT FORM ALLTRIM(INT_116)+'B67_B' TO PRINT PROMPT PREVIEW
  	 CLEAR
 ENDPROC       
 ENDDEFINE  
  *************************************************************列印
PROCEDURE PNT_PRC  
	PO_NO=B67_1.F54
	PO_NAME=B67_1.F43
	SELECT * FROM B67_3 WHERE F54=PO_NO INTO CURSOR B67
   	REPORT FORM ALLTRIM(INT_116)+'B67_A' TO PRINT PROMPT PREVIEW
     CLEAR     
ENDPROC   
************************
FUNC BILL
     PARA JUK
     JO=''
     DO CASE
        CASE JUK='BU'
             JO='借入單'
        CASE JUK='BX'
             JO='借出還入單'
     ENDCASE
RETURN JO 