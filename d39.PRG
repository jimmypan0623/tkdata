***程式名稱:D39.廠商樣品入貨單
CLOSE ALL
CLEAR 
FLG='0'
FCH=''
CHK=''
CHK_STR=''
R=0
QTY=0
TQTY=0
HD1='D039 '
HD2='DB'
HD3='樣品進貨單'
AREA1='D39_1'
AREA2='D39'
IF !USED('A09')
   SELE 0
   USE A09
ELSE
   SELE A09
ENDIF
SET ORDER TO 1
IF !USED('A23')
    SELE 0
    USE A23
ELSE 
   SELE A23
ENDIF
SET ORDER TO 1         
A24='A24'+LEFT(DTOS(DATE()),6)     &&單號暫存檔
IF !USED('&A24')
   SELE 0
   USE (A24) ALIA A24
ELSE
   SELE A24
ENDIF
SET ORDER TO 1      
B25='B25'+LEFT(DTOS(DATE()),6)    &&部門別月報表
IF !USED('&B25')
   SELE 0
   USE (B25) ALIA B25
ELSE
   SELE B25
ENDIF
SET ORDER TO 1      
B26='B26'+LEFT(DTOS(DATE()),6)   &&庫存異動記錄
IF !USED('&B26')
   SELE 0
   USE (B26) ALIA B26
ELSE
   SELE B26
ENDIF
SET ORDER TO 1      
B39='B39'+LEFT(DTOS(DATE()),6)   &&未過帳單據查詢檔
IF !USED('&B39')
   SELE 0
   USE (B39) ALIA B39
ELSE
   SELE B39
ENDIF
SET ORDER TO 1      
SELE A23
SET ORDER TO 1
SEEK LEFT(DTOS(DATE()),6)+'01'
IF ! USED('A01')
   SELE 0
   USE A01 INDE A01
ELSE
   SELE A01
ENDIF      
SET ORDER TO A01
IF !USED('A02')
   SELE 0
   USE A02 INDE A02
ELSE
   SELE A02
ENDIF
SET ORDER TO A021      
SEEK SYS_OPER+'D39'
IF !USED('A14')
   SELE 0
   USE A14
ELSE 
   SELE A14
ENDIF
SET FILTER TO F04='*'
SET ORDER TO 1     
IF !USED('C01')
   SELE 0
   USE C01
ELSE 
   SELE C01
ENDIF
SET ORDER TO 1
IF !USED('D01')
   SELE 0
   USE D01
ELSE 
   SELE D01
ENDIF
SET ORDER TO 1           
IF !USED('B01')
   SELE 0
   USE B01 INDE B01
ELSE
   SELE B01
ENDIF
SET ORDER TO 1    
IF !USED('B11')
   SELE 0
   USE B11 INDE B11
ELSE
   SELE B11
ENDIF
SET ORDER TO B111  
IF !USED('P20')         &&樣品申請紀錄
   SELE 0
   USE P20
ELSE
   SELE P20
ENDIF
SET ORDER TO P201  && F01+F05+DTOS(F02)
IF !USED('D40')         &&樣品申請紀錄
   SELE 0
   USE D40
ELSE
   SELE D40
ENDIF
SET ORDER TO 1      
D39='D39'+LEFT(DTOS(DATE()),6)
D391='D391'+LEFT(DTOS(DATE()),6)
IF !USED('&D39')
   SELE 0
   USE (D39) ALIA D39
ELSE
   SELE D39
ENDIF
SET ORDER TO 1      
SET RELA TO F03 INTO B01 
SET RELA TO F11 INTO C01 ADDI
SELECT F01,F02,F05,F07,F08,F10,F15,F90 FROM D39 GROUP BY F01 ORDER BY F01 INTO CURSOR D39_2 NOWAIT
CREATE CURSOR D39_1 (F01 C(10),F02 C(2),F05 C(5),F07 C(1),F08 C(40),F10 C(5),F15 C(17),F90 C(17))
SELE D39_1
INDE ON F01 TAG D39_11
INDE ON F05 TAG D39_12
INDE ON F10 TAG D39_13
SET ORDER TO 1
SELECT D39_2
GO TOP
DO WHILE !EOF()
   SELECT D39_1
   APPEND BLANK
   REPLACE F01 WITH D39_2.F01
   REPLACE F02 WITH D39_2.F02
   REPLACE F05 WITH D39_2.F05
   REPLACE F07 WITH D39_2.F07
   REPLACE F08 WITH D39_2.F08
   REPLACE F10 WITH D39_2.F10
   REPLACE F15 WITH D39_2.F15
   REPLACE F90 WITH D39_2.F90
   SELECT D39_2
   SKIP
ENDDO
SELECT D39_2
USE
SELECT D39_1
SET RELA TO F10 INTO A14 
SET RELA TO F05 INTO D01 ADDI
GO BOTTOM 
D39FORM=CREATEOBJECT("TKD39")
D39FORM.SHOW  
********
DEFINE CLASS TKD39 AS FORM
  CAPTION='D39.廠商樣品入貨單'
*!*	  AUTOCENTER=.T.
  CONTROLBOX=.F.
  BORDERSTYLE=1  
  MAXBUTTON=.F.
  MINBUTTON=.F.
  MOVABLE=.F.
  CLOSABLE=.F.
  CONTROLCOUNT=57
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*550
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WIDTH=INT_015*789
  WINDOWTYPE=1
  NAME='TKD39'
  ADD OBJECT SHAPE1 AS SHAPE1 WITH;
      AUTOCENTER=.T.
  ADD OBJECT LBL_REC AS LBL_REC WITH;
      AUTOCENTER =.T.
  ADD OBJECT REC_COUNT AS REC_COUNT  WITH;
      CAPTION=STR(RECCOUNT())        
  ADD OBJECT SHAPE2 AS SHAPE2 WITH;
      AUTOCENTER=.T.
  ADD OBJECT SHAPE3 AS SHAPE3 WITH;
      AUTOCENTER=.T.
  ADD OBJECT PAGEFRAME1 AS PAGEFRAME WITH;
      LEFT=INT_015*236,;
      WIDTH=INT_015*540,;
      HEIGHT=INT_015*200,;
      FONTSIZE=INT_015*9,;
      PAGECOUNT=2,;
      TABSTRETCH=1,;
      ACTIVEPAGE=1,;
      VISIBLE=.T.,;
      PAGE1.NAME='PAGE1',;
      PAGE1.VISIBLE=.T.,;
      PAGE1.CAPTION='表頭資料',;
      PAGE2.NAME='PAGE2',;
      PAGE2.VISIBLE=.T.,;
      PAGE2.CAPTION='表身詳細資料內容'   
  ADD OBJECT KEY_LIST AS KEY_LIST WITH;
      AUTOCENTER=.T.,;
      WIDTH=INT_015*130
  ADD OBJECT MTH_LIST AS MTH_LIST WITH;
      AUTOCENTER=.T.
  ADD OBJECT GRID1 AS GRID1 WITH;
      COLUMNCOUNT=5,;            
      RECORDSOURCE='D39_1',;      
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;      
      COLUMN3.NAME='COLUMN3',;      
      COLUMN4.NAME='COLUMN4',;
      COLUMN5.NAME='COLUMN5'      
  ADD OBJECT GRID2 AS GRID2 WITH;
      COLUMNCOUNT=6,;            
      RECORDSOURCE='D39',; 
      LINKMASTER='D39_1',;
      RELATIONALEXPR='F01',;
      CHILDORDER=D391,;  
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;
      COLUMN3.NAME='COLUMN3',;
      COLUMN4.NAME='COLUMN4',;
      COLUMN5.NAME='COLUMN5',;
      COLUMN6.NAME='COLUMN6'
  ADD OBJECT CMDGROUP AS CMDGROUP WITH;
      AUTOSIZE=.T.              
  ADD OBJECT ORPGROUP AS ORPGROUP WITH;    
      AUTOSIZE=.T.              
  ADD OBJECT SHRGROUP AS SHRGROUP WITH;
      TOP=INT_015*173,;
      LEFT=INT_015*558          
  ADD OBJECT ANS_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*490,;
      LEFT=INT_015*15,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*40,;      
      FONTSIZE=INT_015*9,;
      CAPTION='\<A.過帳',;
      NAME='ANS_BOTT'                  
  PROCEDURE PAGEFRAME1.PAGE1.INIT     
     THIS.ADDOBJECT('LBLF01','LABEL')
     WITH THIS.LBLF01
          .VISIBLE=.T.
          .LEFT=INT_015*14
          .TOP=INT_015*13
          .WIDTH=INT_015*50
          .CAPTION='入貨單號'          
     ENDWITH
     THIS.ADDOBJECT('TXTF01','TEXTBOX')          
     WITH THIS.TXTF01
          .VISIBLE=.T.
          .LEFT=INT_015*64
          .TOP=INT_015*9
          .WIDTH=INT_015*81
          .HEIGHT=INT_015*25
          .MAXLENGTH=10
     ENDWITH 
     THIS.ADDOBJECT('LBLF05','LABEL')     
     WITH THIS.LBLF05
          .VISIBLE=.T.
          .LEFT=INT_015*14
          .TOP=INT_015*53
          .WIDTH=INT_015*50  
          .CAPTION='進貨廠商'
     ENDWITH  
     THIS.ADDOBJECT('LBLF051','LABEL')     
     WITH THIS.LBLF051
          .VISIBLE=.T.
          .LEFT=INT_015*115
          .TOP=INT_015*53
          .AUTOSIZE=.T.
     ENDWITH       
     THIS.ADDOBJECT('TXTF05','TXTF05')          
     WITH THIS.TXTF05
          .VISIBLE=.T.
          .LEFT=INT_015*64
          .TOP=INT_015*49
          .WIDTH=INT_015*49
          .HEIGHT=INT_015*25
          .MAXLENGTH=5
     ENDWITH                 
     THIS.ADDOBJECT('LBLF10','LABEL')
     WITH THIS.LBLF10
         .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*78
         .WIDTH=INT_015*50
         .CAPTION='收料單位'
     ENDWITH    
     THIS.ADDOBJECT('LBLF101','LABEL')
     WITH THIS.LBLF101
         .VISIBLE=.T.
         .LEFT=INT_015*115
         .TOP=INT_015*78
         .AUTOSIZE=.T. 
     ENDWITH 
     THIS.ADDOBJECT('TXTF10','TXTF10')          
     WITH THIS.TXTF10
          .VISIBLE=.T.
          .LEFT=INT_015*64
          .TOP=INT_015*74
          .WIDTH=INT_015*49
          .HEIGHT=INT_015*25
          .MAXLENGTH=5
     ENDWITH
     THIS.ADDOBJECT('LBLF08','LABEL')
     WITH THIS.LBLF08
         .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*138
         .WIDTH=INT_015*50
         .CAPTION='備註說明'
     ENDWITH    
     THIS.ADDOBJECT('TXTF08','TEXTBOX')          
     WITH THIS.TXTF08
          .VISIBLE=.T.
          .LEFT=INT_015*64
          .TOP=INT_015*134
          .WIDTH=INT_015*250
          .HEIGHT=INT_015*25
          .MAXLENGTH=40
     ENDWITH  
     THIS.ADDOBJECT('LBLF02','LABEL')
     WITH THIS.LBLF02
         .VISIBLE=.T.
         .LEFT=INT_015*368
         .TOP=INT_015*13
         .WIDTH=INT_015*50
         .CAPTION='入貨日期'
     ENDWITH  
     THIS.ADDOBJECT('TXTF02','TEXTBOX')          
     WITH THIS.TXTF02
          .VISIBLE=.T.
          .LEFT=INT_015*418
          .TOP=INT_015*9
          .WIDTH=INT_015*40
          .HEIGHT=INT_015*25
          .MAXLENGTH=2
     ENDWITH  
     THIS.ADDOBJECT('LBLF07','LABEL')
     WITH THIS.LBLF07
         .VISIBLE=.T.
         .LEFT=INT_015*368
         .TOP=INT_015*38
         .WIDTH=INT_015*50
         .CAPTION='過  帳  碼'
     ENDWITH    
     THIS.ADDOBJECT('LBLF071','LABEL')
     WITH THIS.LBLF071
         .VISIBLE=.T.
         .LEFT=INT_015*419
         .TOP=INT_015*38
         .AUTOSIZE=.T.
     ENDWITH    
     THIS.ADDOBJECT('LBLF15','LABEL')
     WITH THIS.LBLF15
         .VISIBLE=.T.
         .LEFT=INT_015*368
         .TOP=INT_015*63
         .WIDTH=INT_015*50
         .CAPTION='安全資料'
     ENDWITH    
     THIS.ADDOBJECT('LBLF151','LABEL')
     WITH THIS.LBLF151
         .VISIBLE=.T.
         .LEFT=INT_015*419
         .TOP=INT_015*63
         .AUTOSIZE=.T.
     ENDWITH    
     THIS.ADDOBJECT('LBLF90','LABEL')
     WITH THIS.LBLF90
         .VISIBLE=.T.
         .LEFT=INT_015*368
         .TOP=INT_015*88
         .WIDTH=INT_015*50
         .CAPTION='確認人員'
     ENDWITH    
     THIS.ADDOBJECT('LBLF901','LABEL')
     WITH THIS.LBLF901
         .VISIBLE=.T.
         .LEFT=INT_015*419
         .TOP=INT_015*88
         .AUTOSIZE=.T.
     ENDWITH            
  ENDPROC 
 **************   
  PROCEDURE PAGEFRAME1.PAGE2.INIT
	THIS.ADDOBJECT('LBLF03','LABEL')
	WITH THIS.LBLF03  
	     .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*18
	     .WIDTH=INT_015*50
         .CAPTION='料品編號'
    ENDWITH  
    THIS.ADDOBJECT('LBLF031','LABEL')
    WITH THIS.LBLF031
         .VISIBLE=.T.
         .LEFT=INT_015*327
	     .TOP=INT_015*18
	     .AUTOSIZE=.T.
	ENDWITH     
	THIS.ADDOBJECT('TXTF03','TXTF03')
	WITH THIS.TXTF03      
	     .VISIBLE=.T.
	     .LEFT=INT_015*65
	     .TOP=INT_015*14
	     .WIDTH=INT_015*261
	     .HEIGHT=INT_015*25
	     .MAXLENGTH=43
	     .NAME='TXTF03'  
	ENDWITH   
    THIS.ADDOBJECT('LBLF04','LABEL')
    WITH THIS.LBLF04
         .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*53
         .WIDTH=INT_015*50
         .CAPTION='入貨數量'         
    ENDWITH 
	THIS.ADDOBJECT('TXTF04','TEXTBOX')
	WITH THIS.TXTF04
	     .VISIBLE=.T.
	     .LEFT=INT_015*65
	     .TOP=INT_015*49
	     .WIDTH=INT_015*80
	     .HEIGHT=INT_015*25
	     .INPUTMASK='999999999.9999'
	     .NAME='TXTF04'	    
	ENDWITH 
      THIS.ADDOBJECT('LBLF11','LABEL')
     WITH THIS.LBLF11
         .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*78
         .WIDTH=INT_015*50
         .CAPTION='需求對象'
     ENDWITH    
     THIS.ADDOBJECT('LBLF111','LABEL')
     WITH THIS.LBLF111
         .VISIBLE=.T.
         .LEFT=INT_015*116
         .TOP=INT_015*78
         .AUTOSIZE=.T. 
     ENDWITH       
     THIS.ADDOBJECT('TXTF11','TXTF11')          
     WITH THIS.TXTF11
          .VISIBLE=.T.
          .LEFT=INT_015*65
          .TOP=INT_015*74
          .WIDTH=INT_015*49
          .HEIGHT=INT_015*25
          .MAXLENGTH=5
     ENDWITH 
    THIS.ADDOBJECT('LBLF09','LABEL')
    WITH THIS.LBLF09
         .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*118
         .WIDTH=INT_015*50
         .CAPTION='申請單號'         
    ENDWITH    
	THIS.ADDOBJECT('TXTF09','TXTF09')
	WITH THIS.TXTF09      
	     .VISIBLE=.T.
	     .LEFT=INT_015*65
	     .TOP=INT_015*114
	     .WIDTH=INT_015*80
	     .HEIGHT=INT_015*25
	     .NAME='TXTF09'  
         .BACKCOLOR=RGB(255,255,100)
         .MOUSEPOINTER=99
         .MOUSEICON='BMPS\harrow.cur'   
	ENDWITH   
    THIS.ADDOBJECT('LBLF15','LABEL')
    WITH THIS.LBLF15
        .VISIBLE=.T.           
        .LEFT=INT_015*328
        .TOP=INT_015*143
        .WIDTH=INT_015*50
        .CAPTION='安全資料'         
    ENDWITH    
    THIS.ADDOBJECT('LBLF151','LABEL')
    WITH THIS.LBLF151
        .VISIBLE=.T.           
        .LEFT=INT_015*380
        .TOP=INT_015*143
        .AUTOSIZE=.T.
    ENDWITH         
  ENDPROC   
*************  
  PROC INIT       
       THISFORM.SETALL('HEIGHT',INT_015*25,'TEXTBOX')
       THISFORM.SETALL('HEIGHT',INT_015*17,'LABEL')     
       THISFORM.SETALL('FONTSIZE',INT_015*9,'TEXTBOX')
       THISFORM.SETALL('FONTSIZE',INT_015*9,'LABEL')         
       THISFORM.SETALL('READONLY',.T.,'TEXTBOX')
       THISFORM.PAGEFRAME1.PAGE1.FONTSIZE=INT_015*10
       THISFORM.PAGEFRAME1.PAGE2.FONTSIZE=INT_015*10  
       THISFORM.SHRGROUP.VISIBLE=.F.
       THISFORM.SHRGROUP.ENABLED=.F.
       THISFORM.GRID1.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)
       THISFORM.GRID2.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'COLUMN')
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'HEADER')         
       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='入貨單號'
       THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='進貨廠商編號'
       THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='進貨廠商簡稱'
       THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='收料部門編號'
       THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='收料部門簡稱'
       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='D39_1.F01'
       THISFORM.GRID1.COLUMN2.CONTROLSOURCE='D39_1.F05'
       THISFORM.GRID1.COLUMN3.CONTROLSOURCE='D01.F04'
       THISFORM.GRID1.COLUMN4.CONTROLSOURCE='D39_1.F10'
       THISFORM.GRID1.COLUMN5.CONTROLSOURCE='A14.F02'
       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*81
       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*49
       THISFORM.GRID1.COLUMN3.WIDTH=INT_015*80
       THISFORM.GRID1.COLUMN4.WIDTH=INT_015*49
       THISFORM.GRID1.COLUMN5.WIDTH=INT_015*80
       THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(D39_1.F07<>'2',RGB(255,0,0),'')","COLUMN")         
       THISFORM.GRID2.SETALL('FONTSIZE',INT_015*9,'COLUMN')
       THISFORM.GRID2.SETALL('FONTSIZE',INT_015*9,'HEADER')       
       THISFORM.GRID2.COLUMN1.HEADER1.CAPTION='料品編號'       
       THISFORM.GRID2.COLUMN2.HEADER1.CAPTION='品名規格'
       THISFORM.GRID2.COLUMN3.HEADER1.CAPTION='入貨數量'
       THISFORM.GRID2.COLUMN4.HEADER1.CAPTION='需求對象'
       THISFORM.GRID2.COLUMN5.HEADER1.CAPTION='申請單號'
       THISFORM.GRID2.COLUMN6.HEADER1.CAPTION='安全資料'
       THISFORM.GRID2.LINKMASTER='D39_1'
       THISFORM.GRID2.RELATIONALEXPR='F01'
	   THISFORM.GRID2.COLUMN1.CONTROLSOURCE='D39.F03'
	   THISFORM.GRID2.COLUMN2.CONTROLSOURCE='B01.F02'
	   THISFORM.GRID2.COLUMN3.CONTROLSOURCE='D39.F04'
	   THISFORM.GRID2.COLUMN4.CONTROLSOURCE='C01.F05'
	   THISFORM.GRID2.COLUMN5.CONTROLSOURCE='D39.F09'
	   THISFORM.GRID2.COLUMN6.CONTROLSOURCE='D39.F15'
	   THISFORM.GRID2.COLUMN1.WIDTH=INT_015*200
	   THISFORM.GRID2.COLUMN2.WIDTH=INT_015*149
       THISFORM.GRID2.COLUMN3.WIDTH=INT_015*50
       THISFORM.GRID2.COLUMN4.WIDTH=INT_015*70
       THISFORM.GRID2.COLUMN5.WIDTH=INT_015*70
       THISFORM.GRID2.COLUMN6.WIDTH=INT_015*100
       THISFORM.GRID1.READONLY=.T.      
       THISFORM.GRID2.READONLY=.T.            
       THISFORM.GRID1.SETFOCUS
       IF THISFORM.GRID1.ACTIVEROW=0
          THISFORM.CMDGROUP.ENABLED=.F.
          THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
          THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
          THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
          THISFORM.ANS_BOTT.ENABLED=.F.
       ELSE
          THISFORM.CMDGROUP.ENABLED=.T.      
          THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.) .AND. D39_1.F07<>'2'  &&判斷有無修改的權限
          THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)  .AND. D39_1.F07<>'2' &&判斷有無刪除的權限
          THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限       
          THISFORM.ANS_BOTT.ENABLED=IIF(D39_1.F07='2',.F.,.T.)  .AND. IIF(A02.F11='*',.T.,.F.) .AND. !THISFORM.SHRGROUP.ENABLED
       ENDIF          
       JK='入貨單號'
       SELE D39_1
       THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=D39_1.F01
  ENDPROC     
************      
  PROCEDURE PAGEFRAME1.PAGE1.ACTIVATE
     R=0
     SELE D39_1       
     IF THISFORM.SHRGROUP.VISIBLE=.F.
        THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(D39_1.F07<>'2',RGB(255,0,0),'')","COLUMN")         
        THISFORM.GRID1.ENABLED=.T.   
        THISFORM.GRID1.SETFOCUS 
        THISFORM.KEY_LIST.ENABLED=.T.
        THISFORM.MTH_LIST.ENABLED=.T.
     ELSE
       THISFORM.KEY_LIST.ENABLED=.F.   
       THISFORM.MTH_LIST.ENABLED=.F.   
     ENDIF                
    IF THISFORM.GRID1.ACTIVEROW=0 .AND. THISFORM.SHRGROUP.ENABLED=.F.
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
        THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
        THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
        THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
        THISFORM.ANS_BOTT.ENABLED=.F.
        THISFORM.PAGEFRAME1.PAGE1.SETALL('VALUE','','TEXTBOX')        
        THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=''
        THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE=''
        THISFORM.PAGEFRAME1.PAGE1.TXTF05.VALUE=''
        THISFORM.PAGEFRAME1.PAGE1.TXTF10.VALUE=''
        THISFORM.PAGEFRAME1.PAGE1.TXTF08.VALUE=''        
        THISFORM.PAGEFRAME1.PAGE1.LBLF051.CAPTION=''
        THISFORM.PAGEFRAME1.PAGE1.LBLF101.CAPTION=''
        THISFORM.PAGEFRAME1.PAGE1.LBLF071.CAPTION=''
        THISFORM.PAGEFRAME1.PAGE1.LBLF151.CAPTION=''        
        THISFORM.PAGEFRAME1.PAGE1.LBLF901.CAPTION=''             
        THISFORM.PAGEFRAME1.PAGE2.ENABLED=.F.      
     ELSE
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.
        THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  .AND. D39_1.F07<>'2' &&判斷有無修改的權限
        THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)   .AND. D39_1.F07<>'2' &&判斷有無刪除的權限
        THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)    &&判斷有無列印的權限  
        THISFORM.ANS_BOTT.ENABLED=IIF(D39_1.F07='2',.F.,.T.) .AND. IIF(A02.F11='*',.T.,.F.) .AND. !THISFORM.SHRGROUP.ENABLED
        THISFORM.PAGEFRAME1.PAGE2.ENABLED=.T.
     ENDIF   
     THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.);
     .AND. !IIF(SEEK(DTOS(CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/01')),'A23','A231'),A23.F07,.F.)
  ENDPROC
***************  
  PROCEDURE PAGEFRAME1.PAGE2.ACTIVATE
     SELE D39    
     IF THISFORM.SHRGROUP.ENABLED=.F.
        THISFORM.GRID2.READONLY=.T.       
        THISFORM.GRID2.SETFOCUS   
     ENDIF 
     IF THISFORM.GRID2.ACTIVEROW=0 .AND. THISFORM.SHRGROUP.ENABLED=.F.
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
        THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
        THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
        THISFORM.ANS_BOTT.ENABLED=.F.
        THISFORM.PAGEFRAME1.PAGE2.SETALL('VALUE','','TEXTBOX')
        THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=''
        THISFORM.PAGEFRAME1.PAGE2.TXTF09.VALUE=''
        THISFORM.PAGEFRAME1.PAGE2.TXTF11.VALUE=''
		THISFORM.PAGEFRAME1.PAGE2.LBLF111.CAPTION=''
        THISFORM.PAGEFRAME1.PAGE2.LBLF031.CAPTION=''
     ELSE
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.
        THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.) .AND. D39.F07<>'2'  &&判斷有無修改的權限
        THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)  .AND. D39.F07<>'2' &&判斷有無刪除的權限
        THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)  &&&&判斷有無列印的權限  
*!*	        THISFORM.ANS_BOTT.ENABLED=IIF(D39.F07='2',.F.,.T.) .AND. IIF(A02.F11='*',.T.,.F.) .AND. !THISFORM.SHRGROUP.ENABLED
	THISFORM.ANS_BOTT.ENABLED=.F.
     ENDIF   
     R=RECNO('&AREA1')
     THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(RECNO('&AREA1')=R,RGB(255,255,0),'')","COLUMN")
     THISFORM.GRID1.ENABLED=.F.     
     THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.)   .AND. D39_1.F07<>'2' &&判斷有無新增的權限
     THISFORM.KEY_LIST.ENABLED=.F.     
     THISFORM.MTH_LIST.ENABLED=.F.     
  ENDPROC           
***********  
  PROC KEY_LIST.INIT 
       WITH THIS 
           .ADDITEM('依入貨單號排列')
           .ADDITEM('依進貨廠商排列')
           .ADDITEM('依收料部門排列')
           .VALUE=1
       ENDWITH             
  ENDPROC 
************  
  PROC KEY_LIST.INTERACTIVECHANGE                 
       SELE D39_1 
       DO CASE
          CASE THIS.DISPLAYVALUE='依申請單號排列'
               SET ORDER TO 1 
               THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='入貨單號'
               THISFORM.GRID1.COLUMN1.CONTROLSOURCE='D39_1.F01'
               THISFORM.GRID1.COLUMN1.WIDTH=INT_015*81
               THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='進貨廠商編號'
               THISFORM.GRID1.COLUMN2.CONTROLSOURCE='D39_1.F05'
               THISFORM.GRID1.COLUMN2.WIDTH=INT_015*49
               THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='進貨廠商簡稱'
               THISFORM.GRID1.COLUMN3.CONTROLSOURCE='D01.F04'
               THISFORM.GRID1.COLUMN3.WIDTH=INT_015*80
               THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='收料部門編號'
               THISFORM.GRID1.COLUMN4.CONTROLSOURCE='D39_1.F10'
               THISFORM.GRID1.COLUMN4.WIDTH=INT_015*49               
               THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='收料部門簡稱'
               THISFORM.GRID1.COLUMN5.CONTROLSOURCE='A14.F02'
               THISFORM.GRID1.COLUMN5.WIDTH=INT_015*80                                
          CASE THIS.DISPLAYVALUE='依進貨廠商排列'
               SET ORDER TO 2
               THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='進貨廠商編號'
               THISFORM.GRID1.COLUMN1.CONTROLSOURCE='D39_1.F05'
               THISFORM.GRID1.COLUMN1.WIDTH=INT_015*49
               THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='進貨廠商簡稱'
               THISFORM.GRID1.COLUMN2.CONTROLSOURCE='D01.F04'
               THISFORM.GRID1.COLUMN2.WIDTH=INT_015*80
               THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='入貨單號'
               THISFORM.GRID1.COLUMN3.CONTROLSOURCE='D39_1.F01'
               THISFORM.GRID1.COLUMN3.WIDTH=INT_015*81                                                   
               THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='收料部門編號'
               THISFORM.GRID1.COLUMN4.CONTROLSOURCE='D39_1.F10'
               THISFORM.GRID1.COLUMN4.WIDTH=INT_015*49  
               THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='收料部門簡稱'
               THISFORM.GRID1.COLUMN5.CONTROLSOURCE='A14.F02'
               THISFORM.GRID1.COLUMN5.WIDTH=INT_015*58                 
          CASE THIS.DISPLAYVALUE='依收料部門排列'
               SET ORDER TO 3
               THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='收料部門編號'
               THISFORM.GRID1.COLUMN1.CONTROLSOURCE='D39_1.F10'
               THISFORM.GRID1.COLUMN1.WIDTH=INT_015*49
               THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='收料部門簡稱'
               THISFORM.GRID1.COLUMN2.CONTROLSOURCE='A14.F02'
               THISFORM.GRID1.COLUMN2.WIDTH=INT_015*80
               THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='入貨單號'
               THISFORM.GRID1.COLUMN3.CONTROLSOURCE='D39_1.F01'
               THISFORM.GRID1.COLUMN3.WIDTH=INT_015*81               
               THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='進貨廠商編號'
               THISFORM.GRID1.COLUMN4.CONTROLSOURCE='D39_1.F05'
               THISFORM.GRID1.COLUMN4.WIDTH=INT_015*49                  
               THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='進貨廠商簡稱'
               THISFORM.GRID1.COLUMN5.CONTROLSOURCE='D01.F04'
               THISFORM.GRID1.COLUMN5.WIDTH=INT_015*80                                                            
       ENDCASE 
        THISFORM.GRID1.SETFOCUS
  ENDPROC 
*************       
  PROC MTH_LIST.INTERACTIVECHANGE
       THISFORM.GRID1.RECORDSOURCE=''
       THISFORM.GRID2.RECORDSOURCE=''
       THISFORM.GRID2.LINKMASTER=''
       THISFORM.GRID2.RELATIONALEXPR=''
       THISFORM.GRID2.CHILDORDER=''
       SELE A24
       USE
       SELECT A23
       SEEK DTOS(CTOD(THIS.DISPLAYVALUE+'/01'))       
       A24='A24'+LEFT(DTOS(CTOD(THIS.DISPLAYVALUE+'/01')),6)
       IF !USED('&A24')
          SELE 0
          USE (A24) ALIA A24
       ELSE
          SELE A24
       ENDIF
       SET ORDER TO 1             
       SELE B25
       USE
       B25='B25'+LEFT(DTOS(CTOD(THIS.DISPLAYVALUE+'/01')),6)
       IF !USED('&B25')
          SELE 0
          USE (B25) ALIA B25
       ELSE
          SELE B25
       ENDIF
       SET ORDER TO 1                    
       SELE B26
       USE
       B26='B26'+LEFT(DTOS(CTOD(THIS.DISPLAYVALUE+'/01')),6)
       IF !USED('&B26')
          SELE 0
          USE (B26) ALIA B26
       ELSE
          SELE B26
       ENDIF
       SET ORDER TO 1                           
       SELE B39
       USE
       B39='B39'+LEFT(DTOS(CTOD(THIS.DISPLAYVALUE+'/01')),6)
       IF !USED('&B39')
          SELE 0
          USE (B39) ALIA B39
       ELSE
          SELE B39
       ENDIF
       SET ORDER TO 1                                  
       SELE D39
       SET RELA OFF INTO B01
*!*	       SET RELA OFF INTO D39_1
       USE
       SELE D39_1
       SET RELA OFF INTO A14 
       SET RELA OFF INTO D01 
       SET RELA OFF INTO C01   
       USE
       D39='D39'+LEFT(DTOS(CTOD(THIS.DISPLAYVALUE+'/01')),6)
       D391='D391'+LEFT(DTOS(CTOD(THIS.DISPLAYVALUE+'/01')),6)
       IF !USED('&D39')
          SELE 0
          USE (D39) ALIA D39
       ELSE
          SELE D39
       ENDIF
       SET ORDER TO 1      
       SET RELA TO F03 INTO B01  
       SET RELA TO F11 INTO C01 ADDI         
       SELE F01,F02,F05,F07,F08,F10,F15,F90 FROM D39 GROUP BY F01 ORDER BY F01 INTO CURSOR D39_2 NOWAIT
       CREATE CURSOR D39_1 (F01 C(10),F02 C(2),F05 C(5),F07 C(1),F08 C(40),F10 C(5),F15 C(17),F90 C(17))       
       INDE ON F01 TAG D39_11
       INDE ON F05 TAG D39_12
       INDE ON F10 TAG D39_13
       SET ORDER TO 1
       SELECT D39_2
       GO TOP
       DO WHILE !EOF()
          SELECT D39_1
          APPEND BLANK
          REPLACE F01 WITH D39_2.F01
          REPLACE F02 WITH D39_2.F02
          REPLACE F05 WITH D39_2.F05
          REPLACE F07 WITH D39_2.F07
          REPLACE F08 WITH D39_2.F08
          REPLACE F10 WITH D39_2.F10
          REPLACE F15 WITH D39_2.F15
          REPLACE F90 WITH D39_2.F90
          SELECT D39_2
          SKIP
       ENDDO
       SELECT D39_2
       USE
       SELECT D39_1
       SET RELA TO F10 INTO A14 
       SET RELA TO F05 INTO D01 ADDI
       GO BOTTOM  
       THISFORM.GRID1.RECORDSOURCE='D39_1'
       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='D39_1.F01'
       THISFORM.GRID1.COLUMN2.CONTROLSOURCE='D39_1.F05'       
       THISFORM.GRID1.COLUMN3.CONTROLSOURCE='D01.F04'     
       THISFORM.GRID1.COLUMN4.CONTROLSOURCE='D39_1.F10'              
       THISFORM.GRID1.COLUMN5.CONTROLSOURCE='A14.F02'       
       THISFORM.GRID2.RECORDSOURCE='D39'
       THISFORM.GRID2.LINKMASTER='D39_1'
       THISFORM.GRID2.RELATIONALEXPR='F01'      
       THISFORM.GRID2.CHILDORDER=D391  
	   THISFORM.GRID2.COLUMN1.CONTROLSOURCE='D39.F03'
	   THISFORM.GRID2.COLUMN2.CONTROLSOURCE='B01.F02'
	   THISFORM.GRID2.COLUMN3.CONTROLSOURCE='D39.F04'
	   THISFORM.GRID2.COLUMN4.CONTROLSOURCE='C01.F05'
	   THISFORM.GRID2.COLUMN5.CONTROLSOURCE='D39.F09'  
	   THISFORM.GRID2.COLUMN6.CONTROLSOURCE='D39.F15'            
       THISFORM.KEY_LIST.INTERACTIVECHANGE
	   THISFORM.PAGEFRAME1.ACTIVEPAGE=1
	   THISFORM.REFRESH
	   THISFORM.GRID1.SETFOCUS        
       IF THISFORM.GRID1.ACTIVEROW=0
          THISFORM.CMDGROUP.ENABLED=.F.
          THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
          THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
          THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
          THISFORM.ANS_BOTT.ENABLED=.F.
       ELSE
          THISFORM.CMDGROUP.ENABLED=.T.      
          THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.) .AND. D39_1.F07<>'2'  &&判斷有無修改的權限
          THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)  .AND. D39_1.F07<>'2' &&判斷有無刪除的權限
          THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限    
          THISFORM.ANS_BOTT.ENABLED=IIF(D39_1.F07='2',.F.,.T.)  .AND. IIF(A02.F11='*',.T.,.F.) .AND. !THISFORM.SHRGROUP.ENABLED            
       ENDIF          
  ENDPROC
***************  
  PROC GRID1.AFTERROWCOLCHANGE
       LPARAMETERS NCOLINDEX
       SELECT D39_1
       THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=D39_1.F01
       THISFORM.PAGEFRAME1.PAGE1.TXTF08.VALUE=D39_1.F08
       THISFORM.PAGEFRAME1.PAGE1.TXTF05.VALUE=D39_1.F05
       THISFORM.PAGEFRAME1.PAGE1.LBLF051.CAPTION=D01.F03
       THISFORM.PAGEFRAME1.PAGE1.TXTF10.VALUE=D39_1.F10
       THISFORM.PAGEFRAME1.PAGE1.LBLF101.CAPTION=A14.F02
       THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE=D39_1.F02
       THISFORM.PAGEFRAME1.PAGE1.LBLF071.CAPTION=IIF(D39_1.F07 = '2','已過帳','未過帳')
       THISFORM.PAGEFRAME1.PAGE1.LBLF151.CAPTION=D39_1.F15
       THISFORM.PAGEFRAME1.PAGE1.LBLF901.CAPTION=D39_1.F90
       THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.) .AND. D39_1.F07<>'2'  &&判斷有無修改的權限
       THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)  .AND. D39_1.F07<>'2' &&判斷有無刪除的權限
       THISFORM.ANS_BOTT.ENABLED=IIF(D39_1.F07='2',.F.,.T.) .AND. IIF(A02.F11='*',.T.,.F.) .AND. !THISFORM.SHRGROUP.ENABLED      
       FCH=THISFORM.ACTIVECONTROL.NAME
       JK=THIS.COLUMN1.HEADER1.CAPTION  
       IF THIS.ACTIVEROW=0
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
       ELSE
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.
       ENDIF   
       CHK=''     
*       THISFORM.REFRESH
  ENDPROC     
*************  
  PROC GRID2.AFTERROWCOLCHANGE
       LPARAMETERS NCOLINDEX
       SELECT D39
       THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=D39.F03
       THISFORM.PAGEFRAME1.PAGE2.LBLF031.CAPTION=B01.F02
       THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE=D39.F04      
       THISFORM.PAGEFRAME1.PAGE2.TXTF09.VALUE=D39.F09
       THISFORM.PAGEFRAME1.PAGE2.TXTF11.VALUE=D39.F11
       THISFORM.PAGEFRAME1.PAGE2.LBLF111.CAPTION=C01.F04
       THISFORM.PAGEFRAME1.PAGE2.LBLF151.CAPTION=D39.F15
       FCH=THISFORM.ACTIVECONTROL.NAME
       JK=THIS.COLUMN1.HEADER1.CAPTION
       CHK=D39_1.F01
*       CHK=THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
       IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
       ENDIF   
*       THISFORM.REFRESH
  ENDPROC 
*************  
  PROCEDURE ORPGROUP.NEW_BOTT.CLICK    
    THISFORM.KEY_LIST.ENABLED=.F. 
    THISFORM.MTH_LIST.ENABLED=.F. 
    THISFORM.ANS_BOTT.ENABLED=.F.
    IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1       
       THISFORM.GRID2.RECORDSOURCE=''
       THISFORM.GRID2.CHILDORDER=''
       THISFORM.PAGEFRAME1.PAGE1.SETALL('READONLY',.F.,'TEXTBOX')     &&處理表頭新增
       THISFORM.GRID1.ENABLED=.F.   
       THISFORM.GRID2.ENABLED=.F.   
          HD=HD1+SUBSTR(DTOS(CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/01')),3,4)
          DO ODR_CRT 
          THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=PO_NO
          THISFORM.PAGEFRAME1.PAGE1.TXTF01.REFRESH
          THISFORM.PAGEFRAME1.PAGE1.TXTF01.READONLY=.T.
          THISFORM.PAGEFRAME1.PAGE1.TXTF05.SETFOCUS
        THISFORM.PAGEFRAME1.PAGE2.ENABLED=.F.
        THISFORM.PAGEFRAME1.PAGE1.TXTF05.READONLY=.F.
        THISFORM.PAGEFRAME1.PAGE1.TXTF10.READONLY=.F.   
        THISFORM.PAGEFRAME1.PAGE1.TXTF05.VALUE=''
        THISFORM.PAGEFRAME1.PAGE1.TXTF08.VALUE=''
        THISFORM.PAGEFRAME1.PAGE1.TXTF10.VALUE=''                
        THISFORM.PAGEFRAME1.PAGE1.LBLF051.CAPTION=''
        THISFORM.PAGEFRAME1.PAGE1.LBLF101.CAPTION=''           
        THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE=RIGHT(DTOS(DATE()),2)
        THISFORM.PAGEFRAME1.PAGE1.LBLF151.CAPTION=''
        THISFORM.PAGEFRAME1.PAGE1.LBLF071.CAPTION=''              
        THISFORM.PAGEFRAME1.PAGE1.LBLF901.CAPTION=''  
     ELSE
        THISFORM.PAGEFRAME1.PAGE1.ENABLED=.F.              &&處理表身新增
        THISFORM.GRID2.ENABLED=.F.   
        THISFORM.PAGEFRAME1.PAGE2.SETALL('READONLY',.F.,'TEXTBOX')     
        THISFORM.PAGEFRAME1.PAGE2.TXTF03.READONLY=.F.
        THISFORM.PAGEFRAME1.PAGE2.TXTF09.READONLY=.F.
        THISFORM.PAGEFRAME1.PAGE2.TXTF11.READONLY=.F.
        THISFORM.PAGEFRAME1.PAGE2.TXTF03.SETFOCUS
        THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=''          
        THISFORM.PAGEFRAME1.PAGE2.LBLF031.CAPTION=''                  
        THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE=0
        THISFORM.PAGEFRAME1.PAGE2.TXTF09.VALUE=''
        THISFORM.PAGEFRAME1.PAGE2.TXTF11.VALUE=''
		THISFORM.PAGEFRAME1.PAGE2.LBLF111.CAPTION=''
        THISFORM.PAGEFRAME1.PAGE2.LBLF151.CAPTION=''               
     ENDIF   
  ENDPROC 
***************   
  PROCEDURE ORPGROUP.EDIT_BOTT.CLICK
     THISFORM.KEY_LIST.ENABLED=.F. 
     THISFORM.MTH_LIST.ENABLED=.F. 
     THISFORM.ANS_BOTT.ENABLED=.F.
     THISFORM.GRID1.ENABLED=.F.   
     THISFORM.GRID2.ENABLED=.F.   
     IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
        SELE D39_1
        PO_NO=D39_1.F01
        SELE RECNO() FROM D39 WHERE D39.F01=PO_NO AND F07<>'2' INTO ARRAY BK1
        JJ1=''                
        IF _TALLY>0                   
           FOR I= 1 TO ALEN(BK1)
               JJ1=JJ1+ALLTRIM(STR(BK1(I)))+','
           ENDFOR  
           KK1=STUFF(JJ1,RAT(',',JJ1,1),1,'')
           RLOCK(KK1,'D39')
           LL1=RLOCK(KK1,'D39')
        ELSE 
           =MESSAGEBOX('此單據已由別的工作站過帳中無法修改!',0+64,'提示訊息視窗')
           SELE D39_1           
           UNLOCK ALL
           REPL F07 WITH '2'
           THISFORM.SHRGROUP.ABANDON_BOTT.CLICK   
        ENDIF   
        IF LL1 =.T.
           THISFORM.PAGEFRAME1.PAGE1.SETALL('READONLY',.F.,'TEXTBOX')     &&處理表頭修改
           THISFORM.PAGEFRAME1.PAGE1.TXTF01.READONLY=.T.
           THISFORM.PAGEFRAME1.PAGE1.TXTF05.READONLY=.F.
           THISFORM.PAGEFRAME1.PAGE1.TXTF10.READONLY=.F.
           THISFORM.PAGEFRAME1.PAGE2.ENABLED=.F.
           THISFORM.PAGEFRAME1.PAGE1.TXTF05.SETFOCUS
        ELSE 
           DO FILE_IMPACT
           UNLOCK ALL
           THISFORM.SHRGROUP.ABANDON_BOTT.CLICK
        ENDIF   
     ELSE
        SELE D39                                                      &&處理表身修改
        IF RLOCK('D39') 
           THISFORM.PAGEFRAME1.PAGE2.SETALL('READONLY',.F.,'TEXTBOX') 
           THISFORM.PAGEFRAME1.PAGE2.TXTF03.READONLY=.F.
           THISFORM.PAGEFRAME1.PAGE2.TXTF09.READONLY=.F.
           THISFORM.PAGEFRAME1.PAGE2.TXTF11.READONLY=.F.
           THISFORM.PAGEFRAME1.PAGE2.TXTF03.SETFOCUS
        ELSE  
           DO FILE_IMPACT 
           UNLOCK ALL
           THISFORM.SHRGROUP.ABANDON_BOTT.CLICK           
       ENDIF        
     ENDIF   
     RELEASE ALL LIKE BK*
  ENDPROC  
*************    
  PROC ORPGROUP.DEL_BOTT.CLICK                    &&刪除資料程序
       IF MESSAGEBOX('是否確定要刪除此筆資料',4+32+256,'請確認') = 6	        
          IF ALIA()='D39_1'           &&刪除整張訂單
             SELE D39_1             
                PO_NO=D39_1.F01
                SELE RECNO() FROM D39 WHERE D39.F01=PO_NO  AND D39.F07<>'2' INTO ARRAY BK1              
                JJ1=''                
                IF _TALLY>0   
                   FOR I= 1 TO ALEN(BK1)
                       JJ1=JJ1+ALLTRIM(STR(BK1(I)))+','
                   ENDFOR    
                   KK1=STUFF(JJ1,RAT(',',JJ1,1),1,'')              
                   RLOCK(KK1,'D39')
                   LL1=RLOCK(KK1,'D39')
                ELSE
                   LL1=.T.   
                ENDIF                   
                IF LL1=.T. AND RLOCK('D39_1')   
                   DELETE FROM P20 WHERE P20.F16 = PO_NO  AND EMPTY(P20.F16) = .F. 
                   DELETE FROM D39 WHERE D39.F01 = PO_NO
                   SELE B39                     &&刪除未過帳單據紀錄
                   SEEK A02.F03+D39_1.F01                   
                   IF FOUND()
                      DELE
                   ENDIF   
                   SELE D39_1
                   DELE
                   UNLOCK ALL
                   IF INT_099=.T. .AND. SUBSTR(PO_NO,3,4)=SUBSTR(DTOS(CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/01')),3,4)
                      HD=HD1+SUBSTR(DTOS(CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/01')),3,4)+PO_NO
                      DO ODR_RJT
                   ENDIF  
                ELSE
                   DO FILE_IMPACT                  
                ENDIF             
             THISFORM.GRID1.SETFOCUS
             IF THISFORM.GRID1.ACTIVEROW=0
                THISFORM.CMDGROUP.ENABLED=.F.
                THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
                THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.               
                THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
                THISFORM.ANS_BOTT.ENABLED=.F.
             ELSE      
                THISFORM.CMDGROUP.ENABLED=.T.
                THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  .AND. D39_1.F07>'2' &&判斷有無修改的權限
                THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)   .AND. D39_1.F07<>'2' &&判斷有無刪除的權限
                THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限
                THISFORM.ANS_BOTT.ENABLED=IIF(D39_1.F07='2',.F.,.T.) .AND. IIF(A02.F11='*',.T.,.F.) .AND. !THISFORM.SHRGROUP.ENABLED                
             ENDIF     
          ELSE        
              SELE D39                                                      &&刪除單筆資料  
              IF RLOCK('D39')       
                 IF EMPTY(D39.F09) = .F.
                 	SELECT P20
                 	SEEK D39.F09 + D39.F03
                 	IF FOUND()
                 	   REPLACE P20.F16 WITH '' 
                 	ENDIF
                 ENDIF
                 SELECT D39
                 DELETE
                  SKIP -1
                  IF BOF()
                     GO TOP
                  ENDIF   
              ELSE
                 DO FILE_IMPACT                  
              ENDIF     
              THISFORM.GRID2.SETFOCUS
              IF THISFORM.GRID2.ACTIVEROW=0         &&如果單身被刪空
                 SELE B39                           &&刪除未過帳單據紀錄       
                 SEEK A02.F03+D39_1.F01
                 IF FOUND()
                    DELE
                 ENDIF                    
                 SELE D39_1                        
                 PO_NO=D39_1.F01                    
                 DELE                               &&連表頭也要刪除
                 IF INT_099=.T. .AND. SUBSTR(PO_NO,3,4)=SUBSTR(DTOS(CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/01')),3,4)
                     HD=HD1+SUBSTR(DTOS(CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/01')),3,4)+PO_NO
                     DO ODR_RJT
                 ENDIF
                 SELE D39_1
                 SKIP -1
                 IF BOF()
                    GO TOP
                 ENDIF   
                 THISFORM.PAGEFRAME1.ACTIVEPAGE=1 
                 THISFORM.REFRESH          
              ENDIF
          ENDIF
       ENDIF
       RELEASE ALL LIKE BK*   
  ENDPROC 
**************   
  PROCEDURE SHRGROUP.SHURE1_BOTT.CLICK               &&新增確認
    IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
       THISFORM.GRID2.RECORDSOURCE='D39'
       THISFORM.GRID2.CHILDORDER=D391
	   THISFORM.GRID2.COLUMN1.CONTROLSOURCE='D39.F03'
	   THISFORM.GRID2.COLUMN2.CONTROLSOURCE='B01.F02'
	   THISFORM.GRID2.COLUMN3.CONTROLSOURCE='D39.F04'
	   THISFORM.GRID2.COLUMN4.CONTROLSOURCE='C01.F05'
	   THISFORM.GRID2.COLUMN5.CONTROLSOURCE='D39.F09'   
	   THISFORM.GRID2.COLUMN6.CONTROLSOURCE='D39.F15'       
       SELE D39_1 
       COD=SYS(21)
       SET ORDER TO 1
       IF SEEK(THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE,'D39')=.T.  &&如果單號重複
          SELECT MAX(F01) FROM D39 INTO ARRAY GB NOWAIT
             HD=HD1+SUBSTR(DTOS(CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/01')),3,4)+THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
             DO ODR_RPT
		     THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=PO_NO
		     THISFORM.PAGEFRAME1.PAGE1.TXTF01.REFRESH                                		           		            		           
       ENDIF
       IF EMPTY(CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/'+THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE))          
          =MESSAGEBOX('入貨日期輸入錯誤!',0+64,'提示訊息視窗') 
          THISFORM.PAGEFRAME1.PAGE1.TXTF02.SETFOCUS
          SET ORDER TO &COD          
          RETURN
       ENDIF   
       IF SEEK(THISFORM.PAGEFRAME1.PAGE1.TXTF05.VALUE,'D01')=.F. .OR. EMPTY(THISFORM.PAGEFRAME1.PAGE1.TXTF05.VALUE)
          =MESSAGEBOX('無此廠商編號請先建立!',0+64,'提示訊息視窗')
          THISFORM.PAGEFRAME1.PAGE1.TXTF05.SETFOCUS
          SET ORDER TO &COD
          RETURN            
       ENDIF 
       IF SEEK(THISFORM.PAGEFRAME1.PAGE1.TXTF10.VALUE,'A14')=.F. .OR. EMPTY(THISFORM.PAGEFRAME1.PAGE1.TXTF10.VALUE)
          =MESSAGEBOX('工作部門主檔中無此編號請先建立!',0+64,'提示訊息視窗')
          THISFORM.PAGEFRAME1.PAGE1.TXTF10.SETFOCUS
          SET ORDER TO &COD
          RETURN            
       ENDIF   
       SELE D39_1          
       APPEND BLANK
       LOCK()
       IF RLOCK()
          REPLACE F01 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
          REPLACE F02 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE
          REPLACE F05 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF05.VALUE
          REPLACE F08 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF08.VALUE
          REPLACE F10 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF10.VALUE
          REPLACE F15 WITH IIF(INT_012=1,PADL(ALLTRIM(STR(YEAR(DATE())-1911)),3,' ')+RIGHT(DTOC(DATE()),6),dtoc(DATE())+' ')+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
       ENDIF   
*       UNLOCK
       SEEK THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
       SET ORDER TO &COD
       SELE B39
       APPEND BLANK
       REPL F01 WITH A02.F03
       REPL F02 WITH D39_1.F01
       REPL F03 WITH D39_1.F02
       REPL F04 WITH D39_1.F05
       REPL F07 WITH D39_1.F10
       THISFORM.PAGEFRAME1.PAGE1.ENABLED=.F.
       THISFORM.PAGEFRAME1.PAGE2.ENABLED=.T.  
       THISFORM.PAGEFRAME1.ACTIVEPAGE=2
       THISFORM.ORPGROUP.NEW_BOTT.CLICK
       THISFORM.REFRESH
    ELSE
       IF SEEK(THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE,'B01')=.F.
          =MESSAGEBOX('物料基本主檔中無此料號!',0+48,'提示訊息視窗')          
          THISFORM.PAGEFRAME1.PAGE2.TXTF03.SETFOCUS
          RETURN
       ENDIF   
       IF SEEK(THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE,'D39')=.T.           
          =MESSAGEBOX('此料號在此張申請單重複!',0+48,'提示訊息視窗')
          THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=''
          THISFORM.PAGEFRAME1.PAGE2.TXTF03.REFRESH
          THISFORM.PAGEFRAME1.PAGE2.TXTF03.SETFOCUS
          RETURN            
       ENDIF 
        IF EMPTY(THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE)
          =MESSAGEBOX('入貨數量不得為零!',0+48,'提示訊息視窗')
          THISFORM.PAGEFRAME1.PAGE2.TXTF04.SETFOCUS
          RETURN
       ENDIF 
       IF SEEK(THISFORM.PAGEFRAME1.PAGE2.TXTF11.VALUE,'C01')=.F. OR EMPTY(THISFORM.PAGEFRAME1.PAGE2.TXTF11.VALUE)          
          =MESSAGEBOX('無此需求對象(客戶編號)請先建立!',0+64,'提示訊息視窗') 
          THISFORM.PAGEFRAME1.PAGE2.TXTF11.SETFOCUS        
          RETURN
       ENDIF 
        IF EMPTY(THISFORM.PAGEFRAME1.PAGE2.TXTF09.VALUE) = .F. AND LEFT(THISFORM.PAGEFRAME1.PAGE2.TXTF09.VALUE,2) <> 'PZ' AND LEN(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF09.VALUE)) <> 10
          =MESSAGEBOX('申請單號格式有誤!',0+48,'提示訊息視窗')
          THISFORM.PAGEFRAME1.PAGE2.TXTF09.SETFOCUS
          RETURN
       ENDIF 
       IF EMPTY(THISFORM.PAGEFRAME1.PAGE2.TXTF09.VALUE) = .F.
       	  SELECT P20
       	  SEEK THISFORM.PAGEFRAME1.PAGE2.TXTF09.VALUE + THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE
       	  IF FOUND()
       	  	 REPLACE P20.F16 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
       	  ENDIF
       ENDIF
       SELE D39
       APPEND BLANK
       LOCK()
       IF RLOCK()
          REPLACE F01 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
          REPLACE F02 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE
          REPLACE F03 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE
          REPLACE F04 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE
          REPLACE F05 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF05.VALUE
          REPLACE F08 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF08.VALUE
          REPLACE F09 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF09.VALUE
          REPLACE F10 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF10.VALUE
          REPLACE F11 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF11.VALUE
          REPLACE F15 WITH IIF(INT_012=1,PADL(ALLTRIM(STR(YEAR(DATE())-1911)),3,' ')+RIGHT(DTOC(DATE()),6),dtoc(DATE())+' ')+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
       ENDIF
       UNLOCK ALL         
       SEEK THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE
       THISFORM.GRID2.ENABLED=.T.
       THISFORM.GRID2.SETFOCUS  
       THISFORM.ORPGROUP.NEW_BOTT.CLICK      
    ENDIF  
  ENDPROC
*****************  
  PROCEDURE SHRGROUP.SHURE2_BOTT.CLICK                          &&修改確認
     IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
       IF EMPTY(CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/'+THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE))          
          =MESSAGEBOX('入貨日期輸入錯誤!',0+64,'提示訊息視窗') 
          THISFORM.PAGEFRAME1.PAGE1.TXTF02.SETFOCUS
          RETURN
        ENDIF    
       IF SEEK(THISFORM.PAGEFRAME1.PAGE1.TXTF05.VALUE,'D01')=.F. .OR. EMPTY(THISFORM.PAGEFRAME1.PAGE1.TXTF05.VALUE)
          =MESSAGEBOX('無此廠商編號請先建立!',0+64,'提示訊息視窗')
          THISFORM.PAGEFRAME1.PAGE1.TXTF05.SETFOCUS
          RETURN            
       ENDIF 
       IF SEEK(THISFORM.PAGEFRAME1.PAGE1.TXTF10.VALUE,'A14')=.F. .OR. EMPTY(THISFORM.PAGEFRAME1.PAGE1.TXTF10.VALUE)
          =MESSAGEBOX('工作部門主檔中無此編號請先建立!',0+64,'提示訊息視窗')
          THISFORM.PAGEFRAME1.PAGE1.TXTF10.SETFOCUS
          RETURN            
       ENDIF    
           SELE D39
           SEEK D39_1.F01
           IF FOUND()
              DO WHILE F01=D39_1.F01
                 REPL F02 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE
                 REPL F05 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF05.VALUE
                 REPL F08 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF08.VALUE           
                 REPL F10 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF10.VALUE
                 REPL F15 WITH IIF(INT_012=1,PADL(ALLTRIM(STR(YEAR(DATE())-1911)),3,' ')+RIGHT(DTOC(DATE()),6),dtoc(DATE())+' ')+IIF(SEEK(sys_oper,'A01'),A01.F03,'') 
                 SKIP
              ENDDO    
           ENDIF        
        SELE D39_1
           REPL F02 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE
           REPL F05 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF05.VALUE
           REPL F08 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF08.VALUE
           REPL F10 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF10.VALUE
           REPL F15 WITH IIF(INT_012=1,PADL(ALLTRIM(STR(YEAR(DATE())-1911)),3,' ')+RIGHT(DTOC(DATE()),6),dtoc(DATE())+' ')+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
           UNLOCK ALL
     ELSE                                                        &&表身修改確認     
       IF SEEK(THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE,'B01')=.F.
          =MESSAGEBOX('物料基本主檔中無此料號!',0+48,'提示訊息視窗')          
          THISFORM.PAGEFRAME1.PAGE2.TXTF03.SETFOCUS
          RETURN
       ENDIF   
       IF THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE<>D39.F01+D39.F03
          IF SEEK(THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE,'D39')=.T.                            
             =MESSAGEBOX('此料號在此張申請單重複!',0+48,'提示訊息視窗')
             THISFORM.PAGEFRAME1.PAGE2.TXTF03.SETFOCUS
             RETURN            
          ENDIF    
       ENDIF 
        IF EMPTY(THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE)
          =MESSAGEBOX('入貨數量不得為零!',0+48,'提示訊息視窗')
          THISFORM.PAGEFRAME1.PAGE2.TXTF04.SETFOCUS
          RETURN
       ENDIF   
       IF SEEK(THISFORM.PAGEFRAME1.PAGE2.TXTF11.VALUE,'C01')=.F. OR EMPTY(THISFORM.PAGEFRAME1.PAGE2.TXTF11.VALUE)          
          =MESSAGEBOX('無此需求對象(客戶編號)請先建立!',0+64,'提示訊息視窗') 
          THISFORM.PAGEFRAME1.PAGE2.TXTF11.SETFOCUS        
          RETURN
       ENDIF 
        IF EMPTY(THISFORM.PAGEFRAME1.PAGE2.TXTF09.VALUE) = .F. AND LEFT(THISFORM.PAGEFRAME1.PAGE2.TXTF09.VALUE,2) <> 'PZ' AND LEN(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF09.VALUE)) <> 10
          =MESSAGEBOX('申請單號格式有誤!',0+48,'提示訊息視窗')
          THISFORM.PAGEFRAME1.PAGE2.TXTF09.SETFOCUS
          RETURN
       ENDIF 
       IF EMPTY(THISFORM.PAGEFRAME1.PAGE2.TXTF09.VALUE) = .F.
       	  SELECT P20
       	  SEEK THISFORM.PAGEFRAME1.PAGE2.TXTF09.VALUE + THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE
       	  IF FOUND()
       	  	 REPLACE P20.F16 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
       	  ENDIF
       ENDIF      
       SELE D39                    
       REPLACE F03 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE
       REPLACE F04 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE
       REPLACE F09 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF09.VALUE 
       REPLACE F11 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF11.VALUE     
       REPLACE F15 WITH IIF(INT_012=1,PADL(ALLTRIM(STR(YEAR(DATE())-1911)),3,' ')+RIGHT(DTOC(DATE()),6),dtoc(DATE())+' ')+IIF(SEEK(sys_oper,'A01'),A01.F03,'')                      
       UNLOCK ALL
    ENDIF   
    THISFORM.SHRGROUP.ABANDON_BOTT.CLICK    
  ENDPROC
*****************     
  PROCEDURE SHRGROUP.ABANDON_BOTT.CLICK
      THISFORM.SHRGROUP.ENABLED=.F.
      THISFORM.SHRGROUP.VISIBLE=.F.      
      THISFORM.ORPGROUP.ENABLED=.T.
      THISFORM.ORPGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
      THISFORM.CMDGROUP.ENABLED=.T.
      THISFORM.CMDGROUP.SETALL('ENABLED',.T.,'COMMANDBUTTON')
      THISFORM.CMDGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
      THISFORM.SETALL('READONLY',.T.,'TEXTBOX')  
      THISFORM.PAGEFRAME1.PAGE1.SETALL('READONLY',.T.,'TEXTBOX')  
      THISFORM.PAGEFRAME1.PAGE2.SETALL('READONLY',.T.,'TEXTBOX')  
      THISFORM.PAGEFRAME1.PAGE1.TXTF05.READONLY=.T.
      THISFORM.PAGEFRAME1.PAGE1.TXTF10.READONLY=.T. 
      THISFORM.PAGEFRAME1.PAGE2.TXTF11.READONLY=.T.
      THISFORM.PAGEFRAME1.PAGE2.TXTF03.READONLY=.T. 
      THISFORM.PAGEFRAME1.PAGE2.TXTF09.READONLY=.T. 
      THISFORM.PAGEFRAME1.PAGE1.ENABLED=.T.
      THISFORM.PAGEFRAME1.PAGE2.ENABLED=.T.
      IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
          THISFORM.GRID1.ENABLED=.T.
         THISFORM.GRID2.ENABLED=.T.
         THISFORM.GRID1.SETFOCUS
         THISFORM.KEY_LIST.ENABLED=.T.
         THISFORM.MTH_LIST.ENABLED=.T.      
      ELSE
          THISFORM.GRID1.ENABLED=.F.
         THISFORM.GRID2.ENABLED=.T.      
         THISFORM.GRID2.SETFOCUS
         IF THISFORM.GRID2.ACTIVEROW=0
            HD=HD1+SUBSTR(DTOS(CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/01')),3,4)+PO_NO
            DO ODR_RJT
            SELE B39
            SEEK A02.F03+D39_1.F01
            SET ORDER TO 1
            IF FOUND()
               DELE            
            ENDIF   
            SELE D39_1
            DELE
            THISFORM.PAGEFRAME1.ACTIVEPAGE=1
            THISFORM.REFRESH  
         ENDIF   
      ENDIF       
      UNLOCK ALL
      THISFORM.ANS_BOTT.ENABLED=IIF(D39_1.F07='2',.F.,.T.) .AND. IIF(A02.F11='*',.T.,.F.) .AND. !THISFORM.SHRGROUP.ENABLED             
  ENDPROC
******************  
  PROCEDURE SHRGROUP.FINISH_BOTT.CLICK
      IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
         IF THISFORM.GRID2.RECORDSOURCE<>'D39'
            THISFORM.GRID2.RECORDSOURCE='D39'
            THISFORM.GRID2.CHILDORDER=D391
  	        THISFORM.GRID2.COLUMN1.CONTROLSOURCE='D39.F03'
	        THISFORM.GRID2.COLUMN2.CONTROLSOURCE='B01.F02'
	        THISFORM.GRID2.COLUMN3.CONTROLSOURCE='D39.F04'
	        THISFORM.GRID2.COLUMN4.CONTROLSOURCE='C01.F05'
	        THISFORM.GRID2.COLUMN5.CONTROLSOURCE='D39.F09' 
	        THISFORM.GRID2.COLUMN6.CONTROLSOURCE='D39.F15'         
	     ENDIF   
	     IF INT_099=.T.
	        HD=HD1+SUBSTR(DTOS(CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/01')),3,4)+PO_NO
	        DO ODR_RJT
         ENDIF   
         SELE D39_1
         DO CASE 
            CASE THISFORM.KEY_LIST.DISPLAYVALUE='依入貨單號排列'
                 SET ORDER TO 1
            CASE THISFORM.KEY_LIST.DISPLAYVALUE='依進貨廠商排列'
                 SET ORDER TO 2
            CASE THISFORM.KEY_LIST.DISPLAYVALUE='依收料部門排列'
                 SET ORDER TO 3
         ENDCASE   
       ENDIF  
       THISFORM.SHRGROUP.ABANDON_BOTT.CLICK
  ENDPROC
**************       
  PROC ANS_BOTT.CLICK     &&過帳程序
       MAIL_TEXT = ''
       IF MESSAGEBOX('是否確認資料無誤可以過帳?',4+32+256,'請確認') = 6	 
          SELE RECNO() FROM D39 WHERE D39.F01=D39_1.F01  AND F07<>'2' INTO ARRAY BK1              
          JJ1=''                
          IF _TALLY>0   
             FOR I= 1 TO ALEN(BK1)
                 JJ1=JJ1+ALLTRIM(STR(BK1(I)))+','
             ENDFOR    
             KK1=STUFF(JJ1,RAT(',',JJ1,1),1,'')              
             RLOCK(KK1,'D39')
             LL1=RLOCK(KK1,'D39')
          ELSE
             LL1=.T.   
          ENDIF  
       ********   
          IF LL1 =.T. 
             IF LEN(ALLTRIM(JJ1))>0 
                SELE D39
                FOR I= 1 TO ALEN(BK1)                      
                    SELECT D39
                    GO BK1(I) 
                    SELE B11                                            &&部門庫存明細檔 
                    SEEK D39.F10+D39.F03+IIF(INT_028,D39.F11,SPACE(5))                                   &&轉入部門庫存明細 
                    IF FOUND()
                       REPL F04 WITH F04+D39.F04
                       IF F04=0
                          DELE
                       ELSE   
                          IF F05<CTOD((THISFORM.MTH_LIST.DISPLAYVALUE+'/'+D39.F02))
                             REPL F05 WITH CTOD((THISFORM.MTH_LIST.DISPLAYVALUE+'/'+D39.F02))
                          ENDIF
                       ENDIF   
                    ELSE
                       APPEND BLANK
                       REPL F01 WITH D39.F10
                       REPL F03 WITH D39.F03
                       REPL F04 WITH D39.F04
                       REPL F05 WITH CTOD((THISFORM.MTH_LIST.DISPLAYVALUE+'/'+D39.F02))
                       IF INT_028
                          REPLACE F08 WITH D39.F11
                       ENDIF
                    ENDIF   
                    *******
                    SELE B25                                             &&分部門庫存月報表 
                    SEEK D39.F10+D39.F03
                    IF FOUND()                                                &&轉入部門報表
                       REPL F04 WITH F04+D39.F04		&&進貨數量
                       REPL F15 WITH F15+D39.F04		&&期末數量
                    ELSE
                       APPEND BLANK
                       REPL F01 WITH D39.F10
                       REPL F02 WITH D39.F03
                       REPL F04 WITH D39.F04
                       REPL F15 WITH D39.F04                                                  
                    ENDIF   
                    SELE B26                                            &&庫存異動紀錄
                    APPEND BLANK                                               &&轉入  
                    REPL F01 WITH D39.F03                               
                    REPL F02 WITH D39.F10
                    REPL F03 WITH D39.F02
                    REPL F04 WITH D39.F04
                    REPL F06 WITH 'F'
                    REPL F07 WITH D39.F01           
                    REPL F08 WITH '進貨廠商 '+D39.F05+SPACE(2)+IIF(SEEK(D39.F05,'D01'),D01.F04,'')                            
                    SELE D40                                         &&廠商樣品入貨記錄  
                    APPEND BLANK
                    REPL F01 WITH D39.F05
                    REPL F02 WITH D39.F03
                    REPL F03 WITH CTOD((THISFORM.MTH_LIST.DISPLAYVALUE+'/'+D39.F02))
                    REPL F04 WITH D39.F01
                    REPL F05 WITH D39.F04 
                    REPL F06 WITH D39.F11 
                    REPL F07 WITH D39.F09
                    REPL F98 WITH IIF(INT_012=1,PADL(ALLTRIM(STR(YEAR(DATE())-1911)),3,' ')+RIGHT(DTOC(DATE()),6),dtoc(DATE())+' ')+IIF(SEEK(sys_oper,'A01'),A01.F03,'') 
                    REPL F99 WITH D39.F15                                        
                    SELE D39
                    REPL F07 WITH '2'
                    REPL F90 WITH IIF(INT_012=1,PADL(ALLTRIM(STR(YEAR(DATE())-1911)),3,' ')+RIGHT(DTOC(DATE()),6),dtoc(DATE())+' ')+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
                 ENDFOR  
                 SELE B39                    &&未過帳庫存單據查詢檔
                 SEEK A02.F03+D39_1.F01
                  IF FOUND()
                     DELE
                  ENDIF                                             
                  SELE D39_1
                  REPL F07 WITH '2'
                  REPL F90 WITH IIF(INT_012=1,PADL(ALLTRIM(STR(YEAR(DATE())-1911)),3,' ')+RIGHT(DTOC(DATE()),6),dtoc(DATE())+' ')+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
             ELSE
                =MESSAGEBOX('此單據已由別的工作站過帳完成',0+64,'提示訊息視窗')
                SELE D39_1
                REPL F07 WITH '2'
             ENDIF           
             THIS.ENABLED=.F.
             THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
             THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.             
             UNLOCK ALL
             IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
                THISFORM.GRID1.SETFOCUS
             ELSE
                 THISFORM.GRID2.SETFOCUS
                 THISFORM.ORPGROUP.NEW_BOTT.ENABLED=.F.
             ENDIF
             THISFORM.REFRESH
          ELSE
            DO FILE_IMPACT
            UNLOCK ALL
            RETURN
          ENDIF   
          UNLOCK ALL
         RELEASE ALL LIKE BK*
      ENDIF      
  ENDPROC
ENDDEFINE    
***********************************************列印程序
PROCEDURE PNT_PRC  
     LK=D39_1.F01     
     HK=IIF(INT_012=1,ALLTRIM(STR(YEAR(A23.F01)-1911))+SUBSTR(DTOC(A23.F01),3,3),LEFT(dtoc(A23.F01),5))
     SELECT D39.F01,;
            D39.F02,;
            D39.F03,;
            D39.F04,;
            D39.F05,;
            D39.F08,;
            D39.F09,;
            D39.F10,;
            D39.F11,;
            B01.F02,;
            A14.F02,;
            D01.F03;
     FROM D39,B01,A14,D01 WHERE D39.F01=LK AND B01.F01=D39.F03 AND A14.F01=D39.F10 AND D01.F01=D39.F05 ORDER BY D39.F03 NOWAIT
     IF _TALLY >0
        REPORT FORM ALLTRIM(INT_116)+'D39'  PREVIEW
*!*		    REPORT FORM ALLTRIM(INT_116)+'D39' TO PRINT PROMPT 
     ENDIF  
     CLEAR
ENDPROC
************************************************特殊輸入欄位的設定----料號
DEFINE CLASS TXTF03 AS TEXTBOX
  READONLY=.T.
  MAXLENGTH=43
  FONTSIZE=INT_015*9
  PROCEDURE INTERACTIVECHANGE
    IF AT('?',ALLTRIM(THIS.VALUE))<>0
       IF AT('?',ALLTRIM(THIS.VALUE))>1             
          SELECT F01,F02 FROM B01 INTO CURSOR MTR ORDER BY F01 WHERE !EMPTY(F98) AND LEFT(F01,AT('?',THIS.VALUE)-1)=LEFT(THIS.VALUE,AT('?',THIS.VALUE)-1)    
       ELSE
          SELECT F01,F02 FROM B01 INTO CURSOR MTR ORDER BY F01 WHERE !EMPTY(F98)   
       ENDIF        
       IF _TALLY>0
          MTR_SEEK=CREATEOBJECT("MTR_SEEK")  
          MTR_SEEK.SHOW    
          THIS.VALUE=FLG
          THIS.REFRESH
          FLG='0'     
       ENDIF          
    ENDIF  
       THISFORM.PAGEFRAME1.PAGE2.LBLF031.CAPTION=IIF(SEEK(THIS.VALUE,'B01'),B01.F02,'')      
  ENDPROC

ENDDEFINE
***************************************************特殊輸入欄位設定進貨廠商-----------廠商
DEFINE CLASS TXTF05 AS TEXTBOX
  READONLY=.T.
  MAXLENGTH=5
  FONTSIZE=INT_015*9
  PROCEDURE INTERACTIVECHANGE
    IF AT('?',ALLTRIM(THIS.VALUE))<>0 
       IF AT('?',ALLTRIM(THIS.VALUE))>1             
          IF EMPTY(A02.F12)
             SELECT F02,F01,F04 FROM D01 INTO CURSOR VDR ORDER BY F02 WHERE LEFT(F02,AT('?',THIS.VALUE)-1)=LEFT(THIS.VALUE,AT('?',THIS.VALUE)-1) 
          ELSE
             SELECT F02,F01,F04 FROM D01 INTO CURSOR VDR ORDER BY F02 WHERE LEFT(F02,AT('?',THIS.VALUE)-1)=LEFT(THIS.VALUE,AT('?',THIS.VALUE)-1)
          ENDIF
       ELSE
          SELECT F02,F01,F04 FROM D01 INTO CURSOR VDR ORDER BY F02 
       ENDIF
       IF _TALLY>0          
          VDR_SEEK=CREATEOBJECT("VDR_SEEK")  
          VDR_SEEK.SHOW    
          THIS.VALUE=FLG
          THIS.REFRESH
          FLG='0'        
       ENDIF   
    ELSE
       IF LEN(ALLTRIM(THIS.VALUE))=4
          SELECT F02,F01,F04 FROM D01 INTO CURSOR VDR ORDER BY F02 WHERE F02=ALLTRIM(THIS.VALUE)
          DO CASE
             CASE _TALLY=1
                  THIS.VALUE=VDR.F01
                  THIS.REFRESH
             CASE _TALLY>1
                  VDR_SEEK=CREATEOBJECT("VDR_SEEK")  
                  VDR_SEEK.SHOW    
                  THIS.VALUE=FLG
                  THIS.REFRESH
                  FLG='0'        
          ENDCASE      
       ENDIF    
    ENDIF      
       THISFORM.PAGEFRAME1.PAGE1.LBLF051.CAPTION=IIF(SEEK(THIS.VALUE,'D01'),D01.F03,'')  
  ENDPROC
ENDDEFINE
***************************************************特殊輸入欄位設定申請單號-P20之申請單號
DEFINE CLASS TXTF09 AS TEXTBOX
  READONLY=.T.
  MAXLENGTH=10
  FONTSIZE=INT_015*9
  PROCEDURE DBLCLICK 
  IF THISFORM.SHRGROUP.VISIBLE=.T.  AND THIS.ReadOnly =.F.
  	SELECT 0,P20.*,IIF(EMPTY(P20.F12),'1','') AS F121 FROM P20 WHERE P20.F09 = '1' AND EMPTY(P20.F16) = .T. AND P20.F03 = THISFORM.PAGEFRAME1.PAGE1.TXTF05.VALUE AND;
  	       P20.F05 NOT IN(SELECT D39.F03 FROM D39 WHERE D39.F01 = THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE) ORDER BY F121,F12 INTO CURSOR P20_TEMP READWRITE 
	SELECT P20_TEMP 
	GO TOP
    IF _TALLY>0          
       CHK_IN='0'
       P20_SEEK=CREATEOBJECT("P20_SEEK")  
       P20_SEEK.SHOW    
       THIS.REFRESH
  	   CALC SUM(EXP_1) TO NO
       DO CASE
             CASE NO = 1 AND CHK_IN = '1'
    	         SELECT * FROM P20_TEMP WHERE P20_TEMP.EXP_1 <> 0 INTO CURSOR P20P
                 SELECT P20P
                 THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE = P20P.F05
                 THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE = P20P.F15
                 THISFORM.PAGEFRAME1.PAGE2.TXTF09.VALUE = P20P.F01
                 THISFORM.PAGEFRAME1.PAGE2.TXTF11.VALUE = P20P.F04
                 SELECT P20P
                 USE
             CASE NO >= 1 AND CHK_IN = '1'
    	         SELECT * FROM P20_TEMP WHERE P20_TEMP.EXP_1 <> 0 ORDER BY P20_TEMP.F05 INTO CURSOR P20P
                 SELECT P20P
                 GO TOP
                 DO WHILE !EOF()
			       	SELECT P20
			        SEEK P20P.F01 + P20P.F05
			       	IF FOUND()
			       	   REPLACE P20.F16 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
			       	ENDIF
			        SELECT D39
			        APPEND BLANK
			        LOCK()
			        IF RLOCK()
			           REPLACE D39.F01 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
			           REPLACE D39.F02 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE
			           REPLACE D39.F03 WITH P20P.F05
			           REPLACE D39.F04 WITH P20P.F15
			           REPLACE D39.F05 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF05.VALUE
			           REPLACE D39.F08 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF08.VALUE
			           REPLACE D39.F09 WITH P20P.F01
			           REPLACE D39.F10 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF10.VALUE
			           REPLACE D39.F11 WITH P20P.F04
			           REPLACE D39.F15 WITH IIF(INT_012=1,PADL(ALLTRIM(STR(YEAR(DATE())-1911)),3,' ')+RIGHT(DTOC(DATE()),6),dtoc(DATE())+' ')+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
			        ENDIF
                    SELECT P20P
                    SKIP
                 ENDDO
                 SELECT P20P
                 USE
       ENDCASE
       THISFORM.PAGEFRAME1.PAGE2.TXTF09.SETFOCUS 
    ELSE 
       =MESSAGEBOX('P21.樣品申請紀錄表中無資料可選取',0+48,'提示訊息視窗')          
       THISFORM.PAGEFRAME1.PAGE2.TXTF09.SETFOCUS
       RETURN         
    ENDIF
    THISFORM.PAGEFRAME1.PAGE2.LBLF031.CAPTION=IIF(SEEK(THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE,'B01'),B01.F02,'')
    THISFORM.PAGEFRAME1.PAGE2.LBLF111.CAPTION=IIF(SEEK(THISFORM.PAGEFRAME1.PAGE2.TXTF11.VALUE,'C01'),C01.F04,'')        
  ENDIF
  ENDPROC
ENDDEFINE
***************************************************特殊欄位------------------收料部門
DEFINE CLASS TXTF10 AS TEXTBOX
  READONLY=.T.
  MAXLENGTH=5 
  FONTSIZE=INT_015*9  
  PROCEDURE INTERACTIVECHANGE
    IF AT('?',ALLTRIM(THIS.VALUE))<>0
       IF AT('?',ALLTRIM(THIS.VALUE))>1             
          SELECT F01,F02 FROM A14 INTO CURSOR DEPART ORDER BY F01 WHERE LEFT(F01,AT('?',THIS.VALUE)-1)=LEFT(THIS.VALUE,AT('?',THIS.VALUE)-1) AND LEN(ALLTRIM(F01))=4 AND F04='*'
       ELSE
          SELECT F01,F02 FROM A14 INTO CURSOR DEPART ORDER BY F01 WHERE LEN(ALLTRIM(F01))=4 AND F04='*'
       ENDIF   
       IF _TALLY>0
          DEPART_SEEK=CREATEOBJECT("DEPART_SEEK")  
          DEPART_SEEK.SHOW    
          THIS.VALUE=FLG
          THIS.REFRESH
          FLG='0'
       ENDIF   
    ENDIF   
       THISFORM.PAGEFRAME1.PAGE1.LBLF101.CAPTION=IIF(SEEK(THIS.VALUE,'A14'),A14.F02,'')         
  ENDPROC
ENDDEFINE 
***************************************************特殊輸入欄位設定-----------客戶
DEFINE CLASS TXTF11 AS TEXTBOX
  READONLY=.T.
  MAXLENGTH=5
  FONTSIZE=INT_015*9
  PROCEDURE INTERACTIVECHANGE
    IF AT('?',ALLTRIM(THIS.VALUE))<>0 
       IF AT('?',ALLTRIM(THIS.VALUE))>1             
          IF EMPTY(A02.F12)
             SELECT F02,F01,F04 FROM C01 INTO CURSOR VDR ORDER BY F02 WHERE LEFT(F02,AT('?',THIS.VALUE)-1)=LEFT(THIS.VALUE,AT('?',THIS.VALUE)-1) 
          ELSE
             SELECT F02,F01,F04 FROM C01 INTO CURSOR VDR ORDER BY F02 WHERE LEFT(F02,AT('?',THIS.VALUE)-1)=LEFT(THIS.VALUE,AT('?',THIS.VALUE)-1)
          ENDIF
       ELSE
          SELECT F02,F01,F04 FROM C01 INTO CURSOR VDR ORDER BY F02 
       ENDIF
       IF _TALLY>0          
          VDR_SEEK=CREATEOBJECT("VDR_SEEK")  
          VDR_SEEK.SHOW    
          THIS.VALUE=FLG
          THIS.REFRESH
          FLG='0'        
       ENDIF   
    ELSE
       IF LEN(ALLTRIM(THIS.VALUE))=4
          SELECT F02,F01,F04 FROM C01 INTO CURSOR VDR ORDER BY F02 WHERE F02=ALLTRIM(THIS.VALUE)
          DO CASE
             CASE _TALLY=1
                  THIS.VALUE=VDR.F01
                  THIS.REFRESH
             CASE _TALLY>1
                  VDR_SEEK=CREATEOBJECT("VDR_SEEK")  
                  VDR_SEEK.SHOW    
                  THIS.VALUE=FLG
                  THIS.REFRESH
                  FLG='0'        
          ENDCASE      
       ENDIF    
    ENDIF      
       THISFORM.PAGEFRAME1.PAGE2.LBLF111.CAPTION=IIF(SEEK(THIS.VALUE,'C01'),C01.F04,'')  
  ENDPROC
ENDDEFINE 
***************************************P21.樣品申請紀錄表
DEFINE CLASS P20_SEEK AS FORM
*!*	  AUTOCENTER=.T.
  CAPTION='P21.樣品申請紀錄表'
  TOP=INT_015*110
  LEFT=INT_015*70    
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*325
  WIDTH=INT_015*640
  FONTSIZE=INT_015*9
  MAXBUTTON=.F.
  MINBUTTON=.F.    
  CLOSABLE=.F.
  CONTROLBOX=.F.
  BORDERSTYLE=2
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WINDOWTYPE=1
  NAME='P20_SEEK'
  ADD OBJECT GRID1 AS GRID WITH;          
      AUTOCENTER=.T.,;
      HIGHLIGHTROWLINEWIDTH=4,;
      WIDTH=INT_015*640,;      
      HEIGHT=INT_015*293,;      
      ROWHEIGHT=INT_015*18,;
      HEADERHEIGHT=INT_015*19,;
      DELETEMARK=.F.,;
      READONLY=.T.,;
      RECORDSOURCETYPE=1,;
      COLUMNCOUNT=7,;       
      RECORDSOURCE='P20_TEMP',;     
      NAME='GRID1',;
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;      
      COLUMN3.NAME='COLUMN3',;      
      COLUMN4.NAME='COLUMN4',;
      COLUMN5.NAME='COLUMN5',;
      COLUMN6.NAME='COLUMN6',;
      COLUMN7.NAME='COLUMN7'  
  ADD OBJECT CMND1 AS COMMANDBUTTON WITH;
      AUTOSIZE=.T.,;
      LEFT=INT_015*230,;    
      HEIGHT=INT_015*25,;   
      TOP=INT_015*297,;        
      WIDTH=INT_015*80,;    
      FONTSIZE=INT_015*9,;
      CAPTION='\<S.確定',;
      TOOLTIPTEXT='選擇游標所指的紀錄!快速鍵->ALT+S'
      NAME='CMND1'
  ADD OBJECT CMND2 AS COMMANDBUTTON WITH;
      AUTOSIZE=.T.,;
      LEFT=INT_015*320,;
      TOP=INT_015*297,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*80,;    
      FONTSIZE=INT_015*9,;      
      CAPTION='\<X.取消',;
      TOOLTIPTEXT='取消此搜尋畫面!快速鍵->ALT+X'
      NAME='CMND2'
  ADD OBJECT CMND3 AS COMMANDBUTTON WITH;
      AUTOSIZE=.T.,;
      LEFT=INT_015*50,;    
      HEIGHT=INT_015*25,;   
      TOP=INT_015*297,;        
      WIDTH=INT_015*80,;  
      FONTSIZE=INT_015*9,;
      CAPTION='\<A.全選',;
      TOOLTIPTEXT='全選所有資料!快速鍵->ALT+A'
      NAME='CMND3'
  ADD OBJECT CMND4 AS COMMANDBUTTON WITH;
      AUTOSIZE=.T.,;
      LEFT=INT_015*130,;    
      HEIGHT=INT_015*25,;   
      TOP=INT_015*297,;        
      WIDTH=INT_015*80,;
      FONTSIZE=INT_015*9,;
      CAPTION='\<C.清除',;
      TOOLTIPTEXT='清除已全選之資料!快速鍵->ALT+C'
      NAME='CMND4'               
   PROCEDURE INIT 
         THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'COLUMN')
         THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'HEADER')   
         THISFORM.SETALL('MOVABLE',.F.,'COLUMN') 
         THISFORM.SETALL('MOUSEPOINTER',99,'COMMANDBUTTON')
         THISFORM.SETALL('MOUSEICON','BMPS\harrow.cur','COMMANDBUTTON')
         THISFORM.SETALL('READONLY',.T.,'TEXTBOX')
         THISFORM.GRID1.COLUMN1.HEADER1.CAPTION=''
         THISFORM.GRID1.COLUMN1.WIDTH=INT_015*20
         THISFORM.GRID1.COLUMN1.CONTROLSOURCE='P20_TEMP.EXP_1'       
         THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='申請單號'
         THISFORM.GRID1.COLUMN2.WIDTH=INT_015*75
         THISFORM.GRID1.COLUMN2.CONTROLSOURCE='P20_TEMP.F01'               
         THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='料        號'
         THISFORM.GRID1.COLUMN3.CONTROLSOURCE='P20_TEMP.F05'
         THISFORM.GRID1.COLUMN3.WIDTH=INT_015*260     
         THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='申請數量'
         THISFORM.GRID1.COLUMN4.CONTROLSOURCE='P20_TEMP.F06'
         THISFORM.GRID1.COLUMN4.WIDTH=INT_015*55 
         THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='回覆數量'
         THISFORM.GRID1.COLUMN5.CONTROLSOURCE='P20_TEMP.F15'
         THISFORM.GRID1.COLUMN5.WIDTH=INT_015*55
         THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='回覆交期'
         THISFORM.GRID1.COLUMN6.CONTROLSOURCE='P20_TEMP.F12'
         THISFORM.GRID1.COLUMN6.WIDTH=INT_015*70  
         THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='需求對象'
         THISFORM.GRID1.COLUMN7.CONTROLSOURCE="IIF(SEEK(P20_TEMP.F04,'C01'),C01.F05,P20_TEMP.F04)"
         THISFORM.GRID1.COLUMN7.WIDTH=INT_015*70    
         THISFORM.GRID1.SETFOCUS
      ENDPROC
      ***
      PROC GRID1.INIT      
		 THISFORM.GRID1.COLUMN1.READONLY=.F.
		 THISFORM.GRID1.COLUMN2.READONLY=.T.
		 THISFORM.GRID1.COLUMN3.READONLY=.T.
		 THISFORM.GRID1.COLUMN4.READONLY=.F.
		 THISFORM.GRID1.COLUMN5.READONLY=.F.
		 THISFORM.GRID1.COLUMN6.READONLY=.F.
		 THISFORM.GRID1.COLUMN7.READONLY=.F.
		 THISFORM.GRID1.COLUMN5.HEADER1.BACKCOLOR=RGB(128,255,0)
		 THISFORM.GRID1.COLUMN6.HEADER1.BACKCOLOR=RGB(128,255,0)
		 THISFORM.GRID1.COLUMN1.removeobject("TEXT1")
		 THISFORM.GRID1.COLUMN1.AddObject("CheckBox1","CheckBox1") 
		 THISFORM.GRID1.COLUMN1.CurrentControl="CheckBox1" 
		 THISFORM.GRID1.COLUMN1.Sparse=.F.
		 THISFORM.GRID1.COLUMN1.CheckBox1.Visible=.T.
		 THISFORM.GRID1.COLUMN1.CheckBox1.CAPTION=''
		 THISFORM.GRID1.COLUMN1.CheckBox1.AUTOSIZE=.T.
		 THISFORM.GRID1.COLUMN1.CheckBox1.CENTERED=.T.
		 THISFORM.GRID1.COLUMN1.CheckBox1.BACKSTYLE=0
		 THISFORM.GRID1.COLUMN1.CheckBox1.LEFT=5    	
      ENDPROC
      ***
      PROC GRID1.AFTERROWCOLCHANGE
           LPARAMETERS XCOLINDEX
             THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","ICASE(P20_TEMP.EXP_1 = 1,RGB(255,255,0),'')","COLUMN")

*!*	           FCH='GRID1'
      ENDPROC 
 PROCEDURE CMND1.CLICK
      SELECT P20_TEMP
      CHK_IN='1'
      THISFORM.RELEASE     
 ENDPROC
 PROCEDURE CMND2.CLICK
      CHK_IN='0' 
      THISFORM.RELEASE
 ENDPROC  
 **
 PROCEDURE CMND3.CLICK     
      SELECT P20_TEMP
      RE=RECNO('P20_TEMP')
      GO TOP
      DO WHILE !EOF()
	     REPLACE P20_TEMP.EXP_1 WITH 1 
	     SELECT P20_TEMP
	     SKIP
      ENDDO
      SELECT P20_TEMP
      GO RE  
      THISFORM.GRID1.SETFOCUS 
 ENDPROC      
  PROCEDURE CMND4.CLICK
      SELECT P20_TEMP
      RE=RECNO('P20_TEMP')
      GO TOP
      DO WHILE !EOF()
         REPLACE P20_TEMP.EXP_1 WITH 0 
         SELECT P20_TEMP
         SKIP
      ENDDO
      SELECT P20_TEMP
      GO RE
      THISFORM.GRID1.SETFOCUS 
 ENDPROC     
ENDDEFINE  
*********     
DEFINE CLASS CheckBox1 AS CheckBox
      PROCEDURE CLICK
         SELECT P20_TEMP
         IF THIS.VALUE=1
            REPLACE P20_TEMP.EXP_1 WITH 1
         ELSE
            REPLACE P20_TEMP.EXP_1 WITH 0   
         ENDIF
         THISFORM.GRID1.SETFOCUS     
   ENDPROC 
ENDDEFINE 
