****程式名稱 鴻海標籤輸入介面
CLEAR ALL
SET TALK OFF
SET EXCL OFF
SET DELE ON
SET CENT OFF
SET SAFE OFF
SET DECIMALS TO 6
SET REPROCESS TO 1
_SCREEN.CAPTION=''
_SCREEN.CONTROLBOX=.F.
ZOOM WIND SCREEN MIN
CLEAR ALL
CLOS DATA ALL
CLOS TABL ALL
SET TALK OFF
SET EXCL OFF
SET DELE ON
SET CENT OFF
SET SAFE OFF
SET DECIMALS TO 6
SET ENGINEBEHAVIOR 70 
SET REPORTBEHAVIOR 80
SET REPROCESS TO 1
_SCREEN.CAPTION=''
_SCREEN.CONTROLBOX=.F.
ZOOM WINDOW  SCREEN MAX
HIDE WINDOW SCREEN
DEACTIVATE WIND SCREEN
SET SYSMENU OFF
SET STATUS BAR OFF
SET MULTILOCKS ON
DIMENSION MYTHO[34]
   FOR I=0 TO 9
       MYTHO[I+1]=ALLTRIM(STR(I))
   ENDFOR  
   FOR I=65 TO 72
       MYTHO[I-54]=CHR(I)
   ENDFOR
   FOR I=74 TO 78
       MYTHO[I-55]=CHR(I)
   ENDFOR
   FOR I=80 TO 90
       MYTHO[I-56]=CHR(I)
   ENDFOR
FILE_NAME=''
DECLARE _FPRESET IN msvcrt20.dll 
CAPSLOCK(.T.)
CREATE CURSOR TD4 (F01 C(25))
INDEX ON F01 TAG TD4
SET ORDER TO 1
IF !USED('A26')
   SELECT 0
   USE A26
ELSE 
   SELECT A26
ENDIF
SET ORDER TO 1      
*!*	SEEK 'INT_012'
*!*	IF FOUND()
*!*	   INT_012=VAL(F06)
*!*	ELSE
*!*	  INT_012=2   
*!*	ENDIF
*!*	IF INT_012=1
*!*	   SET DATE TO TAIWAN
*!*	ELSE
SET DATE TO YMD
*!*	ENDIF   
PUBLIC SRC
v_scrx=SYSMETRIC(1)
v_scry=SYSMETRIC(2)
IF v_scrx= 800 AND v_scry=600
   INT_015=1
ELSE
   INT_015=1.28   
endif
SELECT 0
IF !USED('FXCN1')
   SELECT 0
   USE FXCN1 EXCLUSIVE
ELSE
   SELECT FXCN1
ENDIF      
SET ORDER TO FXCN11
IF !USED('GAUNBAU')
   SELECT 0
   USE GAUNBAU
ELSE
   SELECT GAUNBAU
ENDIF
SET ORDER TO 1      
SEEK LEFT(DTOS(DATE()),6)+'01'
IF FOUND()
   S_NO=F02
ELSE   
   APPEND BLANK
   REPLACE F01 WITH CTOD(LEFT(DTOS(DATE()),4)+'/'+SUBSTR(DTOS(DATE()),5,2)+'/01')
   REPLACE F02 WITH 0
   S_NO=F02
ENDIF

IF !USED('WSTRN')
   SELECT 0
   USE WSTRN
ELSE
   SELE WSTRN
ENDIF
GO TOP
SRC=F01

IF !USED('C20')
   SELECT 0
   USE C20
ELSE
   SELECT C20
ENDIF
SET ORDER TO 1      
IF !USED('C01')
   SELECT 0
   USE C01
ELSE 
   SELECT C01
ENDIF
SET ORDER TO 1 
IF !USED('C03')
   SELECT 0
   USE C03
ELSE 
   SELECT C03
ENDIF
SET ORDER TO 1 
IF !USED('C04')
   SELECT 0
   USE C04
ELSE 
   SELECT C04
ENDIF
SET ORDER TO 1      
IF !USED('A23')
   SELECT 0
   USE A23
ELSE 
   SELECT A23
ENDIF
SET ORDER TO 1    
IF !USED('C22')
   SELE 0
   USE C22
ELSE
   SELE C22
ENDIF
SET ORDER TO C223
IF !USED('C23')
   SELE 0
   USE C23
ELSE
   SELE C23
ENDIF
SET ORDER TO 1
SELECT INV_NO FROM FXCN1 GROUP BY INV_NO ORDER BY INV_NO INTO CURSOR TD3 NOWAIT
SELECT TD3
GO TOP
DO WHILE !EOF()
   SELECT TD4
   APPEND BLANK 
   REPLACE F01 WITH TD3.INV_NO
   SELECT TD3
   SKIP
ENDDO
SELECT TD3 
USE
PUBLIC VDR
DO FORM FXCN1


***************************************輸入DATE CODE
DEFINE CLASS FXCN2_SEEK AS FORM
*!*	  AUTOCENTER=.T.
  CAPTION='        輸入DATE CODD'
  TOP=INT_015*40
  LEFT=INT_015*325    
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*405
  WIDTH=INT_015*500
  FONTSIZE=INT_015*9
  MAXBUTTON=.F.
  MINBUTTON=.F.    
  CLOSABLE=.F.
  CONTROLBOX=.F.
  BORDERSTYLE=2
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WINDOWTYPE=1
  NAME='FXCN2_SEEK'
  ADD OBJECT GRID3 AS GRID3 WITH;          
      TOP=0,;
      HIGHLIGHTROWLINEWIDTH=4,;
      WIDTH=INT_015*500,;      
      HEIGHT=INT_015*363,;      
      ROWHEIGHT=INT_015*18,;
      HEADERHEIGHT=INT_015*19,;
      DELETEMARK=.F.,;
      READONLY=.T.,;
      RECORDSOURCETYPE=1,;
      COLUMNCOUNT=4,;       
      RECORDSOURCE='FXCN2',;     
      NAME='GRID3',;
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;
      COLUMN3.NAME='COLUMN3',;
      COLUMN4.NAME='COLUMN4'
  ADD OBJECT CMND1 AS COMMANDBUTTON WITH;
      AUTOSIZE=.T.,;
      LEFT=INT_015*20,;    
      HEIGHT=INT_015*25,;   
      TOP=INT_015*377,;        
      WIDTH=INT_015*80,;    
      FONTSIZE=INT_015*9,;
      CAPTION='\<S.確定',;
      TOOLTIPTEXT='選擇游標所指的紀錄!快速鍵->ALT+S'
      NAME='CMND1'
  ADD OBJECT CMND2 AS COMMANDBUTTON WITH;
      AUTOSIZE=.T.,;
      LEFT=INT_015*100,;
      TOP=INT_015*377,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*80,;    
      FONTSIZE=INT_015*9,;      
      CAPTION='\<X.取消',;
      TOOLTIPTEXT='取消此搜尋畫面!快速鍵->ALT+X'
      NAME='CMND2'
  ADD OBJECT CMND3 AS COMMANDBUTTON WITH;
      AUTOSIZE=.T.,;
      LEFT=INT_015*200,;
      TOP=INT_015*377,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*80,;    
      FONTSIZE=INT_015*9,;      
      CAPTION='\<T.依料號輸入',;
      TOOLTIPTEXT='依料號整批輸入!快速鍵->ALT+X'
      NAME='CMND3'
   ADD OBJECT LBL1 AS LABEL WITH;  
       TOP=INT_015*382,;
       LEFT=INT_015*322,; 
       WIDTH=INT_015*50,;
       HEIGHT=INT_015*25,;
       FONTSIZE=INT_015*9,;
       CAPTION='預設年月',;
       NAME='LBL1'
   ADD OBJECT TXT1 AS TEXTBOX WITH;
       TOP=INT_015*377,;
       LEFT=INT_015*380,;
       WIDTH=INT_015*80,;
       HEIGHT=INT_015*25,;       
       FONTSIZE=INT_015*9,; 
       MAXLENGTH=6,;
       NAME='TXT1'   
   PROCEDURE INIT       
         SELE FXCN2         
         GO TOP
         THISFORM.GRID3.SETALL('FONTSIZE',INT_015*9,'COLUMN')
         THISFORM.GRID3.SETALL('FONTSIZE',INT_015*9,'HEADER')   
         THISFORM.SETALL('MOVABLE',.F.,'COLUMN') 
         THISFORM.SETALL('MOUSEPOINTER',99,'COMMANDBUTTON')
         THISFORM.SETALL('MOUSEICON','BMPS\harrow.cur','COMMANDBUTTON')                           
         THISFORM.SETALL('READONLY',.T.,'TEXTBOX')
         THISFORM.GRID3.COLUMN1.HEADER1.CAPTION='BOX NO'
         THISFORM.GRID3.COLUMN1.WIDTH=INT_015*50
         THISFORM.GRID3.COLUMN1.CONTROLSOURCE='FXCN2.BOX_NO'  
         
         THISFORM.GRID3.COLUMN2.HEADER1.CAPTION='料號'
         THISFORM.GRID3.COLUMN2.WIDTH=INT_015*250
         THISFORM.GRID3.COLUMN2.CONTROLSOURCE='M_PN'  
                       
         THISFORM.GRID3.COLUMN3.HEADER1.CAPTION='DATE CODE'
         THISFORM.GRID3.COLUMN3.WIDTH=INT_015*70
         THISFORM.GRID3.COLUMN3.CONTROLSOURCE='FXCN2.DATE_CODE'               
         THISFORM.GRID3.COLUMN4.HEADER1.CAPTION='LOT NO'
         THISFORM.GRID3.COLUMN4.WIDTH=INT_015*70
         THISFORM.GRID3.COLUMN4.CONTROLSOURCE='FXCN2.LOT_NO'                        
         THISFORM.TXT1.READONLY=.F.
         
         THISFORM.GRID3.SETFOCUS
      ENDPROC
      ***
     PROC GRID3.INIT      
	      THISFORM.GRID3.COLUMN1.READONLY=.T.
	      THISFORM.GRID3.COLUMN2.READONLY=.T.
	      THISFORM.GRID3.COLUMN3.READONLY=.F.
	      THISFORM.GRID3.COLUMN4.READONLY=.F.
	
      ENDPROC
      ***
      PROC GRID3.AFTERROWCOLCHANGE
           LPARAMETERS XCOLINDEX
*!*	           FCH='GRID3'
      ENDPROC 
 PROCEDURE CMND1.CLICK
      SELECT FXCN2
      GO TOP 
      DO WHILE !EOF()
         IF !EMPTY(THISFORM.TXT1.VALUE)
            REPLACE DATE_CODE WITH THISFORM.TXT1.VALUE
         ENDIF
         SELECT FXCN1        
         IF !EMPTY(ALLTRIM(FXCN2.DATE_CODE))
             REPLACE DATE_CODE WITH FXCN2.DATE_CODE FOR BOX_NO=FXCN2.BOX_NO AND INV_NO=FXCN2.INV_NO
             REPLACE LOT_NO WITH FXCN2.LOT_NO FOR BOX_NO=FXCN2.BOX_NO AND INV_NO=FXCN2.INV_NO
         ENDIF    
         SELECT FXCN2
         SKIP
      ENDDO
      SELECT FXCN2
      USE
      THISFORM.RELEASE     
 ENDPROC
 PROCEDURE CMND2.CLICK
      SELECT FXCN2
      USE
      THISFORM.RELEASE
 ENDPROC  
  PROCEDURE CMND3.CLICK
     SELECT  M_PN,DATE_CODE,LOT_NO FROM FXCN2 GROUP BY M_PN ORDER BY M_PN INTO CURSOR FXCN5 NOWAIT READWRITE
     IF _TALLY>0
          FXCN5_SEEK=CREATEOBJECT("FXCN5_SEEK")  
          FXCN5_SEEK.SHOW    
          THIS.REFRESH
     ENDIF
     THISFORM.GRID3.SETFOCUS
 ENDPROC  
 **
 
ENDDEFINE  
************************
DEFINE CLASS GRID3 AS GRID 
      TOP=INT_015*30
      LEFT=10
      HEIGHT=INT_015*385
      WIDTH=INT_015*214
      HEADERHEIGHT=INT_015*19
      ROWHEIGHT=INT_015*18   
      DELETEMARK=.F.
      READONLY=.T.
      FONTBOLD=.T.  
*!*	      SPLITBAR=.F.
      ALLOWCELLSELECTION=.T.
      HIGHLIGHTROWLINEWIDTH=4
      ALLOWROWSIZING=.F.
      RECORDSOURCETYPE=1      
      NAME='GRID3'
      PROCEDURE INIT 
          ON KEY LABEL RIGHTMOUSE  DO remouse 
           THISFORM.SETALL('MOVABLE',.F.,'COLUMN')
*!*	            THISFORM.GRID1.BACKCOLOR=RGB(58,186,152)
      ENDPROC             
ENDDEFINE  
***************
****************************************輸入VENDOR CODE
DEFINE CLASS VDR_SEEK AS FORM
  AUTOCENTER=.T.
  CAPTION='搜尋畫面'
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*190
  WIDTH=INT_015*475
  CONTROLBOX=.F.
  BORDERSTYLE=2
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WINDOWTYPE=1
  NAME='HEAD_SEEK'
  ADD OBJECT LABEL1 AS LABEL WITH;
      AUTOSIZE=.T.,;
      HEIGHT=INT_015*25,;
      LEFT=INT_015*30,;
      TOP=INT_015*75,;
      FONTSIZE=INT_015*9,;
      NAME='LABEL1'
 ADD OBJECT TEXT1 AS TEXTBOX WITH;
      AUTOSIZE=.T.,;
      TOP=INT_015*70,;
      WIDTH=INT_015*269,;
      LEFT=INT_015*120,;
      HEIGHT=INT_015*25,; 
      FONTSIZE=INT_015*9,;
      NAME='TEXT1'
  ADD OBJECT CMND1 AS COMMANDBUTTON WITH;
      AUTOSIZE=.T.,;
      LEFT=INT_015*100,;    
      HEIGHT=INT_015*25,;   
      TOP=INT_015*144,;  
      WIDTH=INT_015*80,;
      FONTSIZE=INT_015*9,;      
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\HARROW.CUR',;              
      CAPTION='\<Y.執行',;
      TOOLTIPTEXT='確認搜尋所輸入的鍵值!快速鍵->ALT+Y',;
      NAME='CMND1'
  ADD OBJECT CMND2 AS COMMANDBUTTON WITH;
      AUTOSIZE=.T.,;
      LEFT=INT_015*240,;
      TOP=INT_015*144,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*80,;
      FONTSIZE=INT_015*9,;
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\HARROW.CUR',;
      CAPTION='\<C.取消',;
      TOOLTIPTEXT='取消搜尋作業!快速鍵->ALT+C',;
      NAME='CMND2'
  PROCEDURE INIT 
      THISFORM.LABEL1.CAPTION='VENDOR CODE'
      THISFORM.TEXT1.READONLY=.F.
  
      THISFORM.TEXT1.VALUE=''
       
  ENDPROC    

  PROCEDURE CMND1.CLICK 
      IF EMPTY(THISFORM.TEXT1.VALUE)
         =MESSAGEBOX("VENDOR CODE 不得空白!",0+48,"提示訊息視窗")
         THISFORM.TEXT1.SETFOCUS
         RETURN
      ENDIF   
      VDR=THISFORM.TEXT1.VALUE
      FLG='1'
      THISFORM.RELEASE              
  ENDPROC
  PROCEDURE CMND2.CLICK
      VDR=''   
      FLG='0'
       THISFORM.RELEASE
  ENDPROC      
ENDDEFINE     
*******
FUNCTION THFO
 PARAMETERS BK
 WST=''
 DO WHILE BK>0
    WST=MYTHO(BK%34+1)+WST
    BK=INT(BK/34)

 ENDDO

 RETURN WST    
 **************
 FUNCTION DTABC
 PARAMETERS KU
 IF VAL(KU)<10
    KU= CHR(VAL(KU)+48)
 ELSE
    KU= CHR(VAL(KU)+55)
 ENDIF   
 RETURN KU
 *********************************************依料號匯總輸入DATE CODE 跟LOT NO
 DEFINE CLASS FXCN5_SEEK AS FORM
*!*	  AUTOCENTER=.T.
  CAPTION='        依料號匯總輸入DATE CODD'
  TOP=INT_015*40
  LEFT=INT_015*325    
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*405
  WIDTH=INT_015*450
  FONTSIZE=INT_015*9
  MAXBUTTON=.F.
  MINBUTTON=.F.    
  CLOSABLE=.F.
  CONTROLBOX=.F.
  BORDERSTYLE=2
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WINDOWTYPE=1
  NAME='FXCN5_SEEK'
  ADD OBJECT GRID5 AS GRID3 WITH;          
      TOP=0,;
      HIGHLIGHTROWLINEWIDTH=4,;
      WIDTH=INT_015*450,;      
      HEIGHT=INT_015*363,;      
      ROWHEIGHT=INT_015*18,;
      HEADERHEIGHT=INT_015*19,;
      DELETEMARK=.F.,;
      READONLY=.T.,;
      RECORDSOURCETYPE=1,;
      COLUMNCOUNT=3,;       
      RECORDSOURCE='FXCN5',;     
      NAME='GRID5',;
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;
      COLUMN3.NAME='COLUMN3'
  ADD OBJECT CMND1 AS COMMANDBUTTON WITH;
      AUTOSIZE=.T.,;
      LEFT=INT_015*20,;    
      HEIGHT=INT_015*25,;   
      TOP=INT_015*377,;        
      WIDTH=INT_015*80,;    
      FONTSIZE=INT_015*9,;
      CAPTION='\<S.確定',;
      TOOLTIPTEXT='選擇游標所指的紀錄!快速鍵->ALT+S'
      NAME='CMND1'
  ADD OBJECT CMND2 AS COMMANDBUTTON WITH;
      AUTOSIZE=.T.,;
      LEFT=INT_015*100,;
      TOP=INT_015*377,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*80,;    
      FONTSIZE=INT_015*9,;      
      CAPTION='\<X.取消',;
      TOOLTIPTEXT='取消此搜尋畫面!快速鍵->ALT+X'
      NAME='CMND2'
  
   PROCEDURE INIT 
      
         SELE FXCN5
         
         GO TOP
         THISFORM.GRID5.SETALL('FONTSIZE',INT_015*9,'COLUMN')
         THISFORM.GRID5.SETALL('FONTSIZE',INT_015*9,'HEADER')   
         THISFORM.SETALL('MOVABLE',.F.,'COLUMN') 
         THISFORM.SETALL('MOUSEPOINTER',99,'COMMANDBUTTON')
         THISFORM.SETALL('MOUSEICON','BMPS\harrow.cur','COMMANDBUTTON')                           
         THISFORM.SETALL('READONLY',.T.,'TEXTBOX')
 
         
         THISFORM.GRID5.COLUMN1.HEADER1.CAPTION='料號'
         THISFORM.GRID5.COLUMN1.WIDTH=INT_015*250
         THISFORM.GRID5.COLUMN1.CONTROLSOURCE='M_PN'  
                       
         THISFORM.GRID5.COLUMN2.HEADER1.CAPTION='DATE CODE'
         THISFORM.GRID5.COLUMN2.WIDTH=INT_015*70
         THISFORM.GRID5.COLUMN2.CONTROLSOURCE='DATE_CODE'               
         THISFORM.GRID5.COLUMN3.HEADER1.CAPTION='LOT NO'
         THISFORM.GRID5.COLUMN3.WIDTH=INT_015*70
         THISFORM.GRID5.COLUMN3.CONTROLSOURCE='LOT_NO'                         
         THISFORM.GRID5.SETFOCUS
      ENDPROC
      ***
     PROC GRID5.INIT      
	     
	      THISFORM.GRID5.COLUMN1.READONLY=.T.
	      THISFORM.GRID5.COLUMN2.READONLY=.F.
	      THISFORM.GRID5.COLUMN3.READONLY=.F.
	
      ENDPROC
      ***
      PROC GRID5.AFTERROWCOLCHANGE
           LPARAMETERS XCOLINDEX
*!*	           FCH='GRID3'
      ENDPROC 
 PROCEDURE CMND1.CLICK
      SELECT FXCN5
      GO TOP 
      DO WHILE !EOF()
         SELECT FXCN2
         IF !EMPTY(ALLTRIM(FXCN5.DATE_CODE))
             REPLACE DATE_CODE WITH FXCN5.DATE_CODE FOR M_PN=FXCN5.M_PN  
             REPLACE LOT_NO WITH FXCN5.LOT_NO FOR M_PN=FXCN5.M_PN  
         ENDIF    
         SELECT FXCN5
         SKIP
      ENDDO
      SELECT FXCN5
      USE
      THISFORM.RELEASE     
 ENDPROC
 PROCEDURE CMND2.CLICK
      SELECT FXCN5
      USE
      THISFORM.RELEASE
 ENDPROC  
 **
 
ENDDEFINE  

FUNCTION TOTALQTY(PARTNO)
    CKQTY=0
    SELECT C22
    SET ORDER TO 3
    SEEK ALLTRIM(TD4.F01)+SPACE(15)
    IF FOUND()
       
       SELECT C23
      
       SEEK C22.F01+PARTNO
       IF FOUND()
          DO WHILE F01+F02=C22.F01+PARTNO
           
             CKQTY=CKQTY+C23.F03
             SELECT C23
             SKIP
          ENDDO
       ELSE
           =MESSAGEBOX('找無此筆',0+48,C22.F01+PARTNO) 
       ENDIF
    ELSE
      =MESSAGEBOX('找無此筆',0+48,TD4.F01)   
    ENDIF   
    SELECT FXCN1
    
    RETURN CKQTY
ENDPROC