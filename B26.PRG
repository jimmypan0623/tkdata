***程式名稱:B26.庫存異動紀錄
CLOSE ALL
CLEAR 
FLG='0'
FCH=''
CHK=''
CHK_STR=''
R=0
QTY=0
TQTY=0
AREA1='B26_1'
AREA2='B26'
WAIT WINDOW "資料匯入中,請稍後!" AT 0,150 NOWAIT NOCLEAR
IF !USED('A23')
    SELE 0
    USE A23
ELSE 
   SELE A23
ENDIF
SET ORDER TO 1         
SELE A23
SET ORDER TO 1
IF ! USED('A01')
   SELE 0
   USE A01 INDE A01
ELSE
   SELE A01
ENDIF      
SET ORDER TO A01
IF !USED('A02')
   SELE 0
   USE A02 INDE A02
ELSE
   SELE A02
ENDIF
SET ORDER TO A021      
SEEK SYS_OPER+'B26'
IF !USED('A14')
   SELE 0
   USE A14
ELSE 
   SELE A14
ENDIF
SET ORDER TO 1     
SET FILTER TO F04='*' 
GO TOP   
IF !USED('B01')
   SELE 0
   USE B01 INDE B01
ELSE
   SELE B01
ENDIF
SET ORDER TO 1           
B25='B25'+LEFT(DTOS(DATE()),6)
B251='B251'+LEFT(DTOS(DATE()),6)
IF !USED('&B25')
   SELE 0
   USE (B25) ALIA B25
ELSE
   SELE B25
ENDIF
SET ORDER TO 1      
B26='B26'+LEFT(DTOS(DATE()),6)
B261='B261'+LEFT(DTOS(DATE()),6)
IF !USED('&B26')
   SELE 0
   USE (B26) ALIA B26
ELSE
   SELE B26
ENDIF
SET ORDER TO 1     
GO TOP
DPT_NO=B26.F02              
***************************
                  IF INT_012=1
                     TKMTH=PADL(ALLTRIM(STR(VAL(LEFT(DTOS(DATE()),4))-1911)),4,'0')+'/'+SUBSTR(DTOS(DATE()),5,2)
                  ELSE
                     TKMTH=LEFT(DTOS(DATE()),4)+'/'+SUBSTR(DTOS(DATE()),5,2)
                  ENDIF    
CREATE CURSOR TKE08 (F01 C(45),F02 C(43),F03 D(8),F04 N(13,4))
INDEX ON F02+DTOS(F03)+F01 TAG TKE08
SET ORDER TO 1
SELECT F01,F03,F04,F06,F07,F08 FROM B26 WHERE B26.F02=DPT_NO INTO CURSOR TKE081 ORDER BY F02,F01,F03,F06,F07,F08 NOWAIT
GO TOP
DO WHILE !EOF()
   SELECT TKE08
   APPEND BLANK
   REPLACE F01 WITH TKE081.F06+TKE081.F07+TKE081.F08
   REPLACE F02 WITH TKE081.F01
   REPLACE F03 WITH CTOD(TKMTH+'/'+TKE081.F03)   
   REPLACE F04 WITH TKE081.F04
   SELECT TKE081
   SKIP
ENDDO
SELECT TKE081
USE                  
************************ &&重算累計數量
*!*	GO TOP      
*!*	H=F02+F01
*!*	SEEK H
*!*	DO WHILE !EOF()   
*!*	   K=0
*!*	   IF FOUND()            
*!*	      DO WHILE F02+F01=H
*!*	         REPL F09 WITH F04+K  
*!*	         K=F09
*!*	         SKIP
*!*	      ENDDO
*!*	   ENDIF
*!*	   H=F02+F01
*!*	ENDDO  
*****************************
SELE F01,F02 FROM B26 GROUP BY F01 ORDER BY F01 WHERE F02=A14.F01 INTO CURSOR B26_1
INDE ON F02+F01 TAG B26_11
SELE B26_1
SET ORDER TO 1
SET RELA TO F01 INTO B01
SET RELA TO F02+F01 INTO B25 ADDI
GO TOP
WAIT CLEAR
********
B26FORM=CREATEOBJECT("TKB26")
B26FORM.SHOW  
DEFINE CLASS TKB26 AS FORM
  CAPTION='B26.庫存異動紀錄'
  CONTROLBOX=.F.
  BORDERSTYLE=3  
  MAXBUTTON=.F.
  MINBUTTON=.F.
  MOVABLE=.F.
  CLOSABLE=.F.
  CONTROLCOUNT=57
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*550
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WIDTH=INT_015*789
  WINDOWTYPE=1
  NAME='TKB26'
  ADD OBJECT SHAPE1 AS SHAPE1 WITH;
      AUTOCENTER=.T.
  ADD OBJECT LBL_REC AS LBL_REC WITH;
      AUTOCENTER =.T.
  ADD OBJECT REC_COUNT AS REC_COUNT  WITH;
      CAPTION=STR(RECCOUNT())        
  ADD OBJECT SHAPE2 AS SHAPE2 WITH;
      AUTOCENTER=.T.
  ADD OBJECT SHAPE3 AS SHAPE3 WITH;
      AUTOCENTER=.T.
  ADD OBJECT PAGEFRAME1 AS PAGEFRAME WITH;
      LEFT=INT_015*236,;
      WIDTH=INT_015*540,;
      HEIGHT=INT_015*200,;
      FONTSIZE=INT_015*9,;
      PAGECOUNT=2,;
      TABSTRETCH=1,;
      ACTIVEPAGE=1,;
      VISIBLE=.T.,;
      PAGE1.NAME='PAGE1',;
      PAGE1.VISIBLE=.T.,;
      PAGE1.CAPTION='表頭資料',;
      PAGE2.NAME='PAGE2',;
      PAGE2.VISIBLE=.T.,;
      PAGE2.CAPTION='表身詳細資料內容'   
  ADD OBJECT KEY_LIST AS KEY_LIST WITH;
      AUTOCENTER=.T.,;
      WIDTH=INT_015*130
  ADD OBJECT MTH_LIST AS MTH_LIST WITH;
      AUTOCENTER=.T.
  ADD OBJECT GRID1 AS GRID1 WITH;
      COLUMNCOUNT=2,;            
      RECORDSOURCE='B26_1',;      
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2'      
  ADD OBJECT GRID2 AS GRID2 WITH;
      COLUMNCOUNT=6,;            
      RECORDSOURCE='B26',; 
      LINKMASTER='B26_1',;
      RELATIONALEXPR='F02+F01',;
      CHILDORDER=B261,;  
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;
      COLUMN3.NAME='COLUMN3',;
      COLUMN4.NAME='COLUMN4',;
      COLUMN5.NAME='COLUMN5',;
      COLUMN6.NAME='COLUMN6'
  ADD OBJECT CMDGROUP AS CMDGROUP WITH;
      AUTOSIZE=.T.                             
  ADD OBJECT ORPGROUP AS ORPGROUP WITH;    
      AUTOSIZE=.T. 
 **********                   
  PROCEDURE PAGEFRAME1.PAGE1.INIT     
     THIS.ADDOBJECT('LBLF01','LABEL')
     WITH THIS.LBLF01
          .VISIBLE=.T.
          .LEFT=INT_015*14
          .TOP=INT_015*13
          .WIDTH=INT_015*50
          .CAPTION='料品編號'          
     ENDWITH
     THIS.ADDOBJECT('LBLF02','LABEL')
     WITH THIS.LBLF02
         .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*38
         .WIDTH=INT_015*50
         .CAPTION='品名規格'
     ENDWITH    
     THIS.ADDOBJECT('LBLF021','LABEL')         
     WITH THIS.LBLF021
         .VISIBLE=.T.
         .LEFT=INT_015*65
         .TOP=INT_015*38
         .AUTOSIZE=.T.
     ENDWITH
     THIS.ADDOBJECT('LBLF03','LABEL')
     WITH THIS.LBLF03
          .VISIBLE=.T.
          .LEFT=INT_015*14
          .TOP=INT_015*63
          .WIDTH=INT_015*50
          .CAPTION='期初庫存'
     ENDWITH
     THIS.ADDOBJECT('TXTF01','TEXTBOX')
     WITH THIS.TXTF01
          .VISIBLE=.T.
          .LEFT=INT_015*65
          .TOP=INT_015*11
          .WIDTH=INT_015*261
     ENDWITH          
     THIS.ADDOBJECT('TXTF03','TEXTBOX')
     WITH THIS.TXTF03
          .VISIBLE=.T.
          .LEFT=INT_015*65
          .WIDTH=INT_015*100
          .TOP=INT_015*60
     ENDWITH
  ENDPROC
*********     
  PROCEDURE PAGEFRAME1.PAGE2.INIT
	THIS.ADDOBJECT('LBLF03','LABEL')
	WITH THIS.LBLF03  
	     .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*18
	     .WIDTH=INT_015*50
         .CAPTION='異動日期'
    ENDWITH  
    THIS.ADDOBJECT('LBLF06','LABEL')
    WITH THIS.LBLF06
         .VISIBLE=.T.
	     .LEFT=INT_015*14
	     .TOP=INT_015*43
	     .WIDTH=INT_015*50
	     .CAPTION='單據類別'
	ENDWITH     
    THIS.ADDOBJECT('LBLF07','LABEL')
    WITH THIS.LBLF07
         .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*68
         .WIDTH=INT_015*50
         .CAPTION='單據編號'         
    ENDWITH     
    THIS.ADDOBJECT('LBLF04','LABEL')
    WITH THIS.LBLF04
         .VISIBLE=.T.
         .LEFT=INT_015*14
	     .TOP=INT_015*93
	     .WIDTH=INT_015*50
	     .CAPTION='異動數量'
	ENDWITH         
    THIS.ADDOBJECT('LBLF09','LABEL')
    WITH THIS.LBLF09
         .VISIBLE=.T.    
         .LEFT=INT_015*14
         .TOP=INT_015*118
         .WIDTH=INT_015*50
         .CAPTION='累計數量'       
    ENDWITH    
    THIS.ADDOBJECT('LBLF08','LABEL')
    WITH THIS.LBLF08
         .VISIBLE=.T.    
         .LEFT=INT_015*14
         .TOP=INT_015*143
         .WIDTH=INT_015*50
         .CAPTION='備        註'       
    ENDWITH        
    THIS.ADDOBJECT('TXTF03','TEXTBOX')
	WITH THIS.TXTF03      
	     .VISIBLE=.T.
	     .LEFT=INT_015*65
	     .TOP=INT_015*14
	     .WIDTH=INT_015*30
	     .HEIGHT=INT_015*25
	     .NAME='TXTF03'  
	ENDWITH     
     THIS.ADDOBJECT('TXTF06','TEXTBOX')
	WITH THIS.TXTF06
	     .VISIBLE=.T.
	     .LEFT=INT_015*65
	     .TOP=INT_015*39
	     .WIDTH=INT_015*100
	     .HEIGHT=INT_015*25
	     .NAME='TXTF06'	    
	ENDWITH     
    THIS.ADDOBJECT('TXTF07','TEXTBOX')
    WITH THIS.TXTF07
         .VISIBLE=.T.           
         .LEFT=INT_015*65
         .TOP=INT_015*64
         .WIDTH=INT_015*100
         .HEIGHT=INT_015*25
         .NAME='TXTF07'
    ENDWITH     
	THIS.ADDOBJECT('TXTF04','TEXTBOX')
	WITH THIS.TXTF04      
	     .VISIBLE=.T.
	     .LEFT=INT_015*65
	     .TOP=INT_015*89
	     .WIDTH=INT_015*100
	     .HEIGHT=INT_015*25
	     .NAME='TXTF04'  
	ENDWITH         
    THIS.ADDOBJECT('TXTF09','TEXTBOX')
    WITH THIS.TXTF09
         .VISIBLE=.T.           
         .LEFT=INT_015*65
         .TOP=INT_015*114
         .WIDTH=INT_015*100
         .HEIGHT=INT_015*25
         .NAME='TXTF09'
    ENDWITH         
    THIS.ADDOBJECT('TXTF08','TEXTBOX')
    WITH THIS.TXTF08
         .VISIBLE=.T.           
         .LEFT=INT_015*65
         .TOP=INT_015*139
         .WIDTH=INT_015*250
         .HEIGHT=INT_015*25
         .MAXLENGTH=34
         .NAME='TXTF08'
    ENDWITH             
  ENDPROC
*********         
  PROCEDURE PAGEFRAME1.PAGE1.ACTIVATE
     R=0
     SELE B26_1
     THISFORM.GRID1.ENABLED=.T.   
     THISFORM.GRID1.SETFOCUS   
     THISFORM.KEY_LIST.ENABLED=.T.
     THISFORM.MTH_LIST.ENABLED=.T.
    IF THISFORM.GRID1.ACTIVEROW=0 
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
        THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
        THISFORM.PAGEFRAME1.PAGE1.LBLF021.CAPTION=''             
        THISFORM.PAGEFRAME1.PAGE2.ENABLED=.F.      
     ELSE
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.
        THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)    &&判斷有無列印的權限  
        THISFORM.PAGEFRAME1.PAGE2.ENABLED=.T.
     ENDIF   
  ENDPROC
 ********** 
  PROCEDURE PAGEFRAME1.PAGE2.ACTIVATE
     SELE B26     
        THISFORM.GRID2.READONLY=.T.   
        THISFORM.GRID2.SETFOCUS       
     IF THISFORM.GRID2.ACTIVEROW=0 
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
        THISFORM.PAGEFRAME1.PAGE2.SETALL('VALUE','','TEXTBOX')
        THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE=0
        THISFORM.PAGEFRAME1.PAGE2.TXTF09.VALUE=0
     ELSE
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.
        THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)  &&&&判斷有無列印的權限  
     ENDIF   
     R=RECNO('&AREA1')
     THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(RECNO('&AREA1')=R,RGB(255,255,0),'')","COLUMN")
     THISFORM.GRID1.ENABLED=.F.     
     THISFORM.KEY_LIST.ENABLED=.F.     
     THISFORM.MTH_LIST.ENABLED=.F.     
  ENDPROC 
*********      
  PROC INIT       
       THISFORM.ORPGROUP.NEW_BOTT.VISIBLE=.F.
       THISFORM.ORPGROUP.EDIT_BOTT.VISIBLE=.F.       
       THISFORM.ORPGROUP.DEL_BOTT.VISIBLE=.F.              
       THISFORM.SETALL('HEIGHT',INT_015*25,'TEXTBOX')
       THISFORM.SETALL('HEIGHT',INT_015*17,'LABEL')
       THISFORM.SETALL('FONTSIZE',INT_015*9,'TEXTBOX')
       THISFORM.SETALL('FONTSIZE',INT_015*9,'LABEL')       
       THISFORM.SETALL('READONLY',.T.,'TEXTBOX')
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'COLUMN')
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'HEADER')   
       THISFORM.GRID1.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)
       THISFORM.GRID2.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)     
       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='料品編號'
       THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='品名規格'
       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='B26_1.F01'
       THISFORM.GRID1.COLUMN2.CONTROLSOURCE='B01.F02'
       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*149
       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*149
       THISFORM.GRID2.SETALL('FONTSIZE',INT_015*9,'COLUMN')
       THISFORM.GRID2.SETALL('FONTSIZE',INT_015*9,'HEADER')       
       THISFORM.GRID2.COLUMN1.HEADER1.CAPTION='日期'       
	   THISFORM.GRID2.COLUMN2.HEADER1.CAPTION='單據類別'	  
	   THISFORM.GRID2.COLUMN3.HEADER1.CAPTION='單據編號'
       THISFORM.GRID2.COLUMN4.HEADER1.CAPTION='異動數量'	   
	   THISFORM.GRID2.COLUMN5.HEADER1.CAPTION='累計數量'
       THISFORM.GRID2.COLUMN6.HEADER1.CAPTION='備註說明'
	   THISFORM.GRID2.LINKMASTER='B26_1'
       THISFORM.GRID2.RELATIONALEXPR='F02+F01'
	   THISFORM.GRID2.COLUMN1.CONTROLSOURCE='B26.F03'
	   THISFORM.GRID2.COLUMN2.CONTROLSOURCE='BILL(B26.F06)'
	   THISFORM.GRID2.COLUMN3.CONTROLSOURCE='B26.F07'
	   THISFORM.GRID2.COLUMN4.CONTROLSOURCE='B26.F04'
  	   THISFORM.GRID2.COLUMN5.CONTROLSOURCE="TRANSFORM(B25.F03+MRP_QTY(B26.F01,CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/'+B26.F03),B26.F06+B26.F07+B26.F08),'@R 999999999.999')"  &&'B26.F09+B25.F03'
   	   THISFORM.GRID2.COLUMN6.CONTROLSOURCE='B26.F08'
	   THISFORM.GRID2.COLUMN1.WIDTH=INT_015*30
       THISFORM.GRID2.COLUMN2.WIDTH=INT_015*100
       THISFORM.GRID2.COLUMN3.WIDTH=INT_015*80
       THISFORM.GRID2.COLUMN4.WIDTH=INT_015*100
       THISFORM.GRID2.COLUMN5.WIDTH=INT_015*100
       THISFORM.GRID2.COLUMN5.ALIGNMENT=1
       THISFORM.GRID2.COLUMN6.WIDTH=INT_015*200
       THISFORM.GRID1.READONLY=.T.      
       THISFORM.GRID2.READONLY=.T.            
       THISFORM.GRID1.SETFOCUS
       IF THISFORM.GRID1.ACTIVEROW=0
          THISFORM.CMDGROUP.ENABLED=.F.
       ELSE
          THISFORM.CMDGROUP.ENABLED=.T.       
       ENDIF          
       JK='料品編號'     
       CHK_STR=THISFORM.MTH_LIST.DISPLAYVALUE        
  ENDPROC            
***********     
  PROC KEY_LIST.INIT 
       WITH THIS
            SELE A14 
            GO TOP
            DO WHILE !EOF()               
                .ADDITEM(A14.F01+SPACE(2)+A14.F02)                    
              SKIP
            ENDDO         
       ENDWITH      
       SELE A14
       GO TOP
       THIS.DISPLAYVALUE=A14.F01+SPACE(2)+A14.F02
  ENDPROC 
*********  
  PROC KEY_LIST.INTERACTIVECHANGE    
       FLG='1'
       THISFORM.MTH_LIST.INTERACTIVECHANGE
  ENDPROC
**********       
  PROC MTH_LIST.INTERACTIVECHANGE
       CHK_STR=THIS.DISPLAYVALUE         
       THISFORM.GRID1.RECORDSOURCE=''
       THISFORM.GRID2.RECORDSOURCE=''
       THISFORM.GRID2.LINKMASTER=''
       THISFORM.GRID2.RELATIONALEXPR=''
       THISFORM.GRID2.CHILDORDER=''          
       WAIT WINDOW "資料重新匯入中,請稍後!" AT 0,150 NOWAIT NOCLEAR                  
       SELE B26
       SET RELA OFF INTO B26_1
       SET RELA OFF INTO B25
       USE
       SELE B26_1
       SET RELA OFF INTO B01
       USE     
       SELE B25
       USE  
       B25='B25'+LEFT(DTOS(CTOD(THIS.DISPLAYVALUE+'/01')),6)
       IF !USED('&B25')
          SELE 0
          USE (B25) ALIA B25
       ELSE
          SELE B25
       ENDIF
       SET ORDER TO 1    
       B26='B26'+LEFT(DTOS(CTOD(THIS.DISPLAYVALUE+'/01')),6)
       B261='B261'+LEFT(DTOS(CTOD(THIS.DISPLAYVALUE+'/01')),6)
       IF !USED('&B26')
          SELE 0
          USE (B26) ALIA B26
       ELSE
          SELE B26
       ENDIF
       SET ORDER TO 1      
********************************
      SELECT TKE08
      USE
      CREATE CURSOR TKE08 (F01 C(45),F02 C(43),F03 D(8),F04 N(13,4))
      INDEX ON F02+DTOS(F03)+F01 TAG TKE08
      SET ORDER TO 1
      SELECT F01,F03,F04,F06,F07,F08 FROM B26 WHERE B26.F02=LEFT(THISFORM.KEY_LIST.DISPLAYVALUE,5) INTO CURSOR TKE081 ORDER BY F02,F01,F03,F06,F07,F08 NOWAIT
      GO TOP
      DO WHILE !EOF()
         SELECT TKE08
         APPEND BLANK
         REPLACE F01 WITH TKE081.F06+TKE081.F07+TKE081.F08
         REPLACE F02 WITH TKE081.F01
         REPLACE F03 WITH CTOD(THIS.DISPLAYVALUE+'/'+TKE081.F03)   
         REPLACE F04 WITH TKE081.F04
         SELECT TKE081
         SKIP
      ENDDO
      SELECT TKE081
      USE                  
*********************************       
*!*	       IF FLG<>'1'  
*!*	          GO TOP
*!*	          H=F02+F01
*!*	          SEEK H
*!*	          DO WHILE !EOF()   
*!*	             K=0
*!*	             IF FOUND()            
*!*	                DO WHILE F02+F01=H
*!*	                   REPL F09 WITH F04+K  
*!*	                   K=F09
*!*	                   SKIP
*!*	                ENDDO
*!*	             ENDIF
*!*	             H=F02+F01
*!*	          ENDDO        
*!*	       ENDIF   
***********************************
       SELE F01,F02 FROM B26 GROUP BY F01 ORDER BY F01 WHERE F02=LEFT(THISFORM.KEY_LIST.DISPLAYVALUE,5) INTO CURSOR B26_1
       INDE ON F02+F01 TAG B26_11
       SELE B26_1
       SET ORDER TO 1
       SET RELA TO F01 INTO B01
       SET RELA TO F02+F01 INTO B25 ADDI
       GO TOP
       WAIT CLEAR
       THISFORM.GRID1.RECORDSOURCE='B26_1'
       THISFORM.GRID2.RECORDSOURCE='B26'
       THISFORM.GRID2.LINKMASTER='B26_1'
       THISFORM.GRID2.RELATIONALEXPR='F02+F01'      
       THISFORM.GRID2.CHILDORDER=B261  
       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='B26_1.F01'
       THISFORM.GRID1.COLUMN2.CONTROLSOURCE='B01.F02'       
       THISFORM.GRID2.COLUMN1.CONTROLSOURCE='B26.F03'
       THISFORM.GRID2.COLUMN2.CONTROLSOURCE='BILL(B26.F06)'
       THISFORM.GRID2.COLUMN3.CONTROLSOURCE='B26.F07'
       THISFORM.GRID2.COLUMN4.CONTROLSOURCE='B26.F04'
       THISFORM.GRID2.COLUMN5.CONTROLSOURCE="TRANSFORM(B25.F03+MRP_QTY(B26.F01,CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/'+B26.F03),B26.F06+B26.F07+B26.F08),'@R 999999999.999')"
       THISFORM.GRID2.COLUMN6.CONTROLSOURCE='B26.F08'            
       THISFORM.PAGEFRAME1.ACTIVEPAGE=1
       THISFORM.REFRESH
       THISFORM.GRID1.SETFOCUS        
       IF THISFORM.GRID1.ACTIVEROW=0
          THISFORM.CMDGROUP.ENABLED=.F.
          THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
       ELSE
          THISFORM.CMDGROUP.ENABLED=.T.      
          THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限    
       ENDIF          
       FLG='0'
  ENDPROC
**********  
  PROC GRID1.AFTERROWCOLCHANGE
       LPARAMETERS NCOLINDEX       
       THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=B26_1.F01
       THISFORM.PAGEFRAME1.PAGE1.LBLF021.CAPTION=B01.F02           
       THISFORM.PAGEFRAME1.PAGE1.TXTF03.VALUE=IIF(SEEK(B26_1.F02+B26_1.F01,'B25'),B25.F03,0)      
       FCH=THISFORM.ACTIVECONTROL.NAME
       JK=THIS.COLUMN1.HEADER1.CAPTION  
       IF THIS.ACTIVEROW=0
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
       ELSE
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.
       ENDIF          
       CHK=LEFT(THISFORM.KEY_LIST.DISPLAYVALUE,5)       
*       THISFORM.REFRESH
  ENDPROC
**********       
  PROC GRID2.AFTERROWCOLCHANGE
       LPARAMETERS NCOLINDEX
       THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=B26.F03
       THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE=B26.F04
       THISFORM.PAGEFRAME1.PAGE2.TXTF06.VALUE=BILL(B26.F06)
       THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE=B26.F07
       THISFORM.PAGEFRAME1.PAGE2.TXTF08.VALUE=B26.F08
       THISFORM.PAGEFRAME1.PAGE2.TXTF09.VALUE=B25.F03+MRP_QTY(B26.F01,CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/'+B26.F03),B26.F06+B26.F07+B26.F08)   &&B26.F09+B25.F03       
       FCH=THISFORM.ACTIVECONTROL.NAME
       JK=THIS.COLUMN1.HEADER1.CAPTION
       CHK=LEFT(THISFORM.KEY_LIST.DISPLAYVALUE,5)+THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
       IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
       ENDIF   
*       THISFORM.REFRESH
  ENDPROC 
ENDDEFINE    
***********************************************列印程序
PROCEDURE PNT_PRC  
     LK=B26_1.F02+B26_1.F01          
     SELECT B26.F01,;
            B26.F02,;
            B26.F03,;
            B26.F04,;
            B26.F06,;
            B26.F07,;                    
            B26.F08,;                                
            B26.F09,;          
            B25.F03+MRP_QTY(B26.F01,CTOD(CHK_STR+'/'+B26.F03),B26.F06+B26.F07+B26.F08) AS TMPMRP,;  
            A14.F02,;
            B01.F02;                                
     FROM B26,A14,B01 WHERE B26.F02+B26.F01=LK AND A14.F01=LEFT(LK,5) AND B01.F01=B26.F01; 
     ORDER BY B26.F03,B26.F06,B26.F07,B26.F08 NOWAIT
     IF _TALLY >0
        REPORT FORM ALLTRIM(INT_116)+'B26' PREVIEW
*         REPORT FORM B26TEST TO PRINT PROMPT 
     ENDIF  
ENDPROC
************************************************單據類別     
FUNC BILL
     PARA JUK
     JO=''
     DO CASE
        CASE JUK='A'
             JO='進貨單'
        CASE JUK='B'
             JO='進貨退出單'
        CASE JUK='C'
             JO='出貨單'
        CASE JUK='D'
             JO='出貨退回單'
        CASE JUK='E'
             JO='移轉單'
        CASE JUK='F'
             JO='樣品申請單(廠商)'   
        CASE JUK='G'
             JO='客供品進貨單'                 
        CASE JUK='H'
             JO='盤差調整單'
        CASE JUK='I'
             JO='報廢單'          
        CASE JUK='J'
             JO='客供品進貨退回單'                       
        CASE JUK='K'
             JO='製令用料耗損單'
        CASE JUK='L'
             JO='退回入倉單'
        CASE JUK='M'
             JO='委外入庫單'             
        CASE JUK='N'
             JO='進貨檢驗單'
        CASE JUK='P'
             JO='製令領料單'             
        CASE JUK='Q'
             JO='額外生產耗料單'         
        CASE JUK='R'
             JO='製品退出單'                      
        CASE JUK='T'
             JO='完工入庫單'  
        CASE JUK='U'
             JO='借入單'   
        CASE JUK='V'
             JO='借入還出單'                          
        CASE JUK='W'
             JO='借出單'    
        CASE JUK='X'
             JO='借出還入單'                                       
        CASE JUK='Z'
             JO='樣品領用單'     
     ENDCASE
     RETURN JO                  