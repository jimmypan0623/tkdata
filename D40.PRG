**程式名稱:D40.廠商樣品入貨記錄
SET EXCL OFF
CLOSE ALL
CLEAR 
AREA1='D40_TEMP'
FLG='0'
FCH=''
CHK=''
CHK_STR =''
IF !USED('A01')
   SELE 0
   USE A01 INDE A01
ELSE
   SELE A01
ENDIF
SET ORDER TO A01      
IF !USED('A02')
   SELE 0
   USE A02 INDE A02
ELSE
   SELE A02
ENDIF
SET ORDER TO A021      
SEEK SYS_OPER+'D40'    
IF !USED('A23')
    SELE 0
    USE A23
ELSE 
   SELE A23
ENDIF
SET ORDER TO A231 
IF !USED('A14')
    SELE 0
    USE A14
ELSE 
   SELE A14
ENDIF
SET ORDER TO A141
IF !USED ('C01')
   SELE 0
   USE C01 
ELSE 
   SELE C01
ENDIF
SET ORDER TO C011  
IF !USED ('D01')
   SELE 0
   USE D01 
ELSE 
   SELE D01
ENDIF
SET ORDER TO D011  
IF !USED ('B01')
   SELE 0
   USE B01 
ELSE 
   SELE B01
ENDIF
SET ORDER TO B011              
IF !USED('D40')
   SELE 0
   USE D40
ELSE
   SELE D40
ENDIF
SET ORDER TO D401 
SELECT D40.* FROM D40 WHERE LEFT(DTOS(D40.F03),6) = LEFT(DTOS(DATE()),6) ORDER BY D40.F04,D40.F03 INTO CURSOR D40_TEMP READWRITE 
SELECT D40_TEMP
INDEX ON F04+DTOS(F03)+F02 TAG D40_TEMP1 
INDEX ON F02+DTOS(F03)+F04 TAG D40_TEMP2
INDEX ON F01+DTOS(F03)+F02 TAG D40_TEMP3
INDEX ON F06+DTOS(F03)+F02 TAG D40_TEMP4
SET RELA TO F01 INTO D01
SET RELA TO F06 INTO C01 ADDI
SET RELA TO F02 INTO B01 ADDI
*********
D40FORM=CREATEOBJECT("TKD40")
D40FORM.SHOW  
DEFINE CLASS TKD40 AS FORM
  CAPTION='D40.廠商樣品入貨記錄'
*!*	  AUTOCENTER=.T.
  CONTROLBOX=.F.
  BORDERSTYLE=1  
  MAXBUTTON=.F.
  MINBUTTON=.F.
  MOVABLE=.F.
  CLOSABLE=.F.
  CONTROLCOUNT=57
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*550
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WIDTH=INT_015*789
  WINDOWTYPE=1
  ADD OBJECT KEY_LIST AS KEY_LIST WITH;
      WIDTH=INT_015*230 
  ADD OBJECT KEY_LIST1 AS KEY_LIST WITH;
      LEFT=INT_015*240,;
      WIDTH=INT_015*73  
  ADD OBJECT MTH_LIST AS MTH_LIST WITH;
      LEFT=INT_015*315,;
      WIDTH=INT_015*65 
  ADD OBJECT GRID1 AS GRID1 WITH;
      COLUMNCOUNT=10,;            
      RECORDSOURCE='D40_TEMP',; 
      HEIGHT=INT_015*500,;     
      WIDTH=INT_015*780,;     
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;
      COLUMN3.NAME='COLUMN3',; 
      COLUMN4.NAME='COLUMN4',; 
      COLUMN5.NAME='COLUMN5',;             
      COLUMN6.NAME='COLUMN6',; 
      COLUMN7.NAME='COLUMN7',;      
      COLUMN8.NAME='COLUMN8',;
      COLUMN9.NAME='COLUMN9',;  
      COLUMN10.NAME='COLUMN10'   
  ADD OBJECT ORPGROUP AS ORPGROUP WITH;      
      TOP=INT_015*0,;
      LEFT=INT_015*469
  ADD OBJECT CMDGROUP AS CMDGROUP WITH;
      TOP=INT_015*0,;
      LEFT=INT_015*385,;
      ENABLED=.T.,;
      VISIBLE=.T.     
*********                
  PROCEDURE INIT
       SELE D40_TEMP
       SET ORDER TO D40_TEMP1
       GO TOP
	   CHK_STR = THISFORM.MTH_LIST.DISPLAYVALUE
       THISFORM.ORPGROUP.NEW_BOTT.VISIBLE=.F.
       THISFORM.ORPGROUP.EDIT_BOTT.VISIBLE=.F.
       THISFORM.ORPGROUP.DEL_BOTT.VISIBLE=.F.    
       THISFORM.GRID1.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'COLUMN')
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'HEADER')  
       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*75 
       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*65
       THISFORM.GRID1.COLUMN3.WIDTH=INT_015*200
       THISFORM.GRID1.COLUMN4.WIDTH=INT_015*150
       THISFORM.GRID1.COLUMN5.WIDTH=INT_015*55
       THISFORM.GRID1.COLUMN6.WIDTH=INT_015*60
       THISFORM.GRID1.COLUMN7.WIDTH=INT_015*60
       THISFORM.GRID1.COLUMN8.WIDTH=INT_015*80	 
       THISFORM.GRID1.COLUMN9.WIDTH=INT_015*110   
       THISFORM.GRID1.COLUMN10.WIDTH=INT_015*110 
       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='入貨單號'
       THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='入貨日期'
       THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='料品編號'
       THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='品名規格'
       THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='入貨數量' 
	   THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='進貨廠商'
       THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='需求對象' 
       THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='P20申請單號'  	
       THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='安全資料'  
       THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='確認人員'    
       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='D40_TEMP.F04'	
       THISFORM.GRID1.COLUMN2.CONTROLSOURCE='D40_TEMP.F03'   
       THISFORM.GRID1.COLUMN3.CONTROLSOURCE='D40_TEMP.F02'
       THISFORM.GRID1.COLUMN4.CONTROLSOURCE='B01.F02'
       THISFORM.GRID1.COLUMN5.CONTROLSOURCE='D40_TEMP.F05'
       THISFORM.GRID1.COLUMN6.CONTROLSOURCE='D01.F04'
       THISFORM.GRID1.COLUMN7.CONTROLSOURCE='C01.F05'
       THISFORM.GRID1.COLUMN8.CONTROLSOURCE='D40_TEMP.F07'
       THISFORM.GRID1.COLUMN9.CONTROLSOURCE='D40_TEMP.F99'
       THISFORM.GRID1.COLUMN10.CONTROLSOURCE='D40_TEMP.F98'
       THISFORM.GRID1.READONLY=.T.
       THISFORM.GRID1.SETFOCUS  
       IF THISFORM.GRID1.ACTIVEROW=0 
          THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
	      THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
	      THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
	      THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.    
	      THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.	        
	      THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F. 
        ELSE
          THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
	      THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
	      THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
	      THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.    
	      THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.	        
	      THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限 
        ENDIF  
       JK='入貨單號'    
  ENDPROC      
*********      
  PROC GRID1.AFTERROWCOLCHANGE
       LPARAMETERS NCOLINDEX       
       FCH=THISFORM.ACTIVECONTROL.NAME
       CHK=''
       THISFORM.REFRESH
  ENDPROC    
*********     
  PROC KEY_LIST.INIT
       WITH THIS 
           .ADDITEM('依入貨單號+入貨日期+料品編號 排列')
           .ADDITEM('依料品編號+入貨日期+入貨單號 排列')
           .ADDITEM('依進貨廠商+入貨日期+料品編號 排列')
           .ADDITEM('依需求對象+入貨日期+料品編號 排列') 
       ENDWITH     
  ENDPROC
  PROC KEY_LIST1.INIT
       WITH THIS 
           .ADDITEM('月份資料')
           .ADDITEM('全部資料')
       ENDWITH     
  ENDPROC
*********  
  PROC KEY_LIST.INTERACTIVECHANGE
       SELE D40_TEMP
       DO CASE	
          CASE THIS.DISPLAYVALUE='依入貨單號+入貨日期+料品編號 排列'
               SET ORDER TO D40_TEMP1
		       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*75 
		       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*65
		       THISFORM.GRID1.COLUMN3.WIDTH=INT_015*200
		       THISFORM.GRID1.COLUMN4.WIDTH=INT_015*150
		       THISFORM.GRID1.COLUMN5.WIDTH=INT_015*55
		       THISFORM.GRID1.COLUMN6.WIDTH=INT_015*60
		       THISFORM.GRID1.COLUMN7.WIDTH=INT_015*60
		       THISFORM.GRID1.COLUMN8.WIDTH=INT_015*80	 
		       THISFORM.GRID1.COLUMN9.WIDTH=INT_015*110   
		       THISFORM.GRID1.COLUMN10.WIDTH=INT_015*110 
		       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='入貨單號'
		       THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='入貨日期'
		       THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='料品編號'
		       THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='品名規格'
		       THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='入貨數量' 
			   THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='進貨廠商'
		       THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='需求對象' 
		       THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='P20申請單號'  	
		       THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='安全資料'  
		       THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='確認人員'    
		       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='D40_TEMP.F04'	
		       THISFORM.GRID1.COLUMN2.CONTROLSOURCE='D40_TEMP.F03'   
		       THISFORM.GRID1.COLUMN3.CONTROLSOURCE='D40_TEMP.F02'
		       THISFORM.GRID1.COLUMN4.CONTROLSOURCE='B01.F02'
		       THISFORM.GRID1.COLUMN5.CONTROLSOURCE='D40_TEMP.F05'
		       THISFORM.GRID1.COLUMN6.CONTROLSOURCE='D01.F04'
		       THISFORM.GRID1.COLUMN7.CONTROLSOURCE='C01.F05'
		       THISFORM.GRID1.COLUMN8.CONTROLSOURCE='D40_TEMP.F07'
		       THISFORM.GRID1.COLUMN9.CONTROLSOURCE='D40_TEMP.F99'
		       THISFORM.GRID1.COLUMN10.CONTROLSOURCE='D40_TEMP.F98'
		       JK = '入貨單號'
          CASE THIS.DISPLAYVALUE='依料品編號+入貨日期+入貨單號 排列'
               SET ORDER TO D40_TEMP2
		       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*200
		       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*150
		       THISFORM.GRID1.COLUMN3.WIDTH=INT_015*75 
		       THISFORM.GRID1.COLUMN4.WIDTH=INT_015*65
		       THISFORM.GRID1.COLUMN5.WIDTH=INT_015*55
		       THISFORM.GRID1.COLUMN6.WIDTH=INT_015*60
		       THISFORM.GRID1.COLUMN7.WIDTH=INT_015*60
		       THISFORM.GRID1.COLUMN8.WIDTH=INT_015*80	 
		       THISFORM.GRID1.COLUMN9.WIDTH=INT_015*110   
		       THISFORM.GRID1.COLUMN10.WIDTH=INT_015*110 
		       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='料品編號'
		       THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='品名規格'
		       THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='入貨單號'
		       THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='入貨日期'
		       THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='入貨數量' 
			   THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='進貨廠商'
		       THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='需求對象' 
		       THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='P20申請單號'  	
		       THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='安全資料'  
		       THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='確認人員'    
		       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='D40_TEMP.F02'
		       THISFORM.GRID1.COLUMN2.CONTROLSOURCE='B01.F02'
		       THISFORM.GRID1.COLUMN3.CONTROLSOURCE='D40_TEMP.F04'	
		       THISFORM.GRID1.COLUMN4.CONTROLSOURCE='D40_TEMP.F03'   
		       THISFORM.GRID1.COLUMN5.CONTROLSOURCE='D40_TEMP.F05'
		       THISFORM.GRID1.COLUMN6.CONTROLSOURCE='D01.F04'
		       THISFORM.GRID1.COLUMN7.CONTROLSOURCE='C01.F05'
		       THISFORM.GRID1.COLUMN8.CONTROLSOURCE='D40_TEMP.F07'
		       THISFORM.GRID1.COLUMN9.CONTROLSOURCE='D40_TEMP.F99'
		       THISFORM.GRID1.COLUMN10.CONTROLSOURCE='D40_TEMP.F98'
		       JK = '料品編號'
	 	  CASE THIS.DISPLAYVALUE='依進貨廠商+入貨日期+料品編號 排列'
               SET ORDER TO D40_TEMP3
               THISFORM.GRID1.COLUMN1.WIDTH=INT_015*60
		       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*75 
		       THISFORM.GRID1.COLUMN3.WIDTH=INT_015*65
		       THISFORM.GRID1.COLUMN4.WIDTH=INT_015*200
		       THISFORM.GRID1.COLUMN5.WIDTH=INT_015*150
		       THISFORM.GRID1.COLUMN6.WIDTH=INT_015*55 
		       THISFORM.GRID1.COLUMN7.WIDTH=INT_015*60
		       THISFORM.GRID1.COLUMN8.WIDTH=INT_015*80	 
		       THISFORM.GRID1.COLUMN9.WIDTH=INT_015*110   
		       THISFORM.GRID1.COLUMN10.WIDTH=INT_015*110 
		       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='進貨廠商'
		       THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='入貨單號'
		       THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='入貨日期'
		       THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='料品編號'
		       THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='品名規格'
		       THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='入貨數量' 
		       THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='需求對象' 
		       THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='P20申請單號'  	
		       THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='安全資料'  
		       THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='確認人員'   
		       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='D01.F04' 
		       THISFORM.GRID1.COLUMN2.CONTROLSOURCE='D40_TEMP.F04'	
		       THISFORM.GRID1.COLUMN3.CONTROLSOURCE='D40_TEMP.F03'   
		       THISFORM.GRID1.COLUMN4.CONTROLSOURCE='D40_TEMP.F02'
		       THISFORM.GRID1.COLUMN5.CONTROLSOURCE='B01.F02'
		       THISFORM.GRID1.COLUMN6.CONTROLSOURCE='D40_TEMP.F05' 
		       THISFORM.GRID1.COLUMN7.CONTROLSOURCE='C01.F05'
		       THISFORM.GRID1.COLUMN8.CONTROLSOURCE='D40_TEMP.F07'
		       THISFORM.GRID1.COLUMN9.CONTROLSOURCE='D40_TEMP.F99'
		       THISFORM.GRID1.COLUMN10.CONTROLSOURCE='D40_TEMP.F98'  
		       JK = '廠商編號'    
          CASE THIS.DISPLAYVALUE='依需求對象+入貨日期+料品編號 排列'
               SET ORDER TO D40_TEMP4
               THISFORM.GRID1.COLUMN1.WIDTH=INT_015*60
		       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*75 
		       THISFORM.GRID1.COLUMN3.WIDTH=INT_015*65
		       THISFORM.GRID1.COLUMN4.WIDTH=INT_015*200
		       THISFORM.GRID1.COLUMN5.WIDTH=INT_015*150
		       THISFORM.GRID1.COLUMN6.WIDTH=INT_015*55
		       THISFORM.GRID1.COLUMN7.WIDTH=INT_015*60      
		       THISFORM.GRID1.COLUMN8.WIDTH=INT_015*80	 
		       THISFORM.GRID1.COLUMN9.WIDTH=INT_015*110   
		       THISFORM.GRID1.COLUMN10.WIDTH=INT_015*110 
		       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='需求對象'
		       THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='入貨單號'
		       THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='入貨日期'
		       THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='料品編號'
		       THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='品名規格'
		       THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='入貨數量' 
			   THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='進貨廠商' 
		       THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='P20申請單號'  	
		       THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='安全資料'  
		       THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='確認人員'  
		       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='C01.F05'  
		       THISFORM.GRID1.COLUMN2.CONTROLSOURCE='D40_TEMP.F04'	
		       THISFORM.GRID1.COLUMN3.CONTROLSOURCE='D40_TEMP.F03'   
		       THISFORM.GRID1.COLUMN4.CONTROLSOURCE='D40_TEMP.F02'
		       THISFORM.GRID1.COLUMN5.CONTROLSOURCE='B01.F02'
		       THISFORM.GRID1.COLUMN6.CONTROLSOURCE='D40_TEMP.F05'
		       THISFORM.GRID1.COLUMN7.CONTROLSOURCE='D01.F04' 
		       THISFORM.GRID1.COLUMN8.CONTROLSOURCE='D40_TEMP.F07'
		       THISFORM.GRID1.COLUMN9.CONTROLSOURCE='D40_TEMP.F99'
		       THISFORM.GRID1.COLUMN10.CONTROLSOURCE='D40_TEMP.F98'  
		       JK = '客戶編號'            
       ENDCASE       
       THISFORM.GRID1.SETFOCUS      
  ENDPROC
  PROC KEY_LIST1.INTERACTIVECHANGE
		THISFORM.GRID1.RECORDSOURCE=''
		SELECT D40_TEMP
		USE
        DO CASE
           CASE THIS.DISPLAYVALUE='月份資料'
                THISFORM.MTH_LIST.ENABLED = .T.
                CHK_STR = ALLTRIM(THISFORM.MTH_LIST.DISPLAYVALUE)
           CASE THIS.DISPLAYVALUE='全部資料'
                THISFORM.MTH_LIST.ENABLED = .F.
                CHK_STR = 'Y'
        ENDCASE   
		SELECT D40.* FROM D40 WHERE IIF(CHK_STR = 'Y',.T.,LEFT(DTOS(D40.F03),6) = LEFT(DTOS(CTOD(CHK_STR+'/01')),6)) ORDER BY D40.F04,D40.F03 INTO CURSOR D40_TEMP READWRITE 
		SELECT D40_TEMP
		INDEX ON F04+DTOS(F03)+F02 TAG D40_TEMP1 
		INDEX ON F02+DTOS(F03)+F04 TAG D40_TEMP2
		INDEX ON F01+DTOS(F03)+F02 TAG D40_TEMP3
		INDEX ON F06+DTOS(F03)+F02 TAG D40_TEMP4
		SET RELA TO F01 INTO D01
		SET RELA TO F06 INTO C01 ADDI
		SET RELA TO F02 INTO B01 ADDI
		SELECT D40_TEMP
		GO TOP
		THISFORM.GRID1.RECORDSOURCE='D40_TEMP'
        THISFORM.KEY_LIST.INTERACTIVECHANGE
	   THISFORM.GRID1.SETFOCUS        
	   THISFORM.REFRESH
       IF  THISFORM.GRID1.ACTIVEROW=0 
           THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
	      THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
	      THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
	      THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.    
	      THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.	        
	      THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F. 
        ELSE
          THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
	      THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
	      THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
	      THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.    
	      THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.	        
	      THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限 
        ENDIF 
  ENDPROC
   PROC MTH_LIST.INTERACTIVECHANGE
		CHK_STR = ALLTRIM(THIS.DISPLAYVALUE)
		THISFORM.GRID1.RECORDSOURCE=''
		SELECT D40_TEMP
		USE   
		SELECT D40.* FROM D40 WHERE IIF(CHK_STR = 'Y',.T.,LEFT(DTOS(D40.F03),6) = LEFT(DTOS(CTOD(CHK_STR+'/01')),6)) ORDER BY D40.F04,D40.F03 INTO CURSOR D40_TEMP 
		SELECT D40_TEMP
		INDEX ON F04+DTOS(F03)+F02 TAG D40_TEMP1 
		INDEX ON F02+DTOS(F03)+F04 TAG D40_TEMP2
		INDEX ON F01+DTOS(F03)+F02 TAG D40_TEMP3
		INDEX ON F06+DTOS(F03)+F02 TAG D40_TEMP4
		SET RELA TO F01 INTO D01
		SET RELA TO F06 INTO C01 ADDI
		SET RELA TO F02 INTO B01 ADDI
		SELECT D40_TEMP
		GO TOP
		THISFORM.GRID1.RECORDSOURCE='D40_TEMP'
        THISFORM.KEY_LIST.INTERACTIVECHANGE
	   THISFORM.GRID1.SETFOCUS        
	   THISFORM.REFRESH
       IF  THISFORM.GRID1.ACTIVEROW=0 
           THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
	      THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
	      THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
	      THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.    
	      THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.	        
	      THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F. 
        ELSE
          THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
	      THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
	      THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
	      THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.    
	      THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.	        
	      THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限 
        ENDIF 
  ENDPROC
ENDDEFINE        
***********************************************列印程序
PROCEDURE PNT_PRC     
   FLG='0' 
   ANS_RANGE=CREATEOBJECT("ANS_RANGE")  
   ANS_RANGE.SHOW     
   FLG='0' 
   SELECT D40_TEMP      
ENDPROC
***********************************************列印範圍選定
DEFINE CLASS ANS_RANGE AS FORM
      AUTOCENTER=.T.
      CAPTION='請輸入列印資料範圍'
      FONTSIZE=INT_015*9
      HEIGHT=INT_015*120
      WIDTH=INT_015*330
      FONTSIZE=INT_015*9
	  MAXBUTTON=.F.
	  MINBUTTON=.F.
	  MOVABLE=.F.
	  CLOSABLE=.F.    
	  CONTROLBOX=.F.
	  BORDERSTYLE=2
	  SHOWTIPS=.T.
	  SHOWWINDOW=1
	  WINDOWTYPE=1
      NAME='ANS_RANGE'
       ADD OBJECT LABEL1 AS LABEL WITH;
           AUTOSIZE=.T.,;
           HEIGHT=INT_015*25,;
           LEFT=INT_015*10,;
           TOP=INT_015*10,;
           NAME='LABEL1'   
       ADD OBJECT TEXT1 AS TEXTBOX WITH;
           AUTOSIZE=.T.,;
           TOP=INT_015*5,;
           LEFT=INT_015*90,;
           HEIGHT=INT_015*25,; 
           NAME='TEXT1' 
       ADD OBJECT LABEL2 AS LABEL WITH;
           AUTOSIZE=.T.,;
           HEIGHT=INT_015*25,;
           LEFT=INT_015*10,;
           TOP=INT_015*35,;
           NAME='LABEL2'       
       ADD OBJECT TEXT2 AS TEXTBOX WITH;
           AUTOSIZE=.T.,;
           TOP=INT_015*30,;
           LEFT=INT_015*90,;
           HEIGHT=INT_015*25,;         
           NAME='TEXT2'    
       ADD OBJECT LABEL3 AS LABEL WITH;
           AUTOSIZE=.T.,;
           HEIGHT=INT_015*25,;
           LEFT=INT_015*10,;
           TOP=INT_015*60,;
           CAPTION='起始入貨日期',;
           NAME='LABEL3'   
       ADD OBJECT TEXT3 AS TEXTBOX WITH;
           TOP=INT_015*55,;
           LEFT=INT_015*90,;
           HEIGHT=INT_015*25,; 
           WIDTH=INT_015*70,;
           NAME='TEXT3' 
       ADD OBJECT LABEL4 AS LABEL WITH;
           AUTOSIZE=.T.,;
           HEIGHT=INT_015*25,;
           LEFT=INT_015*170,;
           TOP=INT_015*60,;
           CAPTION='截止入貨日期',;
           NAME='LABEL4'   
       ADD OBJECT TEXT4 AS TEXTBOX WITH;
           TOP=INT_015*55,;
           LEFT=INT_015*250,;
           HEIGHT=INT_015*25,; 
           WIDTH=INT_015*70,;
           NAME='TEXT4'  
       ADD OBJECT CMND1 AS COMMANDBUTTON WITH;
           AUTOSIZE=.T.,;
           LEFT=INT_015*90,;    
           HEIGHT=INT_015*25,;   
           TOP=INT_015*90,;  
           WIDTH=INT_015*70,;
           CAPTION='\<P.列印',;
           TOOLTIPTEXT='列印所選擇的鍵值!快速鍵->ALT+P',;
           NAME='CMND1'
       ADD OBJECT CMND2 AS COMMANDBUTTON WITH;
           AUTOSIZE=.T.,;
           LEFT=INT_015*220,;
           TOP=INT_015*90,;
           HEIGHT=INT_015*25,;
           WIDTH=INT_015*70,;
           CAPTION='\<C.取消',;
           TOOLTIPTEXT='取消作業!快速鍵->ALT+C',;
           NAME='CMND2'
 *************          
  PROCEDURE INIT 
      THISFORM.SETALL('FONTSIZE',INT_015*9,'TEXTBOX')
      THISFORM.SETALL('FONTSIZE',INT_015*9,'LABEL')      
      THISFORM.SETALL('FONTSIZE',INT_015*9,'COMMANDBUTTON')
      DO CASE
         CASE KEY()='F04+DTOS(F03)+F02'
              THISFORM.LABEL1.CAPTION='起始入貨單號'
              THISFORM.LABEL2.CAPTION='截止入貨單號'  
              THISFORM.TEXT1.WIDTH=INT_015*80
              THISFORM.TEXT2.WIDTH=INT_015*80   
              THISFORM.TEXT1.MAXLENGTH=10 
              THISFORM.TEXT2.MAXLENGTH=10
              THISFORM.TEXT1.VALUE=D40_TEMP.F04
              THISFORM.TEXT2.VALUE=D40_TEMP.F04  
         CASE KEY()='F02+DTOS(F03)+F04'    
              THISFORM.LABEL1.CAPTION='起始料品編號'
              THISFORM.LABEL2.CAPTION='截止料品編號'
              THISFORM.TEXT1.WIDTH=INT_015*230
              THISFORM.TEXT2.WIDTH=INT_015*230   
              THISFORM.TEXT1.MAXLENGTH=43 
              THISFORM.TEXT2.MAXLENGTH=43
              THISFORM.TEXT1.VALUE=D40_TEMP.F02
              THISFORM.TEXT2.VALUE=D40_TEMP.F02
         CASE KEY()='F01+DTOS(F03)+F02'    
              THISFORM.LABEL1.CAPTION='起始廠商編號'
              THISFORM.LABEL2.CAPTION='截止廠商編號'
              THISFORM.TEXT1.WIDTH=INT_015*70
              THISFORM.TEXT2.WIDTH=INT_015*70      
              THISFORM.TEXT1.MAXLENGTH=5
              THISFORM.TEXT2.MAXLENGTH=5
              THISFORM.TEXT1.VALUE=D40_TEMP.F01
              THISFORM.TEXT2.VALUE=D40_TEMP.F01 
         CASE KEY()='F06+DTOS(F03)+F02'    
              THISFORM.LABEL1.CAPTION='起始客戶編號'
              THISFORM.LABEL2.CAPTION='截止客戶編號'
              THISFORM.TEXT1.WIDTH=INT_015*70
              THISFORM.TEXT2.WIDTH=INT_015*70   
              THISFORM.TEXT1.MAXLENGTH=5 
              THISFORM.TEXT2.MAXLENGTH=5
              THISFORM.TEXT1.VALUE=D40_TEMP.F06
              THISFORM.TEXT2.VALUE=D40_TEMP.F06
      ENDCASE  
      THISFORM.TEXT1.SETFOCUS
      THISFORM.TEXT3.VALUE=D40_TEMP.F03
      THISFORM.TEXT4.VALUE=D40_TEMP.F03
  ENDPROC    
  PROCEDURE CMND1.CLICK 
      DO CASE
         CASE KEY()='F04+DTOS(F03)+F02'
		      SELECT D40.*,C01.F05,D01.F04 FROM D40,C01,D01;
          		    WHERE D40.F01=D01.F01 AND D40.F06=C01.F01 AND ;
          		    D40.F04>=THISFORM.TEXT1.VALUE AND D40.F04<=THISFORM.TEXT2.VALUE AND ;
          		    D40.F03>=THISFORM.TEXT3.VALUE AND D40.F03<=THISFORM.TEXT4.VALUE ORDER BY D40.F04,D40.F03,D40.F02 NOWAIT
              IF _TALLY >0              
                 REPORT FORM ALLTRIM(INT_116)+'D40A' TO PRINT PROMPT PREVIEW    
                 FLG='1'   
              ENDIF   
         CASE KEY()='F02+DTOS(F03)+F04' 
		      SELECT D40.*,C01.F05,D01.F04 FROM D40,C01,D01;
          		    WHERE D40.F01=D01.F01 AND D40.F06=C01.F01 AND ;
          		    D40.F02>=THISFORM.TEXT1.VALUE AND D40.F02<=THISFORM.TEXT2.VALUE AND ;
          		    D40.F03>=THISFORM.TEXT3.VALUE AND D40.F03<=THISFORM.TEXT4.VALUE ORDER BY D40.F04,D40.F03,D40.F02 NOWAIT
              IF _TALLY >0              
                 REPORT FORM ALLTRIM(INT_116)+'D40B' TO PRINT PROMPT PREVIEW    
                 FLG='1'   
              ENDIF  
         CASE KEY()='F01+DTOS(F03)+F02'
		      SELECT D40.*,C01.F05,D01.F04 FROM D40,C01,D01;
          		    WHERE D40.F01=D01.F01 AND D40.F06=C01.F01 AND ;
          		    D40.F01>=THISFORM.TEXT1.VALUE AND D40.F01<=THISFORM.TEXT2.VALUE AND ;
          		    D40.F03>=THISFORM.TEXT3.VALUE AND D40.F03<=THISFORM.TEXT4.VALUE ORDER BY D40.F04,D40.F03,D40.F02 NOWAIT
              IF _TALLY >0              
                 REPORT FORM ALLTRIM(INT_116)+'D40C' TO PRINT PROMPT PREVIEW    
                 FLG='1'   
              ENDIF 
         CASE KEY()='F06+DTOS(F03)+F02'
		      SELECT D40.*,C01.F05,D01.F04 FROM D40,C01,D01;
          		    WHERE D40.F01=D01.F01 AND D40.F06=C01.F01 AND ;
          		    D40.F06>=THISFORM.TEXT1.VALUE AND D40.F06<=THISFORM.TEXT2.VALUE AND ;
          		    D40.F03>=THISFORM.TEXT3.VALUE AND D40.F03<=THISFORM.TEXT4.VALUE ORDER BY D40.F04,D40.F03,D40.F02 NOWAIT
              IF _TALLY >0              
                 REPORT FORM ALLTRIM(INT_116)+'D40D' TO PRINT PROMPT PREVIEW    
                 FLG='1'   
              ENDIF  
      ENDCASE
   	  IF FLG<>'1'
         =MESSAGEBOX('無此範圍資料',0+48,'警示')
         THISFORM.TEXT1.SETFOCUS
      ELSE
         THISFORM.CMND2.CLICK
      ENDIF                       
  ENDPROC
  PROCEDURE CMND2.CLICK
      FLG='1'   
      THISFORM.RELEASE
  ENDPROC      
ENDDEFINE         