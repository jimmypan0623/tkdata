***K03.會計常用分錄
CLOSE ALL
CLEAR 
FLG='0'
FCH=''
CHK=''
R=0
AREA1='K18'
AREA2='K19'
IF !USED('A01')
   SELE 0
   USE A01 INDE A01
ELSE
   SELE A01
ENDIF
SET ORDER TO A01
IF !USED('A02')
   SELE 0
   USE A02 INDE A02
ELSE 
   SELE A02
ENDIF
SET ORDER TO A021      
SEEK SYS_OPER+'K03'   
IF !USED('K03')
   SELE 0
   USE K03 INDE K03
ELSE 
   SELE K03
ENDIF
SET ORDER TO 1 
IF !USED('K18')
   SELE 0
   USE K18 INDE K18
ELSE 
   SELE K18
ENDIF
SET ORDER TO 1 
IF !USED('K19')
   SELE 0
   USE K19 INDE K19
ELSE 
   SELE K19
ENDIF
SET ORDER TO 1        
K03FORM=CREATEOBJECT("TKK03")
K03FORM.SHOW  
DEFINE CLASS TKK03 AS FORM
  CAPTION='K03.會計常用分錄'
  AUTOCENTER=.T.
  CONTROLBOX=.F.
  BORDERSTYLE=3  
  MAXBUTTON=.F.
  MINBUTTON=.F.
  MOVABLE=.F.
  CLOSABLE=.F.
  CONTROLCOUNT=57
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*550
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WIDTH=INT_015*789
  WINDOWTYPE=1
  NAME='TKK03'
  ADD OBJECT SHAPE1 AS SHAPE1 WITH;
      AUTOCENTER=.T.
  ADD OBJECT SHAPE2 AS SHAPE2 WITH;
      AUTOCENTER=.T.
  ADD OBJECT SHAPE3 AS SHAPE3 WITH;
      AUTOCENTER=.T.  
 ****************************             
  ADD OBJECT PAGEFRAME1 AS PAGEFRAME WITH;
      LEFT=INT_015*236,;
      WIDTH=INT_015*540,;
      HEIGHT=INT_015*200,;
      FONTSIZE=INT_015*9,;      
      PAGECOUNT=2,;
      TABSTRETCH=1,;
      ACTIVEPAGE=1,;
      VISIBLE=.T.,;
      PAGE1.NAME='PAGE1',;
      PAGE1.VISIBLE=.T.,;
      PAGE1.CAPTION='依程式編號搜尋紀錄',;
      PAGE2.NAME='PAGE2',;
      PAGE2.VISIBLE=.T.,;
      PAGE2.CAPTION='詳細資料內容'   
   ADD OBJECT KEY_LIST AS KEY_LIST WITH;
      AUTOCENTER=.T.
    ADD OBJECT GRID1 AS GRID1 WITH;
      COLUMNCOUNT=2,;            
      RECORDSOURCE='K18',;
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2'    
  ADD OBJECT GRID2 AS GRID2 WITH;
      COLUMNCOUNT=3,;            
      RECORDSOURCE='K19',;
      LINKMASTER='K18',;
      RELATIONALEXPR='F01',;
      CHILDORDER='K191',; 
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;
      COLUMN3.NAME='COLUMN3'  
 ADD OBJECT CMDGROUP AS CMDGROUP WITH;
      AUTOCENTER=.T.        
  ADD OBJECT ORPGROUP AS ORPGROUP WITH;    
      AUTOCENTER=.T.
  ADD OBJECT SHRGROUP AS SHRGROUP WITH;
      TOP=INT_015*155,;
      LEFT=INT_015*640   
 *************************設定PAGE1***************************                
  PROCEDURE PAGEFRAME1.PAGE1.INIT 
     THIS.ADDOBJECT('LBLF01','LABEL')
     WITH THIS.LBLF01
    	  .VISIBLE=.T.
          .LEFT=INT_015*14
          .TOP=INT_015*13
          .WIDTH=INT_015*50
          .CAPTION='分錄編號'          
     ENDWITH
     THIS.ADDOBJECT('TXTF01','TEXTBOX')     
     WITH THIS.TXTF01
          .VISIBLE=.T.
          .LEFT=INT_015*65
          .TOP=INT_015*7
          .WIDTH=INT_015*35
          .HEIGHT=INT_015*25
          .MAXLENGTH=3
     ENDWITH
    THIS.ADDOBJECT('LBLF02','LABEL')
     WITH THIS.LBLF02
          .VISIBLE=.T.
          .LEFT=INT_015*14
          .TOP=INT_015*40
          .WIDTH=INT_015*50
          .CAPTION='分錄說明'          
     ENDWITH
     THIS.ADDOBJECT('TXTF02','TEXTBOX')     
     WITH THIS.TXTF02
          .VISIBLE=.T.
          .LEFT=INT_015*65
          .TOP=INT_015*34
          .WIDTH=INT_015*150
          .HEIGHT=INT_015*25
          .MAXLENGTH=20
     ENDWITH 
  THIS.ADDOBJECT('LBLF03','LABEL')
    WITH THIS.LBLF03
         .VISIBLE=.T.           
         .LEFT=INT_015*370
         .TOP=INT_015*100
         .WIDTH=INT_015*50
         .CAPTION='安全資料'                           
    ENDWITH     
    THIS.ADDOBJECT('LBLF031','LABEL')
    WITH THIS.LBLF031
         .VISIBLE=.T.           
         .LEFT=INT_015*420
         .TOP=INT_015*100
         .AUTOSIZE=.T.
    ENDWITH 
   ENDPROC              
********************************設定PAGE2***************************    
  PROCEDURE PAGEFRAME1.PAGE2.INIT
     THIS.ADDOBJECT('LBLF02','LABEL')
     WITH THIS.LBLF02
    	  .VISIBLE=.T.
          .LEFT=INT_015*14
          .TOP=INT_015*13
          .WIDTH=INT_015*50
          .CAPTION='借方/貸方'          
     ENDWITH
     THIS.ADDOBJECT('TXTF02','TEXTBOX')     
     WITH THIS.TXTF02
          .VISIBLE=.T.
          .LEFT=INT_015*65
          .TOP=INT_015*7
          .WIDTH=INT_015*50
          .HEIGHT=INT_015*25
          .MAXLENGTH=4
     ENDWITH
   THIS.ADDOBJECT('OPTION02','OPTIONGROUP')     
     WITH THIS.OPTION02
          .VISIBLE=.F.
          .LEFT=INT_015*65
          .TOP=INT_015*7
          .WIDTH=INT_015*100
          .HEIGHT=INT_015*25
          .VALUE=1
          .BUTTONCOUNT=2
	  .OPTION1.CAPTION='借方'
	  .OPTION1.LEFT=INT_015*2
	  .OPTION1.TOP=INT_015*1
	  .OPTION1.WIDTH=INT_015*40
	  .OPTION1.HEIGHT=INT_015*25
	  .OPTION2.CAPTION='貸方'
	  .OPTION2.LEFT=INT_015*45
	  .OPTION2.TOP=INT_015*1
	  .OPTION2.WIDTH=INT_015*40
	  .OPTION2.HEIGHT=INT_015*25
     ENDWITH
   THIS.ADDOBJECT('LBLF03','LABEL')
     WITH THIS.LBLF03
          .VISIBLE=.T.
          .LEFT=INT_015*14
          .TOP=INT_015*40
          .WIDTH=INT_015*50
          .CAPTION='會計科目'          
     ENDWITH
     THIS.ADDOBJECT('TXTF03','TXTF03')     
     WITH THIS.TXTF03
          .VISIBLE=.T.
          .LEFT=INT_015*65
          .TOP=INT_015*34
          .WIDTH=INT_015*50
          .HEIGHT=INT_015*25
          .MAXLENGTH=7
     ENDWITH
  THIS.ADDOBJECT('LBLF04','LABEL')
     WITH THIS.LBLF04
          .VISIBLE=.T.
          .LEFT=INT_015*14
          .TOP=INT_015*67
          .WIDTH=INT_015*50
          .CAPTION='科目名稱'          
     ENDWITH
     THIS.ADDOBJECT('TXTF04','TEXTBOX') 
     WITH THIS.TXTF04
          .VISIBLE=.T.
          .LEFT=INT_015*65
          .TOP=INT_015*61
          .WIDTH=INT_015*150
          .HEIGHT=INT_015*25
          .MAXLENGTH=20
     ENDWITH
    THIS.ADDOBJECT('LBLF05','LABEL')
    WITH THIS.LBLF05
         .VISIBLE=.T.           
         .LEFT=INT_015*370
         .TOP=INT_015*100
         .WIDTH=INT_015*50
         .CAPTION='安全資料'                           
    ENDWITH     
    THIS.ADDOBJECT('LBLF051','LABEL')
    WITH THIS.LBLF051
         .VISIBLE=.T.           
         .LEFT=INT_015*420
         .TOP=INT_015*100
         .AUTOSIZE=.T.
    ENDWITH              
  ENDPROC                                                               
********************************             
  PROC INIT
       THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.)   &&判斷有無新增的權限
       THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  &&判斷有無修改的權限
       THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)   &&判斷有無刪除的權限
       THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限
       THISFORM.SHRGROUP.VISIBLE=.F.
       THISFORM.SHRGROUP.ENABLED=.F. 
       THISFORM.SETALL('HEIGHT',25*INT_015,'TEXTBOX')
       THISFORM.SETALL('HEIGHT',23*INT_015,'LABEL')
       THISFORM.SETALL('READONLY',.T.,'TEXTBOX')
       THISFORM.SETALL('FONTSIZE',INT_015*9,'TEXTBOX')         
       THISFORM.SETALL('FONTSIZE',INT_015*9,'LABEL')    
       THISFORM.GRID1.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)
       THISFORM.GRID2.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'COLUMN')  
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'HEADER')         
       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*50
       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*150
       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='分錄編號'
       THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='分錄說明'
       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='K18.F01'
       THISFORM.GRID1.COLUMN2.CONTROLSOURCE='K18.F02'
       THISFORM.GRID2.COLUMN1.WIDTH=INT_015*50
       THISFORM.GRID2.COLUMN2.WIDTH=INT_015*150
       THISFORM.GRID2.COLUMN3.WIDTH=INT_015*55
       THISFORM.GRID2.COLUMN1.HEADER1.CAPTION='會計科目'
       THISFORM.GRID2.COLUMN2.HEADER1.CAPTION='科目名稱'
       THISFORM.GRID2.COLUMN3.HEADER1.CAPTION='借方/貸方'
       THISFORM.GRID2.COLUMN1.CONTROLSOURCE='K19.F03'
       THISFORM.GRID2.COLUMN2.CONTROLSOURCE='K19.F04'
       THISFORM.GRID2.COLUMN3.CONTROLSOURCE='BILL(K19.F02)'
       THISFORM.GRID1.READONLY=.T.       
       THISFORM.GRID1.SETFOCUS 
       JK='分錄編號'
       SELECT K18
       GO TOP
  ENDPROC
  ******************設定PAGE1之動態動作******************        
  PROCEDURE PAGEFRAME1.PAGE1.ACTIVATE
     R=0
          SELE K18
     IF THISFORM.SHRGROUP.VISIBLE=.F.
        THISFORM.GRID1.ENABLED=.T.   
        THISFORM.GRID1.SETFOCUS 
        THISFORM.KEY_LIST.ENABLED=.T.
    ELSE
       THISFORM.KEY_LIST.ENABLED=.F.   
    ENDIF          
    IF THISFORM.GRID1.ACTIVEROW=0 .AND. THISFORM.SHRGROUP.ENABLED=.F.
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
        THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
        THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
        THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
        THISFORM.PAGEFRAME1.PAGE1.SETALL('VALUE','','TEXTBOX')
        THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=''
        THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE=''
        THISFORM.PAGEFRAME1.PAGE2.ENABLED=.F. 
     ELSE
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.
        THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  &&判斷有無修改的權限
        THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)   &&判斷有無刪除的權限
        THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限
        THISFORM.PAGEFRAME1.PAGE2.ENABLED=.T.
     ENDIF
   ENDPROC
*****************設定PAGE2之動態動作***********
PROCEDURE PAGEFRAME1.PAGE2.ACTIVATE
     SELE K19
     IF THISFORM.SHRGROUP.ENABLED=.F.
        THISFORM.GRID2.READONLY=.T.   
        THISFORM.GRID2.SETFOCUS   
     ENDIF   
    IF THISFORM.GRID2.ACTIVEROW=0 .AND. THISFORM.SHRGROUP.ENABLED=.F.
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
        THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
        THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
        THISFORM.PAGEFRAME1.PAGE2.SETALL('VALUE','','TEXTBOX')
    ELSE
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.
        THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  &&判斷有無修改的權限
        THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)   &&判斷有無刪除的權限
        THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限
    ENDIF 
	R=RECNO('&AREA1')  
	THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(RECNO('&AREA1')=R,RGB(255,255,0),'')","COLUMN")
        THISFORM.GRID1.ENABLED=.F.     
        THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.)   &&判斷有無新增的權限
        THISFORM.KEY_LIST.ENABLED=.F.     
ENDPROC 
  ******************* 
  PROC KEY_LIST.INIT 
       WITH THIS 
           .ADDITEM('依分錄編號排列')
       ENDWITH      
  ENDPROC 
  ***************GRID1動態改變*
  PROC GRID1.AFTERROWCOLCHANGE
       LPARAMETERS NCOLINDEX
       THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=K18.F01
       THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE=K18.F02
       THISFORM.PAGEFRAME1.PAGE1.LBLF031.CAPTION=K18.F03       
       FCH=THISFORM.ACTIVECONTROL.NAME
       CHK=''
       THISFORM.REFRESH
  ENDPROC
  ***************GRID2動態改變***************       
  PROC GRID2.AFTERROWCOLCHANGE
       LPARAMETERS NCOLINDEX                    
       THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE=BILL(K19.F02)
       THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=K19.F03
       THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE=K19.F04
       THISFORM.PAGEFRAME1.PAGE2.LBLF051.CAPTION=K19.F05
       FCH=THISFORM.ACTIVECONTROL.NAME
       JK=THIS.COLUMN1.HEADER1.CAPTION
       CHK=THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
       IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
           THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
       ENDIF  
  ENDPROC
******************新增
  PROCEDURE ORPGROUP.NEW_BOTT.CLICK  
     THISFORM.KEY_LIST.ENABLED=.F.
     THISFORM.GRID1.ENABLED=.F.   
     THISFORM.GRID2.ENABLED=.F.  
    IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1  
         THISFORM.PAGEFRAME1.PAGE1.TXTF01.SETFOCUS       
         THISFORM.PAGEFRAME1.PAGE1.SETALL('READONLY',.F.,'TEXTBOX')  &&處理表頭新增
         THISFORM.PAGEFRAME1.PAGE2.ENABLED=.F.
         THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=''
         THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE=''
         THISFORM.PAGEFRAME1.PAGE1.LBLF031.CAPTION=''
   ELSE
       THISFORM.PAGEFRAME1.PAGE1.ENABLED=.F.  &&處理表身新增
       THISFORM.PAGEFRAME1.PAGE2.SETALL('READONLY',.F.,'TEXTBOX')  
       THISFORM.PAGEFRAME1.PAGE2.TXTF03.SETFOCUS
       THISFORM.PAGEFRAME1.PAGE2.OPTION02.VISIBLE=.T.
       THISFORM.PAGEFRAME1.PAGE2.OPTION02.VALUE=1
       THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE=''
       THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=''
       THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE=''
       THISFORM.PAGEFRAME1.PAGE2.TXTF03.READONLY=.F.
       THISFORM.PAGEFRAME1.PAGE2.TXTF04.READONLY=.T.
       THISFORM.PAGEFRAME1.PAGE2.LBLF051.CAPTION=''
   ENDIF 
  ENDPROC
**********************新增確認
 PROCEDURE SHRGROUP.SHURE1_BOTT.CLICK
  IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
    IF EMPTY(THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE)
       =MESSAGEBOX('分錄編號不得空白!',0+64,'提示視窗')
       THISFORM.PAGEFRAME1.PAGE1.TXTF01.SETFOCUS
       RETURN
    ENDIF
    IF SEEK(THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE,'K18')=.T.
        =MESSAGEBOX('此分錄編號已存在請重新輸入!',0+64,'提示視窗')    
       THISFORM.PAGEFRAME1.PAGE1.TXTF01.SETFOCUS
       RETURN
    ENDIF   
    IF EMPTY(THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE)
       =MESSAGEBOX('分錄說明不得空白!',0+64,'提示視窗')
       THISFORM.PAGEFRAME1.PAGE1.TXTF02.SETFOCUS
       RETURN
    ENDIF
    SELECT K18   
    APPEND BLANK
    LOCK()
    IF RLOCK()
       REPLACE F01 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
       REPLACE F02 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE
       REPLACE F03 WITH DTOC(DATE())+' '+IIF(SEEK(SYS_OPER,'A01'),A01.F03,'')
       THISFORM.PAGEFRAME1.PAGE1.ENABLED=.F.
       THISFORM.PAGEFRAME1.PAGE2.ENABLED=.T.  
       THISFORM.PAGEFRAME1.ACTIVEPAGE=2
       THISFORM.ORPGROUP.NEW_BOTT.CLICK
       THISFORM.REFRESH
    ENDIF 
    UNLOCK
 ELSE    &&表身確認 
    IF EMPTY(THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE)
       =MESSAGEBOX('會計科目不得空白!',0+64,'提示視窗')
       THISFORM.PAGEFRAME1.PAGE2.TXTF03.SETFOCUS
       RETURN
    ENDIF 
    SELE K19
    APPEND BLANK
    LOCK()
    IF RLOCK()
          REPLACE F01 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
          DO CASE 
       	      CASE  THISFORM.PAGEFRAME1.PAGE2.OPTION02.VALUE=1
       			  REPLACE F02 WITH 'D'
       	      CASE  THISFORM.PAGEFRAME1.PAGE2.OPTION02.VALUE=2
       			  REPLACE F02 WITH 'C'	
         ENDCASE
          REPLACE F03 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE
          REPLACE F04 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE
 	  REPLACE F05 WITH DTOC(DATE())+' '+IIF(SEEK(SYS_OPER,'A01'),A01.F03,'')                     
          THISFORM.PAGEFRAME1.PAGE1.ENABLED=.F.
      	  THISFORM.PAGEFRAME1.PAGE2.ENABLED=.T.  
          THISFORM.PAGEFRAME1.ACTIVEPAGE=2
          THISFORM.ORPGROUP.NEW_BOTT.CLICK
          THISFORM.REFRESH
    UNLOCK
    ENDIF
  ENDIF  
  ENDPROC 
*****************修改   
 PROCEDURE ORPGROUP.EDIT_BOTT.CLICK
    THISFORM.KEY_LIST.ENABLED=.F.
    THISFORM.GRID1.ENABLED=.F. 
    THISFORM.GRID2.ENABLED=.F. 
     IF    THISFORM.PAGEFRAME1.ACTIVEPAGE=1
            THISFORM.PAGEFRAME1.PAGE2.ENABLED=.F. 
	    THISFORM.PAGEFRAME1.PAGE1.TXTF01.READONLY=.T.
	    THISFORM.PAGEFRAME1.PAGE1.TXTF02.READONLY=.F.
	    THISFORM.PAGEFRAME1.PAGE1.TXTF02.SETFOCUS
	    THISFORM.PAGEFRAME1.PAGE1.LBLF031.CAPTION=''
	    LOCK()
	    IF !RLOCK()
	         DO FILE_IMPACT
	         RETURN
	    ENDIF 
   ELSE
    	THISFORM.PAGEFRAME1.PAGE1.ENABLED=.F.
    	THISFORM.PAGEFRAME1.PAGE2.TXTF02.READONLY=.F.
    	THISFORM.PAGEFRAME1.PAGE2.TXTF03.READONLY=.F.
    	THISFORM.PAGEFRAME1.PAGE2.TXTF04.READONLY=.T.
        THISFORM.PAGEFRAME1.PAGE2.TXTF02.VISIBLE=.F.
        THISFORM.PAGEFRAME1.PAGE2.OPTION02.VISIBLE=.T.
        THISFORM.PAGEFRAME1.PAGE2.OPTION02.VALUE=IIF(K19.F02='D',1,2)
        THISFORM.PAGEFRAME1.PAGE2.TXTF03.SETFOCUS
    	 LOCK()     
         IF !RLOCK()
              DO FILE_IMPACT
              RETURN
         ENDIF          
   ENDIF                  	                  	
  ENDPROC 
**************************修改確認
  PROCEDURE SHRGROUP.SHURE2_BOTT.CLICK
     IF  THISFORM.PAGEFRAME1.ACTIVEPAGE=1
	    IF EMPTY(THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE)
	       =MESSAGEBOX('分錄說明不得空白!',0+64,'提示視窗')
	       THISFORM.PAGEFRAME1.PAGE1.TXTF02.SETFOCUS
	       RETURN
	    ENDIF
            SELECT K18
             IF RLOCK()
                  REPLACE F01 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
                  REPLACE F02 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE
                  REPLACE F03 WITH DTOC(DATE())+' '+IIF(SEEK(SYS_OPER,'A01'),A01.F03,'')   
             ELSE
                  DO FILE_IMPACT
                  RETURN   
             ENDIF   
     ELSE &&表身修改確認
           IF EMPTY(THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE)
                 =MESSAGEBOX('會計科目不得空白!',0+64,'提示視窗')
                 THISFORM.PAGEFRAME1.PAGE2.TXTF03.SETFOCUS
                 RETURN
           ENDIF
           SELE K19
           IF RLOCK()
               DO CASE 
       	              CASE  THISFORM.PAGEFRAME1.PAGE2.OPTION02.VALUE=1
       			         REPLACE F02 WITH 'D'
       	              CASE  THISFORM.PAGEFRAME1.PAGE2.OPTION02.VALUE=2
       			          REPLACE F02 WITH 'C'	
                 ENDCASE
                 REPLACE F03 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE
                 REPLACE F04 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE
 	         REPLACE F05 WITH DTOC(DATE())+' '+IIF(SEEK(SYS_OPER,'A01'),A01.F03,'')       
            ELSE
                 DO FILE_IMPACT
                 RETURN   
            ENDIF  
           THISFORM.SHRGROUP.ABANDON_BOTT.CLICK
       ENDIF       
  ENDPROC 
 *****************刪除***********
 PROCEDURE ORPGROUP.DEL_BOTT.CLICK
    IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
      IF MESSAGEBOX('是否確定要刪除此筆分錄編號之所有資料',4+32+256,'請確認')=6
         SELE K18
         LOCK()
         IF  RLOCK()
               DELE
               UNLOCK
               SKIP -1
                  IF BOF()
                       GO TOP
                  ENDIF   
              THISFORM.GRID1.SETFOCUS
               IF  THISFORM.GRID1.ACTIVEROW=0
                    THISFORM.PAGEFRAME1.PAGE1.SETALL('VALUE','','TEXTBOX')
                    THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
                    THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
                    THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
                    THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
                    THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
                    THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
                    THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
               ELSE
                    THISFORM.CMDGROUP.ENABLED=.T. 
                    THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  &&判斷有無修改的權限
        	    THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)   &&判斷有無刪除的權限
	            THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限
               ENDIF
         ELSE
            DO FILE_IMPACT
         ENDIF
       ENDIF  
   ELSE
     IF  MESSAGEBOX('是否確定要刪除此筆之資料',4+32+256,'請確認')=6  
        SELE K19 
        LOCK()
        IF  RLOCK()
             DELE
             UNLOCK
             SKIP -1
             IF   BOF()
                   GO TOP
             ENDIF   
             THISFORM.GRID2.SETFOCUS
               IF THISFORM.GRID2.ACTIVEROW=0
                   THISFORM.PAGEFRAME1.PAGE2.SETALL('VALUE','','TEXTBOX')
                   THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
                   THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
                   THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
                   THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
                   THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
                   THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
                   THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
                ELSE
                    THISFORM.CMDGROUP.ENABLED=.T. 
                    THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  &&判斷有無修改的權限
        	    THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)   &&判斷有無刪除的權限
	            THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限
                ENDIF
        ELSE
           DO FILE_IMPACT    
        ENDIF 
     ENDIF           
  ENDIF  
ENDPROC  
***********************  
  PROCEDURE SHRGROUP.ABANDON_BOTT.CLICK
      THISFORM.SHRGROUP.ENABLED=.F.
      THISFORM.SHRGROUP.VISIBLE=.F.      
      THISFORM.ORPGROUP.ENABLED=.T.
      THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.)   &&判斷有無新增的權限      
      THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  &&判斷有無修改的權限
      THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)   &&判斷有無刪除的權限
      THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限      
      THISFORM.ORPGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
      THISFORM.CMDGROUP.ENABLED=.T.
      THISFORM.CMDGROUP.SETALL('ENABLED',.T.,'COMMANDBUTTON')
      THISFORM.CMDGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
      THISFORM.PAGEFRAME1.PAGE1.SETALL('READONLY',.T.,'TEXTBOX')  
      THISFORM.PAGEFRAME1.PAGE2.SETALL('READONLY',.T.,'TEXTBOX')
      THISFORM.PAGEFRAME1.PAGE2.SETALL('VISIBLE',.F.,'OPTIONGROUP')
      THISFORM.PAGEFRAME1.PAGE2.SETALL('VISIBLE',.T.,'TEXTBOX')
      THISFORM.PAGEFRAME1.PAGE2.TXTF03.READONLY=.T.
      THISFORM.PAGEFRAME1.PAGE1.ENABLED=.T.
      THISFORM.PAGEFRAME1.PAGE2.ENABLED=.T.
      THISFORM.KEY_LIST.ENABLED=.T.      
       IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
           THISFORM.GRID1.ENABLED=.T.
           THISFORM.GRID2.ENABLED=.T.
           THISFORM.GRID1.SETFOCUS
           THISFORM.KEY_LIST.ENABLED=.T.
      ELSE
           THISFORM.GRID1.ENABLED=.F.
           THISFORM.GRID2.ENABLED=.T.
           THISFORM.GRID2.SETFOCUS
           THISFORM.GRID1.ENABLED=.F.
           THISFORM.KEY_LIST.ENABLED=.F.
      ENDIF    
    UNLOCK ALL
  ENDPROC
 ****************** 
  PROCEDURE SHRGROUP.FINISH_BOTT.CLICK   
       THISFORM.SHRGROUP.ABANDON_BOTT.CLICK
  ENDPROC
  ENDDEFINE
********************會計科目
DEFINE CLASS TXTF03 AS TEXTBOX
  READONLY=.T.
  MAXLENGTH=7
  FONTSIZE=INT_015*9  
 PROCEDURE INTERACTIVECHANGE
    IF AT('?',ALLTRIM(THIS.VALUE))<>0
       IF AT('?',ALLTRIM(THIS.VALUE))>1             
          SELECT F01,F02 FROM K03 INTO CURSOR ACCOUNT ORDER BY F01 WHERE LEFT(F01,AT('?',THIS.VALUE)-1)=LEFT(THIS.VALUE,AT('?',THIS.VALUE)-1) &&AND LEN(ALLTRIM(F01))=4
       ELSE
          SELECT F01,F02 FROM K03 INTO CURSOR ACCOUNT ORDER BY F01 
       ENDIF
        IF _TALLY>0   
	       ACCOUNT_SEEK=CREATEOBJECT("ACCOUNT_SEEK")  
	       ACCOUNT_SEEK.SHOW    
	       THIS.VALUE=FLG
	       THIS.REFRESH
	       FLG='0'
	 ENDIF      
       THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=IIF(SEEK(ALLTRIM(THIS.VALUE),'K03'),K03.F01,'')
       THISFORM.PAGEFRAME1.PAGE2.TXTF03.REFRESH
       THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE=IIF(SEEK(ALLTRIM(THIS.VALUE),'K03'),K03.F02,'')
       THISFORM.PAGEFRAME1.PAGE2.TXTF04.REFRESH    
    *ENDIF
  ELSE
        IF   LEN(ALLTRIM(THIS.VALUE))=4
    	 THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=IIF(SEEK(ALLTRIM(THIS.VALUE),'K03'),K03.F01,'')
    	 THISFORM.PAGEFRAME1.PAGE2.TXTF03.REFRESH
    	 THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE=IIF(SEEK(ALLTRIM(THIS.VALUE),'K03'),K03.F02,'')
    	 THISFORM.PAGEFRAME1.PAGE2.TXTF04.REFRESH
        ENDIF
   ENDIF 	 
  ENDPROC
  ENDDEFINE
**************************************會計科目搜尋
DEFINE CLASS ACCOUNT_SEEK AS FORM
  AUTOCENTER=.T.
  CAPTION='會計科目編號一覽表'
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*250
  WIDTH=INT_015*215
  CONTROLBOX=.F.
  BORDERSTYLE=2
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WINDOWTYPE=1
  NAME='ACCOUNT_SEEK'
  ADD OBJECT GRDD01 AS GRID WITH;          
      AUTOCENTER=.T.,;
      ALLOWCELLSELECTION=.F.,;
      TOP=0,;
      WIDTH=INT_015*210,;      
      HEIGHT=INT_015*210,;      
      ROWHEIGHT=INT_015*18,;
      HEADERHEIGHT=INT_015*19,;
      DELETEMARK=.F.,;
      READONLY=.T.,;
      RECORDSOURCETYPE=1,;
      COLUMNCOUNT=2,;            
      RECORDSOURCE='ACCOUNT',;      
      NAME='GRDD01',;
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2'      
  ADD OBJECT CMND1 AS COMMANDBUTTON WITH;
      AUTOSIZE=.T.,;
      LEFT=INT_015*20,;    
      HEIGHT=INT_015*25,;   
      TOP=INT_015*222,;        
      WIDTH=INT_015*80,;
      FONTSIZE=INT_015*9,;
      CAPTION='\<S.選取',;
      TOOLTIPTEXT='選擇游標所指的紀錄!快速鍵->ALT+S'
      NAME='CMND1'
  ADD OBJECT CMND2 AS COMMANDBUTTON WITH;
      AUTOSIZE=.T.,;
      LEFT=INT_015*100,;
      TOP=INT_015*222,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*80,;
      FONTSIZE=INT_015*9,;      
      CAPTION='\<C.取消',;
      TOOLTIPTEXT='取消此搜尋畫面!快速鍵->ALT+C'
      NAME='CMND2'
      PROCEDURE INIT 
         THISFORM.GRDD01.SETALL('FONTSIZE',INT_015*9,'COLUMN') 
         THISFORM.GRDD01.SETALL('FONTSIZE',INT_015*9,'HEADER')          
         THISFORM.GRDD01.COLUMN1.HEADER1.CAPTION='科目編號'
         THISFORM.GRDD01.COLUMN1.WIDTH=INT_015*50
         THISFORM.GRDD01.COLUMN1.CONTROLSOURCE='ACCOUNT.F01'
         THISFORM.GRDD01.COLUMN2.HEADER1.CAPTION='科目名稱'
         THISFORM.GRDD01.COLUMN2.WIDTH=INT_015*120
         THISFORM.GRDD01.COLUMN2.CONTROLSOURCE='ACCOUNT.F02'
      ENDPROC
      PROC GRDD01.AFTERROWCOLCHANGE
       LPARAMETERS NCOLINDEX
       FLG=ACCOUNT.F01
      ENDPROC 
      PROCEDURE CMND1.CLICK                               
          THISFORM.RELEASE                
      ENDPROC
      PROCEDURE CMND2.CLICK
          FLG=''   
          THISFORM.RELEASE
      ENDPROC      
ENDDEFINE   
******************
FUNC BILL
     PARA JUK
     JO=''
     DO CASE
        CASE JUK='D'
             JO='借方'
        CASE JUK='C'
             JO='貸方'                
     ENDCASE
     RETURN JO              

