*********S19.加班申請(修改)作業
CLOSE ALL
CLEAR 
PRG_NO='S19'
FLG='0'
FCH=''
AREA1='S19_1'
CHK=''
HK=''
IF !USED('A01')	&&操作人員資料設定
   SELE 0
   USE A01 INDE A01
ELSE 
   SELE A01
ENDIF
SET ORDER TO A01
IF !USED('A02')	&&權限設定檔
   SELE 0
   USE A02 INDE A02
ELSE 
   SELE A02
ENDIF
SET ORDER TO A021      
SEEK sys_oper+'S19'   
IF !USED('A09')
   SELE 0
   USE A09
ELSE
   SELE A09
ENDIF
SET ORDER TO A091 
IF !USED('A23')	&&月份檔
    SELECT  0
    USE A23
ELSE 
   SELECT  A23
ENDIF
SET ORDER TO A231
A24='A24'+LEFT(DTOS(DATE()),6)     &&單號暫存檔
IF !USED('&A24')
   SELE 0
   USE (A24) ALIA A24
ELSE
   SELE A24
ENDIF
SET ORDER TO 1     
IF !USED('S0A')	&&年度缺勤天數累計
    SELECT  0
    USE S0A 
ELSE
    SELECT  S0A
ENDIF
SET ORDER TO S0A1    
IF !USED('S00')	&&薪資參數設定
   SELE 0
   USE S00 
ELSE
   SELE S00
ENDIF
SET ORDER TO S005 
IF !USED('S05')  &&人事薪資基本檔
   SELE 0
   USE S05 
ELSE
   SELE S05
ENDIF
SET ORDER TO S052
IF !USED('S19')	&&請假作業檔
   SELE 0
   USE S19
ELSE 
   SELE S19
ENDIF
SET ORDER TO S191  
SELECT * FROM S19 WHERE SUBSTR(F02,3,4)=SUBSTR(DTOS(DATE()),3,4);
             AND IIF(A02.F10<>'*',ALLTRIM(S19.F14)=ALLTRIM(sys_oper) OR ALLTRIM(S19.F03)=IIF(SEEK(sys_oper,'A01'),ALLTRIM(A01.F12),''),.T.);
              ORDER BY F02 INTO CURSOR S19_1 READWRITE
INDE ON F02 TAG S19_11
INDE ON F03 TAG S19_12
SET ORDER TO S19_11
****
S19FORM=CREATEOBJECT("TKS19")
S19FORM.SHOW  
DEFINE CLASS TKS19 AS FORM
  CAPTION='S19.加班申請(修改)作業'
*!*	  AUTOCENTER=.T.
  CONTROLBOX=.F.
  BORDERSTYLE=1
  MAXBUTTON=.F.
  MINBUTTON=.F.
  MOVABLE=.F.
  CLOSABLE=.F.
  CONTROLCOUNT=57
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*550
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WIDTH=INT_015*791
  WINDOWTYPE=1
  NAME='TKS19'
  ADD OBJECT SHAPE1 AS SHAPE1 WITH;
      AUTOCENTER=.T.
  ADD OBJECT SHAPE2 AS SHAPE2 WITH;
      AUTOCENTER=.T.
  ADD OBJECT SHAPE3 AS SHAPE3 WITH;
      AUTOCENTER=.T.  
  ADD OBJECT ANS_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*490,;
      LEFT=INT_015*15,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*45,;      
      FONTSIZE=INT_015*9,;
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\harrow.cur',;        
      CAPTION='\<A.確認',;
      NAME='ANS_BOTT'                
  ADD OBJECT LIST_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*490,;
      LEFT=INT_015*62,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*65,;      
      FONTSIZE=INT_015*9,;
      CAPTION='\<L.列印明細',;
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\harrow.cur',;        
      NAME='LIST_BOTT'          
  **********                   
  ADD OBJECT LBLF02 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*30,;
      WIDTH=INT_015*50,;
      CAPTION='單據編號'
  ADD OBJECT TXTF02 AS TEXTBOX WITH;      
      VISIBLE=.T.,;
      LEFT=INT_015*295,;
      TOP=INT_015*24,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*80,;
      MAXLENGTH=10,;
      NAME='TXTF02'        
  ADD OBJECT LBLF01 AS LABEL WITH;
      LEFT=INT_015*464,;
      TOP=INT_015*30,;
      WIDTH=INT_015*50,;
      CAPTION='填單日期'
  ADD OBJECT TXTF01 AS TEXTBOX WITH;      
      VISIBLE=.T.,;
      LEFT=INT_015*515,;
      TOP=INT_015*24,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*70,;
      NAME='TXTF01'              
  ADD OBJECT LBLF03 AS LABEL WITH;      
      LEFT=INT_015*244,;
      TOP=INT_015*55,;
      WIDTH=INT_015*50,;
      CAPTION='員工編號'
  ADD OBJECT TXTF03 AS TEXTBOX WITH;
      VISIBLE=.T.,;
      LEFT=INT_015*295,;
      TOP=INT_015*49,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*50,;
      MAXLENGTH=4,;
      NAME='TXTF03'       
 ADD OBJECT COMBOBOX03 AS COMBOBOX03 WITH;      
      VISIBLE=.F.,;
       LEFT=INT_015*295,; 
       TOP=INT_015*49          
  ADD OBJECT LBLF04 AS LABEL WITH;      
      LEFT=INT_015*244,;
      TOP=INT_015*80,;
      WIDTH=INT_015*50,;
      CAPTION='員工姓名'
  ADD OBJECT TXTF04 AS TEXTBOX WITH;
      VISIBLE=.T.,;
      LEFT=INT_015*295,;
      TOP=INT_015*74,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*80,;
      MAXLENGTH=8,;
      NAME='TXTF04'             
  ADD OBJECT LBLF05 AS LABEL WITH;      
      LEFT=INT_015*464,;
      TOP=INT_015*55,;
      WIDTH=INT_015*50,;
      CAPTION='部門編號'
  ADD OBJECT TXTF05 AS TEXTBOX WITH;
      VISIBLE=.T.,;
      LEFT=INT_015*515,;
      TOP=INT_015*49,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*50,;
      MAXLENGTH=4,;
      NAME='TXTF05'             
  ADD OBJECT LBLF06 AS LABEL WITH;      
      LEFT=INT_015*464,;
      TOP=INT_015*80,;
      WIDTH=INT_015*50,;
      CAPTION='部門名稱'
  ADD OBJECT TXTF06 AS TEXTBOX WITH;
      VISIBLE=.T.,;
      LEFT=INT_015*515,;
      TOP=INT_015*74,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*70,;
      MAXLENGTH=8,;
      NAME='TXTF06'     
  ADD OBJECT LBLF07 AS LABEL WITH;      
      LEFT=INT_015*244,;
      TOP=INT_015*105,;
      WIDTH=INT_015*50,;
      CAPTION='選擇方式'        
  ADD OBJECT OPTIONGROUP07 AS OPTIONGROUP07 WITH;       
      VISIBLE=.T.,;
      LEFT=INT_015*295,;
      TOP=INT_015*99              
  ADD OBJECT LBLF08 AS LABEL WITH;      
      LEFT=INT_015*244,;
      TOP=INT_015*130,;
      WIDTH=INT_015*50,;
      CAPTION='申請事由'       
  ADD OBJECT TXTF08 AS TEXTBOX WITH;	
      VISIBLE=.T.,;
      LEFT=INT_015*295,;
      TOP=INT_015*124,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*400,;
      NAME='TXTF08'       
  ADD OBJECT LBLF09 AS LABEL WITH;      
      LEFT=INT_015*244,;
      TOP=INT_015*155,;
      AUTOSIZE=.T.,;
      CAPTION='申請日期                          至'     
  ADD OBJECT LBLF091 AS LABEL WITH;      
      LEFT=INT_015*300,;
      TOP=INT_015*155,;
      AUTOSIZE=.T.,;
      CAPTION=''              
  ADD OBJECT TXTF091 AS TEXTBOX WITH;	
      VISIBLE=.F.,;
      LEFT=INT_015*348,;
      TOP=INT_015*153,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*21,;
      BORDERSTYLE=0,;
      MAXLENGTH=2,;
      INPUTMASK='99',;
      NAME='TXTF091'          
  ADD OBJECT LBLF101 AS LABEL WITH;      
      LEFT=INT_015*397,;
      TOP=INT_015*155,;
      AUTOSIZE=.T.,;
      CAPTION=''                 
  ADD OBJECT TXTF101 AS TEXTBOX WITH;	
      VISIBLE=.F.,;
      LEFT=INT_015*443,;
      TOP=INT_015*153,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*21,;
      BORDERSTYLE=0,;
      MAXLENGTH=2,;
      INPUTMASK='99',;
      NAME='TXTF101'         
  ADD OBJECT LBLF11 AS LABEL WITH;      
      LEFT=INT_015*244,;
      TOP=INT_015*180,;
      WIDTH=INT_015*95,;
      CAPTION='申請加班上班時間'      
  ADD OBJECT TXTF11 AS TEXTBOX WITH;	
      VISIBLE=.T.,;
      LEFT=INT_015*345,;
      TOP=INT_015*174,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*45,;
      MAXLENGTH=5,;
      INPUTMASK='99:99',;
      NAME='TXTF11'      
  ADD OBJECT LBLF12 AS LABEL WITH;      
      LEFT=INT_015*244,;
      TOP=INT_015*205,;
      WIDTH=INT_015*95,;
      CAPTION='申請加班下班時間'      
  ADD OBJECT TXTF12 AS TEXTBOX WITH;	
      VISIBLE=.T.,;
      LEFT=INT_015*345,;
      TOP=INT_015*199,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*45,;
      MAXLENGTH=5,;
      INPUTMASK='99:99',;
      NAME='TXTF12'                           
  ADD OBJECT LBLF13 AS LABEL WITH;      
      LEFT=INT_015*244,;
      TOP=INT_015*235,;
      WIDTH=INT_015*50,;
      CAPTION='狀        態'    
  ADD OBJECT LBLF131 AS LABEL WITH;      
      LEFT=INT_015*298,;
      TOP=INT_015*235,;
      AUTOSIZE=.T.,;
      CAPTION=''       
  ADD OBJECT LBLF99 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*265,;
      WIDTH=INT_015*50,;
      CAPTION='安全資料'
  ADD OBJECT LBLF991 AS LABEL WITH;
      LEFT=INT_015*298,;
      TOP=INT_015*265,;
      AUTOSIZE=.T.,;
      CAPTION=''                                                 
  ADD OBJECT KEY_LIST AS KEY_LIST WITH;
      AUTOCENTER=.T.,;
      WIDTH=INT_015*130
  ADD OBJECT MTH_LIST AS MTH_LIST WITH;
      AUTOCENTER=.T.
  ADD OBJECT GRID1 AS GRID1 WITH;
      COLUMNCOUNT=3,;            
      RECORDSOURCE='S19_1',;      
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;
      COLUMN3.NAME='COLUMN3'
  ADD OBJECT CMDGROUP AS CMDGROUP WITH;
      AUTOSIZE=.T.              
  ADD OBJECT ORPGROUP AS ORPGROUP WITH;    
      AUTOSIZE=.T.
  ADD OBJECT SHRGROUP AS SHRGROUP WITH;
      TOP=INT_015*210,;
      LEFT=INT_015*558          
   *****   
  PROC INIT  
       SELECT S19_1
       GO BOTTOM 
       HK = ALLTRIM(THISFORM.MTH_LIST.DISPLAYVALUE)
       THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(S19_1.F13<>'Y',RGB(255,0,0),'')","COLUMN")        
       THISFORM.SHRGROUP.VISIBLE=.F.
       THISFORM.SHRGROUP.ENABLED=.F.
       THISFORM.SETALL('HEIGHT',INT_015*25,'TEXTBOX')
       THISFORM.SETALL('FONTSIZE',INT_015*9,'LABEL')
       THISFORM.SETALL('FONTSIZE',INT_015*9,'TEXTBOX')
       THISFORM.SETALL('HEIGHT',INT_015*17,'LABEL')       
       THISFORM.SETALL('READONLY',.T.,'TEXTBOX')
       THISFORM.SETALL('FONTSIZE',INT_015*9,'COLUMN')
       THISFORM.SETALL('FONTSIZE',INT_015*9,'HEADER')  
       THISFORM.TXTF091.HEIGHT=INT_015*18   
       THISFORM.TXTF101.HEIGHT=INT_015*18             
       THISFORM.GRID1.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)   
       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*75
       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*50
       THISFORM.GRID1.COLUMN3.WIDTH=INT_015*60
       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='單據編號'
       THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='員工編號'
       THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='員工姓名'
       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='S19_1.F02'
       THISFORM.GRID1.COLUMN2.CONTROLSOURCE='S19_1.F03'
       THISFORM.GRID1.COLUMN3.CONTROLSOURCE='S19_1.F04'
       THISFORM.GRID1.READONLY=.T.       
       THISFORM.GRID1.SETFOCUS
       IF THISFORM.GRID1.ACTIVEROW=0
          THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
          THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
          THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
          THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.       
          THISFORM.CMDGROUP.ENABLED=.F.
          THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
          THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
          THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
          THISFORM.LIST_BOTT.ENABLED=.F.
          THISFORM.ANS_BOTT.ENABLED=.F.
          THISFORM.TXTF01.VALUE=''
          THISFORM.TXTF02.VALUE=''
          THISFORM.TXTF03.VALUE=''
          THISFORM.TXTF04.VALUE=''  
          THISFORM.TXTF05.VALUE=''
          THISFORM.TXTF06.VALUE=''     
          THISFORM.TXTF08.VALUE=''
          THISFORM.TXTF091.VALUE=''
          THISFORM.TXTF101.VALUE=''
          THISFORM.TXTF11.VALUE=''
          THISFORM.TXTF12.VALUE=''
          THISFORM.OPTIONGROUP07.VALUE=1
          THISFORM.LBLF091.CAPTION=''
          THISFORM.LBLF101.CAPTION=''
          THISFORM.LBLF991.CAPTION=''
       ELSE
          THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
          THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
          THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
          THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.            
          THISFORM.CMDGROUP.ENABLED=.T.      
          THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  AND IIF(S19_1.F13<>'Y',.T.,.F.) &&判斷有無修改的權限
          THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)   AND IIF(S19_1.F13<>'Y',.T.,.F.) &&判斷有無刪除的權限
          THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限
          THISFORM.LIST_BOTT.ENABLED=IIF(A02.F11='*',.T.,.F.)   &&判斷有無列印明細的權限
          THISFORM.ANS_BOTT.ENABLED=IIF(A02.F08='*',.T.,.F.)  AND IIF(S19_1.F13<>'Y',.T.,.F.)   &&判斷有無確認的權限
       ENDIF      
       THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.)  &&判斷有無新增的權限 
       JK='單據編號'
  ENDPROC
  ***********     
  PROC KEY_LIST.INIT 
       WITH THIS 
           .ADDITEM('依單據編號排列')
           .ADDITEM('依員工編號排列')
           .VALUE=1
       ENDWITH      
  ENDPROC 
********* 
  PROC KEY_LIST.INTERACTIVECHANGE         
       SELECT  S19_1 
       DO CASE
          CASE THIS.DISPLAYVALUE='依單據編號排列'
                     SET ORDER TO S19_11 
		     THISFORM.GRID1.COLUMN1.WIDTH=INT_015*75
		     THISFORM.GRID1.COLUMN2.WIDTH=INT_015*50
		     THISFORM.GRID1.COLUMN3.WIDTH=INT_015*60                     
		     THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='單據編號'
		     THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='員工編號'
		     THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='員工姓名'
		     THISFORM.GRID1.COLUMN1.CONTROLSOURCE='S19_1.F02'
		     THISFORM.GRID1.COLUMN2.CONTROLSOURCE='S19_1.F03'
		     THISFORM.GRID1.COLUMN3.CONTROLSOURCE='S19_1.F04'
		      JK='單據編號'
          CASE THIS.DISPLAYVALUE='依員工編號排列'
               	     SET ORDER TO S19_12
		     THISFORM.GRID1.COLUMN1.WIDTH=INT_015*50
		     THISFORM.GRID1.COLUMN2.WIDTH=INT_015*60
		     THISFORM.GRID1.COLUMN3.WIDTH=INT_015*75 
		     THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='員工編號'
		     THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='員工姓名'
		     THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='單據編號'		     
		     THISFORM.GRID1.COLUMN1.CONTROLSOURCE='S19_1.F03'    
		     THISFORM.GRID1.COLUMN2.CONTROLSOURCE='S19_1.F04'	
		     THISFORM.GRID1.COLUMN3.CONTROLSOURCE='S19_1.F02'		
		      JK='員工編號'                                                  
       ENDCASE 
        THISFORM.GRID1.SETFOCUS          
  ENDPROC   
**************  
  PROC MTH_LIST.INTERACTIVECHANGE
       HK = ALLTRIM(THISFORM.MTH_LIST.DISPLAYVALUE)
       THISFORM.GRID1.RECORDSOURCE=''  
       SELECT A24
       USE 
       SELECT S19_1
       USE
	A24='A24'+LEFT(DTOS(CTOD(THIS.DISPLAYVALUE+'/01')),6)     &&單號暫存檔
	IF !USED('&A24')
	   SELE 0
	   USE (A24) ALIA A24
	ELSE
	   SELE A24
	ENDIF
	SET ORDER TO 1      
	SELECT * FROM S19 WHERE SUBSTR(F02,3,4)=SUBSTR(DTOS(CTOD(HK+'/01')),3,4);
	             AND IIF(A02.F10<>'*',ALLTRIM(S19.F14)=ALLTRIM(sys_oper) OR ALLTRIM(S19.F03)=IIF(SEEK(sys_oper,'A01'),ALLTRIM(A01.F12),''),.T.);
	              ORDER BY F02 INTO CURSOR S19_1 READWRITE
	INDE ON F02 TAG S19_11
	INDE ON F03 TAG S19_12
	SET ORDER TO S19_11
	GO BOTTOM      
       THISFORM.GRID1.RECORDSOURCE='S19_1' 
       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*75
       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*50
       THISFORM.GRID1.COLUMN3.WIDTH=INT_015*60
       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='單據編號'
       THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='員工編號'
       THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='員工姓名'
       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='S19_1.F02'
       THISFORM.GRID1.COLUMN2.CONTROLSOURCE='S19_1.F03'
       THISFORM.GRID1.COLUMN3.CONTROLSOURCE='S19_1.F04'
       THISFORM.GRID1.READONLY=.T.       
       THISFORM.GRID1.SETFOCUS
       THISFORM.KEY_LIST.INTERACTIVECHANGE 
       IF THISFORM.GRID1.ACTIVEROW=0
          THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
          THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
          THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
          THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.       
          THISFORM.CMDGROUP.ENABLED=.F.
          THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
          THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
          THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
          THISFORM.LIST_BOTT.ENABLED=.F.
          THISFORM.ANS_BOTT.ENABLED=.F.
          THISFORM.TXTF01.VALUE=''
          THISFORM.TXTF02.VALUE=''
          THISFORM.TXTF03.VALUE=''
          THISFORM.TXTF04.VALUE=''  
          THISFORM.TXTF05.VALUE=''
          THISFORM.TXTF06.VALUE=''     
          THISFORM.TXTF08.VALUE=''
          THISFORM.TXTF091.VALUE=''
          THISFORM.TXTF101.VALUE=''
          THISFORM.TXTF11.VALUE=''
          THISFORM.TXTF12.VALUE=''
          THISFORM.OPTIONGROUP07.VALUE=1
          THISFORM.LBLF091.CAPTION=''
          THISFORM.LBLF101.CAPTION=''
          THISFORM.LBLF131.CAPTION=''
          THISFORM.LBLF991.CAPTION=''
       ELSE
          THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
          THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
          THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
          THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.            
          THISFORM.CMDGROUP.ENABLED=.T.      
          THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  AND IIF(S19_1.F13<>'Y',.T.,.F.) &&判斷有無修改的權限
          THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)   AND IIF(S19_1.F13<>'Y',.T.,.F.) &&判斷有無刪除的權限
          THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限
          THISFORM.LIST_BOTT.ENABLED=IIF(A02.F11='*',.T.,.F.)   &&判斷有無列印明細的權限
          THISFORM.ANS_BOTT.ENABLED=IIF(A02.F08='*',.T.,.F.)  AND IIF(S19_1.F13<>'Y',.T.,.F.)   &&判斷有無確認的權限
       ENDIF      
       THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.)  &&判斷有無新增的權限    
       THISFORM.REFRESH 
  *********
  PROC GRID1.AFTERROWCOLCHANGE
       LPARAMETERS nColIndex
       SELECT S19_1
       THISFORM.TXTF01.VALUE=F01
       THISFORM.TXTF02.VALUE=F02
       THISFORM.TXTF03.VALUE=F03
       THISFORM.TXTF04.VALUE=F04
       THISFORM.TXTF05.VALUE=F05
       THISFORM.TXTF06.VALUE=F06
       THISFORM.OPTIONGROUP07.VALUE=VAL(F07)
       THISFORM.TXTF08.VALUE=F08
       THISFORM.LBLF091.CAPTION=PADL(ALLTRIM(DTCX(F09)),10,'0')
       THISFORM.LBLF101.CAPTION=PADL(ALLTRIM(DTCX(F10)),10,'0')
       THISFORM.TXTF091.VALUE=RIGHT(ALLTRIM(DTOC(F09)),2)
       THISFORM.TXTF101.VALUE=RIGHT(ALLTRIM(DTOC(F10)),2)
       THISFORM.TXTF11.VALUE=F11
       THISFORM.TXTF12.VALUE=F12
       THISFORM.LBLF131.CAPTION=IIF(S19_1.F13<>'Y','尚未確認','已確認') 
       THISFORM.LBLF131.BACKCOLOR=IIF(S19_1.F13<>'Y',RGB(255,0,0),RGB(58,186,152)) 
       THISFORM.LBLF991.CAPTION=F99    
       IF F07='1'
       	   THISFORM.LBLF08.CAPTION='申請事由'
       	   THISFORM.LBLF09.CAPTION='申請日期                          至'
       	   THISFORM.LBLF11.CAPTION='申請加班上班時間'
       	   THISFORM.LBLF12.CAPTION='申請加班下班時間'
       ELSE
       	   THISFORM.LBLF08.CAPTION='修改事由'
       	   THISFORM.LBLF09.CAPTION='修改日期                          至'
       	   THISFORM.LBLF11.CAPTION='修改加班上班時間'
       	   THISFORM.LBLF12.CAPTION='修改加班下班時間'       
       ENDIF            
       THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  AND IIF(S19_1.F13<>'Y',.T.,.F.) &&判斷有無修改的權限
       THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)   AND IIF(S19_1.F13<>'Y',.T.,.F.) &&判斷有無刪除的權限
       THISFORM.ANS_BOTT.ENABLED=IIF(A02.F08='*',.T.,.F.)  AND IIF(S19_1.F13<>'Y',.T.,.F.)   &&判斷有無確認的權限
       FCH=THISFORM.ACTIVECONTROL.NAME
       CHK=''
       THISFORM.REFRESH
  ENDPROC      
  ********** 
  PROCEDURE ORPGROUP.NEW_BOTT.CLICK    
       THISFORM.KEY_LIST.ENABLED=.F. 
       THISFORM.MTH_LIST.ENABLED=.F. 
       THISFORM.ANS_BOTT.ENABLED=.F.
       THISFORM.LIST_BOTT.ENABLED=.F.        
       THISFORM.GRID1.ENABLED=.F.   
        H='S019 '+SUBSTR(DTOS(CTOD(HK+'/01')),3,4)
        SELECT  A24   
        SET ORDER TO 1
        SEEK H           
        IF FOUND() 
             PO_NO=F08
             RLOCK()
             DELE 
             UNLOCK
        ELSE
             SELE A09
             SEEK H            
             IF !FOUND()                                                  &&如果為本月第一張訂單則重頭開始編號
		  APPEND BLANK                                                
		  REPLACE  F01 WITH 'S019 '
		  REPLACE  F02 WITH  SUBSTR(DTOS(CTOD(HK+'/01')),3,4)
		  REPLACE  F05 WITH 'SC'+F02
		  REPLACE  F06 WITH '加班申請(修改)作業'
		  REPLACE  F08 WITH ALLTRIM(F05)+'0000'
	    ENDIF
	    LOCK()
	    HX=VAL(RIGHT(F08,4))+1
	    PO_NO=LEFT(F08,6)+PADL(ALLTRIM(STR(HX)),4,'0')
	    REPLACE  F08 WITH PO_NO                                             &&記錄本訂單號碼,本月份後續的訂單號碼將以此往下編
	    UNLOCK
       ENDIF 
       THISFORM.SETALL('READONLY',.F.,'TEXTBOX')
       THISFORM.LBLF08.CAPTION='申請事由'
       THISFORM.LBLF09.CAPTION='申請日期                          至'
       THISFORM.LBLF11.CAPTION='申請加班上班時間'
       THISFORM.LBLF12.CAPTION='申請加班下班時間'       
       THISFORM.TXTF01.READONLY=.T.  
       THISFORM.TXTF02.READONLY=.T.   
       THISFORM.TXTF03.READONLY=IIF(A02.F10<>'*',.T.,.F.)
       THISFORM.TXTF04.READONLY=IIF(A02.F10<>'*',.F.,.T.)
       THISFORM.TXTF05.READONLY=.T.
       THISFORM.TXTF06.READONLY=.T.  
       THISFORM.OPTIONGROUP07.ENABLED=.T.
       THISFORM.TXTF03.VISIBLE=IIF(A02.F10<>'*',.T.,.F.)
       THISFORM.TXTF091.VISIBLE=.T.
       THISFORM.TXTF101.VISIBLE=.T.
       THISFORM.COMBOBOX03.VISIBLE=IIF(A02.F10<>'*',.F.,.T.)
       THISFORM.COMBOBOX03.VALUE=1  
       THISFORM.OPTIONGROUP07.VALUE=1      
       THISFORM.TXTF01.VALUE=DATE()             
       THISFORM.TXTF02.VALUE=PO_NO
       THISFORM.TXTF04.VALUE=IIF(A02.F10<>'*',IIF(SEEK(sys_oper,'A01'),A01.F03,''),'')
       THISFORM.TXTF03.VALUE=IIF(A02.F10<>'*',IIF(INDEXSEEK(THISFORM.TXTF04.VALUE,.T.,'S05','S052'),S05.F01,''),'')
       THISFORM.TXTF05.VALUE=IIF(A02.F10<>'*',IIF(INDEXSEEK(THISFORM.TXTF04.VALUE,.T.,'S05','S052'),S05.F05,''),'')
       THISFORM.TXTF06.VALUE=IIF(A02.F10<>'*',IIF(INDEXSEEK(THISFORM.TXTF04.VALUE,.T.,'S05','S052'),S05.F06,''),'')
       THISFORM.TXTF08.VALUE=''
       THISFORM.LBLF091.CAPTION = ALLTRIM(HK + '/')
       THISFORM.LBLF101.CAPTION = ALLTRIM(HK + '/')      
       THISFORM.TXTF091.VALUE=''
       THISFORM.TXTF101.VALUE=''
       THISFORM.TXTF11.VALUE=''
       THISFORM.TXTF12.VALUE=''
       THISFORM.LBLF131.CAPTION=''
       THISFORM.LBLF991.CAPTION=''
       IF A02.F10<>'*'
           THISFORM.TXTF04.SETFOCUS()
       ELSE
           THISFORM.COMBOBOX03.SETFOCUS()
       ENDIF    
       FLG='1'
  ENDPROC  
************
  PROCEDURE SHRGROUP.SHURE1_BOTT.CLICK
    IF EMPTY(THISFORM.TXTF02.VALUE)
       =MESSAGEBOX('單據編號不得空白,請洽系統管理人員處裡!',0+64,'提示視窗')
       THISFORM.TXTF02.SETFOCUS
       RETURN
    ENDIF  
    IF INDEXSEEK(THISFORM.TXTF02.VALUE,.F.,'S19','S191') =.T.
             SELE A24
             SEEK 'S019 '+SUBSTR(DTOS(CTOD(HK+'/01')),3,4)+THISFORM.TXTF02.VALUE
             IF FOUND()
                 DO WHILE F01+F02+F08='S019 '+SUBSTR(DTOS(CTOD(HK+'/01')),3,4)+THISFORM.TXTF02.VALUE
                        RLOCK()
                        DELE
                        UNLOCK
                        SKIP
                 ENDDO   
             ENDIF                    
             SELE A09
             SEEK 'S019 '+SUBSTR(DTOS(CTOD(HK+'/01')),3,4)
             IF FOUND()
                 RLOCK()
                 HX=VAL(RIGHT(F08,4))+1
   	         PO_NO=LEFT(F08,6)+PADL(ALLTRIM(STR(HX)),4,'0')
	         REPLACE  F08 WITH PO_NO                                             &&記錄本訂單號碼,本月份後續的訂單號碼將以此往下編
		 UNLOCK
                  THISFORM.TXTF02.VALUE=PO_NO
	          THISFORM.TXTF02.REFRESH
             ENDIF   	

    ENDIF     
    IF EMPTY(THISFORM.TXTF03.VALUE) OR EMPTY(THISFORM.TXTF05.VALUE)  OR EMPTY(THISFORM.TXTF06.VALUE) 
       =MESSAGEBOX('此員工姓名不存在,請至S05.人事薪資基本檔中新增資料後,在進行此變更作業!',0+64,'提示視窗')
       IF A02.F10<>'*'
           THISFORM.TXTF04.SETFOCUS
       ELSE
           THISFORM.COMBOBOX03.SETFOCUS
       ENDIF   
       RETURN
    ENDIF  
    IF EMPTY(ALLTRIM(THISFORM.TXTF04.VALUE))
       =MESSAGEBOX('員工姓名不得空白!',0+64,'提示視窗')
       THISFORM.TXTF04.SETFOCUS
       RETURN
    ENDIF          
    IF EMPTY(ALLTRIM(THISFORM.TXTF08.VALUE))
        =MESSAGEBOX(IIF(THISFORM.OPTIONGROUP07.VALUE=1,'申請','修改')+'事由不得空白!',0+64,'提示視窗')
       THISFORM.TXTF08.SETFOCUS
       RETURN
    ENDIF    
    ****
    STA_DATE=CTOD(HK+'/'+ALLTRIM(THISFORM.TXTF091.VALUE))
    END_DATE=CTOD(HK+'/'+ALLTRIM(THISFORM.TXTF101.VALUE))
    IF EMPTY(THISFORM.TXTF091.VALUE)
	 =MESSAGEBOX(IIF(THISFORM.OPTIONGROUP07.VALUE=1,'申請','修改')+'起始日期不得空白!',0+64,'提示視窗')
	THISFORM.TXTF091.SETFOCUS
	RETURN
    ENDIF
    IF EMPTY(STA_DATE)
	 =MESSAGEBOX(IIF(THISFORM.OPTIONGROUP07.VALUE=1,'申請','修改')+'起始日期格式不正確!',0+64,'提示視窗')
	THISFORM.TXTF091.SETFOCUS
	RETURN
    ENDIF    
    IF EMPTY(END_DATE)
	 =MESSAGEBOX(IIF(THISFORM.OPTIONGROUP07.VALUE=1,'申請','修改')+'截止日期不得空白!',0+64,'提示視窗')
	THISFORM.TXTF101.SETFOCUS
	RETURN
    ENDIF    
    IF EMPTY(THISFORM.TXTF101.VALUE)
	 =MESSAGEBOX(IIF(THISFORM.OPTIONGROUP07.VALUE=1,'申請','修改')+'截止日期格式不正確!',0+64,'提示視窗')
	THISFORM.TXTF101.SETFOCUS
	RETURN
    ENDIF      
    IF STA_DATE>END_DATE
	 =MESSAGEBOX(IIF(THISFORM.OPTIONGROUP07.VALUE=1,'申請','修改')+'起始日期不得大於'+IIF(THISFORM.OPTIONGROUP07.VALUE=1,'補登','修改')+'截止日期,請重新輸入!',0+64,'提示視窗')
	 THISFORM.TXTF091.SETFOCUS
	 RETURN            
   ENDIF        
   IF END_DATE<STA_DATE
	=MESSAGEBOX(IIF(THISFORM.OPTIONGROUP07.VALUE=1,'申請','修改')+'截止日期不得小於'+IIF(THISFORM.OPTIONGROUP07.VALUE=1,'補登','修改')+'起始日期,請重新輸入!',0+64,'提示視窗')
       THISFORM.TXTF101.SETFOCUS
       RETURN            
   ENDIF       
  ****
  IF THISFORM.OPTIONGROUP07.VALUE=1
       IF EMPTY(ALLTRIM(LEFT(THISFORM.TXTF11.VALUE,2))) AND EMPTY(ALLTRIM(RIGHT(THISFORM.TXTF11.VALUE,2))) 
           =MESSAGEBOX('申請加班上班時間不得空白!',0+64,'提示視窗')     
           THISFORM.TXTF11.SETFOCUS
           RETURN       
       ENDIF       
       IF EMPTY(ALLTRIM(LEFT(THISFORM.TXTF12.VALUE,2))) AND EMPTY(ALLTRIM(RIGHT(THISFORM.TXTF12.VALUE,2))) 
           =MESSAGEBOX('申請加班下班時間不得空白!',0+64,'提示視窗')     
           THISFORM.TXTF12.SETFOCUS
           RETURN       
       ENDIF          
  ENDIF
  ****
 IF LEN(ALLTRIM(THISFORM.TXTF11.VALUE))>1  
     IF LEN(ALLTRIM(THISFORM.TXTF11.VALUE))<>5 OR ;
          LEN(ALLTRIM(LEFT(ALLTRIM(THISFORM.TXTF11.VALUE),2)))=1 OR;
          LEN(ALLTRIM(RIGHT(ALLTRIM(THISFORM.TXTF11.VALUE),2)))=1 OR;
          VAL(LEFT(ALLTRIM(THISFORM.TXTF11.VALUE),2))>23 OR;
          VAL(RIGHT(ALLTRIM(THISFORM.TXTF11.VALUE),2))>59
          =MESSAGEBOX(IIF(THISFORM.OPTIONGROUP07.VALUE=1,'申請','修改')+'加班上班時間格式不正確!',0+64,'提示視窗')     
          THISFORM.TXTF11.SETFOCUS
          RETURN
     ENDIF 
 ENDIF
  ***** 
IF LEN(ALLTRIM(THISFORM.TXTF12.VALUE))>1 
     IF LEN(ALLTRIM(THISFORM.TXTF12.VALUE))<>5 OR ;
         LEN(ALLTRIM(LEFT(ALLTRIM(THISFORM.TXTF12.VALUE),2)))=1 OR;
         LEN(ALLTRIM(RIGHT(ALLTRIM(THISFORM.TXTF12.VALUE),2)))=1 OR;
         VAL(LEFT(ALLTRIM(THISFORM.TXTF12.VALUE),2))>23 OR;
         VAL(RIGHT(ALLTRIM(THISFORM.TXTF12.VALUE),2))>59
         =MESSAGEBOX(IIF(THISFORM.OPTIONGROUP07.VALUE=1,'申請','修改')+'加班下班時間格式不正確!',0+64,'提示視窗')     
         THISFORM.TXTF12.SETFOCUS
         RETURN
     ENDIF        
 ENDIF  
 ******
  IF THISFORM.OPTIONGROUP07.VALUE=1
       IF ALLTRIM(THISFORM.TXTF11.VALUE)>=ALLTRIM(THISFORM.TXTF12.VALUE)
            =MESSAGEBOX('申請加班上班時間不可大於或等於加班下班時間!',0+64,'提示視窗')  
            THISFORM.TXTF11.SETFOCUS
            RETURN
       ENDIF
  ELSE     
       IF LEN(ALLTRIM(THISFORM.TXTF11.VALUE))>1 AND LEN(ALLTRIM(THISFORM.TXTF12.VALUE))>1;
           AND ALLTRIM(THISFORM.TXTF11.VALUE)>=ALLTRIM(THISFORM.TXTF12.VALUE)
           =MESSAGEBOX('修改加班上班時間不可大於或等於加班下班時間!',0+64,'提示視窗')  
          THISFORM.TXTF11.SETFOCUS
           RETURN           
       ENDIF
  ENDIF  
  ***     
  SELECT S19
  APPEND BLANK
  LOCK()
  IF RLOCK()
       REPLACE F01 WITH THISFORM.TXTF01.VALUE
       REPLACE F02 WITH THISFORM.TXTF02.VALUE
       REPLACE F03 WITH THISFORM.TXTF03.VALUE
       REPLACE F04 WITH THISFORM.TXTF04.VALUE
       REPLACE F05 WITH THISFORM.TXTF05.VALUE
       REPLACE F06 WITH THISFORM.TXTF06.VALUE
       REPLACE F07 WITH ALLTRIM(STR(THISFORM.OPTIONGROUP07.VALUE))
       REPLACE F08 WITH THISFORM.TXTF08.VALUE
       REPLACE F09 WITH STA_DATE
       REPLACE F10 WITH END_DATE
       REPLACE F11 WITH IIF(LEN(ALLTRIM(THISFORM.TXTF11.VALUE))=1,'',THISFORM.TXTF11.VALUE)
       REPLACE F12 WITH IIF(LEN(ALLTRIM(THISFORM.TXTF12.VALUE))=1,'',THISFORM.TXTF12.VALUE)
       REPLACE F13 WITH 'N'
       REPLACE F14 WITH sys_oper
       REPLACE F99 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
   ENDIF          
   SELECT  S19_1
   APPEND BLANK
   LOCK()
   IF RLOCK()
       REPLACE F01 WITH THISFORM.TXTF01.VALUE
       REPLACE F02 WITH THISFORM.TXTF02.VALUE
       REPLACE F03 WITH THISFORM.TXTF03.VALUE
       REPLACE F04 WITH THISFORM.TXTF04.VALUE
       REPLACE F05 WITH THISFORM.TXTF05.VALUE
       REPLACE F06 WITH THISFORM.TXTF06.VALUE
       REPLACE F07 WITH ALLTRIM(STR(THISFORM.OPTIONGROUP07.VALUE))
       REPLACE F08 WITH THISFORM.TXTF08.VALUE
       REPLACE F09 WITH STA_DATE
       REPLACE F10 WITH END_DATE
       REPLACE F11 WITH IIF(LEN(ALLTRIM(THISFORM.TXTF11.VALUE))=1,'',THISFORM.TXTF11.VALUE)
       REPLACE F12 WITH IIF(LEN(ALLTRIM(THISFORM.TXTF12.VALUE))=1,'',THISFORM.TXTF12.VALUE)
       REPLACE F13 WITH 'N'
       REPLACE F14 WITH sys_oper
       REPLACE F99 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
   ENDIF
   UNLOCK
   THISFORM.GRID1.ENABLED=.T.
   THISFORM.REFRESH
   THISFORM.GRID1.SETFOCUS    
   THISFORM.SHRGROUP.ABANDON_BOTT.CLICK             
  ENDPROC
************  
  PROCEDURE ORPGROUP.EDIT_BOTT.CLICK
     SELECT S19_1
     THISFORM.KEY_LIST.ENABLED=.F. 
     THISFORM.MTH_LIST.ENABLED=.F.  
     THISFORM.ANS_BOTT.ENABLED=.F.
     THISFORM.LIST_BOTT.ENABLED=.F.        
     THISFORM.GRID1.ENABLED=.F.     
     THISFORM.SETALL('READONLY',.F.,'TEXTBOX')   
     THISFORM.OPTIONGROUP07.ENABLED=.T.
     THISFORM.TXTF091.VISIBLE=.T.
     THISFORM.TXTF101.VISIBLE=.T.
     THISFORM.TXTF01.READONLY=.T.
     THISFORM.TXTF02.READONLY=.T.
     THISFORM.TXTF03.READONLY=.T.
     THISFORM.TXTF04.READONLY=.T.
     THISFORM.TXTF05.READONLY=.T.
     THISFORM.TXTF06.READONLY=.T.
     THISFORM.LBLF091.CAPTION=ALLTRIM(HK+'/')
     THISFORM.LBLF101.CAPTION=ALLTRIM(HK+'/')      
     THISFORM.TXTF091.VALUE=ALLTRIM(RIGHT(DTOC(F09),2))
     THISFORM.TXTF101.VALUE=ALLTRIM(RIGHT(DTOC(F10),2))      
     THISFORM.LBLF131.CAPTION=''  
     THISFORM.LBLF991.CAPTION=''     
     THISFORM.TXTF08.SETFOCUS
     LOCK()
     IF !RLOCK()
        DO FILE_IMPACT
        RETURN
     ENDIF
  ENDPROC 
************  
  PROCEDURE SHRGROUP.SHURE2_BOTT.CLICK     
    IF EMPTY(ALLTRIM(THISFORM.TXTF08.VALUE))
        =MESSAGEBOX(IIF(THISFORM.OPTIONGROUP07.VALUE=1,'申請','修改')+'事由不得空白!',0+64,'提示視窗')
       THISFORM.TXTF08.SETFOCUS
       RETURN
    ENDIF    
    ****
    STA_DATE=CTOD(HK+'/'+ALLTRIM(THISFORM.TXTF091.VALUE))
    END_DATE=CTOD(HK+'/'+ALLTRIM(THISFORM.TXTF101.VALUE))
    IF EMPTY(THISFORM.TXTF091.VALUE)
	 =MESSAGEBOX(IIF(THISFORM.OPTIONGROUP07.VALUE=1,'申請','修改')+'起始日期不得空白!',0+64,'提示視窗')
	THISFORM.TXTF091.SETFOCUS
	RETURN
    ENDIF
    IF EMPTY(STA_DATE)
	 =MESSAGEBOX(IIF(THISFORM.OPTIONGROUP07.VALUE=1,'申請','修改')+'起始日期格式不正確!',0+64,'提示視窗')
	THISFORM.TXTF091.SETFOCUS
	RETURN
    ENDIF    
    IF EMPTY(END_DATE)
	 =MESSAGEBOX(IIF(THISFORM.OPTIONGROUP07.VALUE=1,'申請','修改')+'截止日期不得空白!',0+64,'提示視窗')
	THISFORM.TXTF101.SETFOCUS
	RETURN
    ENDIF    
    IF EMPTY(THISFORM.TXTF101.VALUE)
	 =MESSAGEBOX(IIF(THISFORM.OPTIONGROUP07.VALUE=1,'申請','修改')+'截止日期格式不正確!',0+64,'提示視窗')
	THISFORM.TXTF101.SETFOCUS
	RETURN
    ENDIF      
    IF STA_DATE>END_DATE
	 =MESSAGEBOX(IIF(THISFORM.OPTIONGROUP07.VALUE=1,'申請','修改')+'起始日期不得大於'+IIF(THISFORM.OPTIONGROUP07.VALUE=1,'補登','修改')+'截止日期,請重新輸入!',0+64,'提示視窗')
	 THISFORM.TXTF091.SETFOCUS
	 RETURN            
   ENDIF        
   IF END_DATE<STA_DATE
	=MESSAGEBOX(IIF(THISFORM.OPTIONGROUP07.VALUE=1,'申請','修改')+'截止日期不得小於'+IIF(THISFORM.OPTIONGROUP07.VALUE=1,'補登','修改')+'起始日期,請重新輸入!',0+64,'提示視窗')
       THISFORM.TXTF101.SETFOCUS
       RETURN            
   ENDIF        
  ****
  IF THISFORM.OPTIONGROUP07.VALUE=1
       IF EMPTY(ALLTRIM(LEFT(THISFORM.TXTF11.VALUE,2))) AND EMPTY(ALLTRIM(RIGHT(THISFORM.TXTF11.VALUE,2))) 
           =MESSAGEBOX('申請加班上班時間不得空白!',0+64,'提示視窗')     
           THISFORM.TXTF11.SETFOCUS
           RETURN       
       ENDIF       
       IF EMPTY(ALLTRIM(LEFT(THISFORM.TXTF12.VALUE,2))) AND EMPTY(ALLTRIM(RIGHT(THISFORM.TXTF12.VALUE,2))) 
           =MESSAGEBOX('申請加班下班時間不得空白!',0+64,'提示視窗')     
           THISFORM.TXTF12.SETFOCUS
           RETURN       
       ENDIF          
  ENDIF
  ****   
 IF LEN(ALLTRIM(THISFORM.TXTF11.VALUE))>1  
     IF LEN(ALLTRIM(THISFORM.TXTF11.VALUE))<>5 OR ;
          LEN(ALLTRIM(LEFT(ALLTRIM(THISFORM.TXTF11.VALUE),2)))=1 OR;
          LEN(ALLTRIM(RIGHT(ALLTRIM(THISFORM.TXTF11.VALUE),2)))=1 OR;
          VAL(LEFT(ALLTRIM(THISFORM.TXTF11.VALUE),2))>23 OR;
          VAL(RIGHT(ALLTRIM(THISFORM.TXTF11.VALUE),2))>59
          =MESSAGEBOX(IIF(THISFORM.OPTIONGROUP07.VALUE=1,'申請','修改')+'加班上班時間格式不正確!',0+64,'提示視窗')     
          THISFORM.TXTF11.SETFOCUS
          RETURN
     ENDIF 
 ENDIF
  ***** 
IF LEN(ALLTRIM(THISFORM.TXTF12.VALUE))>1 
     IF LEN(ALLTRIM(THISFORM.TXTF12.VALUE))<>5 OR ;
         LEN(ALLTRIM(LEFT(ALLTRIM(THISFORM.TXTF12.VALUE),2)))=1 OR;
         LEN(ALLTRIM(RIGHT(ALLTRIM(THISFORM.TXTF12.VALUE),2)))=1 OR;
         VAL(LEFT(ALLTRIM(THISFORM.TXTF12.VALUE),2))>23 OR;
         VAL(RIGHT(ALLTRIM(THISFORM.TXTF12.VALUE),2))>59
         =MESSAGEBOX(IIF(THISFORM.OPTIONGROUP07.VALUE=1,'申請','修改')+'加班下班時間格式不正確!',0+64,'提示視窗')     
         THISFORM.TXTF12.SETFOCUS
         RETURN
     ENDIF        
 ENDIF  
 ******
  IF THISFORM.OPTIONGROUP07.VALUE=1
       IF ALLTRIM(THISFORM.TXTF11.VALUE)>=ALLTRIM(THISFORM.TXTF12.VALUE)
            =MESSAGEBOX('申請加班上班時間不可大於或等於加班下班時間!',0+64,'提示視窗')  
            THISFORM.TXTF11.SETFOCUS
            RETURN
       ENDIF
  ELSE     
       IF LEN(ALLTRIM(THISFORM.TXTF11.VALUE))>1 AND LEN(ALLTRIM(THISFORM.TXTF12.VALUE))>1;
           AND ALLTRIM(THISFORM.TXTF11.VALUE)>=ALLTRIM(THISFORM.TXTF12.VALUE)
           =MESSAGEBOX('修改加班上班時間不可大於或等於加班下班時間!',0+64,'提示視窗')  
          THISFORM.TXTF11.SETFOCUS
           RETURN           
       ENDIF
  ENDIF   
  ***     
  SELECT  S19
  SET ORDER TO S191
  SEEK THISFORM.TXTF02.VALUE
  IF FOUND()
      REPLACE F07 WITH ALLTRIM(STR(THISFORM.OPTIONGROUP07.VALUE))
      REPLACE F08 WITH THISFORM.TXTF08.VALUE
      REPLACE F09 WITH STA_DATE
      REPLACE F10 WITH END_DATE
      REPLACE F11 WITH IIF(LEN(ALLTRIM(THISFORM.TXTF11.VALUE))=1,'',THISFORM.TXTF11.VALUE)
      REPLACE F12 WITH IIF(LEN(ALLTRIM(THISFORM.TXTF12.VALUE))=1,'',THISFORM.TXTF12.VALUE)
      REPLACE F14 WITH sys_oper      
      REPLACE F99 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')  
  ENDIF
  SELECT S19_1
  IF RLOCK()
      REPLACE F07 WITH ALLTRIM(STR(THISFORM.OPTIONGROUP07.VALUE))
      REPLACE F08 WITH THISFORM.TXTF08.VALUE
      REPLACE F09 WITH STA_DATE
      REPLACE F10 WITH END_DATE
      REPLACE F11 WITH IIF(LEN(ALLTRIM(THISFORM.TXTF11.VALUE))=1,'',THISFORM.TXTF11.VALUE)
      REPLACE F12 WITH IIF(LEN(ALLTRIM(THISFORM.TXTF12.VALUE))=1,'',THISFORM.TXTF12.VALUE)
      REPLACE F14 WITH sys_oper      
      REPLACE F99 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')       
  ELSE
      DO file_impact
      RETURN   
  ENDIF   
  THISFORM.SHRGROUP.ABANDON_BOTT.CLICK    
ENDPROC
*******************
  PROCEDURE ORPGROUP.DEL_BOTT.CLICK
     IF MESSAGEBOX('是否確定要刪除此筆資料',4+32+256,'請確認') = 6	      
         SELECT  S19_1
         LOCK()
         IF RLOCK()        
             SELECT  S19_1
             PO_NO=S19_1.F02 
             SELECT S19
             SET ORDER TO S191   && F02
             SEEK PO_NO
             IF FOUND()
                 SELECT S19
                 DELETE 
                 SELECT S19_1
	         DELETE 
	         UNLOCK
	         SKIP -1
	         IF BOF()
	             GO TOP
	         ENDIF                      
             ENDIF
             SELECT  A24
             SEEK 'S019 '+SUBSTR(DTOS(CTOD(HK+'/01')),3,4)+PO_NO
             IF !FOUND()
                 APPEND BLANK
                 RLOCK()
                 REPLACE  F01 WITH 'S019 '
                 REPLACE  F02 WITH SUBSTR(DTOS(CTOD(HK+'/01')),3,4)
                 REPLACE  F05 WITH 'SC'+F02
                 REPLACE  F06 WITH '加班申請(修改)作業'
                 REPLACE  F08 WITH PO_NO
                 UNLOCK           
              ENDIF   
             THISFORM.GRID1.SETFOCUS
             THISFORM.SHRGROUP.ABANDON_BOTT.CLICK
        ELSE
              DO file_impact    
        ENDIF
     ENDIF        
  ENDPROC
*************   
  PROCEDURE SHRGROUP.ABANDON_BOTT.CLICK
      SELECT S19_1
      THISFORM.SHRGROUP.ENABLED=.F.
      THISFORM.SHRGROUP.VISIBLE=.F.      
      THISFORM.ORPGROUP.ENABLED=.T.
      THISFORM.ORPGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
      THISFORM.CMDGROUP.ENABLED=.T.
      THISFORM.CMDGROUP.SETALL('ENABLED',.T.,'COMMANDBUTTON')
      THISFORM.CMDGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
      THISFORM.SETALL('READONLY',.T.,'TEXTBOX')   
      THISFORM.KEY_LIST.ENABLED=.T.     
      THISFORM.MTH_LIST.ENABLED=.T.  
      THISFORM.TXTF03.VISIBLE=.T.
      THISFORM.TXTF091.VISIBLE=.F.
      THISFORM.TXTF101.VISIBLE=.F.     
      THISFORM.COMBOBOX03.VISIBLE=.F.
      THISFORM.OPTIONGROUP07.ENABLED=.F.   
      THISFORM.GRID1.ENABLED=.T. 
      THISFORM.GRID1.SETFOCUS   
      IF THISFORM.GRID1.ACTIVEROW=0
          THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
          THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
          THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
          THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.       
          THISFORM.CMDGROUP.ENABLED=.F.
          THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
          THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
          THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
          THISFORM.LIST_BOTT.ENABLED=.F.
          THISFORM.ANS_BOTT.ENABLED=.F.
          THISFORM.TXTF01.VALUE=''
          THISFORM.TXTF02.VALUE=''
          THISFORM.TXTF03.VALUE=''
          THISFORM.TXTF04.VALUE=''  
          THISFORM.TXTF05.VALUE=''
          THISFORM.TXTF06.VALUE=''     
          THISFORM.TXTF08.VALUE=''
          THISFORM.TXTF091.VALUE=''
          THISFORM.TXTF101.VALUE=''
          THISFORM.TXTF11.VALUE=''
          THISFORM.TXTF12.VALUE=''
          THISFORM.OPTIONGROUP07.VALUE=1
          THISFORM.LBLF091.CAPTION=''
          THISFORM.LBLF101.CAPTION=''     
          THISFORM.LBLF131.CAPTION=''       
          THISFORM.LBLF991.CAPTION=''       
       ELSE
          THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
          THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
          THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
          THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.            
          THISFORM.CMDGROUP.ENABLED=.T.      
          THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  AND IIF(S19_1.F13<>'Y',.T.,.F.) &&判斷有無修改的權限
          THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)   AND IIF(S19_1.F13<>'Y',.T.,.F.) &&判斷有無刪除的權限
          THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限
          THISFORM.LIST_BOTT.ENABLED=IIF(A02.F11='*',.T.,.F.)   &&判斷有無列印明細的權限
          THISFORM.ANS_BOTT.ENABLED=IIF(A02.F08='*',.T.,.F.)  AND IIF(S19_1.F13<>'Y',.T.,.F.)   &&判斷有無確認的權限
       ENDIF     
       UNLOCK ALL  
  ENDPROC
  ********
  PROCEDURE SHRGROUP.FINISH_BOTT.CLICK 
       SELECT  A24         
       SEEK 'S019 '+SUBSTR(DTOS(CTOD(HK+'/01')),3,4)+PO_NO
       IF !FOUND()
           APPEND BLANK
           RLOCK()
           REPLACE  F01 WITH 'S019 '
           REPLACE  F02 WITH SUBSTR(DTOS(CTOD(HK+'/01')),3,4)
           REPLACE  F05 WITH 'SC'+F02
           REPLACE  F06 WITH '加班申請(修改)作業'
           REPLACE  F08 WITH PO_NO
           UNLOCK  
       ENDIF    
       SELECT S19_1
       THISFORM.SHRGROUP.ABANDON_BOTT.CLICK
  ENDPROC    
*********  
  PROCEDURE  TXTF04.INTERACTIVECHANGE
       THISFORM.TXTF03.VALUE=IIF(INDEXSEEK(THIS.VALUE,.T.,'S05','S052'),S05.F01,'')
       THISFORM.TXTF05.VALUE=IIF(INDEXSEEK(THIS.VALUE,.T.,'S05','S052'),S05.F05,'')
       THISFORM.TXTF06.VALUE=IIF(INDEXSEEK(THIS.VALUE,.T.,'S05','S052'),S05.F06,'') 
  ENDPROC      
******* 
  PROCEDURE ANS_BOTT.CLICK     &&確認程序
       IF MESSAGEBOX('是否要確認此筆資料?',4+32+256,'請確認') = 6
          SELECT S19_1
          IF S19_1.F13='Y'
             =MESSAGEBOX('此筆資料已確認過,請查明後再作確認!',0+64,'提示訊息視窗')
             THISFORM.GRID1.SETFOCUS
			 RETURN
		  ENDIF
	      S10='S10'+LEFT(DTOS(CTOD(HK+'/01')),6)
	      S105='S105'+LEFT(DTOS(CTOD(HK+'/01')),6)
		  IF !USED('S14')
		     SELECT  0
		     USE S14
	      ELSE
		     SELECT  S14
	      ENDIF
		  SET ORDER TO S141
	      IF !USED('&S10')
	         SELECT  0
		     USE (S10) ALIA S10
	      ELSE
		     SELECT  S10
		  ENDIF
		  SET ORDER TO S105
		  SEEK S19_1.F03
	      IF FOUND() 
	         IF S10.F98='Y'
	            =MESSAGEBOX('此人員已在'+HK+'之S10.薪資計算作業中已確認,故無法執行確認!',0+64,'提示視窗')
	            SELECT S14
	            USE
	            SELECT S10
	            USE
	            THISFORM.GRID1.SETFOCUS
	            RETURN
	         ELSE
	            SELECT S14
	            SEEK S19_1.F03+DTOS(CTOD(HK+'/01'))    
	            IF FOUND() AND !EMPTY(S14.F11)
	               =MESSAGEBOX('此人員已在'+HK+'之S10.薪資計算作業中已有加班資料,故不得執行確認,請至S10刪除此加班資料後才可確認!',0+64,'提示視窗')
	               SELECT S14
	               USE
	               SELECT S10
	               USE
	               THISFORM.GRID1.SETFOCUS
	               RETURN
	            ENDIF
	         ENDIF
		  ENDIF
		  SELECT S14
		  USE    
		  SELECT S10
		  USE
		  SELECT S19_1
          LOCK()
          IF RLOCK()
		     S16='S16'+LEFT(DTOS(CTOD(HK+'/01')),6)
		     S161='S161'+LEFT(DTOS(CTOD(HK+'/01')),6)
		     IF !USED('&S16')	&&上下班紀錄檔
		        SELECT  0
		        USE (S16) ALIA S16
		     ELSE
		        SELECT  S16
		     ENDIF
		     SET ORDER TO S161
		     SEEK S19_1.F03
			 IF FOUND() 
		        IF S16.F19='Y'
		           =MESSAGEBOX('此人員已在'+HK+'之S16.上下班紀錄作業中已確認,故無法執行確認!',0+64,'提示視窗')
		           SELECT S16
		           USE
		           THISFORM.GRID1.SETFOCUS
		           RETURN
		        ENDIF
		        IF !USED('S15')	&&年度假日設定檔
		           SELECT  0
		           USE S15 
		        ELSE
		           SELECT  S15
		        ENDIF
		        SET ORDER TO S151
			    S00_F52 = ALLTRIM(IIF(INDEXSEEK(S16.F02,.T.,'S05','S051'),IIF(INDEXSEEK('I' + S05.F29,.T.,'S00','S005'),S00.F52,''),''))	&&班別:休息時段起
			    S00_F53 = ALLTRIM(IIF(INDEXSEEK(S16.F02,.T.,'S05','S051'),IIF(INDEXSEEK('I' + S05.F29,.T.,'S00','S005'),S00.F53,''),''))	&&班別:休息時段止
			    S00_F52_H = VAL(LEFT(ALLTRIM(S00_F52),2))		&&班別:休息時段起(時)
			    S00_F52_M = VAL(RIGHT(ALLTRIM(S00_F52),2))		&&班別:休息時段起(分)
			    S00_F53_H = VAL(LEFT(ALLTRIM(S00_F53),2))		&&班別:休息時段止(時)
			    S00_F53_M = VAL(RIGHT(ALLTRIM(S00_F53),2))		&&班別:休息時段止(分)
			    S00_F63 = IIF(SEEK('Y','S00'),S00.F63,'F')		&&加班時間不滿時則以30分鐘計算
			    S00_F64 = IIF(SEEK('Y','S00'),S00.F64,'F')		&&加班時間若滿時則以60分鐘計算
			    S16_F07_H = VAL(LEFT(ALLTRIM(S16.F07),2))		&&班別:下班時段(時)
			    S16_F07_M = VAL(RIGHT(ALLTRIM(S16.F07),2))   	&&班別:下班時段(分)
	         	S16_F10_H = VAL(LEFT(ALLTRIM(S16.F10),2))		&&班別:加班上班緩衝時間(時)
   				S16_F10_M = VAL(RIGHT(ALLTRIM(S16.F10),2))   	&&班別:加班上班緩衝時間(分)
	  			FOR I = 0 TO S19_1.F10 - S19_1.F09
	     			D = VAL(RIGHT(DTOC(S19_1.F09),2)) + I
				    SELECT S16
				    SEEK S19_1.F03 + PADL(ALLTRIM(STR(D)),2,'0')
				    IF FOUND()
			           DO CASE
			              CASE !EMPTY(S19_1.F11) AND !EMPTY(S19_1.F12)
			                   REPLACE S16.F27 WITH S16.F13	&&變更前加班上班時間
			                   REPLACE S16.F28 WITH S16.F14	&&變更前加班下班時間
			                   REPLACE S16.F13 WITH S19_1.F11
			                   REPLACE S16.F14 WITH S19_1.F12
			              CASE !EMPTY(S19_1.F11) AND EMPTY(S19_1.F12)
			                   REPLACE S16.F27 WITH S16.F13
			                   REPLACE S16.F13 WITH S19_1.F11
			              CASE EMPTY(S19_1.F11) AND !EMPTY(S19_1.F12)
			                   REPLACE S16.F28 WITH S16.F14
			                   REPLACE S16.F14 WITH S19_1.F12
			           ENDCASE
	         		   REPLACE S16.F26 WITH S19_1.F02
					   S16_F13_H = VAL(LEFT(ALLTRIM(S16.F13),2))		&&加班上班時間(時)
					   S16_F13_M = VAL(RIGHT(ALLTRIM(S16.F13),2))		&&加班上班時間(分)
					   S16_F14_H = VAL(LEFT(ALLTRIM(S16.F14),2)) + IIF(LEFT(ALLTRIM(S16.F14),2) = '00',24,0)	&&加班下班時間(時)
					   S16_F14_M = VAL(RIGHT(ALLTRIM(S16.F14),2))		&&加班下班時間(分)
				       ****修正平常加班與假日加班之加班上班時間
				       IF S16.F18 <> 1 AND S16.F18 <> 7	&&平常日
				       	  IF IIF(INDEXSEEK(DTOS(CTOD(HK + '/' + S16.F01)),.T.,'S15','S151'),S15.F03 <> '1',.T.) = .T.	&&平常日且非假日
				         	 IF S16.F13 < S16.F10
			                    REPLACE S16.F13 WITH S16.F10
			             	 ENDIF
				          ENDIF
				       ENDIF
				       IF S16.F18 = 1 OR S16.F18 = 7		&&假日
				          IF IIF(INDEXSEEK(DTOS(CTOD(HK + '/' + S16.F01)),.T.,'S15','S151'),S15.F03 = '2',.F.) = .T.	&&假日補班
				         	 IF S16.F13 < S16.F10
			                    REPLACE S16.F13 WITH S16.F10
			             	 ENDIF
				          ENDIF
				       ENDIF
				       *****整理加班時間
					   IF S16.F18 = 1 OR S16.F18 = 7			&&假日
					  	  IF IIF(INDEXSEEK(DTOS(CTOD(HK + '/' + S16.F01)),.T.,'S15','S151'),S15.F03 <> '2',.T.) = .T.	&&國定假日
					   	     IF EMPTY(S16.F26)
					   	     	REPLACE S16.F11 WITH ''
					   	     	REPLACE S16.F12 WITH ''
					   	     ENDIF
					   	  ENDIF
					   ENDIF
				   	   *****計算加班小時數
					   S16_F171 = 0
					   IF S16.F13 < S16.F14
					      IF S16.F18 = 7 OR S16.F18 = 1 OR IIF(INDEXSEEK(DTOS(CTOD(HK + '/' + S16.F01)),.F.,'S15','S151'),S15.F03 = '1',.F.)	&&假日加班
					         IF S16.F14 <= S16.F10
					   		    DO CASE
					          	   CASE S16_F13_M <= S16_F14_H
					                    S16_F171 = ((S16_F14_H - S16_F13_H) * 60) + (S16_F14_M - S16_F13_M)
					           	   CASE S16_F13_M > S16_F14_H
					                    S16_F171 = ((S16_F14_H - S16_F13_H) * 60) - (S16_F13_M - S16_F14_M)
					            ENDCASE
					         ELSE
					   			DO CASE 
					           	   CASE S16_F13_M <= S16_F07_H
					                    S16_F171 = ((S16_F07_H - S16_F13_H) * 60) + (S16_F07_M - S16_F13_M)
					           	   CASE S16_F13_M > S16_F07_H
					                    S16_F171 = ((S16_F07_H - S16_F13_H) * 60) - (S16_F13_M - S16_F07_M)
					            ENDCASE
						        DO CASE
						           CASE S16_F10_M <= S16_F14_H
						                S16_F171 = S16_F171 + ((S16_F14_H - S16_F10_H) * 60) + (S16_F14_M - S16_F10_M)
						           CASE S16_F10_M > S16_F14_H
						                S16_F171 = S16_F171 + ((S16_F14_H - S16_F10_H) * 60) - (S16_F10_M - S16_F14_M)
						        ENDCASE
					         ENDIF
					         IF S16.F13 < S00_F52 AND S16.F14 > S00_F53
					            S16_F171 = S16_F171 - ((S00_F53_H - S00_F52_H) * 60) + (S00_F53_M - S00_F52_M)
					         ENDIF
					      ELSE		&&一般上班之加班
					         DO CASE
					            CASE S16.F13 >= S16.F10
					                 DO CASE 
					                    CASE S16_F13_M <= S16_F14_H
					                         S16_F171 = ((S16_F14_H - S16_F13_H) * 60) + (S16_F14_M - S16_F13_M)
					                    CASE S16_F13_M > S16_F14_H
					                       	 S16_F171 = ((S16_F14_H - S16_F13_H) * 60) - (S16_F13_M - S16_F14_M)
					                 ENDCASE
					            CASE S16.F13 < S16.F10
					                 DO CASE
					                    CASE S16_F10_M <= S16_F14_H
					                         S16_F171 = ((S16_F14_H - S16_F10_H) * 60) + (S16_F14_M - S16_F10_M)
					                    CASE S16_F10_M > S16_F14_H
					                       	 S16_F171 = ((S16_F14_H - S16_F10_H) * 60) - (S16_F10_M - S16_F14_M)
					                 ENDCASE
					        ENDCASE
					      ENDIF
					      *****判斷加班計算範圍
						  IF MOD(S16_F171,60) = 0
							 REPLACE S16.F17 WITH ROUND(S16_F171 / 60,1)
						  ELSE
							 DO CASE
						        CASE S00_F63 <> 'F' AND S00_F64 <> 'F'
						             IF MOD(S16_F171,60) >= VAL(S00_F63) AND MOD(S16_F171,60) < VAL(S00_F64)
						                REPLACE S16.F17 WITH INT(S16_F171 / 60) + 0.5
						             ELSE
						                IF MOD(S16_F171,60) >= VAL(S00_F64) AND MOD(S16_F171,60) < 60
						             	   REPLACE S16.F17 WITH INT(S16_F171 / 60) + 1
						                ELSE
						             	   REPLACE S16.F17 WITH INT(S16_F171 / 60)
						                ENDIF
						             ENDIF
						        CASE S00_F63 <> 'F' AND S00_F64 = 'F'
						             IF MOD(S16_F171,60) >= VAL(S00_F63) AND MOD(S16_F171,60) < 60
						                REPLACE S16.F17 WITH INT(S16_F171 / 60) + 0.5
						             ELSE
						                REPLACE S16.F17 WITH INT(S16_F171 / 60)
						             ENDIF
						        CASE S00_F63 = 'F' AND S00_F64 <> 'F'
						             IF MOD(S16_F171,60) >= VAL(S00_F64) AND MOD(S16_F171,60) < 60
						                REPLACE S16.F17 WITH INT(S16_F171 / 60) + 1
						             ELSE
						                REPLACE S16.F17 WITH INT(S16_F171 / 60)
						             ENDIF
						        CASE S00_F63 = 'F' AND S00_F64 = 'F'
						             REPLACE S16.F17 WITH ROUND(S16_F171 / 60,1)
						     ENDCASE
					      ENDIF
				       ENDIF
					   ***判斷加班小時數是否為零
					   IF S16.F17 = 0
					      REPLACE S16.F13 WITH ''
					      REPLACE S16.F14 WITH ''
					   ENDIF
					   ***無加班上下班時間加班小時數也為零
					   IF EMPTY(S16.F13) AND EMPTY(S16.F14)
					      REPLACE S16.F17 WITH 0
					   ENDIF
					ENDIF   
				ENDFOR
				SELECT S15
				USE
			 ENDIF
			 SELECT S16
			 USE
	         SELECT S19
		     SET ORDER TO S191
		     SEEK S19_1.F02
		     IF FOUND()
		        REPLACE S19.F13 WITH 'Y'
		        REPLACE S19.F99 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
		     ENDIF
		     SELECT S19_1
		     REPLACE S19_1.F13 WITH 'Y'
		     REPLACE S19_1.F99 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
		     =MESSAGEBOX('此確認作業已成功!',0+64,'提示視窗')
          ELSE
             DO file_impact
             UNLOCK ALL
             RETURN
          ENDIF
          UNLOCK ALL
	   ENDIF
	   THISFORM.GRID1.SETFOCUS
  ENDPROC
*******
  PROC LIST_BOTT.CLICK     &&列印明細 
      SELECT  S19_1
      ANS_RANGE=CREATEOBJECT("ANS_RANGE")  
      ANS_RANGE.SHOW 
      THISFORM.GRID1.SETFOCUS      
  ENDPROC
ENDDEFINE    
***********************************************列印程序
PROCEDURE PNT_PRC  
         SELECT S19_1
         LK=S19_1.F02
         SELECT * FROM S19 WHERE S19.F02=LK  NOWAIT 
         IF  _TALLY >0	
              REPORT FORM ALLTRIM(INT_116)+'S19' TO PRINT PROMPT  PREVIEW
              CLEAR
         ELSE
              =MESSAGEBOX('查無此資料可列印',0+48,'警示')
         ENDIF     
ENDPROC
***********************************************列印範圍選定
DEFINE CLASS ANS_RANGE AS FORM
*!*	  AUTOCENTER=.T.
  CAPTION='請輸入列印資料範圍'
  TOP=INT_015*200
  LEFT=INT_015*200   
  HEIGHT=INT_015*140
  WIDTH=INT_015*380
  FONTSIZE=INT_015*9
  MOVABLE=.F.
  MAXBUTTON=.F.
  MINBUTTON=.F.    
  CONTROLBOX=.F.
  BORDERSTYLE=2
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WINDOWTYPE=1
  NAME='ANS_RANGE'
  ADD OBJECT LABEL1 AS LABEL WITH;
      AUTOSIZE=.T.,;
      HEIGHT=INT_015*25,;
      LEFT=INT_015*30,;
      TOP=INT_015*30,;
      CAPTION='起始單據編號',;
      NAME='LABEL1'
  ADD OBJECT TEXT1 AS TEXTBOX WITH;
      TOP=INT_015*24,;
      LEFT=INT_015*110,;
      HEIGHT=INT_015*25,; 
      WIDTH=INT_015*80,; 
      MAXLENGTH=10,;
      NAME='TEXT1'      
  ADD OBJECT LABEL2 AS LABEL WITH;
      AUTOSIZE=.T.,;
      HEIGHT=INT_015*25,;
      LEFT=INT_015*200,;
      TOP=INT_015*30,;
      CAPTION='截止單據編號',;
      NAME='LABEL2'
  ADD OBJECT TEXT2 AS TEXTBOX WITH;
      TOP=INT_015*24,;
      LEFT=INT_015*280,;
      HEIGHT=INT_015*25,;   
      WIDTH=INT_015*80,;     
      MAXLENGTH=10,;   
      NAME='TEXT2'   
      **
  ADD OBJECT LABEL3 AS LABEL WITH;
      AUTOSIZE=.T.,;
      HEIGHT=INT_015*25,;
      LEFT=INT_015*30,;
      TOP=INT_015*61,;
      CAPTION='起始填單日期',;
      NAME='LABEL3'
  ADD OBJECT TEXT3 AS TEXTBOX WITH;
      TOP=INT_015*55,;
      LEFT=INT_015*110,;
      HEIGHT=INT_015*25,; 
      WIDTH=INT_015*70,;
      NAME='TEXT3'        
  ADD OBJECT LABEL4 AS LABEL WITH;
      AUTOSIZE=.T.,;
      HEIGHT=INT_015*25,;
      LEFT=INT_015*200,;
      TOP=INT_015*61,;
      CAPTION='截止填單日期',;
      NAME='LABEL4'
  ADD OBJECT TEXT4 AS TEXTBOX WITH;
      TOP=INT_015*55,;
      LEFT=INT_015*280,;
      HEIGHT=INT_015*25,; 
      WIDTH=INT_015*70,;
      NAME='TEXT4'             
  ADD OBJECT CMND1 AS COMMANDBUTTON WITH;
      LEFT=INT_015*100,;    
      TOP=INT_015*95,;        
      HEIGHT=INT_015*25,; 
      WIDTH=INT_015*55,;    
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\harrow.cur',;             
      CAPTION='\<Y.執行',;
      TOOLTIPTEXT='確認所輸入的範圍鍵值!快速鍵->ALT+Y',;
      NAME='CMND1'
  ADD OBJECT CMND2 AS COMMANDBUTTON WITH;
      LEFT=INT_015*215,;
      TOP=INT_015*95,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*55,; 
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\harrow.cur',;             
      CAPTION='\<C.取消',;
      TOOLTIPTEXT='取消作業!快速鍵->ALT+C',;
      NAME='CMND2'
  PROCEDURE INIT 
      THISFORM.SETALL('FONTSIZE',INT_015*10,'TEXTBOX')
      THISFORM.SETALL('FONTSIZE',INT_015*10,'LABEL')      
      THISFORM.SETALL('FONTSIZE',INT_015*10,'COMMANDBUTTON') 
      IF KEY()='F02'      
          THISFORM.LABEL1.CAPTION='起始單據編號'
          THISFORM.LABEL2.CAPTION='截止單據編號'
          THISFORM.TEXT1.MAXLENGTH=10
          THISFORM.TEXT2.MAXLENGTH=10
          THISFORM.TEXT1.WIDTH=INT_015*80 
          THISFORM.TEXT2.WIDTH=INT_015*80  
          THISFORM.TEXT1.VALUE=S19_1.F02
          THISFORM.TEXT2.VALUE=S19_1.F02    
          THISFORM.LABEL3.VISIBLE=.F.  
          THISFORM.LABEL4.VISIBLE=.F.   
          THISFORM.TEXT3.VISIBLE=.F.      
          THISFORM.TEXT4.VISIBLE=.F.    
      ELSE
          THISFORM.LABEL1.CAPTION='起始員工編號'
          THISFORM.LABEL2.CAPTION='截止員工編號'
          THISFORM.TEXT1.MAXLENGTH=4
          THISFORM.TEXT2.MAXLENGTH=4 
          THISFORM.TEXT1.WIDTH=INT_015*60
          THISFORM.TEXT2.WIDTH=INT_015*60         
          THISFORM.TEXT1.READONLY=IIF(A02.F10<>'*',.T.,.F.)
          THISFORM.TEXT2.READONLY=IIF(A02.F10<>'*',.T.,.F.)          
          THISFORM.TEXT1.VALUE=S19_1.F03
          THISFORM.TEXT2.VALUE=S19_1.F03    
          THISFORM.LABEL3.VISIBLE=.T.  
          THISFORM.LABEL4.VISIBLE=.T.   
          THISFORM.TEXT3.VISIBLE=.T.      
          THISFORM.TEXT4.VISIBLE=.T.     
          IF A02.F10<>'*'
              THISFORM.TEXT3.SETFOCUS       
          ELSE
              THISFORM.TEXT1.SETFOCUS
          ENDIF                           
      ENDIF
      THISFORM.TEXT3.VALUE=DATE()
      THISFORM.TEXT4.VALUE=DATE()
  ENDPROC    
  PROCEDURE CMND1.CLICK 
      IF KEY()='F02' 
          IF  EMPTY(THISFORM.TEXT1.VALUE)
               =MESSAGEBOX('起始單據編號不得為空白!',0+64,'提示訊息視窗')
               THISFORM.TEXT1.SETFOCUS
  	       RETURN 
          ENDIF
          IF  EMPTY(THISFORM.TEXT2.VALUE)
               =MESSAGEBOX('截止單據編號不得為空白!',0+64,'提示訊息視窗')
               THISFORM.TEXT2.SETFOCUS
  	       RETURN 
          ENDIF 
          SELECT  * FROM S19 WHERE F02>=THISFORM.TEXT1.VALUE AND F02<=THISFORM.TEXT2.VALUE AND  F13='Y' ;
                          AND  IIF(A02.F10<>'*',F14=sys_oper OR ALLTRIM(F04)=IIF(SEEK(sys_oper,'A01'),ALLTRIM(A01.F03),''),.T.);
                          ORDER BY F02,F03 NOWAIT     
          IF  _TALLY >0
                REPORT FORM ALLTRIM(INT_116)+'S19A_1' TO PRINT PROMPT   PREVIEW
                CLEAR  
          ELSE
                =MESSAGEBOX('查無此範圍資料',0+48,'警示')
               THISFORM.TEXT1.SETFOCUS
               RETURN     
          ENDIF           
      ELSE
          STAR_DATE=DTCX(THISFORM.TEXT3.VALUE)
          END_DATE=DTCX(THISFORM.TEXT4.VALUE)
          IF  EMPTY(THISFORM.TEXT1.VALUE)
               =MESSAGEBOX('起始人員編號不得為空白!',0+64,'提示訊息視窗')
               THISFORM.TEXT1.SETFOCUS
  	       RETURN 
          ENDIF
          IF  EMPTY(THISFORM.TEXT2.VALUE)
               =MESSAGEBOX('截止人員編號不得為空白!',0+64,'提示訊息視窗')
               THISFORM.TEXT2.SETFOCUS
  	       RETURN 
          ENDIF       
          IF  EMPTY(THISFORM.TEXT3.VALUE)
               =MESSAGEBOX('起始申請日期不得為空白!',0+64,'提示訊息視窗')
               THISFORM.TEXT3.SETFOCUS
  	       RETURN 
          ENDIF
          IF  EMPTY(THISFORM.TEXT4.VALUE)
               =MESSAGEBOX('截止申請日期不得為空白!',0+64,'提示訊息視窗')
               THISFORM.TEXT4.SETFOCUS
  	       RETURN 
          ENDIF    
          SELECT  * FROM S19 WHERE S19.F03>=THISFORM.TEXT1.VALUE AND S19.F03<=THISFORM.TEXT2.VALUE AND  S19.F13='Y' ;
                       AND S19.F01>=THISFORM.TEXT3.VALUE AND S19.F01<=THISFORM.TEXT4.VALUE ORDER BY F03,F01 NOWAIT                     
          IF  _TALLY >0
                REPORT FORM ALLTRIM(INT_116)+'S19A_2' TO PRINT PROMPT   PREVIEW
                CLEAR  
          ELSE
                =MESSAGEBOX('查無此範圍資料',0+48,'警示')
               THISFORM.TEXT1.SETFOCUS
               RETURN     
          ENDIF      
      ENDIF             
      THISFORM.RELEASE
  ENDPROC     
  ***      
  PROCEDURE CMND2.CLICK
      THISFORM.RELEASE
  ENDPROC      
  PROC CMND1.MOUSEENTER      
       LPARAMETERS nButton, nShift, nXCoord, nYCoord 
             THISFORM.CMND1.FORECOLOR=RGB(255,0,0)
             THISFORM.CMND1.TOP=INT_015*96
             THISFORM.CMND1.LEFT=INT_015*101
  ENDPROC     
  PROC CMND1.MOUSELEAVE      
        LPARAMETERS nButton, nShift, nXCoord, nYCoord 
             THISFORM.CMND1.FORECOLOR=RGB(0,0,0)  
             THISFORM.CMND1.TOP=INT_015*95
             THISFORM.CMND1.LEFT=INT_015*100                  
  ENDPROC     
  PROC CMND2.MOUSEENTER      
       LPARAMETERS nButton, nShift, nXCoord, nYCoord 
             THISFORM.CMND2.FORECOLOR=RGB(255,0,0)
             THISFORM.CMND2.TOP=INT_015*96
             THISFORM.CMND2.LEFT=INT_015*216
  ENDPROC     
  PROC CMND2.MOUSELEAVE      
        LPARAMETERS nButton, nShift, nXCoord, nYCoord 
             THISFORM.CMND2.FORECOLOR=RGB(0,0,0)  
             THISFORM.CMND2.TOP=INT_015*95
             THISFORM.CMND2.LEFT=INT_015*215                  
  ENDPROC     
ENDDEFINE  
*********人員編號
DEFINE CLASS COMBOBOX03 AS COMBOBOX 
       VISIBLE=.F.
       HEIGHT=INT_015*25
       WIDTH=INT_015*115
       FONTSIZE=INT_015*9   
       BOUNDCOLUMN=1
       ROWSOURCETYPE=1
       STYLE=2    
       VALUE=1
       NAME='COMBOBOX03' 
   PROCEDURE INIT        
       SELECT F01,F02 FROM S05 ORDER BY F01 INTO CURSOR S05_TEMP
       GO TOP
       THIS.ADDITEM('')
       DO WHILE  !EOF()
              THIS.ADDITEM(F01+SPACE(5)+ALLTRIM(F02))
      	      SELECT  S05_TEMP
      	      SKIP
       ENDDO 
       SELECT S05_TEMP
       USE         
   ENDPROC  
   PROCEDURE INTERACTIVECHANGE
     IF THIS.VALUE=1 
	 THISFORM.TXTF03.VALUE=''
	 THISFORM.TXTF04.VALUE=''
	 THISFORM.TXTF05.VALUE=''
	 THISFORM.TXTF06.VALUE=''   
     ELSE
	 THISFORM.TXTF03.VALUE=LEFT(ALLTRIM(THIS.DISPLAYVALUE),4)  
	 THISFORM.TXTF04.VALUE=IIF(INDEXSEEK(THISFORM.TXTF03.VALUE,.T.,'S05','S051'),S05.F02,'')
	 THISFORM.TXTF05.VALUE=IIF(INDEXSEEK(THISFORM.TXTF03.VALUE,.T.,'S05','S051'),S05.F05,'')
	 THISFORM.TXTF06.VALUE=IIF(INDEXSEEK(THISFORM.TXTF03.VALUE,.T.,'S05','S051'),S05.F06,'')
     ENDIF
     THISFORM.TXTF03.REFRESH      
     THISFORM.TXTF04.REFRESH 
     THISFORM.TXTF05.REFRESH 
     THISFORM.TXTF06.REFRESH 
  ENDPROC       
ENDDEFINE
*****變更方式
DEFINE CLASS OPTIONGROUP07 AS OPTIONGROUP
     VISIBLE=.T.
     HEIGHT=INT_015*25
     WIDTH=INT_015*150 
     BUTTONCOUNT=2
     VALUE=1
     ENABLED=.F.
     NAME='OPTIONGROUP07'
     OPTION1.CAPTION='申請'
     OPTION1.TOP=INT_015*5
     OPTION1.FONTSIZE=INT_015*9
     OPTION1.AUTOSIZE=.T.
     OPTION1.LEFT=INT_015*5
     OPTION1.NAME='OPTION1'
     OPTION2.CAPTION='修改'
     OPTION2.TOP=INT_015*5
     OPTION2.FONTSIZE=INT_015*9
     OPTION2.AUTOSIZE=.T.
     OPTION2.LEFT=INT_015*80
     OPTION2.NAME='OPTION2'     
   PROCEDURE INTERACTIVECHANGE  
       IF THIS.VALUE=1
       	   THISFORM.LBLF08.CAPTION='申請事由'
       	   THISFORM.LBLF09.CAPTION='申請日期                         至'
       	   THISFORM.LBLF11.CAPTION='申請加班上班時間'
       	   THISFORM.LBLF12.CAPTION='申請加班下班時間'
       ELSE
       	   THISFORM.LBLF08.CAPTION='修改事由'
       	   THISFORM.LBLF09.CAPTION='修改日期                         至'
       	   THISFORM.LBLF11.CAPTION='修改加班上班時間'
       	   THISFORM.LBLF12.CAPTION='修改加班下班時間'       
       ENDIF    
   ENDPROC       
ENDDEFINE


