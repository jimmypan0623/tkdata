**程式名稱:S04.勞保費表
SET EXCL OFF
CLOSE ALL
CLEAR 
AREA1='S04_1'
AREA2='S04'
FLG='0'
FCH=''
CHK=''
R=0
IF !USED('A01')		&&操作人員資料設定
   SELE 0
   USE A01
ELSE 
   SELE A01
ENDIF
SET ORDER TO A01      
IF !USED('A02')		&&權限設定檔
   SELE 0
   USE A02 INDE A02
ELSE
   SELE A02
ENDIF
SET ORDER TO A021      
SEEK SYS_OPER+'S04'        
IF !USED('S01')		&&薪資資料設定
   SELE 0
   USE S01 
ELSE
   SELE S01
ENDIF
SET ORDER TO S011   
SET FILTER TO F01='C'       &&勞保費率資料類別編號C
GO TOP            
IF !USED('S04')		&&勞保費表
   SELE 0
   USE S04 
ELSE
   SELE S04
ENDIF
SET ORDER TO S041
CREATE CURSOR S04_1 (F01 N(2),F02 N(7),F99 C(17))
INDE ON F01 TAG S04_11
SELECT F01,F02,F99 FROM S04 GROUP BY F01 ORDER BY F01 INTO CURSOR S04A 
SELE S04A
GO TOP
DO WHILE !EOF()
   SELE S04_1
   APPEND BLANK
   REPL F01 WITH S04A.F01
   REPL F02 WITH S04A.F02
   REPL F99 WITH S04A.F99
   SELE S04A
   SKIP   
ENDDO
SELE S04A
USE   
SELE S04_1
SET ORDER TO 1
GO TOP
**********
S04FORM=CREATEOBJECT("TKS04")
S04FORM.SHOW  
DEFINE CLASS TKS04 AS FORM
  CAPTION='S04.勞保費表'
*!*	  AUTOCENTER=.T.
  CONTROLBOX=.F.
  BORDERSTYLE=1  
  MAXBUTTON=.F.
  MINBUTTON=.F.
  MOVABLE=.F.
  CLOSABLE=.F.
  CONTROLCOUNT=57
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*550
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WIDTH=INT_015*791
  WINDOWTYPE=1
  ADD OBJECT SHAPE_GRID1  AS SHAPE WITH;
       TOP=INT_015*3,;
       LEFT=INT_015*5,;
       HEIGHT=INT_015*520,;
       WIDTH=INT_015*134,;
       SPECIALEFFECT=0,;
       TOOLTIPTEXT='勞工保險等級'     
       NAME='SHAPE_GRID1' 
  ADD OBJECT GRID1 AS GRID1 WITH;
      LEFT=INT_015*12,;
      TOP=INT_015*10,;
      HEIGHT=INT_015*506,;     
      WIDTH=INT_015*120,;  
      SCROLLBARS=2,;  
      COLUMNCOUNT=2,;            
      RECORDSOURCE='S04_1'
ADD OBJECT SHAPE_GRID2  AS SHAPE WITH;
       TOP=INT_015*147,;
       LEFT=INT_015*148,;
       HEIGHT=INT_015*376,;
       WIDTH=INT_015*637,;
       SPECIALEFFECT=0,;
       TOOLTIPTEXT='勞工保險費明細'     
       NAME='SHAPE_GRID2'      
 ADD OBJECT GRID2 AS GRID2 WITH;
      LEFT=INT_015*155,;
      TOP=INT_015*153,;
      HEIGHT=INT_015*365,;     
      WIDTH=INT_015*623,;    
      SCROLLBARS=2,;
      COLUMNCOUNT=6,;            
      RECORDSOURCE='S04',; 
      LINKMASTER='S04_1',;
      RELATIONALEXPR='F01',;
      CHILDORDER='S041',;  
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;
      COLUMN3.NAME='COLUMN3',;
      COLUMN4.NAME='COLUMN4',;
      COLUMN5.NAME='COLUMN5',;
      COLUMN6.NAME='COLUMN6'   
 ADD OBJECT CMDGROUP AS CMDGROUP WITH;
      VISIBLE=.F.        
 ADD OBJECT KEY_LIST AS KEY_LIST WITH; 
      VISIBLE=.F.       
ADD OBJECT SHAPEA AS SHAPE WITH;
       TOP=INT_015*3,;
       LEFT=INT_015*210,;
       HEIGHT=INT_015*137,;
       WIDTH=INT_015*260,;
       SPECIALEFFECT=0,;
       TOOLTIPTEXT='設定勞工保險費率'     
       NAME='SHAPEA' 
  ADD OBJECT LBLF01 AS LABEL WITH;
      TOP=INT_015*15,;
      LEFT=INT_015*220,;
      HEIGHT=INT_015*23,;      
      WIDTH=INT_015*240,;
      CAPTION='勞工保險普通事故費率：                              ％'      
  ADD OBJECT SPINNER1 AS SPINNER WITH;
      TOP=INT_015*8,;
      LEFT=INT_015*360,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*70,;
      VALUE=S01.F02,;
      KEYBOARDLOWVALUE=0,;
      KEYBOARDHIGHVALUE=100,;
      SPINNERLOWVALUE=0,;
      SPINNERHIGHVALUE=100,;
      INPUTMASK='999.99'
   ADD OBJECT LBLF02 AS LABEL WITH;
      TOP=INT_015*40,;
      LEFT=INT_015*220,;
      HEIGHT=INT_015*23,;      
      WIDTH=INT_015*240,;
      CAPTION='就業保險費率：                                             ％'    
   ADD OBJECT SPINNER2 AS SPINNER WITH;
      TOP=INT_015*33,;
      LEFT=INT_015*360,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*70,;
      VALUE=S01.F06,;
      KEYBOARDLOWVALUE=0,;
      KEYBOARDHIGHVALUE=100,;
      SPINNERLOWVALUE=0,;
      SPINNERHIGHVALUE=100,;
      INPUTMASK='999.99'   
   ADD OBJECT LBLF03 AS LABEL WITH;
      TOP=INT_015*65,;
      LEFT=INT_015*220,;
      HEIGHT=INT_015*23,;      
      WIDTH=INT_015*240,;
      CAPTION='勞工負擔比率：                                             ％'    
  ADD OBJECT SPINNER3 AS SPINNER WITH;
      TOP=INT_015*58,;
      LEFT=INT_015*360,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*70,;
      VALUE=S01.F03,;
      KEYBOARDLOWVALUE=0,;
      KEYBOARDHIGHVALUE=100,;
      SPINNERLOWVALUE=0,;
      SPINNERHIGHVALUE=100,;
      INPUTMASK='999.99'       
   ADD OBJECT LBLF04 AS LABEL WITH;
      TOP=INT_015*90,;
      LEFT=INT_015*220,;
      HEIGHT=INT_015*23,;      
      WIDTH=INT_015*240,;
      CAPTION='單位負擔比率：                                             ％'   
  ADD OBJECT SPINNER4 AS SPINNER WITH;
      TOP=INT_015*83,;
      LEFT=INT_015*360,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*70,;
      VALUE=S01.F04,;
      KEYBOARDLOWVALUE=0,;
      KEYBOARDHIGHVALUE=100,;
      SPINNERLOWVALUE=0,;
      SPINNERHIGHVALUE=100,;
      INPUTMASK='999.99'  
  ADD OBJECT LBLF05 AS LABEL WITH;
      TOP=INT_015*115,;
      LEFT=INT_015*220,;
      HEIGHT=INT_015*23,;      
      WIDTH=INT_015*240,;
      CAPTION='政府負擔比率：                                             ％'   
  ADD OBJECT SPINNER5 AS SPINNER WITH;
      TOP=INT_015*108,;
      LEFT=INT_015*360,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*70,;
      VALUE=S01.F05,;
      KEYBOARDLOWVALUE=0,;
      KEYBOARDHIGHVALUE=100,;
      SPINNERLOWVALUE=0,;
      SPINNERHIGHVALUE=100,;
      INPUTMASK='999.99'      
    ADD OBJECT LBLF06 AS LABEL WITH;
      TOP=INT_015*15,;
      LEFT=INT_015*498,;
      HEIGHT=INT_015*23,; 
      WIDTH=INT_015*50,;
      CAPTION='等         級' 
  ADD OBJECT TXTF06 AS TEXTBOX WITH;
      TOP=INT_015*8,;
      LEFT=INT_015*550,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*30,;
      MAXLENGTH=2,;
      INPUTMASK='99' 
 ADD OBJECT LBLF07 AS LABEL WITH;
      TOP=INT_015*15,;
      LEFT=INT_015*613,;
      HEIGHT=INT_015*23,; 
      WIDTH=INT_015*50,;
      CAPTION='投保薪資'   
 ADD OBJECT TXTF07 AS TEXTBOX WITH;
      TOP=INT_015*8,;
      LEFT=INT_015*663,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*55,;
      MAXLENGTH=7,;
      INPUTMASK='9999999' 
 ADD OBJECT LBLF99 AS LABEL WITH;
      TOP=INT_015*90,;
      LEFT=INT_015*498,;
      HEIGHT=INT_015*23,; 
      WIDTH=INT_015*50,;
      CAPTION='安全資料'     
 ADD OBJECT LBLF991 AS LABEL WITH;
      TOP=INT_015*90,;
      LEFT=INT_015*550,;
      AUTOSIZE=.T.,;
      CAPTION=''           
 ADD OBJECT SHRGROUP AS SHRGROUP WITH;
      TOP=INT_015*85,;
      LEFT=INT_015*675          
  ADD OBJECT ORPGROUP AS ORPGROUP WITH;      
      TOP=INT_015*112,;
      LEFT=INT_015*550                                     
 ******     
  PROCEDURE INIT
       THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.) 
       THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限    
       THISFORM.SHRGROUP.VISIBLE=.F.
       THISFORM.SHRGROUP.ENABLED=.F.
       THISFORM.SETALL('FONTSIZE',INT_015*9,'TEXTBOX')
       THISFORM.SETALL('FONTSIZE',INT_015*9,'LABEL')  
       THISFORM.SETALL('FONTSIZE',INT_015*9,'SPINNER') 
       THISFORM.SETALL('READONLY',.T.,'TEXTBOX') 
       THISFORM.SETALL('READONLY',.T.,'SPINNER')
       THISFORM.SPINNER1.VALUE=S01.F02
       THISFORM.SPINNER2.VALUE=S01.F06
       THISFORM.SPINNER3.VALUE=S01.F03
       THISFORM.SPINNER4.VALUE=S01.F04
       THISFORM.SPINNER5.VALUE=S01.F05       
       THISFORM.GRID1.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)
       THISFORM.GRID2.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'COLUMN')
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'HEADER')
       THISFORM.GRID2.SETALL('FONTSIZE',INT_015*9,'COLUMN')
       THISFORM.GRID2.SETALL('FONTSIZE',INT_015*9,'HEADER')
       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*30
       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*58
       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='等級'
       THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='投保薪資'
       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='S04_1.F01'
       THISFORM.GRID1.COLUMN2.CONTROLSOURCE='S04_1.F02'       
           THISFORM.GRID2.COLUMN1.WIDTH=INT_015*55
           THISFORM.GRID2.COLUMN2.WIDTH=INT_015*80
           THISFORM.GRID2.COLUMN3.WIDTH=INT_015*80
           THISFORM.GRID2.COLUMN4.WIDTH=INT_015*80
           THISFORM.GRID2.COLUMN5.WIDTH=INT_015*70 
           THISFORM.GRID2.COLUMN6.WIDTH=INT_015*300
           THISFORM.GRID2.COLUMN1.HEADER1.CAPTION='投保日數'
	   THISFORM.GRID2.COLUMN2.HEADER1.CAPTION='勞工負擔金額'
	   THISFORM.GRID2.COLUMN3.HEADER1.CAPTION='單位負擔金額'
	   THISFORM.GRID2.COLUMN4.HEADER1.CAPTION='政府負擔金額'	   
  	   THISFORM.GRID2.COLUMN5.HEADER1.CAPTION='合計'
  	   THISFORM.GRID2.COLUMN6.HEADER1.CAPTION=''
	   THISFORM.GRID2.COLUMN1.CONTROLSOURCE='S04.F03'
	   THISFORM.GRID2.COLUMN2.CONTROLSOURCE='S04.F04'
	   THISFORM.GRID2.COLUMN3.CONTROLSOURCE='S04.F05'
	   THISFORM.GRID2.COLUMN4.CONTROLSOURCE='S04.F06'
	   THISFORM.GRID2.COLUMN5.CONTROLSOURCE='S04.F04+S04.F05+S04.F06'
	   THISFORM.GRID2.COLUMN6.CONTROLSOURCE=''
      THISFORM.GRID1.READONLY=.T.     
      THISFORM.GRID2.READONLY=.T.   
      THISFORM.GRID1.SETFOCUS
      IF THISFORM.GRID1.ACTIVEROW=0 
           THISFORM.TXTF06.VALUE=''
           THISFORM.TXTF07.VALUE=''
           THISFORM.LBLF991.CAPTION='' 
           THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
           THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
       ELSE
           THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.) 
       	   THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)  
       ENDIF    
       JK='等級'
  ENDPROC     
*********         
  PROC GRID1.AFTERROWCOLCHANGE
       LPARAMETERS NCOLINDEX
       THISFORM.TXTF06.VALUE=S04_1.F01
       THISFORM.TXTF07.VALUE=S04_1.F02
       THISFORM.LBLF991.CAPTION=S04_1.F99
       THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","","COLUMN")
       THISFORM.REFRESH
       IF THISFORM.GRID1.ACTIVEROW=0 
           THISFORM.TXTF06.VALUE=''
           THISFORM.TXTF07.VALUE=''
           THISFORM.LBLF991.CAPTION='' 
           THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
           THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
       ELSE
           THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.) 
       	   THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)  
       ENDIF 
       JK=THISFORM.GRID1.COLUMN1.HEADER1.CAPTION
       FCH=THISFORM.ACTIVECONTROL.NAME
       CHK=''       
  ENDPROC  
 ****   
   PROC GRID1.MOUSEENTER
       LPARAMETERS nButton, nShift, nXCoord, nYCoord
         IF THISFORM.SHRGROUP.VISIBLE=.F. 
             THISFORM.GRID1.ENABLED=.T. 
         ELSE    
             THISFORM.GRID1.ENABLED=.F.                         
         ENDIF    
 ENDPROC  
**********
 PROC GRID2.AFTERROWCOLCHANGE
       LPARAMETERS NCOLINDEX
       R=RECNO('&AREA1')
       THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(RECNO('&AREA1')=R,RGB(255,255,0),'')","COLUMN")
       THISFORM.GRID1.ENABLED=.F. 
        FCH=THISFORM.ACTIVECONTROL.NAME
       JK=THIS.COLUMN1.HEADER1.CAPTION
       CHK=THISFORM.TXTF06.VALUE
       THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
*!*	       THISFORM.REFRESH
  ENDPROC 
*********  
PROCEDURE ORPGROUP.NEW_BOTT.CLICK 
    THISFORM.GRID1.ENABLED=.F. 
    THISFORM.GRID2.ENABLED=.F.  	
    THISFORM.SETALL('READONLY',.F.,'TEXTBOX') 
    THISFORM.TXTF06.SETFOCUS
    THISFORM.TXTF06.VALUE=''
    THISFORM.TXTF07.VALUE=0
    THISFORM.LBLF991.CAPTION='' 
ENDPROC 
********
PROCEDURE SHRGROUP.SHURE1_BOTT.CLICK
   DO CASE	 
    	  CASE EMPTY(THISFORM.TXTF06.VALUE)     
                      =MESSAGEBOX('等級不得為零!',0+64,'提示視窗')
      		      THISFORM.TXTF06.SETFOCUS
                      RETURN
          CASE IIF(SEEK(THISFORM.TXTF06.VALUE,'S04'),.T.,.F.)     
                      =MESSAGEBOX('您輸入的等級已在勞保費表中重複,請重新輸入!',0+64,'提示視窗')
      		      THISFORM.TXTF06.SETFOCUS
                      RETURN            
           CASE EMPTY(THISFORM.TXTF07.VALUE)     
                      =MESSAGEBOX('投保薪資不得為零!',0+64,'提示視窗')
      		      THISFORM.TXTF07.SETFOCUS
                      RETURN               
    ENDCASE  
    SELECT S04_1
    APPEND BLANK  
    LOCK()
    IF RLOCK() 
            REPLACE F01 WITH ABS(VAL(THISFORM.TXTF06.VALUE))
            REPLACE F02 WITH ABS(THISFORM.TXTF07.VALUE)
            REPLACE F99 WITH DTOC(DATE())+' '+IIF(SEEK(SYS_OPER,'A01'),A01.F03,'')
    ENDIF 
    SELECT S04
    FOR I=1 TO 30
    APPEND BLANK  
    LOCK()
        IF RLOCK()   
            REPLACE F01 WITH ABS(VAL(THISFORM.TXTF06.VALUE))
            REPLACE F02 WITH ABS(THISFORM.TXTF07.VALUE)
            REPLACE F03 WITH I
            REPLACE F04 WITH ROUND(((ROUND(S04.F02*(S01.F06/100)*(S01.F03/100),0)+ROUND(S04.F02*(S01.F02/100)*(S01.F03/100),0))/30)*I,0)
            REPLACE F05 WITH ROUND(((ROUND(S04.F02*(S01.F06/100)*(S01.F04/100),0)+ROUND(S04.F02*(S01.F02/100)*(S01.F04/100),0))/30)*I,0)
            REPLACE F06 WITH ROUND(((ROUND(S04.F02*(S01.F06/100)*(S01.F05/100),0)+ROUND(S04.F02*(S01.F02/100)*(S01.F05/100),0))/30)*I,0)       
            REPLACE F99 WITH DTOC(DATE())+' '+IIF(SEEK(SYS_OPER,'A01'),A01.F03,'')
        ENDIF 
    ENDFOR    
    UNLOCK
    THISFORM.ORPGROUP.NEW_BOTT.CLICK
    THISFORM.REFRESH       
ENDPROC
**********
PROCEDURE ORPGROUP.EDIT_BOTT.CLICK
   THISFORM.GRID1.ENABLED=.F. 
   THISFORM.GRID2.ENABLED=.F.   
   R=RECNO('&AREA1')
   THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(RECNO('&AREA1')=R,RGB(255,255,0),'')","COLUMN")
   THISFORM.SETALL('READONLY',.F.,'SPINNER')
   THISFORM.SETALL('READONLY',.F.,'TEXTBOX') 
   THISFORM.LBLF991.CAPTION='' 
   THISFORM.TXTF06.READONLY=.T.
   THISFORM.TXTF07.SETFOCUS
    LOCK()
    IF !RLOCK()
         DO FILE_IMPACT
         RETURN
    ENDIF   
ENDPROC
*******
PROCEDURE SHRGROUP.SHURE2_BOTT.CLICK  
    IF THISFORM.SPINNER3.VALUE+THISFORM.SPINNER4.VALUE+THISFORM.SPINNER5.VALUE<>100
        =MESSAGEBOX('投保負擔比率加總不等於100％!,請重新輸入',0+16,'錯誤訊息')
         RETURN   
    ENDIF
*!*	    THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","RGB(58,186,152)","COLUMN")
    IF THISFORM.SPINNER1.VALUE<>S01.F02 OR THISFORM.SPINNER2.VALUE<>S01.F06 OR THISFORM.SPINNER3.VALUE<>S01.F03 OR THISFORM.SPINNER4.VALUE<>S01.F04 OR THISFORM.SPINNER5.VALUE<>S01.F05
	 SELECT S01
	 SEEK 'C'
	 IF FOUND()
	*!*	    IF RLOCK()
	     REPLACE F02 WITH  THISFORM.SPINNER1.VALUE
	     REPLACE F06 WITH  THISFORM.SPINNER2.VALUE
	     REPLACE F03 WITH  THISFORM.SPINNER3.VALUE
	     REPLACE F04 WITH  THISFORM.SPINNER4.VALUE
	     REPLACE F05 WITH  THISFORM.SPINNER5.VALUE
	     REPLACE F07 WITH  DTOC(DATE())+' '+IIF(SEEK(SYS_OPER,'A01'),A01.F03,'')
	*!*	    ELSE
	*!*	        DO FILE_IMPACT
	*!*	        RETURN   
	  ENDIF
	  SELECT S04_1
	  IF RLOCK()
	       REPLACE F02 WITH ABS(THISFORM.TXTF07.VALUE)
	       REPLACE F99 WITH DTOC(DATE())+' '+IIF(SEEK(SYS_OPER,'A01'),A01.F03,'')
	  ELSE
	       DO FILE_IMPACT
	       RETURN   
	  ENDIF 
	  SELECT S04
	  GO TOP
	  DO WHILE !EOF()
		 REPLACE F02 WITH IIF(S04.F01=THISFORM.TXTF06.VALUE,ABS(THISFORM.TXTF07.VALUE),S04.F02)
	         REPLACE F04 WITH ROUND(((ROUND(S04.F02*(S01.F06/100)*(S01.F03/100),0)+ROUND(S04.F02*(S01.F02/100)*(S01.F03/100),0))/30)*S04.F03,0)
	         REPLACE F05 WITH ROUND(((ROUND(S04.F02*(S01.F06/100)*(S01.F04/100),0)+ROUND(S04.F02*(S01.F02/100)*(S01.F04/100),0))/30)*S04.F03,0)
	         REPLACE F06 WITH ROUND(((ROUND(S04.F02*(S01.F06/100)*(S01.F05/100),0)+ROUND(S04.F02*(S01.F02/100)*(S01.F05/100),0))/30)*S04.F03,0) 
		 REPLACE F99 WITH DTOC(DATE())+' '+IIF(SEEK(SYS_OPER,'A01'),A01.F03,'')
		 SELECT S04
		 SKIP
	  ENDDO  
    ELSE	   
	   SELECT S04_1
	   PO_NO=S04_1.F01 
	   IF S04_1.F02<>ABS(THISFORM.TXTF07.VALUE)
	       IF RLOCK()
		    REPLACE F02 WITH ABS(THISFORM.TXTF07.VALUE)
		    REPLACE F99 WITH DTOC(DATE())+' '+IIF(SEEK(SYS_OPER,'A01'),A01.F03,'')
	       ELSE
		    DO FILE_IMPACT
		    RETURN   
	       ENDIF 
	       DELETE FROM S04 WHERE F01=PO_NO  
	       SELECT S04
	       FOR I=1 TO 30
		      APPEND BLANK  
		      LOCK()
		      IF RLOCK()   
			   REPLACE F01 WITH THISFORM.TXTF06.VALUE
			   REPLACE F02 WITH ABS(THISFORM.TXTF07.VALUE)
			   REPLACE F03 WITH I
		           REPLACE F04 WITH ROUND(((ROUND(S04.F02*(S01.F06/100)*(S01.F03/100),0)+ROUND(S04.F02*(S01.F02/100)*(S01.F03/100),0))/30)*I,0)
		           REPLACE F05 WITH ROUND(((ROUND(S04.F02*(S01.F06/100)*(S01.F04/100),0)+ROUND(S04.F02*(S01.F02/100)*(S01.F04/100),0))/30)*I,0)
		           REPLACE F06 WITH ROUND(((ROUND(S04.F02*(S01.F06/100)*(S01.F05/100),0)+ROUND(S04.F02*(S01.F02/100)*(S01.F05/100),0))/30)*I,0) 
			   REPLACE F99 WITH DTOC(DATE())+' '+IIF(SEEK(SYS_OPER,'A01'),A01.F03,'')
		       ENDIF 
	       ENDFOR  
	   ENDIF	  
    ENDIF	   
   THISFORM.SHRGROUP.ABANDON_BOTT.CLICK 
ENDPROC
****
PROCEDURE ORPGROUP.DEL_BOTT.CLICK  
IF  MESSAGEBOX('是否確定要刪除此筆資料',4+32+256,'請確認')=6 
    SELE S04_1
    PO_NO=S04_1.F01
    LOCK()
    IF  RLOCK()
         DELE
         UNLOCK
         SKIP -1
         IF BOF()
              GO TOP
         ENDIF   
    ELSE
         DO FILE_IMPACT
    ENDIF 
    SELE S04
    DELETE FROM S04 WHERE F01=PO_NO        
 ENDIF 
    THISFORM.GRID1.SETFOCUS
ENDPROC
*******
PROCEDURE SHRGROUP.ABANDON_BOTT.CLICK
*!*	      THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","","COLUMN") 
      THISFORM.SHRGROUP.ENABLED=.F.
      THISFORM.SHRGROUP.VISIBLE=.F.      
      THISFORM.ORPGROUP.ENABLED=.T.
      THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.)   &&判斷有無新增的權限      
      THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  &&判斷有無修改的權限
      THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)   &&判斷有無刪除的權限
      THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限      
      THISFORM.ORPGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
      THISFORM.CMDGROUP.ENABLED=.T.
      THISFORM.CMDGROUP.SETALL('ENABLED',.T.,'COMMANDBUTTON')
      THISFORM.CMDGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
      THISFORM.SETALL('READONLY',.T.,'TEXTBOX') 
      THISFORM.SETALL('READONLY',.T.,'SPINNER')
      THISFORM.SPINNER1.VALUE=S01.F02
      THISFORM.SPINNER2.VALUE=S01.F06
      THISFORM.SPINNER3.VALUE=S01.F03
      THISFORM.SPINNER4.VALUE=S01.F04
      THISFORM.SPINNER5.VALUE=S01.F05
*!*	      THISFORM.LBLF991.CAPTION=S04.F99
      THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","RGB(58,186,152)","COLUMN")
      THISFORM.GRID1.ENABLED=.T.
      THISFORM.GRID2.ENABLED=.T.
      THISFORM.GRID1.SETFOCUS
      IF THISFORM.GRID1.ACTIVEROW=0 
           THISFORM.TXTF06.VALUE=''
           THISFORM.TXTF07.VALUE=''
   	   THISFORM.LBLF991.CAPTION='' 
           THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
           THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
       ELSE
           THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.) 
       	   THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)  
       ENDIF  
      UNLOCK ALL
      SELECT S04
      GO TOP
      THISFORM.REFRESH
  ENDPROC   
**********   
  PROCEDURE SHRGROUP.FINISH_BOTT.CLICK
      IF THISFORM.GRID2.RECORDSOURCE<>'S04'
            THISFORM.GRID2.RECORDSOURCE='S04'
            THISFORM.GRID2.CHILDORDER='S041'
      	   THISFORM.GRID2.COLUMN1.CONTROLSOURCE='S04.F03'
	   THISFORM.GRID2.COLUMN2.CONTROLSOURCE='S04.F04'
	   THISFORM.GRID2.COLUMN3.CONTROLSOURCE='S04.F05'
	   THISFORM.GRID2.COLUMN4.CONTROLSOURCE='S04.F06'
	   THISFORM.GRID2.COLUMN5.CONTROLSOURCE='S04.F04+S04.F05+S04.F06'
	   THISFORM.GRID2.COLUMN6.CONTROLSOURCE=''
     ENDIF	
      THISFORM.SHRGROUP.ABANDON_BOTT.CLICK
  ENDPROC
ENDDEFINE     
*********      
 PROCEDURE PNT_PRC  
 
 ENDPROC

