***F03總材料表
close all
clear 
FLG='0'
FCH=''
CHK=''
R=0
AREA1='F01'
AREA2='F07'
IF !USED('E00')
   SELE 0
   USE E00
ELSE
   SELE E00
ENDIF
SET ORDER TO 1
IF ! USED('A01')
   SELE 0
   USE A01 INDE A01
ELSE
   SELE A01
ENDIF      
SET ORDER TO A01
IF !USED('A02')
   SELE 0
   USE A02 INDE A02
ELSE
   SELE A02
ENDIF
SET ORDER TO A021      
SEEK sys_oper+'F03'

IF !USED('B01')
   SELE 0
   USE B01 INDE B01
ELSE
   SELE B01
ENDIF
SET ORDER TO 1
SELE F01,F02 FROM B01 WHERE F97='Y' INTO CURSOR B01_2 ORDER BY F01
CREATE CURSOR B01_1;
(F01 C(43),F02 C(40))
INDE ON F01 TAG B01_11
SET ORDER TO B01_11
SELE B01_2
GO TOP
DO WHILE !EOF()
   SELE B01_1
   APPEND BLANK
   REPL F01 WITH B01_2.F01
   REPL F02 WITH B01_2.F02
   SELE B01_2
   SKIP
ENDDO 
SELE B01_2
USE
IF !USED('F01')
   SELE 0
   USE F01 INDE F01
ELSE
   SELE F01
ENDIF
SET ORDER TO F011
SET RELATION TO F01 INTO B01_1
IF !USED('F02')
   SELE 0
   USE F02 
ELSE
   SELE F02
ENDIF
SET ORDER TO F021
SET RELATION TO F01 INTO B01_1
if !used('F07')
   SELE 0
   USE F07
ELSE
   SELE F07
ENDIF
SET ORDER TO F072
SET FILTER TO EMPTY(F05)
SET RELA TO F04 INTO B01
SET RELATION TO F03 INTO E00 ADDI
F03form=createobject("tkF03")
F03form.show  
define class tkF03 as form
  caption='F03.總材料表'
  controlbox=.F.
  BORDERSTYLE=3  
  MAXBUTTON=.F.
  MINBUTTON=.F.
  MOVABLE=.F.
  CLOSABLE=.F.
  controlcount=57
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*550
  showtips=.t.
  showwindow=1
  WIDTH=INT_015*789
  windowtype=1
  NAME='TKF03'
  add object shape1 as shape1 with;
      autocenter=.t.

  ADD OBJECT LBL_REC AS LBL_REC WITH;
      AUTOCENTER =.T.
  ADD OBJECT REC_COUNT AS REC_COUNT  with;
      caption=str(reccount())        
  add object shape2 as shape2 with;
      autocenter=.t.
  add object shape3 as shape3 with;
      autocenter=.t.
  ADD OBJECT PAGEFRAME1 AS PAGEFRAME WITH;
      LEFT=INT_015*236,;
      WIDTH=INT_015*540,;
      HEIGHT=INT_015*200,;
      FONTSIZE=INT_015*9,;
      PAGECOUNT=2,;
      TABSTRETCH=1,;
      ACTIVEPAGE=1,;
      VISIBLE=.T.,;
      PAGE1.NAME='PAGE1',;
      PAGE1.VISIBLE=.T.,;
      PAGE1.CAPTION='表頭資料',;
      PAGE2.NAME='PAGE2',;
      PAGE2.VISIBLE=.T.,;
      PAGE2.CAPTION='表身詳細資料內容'   
  ADD OBJECT KEY_LIST AS KEY_LIST WITH;
      AUTOCENTER=.T.
  ADD OBJECT grid1 AS grid1 WITH;
      columncount=2,;            
      RECORDSOURCE='F01',;
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2'      
  ADD OBJECT grid2 AS grid2 WITH;
      columncount=7,;            
      RECORDSOURCE='F07',;
      LINKMASTER='F01',;
      RELATIONALEXPR='F01+F02',;
      CHILDORDER='F072',;      
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;
      COLUMN3.NAME='COLUMN3',;
      COLUMN4.NAME='COLUMN4',;
      COLUMN5.NAME='COLUMN5',;
      COLUMN6.NAME='COLUMN6',;
      COLUMN7.NAME='COLUMN7'
  ADD OBJECT CMDGROUP AS CMDGROUP WITH;
      AUTOSIZE=.T.              
  ADD OBJECT ORPGROUP AS ORPGROUP WITH;    
      AUTOSIZE=.T.              

  PROCEDURE PAGEFRAME1.PAGE1.INIT     
     THIS.ADDOBJECT('LBLF01','LABEL')
     WITH THIS.LBLF01
          .VISIBLE=.T.
          .LEFT=INT_015*14
          .TOP=INT_015*27
          .WIDTH=INT_015*50
          .CAPTION='完成品號'          
     ENDWITH
     THIS.AddObject('LBLF012','LABEL')
     WITH THIS.LBLF012
                 .VISIBLE=.T.
                 .LEFT=INT_015*14
                 .TOP=INT_015*52
                 .WIDTH=INT_015*50
                 .CAPTION='品名規格'
     ENDWITH
     THIS.ADDOBJECT('LBLF011','LABEL')     
     WITH THIS.LBLF011
          .VISIBLE=.T.
          .LEFT=INT_015*65
          .TOP=INT_015*52
          .AUTOSIZE=.T.  
     ENDWITH            
     THIS.AddObject('LBLF02','LABEL')
     WITH THIS.LBLF02
              .VISIBLE=.T.
              .LEFT=INT_015*14
              .WIDTH=INT_015*50
              .TOP=INT_015*77
              .CAPTION='版        次'
      ENDWITH        

     THIS.AddObject('LBLLTL2','LABEL')
     WITH THIS.LBLLTL2
              .VISIBLE=.T.
              .LEFT=INT_015*189
              .WIDTH=INT_015*75
              .TOP=INT_015*152
              .CAPTION='平均成本總計'
      ENDWITH              
     THIS.AddObject('LBLLTL21','LABEL')
     WITH THIS.LBLLTL21
              .VISIBLE=.T.
              .LEFT=INT_015*270
              .TOP=INT_015*152
              .AUTOSIZE=.T.
              .CAPTION=''
      ENDWITH                    
     THIS.AddObject('LBLLTL3','LABEL')
     WITH THIS.LBLLTL3
              .VISIBLE=.T.
              .LEFT=INT_015*364
              .WIDTH=INT_015*75
              .TOP=INT_015*152
              .CAPTION='最新詢價總計'
      ENDWITH              
     THIS.AddObject('LBLLTL31','LABEL')
     WITH THIS.LBLLTL31
              .VISIBLE=.T.
              .LEFT=INT_015*445
              .TOP=INT_015*152
              .AUTOSIZE=.T.
              .CAPTION=''
      ENDWITH                          
     THIS.ADDOBJECT('TXTF01','TEXTBOX')     
     WITH THIS.TXTF01
          .VISIBLE=.T.
          .LEFT=INT_015*64
          .TOP=INT_015*23
          .WIDTH=INT_015*216
          .HEIGHT=INT_015*25
          .MAXLENGTH=43
     ENDWITH        
     THIS.ADDOBJECT('TXTF02','TEXTBOX')          
     WITH THIS.TXTF02
          .VISIBLE=.T.
          .LEFT=INT_015*64
          .TOP=INT_015*73
          .WIDTH=INT_015*25
          .HEIGHT=INT_015*25
          .MAXLENGTH=3
     ENDWITH             
  ENDPROC   
  PROCEDURE PAGEFRAME1.PAGE2.INIT
    THIS.ADDOBJECT('LBLF04','LABEL')
    WITH THIS.LBLF04
         .VISIBLE=.T.           
         .LEFT=INT_015*14
         .TOP=INT_015*14
         .WIDTH=INT_015*50
         .CAPTION='材料編號'          
    ENDWITH       
    THIS.ADDOBJECT('LBLF041','LABEL')
    WITH THIS.LBLF041
         .VISIBLE=.T.           
         .LEFT=INT_015*313
         .TOP=INT_015*14
         .AUTOSIZE=.T.          
    ENDWITH         
	THIS.ADDOBJECT('LBLF08','LABEL')
	WITH THIS.LBLF08  
                 .VISIBLE=.T.
                 .LEFT=INT_015*14
                 .TOP=INT_015*39
	         .WIDTH=INT_015*50
                 .CAPTION='階        次'
    ENDWITH  
    THIS.ADDOBJECT('LBLF03','LABEL')
    WITH THIS.LBLF03
         .VISIBLE=.T.
	     .LEFT=INT_015*248
	     .TOP=INT_015*64
	     .WIDTH=INT_015*50
	     .CAPTION='投入製程'
	ENDWITH     
    THIS.ADDOBJECT('LBLF031','Label')
    WITH THIS.LBLF031
         .VISIBLE=.T.
         .LEFT=INT_015*354
         .TOP=INT_015*64
         .AUTOSIZE=.T.
    ENDWITH     

    THIS.ADDOBJECT('LBLF06','LABEL')
    WITH THIS.LBLF06
         .VISIBLE=.T.    
         .LEFT=INT_015*14
         .TOP=INT_015*64
         .WIDTH=INT_015*50
         .CAPTION='前置天數'       
    ENDWITH     
    THIS.ADDOBJECT('LBLF07','LABEL')      
    WITH THIS.LBLF07
         .VISIBLE=.T.       
         .LEFT=INT_015*14
         .TOP=INT_015*89
         .WIDTH=INT_015*50
         .CAPTION='單位用量'
    ENDWITH         

    THIS.ADDOBJECT('LBLF09','LABEL')      
    WITH THIS.LBLF09
         .VISIBLE=.T.       
         .LEFT=INT_015*14
         .TOP=INT_015*114
         .WIDTH=INT_015*50
         .CAPTION='耗損率%'
    ENDWITH     


    THIS.ADDOBJECT('LBLF37','LABEL')
    WITH THIS.LBLF37
         .VISIBLE=.T.           
         .LEFT=INT_015*248
         .TOP=INT_015*89
         .WIDTH=INT_015*50
         .CAPTION='平均成本'
    ENDWITH     
    THIS.ADDOBJECT('LBLTTL2','LABEL')
    WITH THIS.LBLTTL2
         .VISIBLE=.T.           
         .LEFT=INT_015*400
         .TOP=INT_015*89
         .WIDTH=INT_015*25
         .CAPTION='小計'
    ENDWITH         
    THIS.ADDOBJECT('LBLTTL21','LABEL')
    WITH THIS.LBLTTL21
         .VISIBLE=.T.           
         .LEFT=INT_015*426
         .TOP=INT_015*89
         .AUTOSIZE=.T.
         .CAPTION=''
    ENDWITH             
    THIS.ADDOBJECT('LBLF38','LABEL')
    WITH THIS.LBLF38
         .VISIBLE=.T.           
         .LEFT=INT_015*248
         .TOP=INT_015*114
         .WIDTH=INT_015*50
         .CAPTION='最新詢價'
    ENDWITH     
    THIS.ADDOBJECT('LBLTTL3','LABEL')
    WITH THIS.LBLTTL3
         .VISIBLE=.T.           
         .LEFT=INT_015*400
         .TOP=INT_015*114
         .WIDTH=INT_015*25
         .CAPTION='小計'
    ENDWITH                 
    THIS.ADDOBJECT('LBLTTL31','LABEL')
    WITH THIS.LBLTTL31
         .VISIBLE=.T.           
         .LEFT=INT_015*426
         .TOP=INT_015*114
         .AUTOSIZE=.T.
         .CAPTION=''
    ENDWITH             
	THIS.ADDOBJECT('TXTF04','TEXTBOX')  
	WITH THIS.TXTF04
	     .VISIBLE=.T.
	     .LEFT=INT_015*65
	     .TOP=INT_015*10
	     .WIDTH=INT_015*241
	     .HEIGHT=INT_015*25
	     .MAXLENGTH=43
	     .NAME='TXTF04'  
	ENDWITH         
	THIS.ADDOBJECT('TXTF08','TEXTBOX')  
	WITH THIS.TXTF08
	     .VISIBLE=.T.
	     .LEFT=INT_015*65
	     .TOP=INT_015*35
	     .WIDTH=INT_015*30
	     .HEIGHT=INT_015*25
	     .MAXLENGTH=3
	     .NAME='TXTF08'  
	ENDWITH     
	THIS.ADDOBJECT('TXTF03','TEXTBOX')
	WITH THIS.TXTF03
	     .VISIBLE=.T.
	     .LEFT=INT_015*299
	     .TOP=INT_015*60
	     .WIDTH=INT_015*40
	     .HEIGHT=INT_015*25
	     .MAXLENGTH=4
	     .NAME='TXTF03'	    
	ENDWITH     
    THIS.ADDOBJECT('TXTF06','TEXTBOX')
    WITH THIS.TXTF06
         .VISIBLE=.T.
         .LEFT=INT_015*65
         .TOP=INT_015*60
         .WIDTH=INT_015*35
         .INPUTMASK='999'
         .NAME='TXTF06'
    ENDWITH     
    THIS.ADDOBJECT('TXTF07','TEXTBOX')
    WITH THIS.TXTF07
         .VISIBLE=.T.           
         .LEFT=INT_015*65
         .TOP=INT_015*85
         .WIDTH=INT_015*80
         .HEIGHT=INT_015*25
         .INPUTMASK='999999999.9999'
         .ALIGNMENT=1
         .NAME='TXTF07'                            
    ENDWITH         
    THIS.ADDOBJECT('TXTF09','TEXTBOX')
    WITH THIS.TXTF09
         .VISIBLE=.T.           
         .LEFT=INT_015*65
         .TOP=INT_015*110
         .WIDTH=INT_015*60
         .HEIGHT=INT_015*25
         .INPUTMASK='99.99'
         .ALIGNMENT=1         
         .NAME='TXTF09'                            
    ENDWITH     
    THIS.ADDOBJECT('TXTF37','TEXTBOX')
    WITH THIS.TXTF37    
         .VISIBLE=.T.           
         .LEFT=INT_015*299
         .TOP=INT_015*85
         .WIDTH=INT_015*85
         .INPUTMASK='999999999.999999'
         .ALIGNMENT=1
         .NAME='TXTF37'
    ENDWITH     
    THIS.ADDOBJECT('TXTF38','TEXTBOX')
    WITH THIS.TXTF38
         .VISIBLE=.T.           
         .LEFT=INT_015*299
         .TOP=INT_015*110
         .WIDTH=INT_015*85
         .INPUTMASK='999999999.999999'
         .ALIGNMENT=1         
         .NAME='TXTF38'                 
    ENDWITH     
  ENDPROC       
  PROCEDURE PAGEFRAME1.PAGE1.activate
     R=0    
     SELE F01   
     SEEK THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE     
     THISFORM.GRID1.ENABLED=.T.          
     THISFORM.GRID1.SETFOCUS     
        THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(F01.F05=.F.,RGB(255,0,0),'')","COLUMN")                        
     IF THISFORM.GRID1.ACTIVEROW=0

        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
        THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=''
        THISFORM.PAGEFRAME1.PAGE1.LBLF011.CAPTION=''
     ELSE
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.
     ENDIF   
     THISFORM.KEY_LIST.ENABLED=.T.
  ENDPROC
  PROCEDURE PAGEFRAME1.PAGE2.activate
       SELE F07 
         THISFORM.GRID2.SETFOCUS                     
     IF THISFORM.GRID2.ACTIVEROW=0 
         THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
         THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
         THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
         THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
         THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
         THISFORM.PAGEFRAME1.PAGE2.SETALL('VALUE','','TEXTBOX')
         THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE=''
         THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=''
         THISFORM.PAGEFRAME1.PAGE2.LBLF031.CAPTION=''
         THISFORM.PAGEFRAME1.PAGE2.LBLF041.CAPTION=''
         THISFORM.PAGEFRAME1.PAGE2.LBLTTL21.CAPTION=''
         THISFORM.PAGEFRAME1.PAGE2.LBLTTL31.CAPTION=''         
     ELSE
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.
        THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限  
     ENDIF   
     R=RECNO('&AREA1')
     THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(RECNO('&AREA1')=R,RGB(255,255,0),'')","COLUMN")
     THISFORM.GRID1.ENABLED=.F.     
     THISFORM.KEY_LIST.ENABLED=.F.     
  ENDPROC   

  PROC INIT              
       THISFORM.PAGEFRAME1.PAGE1.FONTSIZE=INT_015*9
       THISFORM.PAGEFRAME1.PAGE2.FONTSIZE=INT_015*9    
       THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限 
       THISFORM.ORPGROUP.NEW_BOTT.ENABLED=.F.        
       THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.                   
       THISFORM.ORPGROUP.NEW_BOTT.VISIBLE=.F.        
       THISFORM.ORPGROUP.EDIT_BOTT.VISIBLE=.F.               
       THISFORM.ORPGROUP.DEL_BOTT.VISIBLE=.F.                
       THISFORM.PAGEFRAME1.PAGE2.LBLF37.VISIBLE=IIF(A02.F08='*',.T.,.F.)   &&判斷有查看單價的權限          
       THISFORM.PAGEFRAME1.PAGE2.LBLF38.VISIBLE=IIF(A02.F08='*',.T.,.F.)   &&判斷有查看單價的權限   
       THISFORM.PAGEFRAME1.PAGE2.TXTF37.VISIBLE=IIF(A02.F08='*',.T.,.F.)   &&判斷有查看單價的權限          
       THISFORM.PAGEFRAME1.PAGE2.TXTF38.VISIBLE=IIF(A02.F08='*',.T.,.F.)   &&判斷有查看單價的權限          
       THISFORM.PAGEFRAME1.PAGE2.LBLTTL2.VISIBLE=IIF(A02.F08='*',.T.,.F.)   &&判斷有查看單價的權限          
       THISFORM.PAGEFRAME1.PAGE2.LBLTTL3.VISIBLE=IIF(A02.F08='*',.T.,.F.)   &&判斷有查看單價的權限   
       THISFORM.PAGEFRAME1.PAGE2.LBLTTL21.VISIBLE=IIF(A02.F08='*',.T.,.F.)   &&判斷有查看單價的權限          
       THISFORM.PAGEFRAME1.PAGE2.LBLTTL31.VISIBLE=IIF(A02.F08='*',.T.,.F.)   &&判斷有查看單價的權限                 
       THISFORM.PAGEFRAME1.PAGE1.LBLLTL2.VISIBLE=IIF(A02.F08='*',.T.,.F.)   &&判斷有查看單價的權限          
       THISFORM.PAGEFRAME1.PAGE1.LBLLTL3.VISIBLE=IIF(A02.F08='*',.T.,.F.)   &&判斷有查看單價的權限   
       THISFORM.PAGEFRAME1.PAGE1.LBLLTL21.VISIBLE=IIF(A02.F08='*',.T.,.F.)   &&判斷有查看單價的權限          
       THISFORM.PAGEFRAME1.PAGE1.LBLLTL31.VISIBLE=IIF(A02.F08='*',.T.,.F.)   &&判斷有查看單價的權限               
       thisform.setall('height',INT_015*25,'textbox')
       thisform.setall('height',INT_015*17,'label')
       thisform.setall('FONTSIZE',INT_015*9,'textbox')
       thisform.setall('FONTSIZE',INT_015*9,'label')       
       THISFORM.SETALL('READONLY',.T.,'TEXTBOX')
       THISFORM.GRID1.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)
       THISFORM.GRID2.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)
       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*149
       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*30
       thisform.GRID1.setall('FONTSIZE',INT_015*9,'COLUMN')
       thisform.GRID1.setall('FONTSIZE',INT_015*9,'HEADER')         
       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='製品料號'
       THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='版次'
       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='F01.F01'
       THISFORM.GRID1.COLUMN2.CONTROLSOURCE='F01.F02'
       THISFORM.grid2.COLUMN1.HEADER1.CAPTION='材料編號'
       THISFORM.grid2.COLUMN2.HEADER1.CAPTION='品名規格'
	   THISFORM.GRID2.COLUMN3.HEADER1.CAPTION='階次'
	   THISFORM.GRID2.COLUMN4.HEADER1.CAPTION='前置天數'
	   THISFORM.GRID2.COLUMN5.HEADER1.CAPTION='單位用量'
	   THISFORM.grid2.COLUMN6.HEADER1.CAPTION='耗損率%'
	   THISFORM.grid2.COLUMN7.HEADER1.CAPTION=' 投入製程'
       thisform.GRID2.setall('FONTSIZE',INT_015*9,'COLUMN')
       thisform.GRID2.setall('FONTSIZE',INT_015*9,'HEADER')	        	   
	   THISFORM.grid2.COLUMN1.CONTROLSOURCE='F07.F04'
	   THISFORM.grid2.COLUMN2.CONTROLSOURCE='B01.F02'
	   THISFORM.grid2.COLUMN3.CONTROLSOURCE='F07.F08'
	   THISFORM.grid2.COLUMN4.CONTROLSOURCE='F07.F06'
	   THISFORM.grid2.COLUMN5.CONTROLSOURCE='F07.F07'
	   THISFORM.grid2.COLUMN6.CONTROLSOURCE='F07.F09'
	   THISFORM.grid2.COLUMN7.CONTROLSOURCE='E00.F04'
	   THISFORM.grid2.COLUMN1.WIDTH=INT_015*211
	   THISFORM.GRID2.COLUMN2.WIDTH=INT_015*110
           THISFORM.GRID2.COLUMN3.WIDTH=INT_015*20
           THISFORM.GRID2.COLUMN4.WIDTH=INT_015*40
           THISFORM.GRID2.COLUMN5.WIDTH=INT_015*65    
           THISFORM.GRID2.COLUMN6.WIDTH=INT_015*40
           THISFORM.GRID2.COLUMN7.WIDTH=INT_015*80
       THISFORM.grid1.READONLY=.T.  
       THISFORM.GRID2.READONLY=.T.     
       THISFORM.grid1.SETFOCUS
       IF THISFORM.GRID1.ACTIVEROW=0
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
       ELSE
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.      
       ENDIF          
       THISFORM.KEY_LIST.DISPLAYVALUE='依製品料號排列'       
       JK='製品料號'
       SELE F01
       GO TOP
       THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=F01.F01
       THISFORM.PAGEFRAME1.PAGE1.LBLF011.CAPTION=B01.F02
  ENDPROC     
  PROC KEY_LIST.INIT 
       with this 
           .additem('依製品料號排列')
       endwith      
  ENDPROC 
  PROC grid1.AFTERROWCOLCHANGE
       LPARAMETERS nColIndex
          THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=F01.F01
          THISFORM.PAGEFRAME1.PAGE1.LBLF011.CAPTION=B01_1.F02
          THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE=F01.F02
          THISFORM.PAGEFRAME1.PAGE1.LBLLTL21.CAPTION=TRANSFORM(OTL2(F01.F01,F01.F02),'@R 999999999.999')
          THISFORM.PAGEFRAME1.PAGE1.LBLLTL31.CAPTION=TRANSFORM(OTL3(F01.F01,F01.F02),'@R 999999999.999')                    
       FCH=THISFORM.ACTIVECONTROL.NAME
       JK=THIS.COLUMN1.HEADER1.CAPTION  
       IF THIS.ACTIVEROW=0
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
       ELSE
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.
       ENDIF   
       CHK=''     
       thisform.refresh
  ENDPROC     
  PROC grid2.AFTERROWCOLCHANGE
       LPARAMETERS nColIndex
       THISFORM.PAGEFRAME1.PAGE2.TXTF06.VALUE=F07.F06
       THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=F07.F03
       THISFORM.PAGEFRAME1.PAGE2.LBLF031.CAPTION=E00.F04
       THISFORM.PAGEFRAME1.PAGE2.TXTF08.VALUE=F07.F08
       THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE=F07.F07
       THISFORM.PAGEFRAME1.PAGE2.TXTF09.VALUE=F07.F09
       THISFORM.PAGEFRAME1.PAGE2.TXTF37.VALUE=B01.F37
       THISFORM.PAGEFRAME1.PAGE2.TXTF38.VALUE=B01.F38
       THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE=F07.F04
       THISFORM.PAGEFRAME1.PAGE2.LBLF041.CAPTION=B01.F02
      THISFORM.PAGEFRAME1.PAGE2.LBLTTL21.CAPTION=TRANSFORM(F07.F07*(1+F07.F09/100)*B01.F37,'@R 999999.999999')       
      THISFORM.PAGEFRAME1.PAGE2.LBLTTL31.CAPTION=TRANSFORM(F07.F07*(1+F07.F09/100)*B01.F38,'@R 999999.999999')              
       FCH=THISFORM.ACTIVECONTROL.NAME
       JK=THIS.COLUMN1.HEADER1.CAPTION
       CHK=THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE+THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE
       if thisform.pageframe1.activepage=1
          thisform. CMDGROUP.SEEK_BOTT.ENABLED=.F.
       ENDIF   
  ENDPROC 
  PROCEDURE ORPGROUP.NEW_BOTT.CLICK    
        THISFORM.SETALL('READONLY',.F.,'TEXTBOX')       
        THISFORM.PAGEFRAME1.PAGE1.ENABLED=.F.
        THISFORM.GRID2.ENABLED=.F. 
        THISFORM.PAGEFRAME1.PAGE2.TXTF06.READONLY=.F.    
        THISFORM.PAGEFRAME1.PAGE2.TXTF07.SETFOCUS     
        THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE=''
        THISFORM.PAGEFRAME1.PAGE2.TXTF06.VALUE=0
        THISFORM.PAGEFRAME1.PAGE2.TXTF09.VALUE=0        
        THISFORM.PAGEFRAME1.PAGE2.TXTF10.VALUE=0
        THISFORM.PAGEFRAME1.PAGE2.TXTF11.VALUE=0
        THISFORM.PAGEFRAME1.PAGE2.TXTF12.VALUE=0
        THISFORM.PAGEFRAME1.PAGE2.LBLF041.CAPTION=''
  ENDPROC  

ENDDEFINE    
***********************************************列印程序
PROCEDURE PNT_PRC  
     LK=F01.F01   
     SELECT F07.F01,;
            F07.F02,;
            F07.F03,;      
            F07.F04,;    
            F07.F07,;
            F07.F09,;     
            B01_1.F02,;
            B01.F37,;
            B01.F38;            
     FROM F07,B01_1,B01;
     WHERE F07.F01=LK AND EMPTY(F07.F05) AND B01_1.F01=LK AND B01.F01=F07.F04 ORDER BY F07.F03 NOWAIT
     IF _tally >0
        REPORT FORM ALLTRIM(INT_116)+'F03' PREVIEW 
*         REPORT FORM ALLTRIM(INT_116)+'F07A' TO PRINTER PROMPT 
     ENDIF
             
ENDPROC
************************************************計算平均金額總計
FUNC OTL2
     PARA STK_NO,VRS_NO
     QT_OD=0
     SELECT F07
     SEEK STK_NO+VRS_NO
     IF FOUND()
        DO WHILE F01+F02=STK_NO +VRS_NO
              QT_OD=QT_OD+(F07*(1+F09/100)*B01.F37)
           SKIP
        ENDDO
     ELSE
       QT_OD=0
     ENDIF
     SELE F01
     RETURN QT_OD     
************************************************計算最新詢價總計
FUNC OTL3
     PARA STK_NO,VRS_NO
     QT_OD=0
     SELECT F07
     SEEK STK_NO+VRS_NO
     IF FOUND()
        DO WHILE F01+F02=STK_NO +VRS_NO
              QT_OD=QT_OD+(F07*(1+F09/100)*B01.F38)
           SKIP
        ENDDO
     ELSE
       QT_OD=0
     ENDIF
     SELE F01
     RETURN QT_OD          