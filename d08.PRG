**程式名稱:D08.進貨計劃
SET EXCL OFF
CLOSE ALL
CLEAR 
AREA1='D07'
FLG='0'
FCH=''
CHK=''
KF = ''
KF1 = ''
ASSIS_NO=''
SALES_B_NO=''
MAIL_TEXT=''
IF !USED('A01')
   SELE 0
   USE A01
ELSE 
   SELE A01
ENDIF
SET ORDER TO A01      
IF !USED('A02')
   SELE 0
   USE A02 INDE A02
ELSE
   SELE A02
ENDIF
SET ORDER TO A021      
CHA = IIF(SEEK(sys_oper + 'C66','A02'),.T.,.F.)
SEEK SYS_OPER+'D08'    
IF !USED('A14')
   SELE 0
   USE A14 INDE A14
ELSE
   SELE A14
ENDIF
SET ORDER TO A141        
IF !USED('B11')
   SELE 0
   USE B11
ELSE 
   SELE B11
ENDIF
SET ORDER TO B112      
IF !USED ('B01')
   SELE 0
   USE B01 
ELSE 
   SELE B01
ENDIF
SET ORDER TO B011
IF !USED('D01')
   SELE 0
   USE D01
ELSE 
   SELE D01
ENDIF
SET ORDER TO D011           
IF !USED('D04')
   SELE 0
   USE D04
ELSE 
   SELE D04
ENDIF
SET ORDER TO D041     
IF !USED('C01')
   SELE 0
   USE C01
ELSE 
   SELE C01
ENDIF
SET ORDER TO C011
IF !USED('C03')
   SELE 0
   USE C03
ELSE 
   SELE C03
ENDIF
SET ORDER TO C031 
IF !USED('D07')
   SELE 0
   USE D07 
ELSE
   SELE D07
ENDIF
SET ORDER TO D071
COD = SYS(21)
IF !USED('D38')
   SELE 0
   USE D38 
ELSE
   SELE D38
ENDIF
SET ORDER TO D381

IF !USED('P06')
   SELE 0
   USE P06
ELSE
   SELE P06
ENDIF
SET ORDER TO P061 
IF !USED('P07')
   SELE 0
   USE P07
ELSE
   SELE P07
ENDIF
SET ORDER TO P071 
IF !USED('P38')
   SELE 0
   USE P38
ELSE
  SELE P38
ENDIF
SET ORDER TO P381  
IF !USED('D04')
   SELE 0
   USE D04
ELSE
   SELE D04
ENDIF
SET ORDER TO D041 
IF !USED('P04')
   SELE 0
   USE P04
ELSE
   SELE P04
ENDIF
SET ORDER TO P041 
IF !USED('P05')
   SELE 0
   USE P05 
ELSE
   SELE P05
ENDIF
SET ORDER TO P051 
SELECT D07.F05,IIF(SEEK(D07.F05,'D01'),D01.F04,IIF(SEEK(D07.F05,'C01'),C01.F05,''));
               FROM D07 GROUP BY D07.F05 ORDER BY D07.F05 INTO CURSOR D07_1
INDE ON F05 TAG D07_11
SET ORDER TO D07_11
SELECT D07.F05,IIF(SEEK(D07.F05,'D01'),D01.F04,IIF(SEEK(D07.F05,'C01'),C01.F05,IIF(SEEK(D07.F05,'A14'),A14.F02,'')));
               FROM D07 GROUP BY D07.F05 ORDER BY D07.F05 INTO  CURSOR D07_1
INDE ON F05 TAG D07_11
SET ORDER TO D07_11              
SELE F01,F02,F03,F04 FROM D07 UNION ALL SELE F01,F02,F03,F04*(-1) FROM C05 WHERE F02= ANY(SELE F02 FROM D07) AND !EMPTY(C05.F15) INTO CURSOR TKE081             
SELE F01,F02,F03,F04 FROM E06 UNION ALL SELE F01,F02,F03,F04*(-1) FROM E16 WHERE F02= ANY(SELE F02 FROM D07) INTO CURSOR TKE082
CREATE CURSOR TKE08 (F01 C(12),F02 C(43),F03 D(8),F04 N(13,4))
INDEX ON F02+DTOS(F03)+F01 TAG TKE08
SET ORDER TO 1
SELECT  TKE081
GO TOP
DO WHILE !EOF()
       SELE TKE08
       APPEND BLANK
       REPLACE  F01 WITH TKE081.F01
       REPLACE  F02 WITH TKE081.F02
       REPLACE  F03 WITH TKE081.F03
       REPLACE  F04 WITH TKE081.F04
       SELECT  TKE081
       SKIP
ENDDO
SELECT  TKE081
USE
SELECT  TKE082
GO TOP
DO WHILE !EOF()
       SELECT  TKE08
       APPEND BLANK
       REPLACE  F01 WITH TKE082.F01
       REPLACE  F02 WITH TKE082.F02
       REPLACE  F03 WITH TKE082.F03
       REPLACE  F04 WITH TKE082.F04
       SELECT  TKE082
       SKIP
ENDDO             
SELE TKE082
USE
SELECT  D07
SET RELA TO F02 INTO B01
SET RELA TO F05 INTO D07_1 ADDI
GO TOP
*******
D08FORM=CREATEOBJECT("TKD08")
D08FORM.SHOW  
DEFINE CLASS TKD08 AS FORM
  CAPTION='D08.進貨計劃'
*!*	  AUTOCENTER=.T.
  CONTROLBOX=.F.
  BORDERSTYLE=1  
  MAXBUTTON=.F.
  MINBUTTON=.F.
  MOVABLE=.F.
  CLOSABLE=.F.
  CONTROLCOUNT=57
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*550
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WIDTH=INT_015*800
  WINDOWTYPE=1
  ADD OBJECT REC_COUNT AS REC_COUNT  WITH;
      LEFT=INT_015*690,;
      WIDTH=INT_015*60,;
      TOP=INT_015*8
  ADD OBJECT KEY_LIST AS KEY_LIST WITH;
      WIDTH=INT_015*160,;
      AUTOCENTER=.T.
  ADD OBJECT GRID1 AS GRID1 WITH;
      COLUMNCOUNT=14,;            
      RECORDSOURCE='D07',; 
      TOP=INT_015*61,; 
      HEIGHT=INT_015*465,;     
      WIDTH=INT_015*789,;      
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;
      COLUMN3.NAME='COLUMN3',; 
      COLUMN4.NAME='COLUMN4',; 
      COLUMN5.NAME='COLUMN5',;             
      COLUMN6.NAME='COLUMN6',;       
      COLUMN7.NAME='COLUMN7',;       
      COLUMN8.NAME='COLUMN8',;
      COLUMN9.NAME='COLUMN9',;   
      COLUMN10.NAME='COLUMN10',;
      COLUMN11.NAME='COLUMN11',;
      COLUMN12.NAME='COLUMN12',;
      COLUMN13.NAME='COLUMN13',;
      COLUMN14.NAME='COLUMN14'
   ADD OBJECT CMDGROUP AS CMDGROUP WITH;
      TOP=INT_015*0,;
      LEFT=INT_015*165,;
      ENABLED=.T.,;
      VISIBLE=.T.            
  ADD OBJECT ORPGROUP AS ORPGROUP WITH;      
      TOP=INT_015*0,;
      LEFT=INT_015*467        
*!*	  ADD OBJECT EDIT_BOT AS COMMANDBUTTON WITH;
*!*	      TOP=INT_015*5,;
*!*	      LEFT=INT_015*380,;
*!*	      HEIGHT=INT_015*25,;      
*!*	      WIDTH=INT_015*40,;
*!*	      FONTSIZE=INT_015*9,;
*!*	      MOUSEPOINTER=99,;
*!*	      MOUSEICON='BMPS\harrow.cur',;           
*!*	      CAPTION='\<E.修改'      
  ADD OBJECT CHANGE_BOT AS COMMANDBUTTON WITH;
      TOP=INT_015*5,;
      LEFT=INT_015*555,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\harrow.cur',;           
      CAPTION='\<C.異動'                            
  ADD OBJECT IODT_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*5,;
      LEFT=INT_015*422,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*65,;
      FONTSIZE=INT_015*9,;
      CAPTION='\<Z.預期進出'                 
  ADD OBJECT REPLY_REMARK AS COMMANDBUTTON WITH;
      TOP=INT_015*5,;
      LEFT=INT_015*380,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\harrow.cur',;   
      CAPTION='\<E.修改'                     
  ADD OBJECT OUMNY AS COMMANDBUTTON WITH;
      TOP=INT_015*5,;
      LEFT=INT_015*489,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*65,;
      FONTSIZE=INT_015*9,;
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\harrow.cur',;           
      CAPTION='\<B.進貨預估'             
   ADD OBJECT LBLF03 AS LABEL WITH;
      TOP=INT_015*38,;
      LEFT=INT_015*13,;
      HEIGHT=INT_015*17,;      
      AUTOSIZE=.T.,;
      FONTSIZE=INT_015*9,;
       CAPTION='進貨日期'            
  ADD OBJECT TXTF03 AS TEXTBOX WITH;
      TOP=INT_015*33,;
      LEFT=INT_015*70,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*65,;
      MAXLENGTH=8,;
      FONTSIZE=INT_015*9
   ADD OBJECT LBLF13 AS LABEL WITH;
      TOP=INT_015*38,;
      LEFT=INT_015*163,;
      HEIGHT=INT_015*17,;      
      AUTOSIZE=.T.,;
      FONTSIZE=INT_015*9,;
       CAPTION='運貨方式'            
  ADD OBJECT TXTF13 AS TEXTBOX WITH;
      TOP=INT_015*33,;
      LEFT=INT_015*220,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*80,;
      MAXLENGTH=14,;
      FONTSIZE=INT_015*9      
  ADD OBJECT TRANS_STYLE AS COMBOBOX WITH;
      TOP=INT_015*33,;
      LEFT=INT_015*220,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*80,;
      MAXLENGTH=14,;
      FONTSIZE=INT_015*9 ,;  
      ROWSOURCE='海運,空運,快遞,自取,直寄,其他',;
       ROWSOURCETYPE=1,;
       STYLE=0,;
       VISIBLE=.F.,;
       NAME='TRANS_STYLE'    
  ADD OBJECT LBLF17 AS LABEL WITH;
      TOP=INT_015*38,;
      LEFT=INT_015*310,;
      HEIGHT=INT_015*23,;      
      WIDTH=INT_015*30,;
      FONTSIZE=INT_015*9,;
      CAPTION='備 註'     
  ADD OBJECT TXTF17 AS TEXTBOX WITH;
      TOP=INT_015*33,;
      LEFT=INT_015*340,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*315,;
      MAXLENGTH=60,;
      FONTSIZE=INT_015*9
  ADD OBJECT YES AS COMMANDBUTTON WITH;
      TOP=INT_015*33,;
      LEFT=INT_015*660,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;
      CAPTION='\<Y.確定'
  ADD OBJECT PUTOFF AS COMMANDBUTTON WITH;
      TOP=INT_015*33,;
      LEFT=INT_015*702,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;
      CAPTION='\<N.取消' 
  ADD OBJECT LBLF071 AS LABEL WITH;
      TOP=INT_015*39,;
      LEFT=INT_015*680,;
      FONTSIZE=INT_015*9,;
      VISIBLE=.T.,;
      AUTOSIZE=.T.,;
      CAPTION=''                                                   
  PROCEDURE INIT
       THISFORM.ORPGROUP.NEW_BOTT.VISIBLE=.F.
       THISFORM.ORPGROUP.EDIT_BOTT.VISIBLE=.F.
       THISFORM.ORPGROUP.DEL_BOTT.VISIBLE=.F.
       THISFORM.YES.ENABLED=.F.
       THISFORM.YES.VISIBLE=.F.
       THISFORM.PUTOFF.ENABLED=.F.
       THISFORM.PUTOFF.VISIBLE=.F.
       THISFORM.TXTF03.READONLY=.T.
       THISFORM.TXTF13.READONLY=.T.
       THISFORM.TXTF17.READONLY=.T.
       THISFORM.OUMNY.VISIBLE=IIF(A02.F10='*',.T.,.F.)  
       THISFORM.GRID1.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'COLUMN')
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'HEADER')   
       THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(DATE()-CTOD(LEFT(D07.F08,9))<=VAL(INT_208) AND D07.F09='1',RGB(0,255,255),IIF(D07.F09<>'1',RGB(255,255,0),IIF(D07.F03<DATE() AND D07.F09='1',RGB(255,0,0),'')))","COLUMN")
       THISFORM.GRID1.LOCKCOLUMNS=2
       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*80
       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*65
       THISFORM.GRID1.COLUMN3.WIDTH=INT_015*149
       THISFORM.GRID1.COLUMN4.WIDTH=INT_015*110
       THISFORM.GRID1.COLUMN5.WIDTH=INT_015*80
       THISFORM.GRID1.COLUMN6.WIDTH=INT_015*150
       THISFORM.GRID1.COLUMN7.WIDTH=INT_015*140
       THISFORM.GRID1.COLUMN8.WIDTH=INT_015*90       
       THISFORM.GRID1.COLUMN9.WIDTH=INT_015*120
       THISFORM.GRID1.COLUMN10.WIDTH=INT_015*50
       THISFORM.GRID1.COLUMN11.WIDTH=INT_015*60
       THISFORM.GRID1.COLUMN12.WIDTH=INT_015*105
       THISFORM.GRID1.COLUMN13.WIDTH=INT_015*40
       THISFORM.GRID1.COLUMN14.WIDTH=INT_015*85
       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='採購單號'
       THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='預進日期'
       THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='料        號'	   
       THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='品名規格'	   
       THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='進貨數量'
       THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='運貨方式'
       THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='採購用途' 
       THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='預期結餘'        
       THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='客戶PO/NO'
       THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='廠商編號'  	   
       THISFORM.GRID1.COLUMN11.HEADER1.CAPTION='廠商簡稱'  	
       THISFORM.GRID1.COLUMN12.HEADER1.CAPTION='異動狀態與日期'  
       THISFORM.GRID1.COLUMN13.HEADER1.CAPTION='幣別'  	
       THISFORM.GRID1.COLUMN14.HEADER1.CAPTION='單        價'  
       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='D07.F01'
       THISFORM.GRID1.COLUMN2.CONTROLSOURCE='D07.F03'
       THISFORM.GRID1.COLUMN3.CONTROLSOURCE='D07.F02'
       THISFORM.GRID1.COLUMN4.CONTROLSOURCE='B01.F02'
       THISFORM.GRID1.COLUMN5.CONTROLSOURCE='D07.F04'
       THISFORM.GRID1.COLUMN6.CONTROLSOURCE="D07.F13 + IIF(EMPTY(D07.F17),'','(' + ALLTRIM(D07.F17) + ')')"
       THISFORM.GRID1.COLUMN7.CONTROLSOURCE='D07.F07'
       THISFORM.GRID1.COLUMN8.CONTROLSOURCE="TRANSFORM(ALTT(D07.F02,'1')+MRP_QTY(D07.F02,D07.F03,D07.F01),'@R 9999999999.99')"
       THISFORM.GRID1.COLUMN8.ALIGNMENT=5       
       THISFORM.GRID1.COLUMN9.CONTROLSOURCE="IIF(SEEK(LEFT(ALLTRIM(D07.F07),10),'P05'),IIF(SEEK(P05.F06,'C03'),C03.F14,''),'')"
       THISFORM.GRID1.COLUMN10.CONTROLSOURCE='D07.F05'
       THISFORM.GRID1.COLUMN11.CONTROLSOURCE='D07_1.EXP_2'	    
       THISFORM.GRID1.COLUMN12.CONTROLSOURCE="ICASE(D07.F14 = '1','提前中 / ',D07.F14 = '2','延後中 / ',D07.F14 = '3','取消中 / ','') + IIF(EMPTY(D07.F15),'',DTCX(D07.F15))"
       THISFORM.GRID1.COLUMN13.CONTROLSOURCE="IIF(SEEK(D07.F01+D07.F02,'P04'),P04.F04,IIF(SEEK(D07.F01+D07.F02,'D04'),D04.F04,''))"
       THISFORM.GRID1.COLUMN14.CONTROLSOURCE="IIF(SEEK(D07.F01+D07.F02,'P04'),P04.F05,IIF(SEEK(D07.F01+D07.F02,'D04'),D04.F05,''))"  
       THISFORM.GRID1.COLUMN13.VISIBLE=IIF(A02.F10='*',.T.,.F.)  
       THISFORM.GRID1.COLUMN14.VISIBLE=IIF(A02.F10='*',.T.,.F.)  
       THISFORM.GRID1.READONLY=.T.       
       THISFORM.GRID1.SETFOCUS    
       IF  THISFORM.GRID1.ACTIVEROW=0 
              THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
	      THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
	      THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
	      THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.    
	      THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.	        
	      THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.   
	      THISFORM.OUMNY.ENABLED=.F.

	      THISFORM.REC_COUNT.CAPTION=''
	      THISFORM.CHANGE_BOT.ENABLED=.F.
        ELSE
          THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
	      THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
	      THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
	      THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.    
	      THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.	        
	      THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限   
	      THISFORM.OUMNY.ENABLED=IIF(A02.F10='*',.T.,.F.) 

	      THISFORM.CHANGE_BOT.ENABLED=CHA
        ENDIF  
       JK='採購單號'
  ENDPROC    
  PROC KEY_LIST.INIT 
       WITH THIS 
           .ADDITEM('依採購單號+日期排列')
           .ADDITEM('依日期+採購單號排列')
           .ADDITEM('依廠商編號+日期排列')           
           .ADDITEM('依採購單號+料號排列')           
           .ADDITEM('依料      號  +日期排列')           
           .ADDITEM('依採購用途          排列')  
           .ADDITEM('依運貨方式+日期排列')   
           .VALUE=1      
       ENDWITH      
  ENDPROC 
  PROC KEY_LIST.INTERACTIVECHANGE                 
       SELECT  D07
       DO CASE
             CASE THIS.DISPLAYVALUE='依採購單號+日期排列'       
                        SET ORDER TO D071     
               		THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='採購單號'
              		THISFORM.GRID1.COLUMN1.CONTROLSOURCE='D07.F01'
	                THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='預進貨日'
	                THISFORM.GRID1.COLUMN2.CONTROLSOURCE='D07.F03'      
	                THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='料        號'	                   
	                THISFORM.GRID1.COLUMN3.CONTROLSOURCE='D07.F02'
	        	THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='品名規格'	                  
	        	THISFORM.GRID1.COLUMN4.CONTROLSOURCE='B01.F02'               
	        	THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='進貨數量'        	   
	        	THISFORM.GRID1.COLUMN5.CONTROLSOURCE='D07.F04' 
	        	THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='運貨方式'
	                THISFORM.GRID1.COLUMN6.CONTROLSOURCE="D07.F13 + IIF(EMPTY(D07.F17),'','(' + ALLTRIM(D07.F17) + ')')"
	  	        THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='採購用途'        	   	           
	        	THISFORM.GRID1.COLUMN7.CONTROLSOURCE='D07.F07'
	  	        THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='預期結餘'        	   	           
	        	THISFORM.GRID1.COLUMN8.CONTROLSOURCE="TRANSFORM(ALTT(D07.F02,'1')+MRP_QTY(D07.F02,D07.F03,D07.F01),'@R 9999999999.99')"
	        	THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='客戶PO/NO' 
	        	THISFORM.GRID1.COLUMN9.CONTROLSOURCE="IIF(SEEK(LEFT(ALLTRIM(D07.F07),10),'P05'),IIF(SEEK(P05.F06,'C03'),C03.F14,''),'')"
	        	THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='廠商編號'  	           	   
	        	THISFORM.GRID1.COLUMN10.CONTROLSOURCE='D07.F05'
	        	THISFORM.GRID1.COLUMN11.HEADER1.CAPTION='廠商簡稱'
		        THISFORM.GRID1.COLUMN11.CONTROLSOURCE='D07_1.EXP_2'   
		        THISFORM.GRID1.COLUMN12.HEADER1.CAPTION='異動狀態與日期'  
			    THISFORM.GRID1.COLUMN12.CONTROLSOURCE="ICASE(D07.F14 = '1','提前中 / ',D07.F14 = '2','延後中 / ',D07.F14 = '3','取消中 / ','') + IIF(EMPTY(D07.F15),'',DTCX(D07.F15))"   
	                THISFORM.GRID1.COLUMN1.WIDTH=INT_015*80
	                THISFORM.GRID1.COLUMN2.WIDTH=INT_015*65
	                THISFORM.GRID1.COLUMN3.WIDTH=INT_015*149
	                THISFORM.GRID1.COLUMN4.WIDTH=INT_015*110
	                THISFORM.GRID1.COLUMN5.WIDTH=INT_015*80
	                THISFORM.GRID1.COLUMN6.WIDTH=INT_015*150
	                THISFORM.GRID1.COLUMN7.WIDTH=INT_015*140
	                THISFORM.GRID1.COLUMN8.WIDTH=INT_015*90	                
	                THISFORM.GRID1.COLUMN9.WIDTH=INT_015*120
	                THISFORM.GRID1.COLUMN10.WIDTH=INT_015*50
	                THISFORM.GRID1.COLUMN11.WIDTH=INT_015*60      
	                THISFORM.GRID1.COLUMN12.WIDTH=INT_015*105      	   
             CASE THIS.DISPLAYVALUE='依日期+採購單號排列'          
	                SET ORDER TO D072
	                THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='預進貨日'
	                THISFORM.GRID1.COLUMN1.CONTROLSOURCE='D07.F03'
	                THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='採購單號'
	                THISFORM.GRID1.COLUMN2.CONTROLSOURCE='D07.F01'                  
	                THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='料        號'	                   
	                THISFORM.GRID1.COLUMN3.CONTROLSOURCE='D07.F02'
	                THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='品名規格'	                  
	                THISFORM.GRID1.COLUMN4.CONTROLSOURCE='B01.F02'               
	                THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='進貨數量'        	   
	                THISFORM.GRID1.COLUMN5.CONTROLSOURCE='D07.F04'      
	                THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='運貨方式'
	                THISFORM.GRID1.COLUMN6.CONTROLSOURCE="D07.F13 + IIF(EMPTY(D07.F17),'','(' + ALLTRIM(D07.F17) + ')')"
	  	        THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='採購用途'        	   	           
	                THISFORM.GRID1.COLUMN7.CONTROLSOURCE='D07.F07' 
	  	        THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='預期結餘'        	   	           
	        	THISFORM.GRID1.COLUMN8.CONTROLSOURCE="TRANSFORM(ALTT(D07.F02,'1')+MRP_QTY(D07.F02,D07.F03,D07.F01),'@R 9999999999.99')"	                
	                THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='客戶PO/NO' 
	                THISFORM.GRID1.COLUMN9.CONTROLSOURCE="IIF(SEEK(LEFT(ALLTRIM(D07.F07),10),'P05'),IIF(SEEK(P05.F06,'C03'),C03.F14,''),'')"
	                THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='廠商編號'  	           	   
	                THISFORM.GRID1.COLUMN10.CONTROLSOURCE='D07.F05'
	                THISFORM.GRID1.COLUMN11.HEADER1.CAPTION='廠商簡稱'
		        THISFORM.GRID1.COLUMN11.CONTROLSOURCE='D07_1.EXP_2'  
		        THISFORM.GRID1.COLUMN12.HEADER1.CAPTION='異動狀態與日期'  
			    THISFORM.GRID1.COLUMN12.CONTROLSOURCE="ICASE(D07.F14 = '1','提前中 / ',D07.F14 = '2','延後中 / ',D07.F14 = '3','取消中 / ','') + IIF(EMPTY(D07.F15),'',DTCX(D07.F15))"	    	                  
	                THISFORM.GRID1.COLUMN1.WIDTH=INT_015*65
	                THISFORM.GRID1.COLUMN2.WIDTH=INT_015*80 
	                THISFORM.GRID1.COLUMN3.WIDTH=INT_015*149
	                THISFORM.GRID1.COLUMN4.WIDTH=INT_015*110
	                THISFORM.GRID1.COLUMN5.WIDTH=INT_015*80 
	                THISFORM.GRID1.COLUMN6.WIDTH=INT_015*150            
	                THISFORM.GRID1.COLUMN7.WIDTH=INT_015*140 
	                THISFORM.GRID1.COLUMN8.WIDTH=INT_015*90
	                THISFORM.GRID1.COLUMN9.WIDTH=INT_015*120
	                THISFORM.GRID1.COLUMN10.WIDTH=INT_015*50
	                THISFORM.GRID1.COLUMN11.WIDTH=INT_015*60    
	                THISFORM.GRID1.COLUMN12.WIDTH=INT_015*105                         
             CASE THIS.DISPLAYVALUE='依廠商編號+日期排列'
                        SET ORDER TO D073 
	                THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='廠商編號'
	                THISFORM.GRID1.COLUMN1.CONTROLSOURCE='D07.F05'
	                THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='廠商簡稱'
	                THISFORM.GRID1.COLUMN2.CONTROLSOURCE='D07_1.EXP_2'             
	                THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='預進貨日'
	                THISFORM.GRID1.COLUMN3.CONTROLSOURCE='D07.F03'         
	                THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='採購單號'
	                THISFORM.GRID1.COLUMN4.CONTROLSOURCE='D07.F01'	   
	        	THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='品        號'	                  
	        	THISFORM.GRID1.COLUMN5.CONTROLSOURCE='D07.F02'                                                                
	        	THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='品名規格'	                  
	        	THISFORM.GRID1.COLUMN6.CONTROLSOURCE='B01.F02'               
	        	THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='進貨數量'        	   
	        	THISFORM.GRID1.COLUMN7.CONTROLSOURCE='D07.F04'     
	  	        THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='預期結餘'        	   	           
	        	THISFORM.GRID1.COLUMN8.CONTROLSOURCE="TRANSFORM(ALTT(D07.F02,'1')+MRP_QTY(D07.F02,D07.F03,D07.F01),'@R 9999999999.99')"	                	        		        	
	        	THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='運貨方式'
	                THISFORM.GRID1.COLUMN9.CONTROLSOURCE="D07.F13 + IIF(EMPTY(D07.F17),'','(' + ALLTRIM(D07.F17) + ')')"
	   	        THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='採購用途'        	   	           
	        	THISFORM.GRID1.COLUMN10.CONTROLSOURCE='D07.F07'
	        	THISFORM.GRID1.COLUMN11.HEADER1.CAPTION='客戶PO/NO' 
	        	THISFORM.GRID1.COLUMN11.CONTROLSOURCE="IIF(SEEK(LEFT(ALLTRIM(D07.F07),10),'P05'),IIF(SEEK(P05.F06,'C03'),C03.F14,''),'')"	
		        THISFORM.GRID1.COLUMN12.HEADER1.CAPTION='異動狀態與日期'  
			    THISFORM.GRID1.COLUMN12.CONTROLSOURCE="ICASE(D07.F14 = '1','提前中 / ',D07.F14 = '2','延後中 / ',D07.F14 = '3','取消中 / ','') + IIF(EMPTY(D07.F15),'',DTCX(D07.F15))"	    
	                THISFORM.GRID1.COLUMN1.WIDTH=INT_015*50
	                THISFORM.GRID1.COLUMN2.WIDTH=INT_015*60 
	                THISFORM.GRID1.COLUMN3.WIDTH=INT_015*65
	                THISFORM.GRID1.COLUMN4.WIDTH=INT_015*80
	                THISFORM.GRID1.COLUMN5.WIDTH=INT_015*149
	                THISFORM.GRID1.COLUMN6.WIDTH=INT_015*110
	                THISFORM.GRID1.COLUMN7.WIDTH=INT_015*80
	                THISFORM.GRID1.COLUMN8.WIDTH=INT_015*90	                
	                THISFORM.GRID1.COLUMN9.WIDTH=INT_015*150
	                THISFORM.GRID1.COLUMN10.WIDTH=INT_015*140
	                THISFORM.GRID1.COLUMN11.WIDTH=INT_015*120   
	                THISFORM.GRID1.COLUMN12.WIDTH=INT_015*105                                	                             
             CASE THIS.DISPLAYVALUE='依採購單號+料號排列'
                        SET ORDER TO D074
	                THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='採購單號'
	                THISFORM.GRID1.COLUMN1.CONTROLSOURCE='D07.F01'          
	                THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='料        號'
	                THISFORM.GRID1.COLUMN2.CONTROLSOURCE='D07.F02'             
	                THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='品名規格'
	                THISFORM.GRID1.COLUMN3.CONTROLSOURCE='B01.F02'
	                THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='進貨數量'        	   
	                THISFORM.GRID1.COLUMN4.CONTROLSOURCE='D07.F04'    
	                THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='運貨方式'
	                THISFORM.GRID1.COLUMN5.CONTROLSOURCE="D07.F13 + IIF(EMPTY(D07.F17),'','(' + ALLTRIM(D07.F17) + ')')"
	                THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='預進貨日'
	                THISFORM.GRID1.COLUMN6.CONTROLSOURCE='D07.F03'            
	   	        THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='採購用途'        	   	           
	                THISFORM.GRID1.COLUMN7.CONTROLSOURCE='D07.F07'
	  	        THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='預期結餘'        	   	           
	        	THISFORM.GRID1.COLUMN8.CONTROLSOURCE="TRANSFORM(ALTT(D07.F02,'1')+MRP_QTY(D07.F02,D07.F03,D07.F01),'@R 9999999999.99')"	                	        		                
	                THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='客戶PO/NO' 
	                THISFORM.GRID1.COLUMN9.CONTROLSOURCE="IIF(SEEK(LEFT(ALLTRIM(D07.F07),10),'P05'),IIF(SEEK(P05.F06,'C03'),C03.F14,''),'')"
	                THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='廠商編號'
	                THISFORM.GRID1.COLUMN10.CONTROLSOURCE='D07.F05'	        	   	                  
	                THISFORM.GRID1.COLUMN11.HEADER1.CAPTION='廠商簡稱'
	                THISFORM.GRID1.COLUMN11.CONTROLSOURCE='D07_1.EXP_2'    
		        THISFORM.GRID1.COLUMN12.HEADER1.CAPTION='異動狀態與日期'  
			    THISFORM.GRID1.COLUMN12.CONTROLSOURCE="ICASE(D07.F14 = '1','提前中 / ',D07.F14 = '2','延後中 / ',D07.F14 = '3','取消中 / ','') + IIF(EMPTY(D07.F15),'',DTCX(D07.F15))"                  
	                THISFORM.GRID1.COLUMN1.WIDTH=INT_015*80
	                THISFORM.GRID1.COLUMN2.WIDTH=INT_015*149 
	                THISFORM.GRID1.COLUMN3.WIDTH=INT_015*110
	                THISFORM.GRID1.COLUMN4.WIDTH=INT_015*80
	                THISFORM.GRID1.COLUMN5.WIDTH=INT_015*150
	                THISFORM.GRID1.COLUMN6.WIDTH=INT_015*65
	                THISFORM.GRID1.COLUMN7.WIDTH=INT_015*140
	                THISFORM.GRID1.COLUMN8.WIDTH=INT_015*90	                	                
	                THISFORM.GRID1.COLUMN9.WIDTH=INT_015*120
	                THISFORM.GRID1.COLUMN10.WIDTH=INT_015*50
	                THISFORM.GRID1.COLUMN11.WIDTH=INT_015*60  
	                THISFORM.GRID1.COLUMN12.WIDTH=INT_015*105       	   
             CASE THIS.DISPLAYVALUE='依料      號  +日期排列'
	                SET ORDER TO D075    
	                THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='料        號'
	                THISFORM.GRID1.COLUMN1.CONTROLSOURCE='D07.F02' 
	                THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='品名規格'
	                THISFORM.GRID1.COLUMN2.CONTROLSOURCE='B01.F02'                           
	                THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='預進貨日'
	                THISFORM.GRID1.COLUMN3.CONTROLSOURCE='D07.F03'             
	                THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='採購單號'
	                THISFORM.GRID1.COLUMN4.CONTROLSOURCE='D07.F01'          
	        	THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='進貨數量'        	   
	        	THISFORM.GRID1.COLUMN5.CONTROLSOURCE='D07.F04'    
	        	THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='運貨方式'
	                THISFORM.GRID1.COLUMN6.CONTROLSOURCE="D07.F13 + IIF(EMPTY(D07.F17),'','(' + ALLTRIM(D07.F17) + ')')"
	   	        THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='採購用途'        	   	           
	        	THISFORM.GRID1.COLUMN7.CONTROLSOURCE='D07.F07'
	  	        THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='預期結餘'        	   	           
	        	THISFORM.GRID1.COLUMN8.CONTROLSOURCE="TRANSFORM(ALTT(D07.F02,'1')+MRP_QTY(D07.F02,D07.F03,D07.F01),'@R 9999999999.99')"	                	        		                	        	
	        	THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='客戶PO/NO' 
	        	THISFORM.GRID1.COLUMN9.CONTROLSOURCE="IIF(SEEK(LEFT(ALLTRIM(D07.F07),10),'P05'),IIF(SEEK(P05.F06,'C03'),C03.F14,''),'')"
	        	THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='廠商編號'
	                THISFORM.GRID1.COLUMN10.CONTROLSOURCE='D07.F05'	        	   	                  
	                THISFORM.GRID1.COLUMN11.HEADER1.CAPTION='廠商簡稱'
	                THISFORM.GRID1.COLUMN11.CONTROLSOURCE='D07_1.EXP_2'     
		        THISFORM.GRID1.COLUMN12.HEADER1.CAPTION='異動狀態與日期'  
			    THISFORM.GRID1.COLUMN12.CONTROLSOURCE="ICASE(D07.F14 = '1','提前中 / ',D07.F14 = '2','延後中 / ',D07.F14 = '3','取消中 / ','') + IIF(EMPTY(D07.F15),'',DTCX(D07.F15))"	              
	                THISFORM.GRID1.COLUMN1.WIDTH=INT_015*149
	                THISFORM.GRID1.COLUMN2.WIDTH=INT_015*110
	                THISFORM.GRID1.COLUMN3.WIDTH=INT_015*65
	                THISFORM.GRID1.COLUMN4.WIDTH=INT_015*80
	                THISFORM.GRID1.COLUMN5.WIDTH=INT_015*80
	                THISFORM.GRID1.COLUMN6.WIDTH=INT_015*150
	                THISFORM.GRID1.COLUMN7.WIDTH=INT_015*140
	                THISFORM.GRID1.COLUMN8.WIDTH=INT_015*90
	                THISFORM.GRID1.COLUMN9.WIDTH=INT_015*120
	                THISFORM.GRID1.COLUMN10.WIDTH=INT_015*50
	                THISFORM.GRID1.COLUMN11.WIDTH=INT_015*60
	                THISFORM.GRID1.COLUMN12.WIDTH=INT_015*105        	           
             CASE THIS.DISPLAYVALUE='依採購用途          排列'  
	   	        SET ORDER TO D076 
	   	        THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='採購用途'
	        	THISFORM.GRID1.COLUMN1.CONTROLSOURCE='D07.F07'             
	                THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='採購單號'
	                THISFORM.GRID1.COLUMN2.CONTROLSOURCE='D07.F01'          
	                THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='料        號'
	                THISFORM.GRID1.COLUMN3.CONTROLSOURCE='D07.F02'             
	                THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='品名規格'
	                THISFORM.GRID1.COLUMN4.CONTROLSOURCE='B01.F02'
	                THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='進貨數量'        	   
	                THISFORM.GRID1.COLUMN5.CONTROLSOURCE='D07.F04'    
	                THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='運貨方式'
	                THISFORM.GRID1.COLUMN6.CONTROLSOURCE="D07.F13 + IIF(EMPTY(D07.F17),'','(' + ALLTRIM(D07.F17) + ')')"
	                THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='預進貨日'
	                THISFORM.GRID1.COLUMN7.CONTROLSOURCE='D07.F03'
	  	        THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='預期結餘'        	   	           
	        	THISFORM.GRID1.COLUMN8.CONTROLSOURCE="TRANSFORM(ALTT(D07.F02,'1')+MRP_QTY(D07.F02,D07.F03,D07.F01),'@R 9999999999.99')"	                	        		                	        		                
	                THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='客戶PO/NO' 
	                THISFORM.GRID1.COLUMN9.CONTROLSOURCE="IIF(SEEK(LEFT(ALLTRIM(D07.F07),10),'P05'),IIF(SEEK(P05.F06,'C03'),C03.F14,''),'')"
	                THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='廠商編號'
	                THISFORM.GRID1.COLUMN10.CONTROLSOURCE='D07.F05'	        	   	                  
	                THISFORM.GRID1.COLUMN11.HEADER1.CAPTION='廠商簡稱'
	                THISFORM.GRID1.COLUMN11.CONTROLSOURCE='D07_1.EXP_2'       
		        THISFORM.GRID1.COLUMN12.HEADER1.CAPTION='異動狀態與日期'  
			    THISFORM.GRID1.COLUMN12.CONTROLSOURCE="ICASE(D07.F14 = '1','提前中 / ',D07.F14 = '2','延後中 / ',D07.F14 = '3','取消中 / ','') + IIF(EMPTY(D07.F15),'',DTCX(D07.F15))"                      
	                THISFORM.GRID1.COLUMN1.WIDTH=INT_015*140        	           	   
	                THISFORM.GRID1.COLUMN2.WIDTH=INT_015*80
	                THISFORM.GRID1.COLUMN3.WIDTH=INT_015*149 
	                THISFORM.GRID1.COLUMN4.WIDTH=INT_015*110
	                THISFORM.GRID1.COLUMN5.WIDTH=INT_015*80
	                THISFORM.GRID1.COLUMN6.WIDTH=INT_015*150
	                THISFORM.GRID1.COLUMN7.WIDTH=INT_015*65
	                THISFORM.GRID1.COLUMN8.WIDTH=INT_015*90
	                THISFORM.GRID1.COLUMN9.WIDTH=INT_015*120
	                THISFORM.GRID1.COLUMN10.WIDTH=INT_015*50
	                THISFORM.GRID1.COLUMN11.WIDTH=INT_015*60  
	                THISFORM.GRID1.COLUMN12.WIDTH=INT_015*105                                 
             CASE THIS.DISPLAYVALUE='依運貨方式+日期排列'  
	                SET ORDER TO D078
	                THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='運貨方式'
	                THISFORM.GRID1.COLUMN1.CONTROLSOURCE="D07.F13 + IIF(EMPTY(D07.F17),'','(' + ALLTRIM(D07.F17) + ')')"
	                THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='預進貨日'
	                THISFORM.GRID1.COLUMN2.CONTROLSOURCE='D07.F03'          
	   	        THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='採購用途'
	        	THISFORM.GRID1.COLUMN3.CONTROLSOURCE='D07.F07'             
	                THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='採購單號'
	                THISFORM.GRID1.COLUMN4.CONTROLSOURCE='D07.F01'          
	                THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='料        號'
	                THISFORM.GRID1.COLUMN5.CONTROLSOURCE='D07.F02'             
	                THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='品名規格'
	                THISFORM.GRID1.COLUMN6.CONTROLSOURCE='B01.F02'
	                THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='進貨數量'        	   
	                THISFORM.GRID1.COLUMN7.CONTROLSOURCE='D07.F04'    
	  	        THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='預期結餘'        	   	           
	        	THISFORM.GRID1.COLUMN8.CONTROLSOURCE="TRANSFORM(ALTT(D07.F02,'1')+MRP_QTY(D07.F02,D07.F03,D07.F01),'@R 9999999999.99')"	                	        		                	        		                	                
	                THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='客戶PO/NO' 
	                THISFORM.GRID1.COLUMN9.CONTROLSOURCE="IIF(SEEK(LEFT(ALLTRIM(D07.F07),10),'P05'),IIF(SEEK(P05.F06,'C03'),C03.F14,''),'')"
	                THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='廠商編號'
	                THISFORM.GRID1.COLUMN10.CONTROLSOURCE='D07.F05'	        	   	                  
	                THISFORM.GRID1.COLUMN11.HEADER1.CAPTION='廠商簡稱'
	                THISFORM.GRID1.COLUMN11.CONTROLSOURCE='D07_1.EXP_2'   
		        THISFORM.GRID1.COLUMN12.HEADER1.CAPTION='異動狀態與日期'  
			    THISFORM.GRID1.COLUMN12.CONTROLSOURCE="ICASE(D07.F14 = '1','提前中 / ',D07.F14 = '2','延後中 / ',D07.F14 = '3','取消中 / ','') + IIF(EMPTY(D07.F15),'',DTCX(D07.F15))"    
	                THISFORM.GRID1.COLUMN1.WIDTH=INT_015*150
	                THISFORM.GRID1.COLUMN2.WIDTH=INT_015*65                                        
	                THISFORM.GRID1.COLUMN3.WIDTH=INT_015*140        	           	   
	                THISFORM.GRID1.COLUMN4.WIDTH=INT_015*80
	                THISFORM.GRID1.COLUMN5.WIDTH=INT_015*149 
	                THISFORM.GRID1.COLUMN6.WIDTH=INT_015*110
	                THISFORM.GRID1.COLUMN7.WIDTH=INT_015*80
	                THISFORM.GRID1.COLUMN8.WIDTH=INT_015*90
	                THISFORM.GRID1.COLUMN9.WIDTH=INT_015*120
	                THISFORM.GRID1.COLUMN10.WIDTH=INT_015*50
	                THISFORM.GRID1.COLUMN11.WIDTH=INT_015*60  
	                THISFORM.GRID1.COLUMN12.WIDTH=INT_015*105        
       ENDCASE 
       COD = SYS(21)
       JK=THISFORM.GRID1.COLUMN1.HEADER1.CAPTION
       THISFORM.GRID1.REFRESH
       THISFORM.GRID1.SETFOCUS
  ENDPROC                
  PROC GRID1.AFTERROWCOLCHANGE
       LPARAMETERS NCOLINDEX
       THISFORM.TXTF03.VALUE=D07.F03
       THISFORM.TXTF13.VALUE=D07.F13
       THISFORM.TXTF17.VALUE=D07.F17
       THISFORM.REPLY_REMARK.ENABLED=(D07.F09='1') AND (A02.F05='*')
       THISFORM.GRID1.TOOLTIPTEXT=IIF(DATE()-CTOD(LEFT(D07.F08,9))<=VAL(INT_208) AND D07.F09='1','剛回覆交期',IIF(D07.F09<>'1','未回覆交期',IIF(D07.F03<DATE() AND D07.F09='1','應到貨而未到貨','')))
       THISFORM.REC_COUNT.CAPTION=D07.F08
       FCH=THISFORM.ACTIVECONTROL.NAME
       CHK=''
       THISFORM.REFRESH
  ENDPROC   
  PROCEDURE REPLY_REMARK.CLICK
    THISFORM.CMDGROUP.ENABLED=.F.
    THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.  
    THISFORM.ORPGROUP.ESC_BOTT.ENABLED=.F.  
    THISFORM.KEY_LIST.ENABLED=.F.
    THISFORM.GRID1.ENABLED=.F.
    THISFORM.CHANGE_BOT.ENABLED=.F.
    THISFORM.IODT_BOTT.ENABLED=.F.
    THISFORM.OUMNY.ENABLED=.F.
    THISFORM.SetAll('READONLY',.F.,'TEXTBOX')
    THISFORM.YES.VISIBLE=.T.
    THISFORM.YES.ENABLED=.T.
    THISFORM.PUTOFF.VISIBLE=.T.
    THISFORM.PUTOFF.ENABLED=.T.
    THISFORM.TRANS_STYLE.VISIBLE=.T.
    THISFORM.TRANS_STYLE.DISPLAYVALUE=D07.F13
    THISFORM.TXTF03.SETFOCUS
     RLOCK()
     IF !RLOCK()
        DO FILE_IMPACT
        THISFORM.PUTOFF.CLICK            
    
     ENDIF
  ENDPROC
  PROCEDURE YES.CLICK
     IF EMPTY(THISFORM.TXTF03.VALUE)
        =MESSAGEBOX('進貨日期錯誤!',0+48,'提示訊息視窗')
        THISFORM.TXTF03.SETFOCUS
        RETURN
     ENDIF
     D07F03=D07.F03
     D07F13=D07.F13
     SELECT D07
     REPLACE F03 WITH THISFORM.TXTF03.VALUE
     REPLACE F13 WITH THISFORM.TXTF13.VALUE
     REPLACE F17 WITH THISFORM.TXTF17.VALUE
     REPLACE F08 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
     MAIL_TEXT=''
     TMPCHR=IIF(OS()="Windows 5.01",CHR(13) + CHR(10),'<br/>')
     FNTCHG1=IIF(OS()="Windows 5.01","","<font color='blue'>")
     FNTCHG2=IIF(OS()="Windows 5.01","","</font>")
     
     MAIL_TEXT = '採購單號：' + D07.F01 + TMPCHR + ;
     	         		  '料品編號：' + D07.F02 + TMPCHR + ;
     	         		  '進貨日期：' + IIF(D07F03<>D07.F03,FNTCHG1,'')+DTCX(D07F03) + '  ＞＞  ' + DTCX(D07.F03) +IIF(D07F03<>D07.F03,FNTCHG2,'')+ TMPCHR + ;
     	        		  '進貨數量：' + ALLTRIM(TRANSFORM(D07.F04,'@R 999,999,999,999')) + TMPCHR + ;
     	         		  '運貨方式：' + IIF(D07F13<>D07.F13,FNTCHG1,'')+D07F13 + '  ＞＞  ' + D07.F13 +IIF(D07F13<>D07.F13,FNTCHG2,'')+ TMPCHR + ;
     	         		  '備註說明：' + ALLTRIM(D07.F17) + TMPCHR + ;
     	         		  '需求單號：' + IIF(SEEK(LEFT(D07.F07,10),'P05'),P05.F06,'') + TMPCHR + ;
     	         		  '採購用途：' + ALLTRIM(D07.F07) + SPACE(2) + D07.F16 + CHR(13) + CHR(10)
     	            ASSIS_NO=IIF(SEEK(D07.F16,'C01'),C01.F23,'')
     	            SALES_B_NO=IIF(SEEK(D07.F16,'C01'),C01.F33,'')
                    IF !EMPTY(ALLTRIM(ASSIS_NO))
                       FILE_NAME=ALLTRIM(INT_DAT)+ALLTRIM(ASSIS_NO)+'.TXT'                  
                       **STRTOFILE('<TR><TD>'+MAIL_TEXT+'<TD>已更新計劃<TD>'+TTOC(DATETIME())+ CHR(13) + CHR(10),FILE_NAME,1) 
                       STRTOFILE('<TR><TD>'+MAIL_TEXT+'<TD'+IIF(D07F03<D07.F03,' bgcolor="#FF0000"','')+'>已更新計劃<TD>'+TTOC(DATETIME())+ CHR(13) + CHR(10),FILE_NAME,1) 
                    ENDIF    	         		  
                    IF !EMPTY(ALLTRIM(SALES_B_NO))
                       FILE_NAME=ALLTRIM(INT_DAT)+ALLTRIM(SALES_B_NO)+'.TXT'                  
                       **STRTOFILE('<TR><TD>'+MAIL_TEXT+'<TD>已更新計劃<TD>'+TTOC(DATETIME())+ CHR(13) + CHR(10),FILE_NAME,1) 
                       STRTOFILE('<TR><TD>'+MAIL_TEXT+'<TD'+IIF(D07F03<D07.F03,' bgcolor="#FF0000"','')+'>已更新計劃<TD>'+TTOC(DATETIME())+ CHR(13) + CHR(10),FILE_NAME,1) 
                    ENDIF    	         		  
     THISFORM.PUTOFF.CLICK
  ENDPROC
  PROCEDURE PUTOFF.CLICK
      UNLOCK ALL
      THISFORM.KEY_LIST.ENABLED=.T.
      THISFORM.CMDGROUP.ENABLED=.T.
      THISFORM.ORPGROUP.ESC_BOTT.ENABLED=.T.  
      THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限   
      THISFORM.CHANGE_BOT.ENABLED=.T.
      THISFORM.IODT_BOTT.ENABLED=.T.
      THISFORM.OUMNY.ENABLED=.T.
      THISFORM.YES.ENABLED=.F.
      THISFORM.YES.VISIBLE=.F.
      THISFORM.SetAll('READONLY',.T.,'TEXTBOX')
      THIS.Enabled=.F.
      THIS.Visible=.F.
      THISFORM.TRANS_STYLE.VISIBLE=.F.
      THISFORM.GRID1.ENABLED=.T.
      THISFORM.GRID1.SETFOCUS
  ENDPROC
  PROCEDURE TRANS_STYLE.INTERACTIVECHANGE
       THISFORM.TXTF13.VALUE=THIS.DISPLAYVALUE
       THISFORM.TXTF13.REFRESH
  ENDPROC      
  PROC OUMNY.CLICK    &&預估進貨金額
       FLG='0'
       CHK_CNFM='1'
       SELE D07       
       OUM_RANGE=CREATEOBJECT("OUM_RANGE")  
       OUM_RANGE.SHOW    
       IF FLG<>'1'
          =MESSAGEBOX('無此範圍資料',0+48,'警示')
       ENDIF   
       FLG='0'     
       THISFORM.GRID1.SETFOCUS
  ENDPROC  
  **********
  PROC CHANGE_BOT.CLICK    &&異動
	   IF !USED('C66')
		  SELECT 0
		  USE C66
	   ELSE 
		  SELECT C66
	   ENDIF
	   SET ORDER TO C661     
 	  SELECT A02
 	  SEEK SYS_OPER+'C66'
      SELECT IIF(C66.F01 = 0,1,0) AS EXP_1,C66.*,ICASE(F08 = 'A','海運    ',F08 = 'B','海運提前',F08 = 'C','空運    ',F08 = 'D','空運提前',F08 = 'E','快遞    ',F08 = 'F','快遞提前',F08 = 'G','海運延後',F08 = 'H','空運延後',F08 = 'J','快遞延後',SPACE(8)) AS F088;
      FROM C66 WHERE C66.F04 = D07.F02 AND C66.F12 = D07.F01 AND C66.F11 = IIF(SEEK(LEFT(ALLTRIM(D07.F07),10),'P05'),P05.F04,C05.F06)  ORDER BY C66.F03 INTO CURSOR C66_TEMP READWRITE
      SELECT C66_TEMP
      GO TOP
      CH_SEEK=CREATEOBJECT("CH_SEEK")  
      CH_SEEK.SHOW    
      SELECT C66
      USE 
 	  SELECT A02
 	  SEEK SYS_OPER+'D08'
      SELECT D07 
      SET ORDER TO &COD       
       THISFORM.GRID1.SETFOCUS
  ENDPROC    
*********************************查看預期進出
  PROC IODT_BOTT.CLICK
            LK=D07.F02
            LV=D07.F03
            SELE C05.F01,C05.F03,C05.F04,C05.F06,C05.F09 FROM C05 WHERE C05.F02=LK  AND !EMPTY(C05.F15) INTO CURSOR IODT1 ORDER BY C05.F03 NOWAIT&&
            SELE E06.F01,E06.F03,E06.F04,E06.F05,E06.F07,E06.F09 FROM E06 WHERE E06.F02=LK   INTO CURSOR IODT3  ORDER BY E06.F03 NOWAIT&&            
            SELE D07.F01,D07.F03,D07.F04,D07.F05,D07.F07,D07.F09 FROM D07 WHERE D07.F02=LK  INTO CURSOR IODT2  ORDER BY D07.F03 NOWAIT&&
            SELE E16.F01,E16.F03,E16.F04,E16.F06,E16.F09 FROM E16 WHERE E16.F02=LK  INTO CURSOR IODT4 ORDER BY E16.F03 NOWAIT&&         
            CREATE CURSOR IODT(F01 C(12),F03 D(8),F04 N(13,3),F08 N(13,3),F05 C(50))
            INDE ON DTOS(F03)+F01 TAG IODT
            SET ORDER TO 1
            SELE IODT2
            GO TOP
            DO WHILE !EOF()
               SELE IODT
               APPEND BLANK
               REPL F01 WITH IODT2.F01
               REPL F03 WITH IODT2.F03
               REPL F04 WITH IODT2.F04
               REPL F05 WITH '採:'+IODT2.F05+PADL(IIF(SEEK(IODT2.F05,'D01'),D01.F04,''),8,' ')+IIF(IODT2.F09='1','  ','><')+IIF(!EMPTY(IODT2.F07),'請:','')+IODT2.F07
               SELE IODT2
               SKIP
            ENDDO   
            USE
            SELE IODT3
            GO TOP
            DO WHILE !EOF()
               SELE IODT
               APPEND BLANK
               REPL F01 WITH IODT3.F01
               REPL F03 WITH IODT3.F03
               REPL F04 WITH IODT3.F04
               REPL F05 WITH '產:'+IODT3.F05+PADL(IIF(SEEK(IODT3.F05,'A14'),A14.F02,''),8,' ')+IIF(IODT3.F09='1','  ','><')+'出:'+IODT3.F07+IIF(SEEK(IODT3.F07,'C01'),C01.F05,'')
               SELE IODT3
               SKIP
            ENDDO   
            USE
            SELE IODT1
            GO TOP
            DO WHILE !EOF()
               SELE IODT
               APPEND BLANK
               REPL F01 WITH IODT1.F01
               REPL F03 WITH IODT1.F03
               REPL F04 WITH IODT1.F04*(-1)
               REPL F05 WITH '出:'+IODT1.F06+IIF(SEEK(IODT1.F06,'C01'),C01.F05,'')+'  單:'+IODT1.F09
               SELE IODT1
               SKIP
            ENDDO   
            USE
            SELE IODT4
            GO TOP
            DO WHILE !EOF()
               SELE IODT
               APPEND BLANK
               REPL F01 WITH IODT4.F01
               REPL F03 WITH IODT4.F03
               REPL F04 WITH IODT4.F04*(-1)
               REPL F05 WITH '領:'+IODT4.F06+IIF(SEEK(IODT4.F06,'A14'),A14.F02,'')+'  成:'+IODT4.F09           
               SELE IODT4
               SKIP
            ENDDO       
            USE                               
                ORD_NO=D07.F01
                STD_NO=D07.F02
                DTE_NO=D07.F03
               IODT_SEEK=CREATEOBJECT("IODT_SEEK")  
               IODT_SEEK.SHOW           
             AREA1='D07' 
            SELE D07
           THISFORM.GRID1.SETFOCUS    
ENDDEFINE      
***********************************************預進貨金額列印範圍
DEFINE CLASS OUM_RANGE AS FORM
*!*	       AUTOCENTER=.T.
   CAPTION='請輸入進貨預估金額資料範圍'
   TOP=INT_015*180
   LEFT=INT_015*220          
   FONTSIZE=INT_015*9
   HEIGHT=INT_015*170
   WIDTH=INT_015*355
   FONTSIZE=INT_015*9
   MOVABLE=.F.
   MAXBUTTON=.F.
   MINBUTTON=.F.     
   CONTROLBOX=.F.
   BORDERSTYLE=2
   SHOWTIPS=.T.
   SHOWWINDOW=1
   WINDOWTYPE=1
   NAME='ANS_RANGE'        
   ADD OBJECT LABEL1 AS LABEL WITH;
       WIDTH=INT_015*50.,;
       HEIGHT=INT_015*25,;
       LEFT=INT_015*30,;
       TOP=INT_015*15,;
       CAPTION='起始日期',;
       NAME='LABEL1'
   ADD OBJECT TEXT1 AS TEXTBOX WITH;
       WIDTH=INT_015*75,;
       TOP=INT_015*10,;
       LEFT=INT_015*80,;
       HEIGHT=INT_015*25,; 
       NAME='TEXT1'           
   ADD OBJECT LABEL2 AS LABEL WITH;
       WIDTH=INT_015*50.,;
       HEIGHT=INT_015*25,;
       LEFT=INT_015*200,;
       TOP=INT_015*15,;
       CAPTION='截止日期',;
       NAME='LABEL2'
   ADD OBJECT TEXT2 AS TEXTBOX WITH;
       WIDTH=INT_015*75.,;
       TOP=INT_015*10,;
       LEFT=INT_015*250,;
       HEIGHT=INT_015*25,;         
       NAME='TEXT2'              
   ADD OBJECT LABEL3 AS LABEL WITH;
       WIDTH=INT_015*50.,;
       HEIGHT=INT_015*25,;    
       LEFT=INT_015*30,;
       TOP=INT_015*55,;
       CAPTION='起始廠商',;
       NAME='LABEL3'          
   ADD OBJECT TEXT3 AS TEXTBOX WITH;
       WIDTH=INT_015*75,;
       TOP=INT_015*50,;
       LEFT=INT_015*80,;
       HEIGHT=INT_015*25,; 
       MAXLENGTH=5,;
       NAME='TEXT3'            
   ADD OBJECT LABEL4 AS LABEL WITH;
      WIDTH=INT_015*50.,;
       HEIGHT=INT_015*25,;
       LEFT=INT_015*200,;
       TOP=INT_015*55,;
       CAPTION='截止廠商',;
       NAME='LABEL4'           
   ADD OBJECT TEXT4 AS TEXTBOX WITH;
       WIDTH=INT_015*75,;
       TOP=INT_015*50,;
       LEFT=INT_015*250,;
       HEIGHT=INT_015*25,;         
       MAXLENGTH=5,;           
       NAME='TEXT4'               
  ADD OBJECT INSK_OPTION AS OPTIONGROUP WITH;
      LEFT=INT_015*80,;
      TOP=INT_015*85,;
      HEIGHT=INT_015*50,;    
      WIDTH=INT_015*50,;      
      BUTTONCOUNT=2,;
      OPTION1.CAPTION='內購',;
      OPTION1.FONTSIZE=INT_015*9,;
      OPTION1.LEFT=INT_015*4,;
      OPTION1.TOP=INT_015*3,;
      OPTION1.AUTOSIZE=.T.,;
      OPTION2.CAPTION='外購',;
      OPTION2.FONTSIZE=INT_015*9,;
      OPTION2.LEFT=INT_015*4,;
      OPTION2.TOP=INT_015*25,;
      OPTION2.AUTOSIZE=.T.,;      
      NAME='INSK_OPTION'                          
  ADD OBJECT CNFM_OPTION AS OPTIONGROUP WITH;
      LEFT=INT_015*220,;
      TOP=INT_015*85,;
      HEIGHT=INT_015*50,;    
      WIDTH=INT_015*95,;      
      BUTTONCOUNT=2,;
      OPTION1.CAPTION='已確認交期',;
      OPTION1.FONTSIZE=INT_015*9,;
      OPTION1.LEFT=INT_015*4,;
      OPTION1.TOP=INT_015*3,;
      OPTION1.AUTOSIZE=.T.,;
      OPTION2.CAPTION='未確認交期',;
      OPTION2.FONTSIZE=INT_015*9,;
      OPTION2.LEFT=INT_015*4,;
      OPTION2.TOP=INT_015*25,;
      OPTION2.AUTOSIZE=.T.,;      
      NAME='CNFM_OPTION'                          
   ADD OBJECT CMND1 AS COMMANDBUTTON WITH;
       LEFT=INT_015*60,;    
       HEIGHT=INT_015*25,;   
       TOP=INT_015*140,;  
       WIDTH=INT_015*50,;
       CAPTION='\<Y.執 行',;
       TOOLTIPTEXT='確認所輸入的範圍鍵值!快速鍵->ALT+Y',;
       NAME='CMND1'
   ADD OBJECT CMND2 AS COMMANDBUTTON WITH;
       LEFT=INT_015*200,;
       TOP=INT_015*140,;
       HEIGHT=INT_015*25,;
       WIDTH=INT_015*50,;
       CAPTION='\<C.取 消',;
       TOOLTIPTEXT='取消作業!快速鍵->ALT+C',;
       NAME='CMND2'       
   PROCEDURE INIT 
       THISFORM.SETALL('FONTSIZE',INT_015*9,'TEXTBOX')
       THISFORM.SETALL('FONTSIZE',INT_015*9,'LABEL')      
       THISFORM.SETALL('FONTSIZE',INT_015*9,'COMMANDBUTTON')  
       THISFORM.SETALL('MOUSEPOINTER',99,'COMMANDBUTTON')
       THISFORM.SETALL('MOUSEICON','BMPS\harrow.CUR','COMMANDBUTTON')    
       THISFORM.INSK_OPTION.VALUE=1                   
       THISFORM.CNFM_OPTION.VALUE=1   
       THISFORM.TEXT1.VALUE=D07.F03
       THISFORM.TEXT2.VALUE=D07.F03
       THISFORM.TEXT3.VALUE=''
       THISFORM.TEXT4.VALUE=''      
       THISFORM.TEXT1.SETFOCUS                 
   ENDPROC             
   PROCEDURE CNFM_OPTION.INTERACTIVECHANGE
       IF THIS.VALUE=1
          CHK_CNFM='1'
       ELSE
          CHK_CNFM='0'
       ENDIF
   ENDPROC
   PROCEDURE CMND1.CLICK
        IF THISFORM.INSK_OPTION.VALUE=2
           SELECT  D07.F05,D07.F03,D07.F01,D07.F02,D07.F04,D01.F04,P04.F04,P04.F05,D00.F02;
           FROM D07,D01,P04,D00 WHERE D07.F09=CHK_CNFM AND D07.F03>=THISFORM.TEXT1.VALUE AND D07.F03<=THISFORM.TEXT2.VALUE; 
            AND D07.F05>=THISFORM.TEXT3.VALUE AND D07.F05<=THISFORM.TEXT4.VALUE AND LEFT(D07.F01,2)<>'BW' ;         
           AND D01.F01=D07.F05 AND P04.F01+P04.F02=D07.F01+D07.F02 AND D00.F01=P04.F04;      
           ORDER BY D07.F05,D07.F03 NOWAIT    
        ELSE
           SELECT  D07.F05,D07.F03,D07.F01,D07.F02,D07.F04,D01.F04,D04.F04,D04.F05,D00.F02;
           FROM D07,D01,D04,D00 WHERE D07.F09=CHK_CNFM AND D07.F03>=THISFORM.TEXT1.VALUE AND D07.F03<=THISFORM.TEXT2.VALUE;
           AND D07.F05>=THISFORM.TEXT3.VALUE AND D07.F05<=THISFORM.TEXT4.VALUE AND LEFT(D07.F01,2)<>'BW';
           AND D01.F01=D07.F05 AND D04.F01+D04.F02=D07.F01+D07.F02 AND D00.F01=D04.F04;      
           ORDER BY D07.F05,D07.F03 NOWAIT            
        ENDIF                                
        IF _TALLY>0
            GHK1=THISFORM.TEXT1.VALUE
            GHK2=THISFORM.TEXT2.VALUE
            REPORT FORM ALLTRIM(INT_116)+'D08J' TO PRINT PROMPT PREVIEW 
            FLG='1'                                    
         ENDIF
         THISFORM.RELEASE                   
   ENDPROC  
   PROCEDURE CMND2.CLICK
         FLG='1'   
         THISFORM.RELEASE                   
   ENDPROC 
  PROC CMND1.MOUSEENTER      
        LPARAMETERS nButton, nShift, nXCoord, nYCoord 
             THISFORM.CMND1.FORECOLOR=RGB(255,0,0)  
             THISFORM.CMND1.TOP=INT_015*141
             THISFORM.CMND1.LEFT=INT_015*61                  
  ENDPROC     
  PROC CMND1.MOUSELEAVE      
        LPARAMETERS nButton, nShift, nXCoord, nYCoord 
             THISFORM.CMND1.FORECOLOR=RGB(0,0,0)  
             THISFORM.CMND1.TOP=INT_015*140
             THISFORM.CMND1.LEFT=INT_015*60                  
  ENDPROC    
  PROC CMND2.MOUSEENTER      
       LPARAMETERS nButton, nShift, nXCoord, nYCoord 
             THISFORM.CMND2.FORECOLOR=RGB(255,0,0)
             THISFORM.CMND2.TOP=INT_015*141
             THISFORM.CMND2.LEFT=INT_015*201
  ENDPROC     
  PROC CMND2.MOUSELEAVE      
        LPARAMETERS nButton, nShift, nXCoord, nYCoord 
             THISFORM.CMND2.FORECOLOR=RGB(0,0,0)  
             THISFORM.CMND2.TOP=INT_015*140
             THISFORM.CMND2.LEFT=INT_015*200                  
  ENDPROC                                 
ENDDEFINE
***********************************************列印程序
PROCEDURE PNT_PRC  
   FLG='0'
   SELECT  D07
   ANS_RANGE=CREATEOBJECT("ANS_RANGE")  
   ANS_RANGE.SHOW    
   IF FLG<>'1'
       =MESSAGEBOX('無此範圍資料',0+48,'警示')
   ENDIF   
ENDPROC
***********************************************
DEFINE CLASS ANS_RANGE AS FORM
*!*	  AUTOCENTER=.T.
  CAPTION='請輸入資料範圍'
  TOP=INT_015*180
  LEFT=INT_015*220   
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*180
  WIDTH=INT_015*360
  FONTSIZE=INT_015*9
  MOVABLE=.F.
  MAXBUTTON=.F.
  MINBUTTON=.F.      
  CONTROLBOX=.F.
  BORDERSTYLE=2
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WINDOWTYPE=1
  NAME='ANS_RANGE'
  ADD OBJECT DATA_OPTION AS OPTIONGROUP WITH;
      LEFT=INT_015*17,;
      TOP=INT_015*10,;
      WIDTH=INT_015*330,;
      HEIGHT=INT_015*160,;
      ALIGNMENT=0,;
      FONTSIZE=INT_015*9,;
      BUTTONCOUNT=3,;
      OPTION1.CAPTION='未回覆交期',;
      OPTION1.FONTSIZE=INT_015*9,;
      OPTION1.TOP=INT_015*10,;
      OPTION1.LEFT=INT_015*5,;
      OPTION1.AUTOSIZE=.T.,;
      OPTION2.CAPTION='應進貨未入貨',;
      OPTION2.FONTSIZE=INT_015*9,;
      OPTION2.TOP=INT_015*40,;
      OPTION2.LEFT=INT_015*5,;
      OPTION2.AUTOSIZE=.T.,;
      OPTION3.CAPTION='資料明細',;
      OPTION3.FONTSIZE=INT_015*9,;
      OPTION3.TOP=INT_015*70,;
      OPTION3.LEFT=INT_015*5,;
      OPTION3.AUTOSIZE=.T.,;      
      NAME='DATA_OPTION'        
  ADD OBJECT LABEL1 AS LABEL WITH;
      AUTOSIZE=.T.,;
      HEIGHT=INT_015*25,;
      LEFT=INT_015*38,;
      TOP=INT_015*110,;
      NAME='LABEL1'
  ADD OBJECT TEXT1 AS TEXTBOX WITH;
      AUTOSIZE=.T.,;
      TOP=INT_015*104,;
      LEFT=INT_015*90,;
      HEIGHT=INT_015*25,; 
      NAME='TEXT1'      
  ADD OBJECT LABEL2 AS LABEL WITH;
      AUTOSIZE=.T.,;
      HEIGHT=INT_015*25,;
      LEFT=INT_015*38,;
      TOP=INT_015*141,;
      NAME='LABEL2'
  ADD OBJECT TEXT2 AS TEXTBOX WITH;
      AUTOSIZE=.T.,;
      TOP=INT_015*135,;
      LEFT=INT_015*90,;
      HEIGHT=INT_015*25,;         
      NAME='TEXT2'    
  ADD OBJECT CMND1 AS COMMANDBUTTON WITH;
      LEFT=INT_015*260,;    
      TOP=INT_015*40,;  
      HEIGHT=INT_015*25,;   
      WIDTH=INT_015*70,;
      CAPTION='\<Y.列  印',;
      TOOLTIPTEXT='確認所輸入的範圍鍵值!快速鍵->ALT+Y',;
      NAME='CMND1'
  ADD OBJECT CMND2 AS COMMANDBUTTON WITH;
      LEFT=INT_015*260,;
      TOP=INT_015*80,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*70,;
      CAPTION='\<E.轉EXCEL',;
      TOOLTIPTEXT='轉成EXCEL格式!快速鍵->ALT+E',;
      NAME='CMND2'      
  ADD OBJECT CMND3 AS COMMANDBUTTON WITH;
      LEFT=INT_015*260,;
      TOP=INT_015*120,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*70,;
      CAPTION='\<C.取  消',;
      TOOLTIPTEXT='取消作業!快速鍵->ALT+C',;
      NAME='CMND3'
  PROCEDURE INIT 
      THISFORM.SETALL('VISIBLE',.F.,'TEXTBOX')
      THISFORM.SETALL('VISIBLE',.F.,'LABEL')
      THISFORM.SETALL('FONTSIZE',INT_015*9,'TEXTBOX')
      THISFORM.SETALL('FONTSIZE',INT_015*9,'LABEL')      
      THISFORM.SETALL('FONTSIZE',INT_015*9,'COMMANDBUTTON')   
      THISFORM.SETALL('MOUSEPOINTER',99,'COMMANDBUTTON')
      THISFORM.SETALL('MOUSEICON','BMPS\harrow.CUR','COMMANDBUTTON')                   
      DO CASE
	    CASE KEY()='F01+DTOS(F03)'    
	               THISFORM.LABEL1.CAPTION='起始單號'
		       THISFORM.LABEL2.CAPTION='截止單號'
		       THISFORM.TEXT1.WIDTH=INT_015*80
		       THISFORM.TEXT2.WIDTH=INT_015*80   
		       THISFORM.TEXT1.MAXLENGTH=10              
		       THISFORM.TEXT2.MAXLENGTH=10                                       
		       THISFORM.TEXT1.VALUE=D07.F01
		       THISFORM.TEXT2.VALUE=D07.F01              
	    CASE KEY()='DTOS(F03)+F01'
	               THISFORM.LABEL1.CAPTION='起始日期'
	               THISFORM.LABEL2.CAPTION='截止日期'
	               THISFORM.TEXT1.WIDTH=INT_015*70
	               THISFORM.TEXT2.WIDTH=INT_015*70              
	               THISFORM.TEXT1.VALUE=D07.F03
	               THISFORM.TEXT2.VALUE=D07.F03               
	    CASE KEY()='F05+DTOS(F03)'       
	               THISFORM.LABEL1.CAPTION='起始廠商'
	               THISFORM.LABEL2.CAPTION='截止廠商'
	               THISFORM.TEXT1.WIDTH=INT_015*60
	               THISFORM.TEXT2.WIDTH=INT_015*60   
	               THISFORM.TEXT1.MAXLENGTH=5              
	               THISFORM.TEXT2.MAXLENGTH=5                                       
	               THISFORM.TEXT1.VALUE=D07.F05
	               THISFORM.TEXT2.VALUE=D07.F05               
	    CASE KEY()='F01+F02+DTOS(F03)'   
	               THISFORM.LABEL1.CAPTION='起始單號'
	               THISFORM.LABEL2.CAPTION='截止單號'
	               THISFORM.TEXT1.WIDTH=INT_015*80
	               THISFORM.TEXT2.WIDTH=INT_015*80              
	               THISFORM.TEXT1.MAXLENGTH=10              
	               THISFORM.TEXT2.MAXLENGTH=10                            
	               THISFORM.TEXT1.VALUE=D07.F01
	               THISFORM.TEXT2.VALUE=D07.F01                        
	    CASE KEY()='F02+DTOS(F03)'             
	               THISFORM.LABEL1.CAPTION='起始料號'
	               THISFORM.LABEL2.CAPTION='截止料號'
	               THISFORM.TEXT1.WIDTH=INT_015*149
	               THISFORM.TEXT2.WIDTH=INT_015*149
	               THISFORM.TEXT1.MAXLENGTH=20              
	               THISFORM.TEXT2.MAXLENGTH=20                            
	               THISFORM.TEXT1.VALUE=D07.F02
	               THISFORM.TEXT2.VALUE=D07.F02   
	    CASE KEY()='F07+F02+DTOS(F03)'                                               
	               THISFORM.LABEL1.CAPTION='起始用途'
	               THISFORM.LABEL2.CAPTION='截止用途'
	               THISFORM.TEXT1.WIDTH=INT_015*149
	               THISFORM.TEXT2.WIDTH=INT_015*149
	               THISFORM.TEXT1.MAXLENGTH=20              
	               THISFORM.TEXT2.MAXLENGTH=20                            
	               THISFORM.TEXT1.VALUE=D07.F07
	               THISFORM.TEXT2.VALUE=D07.F07           
	    CASE KEY()='F13+DTOS(F03)+F02'                                               
	               THISFORM.LABEL1.CAPTION='起始運貨'
	               THISFORM.LABEL2.CAPTION='截止運貨'
	               THISFORM.TEXT1.WIDTH=INT_015*100
	               THISFORM.TEXT2.WIDTH=INT_015*100
	               THISFORM.TEXT1.MAXLENGTH=14              
	               THISFORM.TEXT2.MAXLENGTH=14                            
	               THISFORM.TEXT1.VALUE=D07.F13
	               THISFORM.TEXT2.VALUE=D07.F13    	                    
      ENDCASE 
  ENDPROC      
  PROCEDURE  DATA_OPTION.INTERACTIVECHANGE    
      IF THIS.VALUE=1 OR THIS.VALUE=2
          THISFORM.SETALL('VISIBLE',.F.,'TEXTBOX')
          THISFORM.SETALL('VISIBLE',.F.,'LABEL')
      ELSE
          THISFORM.SETALL('VISIBLE',.T.,'TEXTBOX')
          THISFORM.SETALL('VISIBLE',.T.,'LABEL')      
      ENDIF 
  ENDPROC       
 **** 
  PROCEDURE CMND1.CLICK      
     DO CASE
           CASE THISFORM.DATA_OPTION.VALUE=1
 		      SELECT  D07.F01,D01.F04,D07.F02,B01.F02,D07.F03,D07.F04,D07.F13,D07.F07,D07.F11;
 		      FROM D07,D07_1,B01 WHERE B01.F01=D07.F02 AND D07.F09<>'1'  AND D07_1.F05=D07.F05 ORDER BY D07.F01 NOWAIT          
		      IF _TALLY >0
		          REPORT FORM ALLTRIM(INT_116)+'D08H' TO PRINT PROMPT PREVIEW
		          FLG='1'    
		          CLEAR
		      ENDIF    		       
           CASE THISFORM.DATA_OPTION.VALUE=2
 		      SELECT  D07.F01,D01.F04,D07.F02,B01.F02,D07.F03,D07.F04,D07.F13,D07.F07,D07.F11;
 		      FROM D07,D07_1,B01 WHERE B01.F01=D07.F02 AND D07.F03<DATE() AND D07.F09='1'  AND D07_1.F05=D07.F05  ORDER BY D07.F01 NOWAIT          
		      IF _TALLY >0
		          REPORT FORM ALLTRIM(INT_116)+'D08I' TO PRINT PROMPT PREVIEW
		          FLG='1'    
		          CLEAR
		      ENDIF            
           CASE THISFORM.DATA_OPTION.VALUE=3
		     DO CASE 
		           CASE KEY()='F01+DTOS(F03)'         
		                      SELECT D07.F01,D07.F02,D07.F03,D07.F04,D07.F05,D07.F07,D07.F09,D07.F13,B01.F02,D07_1.EXP_2 FROM D07,B01,D07_1;
		                     WHERE B01.F01=D07.F02 AND D07_1.F05=D07.F05 AND D07.F01>=THISFORM.TEXT1.VALUE AND D07.F01<=THISFORM.TEXT2.VALUE;
		                      ORDER BY D07.F01,D07.F03 NOWAIT
		                      IF _TALLY >0
		                          REPORT FORM ALLTRIM(INT_116)+'D08A' TO PRINT PROMPT PREVIEW   
		                          FLG='1'   
		                          CLEAR 
		                      ENDIF  
		           CASE KEY()='DTOS(F03)+F01'   
		                      SELECT D07.F01,D07.F02,D07.F03,D07.F04,D07.F05,D07.F07,D07.F09,D07.F13,B01.F02,D07_1.EXP_2 FROM D07,B01,D07_1;
		                      WHERE  B01.F01=D07.F02 AND D07_1.F05=D07.F05 AND D07.F03>=THISFORM.TEXT1.VALUE AND D07.F03<=THISFORM.TEXT2.VALUE;
		                      ORDER BY D07.F03,D07.F01 NOWAIT
		                      IF _TALLY >0
		                          REPORT FORM ALLTRIM(INT_116)+'D08B' TO PRINT PROMPT PREVIEW     
		                          FLG='1'   
		                          CLEAR 
		                      ENDIF             
		           CASE KEY()='F05+DTOS(F03)'   
		                      SELECT D07.F01,D07.F02,D07.F03,D07.F04,D07.F05,D07.F07,D07.F09,D07.F13,B01.F02,D07_1.EXP_2 FROM D07,B01,D07_1;
		                      WHERE B01.F01=D07.F02 AND D07_1.F05=D07.F05 AND D07.F05>=THISFORM.TEXT1.VALUE AND D07.F05<=THISFORM.TEXT2.VALUE;
		                      ORDER BY D07.F05,D07.F03 NOWAIT
		                      IF _TALLY >0
		                          REPORT FORM ALLTRIM(INT_116)+'D08C' TO PRINT PROMPT PREVIEW  
		                          FLG='1'   
		                          CLEAR 
		                      ENDIF                   
		           CASE KEY()='F01+F02+DTOS(F03)'   
		                      SELECT D07.F01,D07.F02,D07.F03,D07.F04,D07.F05,D07.F07,D07.F09,D07.F13,B01.F02,D07_1.EXP_2 FROM D07,B01,D07_1;
		                      WHERE B01.F01=D07.F02 AND D07_1.F05=D07.F05 AND D07.F01>=THISFORM.TEXT1.VALUE AND D07.F01<=THISFORM.TEXT2.VALUE;
		                      ORDER BY D07.F01,D07.F02,D07.F03 NOWAIT
		                      IF _TALLY >0
		                          REPORT FORM ALLTRIM(INT_116)+'D08D' TO PRINT PROMPT PREVIEW
		                          FLG='1'  
		                          CLEAR  
		                      ENDIF                       
		           CASE KEY()='F02+DTOS(F03)'   
		                      SELECT D07.F01,D07.F02,D07.F03,D07.F04,D07.F05,D07.F07,D07.F09,D07.F13,B01.F02,D07_1.EXP_2 FROM D07,B01,D07_1;
		                      WHERE B01.F01=D07.F02 AND D07_1.F05=D07.F05 AND D07.F02>=THISFORM.TEXT1.VALUE AND D07.F02<=THISFORM.TEXT2.VALUE;
		                      ORDER BY D07.F02,D07.F03 NOWAIT
		                      IF _TALLY >0
		                          REPORT FORM ALLTRIM(INT_116)+'D08E' TO PRINT PROMPT PREVIEW  
		                          FLG='1'  
		                          CLEAR  
		                      ENDIF                   
		           CASE KEY()='F07+F02+DTOS(F03)'   
		                      SELECT D07.F01,D07.F02,D07.F03,D07.F04,D07.F05,D07.F07,D07.F09,D07.F13,B01.F02,D07_1.EXP_2 FROM D07,B01,D07_1;
		                      WHERE  B01.F01=D07.F02 AND D07_1.F05=D07.F05 AND ALLTRIM(D07.F07)>=ALLTRIM(THISFORM.TEXT1.VALUE) AND ALLTRIM(D07.F07)<=ALLTRIM(THISFORM.TEXT2.VALUE);
		                      ORDER BY D07.F07,D07.F02,D07.F03 NOWAIT
		                      IF _TALLY >0
		                          REPORT FORM ALLTRIM(INT_116)+'D08F' TO PRINT PROMPT PREVIEW
		                          FLG='1'   
		                          CLEAR  
		                      ENDIF     
		           CASE KEY()='F13+DTOS(F03)+F02'   
		                      SELECT D07.F01,D07.F02,D07.F03,D07.F04,D07.F05,D07.F07,D07.F09,D07.F13,B01.F02,D07_1.EXP_2 FROM D07,B01,D07_1;
		                      WHERE  B01.F01=D07.F02 AND D07_1.F05=D07.F05 AND IIF(EMPTY(ALLTRIM(THISFORM.TEXT1.VALUE)) AND EMPTY(ALLTRIM(THISFORM.TEXT2.VALUE)),;
		                      ALLTRIM(D07.F13)='',!EMPTY(ALLTRIM(D07.F13)) AND ALLTRIM(D07.F13)>=ALLTRIM(THISFORM.TEXT1.VALUE) AND ALLTRIM(D07.F13)<=ALLTRIM(THISFORM.TEXT2.VALUE));
		                      ORDER BY D07.F13,D07.F03,D07.F02 NOWAIT
		                      IF _TALLY >0
		                          REPORT FORM ALLTRIM(INT_116)+'D08G' TO PRINT PROMPT PREVIEW
		                          FLG='1'    
		                          CLEAR 
		                      ENDIF                                                                                 
		     ENDCASE  
     ENDCASE		               
     THISFORM.RELEASE 
ENDPROC
  *******IIF(AT(P04.F15,INT_161)=0 .OR. EMPTY(P04.F15),'',SUBSTR(INT_161,AT(P04.F15,INT_161)+2,6))
  PROCEDURE CMND2.CLICK        
     DO CASE
           CASE THISFORM.DATA_OPTION.VALUE=1
            	      FILE_NAME='D08 進貨計畫(未回覆交期)'
 		      SELECT  D07.F01 採購單號,D01.F04 廠商名稱,D07.F02 料號,B01.F02 品名規格,D07.F03 預定進貨日,D07.F04 進貨數量,;
 		      D07.F13+ '(' + ALLTRIM(D07.F17) + ')' 運貨方式,RIGHT(ALLTRIM(D07.F07),8) 請購對象,ALLTRIM(D07.F07) 採購用途,D07.F11 原定進貨日,B01.F49 產地代號,D07.F08 安全資料;
 		      FROM D07,D07_1,B01 WHERE B01.F01=D07.F02 AND D07.F09<>'1' AND D07_1.F05=D07.F05 ORDER BY D07.F01 INTO CURSOR D08_TEMP  		       
           CASE THISFORM.DATA_OPTION.VALUE=2
 		      FILE_NAME='D08 進貨計畫(應進貨未入貨)'
 		      SELECT  D07.F01 採購單號,D01.F04 廠商名稱,D07.F02 料號,B01.F02 品名規格,D07.F03 預定進貨日,D07.F04 進貨數量,;
 		      D07.F13+'(' + ALLTRIM(D07.F17) + ')' 運貨方式,RIGHT(ALLTRIM(D07.F07),8) 請購對象,ALLTRIM(D07.F07) 採購用途,D07.F11 原定進貨日,B01.F49 產地代號,D07.F08 安全資料 ;
 		      FROM D07,D07_1,B01 WHERE B01.F01=D07.F02 AND D07.F03<DATE() AND D07.F09='1'  AND D07_1.F05=D07.F05 ORDER BY D07.F01 INTO CURSOR D08_TEMP               
           CASE THISFORM.DATA_OPTION.VALUE=3
		     DO CASE 
		           CASE KEY()='F01+DTOS(F03)'         
		                      FILE_NAME='D08 進貨計畫(資料範圍 '+ALLTRIM(THISFORM.TEXT1.VALUE)+'~'+ALLTRIM(THISFORM.TEXT2.VALUE)+' )'
		                      SELECT D07.F01 採購單號,D07.F02 料號,B01.F02 品名規格,D07.F03 預定進貨日,D07.F04 進貨數量,D07.F05 廠商編號,D07_1.EXP_2 廠商名稱,;
		                      D07.F07 採購用途,D07.F13+'(' + ALLTRIM(D07.F17) + ')' 運貨方式,IIF(D07.F09='1','已回覆','未回覆') 交期回覆,B01.F49 產地代號,D07.F08 安全資料 FROM D07,B01,D07_1;
		                     WHERE B01.F01=D07.F02 AND D07_1.F05=D07.F05 AND D07.F01>=THISFORM.TEXT1.VALUE AND D07.F01<=THISFORM.TEXT2.VALUE;
		                      ORDER BY D07.F01,D07.F03 INTO CURSOR D08_TEMP READWRITE
		                      ALTER TABLE D08_TEMP ADD  客戶品號 C(30,0)
		                      SELECT D08_TEMP
		                      GO TOP
		                      DO WHILE !EOF()
		                             REPLACE D08_TEMP.客戶品號 WITH IIF(SEEK(IIF(SEEK(LEFT(ALLTRIM(D08_TEMP.採購用途),10),'P05'),P05.F06,''),'C03'),C03.F14,'')
		                             SELECT D08_TEMP
		                             SKIP
		                      ENDDO
		           CASE KEY()='DTOS(F03)+F01'   
		                      IF EMPTY(THISFORM.TEXT1.VALUE) OR EMPTY(THISFORM.TEXT2.VALUE)
		                           FILE_NAME='D08 進貨計畫(依日期排列)'
		                      ELSE
		                           FILE_NAME='D08 進貨計畫(資料範圍 '+ALLTRIM(DTOS(THISFORM.TEXT1.VALUE))+'~'+ALLTRIM(DTOS(THISFORM.TEXT2.VALUE))+' )'
		                      ENDIF     
		                      SELECT D07.F01 採購單號,D07.F02 料號,B01.F02 品名規格,D07.F03 預定進貨日,D07.F04 進貨數量,D07.F05 廠商編號,D07_1.EXP_2 廠商名稱,;
		                      D07.F07 採購用途,D07.F13+'(' + ALLTRIM(D07.F17) + ')' 運貨方式,IIF(D07.F09='1','已回覆','未回覆') 交期回覆,B01.F49 產地代號,D07.F08 安全資料 FROM D07,B01,D07_1;
		                      WHERE  B01.F01=D07.F02 AND D07_1.F05=D07.F05 AND D07.F03>=THISFORM.TEXT1.VALUE AND D07.F03<=THISFORM.TEXT2.VALUE;
		                      ORDER BY D07.F03,D07.F01 INTO CURSOR D08_TEMP READWRITE
		                      ALTER TABLE D08_TEMP ADD  客戶品號 C(30,0)
		                      SELECT D08_TEMP
		                      GO TOP
		                      DO WHILE !EOF()
		                             REPLACE D08_TEMP.客戶品號 WITH IIF(SEEK(IIF(SEEK(LEFT(ALLTRIM(D08_TEMP.採購用途),10),'P05'),P05.F06,''),'C03'),C03.F14,'')
		                             SELECT D08_TEMP
		                             SKIP
		                      ENDDO		                      
		           CASE KEY()='F05+DTOS(F03)'   
		                      FILE_NAME='D08 進貨計畫(資料範圍 '+ALLTRIM(THISFORM.TEXT1.VALUE)+'~'+ALLTRIM(THISFORM.TEXT2.VALUE)+' )'
		                      SELECT D07.F01 採購單號,D07.F02 料號,B01.F02 品名規格,D07.F03 預定進貨日,D07.F04 進貨數量,D07.F05 廠商編號,D07_1.EXP_2 廠商名稱,;
		                      D07.F07 採購用途,D07.F13+'(' + ALLTRIM(D07.F17) + ')' 運貨方式,IIF(D07.F09='1','已回覆','未回覆') 交期回覆,B01.F49 產地代號,D07.F08 安全資料 FROM D07,B01,D07_1;
		                      WHERE B01.F01=D07.F02 AND D07_1.F05=D07.F05 AND D07.F05>=THISFORM.TEXT1.VALUE AND D07.F05<=THISFORM.TEXT2.VALUE;
		                      ORDER BY D07.F05,D07.F03 INTO CURSOR D08_TEMP READWRITE
		                      ALTER TABLE D08_TEMP ADD  客戶品號 C(30,0)
		                      SELECT D08_TEMP
		                      GO TOP
		                      DO WHILE !EOF()
		                             REPLACE D08_TEMP.客戶品號 WITH IIF(SEEK(IIF(SEEK(LEFT(ALLTRIM(D08_TEMP.採購用途),10),'P05'),P05.F06,''),'C03'),C03.F14,'')
		                             SELECT D08_TEMP
		                             SKIP
		                      ENDDO			                      
		           CASE KEY()='F01+F02+DTOS(F03)'   
		                      FILE_NAME='D08 進貨計畫(資料範圍 '+ALLTRIM(THISFORM.TEXT1.VALUE)+'~'+ALLTRIM(THISFORM.TEXT2.VALUE)+' )'
		                      IF A02.F10='*'
		                         SELECT D07.F01 採購單號,D07.F02 料號,B01.F02 品名規格,D07.F03 預定進貨日,D07.F04 進貨數量,D07.F05 廠商編號,D07_1.EXP_2 廠商名稱,;
		                         D07.F07 採購用途,D07.F13+'(' + ALLTRIM(D07.F17) + ')' 運貨方式,IIF(D07.F09='1','已回覆','未回覆') 交期回覆,B01.F49 產地代號,P04.F04 幣別,P04.F05 單價,P04.F13 代號,D07.F08 安全資料 FROM D07,B01,D07_1,P04;
		                         WHERE B01.F01=D07.F02 AND D07_1.F05=D07.F05 AND P04.F01+P04.F02=D07.F01+D07.F02 AND D07.F01>=THISFORM.TEXT1.VALUE AND D07.F01<=THISFORM.TEXT2.VALUE;
		                         ORDER BY D07.F01,D07.F02,D07.F03 INTO CURSOR D08_TEMP  READWRITE   
		                         ALTER TABLE D08_TEMP ADD  客戶品號 C(30,0)  
		                      ELSE
		                          SELECT D07.F01 採購單號,D07.F02 料號,B01.F02 品名規格,D07.F03 預定進貨日,D07.F04 進貨數量,D07.F05 廠商編號,D07_1.EXP_2 廠商名稱,;
		                         D07.F07 採購用途,D07.F13+'(' + ALLTRIM(D07.F17) + ')' 運貨方式,IIF(D07.F09='1','已回覆','未回覆') 交期回覆,B01.F49 產地代號,P04.F13 代號,D07.F08 安全資料 FROM D07,B01,D07_1,P04;
		                         WHERE B01.F01=D07.F02 AND D07_1.F05=D07.F05 AND P04.F01+P04.F02=D07.F01+D07.F02 AND D07.F01>=THISFORM.TEXT1.VALUE AND D07.F01<=THISFORM.TEXT2.VALUE;
		                         ORDER BY D07.F01,D07.F02,D07.F03 INTO CURSOR D08_TEMP  READWRITE     
		                         ALTER TABLE D08_TEMP ADD  客戶品號 C(30,0)
		                      ENDIF
		                       
		                      SELECT D08_TEMP
		                      GO TOP
		                      DO WHILE !EOF()
		                             REPLACE D08_TEMP.客戶品號 WITH IIF(SEEK(IIF(SEEK(LEFT(ALLTRIM(D08_TEMP.採購用途),10),'P05'),P05.F06,''),'C03'),C03.F14,'')
		                             SELECT D08_TEMP
		                             SKIP
		                      ENDDO			                           
		           CASE KEY()='F02+DTOS(F03)'   
		                      FILE_NAME='D08 進貨計畫(資料範圍 '+ALLTRIM(THISFORM.TEXT1.VALUE)+'~'+ALLTRIM(THISFORM.TEXT2.VALUE)+' )'		                     
		                      IF A02.F10='*'
		                         SELECT D07.F01 採購單號,D07.F02 料號,B01.F02 品名規格,D07.F03 預定進貨日,D07.F04 進貨數量,D07.F05 廠商編號,D07_1.EXP_2 廠商名稱,;
		                         D07.F07 採購用途,D07.F13+'(' + ALLTRIM(D07.F17) + ')' 運貨方式,IIF(D07.F09='1','已回覆','未回覆') 交期回覆,B01.F49 產地代號,P04.F04 幣別,P04.F05 單價,P04.F13 代號,D07.F08 安全資料 FROM D07,B01,D07_1,P04;
		                         WHERE B01.F01=D07.F02 AND D07_1.F05=D07.F05 AND P04.F01+P04.F02=D07.F01+D07.F02 AND D07.F02>=THISFORM.TEXT1.VALUE AND D07.F02<=THISFORM.TEXT2.VALUE;
		                         ORDER BY D07.F02,D07.F03 INTO CURSOR D08_TEMP READWRITE	
		                          ALTER TABLE D08_TEMP ADD  客戶品號 C(30,0)
		                      ELSE
		                         SELECT D07.F01 採購單號,D07.F02 料號,B01.F02 品名規格,D07.F03 預定進貨日,D07.F04 進貨數量,D07.F05 廠商編號,D07_1.EXP_2 廠商名稱,;
		                         D07.F07 採購用途,D07.F13+'(' + ALLTRIM(D07.F17) + ')' 運貨方式,IIF(D07.F09='1','已回覆','未回覆') 交期回覆,B01.F49 產地代號,P04.F13 代號,D07.F08 安全資料 FROM D07,B01,D07_1,P04;
		                         WHERE B01.F01=D07.F02 AND D07_1.F05=D07.F05 AND P04.F01+P04.F02=D07.F01+D07.F02 AND D07.F02>=THISFORM.TEXT1.VALUE AND D07.F02<=THISFORM.TEXT2.VALUE;
		                         ORDER BY D07.F02,D07.F03 INTO CURSOR D08_TEMP READWRITE	
		                          ALTER TABLE D08_TEMP ADD  客戶品號 C(30,0)
		                      ENDIF   	                   		                         		                   		                                     		                      		                      
		                      SELECT D08_TEMP
		                      GO TOP
		                      DO WHILE !EOF()
		                             REPLACE D08_TEMP.客戶品號 WITH IIF(SEEK(IIF(SEEK(LEFT(ALLTRIM(D08_TEMP.採購用途),10),'P05'),P05.F06,''),'C03'),C03.F14,'')
		                             SELECT D08_TEMP
		                             SKIP
		                      ENDDO			                      
		           CASE KEY()='F07+F02+DTOS(F03)'   
		                      FILE_NAME='D08 進貨計畫(資料範圍 '+ALLTRIM(THISFORM.TEXT1.VALUE)+'~'+ALLTRIM(THISFORM.TEXT2.VALUE)+' )'
		                      SELECT D07.F01 採購單號,D07.F02 料號,B01.F02 品名規格,D07.F03 預定進貨日,D07.F04 進貨數量,D07.F05 廠商編號,D07_1.EXP_2 廠商名稱,;
		                      D07.F07 採購用途,D07.F13+'(' + ALLTRIM(D07.F17) + ')' 運貨方式,IIF(D07.F09='1','已回覆','未回覆') 交期回覆,B01.F49 產地代號,D07.F08 安全資料 FROM D07,B01,D07_1;
		                      WHERE  B01.F01=D07.F02 AND D07_1.F05=D07.F05 AND ALLTRIM(D07.F07)>=ALLTRIM(THISFORM.TEXT1.VALUE) AND ALLTRIM(D07.F07)<=ALLTRIM(THISFORM.TEXT2.VALUE);
		                      ORDER BY D07.F07,D07.F02,D07.F03 INTO CURSOR D08_TEMP READWRITE
		                      ALTER TABLE D08_TEMP ADD  客戶品號 C(30,0)
		                      SELECT D08_TEMP
		                      GO TOP
		                      DO WHILE !EOF()
		                             REPLACE D08_TEMP.客戶品號 WITH IIF(SEEK(IIF(SEEK(LEFT(ALLTRIM(D08_TEMP.採購用途),10),'P05'),P05.F06,''),'C03'),C03.F14,'')
		                             SELECT D08_TEMP
		                             SKIP
		                      ENDDO			                      
		           CASE KEY()='F13+DTOS(F03)+F02'   
		                      FILE_NAME='D08 進貨計畫(資料範圍 '+ALLTRIM(THISFORM.TEXT1.VALUE)+'~'+ALLTRIM(THISFORM.TEXT2.VALUE)+' )'
		                      SELECT D07.F01 採購單號,D07.F02 料號,B01.F02 品名規格,D07.F03 預定進貨日,D07.F04 進貨數量,D07.F05 廠商編號,D07_1.EXP_2 廠商名稱,;
		                      D07.F07 採購用途,D07.F13+'(' + ALLTRIM(D07.F17) + ')' 運貨方式,IIF(D07.F09='1','已回覆','未回覆') 交期回覆,B01.F49 產地代號,D07.F08 安全資料 FROM D07,B01,D07_1;
		                      WHERE  B01.F01=D07.F02 AND D07_1.F05=D07.F05 AND IIF(EMPTY(ALLTRIM(THISFORM.TEXT1.VALUE)) AND EMPTY(ALLTRIM(THISFORM.TEXT2.VALUE)),;
		                      ALLTRIM(D07.F13)='',!EMPTY(ALLTRIM(D07.F13)) AND ALLTRIM(D07.F13)>=ALLTRIM(THISFORM.TEXT1.VALUE) AND ALLTRIM(D07.F13)<=ALLTRIM(THISFORM.TEXT2.VALUE));
		                      ORDER BY D07.F13,D07.F03,D07.F02 INTO CURSOR D08_TEMP READWRITE   
		                      ALTER TABLE D08_TEMP ADD  客戶品號 C(30,0)
		                      SELECT D08_TEMP
		                      GO TOP
		                      DO WHILE !EOF()
		                             REPLACE D08_TEMP.客戶品號 WITH IIF(SEEK(IIF(SEEK(LEFT(ALLTRIM(D08_TEMP.採購用途),10),'P05'),P05.F06,''),'C03'),C03.F14,'')
		                             SELECT D08_TEMP
		                             SKIP
		                      ENDDO			                                                                                  
		     ENDCASE  
     ENDCASE
     SELECT D08_TEMP
     GO TOP
     IF _TALLY >0
	 GCDELIMFILE=PUTFILE('儲存路徑',FILE_NAME,'XLS')
	 IF EMPTY(GCDELIMFILE)  && ESC PRESSED
	      SELECT D08_TEMP
	      USE
	      RETURN
	 ELSE
	      ON ERROR DO FILE_IMPACT
	      IF _TALLY >0
	          COPY TO (GCDELIMFILE) TYPE XL5   
	          =MESSAGEBOX('儲存成功',0+64,'提示訊息視窗')
	      ENDIF                             
	 ENDIF
	 SELECT D08_TEMP
	 USE
	 FLG='1'    
     ENDIF
     THISFORM.RELEASE       	     
  ENDPROC  
  *****
  PROCEDURE CMND3.CLICK
      FLG='1'   
      THISFORM.RELEASE
  ENDPROC          
ENDDEFINE 
****************************************輸入異動單號畫面
DEFINE CLASS CHG_ORD AS FORM
  AUTOCENTER=.T.
  CAPTION='輸入異動單號'
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*175
  WIDTH=INT_015*325
  CONTROLBOX=.F.
  BORDERSTYLE=2
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WINDOWTYPE=1
  NAME='CHG_ORD'
  ADD OBJECT LABEL1 AS LABEL WITH;
      AUTOSIZE=.T.,;
      HEIGHT=INT_015*25,;
      LEFT=INT_015*30,;
      TOP=INT_015*75,;
      FONTSIZE=INT_015*9,;
      NAME='LABEL1'
      ADD OBJECT TEXT1 AS TEXTBOX WITH;
          AUTOSIZE=.T.,;
          TOP=INT_015*70,;
          WIDTH=INT_015*180,;
          LEFT=INT_015*120,;
          HEIGHT=INT_015*25,; 
          FONTSIZE=INT_015*9,;
          NAME='TEXT1'
      ADD OBJECT CMND1 AS COMMANDBUTTON WITH;
          AUTOSIZE=.T.,;
          LEFT=INT_015*60,;    
          HEIGHT=INT_015*25,;   
          TOP=INT_015*144,;  
          WIDTH=INT_015*80,;
          FONTSIZE=INT_015*9,;          
          CAPTION='\<Y.執行',;
          TOOLTIPTEXT='確認搜尋所輸入的單號!快速鍵->ALT+Y',;
          NAME='CMND1'
      ADD OBJECT CMND2 AS COMMANDBUTTON WITH;
          AUTOSIZE=.T.,;
          LEFT=INT_015*200,;
          TOP=INT_015*144,;
          HEIGHT=INT_015*25,;
          WIDTH=INT_015*80,;
          FONTSIZE=INT_015*9,;
          CAPTION='\<C.取消',;
          TOOLTIPTEXT='取消搜尋作業!快速鍵->ALT+C',;
          NAME='CMND2'
      PROCEDURE INIT 
          THISFORM.LABEL1.CAPTION='異動單號'
          THISFORM.TEXT1.VALUE=''
      ENDPROC    
      PROCEDURE CMND1.CLICK 
           H=THISFORM.TEXT1.VALUE       
           THISFORM.RELEASE                
      ENDPROC
      PROCEDURE CMND2.CLICK
          THISFORM.RELEASE
      ENDPROC      
ENDDEFINE    

**************************************異動 
DEFINE CLASS CH_SEEK AS FORM
  AUTOCENTER=.T.
  FONTSIZE=INT_015*9 
  TOP=INT_015*110
  LEFT=INT_015*40    
  HEIGHT=INT_015*350
  WIDTH=INT_015*550
  FONTSIZE=INT_015*9
  MOVABLE=.T.
  MAXBUTTON=.F.
  MINBUTTON=.F.      
  CONTROLBOX=.F.
  BORDERSTYLE=2
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WINDOWTYPE=1
  NAME='CH_SEEK'      
  ADD OBJECT GRID1 AS GRID WITH;        
      LEFT=INT_015*10,;
      TOP=INT_015*165,;
      WIDTH=INT_015*540,;      
      HEIGHT=INT_015*150,;      
      ROWHEIGHT=INT_015*18,;
      HEADERHEIGHT=INT_015*19,;  
      RECORDSOURCE='C66_TEMP',;    
      DELETEMARK=.F.,;
      READONLY=.T.,;
      RECORDSOURCETYPE=1,;
      ALLOWCELLSELECTION=.T.,;
      HIGHLIGHTROWLINEWIDTH=4,;
      ALLOWROWSIZING=.F.,;
      COLUMNCOUNT=9,;            
      NAME='GRID1',;
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;      
      COLUMN3.NAME='COLUMN3',; 
      COLUMN4.NAME='COLUMN4',;
      COLUMN5.NAME='COLUMN5',;      
      COLUMN6.NAME='COLUMN6',;
      COLUMN7.NAME='COLUMN7',;
      COLUMN8.NAME='COLUMN8',;
      COLUMN9.NAME='COLUMN9'    
  ADD OBJECT KEY_LIST AS KEY_LIST WITH;
      AUTOCENTER=.T.
  ADD OBJECT CMDGROUP AS CMDGROUP WITH;
      AUTOSIZE=.T.  
  ADD OBJECT LBLF03 AS LABEL WITH;
      TOP=INT_015*10,;
      LEFT=INT_015*10,;
      HEIGHT=INT_015*17,;      
      WIDTH=INT_015*60,;
      CAPTION='異動日期'            
  ADD OBJECT TXTF03 AS TEXTBOX WITH;
      TOP=INT_015*5,;
      LEFT=INT_015*65,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*80,;
      MAXLENGTH=8   
  ADD OBJECT LBLF08 AS LABEL WITH;
      TOP=INT_015*10,;
      LEFT=INT_015*390,;
      HEIGHT=INT_015*17,;      
      WIDTH=INT_015*60,;
      CAPTION='運貨方式'   
 ADD OBJECT COMBOBOX08 AS COMBOBOX WITH;      
      TOP=INT_015*5,;
      LEFT=INT_015*445,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*80,;
      STYLE=2,;
      FONTSIZE=INT_015*9   
  ADD OBJECT TXTF08 AS TEXTBOX WITH;
      TOP=INT_015*5,;
      LEFT=INT_015*445,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*80,; 
      MAXLENGTH=10       
  ADD OBJECT LBLF02 AS LABEL WITH;
      TOP=INT_015*36,;
      LEFT=INT_015*10,;
      HEIGHT=INT_015*17,;      
      WIDTH=INT_015*60,;
      CAPTION='異動類別'      
 ADD OBJECT COMBOBOX02 AS COMBOBOX WITH;      
      TOP=INT_015*31,;
      LEFT=INT_015*65,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*80,;
      STYLE=2,;
      FONTSIZE=INT_015*9    
  ADD OBJECT TXTF02 AS TEXTBOX WITH;
      TOP=INT_015*31,;
      LEFT=INT_015*65,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*80              
  ADD OBJECT LBLF10 AS LABEL WITH;
      TOP=INT_015*36,;
      LEFT=INT_015*390,;
      HEIGHT=INT_015*17,;      
      WIDTH=INT_015*60,;
       CAPTION='運費對象'    
 ADD OBJECT COMBOBOX10 AS COMBOBOX WITH;      
      TOP=INT_015*31,;
      LEFT=INT_015*445,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*80,;
      STYLE=2,;
      FONTSIZE=INT_015*9         
  ADD OBJECT TXTF10 AS TEXTBOX WITH;
      TOP=INT_015*31,;
      LEFT=INT_015*445,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*80,; 
      MAXLENGTH=10  
  ADD OBJECT LBLF06 AS LABEL WITH;
      TOP=INT_015*62,;
      LEFT=INT_015*10,;
      HEIGHT=INT_015*17,;      
      WIDTH=INT_015*60,;
       CAPTION='原訂交期'            
  ADD OBJECT TXTF06 AS TEXTBOX WITH;
      TOP=INT_015*57,;
      LEFT=INT_015*65,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*80,;
      MAXLENGTH=8
  ADD OBJECT LBLF05 AS LABEL WITH;
      TOP=INT_015*62,;
      LEFT=INT_015*390,;
      HEIGHT=INT_015*17,;      
      WIDTH=INT_015*60,;
      CAPTION='異動數量'            
  ADD OBJECT TXTF05 AS TEXTBOX WITH;
      TOP=INT_015*57,;
      LEFT=INT_015*445,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*80,;
      MAXLENGTH=13      
  ADD OBJECT LBLF07 AS LABEL WITH;
      TOP=INT_015*88,;
      LEFT=INT_015*10,;
      HEIGHT=INT_015*17,;      
      WIDTH=INT_015*60,;
      CAPTION='希望交期'            
  ADD OBJECT TXTF07 AS TEXTBOX WITH;
      TOP=INT_015*83,;
      LEFT=INT_015*65,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*80,;
      MAXLENGTH=8                
  ADD OBJECT LBLF14 AS LABEL WITH;
      TOP=INT_015*114,;
      LEFT=INT_015*10,;
      HEIGHT=INT_015*17,;      
      WIDTH=INT_015*60,;
      CAPTION='備註說明'            
  ADD OBJECT TXTF14 AS TEXTBOX WITH;
      TOP=INT_015*109,;
      LEFT=INT_015*65,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*460,;
      MAXLENGTH=80     
  ADD OBJECT LBLF99 AS LABEL WITH;
      TOP=INT_015*140,;
      LEFT=INT_015*10,;
      HEIGHT=INT_015*17,;      
      AUTOSIZE=.T.,;
      CAPTION=''     
  ADD OBJECT ORPGROUP AS ORPGROUP WITH;    
      TOP=INT_015*316,;
      LEFT=INT_015*70
  ADD OBJECT SHRGROUP AS SHRGROUP WITH;
      TOP=INT_015*316,;
      LEFT=INT_015*370    
  ADD OBJECT PNT_BT AS COMMANDBUTTON WITH;
      LEFT=INT_015*200,;
      TOP=INT_015*321,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\harrow.CUR',;
      CAPTION='\<P.列印',;
      TOOLTIPTEXT='列印資料!快速鍵->ALT+P'
      NAME='PNT_BT' 
  ADD OBJECT CMND1 AS COMMANDBUTTON WITH;
      LEFT=INT_015*243,;
      TOP=INT_015*321,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\harrow.CUR',;
      CAPTION='\<X.離開',;
      TOOLTIPTEXT='取消此作業畫面!快速鍵->ALT+X'
      NAME='CMND1'   
 PROC INIT   
       THISFORM.CAPTION='C66.入貨異動單' + '   料號：' + ALLTRIM(D07.F02) + '   客戶：' + ALLTRIM(IIF(SEEK(IIF(SEEK(LEFT(ALLTRIM(D07.F07),10),'P05'),P05.F04,C05.F06),'C01'),C01.F05,'')) + '   採購單號：' + D07.F01
       THISFORM.SETALL('HEIGHT',INT_015*25,'TEXTBOX')
       THISFORM.SETALL('HEIGHT',INT_015*17,'LABEL')
       THISFORM.SETALL('FONTSIZE',INT_015*9,'TEXTBOX')
       THISFORM.SETALL('FONTSIZE',INT_015*9,'LABEL')       
       THISFORM.SETALL('READONLY',.T.,'TEXTBOX')  
	   THISFORM.KEY_LIST.VISIBLE=.F.                
	   THISFORM.CMDGROUP.VISIBLE=.F.
       THISFORM.SHRGROUP.VISIBLE=.F.
       THISFORM.SHRGROUP.ENABLED=.F.
       THISFORM.ORPGROUP.ESC_BOTT.VISIBLE=.F.
       THISFORM.ORPGROUP.PNT_BOTT.VISIBLE=.F.
       THISFORM.COMBOBOX02.VISIBLE = .T.
       THISFORM.COMBOBOX08.VISIBLE = .T.
       THISFORM.COMBOBOX10.VISIBLE = .T.
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'COLUMN')
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'HEADER')    
       THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(C66_TEMP.F01 = 0,RGB(255,0,0),'')","COLUMN") 
       THISFORM.GRID1.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)
       THISFORM.GRID1.COLUMN4.BACKCOLOR = RGB(255,255,0)
       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION=''
       THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='列印狀態'    
       THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='異動日期'
       THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='異動類別'
       THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='原定交期'
       THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='希望交期'
       THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='異動數量'
       THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='運貨方式'
       THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='運費對象'
       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='C66_TEMP.EXP_1'
       THISFORM.GRID1.COLUMN2.CONTROLSOURCE="IIF(C66_TEMP.F01 = 0,'尚未列印','已列印')"
       THISFORM.GRID1.COLUMN3.CONTROLSOURCE='C66_TEMP.F03'
       THISFORM.GRID1.COLUMN4.CONTROLSOURCE="ICASE(C66_TEMP.F02 = '1','提前交期',C66_TEMP.F02 = '2','延後交期','取消請購')"
       THISFORM.GRID1.COLUMN5.CONTROLSOURCE="IIF(!EMPTY(C66_TEMP.F09),C66_TEMP.F09,IIF(C66_TEMP.F17 = '1',C66_TEMP.F06,'尚未回覆'))"
       THISFORM.GRID1.COLUMN6.CONTROLSOURCE='C66_TEMP.F07'
       THISFORM.GRID1.COLUMN7.CONTROLSOURCE='C66_TEMP.F05'
       THISFORM.GRID1.COLUMN8.CONTROLSOURCE='C66_TEMP.F088'
       THISFORM.GRID1.COLUMN9.CONTROLSOURCE="ICASE(C66_TEMP.F10 = '1','客戶負擔',C66_TEMP.F10 = '2','公司負擔','')"
       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*20
       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*55
       THISFORM.GRID1.COLUMN3.WIDTH=INT_015*65
       THISFORM.GRID1.COLUMN4.WIDTH=INT_015*55
       THISFORM.GRID1.COLUMN5.WIDTH=INT_015*65
       THISFORM.GRID1.COLUMN6.WIDTH=INT_015*65
       THISFORM.GRID1.COLUMN7.WIDTH=INT_015*70
       THISFORM.GRID1.COLUMN8.WIDTH=INT_015*55
       THISFORM.GRID1.COLUMN9.WIDTH=INT_015*55      
       THISFORM.GRID1.SETFOCUS
       IF THISFORM.GRID1.ACTIVEROW=0
		  THISFORM.SETALL('VALUE','','TEXTBOX') 
		  THISFORM.LBLF99.CAPTION = ''
	      THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
	      THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
	      THISFORM.PNT_BT.ENABLED=.F.
       ELSE
	      THISFORM.ORPGROUP.EDIT_BOTT.ENABLED = IIF(A02.F05 = '*',.T.,.F.)
	      THISFORM.ORPGROUP.DEL_BOTT.ENABLED = IIF(A02.F06 = '*',.T.,.F.)
	      THISFORM.PNT_BT.ENABLED = IIF(A02.F07 = '*',.T.,.F.)
	      THISFORM.TXTF02.VALUE = ICASE(C66_TEMP.F02 = '1','提前交期',C66_TEMP.F02 = '2','延後交期','取消請購')
	      THISFORM.TXTF03.VALUE = C66_TEMP.F03
	      THISFORM.TXTF05.VALUE = C66_TEMP.F05
	      THISFORM.TXTF06.VALUE = IIF(!EMPTY(C66_TEMP.F09),C66_TEMP.F09,IIF(C66_TEMP.F17 = '1',C66_TEMP.F06,'尚未回覆'))
	      THISFORM.TXTF07.VALUE = C66_TEMP.F07
	      THISFORM.TXTF08.VALUE = C66_TEMP.F088
	      THISFORM.TXTF10.VALUE = ICASE(C66_TEMP.F10 = '1','客戶負擔',C66_TEMP.F10 = '2','公司負擔','')
	      THISFORM.TXTF14.VALUE = C66_TEMP.F14
	      THISFORM.LBLF99.CAPTION = '安全資料 ' + C66_TEMP.F99
       ENDIF
       THISFORM.ORPGROUP.NEW_BOTT.ENABLED = IIF(A02.F04 = '*',.T.,.F.)
   ENDPROC   
  PROC GRID1.INIT      
	 THISFORM.GRID1.COLUMN1.READONLY=.F.
	 THISFORM.GRID1.COLUMN2.READONLY=.T.
	 THISFORM.GRID1.COLUMN3.READONLY=.T.
	 THISFORM.GRID1.COLUMN4.READONLY=.T.
	 THISFORM.GRID1.COLUMN5.READONLY=.T.
	 THISFORM.GRID1.COLUMN6.READONLY=.T.
	 THISFORM.GRID1.COLUMN7.READONLY=.T.
	 THISFORM.GRID1.COLUMN8.READONLY=.T.
	 THISFORM.GRID1.COLUMN9.READONLY=.T.
	 THISFORM.GRID1.COLUMN1.removeobject("TEXT1")
	 THISFORM.GRID1.COLUMN1.AddObject("CheckBox1","CheckBox1") 
	 THISFORM.GRID1.COLUMN1.CurrentControl="CheckBox1" 
	 THISFORM.GRID1.COLUMN1.Sparse=.F.
	 THISFORM.GRID1.COLUMN1.CheckBox1.Visible=.T.
	 THISFORM.GRID1.COLUMN1.CheckBox1.CAPTION=''
	 THISFORM.GRID1.COLUMN1.CheckBox1.AUTOSIZE=.T.
	 THISFORM.GRID1.COLUMN1.CheckBox1.CENTERED=.T.
	 THISFORM.GRID1.COLUMN1.CheckBox1.BACKSTYLE=0
	 THISFORM.GRID1.COLUMN1.CheckBox1.LEFT=5	 
  ENDPROC 
  PROCEDURE GRID1.AFTERROWCOLCHANGE
       LPARAMETERS NCOLINDEX
	      THISFORM.GRID1.TOOLTIPTEXT = IIF(C66_TEMP.F01 = 0,'尚未列印','已列印')
	      THISFORM.TXTF02.VALUE = ICASE(C66_TEMP.F02 = '1','提前交期',C66_TEMP.F02 = '2','延後交期','取消請購')
	      THISFORM.TXTF03.VALUE = C66_TEMP.F03
	      THISFORM.TXTF05.VALUE = C66_TEMP.F05
	      THISFORM.TXTF06.VALUE = IIF(!EMPTY(C66_TEMP.F09),C66_TEMP.F09,IIF(C66_TEMP.F17 = '1',C66_TEMP.F06,'尚未回覆'))
	      THISFORM.TXTF07.VALUE = C66_TEMP.F07
	      THISFORM.TXTF08.VALUE = C66_TEMP.F088
	      THISFORM.TXTF10.VALUE = ICASE(C66_TEMP.F10 = '1','客戶負擔',C66_TEMP.F10 = '2','公司負擔','')
	      THISFORM.TXTF14.VALUE = C66_TEMP.F14 
	      THISFORM.LBLF99.CAPTION = '安全資料 ' + C66_TEMP.F99
  ENDPROC 
   PROCEDURE COMBOBOX02.INIT
		WITH THIS
   			.ADDITEM('提前交期')
   			.ADDITEM('延後交期')
   			.ADDITEM('取消請購')
   			.VALUE = 1
    	ENDWITH
   ENDPROC     
PROCEDURE COMBOBOX02.INTERACTIVECHANGE 
	 THISFORM.COMBOBOX08.CLEAR
	 THISFORM.TXTF08.VISIBLE = .F.
	 THISFORM.TXTF10.VISIBLE = .T.
	 THISFORM.COMBOBOX08.VISIBLE = .T.
	 THISFORM.COMBOBOX10.VISIBLE = .F.	
	 THISFORM.COMBOBOX08.VALUE = 1
	 THISFORM.TXTF07.ENABLED = .T.
	 THISFORM.TXTF07.VALUE = DATE()
	 THISFORM.TXTF10.VALUE = ''
	 DO CASE
	 	CASE  THISFORM.COMBOBOX02.VALUE = 1
	 	      THISFORM.COMBOBOX08.ADDITEM('海運')
	 	      THISFORM.COMBOBOX08.ADDITEM('海運提前')
	 	      THISFORM.COMBOBOX08.ADDITEM('空運')
	 	      THISFORM.COMBOBOX08.ADDITEM('空運提前')
	 	      THISFORM.COMBOBOX08.ADDITEM('快遞')
	 	      THISFORM.COMBOBOX08.ADDITEM('快遞提前')
	 	      THISFORM.TXTF08.VALUE = IIF(THISFORM.COMBOBOX08.VALUE = 1 OR THISFORM.COMBOBOX08.VALUE = 2,'',THISFORM.COMBOBOX10.DISPLAYVALUE)
	 	CASE  THISFORM.COMBOBOX02.VALUE = 2
	 		  THISFORM.COMBOBOX08.ADDITEM('海運延後') 
	 	      THISFORM.COMBOBOX08.ADDITEM('空運延後') 
	 	      THISFORM.COMBOBOX08.ADDITEM('快遞延後')
	 	      THISFORM.TXTF08.VALUE = IIF(THISFORM.COMBOBOX08.VALUE = 1,'',THISFORM.COMBOBOX10.DISPLAYVALUE)
	 	CASE  THISFORM.COMBOBOX02.VALUE = 3
	 		  THISFORM.TXTF07.ENABLED = .F.
	 		  THISFORM.TXTF07.VALUE = ''
	 	      THISFORM.TXTF08.VISIBLE = .T.
	 	      THISFORM.COMBOBOX08.VISIBLE = .F.
	 	      THISFORM.TXTF08.VALUE = ''
			  THISFORM.TXTF10.VISIBLE = .T.
			  THISFORM.COMBOBOX10.VISIBLE = .F.
	 ENDCASE   
ENDPROC    
   PROCEDURE COMBOBOX08.INIT
		WITH THIS
   			.ADDITEM('海運')
   			.ADDITEM('海運提前')
   			.ADDITEM('空運')
   			.ADDITEM('空運提前')
   			.ADDITEM('快遞')
   			.ADDITEM('快遞提前')
   			.VALUE = 1
    	ENDWITH           
   ENDPROC  
PROCEDURE COMBOBOX08.INTERACTIVECHANGE   
      IF THISFORM.COMBOBOX08.DISPLAYVALUE = '海運' OR THISFORM.COMBOBOX08.DISPLAYVALUE = '海運提前' OR THISFORM.COMBOBOX08.DISPLAYVALUE = '海運延後'
		 THISFORM.TXTF10.VISIBLE = .T.
		 THISFORM.COMBOBOX10.VISIBLE = .F. 
	  ELSE
		 THISFORM.TXTF10.VISIBLE = .F.
		 THISFORM.COMBOBOX10.VISIBLE = .T. 
		 THISFORM.COMBOBOX10.VALUE = 1  
	  ENDIF
 ENDPROC 
   PROCEDURE COMBOBOX10.INIT
		WITH THIS
   			.ADDITEM('客戶負擔')
   			.ADDITEM('公司負擔')
   			.VALUE = 1
    	ENDWITH           
   ENDPROC     
PROCEDURE ORPGROUP.NEW_BOTT.CLICK 
	   THISFORM.ORPGROUP.ENABLED = .F.
	   THISFORM.CMND1.ENABLED =.F.
       THISFORM.GRID1.ENABLED=.F.
       THISFORM.PNT_BT.ENABLED = .F.
       THISFORM.SETALL('READONLY',.F.,'TEXTBOX') 
       THISFORM.TXTF02.VISIBLE = .F.
       THISFORM.TXTF08.VISIBLE = .F.      
       THISFORM.TXTF03.READONLY= .T.
       THISFORM.TXTF06.READONLY= .T.
       THISFORM.TXTF08.READONLY= .T.
       THISFORM.TXTF10.READONLY= .T.
       THISFORM.COMBOBOX02.VISIBLE = .T.
       THISFORM.COMBOBOX08.VISIBLE = .T.
       THISFORM.COMBOBOX10.VISIBLE = .F.
       THISFORM.COMBOBOX02.VALUE = 1
       THISFORM.TXTF02.VALUE = ''
       THISFORM.TXTF03.VALUE = DATE()
       THISFORM.TXTF05.VALUE = D07.F04
       THISFORM.TXTF06.VALUE = IIF(D07.F09 = '1',D07.F03,'尚未回覆')
       THISFORM.TXTF07.VALUE = DATE()
       THISFORM.TXTF08.VALUE = ''
       THISFORM.TXTF10.VALUE = ''
       THISFORM.TXTF14.VALUE = ''
       THISFORM.LBLF99.CAPTION = ''
       THISFORM.COMBOBOX02.SETFOCUS 
 ENDPROC
 PROCEDURE SHRGROUP.SHURE1_BOTT.CLICK  
      IF EMPTY(THISFORM.TXTF07.VALUE) = .T. AND THISFORM.COMBOBOX02.VALUE <> 3
          =MESSAGEBOX('希望交期不得空白!',0+64,'提示訊息視窗')
          THISFORM.TXTF07.SETFOCUS
          RETURN            
      ENDIF 
      IF D07.F09 = '1'
         IF THISFORM.COMBOBOX02.VALUE = 2 AND THISFORM.TXTF07.VALUE <= D07.F03
            =MESSAGEBOX('延後之希望交期不得小於原定交期!',0+64,'提示訊息視窗')
            THISFORM.TXTF07.SETFOCUS
            RETURN            
         ENDIF     
      ENDIF
      IF THISFORM.TXTF05.VALUE <= 0
          =MESSAGEBOX('異動數量不得小於等於零!',0+64,'提示訊息視窗')
          THISFORM.TXTF05.SETFOCUS
          RETURN            
      ENDIF     
      IF THISFORM.TXTF05.VALUE > D07.F04
          =MESSAGEBOX('異動數量不得大於訂購數量!',0+64,'提示訊息視窗')
          THISFORM.TXTF05.SETFOCUS
          RETURN            
      ENDIF
      SELECT C66
      APPEND BLANK
      REPLACE C66.F02 WITH ALLTRIM(STR(THISFORM.COMBOBOX02.VALUE))
      REPLACE C66.F03 WITH THISFORM.TXTF03.VALUE
      REPLACE C66.F04 WITH D07.F02
      REPLACE C66.F05 WITH THISFORM.TXTF05.VALUE
      REPLACE C66.F06 WITH D07.F03
      REPLACE C66.F07 WITH IIF(C66.F02 = '3',CTOD(''),THISFORM.TXTF07.VALUE)
      REPLACE C66.F08 WITH IIF(C66.F02 = '3','',CHR(IIF(C66.F02 = '1',64,70) + THISFORM.COMBOBOX08.VALUE))
      REPLACE C66.F10 WITH IIF(THISFORM.COMBOBOX10.VISIBLE = .T.,ALLTRIM(STR(THISFORM.COMBOBOX10.VALUE)),'')
      REPLACE C66.F11 WITH IIF(SEEK(LEFT(ALLTRIM(D07.F07),10),'P05'),P05.F04,C05.F06)
      REPLACE C66.F12 WITH D07.F01
      REPLACE C66.F13 WITH IIF(SEEK(C66.F11,'C01'),IIF(ALLTRIM(INT_209) = 'A',C01.F18,C01.F33),sys_oper)
      REPLACE C66.F14 WITH THISFORM.TXTF14.VALUE
      REPLACE C66.F17 WITH D07.F09
      REPLACE C66.F18 WITH D07.F05
      REPLACE C66.F20 WITH IIF(SEEK(C66.F11,'C01'),C01.F23,sys_oper)
      REPLACE C66.F99 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
   	  SELECT C66_TEMP
      APPEND BLANK
      REPLACE C66_TEMP.EXP_1 WITH 1
      REPLACE C66_TEMP.F02 WITH ALLTRIM(STR(THISFORM.COMBOBOX02.VALUE))
      REPLACE C66_TEMP.F03 WITH THISFORM.TXTF03.VALUE
      REPLACE C66_TEMP.F04 WITH D07.F02
      REPLACE C66_TEMP.F05 WITH THISFORM.TXTF05.VALUE
      REPLACE C66_TEMP.F06 WITH D07.F03
      REPLACE C66_TEMP.F07 WITH IIF(C66_TEMP.F02 = '3',CTOD(''),THISFORM.TXTF07.VALUE)
      REPLACE C66_TEMP.F08 WITH IIF(C66_TEMP.F02 = '3','',CHR(IIF(C66_TEMP.F02 = '1',64,70) + THISFORM.COMBOBOX08.VALUE))
      REPLACE C66_TEMP.F088 WITH IIF(C66_TEMP.F02 = '3','',ALLTRIM(THISFORM.COMBOBOX08.DISPLAYVALUE))
      REPLACE C66_TEMP.F10 WITH IIF(THISFORM.COMBOBOX10.VISIBLE = .T.,ALLTRIM(STR(THISFORM.COMBOBOX10.VALUE)),'')
      REPLACE C66_TEMP.F11 WITH IIF(SEEK(LEFT(ALLTRIM(D07.F07),10),'P05'),P05.F04,C05.F06)
      REPLACE C66_TEMP.F12 WITH D07.F01
      REPLACE C66_TEMP.F13 WITH IIF(SEEK(C66_TEMP.F11,'C01'),IIF(ALLTRIM(INT_209) = 'A',C01.F18,C01.F33),sys_oper)
      REPLACE C66_TEMP.F14 WITH THISFORM.TXTF14.VALUE
      REPLACE C66_TEMP.F17 WITH D07.F09
      REPLACE C66_TEMP.F18 WITH D07.F05
      REPLACE C66_TEMP.F20 WITH IIF(SEEK(C66_TEMP.F11,'C01'),C01.F23,sys_oper)
      REPLACE C66_TEMP.F99 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'') 
	  SELECT D07
	  REPLACE D07.F14 WITH ALLTRIM(STR(THISFORM.COMBOBOX02.VALUE))
	  REPLACE D07.F15 WITH THISFORM.TXTF03.VALUE
	  SELECT C66_TEMP
	  UNLOCK ALL
	  THISFORM.GRID1.ENABLED=.T.
	  THISFORM.GRID1.SETFOCUS  
	  THISFORM.ORPGROUP.NEW_BOTT.CLICK
 ENDPROC
 PROCEDURE ORPGROUP.EDIT_BOTT.CLICK 
	   THISFORM.ORPGROUP.ENABLED = .F.
	   THISFORM.CMND1.ENABLED =.F.
	   THISFORM.PNT_BT.ENABLED = .F.
       THISFORM.GRID1.ENABLED=.F.
       THISFORM.SETALL('READONLY',.F.,'TEXTBOX') 
       THISFORM.TXTF02.VISIBLE = .F.
       THISFORM.TXTF08.VISIBLE = .F.
       THISFORM.TXTF03.READONLY= .T.
       THISFORM.TXTF06.READONLY= .T.
       THISFORM.TXTF08.READONLY= .T.
       THISFORM.TXTF10.READONLY= .T.
       THISFORM.COMBOBOX02.VISIBLE = .T.
       THISFORM.COMBOBOX08.VISIBLE = .T.
       THISFORM.COMBOBOX10.VISIBLE = .F.
       THISFORM.COMBOBOX02.VALUE = VAL(C66_TEMP.F02)
       THISFORM.COMBOBOX02.INTERACTIVECHANGE
       THISFORM.COMBOBOX08.VALUE = ASC(C66_TEMP.F08) - IIF(C66_TEMP.F02 = '1',64,70)
       THISFORM.TXTF10.VISIBLE = IIF(EMPTY(C66_TEMP.F10),.T.,.F.)
       THISFORM.COMBOBOX10.VISIBLE = IIF(EMPTY(C66_TEMP.F10),.F.,.T.)
       THISFORM.COMBOBOX10.VALUE = VAL(C66_TEMP.F10)
       THISFORM.TXTF07.VALUE = C66_TEMP.F07
       THISFORM.TXTF10.VALUE = ICASE(C66_TEMP.F10 = '1','客戶負擔',C66_TEMP.F10 = '1','公司負擔','')
       THISFORM.COMBOBOX02.SETFOCUS 
 ENDPROC 
 PROCEDURE SHRGROUP.SHURE2_BOTT.CLICK  
      IF EMPTY(THISFORM.TXTF07.VALUE) = .T. AND THISFORM.COMBOBOX02.VALUE <> 3
          =MESSAGEBOX('希望交期不得空白!',0+64,'提示訊息視窗')
          THISFORM.TXTF07.SETFOCUS
          RETURN            
      ENDIF 
      IF D07.F09 = '1'
         IF THISFORM.COMBOBOX02.VALUE = 2 AND THISFORM.TXTF07.VALUE <= IIF(EMPTY(C66_TEMP.F09),C66_TEMP.F06,C66_TEMP.F09)
            =MESSAGEBOX('延後之希望交期不得小於原定交期!',0+64,'提示訊息視窗')
            THISFORM.TXTF07.SETFOCUS
            RETURN            
         ENDIF     
      ENDIF
      IF THISFORM.TXTF05.VALUE <= 0
          =MESSAGEBOX('異動數量不得小於等於零!',0+64,'提示訊息視窗')
          THISFORM.TXTF05.SETFOCUS
          RETURN            
      ENDIF     
      IF THISFORM.TXTF05.VALUE > D07.F04
          =MESSAGEBOX('異動數量不得大於訂購數量!',0+64,'提示訊息視窗')
          THISFORM.TXTF05.SETFOCUS
          RETURN            
      ENDIF
      SELECT C66
      SET ORDER TO C661 &&F02+DTOS(F03)+F04+ALLTRIM(TRANSFORM(F05,"@R 99,999,999.99"))+F08+F10+F11+F12+F13
      SEEK C66_TEMP.F02 + DTOS(C66_TEMP.F03) + C66_TEMP.F04 + ALLTRIM(TRANSFORM(C66_TEMP.F05,"@R 99,999,999.99")) + C66_TEMP.F08 + C66_TEMP.F10 + C66_TEMP.F11 + C66_TEMP.F12 + C66_TEMP.F13
	  IF FOUND()
	     REPLACE C66.F01 WITH 0
	     REPLACE C66.F02 WITH ALLTRIM(STR(THISFORM.COMBOBOX02.VALUE))
	     REPLACE C66.F04 WITH D07.F02
	     REPLACE C66.F05 WITH THISFORM.TXTF05.VALUE
	     REPLACE C66.F06 WITH D07.F03
	     REPLACE C66.F07 WITH IIF(C66.F02 = '3',CTOD(''),THISFORM.TXTF07.VALUE)
	     REPLACE C66.F08 WITH IIF(C66.F02 = '3','',CHR(IIF(C66.F02 = '1',64,70) + THISFORM.COMBOBOX08.VALUE))
	     REPLACE C66.F10 WITH IIF(THISFORM.COMBOBOX10.VISIBLE = .T.,ALLTRIM(STR(THISFORM.COMBOBOX10.VALUE)),'')
	     REPLACE C66.F14 WITH THISFORM.TXTF14.VALUE
	     REPLACE C66.F17 WITH D07.F09
	     REPLACE C66.F99 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')    
	  ENDIF
   	  SELECT C66_TEMP
      LOCK()
      IF RLOCK()
	      REPLACE C66_TEMP.EXP_1 WITH 1
	      REPLACE C66_TEMP.F01 WITH 0
	      REPLACE C66_TEMP.F02 WITH ALLTRIM(STR(THISFORM.COMBOBOX02.VALUE))
	      REPLACE C66_TEMP.F04 WITH D07.F02
	      REPLACE C66_TEMP.F05 WITH THISFORM.TXTF05.VALUE
	      REPLACE C66_TEMP.F06 WITH D07.F03
	      REPLACE C66_TEMP.F07 WITH IIF(C66_TEMP.F02 = '3',CTOD(''),THISFORM.TXTF07.VALUE)
	      REPLACE C66_TEMP.F08 WITH IIF(C66_TEMP.F02 = '3','',CHR(IIF(C66_TEMP.F02 = '1',64,70) + THISFORM.COMBOBOX08.VALUE))
	      REPLACE C66_TEMP.F088 WITH IIF(C66_TEMP.F02 = '3','',ALLTRIM(THISFORM.COMBOBOX08.DISPLAYVALUE))
	      REPLACE C66_TEMP.F10 WITH IIF(THISFORM.COMBOBOX10.VISIBLE = .T.,ALLTRIM(STR(THISFORM.COMBOBOX10.VALUE)),'')
	      REPLACE C66_TEMP.F14 WITH THISFORM.TXTF14.VALUE
	      REPLACE C66_TEMP.F17 WITH D07.F09
	      REPLACE C66_TEMP.F99 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')       
      ENDIF
	  SELECT D07
	  REPLACE D07.F14 WITH ALLTRIM(STR(THISFORM.COMBOBOX02.VALUE))
	  REPLACE D07.F15 WITH THISFORM.TXTF03.VALUE
	  SELECT C66_TEMP
	  UNLOCK ALL
	  THISFORM.GRID1.ENABLED=.T.
	  THISFORM.GRID1.SETFOCUS  
	  THISFORM.SHRGROUP.ABANDON_BOTT.CLICK  
 ENDPROC  
 PROCEDURE ORPGROUP.DEL_BOTT.CLICK
      IF MESSAGEBOX('是否確定要刪除此筆資料',4+32+256,'請確認') = 6
	     SELECT C66
	     SET ORDER TO C661 &&F02+DTOS(F03)+F04+ALLTRIM(TRANSFORM(F05,"@R 99,999,999.99"))+F08+F10+F11+F12+F13
	     SEEK C66_TEMP.F02 + DTOS(C66_TEMP.F03) + C66_TEMP.F04 + ALLTRIM(TRANSFORM(C66_TEMP.F05,"@R 99,999,999.99")) + C66_TEMP.F08 + C66_TEMP.F10 + C66_TEMP.F11 + C66_TEMP.F12 + C66_TEMP.F13
		 IF FOUND()
		    SELECT C66
		    DELETE 
		    SELECT C66_TEMP
		    DELETE 
		 ENDIF
      ENDIF
      THISFORM.GRID1.SETFOCUS 
      IF THISFORM.GRID1.ACTIVEROW=0
		  SELECT D07
		  REPLACE D07.F14 WITH ''
		  REPLACE D07.F15 WITH CTOD('')
		  THISFORM.SETALL('VALUE','','TEXTBOX') 
	      THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
	      THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
	      THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
      ENDIF
      SELECT C66_TEMP
 ENDPROC
 PROCEDURE SHRGROUP.ABANDON_BOTT.CLICK
	  SELECT C66_TEMP 
	  THISFORM.CMND1.ENABLED=.T.
	  THISFORM.ORPGROUP.ENABLED=.T.
      THISFORM.ORPGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
	  THISFORM.SHRGROUP.ENABLED=.F.
      THISFORM.SHRGROUP.VISIBLE=.F.
      THISFORM.TXTF07.ENABLED = .T.
      THISFORM.COMBOBOX02.VISIBLE = .T.
      THISFORM.COMBOBOX08.VISIBLE = .T.
      THISFORM.COMBOBOX10.VISIBLE = .T.
      THISFORM.SETALL('READONLY',.T.,'TEXTBOX')
      THISFORM.SETALL('VISIBLE',.T.,'TEXTBOX') 
	  THISFORM.GRID1.ENABLED=.T.
	  THISFORM.GRID1.SETFOCUS  
      IF THISFORM.GRID1.ACTIVEROW=0
	     THISFORM.SETALL('VALUE','','TEXTBOX') 
	     THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
	     THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
	     THISFORM.PNT_BT.ENABLED=.F. 
      ELSE
	     THISFORM.ORPGROUP.EDIT_BOTT.ENABLED = IIF(A02.F05 = '*',.T.,.F.)
	     THISFORM.ORPGROUP.DEL_BOTT.ENABLED = IIF(A02.F06 = '*',.T.,.F.)
	     THISFORM.PNT_BT.ENABLED = IIF(A02.F07 = '*',.T.,.F.)
      ENDIF
      THISFORM.ORPGROUP.NEW_BOTT.ENABLED = IIF(A02.F04 = '*',.T.,.F.)
 ENDPROC
 PROCEDURE SHRGROUP.FINISH_BOTT.CLICK
   THISFORM.SHRGROUP.ABANDON_BOTT.CLICK
 ENDPROC
 PROCEDURE CMND1.CLICK
     THISFORM.RELEASE
     RETURN 
 ENDPROC  
 PROCEDURE PNT_BT.CLICK  
 	CH_F02 = '' 
 	MAIL_TEXT = ''
    SELECT * FROM C66_TEMP WHERE C66_TEMP.EXP_1 = 1 INTO CURSOR C66_1	
    SELECT C66_1
    GO TOP
    IF _TALLY > 0
       SELECT C66_1.F02,C66_1.F11,C66_1.F18  FROM C66_1 GROUP BY C66_1.F02 ORDER BY C66_1.F02 INTO CURSOR C66_2
       SELECT C66_2
       IF RECCOUNT('C66_2') > 1
          DO WHILE !EOF()
             CH_F02 = CH_F02 + ICASE(C66_2.F02 = '1','提前交期、',C66_2.F02 = '2','延後交期、','取消請購、')
             SELECT C66_2
             SKIP
          ENDDO
          =MESSAGEBOX('此列印作業將會預覽列印共 ' + ALLTRIM(STR(RECCOUNT('C66_2'))) + ' 張入貨異動申請單，異動類別包含：' + LEFT(ALLTRIM(CH_F02),LEN(ALLTRIM(CH_F02)) - 2),0+64,'提示訊息視窗')
       ENDIF
	   SELECT C66_2
	   GO TOP
	   DO WHILE !EOF()
	      SELECT C66_TEMP.* FROM C66_TEMP WHERE C66_TEMP.EXP_1 = 1 AND C66_TEMP.F02 = C66_2.F02 ORDER BY C66_TEMP.F03 INTO CURSOR C66ABC
	      REPORT FORM ALLTRIM(INT_116)+'C66' TO PRINT PROMPT PREVIEW 
	      CLEAR
	      ******傳送MAIL給該廠商負責之採購人員
	      WAIT WINDOW "傳送郵件,請稍後!" AT 0,150 NOWAIT NOCLEAR  
	      SELECT C66ABC
	      GO TOP
	      TMPCHR=IIF(OS()="Windows 5.01",CHR(13)+CHR(10),'<br/>')
	      DO WHILE !EOF()
	         MAIL_TEXT = MAIL_TEXT + '廠商簡稱：' + IIF(SEEK(C66ABC.F18,'D01'),D01.F04,C66ABC.F18) + TMPCHR + ;
	         			 '採購單號：' + C66ABC.F12 + TMPCHR + ;
	         			 '料品編號：' + C66ABC.F04 + TMPCHR + ;
	         			 '異動類別：' + ICASE(C66ABC.F02 = '1','提前交期',C66ABC.F02 = '2','延後交期','取消請購') + TMPCHR + ;
	         			 '異動數量：' + ALLTRIM(TRANSFORM(C66ABC.F05,'@R 99,999,999.99'))  + TMPCHR + ;
	         			 '希望交期：' + DTCX(C66ABC.F07) + TMPCHR + ;
	         			 '載運方式：' + C66ABC.F088 + TMPCHR + ;
	         			 '運費對象：' + ICASE(C66ABC.F10 = '1','客戶負擔',C66ABC.F10 = '1','公司負擔','') + TMPCHR + ;
	         			 '備註說明：' + C66ABC.F14 + TMPCHR + ;
	         			 '************************************************' + TMPCHR
 	         SELECT C66ABC
 	         SKIP
 	      ENDDO
 	      ****傳送MAIL給負責此廠商之採購
 	      IF SEEK(C66_1.F18,'D01') = .T. AND EMPTY(D01.F39) = .F. AND  SEEK(D01.F39,'A01') = .T. AND ALLTRIM(A01.F06) = 'Y' AND AT('@',A01.F10) <> 0 AND EMPTY(MAIL_TEXT) = .F.
 	         PRS_NO=A01.F01
 	         IF OS()="Windows 5.01"
                SEND_MAIL(ALLTRIM(INT_MAI),ALLTRIM(A01.F10),ALLTRIM(INT_DNS),'系統通知：C66.入貨異動申請單、客戶簡稱：' + IIF(SEEK(C66_2.F11,'C01'),C01.F05,C66_2.F11) + '、異動類別：' + ICASE(C66_2.F02 = '1','提前交期',C66_2.F02 = '2','延後交期','取消請購'),'TEXT',MAIL_TEXT)
             ELSE                
                IF !EMPTY(ALLTRIM(PRS_NO))
                   FILE_NAME=ALLTRIM(INT_DAT)+ALLTRIM(PRS_NO)+'.TXT'                  
                   STRTOFILE('<TR><TD>'+MAIL_TEXT+'<TD>C66.入貨異動申請單、客戶簡稱：'+IIF(SEEK(C66_2.F11,'C01'),C01.F05,C66_2.F11) + '、異動類別：' + ICASE(C66_2.F02 = '1','提前交期',C66_2.F02 = '2','延後交期','取消請購')+'<TD>'+TTOC(DATETIME())+ CHR(13) + CHR(10),FILE_NAME,1) 
                ENDIF   
             ENDIF
          ELSE
             PRS_NO=''   
          ENDIF
           ****傳送MAIL給負責業助
 	      IF SEEK(C66_1.F11,'C01') = .T. AND EMPTY(C01.F23) = .F. AND ALLTRIM(SYS_OPER) <> ALLTRIM(C01.F23) AND  SEEK(C01.F23,'A01') = .T. AND ALLTRIM(A01.F06) = 'Y' AND AT('@',A01.F10) <> 0 AND EMPTY(MAIL_TEXT) = .F.
             ASSIS_NO=A01.F01
             IF OS()="Windows 5.01"
                SEND_MAIL(ALLTRIM(INT_MAI),ALLTRIM(A01.F10),ALLTRIM(INT_DNS),'系統通知：C66.入貨異動申請單、客戶簡稱：' + IIF(SEEK(C66_2.F11,'C01'),C01.F05,C66_2.F11) + '、異動類別：' + ICASE(C66_2.F02 = '1','提前交期',C66_2.F02 = '2','延後交期','取消請購'),'TEXT',MAIL_TEXT)
             ELSE
             IF !EMPTY(ALLTRIM(ASSIS_NO))
                   FILE_NAME=ALLTRIM(INT_DAT)+ALLTRIM(ASSIS_NO)+'.TXT'                  
                   STRTOFILE('<TR><TD>'+MAIL_TEXT+'<TD>C66.入貨異動申請單、客戶簡稱：'+IIF(SEEK(C66_2.F11,'C01'),C01.F05,C66_2.F11) + '、異動類別：' + ICASE(C66_2.F02 = '1','提前交期',C66_2.F02 = '2','延後交期','取消請購')+'<TD>'+TTOC(DATETIME())+ CHR(13) + CHR(10),FILE_NAME,1) 
                ENDIF   
             ENDIF
          ELSE
             ASSIS_NO=''   
          ENDIF
           ****傳送MAIL給負責業務B
 	      IF SEEK(C66_1.F11,'C01') = .T. AND EMPTY(C01.F33) = .F. AND ALLTRIM(SYS_OPER) <> ALLTRIM(C01.F33) AND  SEEK(C01.F33,'A01') = .T. AND ALLTRIM(A01.F06) = 'Y' AND AT('@',A01.F10) <> 0 AND EMPTY(MAIL_TEXT) = .F.
             SALES_B_NO=A01.F01
             IF SALES_B_NO<>ASSIS_NO
                IF OS()="Windows 5.01"
                   SEND_MAIL(ALLTRIM(INT_MAI),ALLTRIM(A01.F10),ALLTRIM(INT_DNS),'系統通知：C66.入貨異動申請單、客戶簡稱：' + IIF(SEEK(C66_2.F11,'C01'),C01.F05,C66_2.F11) + '、異動類別：' + ICASE(C66_2.F02 = '1','提前交期',C66_2.F02 = '2','延後交期','取消請購'),'TEXT',MAIL_TEXT)
                ELSE
                   IF !EMPTY(ALLTRIM(SALES_B_NO))
                      FILE_NAME=ALLTRIM(INT_DAT)+ALLTRIM(SALES_B_NO)+'.TXT'                  
                      STRTOFILE('<TR><TD>'+MAIL_TEXT+'<TD>C66.入貨異動申請單、客戶簡稱：'+IIF(SEEK(C66_2.F11,'C01'),C01.F05,C66_2.F11) + '、異動類別：' + ICASE(C66_2.F02 = '1','提前交期',C66_2.F02 = '2','延後交期','取消請購')+'<TD>'+TTOC(DATETIME())+ CHR(13) + CHR(10),FILE_NAME,1) 
                   ENDIF    
                ENDIF
             ENDIF
          ELSE
             SALES_B_NO=''      
          ENDIF
          ****傳送MAIL給負責業務A
 	      IF SEEK(C66_1.F11,'C01') = .T. AND EMPTY(C01.F18) = .F. AND ALLTRIM(SYS_OPER) <> ALLTRIM(C01.F18) AND  SEEK(C01.F18,'A01') = .T. AND ALLTRIM(A01.F06) = 'Y' AND AT('@',A01.F10) <> 0 AND EMPTY(MAIL_TEXT) = .F.
             SALES_A_NO=A01.F01
             IF SALES_A_NO<>SALES_B_NO
                IF OS()="Windows 5.01"
                   SEND_MAIL(ALLTRIM(INT_MAI),ALLTRIM(A01.F10),ALLTRIM(INT_DNS),'系統通知：C66.入貨異動申請單、客戶簡稱：' + IIF(SEEK(C66_2.F11,'C01'),C01.F05,C66_2.F11) + '、異動類別：' + ICASE(C66_2.F02 = '1','提前交期',C66_2.F02 = '2','延後交期','取消請購'),'TEXT',MAIL_TEXT)
                ELSE
                   IF !EMPTY(ALLTRIM(SALES_A_NO))
                      FILE_NAME=ALLTRIM(INT_DAT)+ALLTRIM(SALES_A_NO)+'.TXT'                  
                      STRTOFILE('<TR><TD>'+MAIL_TEXT+'<TD>C66.入貨異動申請單、客戶簡稱：'+IIF(SEEK(C66_2.F11,'C01'),C01.F05,C66_2.F11) + '、異動類別：' + ICASE(C66_2.F02 = '1','提前交期',C66_2.F02 = '2','延後交期','取消請購')+'<TD>'+TTOC(DATETIME())+ CHR(13) + CHR(10),FILE_NAME,1) 
                   ENDIF   
                ENDIF
             ENDIF
          ELSE
             SALES_A_NO=''      
          ENDIF
         
         
          WAIT CLEAR
		  SELECT C66ABC
		  USE   
	      SELECT C66_2
	      SKIP 
	   ENDDO
	   SELECT C66_2
	   USE
	   SELECT C66_TEMP
	   GO TOP
	   DO WHILE !EOF()
	      IF C66_TEMP.EXP_1 = 1
	         REPLACE C66_TEMP.EXP_1 WITH 0
	         REPLACE C66_TEMP.F01 WITH 1
	         REPLACE C66_TEMP.F03 WITH DATE()
	     	 SELECT C66
	     	 SET ORDER TO C661 &&F02+DTOS(F03)+F04+ALLTRIM(TRANSFORM(F05,"@R 99,999,999.99"))+F08+F10+F11+F12+F13
	     	 SEEK C66_TEMP.F02 + DTOS(C66_TEMP.F03) + C66_TEMP.F04 + ALLTRIM(TRANSFORM(C66_TEMP.F05,"@R 99,999,999.99")) + C66_TEMP.F08 + C66_TEMP.F10 + C66_TEMP.F11 + C66_TEMP.F12 + C66_TEMP.F13
		 	 IF FOUND()
		    	REPLACE C66.F01 WITH 1
		    	REPLACE C66.F03 WITH DATE()
		    	REPLACE C66.F15 WITH ''
		    	REPLACE C66.F16 WITH 0
		    	REPLACE C66.F98 WITH ''
		 	 ENDIF 
	      ENDIF
	      SELECT C66_TEMP
	      SKIP   
	   ENDDO
    ELSE
      =MESSAGEBOX('請選擇欲列印之資料!',0+64,'提示訊息視窗')
      THISFORM.GRID1.SETFOCUS 
      RETURN
    ENDIF
    SELECT C66_1
    USE
    SELECT C66_TEMP                                                                                    
    THISFORM.GRID1.SETFOCUS 
 ENDPROC 
ENDDEFINE   
**********
  DEFINE CLASS CheckBox1 AS CheckBox
      PROCEDURE CLICK
        IF THIS.VALUE=1
           REPLACE C66_TEMP.EXP_1 WITH 1
        ELSE
           REPLACE C66_TEMP.EXP_1 WITH 0      
        ENDIF
        THISFORM.GRID1.SETFOCUS     
   ENDPROC  
  ENDDEFINE 