**程式名稱:K29.沖銷明細月報表(應收)
SET EXCL OFF
CLOSE ALL
CLEAR 
AREA1='K52'
HK=''
FLG='0'
FCH=''
CHK=''
IF !USED('A01')
   SELE 0
   USE A01
ELSE 
   SELE A01
ENDIF
SET ORDER TO A01      
IF !USED('A02')
   SELE 0
   USE A02 INDE A02
ELSE
   SELE A02
ENDIF
SET ORDER TO A021      
SEEK SYS_OPER+'K29'        
IF !USED('A23')
    SELE 0
    USE A23
ELSE 
   SELE A23
ENDIF
SET ORDER TO A231 
IF !USED('C01')
   SELE 0
   USE C01 
ELSE 
   SELE C01 
ENDIF
SET ORDER TO C011
IF !USED('K5F')
   SELE 0
   USE K5F 
ELSE 
   SELE K5F 
ENDIF
SET ORDER TO K5F1
IF !USED('K51')
   SELE 0
   USE K51 
ELSE 
   SELE K51 
ENDIF
SET ORDER TO K511
K52='K52'+LEFT(DTOS(DATE()),6)   &&已沖帳款月報表檔
K521='K521'+LEFT(DTOS(DATE()),6) 
K522='K522'+LEFT(DTOS(DATE()),6) 
K523='K523'+LEFT(DTOS(DATE()),6) 
K524='K524'+LEFT(DTOS(DATE()),6) 
K525='K525'+LEFT(DTOS(DATE()),6) 
K526='K526'+LEFT(DTOS(DATE()),6) 
K527='K527'+LEFT(DTOS(DATE()),6) 
IF !USED('&K52')
   SELE 0
   USE (K52) ALIA K52 INDE (K52)
ELSE
   SELE K52
ENDIF
SET FILTER TO F14='1'
SET ORDER TO K521                
GO TOP
******************
K29FORM=CREATEOBJECT("TKK29")
K29FORM.SHOW  
DEFINE CLASS TKK29 AS FORM
  CAPTION='K29.沖銷明細月報表(應收)'
*!*	  AUTOCENTER=.T.
  CONTROLBOX=.F.
  BORDERSTYLE=1  
  MAXBUTTON=.F.
  MINBUTTON=.F.
  MOVABLE=.F.
  CLOSABLE=.F.
  CONTROLCOUNT=57
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*550
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WIDTH=INT_015*789
  WINDOWTYPE=1
  ADD OBJECT REC_COUNT AS REC_COUNT  WITH;
  	  LEFT=INT_015*635,;
  	  BACKCOLOR=RGB(255,255,0),;
      TOP=INT_015*6
 ADD OBJECT KEY_LIST AS KEY_LIST WITH;
      AUTOCENTER=.T.,;
      WIDTH=INT_015*140
  ADD OBJECT MTH_LIST AS MTH_LIST WITH;
      LEFT=INT_015*153   
  ADD OBJECT GRID1 AS GRID1 WITH;
      COLUMNCOUNT=16,;            
      RECORDSOURCE='K52',; 
      HEIGHT=INT_015*500,;     
      WIDTH=INT_015*780,;      
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;
      COLUMN3.NAME='COLUMN3',; 
      COLUMN4.NAME='COLUMN4',; 
      COLUMN5.NAME='COLUMN5',;             
      COLUMN6.NAME='COLUMN6',;       
      COLUMN7.NAME='COLUMN7',;       
      COLUMN8.NAME='COLUMN8',;
      COLUMN9.NAME='COLUMN9',;
      COLUMN10.NAME='COLUMN10',;
      COLUMN11.NAME='COLUMN11',;
      COLUMN12.NAME='COLUMN12',;
      COLUMN13.NAME='COLUMN13',;
      COLUMN14.NAME='COLUMN14',;
      COLUMN15.NAME='COLUMN15',;
      COLUMN16.NAME='COLUMN16'
  ADD OBJECT ORPGROUP AS ORPGROUP WITH;      
      TOP=INT_015*0,;
      LEFT=INT_015*410             
  ADD OBJECT CMDGROUP AS CMDGROUP WITH;
      TOP=INT_015*0,;
      LEFT=INT_015*235,;
      ENABLED=.T.,;
      VISIBLE=.T.           
   ADD OBJECT RECLAIM_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*5,;
      LEFT=INT_015*458,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*80,;
      FONTSIZE=INT_015*9,;
      CAPTION='\<R.帳款回收率'           
**************************                                    
  PROCEDURE INIT
  HK=ALLTRIM(THISFORM.MTH_LIST.DISPLAYVALUE)
       SELECT  K52
       CALC SUM(F04) TO TOTAL_CNT
       GO TOP
       THISFORM.REC_COUNT.CAPTION=ALLTRIM('已沖銷金額：'+ALLTRIM(TRANSFORM(ROUND(TOTAL_CNT,2),'@R 999,999,999,999.99')))
       THISFORM.ORPGROUP.NEW_BOTT.VISIBLE=.F.
       THISFORM.ORPGROUP.EDIT_BOTT.VISIBLE=.F.
       THISFORM.ORPGROUP.DEL_BOTT.VISIBLE=.F.
       THISFORM.SETALL('READONLY',.T.,'TEXTBOX') 
       THISFORM.GRID1.LOCKCOLUMNS=3
       THISFORM.GRID1.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'COLUMN')
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'HEADER')
       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*30
       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*55
       THISFORM.GRID1.COLUMN3.WIDTH=INT_015*60
       THISFORM.GRID1.COLUMN4.WIDTH=INT_015*80
       THISFORM.GRID1.COLUMN5.WIDTH=INT_015*70
       THISFORM.GRID1.COLUMN6.WIDTH=INT_015*65
       THISFORM.GRID1.COLUMN7.WIDTH=INT_015*75
       THISFORM.GRID1.COLUMN8.WIDTH=INT_015*75
       THISFORM.GRID1.COLUMN9.WIDTH=INT_015*65
       THISFORM.GRID1.COLUMN10.WIDTH=INT_015*100
       THISFORM.GRID1.COLUMN11.WIDTH=INT_015*55
       THISFORM.GRID1.COLUMN12.WIDTH=INT_015*55
       THISFORM.GRID1.COLUMN13.WIDTH=INT_015*55
       THISFORM.GRID1.COLUMN14.WIDTH=INT_015*55
       THISFORM.GRID1.COLUMN15.WIDTH=INT_015*130
       THISFORM.GRID1.COLUMN16.WIDTH=INT_015*100
           THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='日期'
	   THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='對象編號'
	   THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='對象簡稱'
	   THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='發票號碼'
	   THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='沖銷金額'	
	   THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='發票日期'   
  	   THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='傳票單號'
  	   THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='憑證單號'
  	   THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='應收款日'  	  
  	   THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='收款方式' 
  	   THISFORM.GRID1.COLUMN11.HEADER1.CAPTION='業務編號' 
  	   THISFORM.GRID1.COLUMN12.HEADER1.CAPTION='業務姓名' 
  	   THISFORM.GRID1.COLUMN13.HEADER1.CAPTION='業助編號' 	  
  	   THISFORM.GRID1.COLUMN14.HEADER1.CAPTION='業助姓名' 
  	   THISFORM.GRID1.COLUMN15.HEADER1.CAPTION='備        註'
  	   THISFORM.GRID1.COLUMN16.HEADER1.CAPTION='安全資料'
	   THISFORM.GRID1.COLUMN1.CONTROLSOURCE='K52.F01'
	   THISFORM.GRID1.COLUMN2.CONTROLSOURCE='K52.F02'
	   THISFORM.GRID1.COLUMN3.CONTROLSOURCE='K52.F09'
	   THISFORM.GRID1.COLUMN4.CONTROLSOURCE='K52.F03'
	   THISFORM.GRID1.COLUMN5.CONTROLSOURCE='K52.F04'
	   THISFORM.GRID1.COLUMN6.CONTROLSOURCE='K52.F05'
	   THISFORM.GRID1.COLUMN7.CONTROLSOURCE='K52.F06'
	   THISFORM.GRID1.COLUMN8.CONTROLSOURCE='K52.F07'
	   THISFORM.GRID1.COLUMN9.CONTROLSOURCE='K52.F10'
	   THISFORM.GRID1.COLUMN10.CONTROLSOURCE='K52.F11'
	   THISFORM.GRID1.COLUMN11.CONTROLSOURCE='K52.F12'
	   THISFORM.GRID1.COLUMN12.CONTROLSOURCE="IIF(SEEK(K52.F12,'A01'),A01.F03,'')"
	   THISFORM.GRID1.COLUMN13.CONTROLSOURCE='K52.F13'
	   THISFORM.GRID1.COLUMN14.CONTROLSOURCE="IIF(SEEK(K52.F13,'A01'),A01.F03,'')"
  	   THISFORM.GRID1.COLUMN15.CONTROLSOURCE='K52.F08'
  	   THISFORM.GRID1.COLUMN16.CONTROLSOURCE='K52.F15'
  	   THISFORM.GRID1.READONLY=.T.       
       THISFORM.GRID1.SETFOCUS        
       IF THISFORM.GRID1.ACTIVEROW=0
           THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
	   THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
	   THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
	   THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.    
	   THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.	    
	   THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F. 	
           THISFORM.RECLAIM_BOTT.ENABLED=.F.        	   
       ELSE
           THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
	   THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
	   THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
	   THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.    
	   THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.	      
           THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限    
           THISFORM.RECLAIM_BOTT.ENABLED=IIF(A02.F08='*',.T.,.F.)   &&判斷有無列印帳款回收率的權限  
       ENDIF       
       JK='日期'
  ENDPROC     
*****************  
  PROC KEY_LIST.INIT 
       WITH THIS 
           .ADDITEM('依  日期   排列')
           .ADDITEM('依對象編號+日期排列')
           .ADDITEM('依對象簡稱+日期排列')
           .ADDITEM('依發票號碼+日期排列')           
           .ADDITEM('依傳票單號+日期排列')        
           .ADDITEM('依業務編號+日期排列') 
           .ADDITEM('依業助編號+日期排列') 
       ENDWITH      
  ENDPROC 
****************  
  PROC KEY_LIST.INTERACTIVECHANGE                 
   SELE K52
   DO CASE
       CASE THIS.DISPLAYVALUE='依  日期   排列'
                   SET ORDER TO K521
	           THISFORM.GRID1.COLUMN1.WIDTH=INT_015*30
	           THISFORM.GRID1.COLUMN2.WIDTH=INT_015*55
	           THISFORM.GRID1.COLUMN3.WIDTH=INT_015*60
	           THISFORM.GRID1.COLUMN4.WIDTH=INT_015*80
	           THISFORM.GRID1.COLUMN5.WIDTH=INT_015*70
	           THISFORM.GRID1.COLUMN6.WIDTH=INT_015*65
	           THISFORM.GRID1.COLUMN7.WIDTH=INT_015*75
	           THISFORM.GRID1.COLUMN8.WIDTH=INT_015*75
	           THISFORM.GRID1.COLUMN9.WIDTH=INT_015*65
	           THISFORM.GRID1.COLUMN10.WIDTH=INT_015*100
	           THISFORM.GRID1.COLUMN11.WIDTH=INT_015*55
	           THISFORM.GRID1.COLUMN12.WIDTH=INT_015*55
	           THISFORM.GRID1.COLUMN13.WIDTH=INT_015*55
	           THISFORM.GRID1.COLUMN14.WIDTH=INT_015*55
	           THISFORM.GRID1.COLUMN15.WIDTH=INT_015*130
	           THISFORM.GRID1.COLUMN16.WIDTH=INT_015*100
	           THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='日期'
		   THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='對象編號'
		   THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='對象簡稱'
		   THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='發票號碼'
		   THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='沖銷金額'	
		   THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='發票日期'   
	  	   THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='傳票單號'
	  	   THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='憑證單號'
	  	   THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='應收款日'  	  
	  	   THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='收款方式' 
	  	   THISFORM.GRID1.COLUMN11.HEADER1.CAPTION='業務編號' 
	  	   THISFORM.GRID1.COLUMN12.HEADER1.CAPTION='業務姓名' 
	  	   THISFORM.GRID1.COLUMN13.HEADER1.CAPTION='業助編號' 	  
	  	   THISFORM.GRID1.COLUMN14.HEADER1.CAPTION='業助姓名' 
	  	   THISFORM.GRID1.COLUMN15.HEADER1.CAPTION='備        註'
	  	   THISFORM.GRID1.COLUMN16.HEADER1.CAPTION='安全資料'
		   THISFORM.GRID1.COLUMN1.CONTROLSOURCE='K52.F01'
		   THISFORM.GRID1.COLUMN2.CONTROLSOURCE='K52.F02'
		   THISFORM.GRID1.COLUMN3.CONTROLSOURCE='K52.F09'
		   THISFORM.GRID1.COLUMN4.CONTROLSOURCE='K52.F03'
		   THISFORM.GRID1.COLUMN5.CONTROLSOURCE='K52.F04'
		   THISFORM.GRID1.COLUMN6.CONTROLSOURCE='K52.F05'
		   THISFORM.GRID1.COLUMN7.CONTROLSOURCE='K52.F06'
		   THISFORM.GRID1.COLUMN8.CONTROLSOURCE='K52.F07'
		   THISFORM.GRID1.COLUMN9.CONTROLSOURCE='K52.F10'
		   THISFORM.GRID1.COLUMN10.CONTROLSOURCE='K52.F11'
		   THISFORM.GRID1.COLUMN11.CONTROLSOURCE='K52.F12'
		   THISFORM.GRID1.COLUMN12.CONTROLSOURCE="IIF(SEEK(K52.F12,'A01'),A01.F03,'')"
		   THISFORM.GRID1.COLUMN13.CONTROLSOURCE='K52.F13'
		   THISFORM.GRID1.COLUMN14.CONTROLSOURCE="IIF(SEEK(K52.F13,'A01'),A01.F03,'')"
	  	   THISFORM.GRID1.COLUMN15.CONTROLSOURCE='K52.F08'
	  	   THISFORM.GRID1.COLUMN16.CONTROLSOURCE='K52.F15'          
      CASE THIS.DISPLAYVALUE='依對象編號+日期排列'
          	   SET ORDER TO K522
	           THISFORM.GRID1.COLUMN1.WIDTH=INT_015*55
	           THISFORM.GRID1.COLUMN2.WIDTH=INT_015*60          	   
	           THISFORM.GRID1.COLUMN3.WIDTH=INT_015*30
	           THISFORM.GRID1.COLUMN4.WIDTH=INT_015*80
	           THISFORM.GRID1.COLUMN5.WIDTH=INT_015*70
	           THISFORM.GRID1.COLUMN6.WIDTH=INT_015*65
	           THISFORM.GRID1.COLUMN7.WIDTH=INT_015*75
	           THISFORM.GRID1.COLUMN8.WIDTH=INT_015*75
	           THISFORM.GRID1.COLUMN9.WIDTH=INT_015*65
	           THISFORM.GRID1.COLUMN10.WIDTH=INT_015*100
	           THISFORM.GRID1.COLUMN11.WIDTH=INT_015*55
	           THISFORM.GRID1.COLUMN12.WIDTH=INT_015*55
	           THISFORM.GRID1.COLUMN13.WIDTH=INT_015*55
	           THISFORM.GRID1.COLUMN14.WIDTH=INT_015*55
	           THISFORM.GRID1.COLUMN15.WIDTH=INT_015*130
	           THISFORM.GRID1.COLUMN16.WIDTH=INT_015*100
		   THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='對象編號'
		   THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='對象簡稱'	           
	           THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='日期'
		   THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='發票號碼'
		   THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='沖銷金額'	
		   THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='發票日期'   
	  	   THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='傳票單號'
	  	   THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='憑證單號'
	  	   THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='應收款日'  	  
	  	   THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='收款方式' 
	  	   THISFORM.GRID1.COLUMN11.HEADER1.CAPTION='業務編號' 
	  	   THISFORM.GRID1.COLUMN12.HEADER1.CAPTION='業務姓名' 
	  	   THISFORM.GRID1.COLUMN13.HEADER1.CAPTION='業助編號' 	  
	  	   THISFORM.GRID1.COLUMN14.HEADER1.CAPTION='業助姓名' 
	  	   THISFORM.GRID1.COLUMN15.HEADER1.CAPTION='備        註'
	  	   THISFORM.GRID1.COLUMN16.HEADER1.CAPTION='安全資料'
	  	   THISFORM.GRID1.COLUMN1.CONTROLSOURCE='K52.F02'
		   THISFORM.GRID1.COLUMN2.CONTROLSOURCE='K52.F09'
		   THISFORM.GRID1.COLUMN3.CONTROLSOURCE='K52.F01'
		   THISFORM.GRID1.COLUMN4.CONTROLSOURCE='K52.F03'
		   THISFORM.GRID1.COLUMN5.CONTROLSOURCE='K52.F04'
		   THISFORM.GRID1.COLUMN6.CONTROLSOURCE='K52.F05'
		   THISFORM.GRID1.COLUMN7.CONTROLSOURCE='K52.F06'
		   THISFORM.GRID1.COLUMN8.CONTROLSOURCE='K52.F07'
		   THISFORM.GRID1.COLUMN9.CONTROLSOURCE='K52.F10'
		   THISFORM.GRID1.COLUMN10.CONTROLSOURCE='K52.F11'
		   THISFORM.GRID1.COLUMN11.CONTROLSOURCE='K52.F12'
		   THISFORM.GRID1.COLUMN12.CONTROLSOURCE="IIF(SEEK(K52.F12,'A01'),A01.F03,'')"
		   THISFORM.GRID1.COLUMN13.CONTROLSOURCE='K52.F13'
		   THISFORM.GRID1.COLUMN14.CONTROLSOURCE="IIF(SEEK(K52.F13,'A01'),A01.F03,'')"
	  	   THISFORM.GRID1.COLUMN15.CONTROLSOURCE='K52.F08'
	  	   THISFORM.GRID1.COLUMN16.CONTROLSOURCE='K52.F15'      
  	 CASE THIS.DISPLAYVALUE='依對象簡稱+日期排列'
          	    SET ORDER TO K525
          	   THISFORM.GRID1.COLUMN1.WIDTH=INT_015*60
	           THISFORM.GRID1.COLUMN2.WIDTH=INT_015*55
      	           THISFORM.GRID1.COLUMN3.WIDTH=INT_015*30
	           THISFORM.GRID1.COLUMN4.WIDTH=INT_015*80
	           THISFORM.GRID1.COLUMN5.WIDTH=INT_015*70
	           THISFORM.GRID1.COLUMN6.WIDTH=INT_015*65
	           THISFORM.GRID1.COLUMN7.WIDTH=INT_015*75
	           THISFORM.GRID1.COLUMN8.WIDTH=INT_015*75
	           THISFORM.GRID1.COLUMN9.WIDTH=INT_015*65
	           THISFORM.GRID1.COLUMN10.WIDTH=INT_015*100
	           THISFORM.GRID1.COLUMN11.WIDTH=INT_015*55
	           THISFORM.GRID1.COLUMN12.WIDTH=INT_015*55
	           THISFORM.GRID1.COLUMN13.WIDTH=INT_015*55
	           THISFORM.GRID1.COLUMN14.WIDTH=INT_015*55
	           THISFORM.GRID1.COLUMN15.WIDTH=INT_015*130
	           THISFORM.GRID1.COLUMN16.WIDTH=INT_015*100
		   THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='對象簡稱'	 	           
		   THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='對象編號'          
	           THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='日期'
		   THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='發票號碼'
		   THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='沖銷金額'	
		   THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='發票日期'   
	  	   THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='傳票單號'
	  	   THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='憑證單號'
	  	   THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='應收款日'  	  
	  	   THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='收款方式' 
	  	   THISFORM.GRID1.COLUMN11.HEADER1.CAPTION='業務編號' 
	  	   THISFORM.GRID1.COLUMN12.HEADER1.CAPTION='業務姓名' 
	  	   THISFORM.GRID1.COLUMN13.HEADER1.CAPTION='業助編號' 	  
	  	   THISFORM.GRID1.COLUMN14.HEADER1.CAPTION='業助姓名' 
	  	   THISFORM.GRID1.COLUMN15.HEADER1.CAPTION='備        註'
	  	   THISFORM.GRID1.COLUMN16.HEADER1.CAPTION='安全資料'
		   THISFORM.GRID1.COLUMN1.CONTROLSOURCE='K52.F09'	  	   
		   THISFORM.GRID1.COLUMN2.CONTROLSOURCE='K52.F02'
		   THISFORM.GRID1.COLUMN3.CONTROLSOURCE='K52.F01'
		   THISFORM.GRID1.COLUMN4.CONTROLSOURCE='K52.F03'
		   THISFORM.GRID1.COLUMN5.CONTROLSOURCE='K52.F04'
		   THISFORM.GRID1.COLUMN6.CONTROLSOURCE='K52.F05'
		   THISFORM.GRID1.COLUMN7.CONTROLSOURCE='K52.F06'
		   THISFORM.GRID1.COLUMN8.CONTROLSOURCE='K52.F07'
		   THISFORM.GRID1.COLUMN9.CONTROLSOURCE='K52.F10'
		   THISFORM.GRID1.COLUMN10.CONTROLSOURCE='K52.F11'
		   THISFORM.GRID1.COLUMN11.CONTROLSOURCE='K52.F12'
		   THISFORM.GRID1.COLUMN12.CONTROLSOURCE="IIF(SEEK(K52.F12,'A01'),A01.F03,'')"
		   THISFORM.GRID1.COLUMN13.CONTROLSOURCE='K52.F13'
		   THISFORM.GRID1.COLUMN14.CONTROLSOURCE="IIF(SEEK(K52.F13,'A01'),A01.F03,'')"
	  	   THISFORM.GRID1.COLUMN15.CONTROLSOURCE='K52.F08'
	  	   THISFORM.GRID1.COLUMN16.CONTROLSOURCE='K52.F15'      
      CASE THIS.DISPLAYVALUE='依發票號碼+日期排列'
                   SET ORDER TO K523
                   THISFORM.GRID1.COLUMN1.WIDTH=INT_015*80
	           THISFORM.GRID1.COLUMN2.WIDTH=INT_015*30
	           THISFORM.GRID1.COLUMN3.WIDTH=INT_015*55
	           THISFORM.GRID1.COLUMN4.WIDTH=INT_015*60 
	           THISFORM.GRID1.COLUMN5.WIDTH=INT_015*70
	           THISFORM.GRID1.COLUMN6.WIDTH=INT_015*65
	           THISFORM.GRID1.COLUMN7.WIDTH=INT_015*75
	           THISFORM.GRID1.COLUMN8.WIDTH=INT_015*75
	           THISFORM.GRID1.COLUMN9.WIDTH=INT_015*65
	           THISFORM.GRID1.COLUMN10.WIDTH=INT_015*100
	           THISFORM.GRID1.COLUMN11.WIDTH=INT_015*55
	           THISFORM.GRID1.COLUMN12.WIDTH=INT_015*55
	           THISFORM.GRID1.COLUMN13.WIDTH=INT_015*55
	           THISFORM.GRID1.COLUMN14.WIDTH=INT_015*55
	           THISFORM.GRID1.COLUMN15.WIDTH=INT_015*130
	           THISFORM.GRID1.COLUMN16.WIDTH=INT_015*100
		   THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='發票號碼'	           
	           THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='日期'
		   THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='對象編號'
		   THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='對象簡稱'
		   THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='沖銷金額'	
		   THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='發票日期'   
	  	   THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='傳票單號'
	  	   THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='憑證單號'
	  	   THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='應收款日'  	  
	  	   THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='收款方式' 
	  	   THISFORM.GRID1.COLUMN11.HEADER1.CAPTION='業務編號' 
	  	   THISFORM.GRID1.COLUMN12.HEADER1.CAPTION='業務姓名' 
	  	   THISFORM.GRID1.COLUMN13.HEADER1.CAPTION='業助編號' 	  
	  	   THISFORM.GRID1.COLUMN14.HEADER1.CAPTION='業助姓名' 
	  	   THISFORM.GRID1.COLUMN15.HEADER1.CAPTION='備        註'
	  	   THISFORM.GRID1.COLUMN16.HEADER1.CAPTION='安全資料'
	  	   THISFORM.GRID1.COLUMN1.CONTROLSOURCE='K52.F03'
		   THISFORM.GRID1.COLUMN2.CONTROLSOURCE='K52.F01'
		   THISFORM.GRID1.COLUMN3.CONTROLSOURCE='K52.F02'
		   THISFORM.GRID1.COLUMN4.CONTROLSOURCE='K52.F09'
		   THISFORM.GRID1.COLUMN5.CONTROLSOURCE='K52.F04'
		   THISFORM.GRID1.COLUMN6.CONTROLSOURCE='K52.F05'
		   THISFORM.GRID1.COLUMN7.CONTROLSOURCE='K52.F06'
		   THISFORM.GRID1.COLUMN8.CONTROLSOURCE='K52.F07'
		   THISFORM.GRID1.COLUMN9.CONTROLSOURCE='K52.F10'
		   THISFORM.GRID1.COLUMN10.CONTROLSOURCE='K52.F11'
		   THISFORM.GRID1.COLUMN11.CONTROLSOURCE='K52.F12'
		   THISFORM.GRID1.COLUMN12.CONTROLSOURCE="IIF(SEEK(K52.F12,'A01'),A01.F03,'')"
		   THISFORM.GRID1.COLUMN13.CONTROLSOURCE='K52.F13'
		   THISFORM.GRID1.COLUMN14.CONTROLSOURCE="IIF(SEEK(K52.F13,'A01'),A01.F03,'')"
	  	   THISFORM.GRID1.COLUMN15.CONTROLSOURCE='K52.F08'
	  	   THISFORM.GRID1.COLUMN16.CONTROLSOURCE='K52.F15'            
      CASE THIS.DISPLAYVALUE='依傳票單號+日期排列'
                   SET ORDER TO K524
                   THISFORM.GRID1.COLUMN1.WIDTH=INT_015*75
      	           THISFORM.GRID1.COLUMN2.WIDTH=INT_015*30
	           THISFORM.GRID1.COLUMN3.WIDTH=INT_015*55
	           THISFORM.GRID1.COLUMN4.WIDTH=INT_015*60
	           THISFORM.GRID1.COLUMN5.WIDTH=INT_015*80
	           THISFORM.GRID1.COLUMN6.WIDTH=INT_015*70
	           THISFORM.GRID1.COLUMN7.WIDTH=INT_015*65
	           THISFORM.GRID1.COLUMN8.WIDTH=INT_015*75
	           THISFORM.GRID1.COLUMN9.WIDTH=INT_015*65
	           THISFORM.GRID1.COLUMN10.WIDTH=INT_015*100
	           THISFORM.GRID1.COLUMN11.WIDTH=INT_015*55
	           THISFORM.GRID1.COLUMN12.WIDTH=INT_015*55
	           THISFORM.GRID1.COLUMN13.WIDTH=INT_015*55
	           THISFORM.GRID1.COLUMN14.WIDTH=INT_015*55
	           THISFORM.GRID1.COLUMN15.WIDTH=INT_015*130
	           THISFORM.GRID1.COLUMN16.WIDTH=INT_015*100
	           THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='傳票單號'
	           THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='日期'
		   THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='對象編號'
		   THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='對象簡稱'
		   THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='發票號碼'
		   THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='沖銷金額'	
		   THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='發票日期'   
	  	   THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='憑證單號'
	  	   THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='應收款日'  	  
	  	   THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='收款方式' 
	  	   THISFORM.GRID1.COLUMN11.HEADER1.CAPTION='業務編號' 
	  	   THISFORM.GRID1.COLUMN12.HEADER1.CAPTION='業務姓名' 
	  	   THISFORM.GRID1.COLUMN13.HEADER1.CAPTION='業助編號' 	  
	  	   THISFORM.GRID1.COLUMN14.HEADER1.CAPTION='業助姓名' 
	  	   THISFORM.GRID1.COLUMN15.HEADER1.CAPTION='備        註'
	  	   THISFORM.GRID1.COLUMN16.HEADER1.CAPTION='安全資料'
	  	   THISFORM.GRID1.COLUMN1.CONTROLSOURCE='K52.F06'
		   THISFORM.GRID1.COLUMN2.CONTROLSOURCE='K52.F01'
		   THISFORM.GRID1.COLUMN3.CONTROLSOURCE='K52.F02'
		   THISFORM.GRID1.COLUMN4.CONTROLSOURCE='K52.F09'
		   THISFORM.GRID1.COLUMN5.CONTROLSOURCE='K52.F03'
		   THISFORM.GRID1.COLUMN6.CONTROLSOURCE='K52.F04'
		   THISFORM.GRID1.COLUMN7.CONTROLSOURCE='K52.F05'		  
		   THISFORM.GRID1.COLUMN8.CONTROLSOURCE='K52.F07'
		   THISFORM.GRID1.COLUMN9.CONTROLSOURCE='K52.F10'
		   THISFORM.GRID1.COLUMN10.CONTROLSOURCE='K52.F11'
		   THISFORM.GRID1.COLUMN11.CONTROLSOURCE='K52.F12'
		   THISFORM.GRID1.COLUMN12.CONTROLSOURCE="IIF(SEEK(K52.F12,'A01'),A01.F03,'')"
		   THISFORM.GRID1.COLUMN13.CONTROLSOURCE='K52.F13'
		   THISFORM.GRID1.COLUMN14.CONTROLSOURCE="IIF(SEEK(K52.F13,'A01'),A01.F03,'')"
	  	   THISFORM.GRID1.COLUMN15.CONTROLSOURCE='K52.F08'
	  	   THISFORM.GRID1.COLUMN16.CONTROLSOURCE='K52.F15'         
      CASE THIS.DISPLAYVALUE='依業務編號+日期排列'
                   SET ORDER TO K526
                   THISFORM.GRID1.COLUMN1.WIDTH=INT_015*55
	           THISFORM.GRID1.COLUMN2.WIDTH=INT_015*55
      	           THISFORM.GRID1.COLUMN3.WIDTH=INT_015*30
	           THISFORM.GRID1.COLUMN4.WIDTH=INT_015*55
	           THISFORM.GRID1.COLUMN5.WIDTH=INT_015*60
	           THISFORM.GRID1.COLUMN6.WIDTH=INT_015*80
	           THISFORM.GRID1.COLUMN7.WIDTH=INT_015*70
	           THISFORM.GRID1.COLUMN8.WIDTH=INT_015*65
	           THISFORM.GRID1.COLUMN9.WIDTH=INT_015*75
	           THISFORM.GRID1.COLUMN10.WIDTH=INT_015*75
	           THISFORM.GRID1.COLUMN11.WIDTH=INT_015*65
	           THISFORM.GRID1.COLUMN12.WIDTH=INT_015*100
	           THISFORM.GRID1.COLUMN13.WIDTH=INT_015*55
	           THISFORM.GRID1.COLUMN14.WIDTH=INT_015*55
	           THISFORM.GRID1.COLUMN15.WIDTH=INT_015*130
	           THISFORM.GRID1.COLUMN16.WIDTH=INT_015*100
	  	   THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='業務編號' 
	  	   THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='業務姓名' 	           
	           THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='日期'
		   THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='對象編號'
		   THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='對象簡稱'
		   THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='發票號碼'
		   THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='沖銷金額'	
		   THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='發票日期'   
	  	   THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='傳票單號'
	  	   THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='憑證單號'
	  	   THISFORM.GRID1.COLUMN11.HEADER1.CAPTION='應收款日'  	  
	  	   THISFORM.GRID1.COLUMN12.HEADER1.CAPTION='收款方式' 
	  	   THISFORM.GRID1.COLUMN13.HEADER1.CAPTION='業助編號' 	  
	  	   THISFORM.GRID1.COLUMN14.HEADER1.CAPTION='業助姓名' 
	  	   THISFORM.GRID1.COLUMN15.HEADER1.CAPTION='備        註'
	  	   THISFORM.GRID1.COLUMN16.HEADER1.CAPTION='安全資料'
		   THISFORM.GRID1.COLUMN1.CONTROLSOURCE='K52.F12'	
		   THISFORM.GRID1.COLUMN2.CONTROLSOURCE="IIF(SEEK(K52.F12,'A01'),A01.F03,'')"  	   
		   THISFORM.GRID1.COLUMN3.CONTROLSOURCE='K52.F01'
		   THISFORM.GRID1.COLUMN4.CONTROLSOURCE='K52.F02'
		   THISFORM.GRID1.COLUMN5.CONTROLSOURCE='K52.F09'
		   THISFORM.GRID1.COLUMN6.CONTROLSOURCE='K52.F03'
		   THISFORM.GRID1.COLUMN7.CONTROLSOURCE='K52.F04'
		   THISFORM.GRID1.COLUMN8.CONTROLSOURCE='K52.F05'
		   THISFORM.GRID1.COLUMN9.CONTROLSOURCE='K52.F06'
		   THISFORM.GRID1.COLUMN10.CONTROLSOURCE='K52.F07'
		   THISFORM.GRID1.COLUMN11.CONTROLSOURCE='K52.F10'
		   THISFORM.GRID1.COLUMN12.CONTROLSOURCE='K52.F11'
		   THISFORM.GRID1.COLUMN13.CONTROLSOURCE='K52.F13'
		   THISFORM.GRID1.COLUMN14.CONTROLSOURCE="IIF(SEEK(K52.F13,'A01'),A01.F03,'')"
	  	   THISFORM.GRID1.COLUMN15.CONTROLSOURCE='K52.F08'
	  	   THISFORM.GRID1.COLUMN16.CONTROLSOURCE='K52.F15'      
      CASE THIS.DISPLAYVALUE='依業助編號+日期排列'
                   SET ORDER TO K527
	           THISFORM.GRID1.COLUMN1.WIDTH=INT_015*55
	           THISFORM.GRID1.COLUMN2.WIDTH=INT_015*55                   
      	           THISFORM.GRID1.COLUMN3.WIDTH=INT_015*30
	           THISFORM.GRID1.COLUMN4.WIDTH=INT_015*55
	           THISFORM.GRID1.COLUMN5.WIDTH=INT_015*60
	           THISFORM.GRID1.COLUMN6.WIDTH=INT_015*80
	           THISFORM.GRID1.COLUMN7.WIDTH=INT_015*70
	           THISFORM.GRID1.COLUMN8.WIDTH=INT_015*65
	           THISFORM.GRID1.COLUMN9.WIDTH=INT_015*75
	           THISFORM.GRID1.COLUMN10.WIDTH=INT_015*75
	           THISFORM.GRID1.COLUMN11.WIDTH=INT_015*65
	           THISFORM.GRID1.COLUMN12.WIDTH=INT_015*100
	           THISFORM.GRID1.COLUMN13.WIDTH=INT_015*55
	           THISFORM.GRID1.COLUMN14.WIDTH=INT_015*55
	           THISFORM.GRID1.COLUMN15.WIDTH=INT_015*130
	           THISFORM.GRID1.COLUMN16.WIDTH=INT_015*100
	  	   THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='業助編號' 	  
	  	   THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='業助姓名' 	           
	           THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='日期'
		   THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='對象編號'
		   THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='對象簡稱'
		   THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='發票號碼'
		   THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='沖銷金額'	
		   THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='發票日期'   
	  	   THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='傳票單號'
	  	   THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='憑證單號'
	  	   THISFORM.GRID1.COLUMN11.HEADER1.CAPTION='應收款日'  	  
	  	   THISFORM.GRID1.COLUMN12.HEADER1.CAPTION='收款方式' 
	  	   THISFORM.GRID1.COLUMN13.HEADER1.CAPTION='業務編號' 
	  	   THISFORM.GRID1.COLUMN14.HEADER1.CAPTION='業務姓名' 
	  	   THISFORM.GRID1.COLUMN15.HEADER1.CAPTION='備        註'
	  	   THISFORM.GRID1.COLUMN16.HEADER1.CAPTION='安全資料'
		   THISFORM.GRID1.COLUMN1.CONTROLSOURCE='K52.F13'
		   THISFORM.GRID1.COLUMN2.CONTROLSOURCE="IIF(SEEK(K52.F13,'A01'),A01.F03,'')"	  	   
		   THISFORM.GRID1.COLUMN3.CONTROLSOURCE='K52.F01'
		   THISFORM.GRID1.COLUMN4.CONTROLSOURCE='K52.F02'
		   THISFORM.GRID1.COLUMN5.CONTROLSOURCE='K52.F09'
		   THISFORM.GRID1.COLUMN6.CONTROLSOURCE='K52.F03'
		   THISFORM.GRID1.COLUMN7.CONTROLSOURCE='K52.F04'
		   THISFORM.GRID1.COLUMN8.CONTROLSOURCE='K52.F05'
		   THISFORM.GRID1.COLUMN9.CONTROLSOURCE='K52.F06'
		   THISFORM.GRID1.COLUMN10.CONTROLSOURCE='K52.F07'
		   THISFORM.GRID1.COLUMN11.CONTROLSOURCE='K52.F10'
		   THISFORM.GRID1.COLUMN12.CONTROLSOURCE='K52.F11'
		   THISFORM.GRID1.COLUMN13.CONTROLSOURCE='K52.F12'
		   THISFORM.GRID1.COLUMN14.CONTROLSOURCE="IIF(SEEK(K52.F12,'A01'),A01.F03,'')"
	  	   THISFORM.GRID1.COLUMN15.CONTROLSOURCE='K52.F08'
	  	   THISFORM.GRID1.COLUMN16.CONTROLSOURCE='K52.F15'      	  	   	  	                                                                              
   ENDCASE 
       JK=THISFORM.GRID1.COLUMN1.HEADER1.CAPTION
       THISFORM.GRID1.REFRESH
       THISFORM.GRID1.SETFOCUS
  ENDPROC 
********************                 
  PROC GRID1.AFTERROWCOLCHANGE
       LPARAMETERS NCOLINDEX
       FCH=THISFORM.ACTIVECONTROL.NAME
       CHK=''
       THISFORM.REFRESH
  ENDPROC
*****************
 PROC MTH_LIST.INTERACTIVECHANGE
       HK=ALLTRIM(THISFORM.MTH_LIST.DISPLAYVALUE)
       THISFORM.GRID1.RECORDSOURCE=''
       SELE K52
       USE
       K52='K52'+LEFT(DTOS(CTOD(THIS.DISPLAYVALUE+'/01')),6)
       K521='K521'+LEFT(DTOS(CTOD(THIS.DISPLAYVALUE+'/01')),6)
       K522='K522'+LEFT(DTOS(CTOD(THIS.DISPLAYVALUE+'/01')),6)
       K523='K523'+LEFT(DTOS(CTOD(THIS.DISPLAYVALUE+'/01')),6)
       K524='K524'+LEFT(DTOS(CTOD(THIS.DISPLAYVALUE+'/01')),6)
       K525='K525'+LEFT(DTOS(CTOD(THIS.DISPLAYVALUE+'/01')),6)
       K526='K526'+LEFT(DTOS(CTOD(THIS.DISPLAYVALUE+'/01')),6)
       K527='K527'+LEFT(DTOS(CTOD(THIS.DISPLAYVALUE+'/01')),6)
       IF !USED('&K52')
          SELE 0
          USE (K52) ALIA K52
       ELSE
          SELE K52
       ENDIF
       SET FILTER TO F14='1'
       SET ORDER TO K521 
       SELECT  K52
       CALC SUM(F04) TO TOTAL_CNT
       THISFORM.REC_COUNT.CAPTION=ALLTRIM('已沖銷金額：'+ALLTRIM(TRANSFORM(ROUND(TOTAL_CNT,2),'@R 999,999,999,999.99')))
       GO TOP
       THISFORM.GRID1.RECORDSOURCE='K52'
       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='K52.F01'
       THISFORM.GRID1.COLUMN2.CONTROLSOURCE='K52.F02'
       THISFORM.GRID1.COLUMN3.CONTROLSOURCE='K52.F09'
       THISFORM.GRID1.COLUMN4.CONTROLSOURCE='K52.F03'
       THISFORM.GRID1.COLUMN5.CONTROLSOURCE='K52.F04'
       THISFORM.GRID1.COLUMN6.CONTROLSOURCE='K52.F05'
       THISFORM.GRID1.COLUMN7.CONTROLSOURCE='K52.F06'
       THISFORM.GRID1.COLUMN8.CONTROLSOURCE='K52.F07'
       THISFORM.GRID1.COLUMN9.CONTROLSOURCE='K52.F10'
       THISFORM.GRID1.COLUMN10.CONTROLSOURCE='K52.F11'
       THISFORM.GRID1.COLUMN11.CONTROLSOURCE='K52.F12'
       THISFORM.GRID1.COLUMN12.CONTROLSOURCE="IIF(SEEK(K52.F12,'A01'),A01.F03,'')"
       THISFORM.GRID1.COLUMN13.CONTROLSOURCE='K52.F13'
       THISFORM.GRID1.COLUMN14.CONTROLSOURCE="IIF(SEEK(K52.F13,'A01'),A01.F03,'')"
       THISFORM.GRID1.COLUMN15.CONTROLSOURCE='K52.F08'
       THISFORM.GRID1.COLUMN16.CONTROLSOURCE='K52.F15'           
       THISFORM.KEY_LIST.INTERACTIVECHANGE
       THISFORM.GRID1.SETFOCUS        
       THISFORM.REFRESH
       IF THISFORM.GRID1.ACTIVEROW=0
           THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
	   THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
	   THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
	   THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.    
	   THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.	    
	   THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F. 	
           THISFORM.RECLAIM_BOTT.ENABLED=.F.        	   
       ELSE
           THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
	   THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
	   THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
	   THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.    
	   THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.	      
           THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限    
           THISFORM.RECLAIM_BOTT.ENABLED=IIF(A02.F08='*',.T.,.F.)   &&判斷有無列印帳款回收率的權限  
       ENDIF         
  ENDPROC       
****************帳款回收率      
  PROCEDURE RECLAIM_BOTT.CLICK
    	SELE K52
   	ANS_CHK=CREATEOBJECT("ANS_CHK")  
   	ANS_CHK.SHOW
   	THISFORM.GRID1.SETFOCUS 
 ENDPROC         
ENDDEFINE
********************************************************
DEFINE CLASS ANS_CHK AS FORM
  AUTOCENTER=.T.
  CAPTION='請選擇列印內容'
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*110
  WIDTH=INT_015*245
  FONTSIZE=INT_015*9
  CONTROLBOX=.F.
  BORDERSTYLE=2
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WINDOWTYPE=1
  NAME='ANS_CHK'
ADD OBJECT DATA_OPTION AS OPTIONGROUP WITH;
      LEFT=INT_015*17,;
      TOP=INT_015*20,;
      AUTOSIZE=.T.,;
      FONTSIZE=INT_015*12,;
      BUTTONCOUNT=3,;
      OPTION1.CAPTION='對象別帳款回收率',;
      OPTION1.TOP=INT_015*0,;
      OPTION1.FONTSIZE=INT_015*9,;
      OPTION1.AUTOSIZE=.T.,;
      OPTION2.CAPTION='業務員別帳款回收率',;
      OPTION2.TOP=INT_015*20,;
      OPTION2.FONTSIZE=INT_015*9,;
      OPTION2.AUTOSIZE=.T.,;      
      OPTION3.CAPTION='業務助理別帳款回收率',;
      OPTION3.TOP=INT_015*40,;
      OPTION3.FONTSIZE=INT_015*9,;
      OPTION3.AUTOSIZE=.T.,;
      NAME='DATA_OPTION'   
  ADD OBJECT CMND1 AS COMMANDBUTTON WITH;
      LEFT=INT_015*175,;     
      TOP=INT_015*23,;  
      HEIGHT=INT_015*25,;    
      WIDTH=INT_015*50,;
       FONTSIZE=INT_015*10,;
      CAPTION='\<Y.確定',;
      TOOLTIPTEXT='確認所選擇的鍵值!快速鍵->ALT+Y',;
      NAME='CMND1'
  ADD OBJECT CMND2 AS COMMANDBUTTON WITH;
      LEFT=INT_015*175,;
      TOP=INT_015*61,;
      HEIGHT=INT_015*25,;    
      WIDTH=INT_015*50,;
      FONTSIZE=INT_015*10,;
      CAPTION='\<C.取消',;
      TOOLTIPTEXT='取消作業!快速鍵->ALT+C',;
      NAME='CMND2'     
  *****    
 PROCEDURE CMND1.CLICK     
    SUM_F05=0  &&已收帳款金額總計
    SUM_F06=0  &&應收帳款金額總計
    SUM_F07=0  &&帳款回收率
    DO CASE
  	  CASE THISFORM.DATA_OPTION.VALUE=1   &&依對象別
		    CREATE CURSOR K52_TEMP;
		    (F01 C(5),F02 C(8),F03 C(8),F04 C(8),F05 N(14,2),F06 N(14,2),F07 N(7,3))
		    INDE ON F01 TAG K52_TEMP1
	     	    SET ORDER TO K52_TEMP1
	     	    ***已收帳款
		    SELECT K5F.F02,K5F.F12,K5F.F13,SUM(K5F.F04) FROM K5F WHERE K5F.F14='1'  .AND.  LEFT(DTOS(K5F.F10),6)=LEFT(DTOS(CTOD(HK+'/01')),6) ORDER BY K5F.F02 GROUP BY K5F.F02 INTO CURSOR K5FA
		    SELECT K5FA
		    GO TOP
		    DO WHILE !EOF()
			   SELECT K52_TEMP
			   APPEND BLANK
			   REPLACE K52_TEMP.F01 WITH K5FA.F02
			   REPLACE K52_TEMP.F02 WITH IIF(SEEK(K5FA.F02,'C01'),C01.F05,'') 
			   REPLACE K52_TEMP.F03 WITH IIF(SEEK(K5FA.F12,'A01'),A01.F03,'')
			   REPLACE K52_TEMP.F04 WITH IIF(SEEK(K5FA.F13,'A01'),A01.F03,'')
			   REPLACE K52_TEMP.F05 WITH K5FA.SUM_F04  &&已收帳款
			   REPLACE K52_TEMP.F06 WITH K52_TEMP.F05  &&未收帳款
			   SELECT K5FA
			   SKIP
		    ENDDO
		    SELECT K5FA
	      	    USE
	      	    ****未收帳款
*!*			    SELECT K51.F06,K51.F17,K51.F18,SUM(K51.F10) FROM K51 WHERE K51.F19='1'  .AND.  LEFT(DTOS(K51.F15),6)=LEFT(DTOS(CTOD(HK+'/01')),6) ORDER BY K51.F06 GROUP BY K51.F06 INTO CURSOR K51A
		    SELECT K51.F06,K51.F17,K51.F18,SUM(K51.F10) FROM K51 WHERE K51.F19='1'  .AND.  LEFT(DTOS(K51.F15),6)<=LEFT(DTOS(CTOD(HK+'/01')),6) ORDER BY K51.F06 GROUP BY K51.F06 INTO CURSOR K51A		    
		    SELECT K51A
		    GO TOP
		    DO WHILE !EOF()  
			   SELECT K52_TEMP
			   SEEK K51A.F06
			   IF FOUND()
			       REPLACE K52_TEMP.F06 WITH K52_TEMP.F06+K51A.SUM_F10  &&已收+未收
			   ELSE
			       SELECT K52_TEMP
			       APPEND BLANK
			       REPLACE K52_TEMP.F01 WITH K51A.F06
			       REPLACE K52_TEMP.F02 WITH IIF(SEEK(K51A.F06,'C01'),C01.F05,'') 
			       REPLACE K52_TEMP.F03 WITH IIF(SEEK(K51A.F17,'A01'),A01.F03,'')
			       REPLACE K52_TEMP.F04 WITH IIF(SEEK(K51A.F18,'A01'),A01.F03,'')
			       REPLACE K52_TEMP.F05 WITH 0
			       REPLACE K52_TEMP.F06 WITH K51A.SUM_F10
			   ENDIF
			   SELECT K51A
			   SKIP
		   ENDDO
		   SELECT K51A
		   USE		   
		   SELECT K52_TEMP
		   GO TOP
		   DO WHILE !EOF()
		          REPLACE K52_TEMP.F07 WITH IIF(K52_TEMP.F06<>0,ROUND((K52_TEMP.F05/K52_TEMP.F06)*100,3),100)
		          SUM_F05=SUM_F05+K52_TEMP.F05
		          SUM_F06=SUM_F06+K52_TEMP.F06
		          SELECT K52_TEMP
		          SKIP
		   ENDDO 
		   SUM_F07=IIF(SUM_F06=0,0,ROUND((SUM_F05/SUM_F06)*100,3))
		   SELECT K52_TEMP
		   SET ORDER TO K52_TEMP1   && F01
		   GO TOP
		   IF _TALLY >0  
		        REPORT FORM ALLTRIM(INT_116)+'K29B' TO PRINT PROMPT PREVIEW 
		   ELSE
		        =MESSAGEBOX('無資料可查詢',0+48,'警示')    
		   ENDIF 
		   SELECT K52_TEMP
		   USE		   
  	  CASE THISFORM.DATA_OPTION.VALUE=2   &&依業務員別
		    CREATE CURSOR K52_TEMP;
		    (F01 C(5),F02 C(8),F05 N(14,2),F06 N(14,2),F07 N(7,3))
		    INDE ON F01 TAG K52_TEMP1
		    INDE ON F07 TAG K52_TEMP2 DESC
	     	    SET ORDER TO K52_TEMP1
		    SELECT K5F.F12,SUM(K5F.F04) FROM K5F WHERE K5F.F14='1'  .AND.  LEFT(DTOS(K5F.F10),6)=LEFT(DTOS(CTOD(HK+'/01')),6) GROUP BY K5F.F12 ORDER BY K5F.F12  INTO CURSOR K5FA
		    SELECT K5FA
		    GO TOP
		    DO WHILE !EOF()
			   SELECT K52_TEMP
			   APPEND BLANK
			   REPLACE K52_TEMP.F01 WITH K5FA.F12
			   REPLACE K52_TEMP.F02 WITH IIF(SEEK(K5FA.F12,'A01'),A01.F03,'') 
			   REPLACE K52_TEMP.F05 WITH K5FA.SUM_F04	&&已收
			   REPLACE K52_TEMP.F06 WITH K52_TEMP.F05	&&應收
			   SELECT K5FA
			   SKIP
		    ENDDO
		    SELECT K5FA
	      	    USE
*!*				    SELECT K51.F17,SUM(K51.F10) FROM K51 WHERE K51.F19='1'  .AND.  LEFT(DTOS(K51.F15),6)=LEFT(DTOS(CTOD(HK+'/01')),6) GROUP BY K51.F17 ORDER BY K51.F17  INTO CURSOR K51A
		    SELECT K51.F17,SUM(K51.F10) FROM K51 WHERE K51.F19='1'  .AND.  LEFT(DTOS(K51.F15),6)<=LEFT(DTOS(CTOD(HK+'/01')),6) GROUP BY K51.F17 ORDER BY K51.F17  INTO CURSOR K51A
		    SELECT K51A
		    GO TOP
		    DO WHILE !EOF()  
			   SELECT K52_TEMP
			   SEEK K51A.F17
			   IF FOUND()
			       REPLACE K52_TEMP.F06 WITH K52_TEMP.F06+K51A.SUM_F10
			   ELSE
			       SELECT K52_TEMP
			       APPEND BLANK
			       REPLACE K52_TEMP.F01 WITH K51A.F17
			       REPLACE K52_TEMP.F02 WITH IIF(SEEK(K51A.F17,'A01'),A01.F03,'')
			       REPLACE K52_TEMP.F05 WITH 0
			       REPLACE K52_TEMP.F06 WITH K51A.SUM_F10
			   ENDIF
			   SELECT K51A
			   SKIP
		   ENDDO
		   SELECT K51A
		   USE		   
		   SELECT K52_TEMP
		   GO TOP
		   DO WHILE !EOF()
		          REPLACE K52_TEMP.F07 WITH IIF(K52_TEMP.F06<>0,ROUND((K52_TEMP.F05/K52_TEMP.F06)*100,3),100)
		          SUM_F05=SUM_F05+K52_TEMP.F05
		          SUM_F06=SUM_F06+K52_TEMP.F06
		          SELECT K52_TEMP
		          SKIP
		   ENDDO 		   
		   SUM_F07=IIF(SUM_F06=0,0,ROUND((SUM_F05/SUM_F06)*100,3))
		   SELECT K52_TEMP
		   SET ORDER TO K52_TEMP2   && F01
		   GO TOP
		   IF _TALLY >0  
		        REPORT FORM ALLTRIM(INT_116)+'K29C' TO PRINT PROMPT PREVIEW 
		   ELSE
		        =MESSAGEBOX('無資料可查詢',0+48,'警示')    
		   ENDIF   	  
		   SELECT K52_TEMP
		   USE		   
  	  CASE THISFORM.DATA_OPTION.VALUE=3   &&依業務助理別
		    CREATE CURSOR K52_TEMP;
		    (F01 C(5),F02 C(8),F05 N(14,2),F06 N(14,2),F07 N(7,3))
		    INDE ON F01 TAG K52_TEMP1
		    INDE ON F07 TAG K52_TEMP2 DESC
	     	    SET ORDER TO K52_TEMP1
		    SELECT K5F.F13,SUM(K5F.F04) FROM K5F WHERE K5F.F14='1'  .AND.  LEFT(DTOS(K5F.F10),6)=LEFT(DTOS(CTOD(HK+'/01')),6) ORDER BY K5F.F13 GROUP BY K5F.F13 INTO CURSOR K5FA
		    SELECT K5FA
		    GO TOP
		    DO WHILE !EOF()
			   SELECT K52_TEMP
			   APPEND BLANK
			   REPLACE K52_TEMP.F01 WITH K5FA.F13
			   REPLACE K52_TEMP.F02 WITH IIF(SEEK(K5FA.F13,'A01'),A01.F03,'') 
			   REPLACE K52_TEMP.F05 WITH K5FA.SUM_F04
			   REPLACE K52_TEMP.F06 WITH K52_TEMP.F05
			   SELECT K5FA
			   SKIP
		    ENDDO
		    SELECT K5FA
	      	    USE
*!*			    SELECT K51.F18,SUM(K51.F10) FROM K51 WHERE K51.F19='1'  .AND.  LEFT(DTOS(K51.F15),6)=LEFT(DTOS(CTOD(HK+'/01')),6) ORDER BY K51.F18 GROUP BY K51.F18 INTO CURSOR K51A
		    SELECT K51.F18,SUM(K51.F10) FROM K51 WHERE K51.F19='1'  .AND.  LEFT(DTOS(K51.F15),6)<=LEFT(DTOS(CTOD(HK+'/01')),6) ORDER BY K51.F18 GROUP BY K51.F18 INTO CURSOR K51A
		    SELECT K51A
		    GO TOP
		    DO WHILE !EOF()  
			   SELECT K52_TEMP
			   SEEK K51A.F18
			   IF FOUND()
			       REPLACE K52_TEMP.F06 WITH K52_TEMP.F06+K51A.SUM_F10
			   ELSE
			       SELECT K52_TEMP
			       APPEND BLANK
			       REPLACE K52_TEMP.F01 WITH K51A.F18
			       REPLACE K52_TEMP.F02 WITH IIF(SEEK(K51A.F18,'A01'),A01.F03,'')
			       REPLACE K52_TEMP.F05 WITH 0
			       REPLACE K52_TEMP.F06 WITH K51A.SUM_F10
			   ENDIF
			   SELECT K51A
			   SKIP
		   ENDDO
		   SELECT K51A
		   USE		   
		   SELECT K52_TEMP
		   GO TOP
		   DO WHILE !EOF()
		          REPLACE K52_TEMP.F07 WITH IIF(K52_TEMP.F06<>0,ROUND((K52_TEMP.F05/K52_TEMP.F06)*100,3),100)
		          SUM_F05=SUM_F05+K52_TEMP.F05
		          SUM_F06=SUM_F06+K52_TEMP.F06
		          SELECT K52_TEMP
		          SKIP
		   ENDDO 		   
		   SUM_F07=IIF(SUM_F06=0,0,ROUND((SUM_F05/SUM_F06)*100,3))
		   SELECT K52_TEMP
		   SET ORDER TO K52_TEMP2   && F01
		   GO TOP
		   IF _TALLY >0  
		        REPORT FORM ALLTRIM(INT_116)+'K29D' TO PRINT PROMPT PREVIEW 
		   ELSE
		        =MESSAGEBOX('無資料可查詢',0+48,'警示')    
		   ENDIF   	  
		   SELECT K52_TEMP
		   USE	  	  
         ENDCASE	
         THISFORM.RELEASE   	          
   ENDPROC   
 ***** 
  PROCEDURE CMND2.CLICK
      THISFORM.RELEASE
  ENDPROC      
ENDDEFINE      
***********************************************列印程序
PROCEDURE PNT_PRC
   FLG='0'
   SELECT K52
   ANS_RANGE=CREATEOBJECT("ANS_RANGE")  
   ANS_RANGE.SHOW    
   IF FLG<>'1'
       =MESSAGEBOX('無此範圍資料',0+48,'警示')
   ENDIF
ENDPROC 
***********************************************列印範圍選定
DEFINE CLASS ANS_RANGE AS FORM
       AUTOCENTER=.T.
       CAPTION='請輸入列印資料範圍'
       FONTSIZE=INT_015*9
       HEIGHT=INT_015*160
       WIDTH=INT_015*480
       FONTSIZE=INT_015*9
       CONTROLBOX=.F.
       BORDERSTYLE=2
       SHOWTIPS=.T.
       SHOWWINDOW=1
       WINDOWTYPE=1
       NAME='ANS_RANGE'
       ADD OBJECT LABEL1 AS LABEL WITH;
           AUTOSIZE=.T.,;
           HEIGHT=INT_015*25,;
           LEFT=INT_015*30,;
           TOP=INT_015*35,;
           NAME='LABEL1'    
       ADD OBJECT LABEL2 AS LABEL WITH;
           AUTOSIZE=.T.,;
           HEIGHT=INT_015*25,;
           LEFT=INT_015*250,;
           TOP=INT_015*35,;
           NAME='LABEL2'       
       ADD OBJECT TEXT1 AS TEXTBOX WITH;
           AUTOSIZE=.T.,;
           TOP=INT_015*30,;
           LEFT=INT_015*80,;
           HEIGHT=INT_015*25,; 
           NAME='TEXT1'
       ADD OBJECT TEXT2 AS TEXTBOX WITH;
           AUTOSIZE=.T.,;
           TOP=INT_015*30,;
           LEFT=INT_015*300,;
           HEIGHT=INT_015*25,;         
           NAME='TEXT2'    
       ADD OBJECT CMND1 AS COMMANDBUTTON WITH;
           AUTOSIZE=.T.,;
           LEFT=INT_015*120,;    
           HEIGHT=INT_015*25,;   
           TOP=INT_015*114,;  
           WIDTH=INT_015*80,;
           CAPTION='\<Y.執行',;
           TOOLTIPTEXT='確認所輸入的範圍鍵值!快速鍵->ALT+Y',;
           NAME='CMND1'
       ADD OBJECT CMND2 AS COMMANDBUTTON WITH;
           AUTOSIZE=.T.,;
           LEFT=INT_015*260,;
           TOP=INT_015*114,;
           HEIGHT=INT_015*25,;
           WIDTH=INT_015*80,;
           CAPTION='\<C.取消',;
           TOOLTIPTEXT='取消作業!快速鍵->ALT+C',;
           NAME='CMND2'
 *************          
  PROCEDURE INIT 
      THISFORM.SETALL('FONTSIZE',INT_015*9,'TEXTBOX')
      THISFORM.SETALL('FONTSIZE',INT_015*9,'LABEL')      
      THISFORM.SETALL('FONTSIZE',INT_015*9,'COMMANDBUTTON')            
      THISFORM.LABEL1.CAPTION='起始對象'
      THISFORM.LABEL2.CAPTION='截止對象'
      THISFORM.TEXT1.WIDTH=INT_015*70
      THISFORM.TEXT2.WIDTH=INT_015*70   
      THISFORM.TEXT1.MAXLENGTH=5              
      THISFORM.TEXT2.MAXLENGTH=5                                       
      THISFORM.TEXT1.VALUE=K52.F02
      THISFORM.TEXT2.VALUE=K52.F02   
  ENDPROC    
  PROCEDURE CMND1.CLICK 
       SELECT *  FROM K52 WHERE K52.F14='1' .AND. K52.F02>=THISFORM.TEXT1.VALUE .AND. K52.F02<=THISFORM.TEXT2.VALUE  ORDER BY K52.F02,K52.F03 NOWAIT
        IF _TALLY >0              
              REPORT FORM ALLTRIM(INT_116)+'K29A' TO PRINT PROMPT PREVIEW 
              FLG='1'      
        ENDIF      
       THISFORM.RELEASE                     
  ENDPROC
  PROCEDURE CMND2.CLICK
      FLG='1'   
      THISFORM.RELEASE
  ENDPROC      
ENDDEFINE    