***程式名稱:A42.文具及物品請領作業
CLOSE ALL
CLEAR 
FLG='0'
FCH=''
CHK=''
R=0
AREA1='A42_1'
AREA2='A42'     
IF ! USED('A01')
   SELE 0
   USE A01 INDE A01
ELSE
   SELE A01
ENDIF      
SET ORDER TO A01
IF !USED('A02')
   SELE 0
   USE A02 INDE A02
ELSE
   SELE A02
ENDIF
SET ORDER TO A021      
SEEK sys_oper + 'A42'
IF !USED('A09')
   SELE 0
   USE A09
ELSE
   SELE A09
ENDIF
SET ORDER TO A091
A24='A24'+LEFT(DTOS(DATE()),6)     &&單號暫存檔
IF !USED('&A24')
   SELE 0
   USE (A24) ALIA A24
ELSE
   SELE A24
ENDIF
SET ORDER TO 1  
IF !USED('A41')
   SELE 0
   USE A41 INDE A41
ELSE
   SELE A41
ENDIF
SET ORDER TO A411
IF !USED('A42')
   SELE 0
   USE A42 INDE A42
ELSE
   SELE A42
ENDIF
SET ORDER TO A421    
CREATE CURSOR A42_1 (F01 C(10),F02 D(8),F07 C(5),F071 C(8),F08 C(1),F90 C(17))
INDE ON F01 TAG A42_11
INDE ON F07 TAG A42_12
SELE F01,F02,F07,F08,F90 FROM A42 GROUP BY F01 ORDER BY F01 INTO CURSOR A42A
SELE A42A
GO TOP
DO WHILE !EOF()
   SELE A42_1
   APPEND BLANK
   REPLACE  A42_1.F01 WITH A42A.F01
   REPLACE  A42_1.F02 WITH A42A.F02
   REPLACE  A42_1.F07 WITH A42A.F07
   REPLACE  A42_1.F071 WITH IIF(SEEK(A42A.F07,'A01'),A01.F03,'')
   REPLACE  A42_1.F08 WITH A42A.F08
   REPLACE  A42_1.F90 WITH A42A.F90
   SELE A42A
   SKIP   
ENDDO
SELE A42A
USE   
SELE A42_1
SET ORDER TO A42_11
IF  A02.F10<>'*'  &&判斷是否有權限可處理所有員工
      SET FILTER TO A42_1.F07=sys_oper  
ENDIF
SELECT A42_1
GO BOTTOM   
***
A42FORM=CREATEOBJECT("TKA42")
A42FORM.SHOW  
DEFINE CLASS TKA42 AS FORM
  CAPTION='A42.物品請領作業'
*!*	  AUTOCENTER=.T.
  CONTROLBOX=.F.
  BORDERSTYLE=1  
  MAXBUTTON=.F.
  MINBUTTON=.F.
  MOVABLE=.F.
  CLOSABLE=.F.
  CONTROLCOUNT=57
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*550
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WIDTH=INT_015*791
  WINDOWTYPE=1
  NAME='TKA42'
  ADD OBJECT SHAPE1 AS SHAPE1 WITH;
      AUTOCENTER=.T.
  ADD OBJECT SHAPE2 AS SHAPE2 WITH;
      AUTOCENTER=.T.
  ADD OBJECT SHAPE3 AS SHAPE3 WITH;
      AUTOCENTER=.T.
  ADD OBJECT PAGEFRAME1 AS PAGEFRAME WITH;
      LEFT=INT_015*236,;
      WIDTH=INT_015*540,;
      HEIGHT=INT_015*200,;
      FONTSIZE=INT_015*9,;
      PAGECOUNT=2,;
      TABSTRETCH=1,;
      ACTIVEPAGE=1,;
      VISIBLE=.T.,;
      PAGE1.NAME='PAGE1',;
      PAGE1.VISIBLE=.T.,;
      PAGE1.CAPTION='表頭資料',;
      PAGE2.NAME='PAGE2',;
      PAGE2.VISIBLE=.T.,;
      PAGE2.CAPTION='表身詳細資料內容'   
  ADD OBJECT KEY_LIST AS KEY_LIST WITH;
      AUTOCENTER=.T.
  ADD OBJECT GRID1 AS GRID1 WITH;
      COLUMNCOUNT=3,;            
      RECORDSOURCE='A42_1',;      
      COLUMN1.NAME='COLUMN1',; 
      COLUMN2.NAME='COLUMN2',; 
      COLUMN3.NAME='COLUMN3' 
  ADD OBJECT GRID2 AS GRID2 WITH;
      COLUMNCOUNT=5,;            
      RECORDSOURCE='A42',; 
      LINKMASTER='A42_1',;
      RELATIONALEXPR='F01',;
      CHILDORDER='A421',;  
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;
      COLUMN3.NAME='COLUMN3',;
      COLUMN4.NAME='COLUMN4',;
      COLUMN5.NAME='COLUMN5'
  ADD OBJECT CMDGROUP AS CMDGROUP WITH;
      AUTOSIZE=.T.              
  ADD OBJECT ORPGROUP AS ORPGROUP WITH;    
      AUTOSIZE=.T.              
  ADD OBJECT SHRGROUP AS SHRGROUP WITH;
      TOP=INT_015*150,;
      LEFT=INT_015*560          
  ADD OBJECT ANS_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*490,;
      LEFT=INT_015*15,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*45,;      
      FONTSIZE=INT_015*9,;
      CAPTION='\<A.確認',;
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\harrow.cur',;        
      NAME='ANS_BOTT'      
  ADD OBJECT  INVERSE_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*490,;
      LEFT=INT_015*62,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*50,;      
      FONTSIZE=INT_015*9,;
      CAPTION='\<I.反確認',;
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\harrow.cur',;        
      NAME='INVERSE_BOTT'           
  ADD OBJECT PRT_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*490,;
      LEFT=INT_015*114,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*65,;      
      FONTSIZE=INT_015*9,;
      CAPTION='\<K.列印總表',;
      NAME='PRT_BOTT'          
  ADD OBJECT COMBOBOX04 AS COMBOBOX04 WITH;  &&品項名稱
       VISIBLE=.F.,;
      TOP=INT_015*67,;
      LEFT=INT_015*302                          
  PROCEDURE PAGEFRAME1.PAGE1.INIT     
     THIS.ADDOBJECT('LBLF01','LABEL')
     WITH THIS.LBLF01
          .VISIBLE=.T.
          .LEFT=INT_015*14
          .TOP=INT_015*18
          .WIDTH=INT_015*50
          .CAPTION='請領單號'          
     ENDWITH   
     THIS.ADDOBJECT('TXTF01','TEXTBOX')          
     WITH THIS.TXTF01
          .VISIBLE=.T.
          .LEFT=INT_015*64
          .TOP=INT_015*14
          .WIDTH=INT_015*80
          .HEIGHT=INT_015*25
          .MAXLENGTH=10
     ENDWITH              
     THIS.ADDOBJECT('LBLF02','LABEL')
     WITH THIS.LBLF02
          .VISIBLE=.T.
          .LEFT=INT_015*14
          .TOP=INT_015*46
          .WIDTH=INT_015*50
          .CAPTION='請領日期'          
     ENDWITH   
     THIS.ADDOBJECT('TXTF02','TEXTBOX')          
     WITH THIS.TXTF02
          .VISIBLE=.T.
          .LEFT=INT_015*64
          .TOP=INT_015*40
          .WIDTH=INT_015*80
          .HEIGHT=INT_015*25
     ENDWITH        
     THIS.ADDOBJECT('LBLF07','LABEL')
     WITH THIS.LBLF07
          .VISIBLE=.T.
          .LEFT=INT_015*14
          .TOP=INT_015*72
          .WIDTH=INT_015*50
          .CAPTION='請領人員'          
     ENDWITH   
     THIS.ADDOBJECT('LBLF071','LABEL')
     WITH THIS.LBLF071
          .VISIBLE=.T.
          .LEFT=INT_015*135
          .TOP=INT_015*72
          .AUTOSIZE=.T.
          .CAPTION=''          
     ENDWITH        
     THIS.ADDOBJECT('TXTF07','TEXTBOX')          
     WITH THIS.TXTF07
          .VISIBLE=.T.
          .LEFT=INT_015*64
          .TOP=INT_015*66
          .WIDTH=INT_015*65
          .HEIGHT=INT_015*25
          .MAXLENGTH=5
     ENDWITH     
     THIS.ADDOBJECT('COMBOBOX07','COMBOBOX07')          
       WITH THIS.COMBOBOX07 
           .VISIBLE=.F.
           .LEFT=INT_015*64
           .TOP=INT_015*66         
     ENDWITH       
    THIS.ADDOBJECT('LBLF90','LABEL')
    WITH THIS.LBLF90
        .VISIBLE=.T.           
        .LEFT=INT_015*14
        .TOP=INT_015*145
        .WIDTH=INT_015*50
        .CAPTION='確認人員'         
    ENDWITH    
    THIS.ADDOBJECT('LBLF901','LABEL')
    WITH THIS.LBLF901
        .VISIBLE=.T.           
        .LEFT=INT_015*65
        .TOP=INT_015*145
        .AUTOSIZE=.T.
        .CAPTION=''
    ENDWITH          
  ENDPROC   
  ****
  PROCEDURE PAGEFRAME1.PAGE2.INIT
	THIS.ADDOBJECT('LBLF03','LABEL')
	WITH THIS.LBLF03  
	    .VISIBLE=.T.
            .LEFT=INT_015*14
            .TOP=INT_015*18
	    .WIDTH=INT_015*50
         .CAPTION='物品類別'
    ENDWITH  
   THIS.ADDOBJECT('TXTF03','TEXTBOX')
	WITH THIS.TXTF03      
	     .VISIBLE=.T.
	     .LEFT=INT_015*65
	     .TOP=INT_015*14
	     .WIDTH=INT_015*200
	     .HEIGHT=INT_015*25
	     .MAXLENGTH=20
	     .NAME='TXTF03'  
    ENDWITH        
     THIS.ADDOBJECT('COMBOBOX03','COMBOBOX03')          
       WITH THIS.COMBOBOX03 
           .VISIBLE=.F.
           .LEFT=INT_015*65
           .TOP=INT_015*14         
     ENDWITH       
    THIS.ADDOBJECT('LBLF04','LABEL')
    WITH THIS.LBLF04
         .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*46
         .WIDTH=INT_015*50
         .CAPTION='品項名稱'       
    ENDWITH     
   THIS.ADDOBJECT('TXTF04','TEXTBOX')
	WITH THIS.TXTF04
	     .VISIBLE=.T.
	     .LEFT=INT_015*65
	     .TOP=INT_015*40
	     .WIDTH=INT_015*200
	     .HEIGHT=INT_015*25
	     .MAXLENGTH=30
	     .NAME='TXTF04'	    
	ENDWITH      
    THIS.ADDOBJECT('LBLF05','LABEL')
    WITH THIS.LBLF05
         .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*72
         .WIDTH=INT_015*50
          .CAPTION='單        位'       
    ENDWITH     
   THIS.ADDOBJECT('TXTF05','TEXTBOX')
	WITH THIS.TXTF05
	     .VISIBLE=.T.
	     .LEFT=INT_015*65
	     .TOP=INT_015*66
	     .WIDTH=INT_015*40
	     .HEIGHT=INT_015*25
	     .MAXLENGTH=4
	     .NAME='TXTF05'	    
	ENDWITH  	
    THIS.ADDOBJECT('LBLF06','LABEL')
    WITH THIS.LBLF06
         .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*98
         .WIDTH=INT_015*50
         .CAPTION='請領數量'         
    ENDWITH     
   THIS.ADDOBJECT('TXTF06','TEXTBOX')
	WITH THIS.TXTF06
	     .VISIBLE=.T.
	     .LEFT=INT_015*65
	     .TOP=INT_015*92
	     .WIDTH=INT_015*50
	     .HEIGHT=INT_015*25
	     .MAXLENGTH=4
	     .ALIGNMENT=1
	     .NAME='TXTF06'	    
	ENDWITH  		
    THIS.ADDOBJECT('LBLF99','LABEL')
    WITH THIS.LBLF99
        .VISIBLE=.T.           
        .LEFT=INT_015*14
        .TOP=INT_015*123
        .WIDTH=INT_015*50
        .CAPTION='安全資料'         
    ENDWITH    
    THIS.ADDOBJECT('LBLF991','LABEL')
    WITH THIS.LBLF991
        .VISIBLE=.T.           
        .LEFT=INT_015*65
        .TOP=INT_015*123
        .AUTOSIZE=.T.
        .CAPTION=''
    ENDWITH           
  ENDPROC     
  ****  
  PROC INIT       
       THISFORM.SETALL('HEIGHT',INT_015*25,'TEXTBOX')
       THISFORM.SETALL('HEIGHT',INT_015*17,'LABEL')     
       THISFORM.SETALL('FONTSIZE',INT_015*9,'TEXTBOX')
       THISFORM.SETALL('FONTSIZE',INT_015*9,'LABEL')         
       THISFORM.SETALL('READONLY',.T.,'TEXTBOX')
       THISFORM.PAGEFRAME1.PAGE1.FONTSIZE=INT_015*10
       THISFORM.PAGEFRAME1.PAGE2.FONTSIZE=INT_015*10          
       THISFORM.SHRGROUP.VISIBLE=.F.
       THISFORM.SHRGROUP.ENABLED=.F.
       THISFORM.GRID1.BACKCOLOR=IIF(SEEK(SYS_OPER,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)
       THISFORM.GRID2.BACKCOLOR=IIF(SEEK(SYS_OPER,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)
       THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(A42_1.F08<>'1',RGB(255,0,0),'')","COLUMN")   
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'COLUMN')
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'HEADER')         
       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='請領單號'
       THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='請領人員'
       THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='人員姓名'
       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='A42_1.F01'
       THISFORM.GRID1.COLUMN2.CONTROLSOURCE='A42_1.F07'
       THISFORM.GRID1.COLUMN3.CONTROLSOURCE='A42_1.F071'
       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*70
       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*50
       THISFORM.GRID1.COLUMN3.WIDTH=INT_015*65
       THISFORM.GRID2.SETALL('FONTSIZE',INT_015*9,'COLUMN')
       THISFORM.GRID2.SETALL('FONTSIZE',INT_015*9,'HEADER') 
       THISFORM.GRID2.COLUMN1.HEADER1.CAPTION='物品類別'        
       THISFORM.GRID2.COLUMN2.HEADER1.CAPTION='品項名稱'       
       THISFORM.GRID2.COLUMN3.HEADER1.CAPTION='單位'
       THISFORM.GRID2.COLUMN4.HEADER1.CAPTION='請領數量'
       THISFORM.GRID2.COLUMN5.HEADER1.CAPTION='安全資料'
       THISFORM.GRID2.COLUMN1.CONTROLSOURCE='A42.F03'
       THISFORM.GRID2.COLUMN2.CONTROLSOURCE='A42.F04'
       THISFORM.GRID2.COLUMN3.CONTROLSOURCE='A42.F05'
       THISFORM.GRID2.COLUMN4.CONTROLSOURCE='A42.F06'
       THISFORM.GRID2.COLUMN5.CONTROLSOURCE='A42.F99'
       THISFORM.GRID2.COLUMN1.WIDTH=INT_015*150
       THISFORM.GRID2.COLUMN2.WIDTH=INT_015*150
       THISFORM.GRID2.COLUMN3.WIDTH=INT_015*40
       THISFORM.GRID2.COLUMN4.WIDTH=INT_015*60
       THISFORM.GRID2.COLUMN5.WIDTH=INT_015*100
       THISFORM.GRID1.READONLY=.T.      
       THISFORM.GRID2.READONLY=.T.            
       THISFORM.GRID1.SETFOCUS
       IF THISFORM.GRID1.ACTIVEROW=0
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
         THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
         THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
         THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F. 
         THISFORM.ANS_BOTT.ENABLED=.F.  
         THISFORM.INVERSE_BOTT.ENABLED=.F.               
         THISFORM.PRT_BOTT.ENABLED=.F.
       ELSE
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T. 
        THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.) AND IIF(A42_1.F08<>'1',.T.,.F.)  &&判斷有無修改的權限
        THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.) AND IIF(A42_1.F08<>'1',.T.,.F.)  &&判斷有無刪除的權限
        THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限                     
	THISFORM.ANS_BOTT.ENABLED=IIF(A02.F08='*',.T.,.F.) AND IIF(A42_1.F08<>'1',.T.,.F.)
	THISFORM.INVERSE_BOTT.ENABLED=IIF(A02.F09='*',.T.,.F.) AND IIF(A42_1.F08='1',.T.,.F.) 
	THISFORM.PRT_BOTT.ENABLED=IIF(A02.F10='*',.T.,.F.)   &&判斷有無列印總表的權限
       ENDIF          
       THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.)
       THISFORM.KEY_LIST.DISPLAYVALUE='依請領單號排列'      
       JK='請領單號'
       THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=A42_1.F01
  ENDPROC             
  PROCEDURE PAGEFRAME1.PAGE1.ACTIVATE
     R=0
     SELE A42_1
     DO CASE 
           CASE THISFORM.KEY_LIST.DISPLAYVALUE='依請領單號排列'
                     SET ORDER TO A42_11
           CASE THISFORM.KEY_LIST.DISPLAYVALUE='依請領人員排列'
                   SET ORDER TO A42_12
     ENDCASE          
     IF THISFORM.SHRGROUP.VISIBLE=.F.
        THISFORM.GRID1.ENABLED=.T.   
        THISFORM.GRID1.SETFOCUS   
        THISFORM.KEY_LIST.ENABLED=.T.
     ELSE
       THISFORM.KEY_LIST.ENABLED=.F.   
     ENDIF                
     THISFORM.ANS_BOTT.VISIBLE=.T.
     THISFORM.INVERSE_BOTT.VISIBLE=.T.     
     THISFORM.PRT_BOTT.VISIBLE=.T.        
     THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(A42_1.F08<>'1',RGB(255,0,0),'')","COLUMN")      
     THISFORM.GRID1.SETFOCUS
    IF THISFORM.GRID1.ACTIVEROW=0 .AND. THISFORM.SHRGROUP.ENABLED=.F.
        THISFORM.PAGEFRAME1.PAGE2.ENABLED=.F.   
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
        THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
        THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
        THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
        THISFORM.PAGEFRAME1.PAGE1.SETALL('VALUE','','TEXTBOX')        
        THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=''        
        THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE=''    
        THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE=''    
        THISFORM.PAGEFRAME1.PAGE1.LBLF071.CAPTION=''  
        THISFORM.PAGEFRAME1.PAGE1.LBLF901.CAPTION=''  
	THISFORM.ANS_BOTT.ENABLED=.F.
	THISFORM.INVERSE_BOTT.ENABLED=.F.        
	THISFORM.PRT_BOTT.ENABLED=.F.
     ELSE
        THISFORM.PAGEFRAME1.PAGE2.ENABLED=.T.
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.
        THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.) AND IIF(A42_1.F08<>'1',.T.,.F.) &&判斷有無修改的權限
        THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)  AND IIF(A42_1.F08<>'1',.T.,.F.) &&判斷有無刪除的權限
        THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)    &&判斷有無列印的權限         
	THISFORM.ANS_BOTT.ENABLED=IIF(A02.F08='*',.T.,.F.) AND IIF(A42_1.F08<>'1',.T.,.F.)
	THISFORM.INVERSE_BOTT.ENABLED=IIF(A02.F09='*',.T.,.F.) AND IIF(A42_1.F08 = '1',.T.,.F.)  
	THISFORM.PRT_BOTT.ENABLED=IIF(A02.F10='*',.T.,.F.)   &&判斷有無列印總表的權限         
     ENDIF   
     THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.)
  ENDPROC
  PROCEDURE PAGEFRAME1.PAGE2.ACTIVATE
     SELE A42
     IF THISFORM.SHRGROUP.ENABLED=.F.
        THISFORM.GRID2.READONLY=.T.   
        THISFORM.GRID2.SETFOCUS   
     ENDIF    
     THISFORM.ANS_BOTT.VISIBLE=.F.
     THISFORM.INVERSE_BOTT.VISIBLE=.F.         
     THISFORM.PRT_BOTT.VISIBLE=.F.         
     IF THISFORM.GRID2.ACTIVEROW=0 .AND. THISFORM.SHRGROUP.ENABLED=.F.
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
        THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
        THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
	THISFORM.ANS_BOTT.ENABLED=.F.
	THISFORM.INVERSE_BOTT.ENABLED=.F.   
        THISFORM.PAGEFRAME1.PAGE2.SETALL('VALUE','','TEXTBOX')
        THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=''
        THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE=''
        THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE=''
        THISFORM.PAGEFRAME1.PAGE2.TXTF06.VALUE=''
        THISFORM.PAGEFRAME1.PAGE2.LBLF991.CAPTION=''
     ELSE
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.
        THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  AND IIF(A42_1.F08<>'1',.T.,.F.) &&判斷有無修改的權限
        THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)  AND IIF(A42_1.F08<>'1',.T.,.F.) &&判斷有無刪除的權限
        THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)  &&&&判斷有無列印的權限   
     ENDIF   
     R=RECNO('&AREA1')
     THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(RECNO('&AREA1')=R,RGB(255,255,0),'')","COLUMN")
     THISFORM.GRID1.ENABLED=.F.     
     THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.)  AND IIF(A42_1.F08<>'1',.T.,.F.)&&判斷有無新增的權限
     THISFORM.KEY_LIST.ENABLED=.F.     
  ENDPROC         
  PROC KEY_LIST.INIT 
       WITH THIS 
           .ADDITEM('依請領單號排列')
           .ADDITEM('依請領人員排列')
           .VALUE=1
       ENDWITH             
  ENDPROC 
  PROC KEY_LIST.INTERACTIVECHANGE                 
       SELE A42_1 
       DO CASE
          CASE THIS.DISPLAYVALUE='依請領單號排列'
                     SET ORDER TO A42_11 
		     THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='請領單號'
		     THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='請領人員'
		     THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='人員姓名'
		     THISFORM.GRID1.COLUMN1.CONTROLSOURCE='A42_1.F01'
		     THISFORM.GRID1.COLUMN2.CONTROLSOURCE='A42_1.F07'
		     THISFORM.GRID1.COLUMN3.CONTROLSOURCE='A42_1.F071'
		     THISFORM.GRID1.COLUMN1.WIDTH=INT_015*70
		     THISFORM.GRID1.COLUMN2.WIDTH=INT_015*50
		     THISFORM.GRID1.COLUMN3.WIDTH=INT_015*65                         
          CASE THIS.DISPLAYVALUE='依請領人員排列'
                     SET ORDER TO A42_12 
		     THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='請領人員'
		     THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='人員姓名'
		     THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='請領單號'
		     THISFORM.GRID1.COLUMN1.CONTROLSOURCE='A42_1.F07'
		     THISFORM.GRID1.COLUMN2.CONTROLSOURCE='A42_1.F071'
		     THISFORM.GRID1.COLUMN3.CONTROLSOURCE='A42_1.F01'
		     THISFORM.GRID1.COLUMN1.WIDTH=INT_015*50
		     THISFORM.GRID1.COLUMN2.WIDTH=INT_015*65        
		     THISFORM.GRID1.COLUMN3.WIDTH=INT_015*70                                                     
       ENDCASE 
       THISFORM.GRID1.SETFOCUS
  ENDPROC     
  PROC GRID1.AFTERROWCOLCHANGE
       LPARAMETERS nColIndex
       PO_NO=A42_1.F01
       THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=A42_1.F01
       THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE=A42_1.F02
       THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE=A42_1.F07
       THISFORM.PAGEFRAME1.PAGE1.LBLF071.CAPTION=A42_1.F071
       THISFORM.PAGEFRAME1.PAGE1.LBLF901.CAPTION=A42_1.F90
       THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.) &&判斷有無新增的權限
       THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  AND IIF(A42_1.F08<>'1',.T.,.F.) &&判斷有無修改的權限
       THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)  AND IIF(A42_1.F08<>'1',.T.,.F.) &&判斷有無刪除的權限       
	THISFORM.ANS_BOTT.ENABLED=IIF(A02.F08='*',.T.,.F.) AND IIF(A42_1.F08<>'1',.T.,.F.)
	THISFORM.INVERSE_BOTT.ENABLED=IIF(A02.F09='*',.T.,.F.) AND IIF(A42_1.F08 = '1',.T.,.F.)  	  
       FCH=THISFORM.ACTIVECONTROL.NAME
       JK=THIS.COLUMN1.HEADER1.CAPTION  
       IF THIS.ACTIVEROW=0
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
       ELSE
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.
       ENDIF   
       CHK=''     
*       THISFORM.REFRESH
  ENDPROC     
  PROC GRID2.AFTERROWCOLCHANGE
       LPARAMETERS nColIndex
       THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=A42.F03
       THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE=A42.F04 
       THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE=A42.F05     
       THISFORM.PAGEFRAME1.PAGE2.TXTF06.VALUE=A42.F06  
       THISFORM.PAGEFRAME1.PAGE2.LBLF991.CAPTION=A42.F99
       THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.)  AND IIF(A42_1.F08<>'1',.T.,.F.)&&判斷有無新增的權限
       THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  AND IIF(A42_1.F08<>'1',.T.,.F.) &&判斷有無修改的權限
       THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)  AND IIF(A42_1.F08<>'1',.T.,.F.) &&判斷有無刪除的權限       
       FCH=THISFORM.ACTIVECONTROL.NAME
       JK=THIS.COLUMN1.HEADER1.CAPTION
       CHK=A42_1.F01
*       CHK=THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
       IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
       ENDIF   
*       thisform.refresh
  ENDPROC 
  ****
  PROCEDURE ORPGROUP.NEW_BOTT.CLICK    
    THISFORM.KEY_LIST.ENABLED=.F. 
    THISFORM.ANS_BOTT.ENABLED=.F.
    THISFORM.INVERSE_BOTT.ENABLED=.F.   
    THISFORM.PRT_BOTT.ENABLED=.F.       
    THISFORM.GRID1.ENABLED=.F.   
    THISFORM.GRID2.ENABLED=.F.       
    IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1      
         THISFORM.PAGEFRAME1.PAGE2.ENABLED=.F. 
          H='A041 '+SUBSTR(DTOS(DATE()),3,4)
          SELE A24   
          SET ORDER TO 1
          SEEK H           
          IF FOUND() 
             PO_NO=F08
             RLOCK()
             DELE 
             UNLOCK
          ELSE
             SELE A09
             SEEK H
             IF  .NOT.FOUND()                                                  &&如果為本月第一張訂單則重頭開始編號
		   APPEND BLANK                                                
		   REPL F01 WITH 'A041 '
		   REPL F02 WITH  SUBSTR(DTOS(DATE()),3,4)
		   REPL F05 WITH 'AB'+F02
		   REPL F06 WITH '物品請領作業'
		   REPL F08 WITH ALLTRIM(F05)+'0000'
	     ENDIF
	     LOCK()
	     HX=VAL(RIGHT(F08,4))+1
	     PO_NO=LEFT(F08,6)+PADL(ALLTRIM(STR(HX)),4,'0')
	     REPL F08 WITH PO_NO                                      &&記錄本訂單號碼,本月份後續的訂單號碼將以此往下編
	     UNLOCK 
        ENDIF         
        THISFORM.PAGEFRAME1.PAGE1.SETALL('READONLY',.T.,'TEXTBOX')     &&處理表頭新增
        THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=PO_NO  
        THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE=DATE()
        THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE=''
        THISFORM.PAGEFRAME1.PAGE1.LBLF071.CAPTION=''
        THISFORM.PAGEFRAME1.PAGE1.LBLF901.CAPTION=''
        IF A02.F10='*'	&&處裡所有人員
            THISFORM.PAGEFRAME1.PAGE1.COMBOBOX07.VISIBLE=.T.
            THISFORM.PAGEFRAME1.PAGE1.COMBOBOX07.VALUE=1
            THISFORM.PAGEFRAME1.PAGE1.COMBOBOX07.SETFOCUS
        ELSE
           THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE=sys_oper
           THISFORM.PAGEFRAME1.PAGE1.LBLF071.CAPTION=IIF(SEEK(sys_oper,'A01'),A01.F03,'')
           THISFORM.SHRGROUP.SHURE1_BOTT.CLICK 
           THISFORM.GRID1.ENABLED=.F.   
           THISFORM.GRID2.ENABLED=.F.       
        THISFORM.PAGEFRAME1.PAGE1.ENABLED=.F.              &&處理表身新增 
        THISFORM.PAGEFRAME1.PAGE2.SETALL('READONLY',.F.,'TEXTBOX')     
        THISFORM.PAGEFRAME1.PAGE2.TXTF05.READONLY=.T.
        THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=''              
        THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE=''
        THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE=''
        THISFORM.PAGEFRAME1.PAGE2.TXTF06.VALUE=1
        THISFORM.PAGEFRAME1.PAGE2.LBLF991.CAPTION=''    
        THISFORM.PAGEFRAME1.PAGE2.COMBOBOX03.VISIBLE=.T.
        THISFORM.PAGEFRAME1.PAGE2.COMBOBOX03.VALUE=1        
	THISFORM.COMBOBOX04.VISIBLE=.T.  
	THISFORM.COMBOBOX04.CLICK      
	THISFORM.COMBOBOX04.VALUE=1                 
        THISFORM.PAGEFRAME1.PAGE2.COMBOBOX03.SETFOCUS                    
        ENDIF   
     ELSE
        THISFORM.PAGEFRAME1.PAGE1.ENABLED=.F.              &&處理表身新增 
        THISFORM.PAGEFRAME1.PAGE2.SETALL('READONLY',.F.,'TEXTBOX')     
        THISFORM.PAGEFRAME1.PAGE2.TXTF05.READONLY=.T.
        THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=''              
        THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE=''
        THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE=''
        THISFORM.PAGEFRAME1.PAGE2.TXTF06.VALUE=1
        THISFORM.PAGEFRAME1.PAGE2.LBLF991.CAPTION=''    
        THISFORM.PAGEFRAME1.PAGE2.COMBOBOX03.VISIBLE=.T.
        THISFORM.PAGEFRAME1.PAGE2.COMBOBOX03.VALUE=1        
	THISFORM.COMBOBOX04.VISIBLE=.T.  
	THISFORM.COMBOBOX04.CLICK      
	THISFORM.COMBOBOX04.VALUE=1                 
        THISFORM.PAGEFRAME1.PAGE2.COMBOBOX03.SETFOCUS       
     ENDIF   
  ENDPROC  
  PROCEDURE SHRGROUP.SHURE1_BOTT.CLICK               &&新增確認
    IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
       IF INDEXSEEK(THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE,.F.,'A42_1','A42_11') = .T. 
          =MESSAGEBOX('請領單號已存在,請洽系統管理人員!',0+64,'提示訊息視窗')
          THISFORM.PAGEFRAME1.PAGE1.TXTF01.SETFOCUS
          RETURN            
       ENDIF    
       IF  EMPTY(THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE)
          =MESSAGEBOX('請領人員不得空白!',0+64,'提示訊息視窗')
          THISFORM.PAGEFRAME1.PAGE1.TXTF07.SETFOCUS
          RETURN            
       ENDIF    
       SELE A42_1          
       APPEND BLANK
       LOCK()
       IF RLOCK()
          REPLACE F01 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
          REPLACE F02 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE
          REPLACE F07 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE
          REPLACE F071 WITH ALLTRIM(THISFORM.PAGEFRAME1.PAGE1.LBLF071.CAPTION)
       ENDIF   
       UNLOCK
       THISFORM.PAGEFRAME1.PAGE1.ENABLED=.F.
       THISFORM.PAGEFRAME1.PAGE2.ENABLED=.T.  
       THISFORM.PAGEFRAME1.ACTIVEPAGE=2
       THISFORM.ORPGROUP.NEW_BOTT.CLICK
       THISFORM.REFRESH
    ELSE	&&表身新增
       IF  EMPTY(THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE)
            =MESSAGEBOX('物品類別不得空白!',0+64,'提示訊息視窗')
            THISFORM.PAGEFRAME1.PAGE2.TXTF03.SETFOCUS
            RETURN            
       ENDIF         
       IF  EMPTY(THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE)
            =MESSAGEBOX('品項名稱不得空白!',0+64,'提示訊息視窗')
            THISFORM.PAGEFRAME1.PAGE2.TXTF04.SETFOCUS
            RETURN            
       ENDIF        
       IF INDEXSEEK(THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE + THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE + THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE,.F.,'A42','A421') = .T.
          =MESSAGEBOX('此物品類別之品項名稱已存在此單號中!',0+48,'提示訊息視窗')          
          THISFORM.PAGEFRAME1.PAGE2.TXTF03.SETFOCUS
          RETURN
       ENDIF   
       IF  EMPTY(THISFORM.PAGEFRAME1.PAGE2.TXTF06.VALUE)
            =MESSAGEBOX('請領數量不得為零!',0+64,'提示訊息視窗')
            THISFORM.PAGEFRAME1.PAGE2.TXTF06.SETFOCUS
            RETURN            
       ENDIF                    
       SELECT A42
       APPEND BLANK
       LOCK()
       IF RLOCK()
          REPLACE F01 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
          REPLACE F02 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE
          REPLACE F03 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE
          REPLACE F04 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE
          REPLACE F05 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE
          REPLACE F06 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF06.VALUE
          REPLACE F07 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE
          REPLACE F99 WITH IIF(INT_012=1,PADL(ALLTRIM(STR(YEAR(DATE())-1911)),3,' ')+RIGHT(DTOC(DATE()),6),dtoc(DATE())+' ')+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
       ENDIF
       UNLOCK ALL         
       SEEK THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE + THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE
       THISFORM.GRID2.ENABLED=.T.
       THISFORM.GRID2.SETFOCUS  
       THISFORM.ORPGROUP.NEW_BOTT.CLICK      
    ENDIF  
  ENDPROC
****  
  PROCEDURE ORPGROUP.EDIT_BOTT.CLICK
     THISFORM.KEY_LIST.ENABLED=.F. 
     THISFORM.ANS_BOTT.ENABLED=.F.
     THISFORM.INVERSE_BOTT.ENABLED=.F.        
     THISFORM.PRT_BOTT.ENABLED=.F.
     THISFORM.GRID1.ENABLED=.F.   
     THISFORM.GRID2.ENABLED=.F.   
     IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
          THISFORM.PAGEFRAME1.PAGE2.ENABLED=.F.
          THISFORM.PAGEFRAME1.PAGE1.SETALL('READONLY',.T.,'TEXTBOX')    
          THISFORM.PAGEFRAME1.PAGE1.COMBOBOX07.VISIBLE=.T.
          THISFORM.PAGEFRAME1.PAGE1.COMBOBOX07.DISPLAYVALUE=ALLTRIM(THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE)+SPACE(7)+ALLTRIM(THISFORM.PAGEFRAME1.PAGE1.LBLF071.CAPTION) 
          THISFORM.PAGEFRAME1.PAGE1.COMBOBOX07.SETFOCUS  
     ELSE
          THISFORM.PAGEFRAME1.PAGE1.ENABLED=.F.
         THISFORM.PAGEFRAME1.PAGE2.SETALL('READONLY',.T.,'TEXTBOX') 
         THISFORM.PAGEFRAME1.PAGE2.TXTF06.READONLY=.F.
         THISFORM.PAGEFRAME1.PAGE2.TXTF06.SETFOCUS  
     ENDIF
  ENDPROC    
  PROCEDURE SHRGROUP.SHURE2_BOTT.CLICK                          &&修改確認
     IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
          IF  EMPTY(THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE)
               =MESSAGEBOX('請領人員不得空白!',0+64,'提示訊息視窗')
               THISFORM.PAGEFRAME1.PAGE1.TXTF07.SETFOCUS
               RETURN            
          ENDIF     
          SELECT A42_1
          LOCK()
          IF RLOCK()
              SELE RECNO() FROM A42 WHERE A42.F01=A42_1.F01 INTO ARRAY BK1
              JJ1=''                
              IF _TALLY>0                   
                   FOR I= 1 TO ALEN(BK1)
                          JJ1=JJ1+ALLTRIM(STR(BK1(I)))+','
                   ENDFOR  
                   KK1=STUFF(JJ1,RAT(',',JJ1,1),1,'')
                   RLOCK(KK1,'A42')
                   LL1=RLOCK(KK1,'A42')
                   IF LL1=.T. AND LEN(ALLTRIM(JJ1))>0 
                       SELECT A42
                       FOR I= 1 TO ALEN(BK1)                      
                              GO BK1(I) 
                              SELECT A42
                              REPLACE A42.F07 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE
                       ENDFOR
                   ENDIF
                ENDIF   
                SELECT  A42_1
                REPLACE A42_1.F07 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE
                REPLACE A42_1.F071 WITH THISFORM.PAGEFRAME1.PAGE1.LBLF071.CAPTION 
                RELEASE ALL LIKE BK*   
           ELSE 
               DO FILE_IMPACT
               UNLOCK ALL
          ENDIF  
     ELSE         
       IF  EMPTY(THISFORM.PAGEFRAME1.PAGE2.TXTF06.VALUE)
            =MESSAGEBOX('請領數量不得為零!',0+64,'提示訊息視窗')
            THISFORM.PAGEFRAME1.PAGE2.TXTF06.SETFOCUS
            RETURN            
       ENDIF                    
       SELECT A42
       LOCK()
       IF RLOCK()
          REPLACE F06 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF06.VALUE
          REPLACE F99 WITH IIF(INT_012=1,PADL(ALLTRIM(STR(YEAR(DATE())-1911)),3,' ')+RIGHT(DTOC(DATE()),6),dtoc(DATE())+' ')+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
       ENDIF
    ENDIF   
    UNLOCK ALL
    THISFORM.SHRGROUP.ABANDON_BOTT.CLICK    
  ENDPROC   
****
 PROCEDURE  ORPGROUP.DEL_BOTT.CLICK                    &&刪除資料程序
    IF MESSAGEBOX('是否確定要刪除此筆資料',4+32+256,'請確認') = 6	
         PO_NO=A42_1.F01
        IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1     &&刪除全部
             SELECT A42_1
             LOCK()
             IF RLOCK()
                  SELE RECNO() FROM A42 WHERE A42.F01=A42_1.F01 INTO ARRAY BK1
                  JJ1=''                
                  IF _TALLY>0                   
                      FOR I= 1 TO ALEN(BK1)
                             JJ1=JJ1+ALLTRIM(STR(BK1(I)))+','
                      ENDFOR  
                      KK1=STUFF(JJ1,RAT(',',JJ1,1),1,'')
                      RLOCK(KK1,'A42')
                      LL1=RLOCK(KK1,'A42')
                      IF LL1=.T. AND LEN(ALLTRIM(JJ1))>0 
                          SELECT A41
                          FOR I= 1 TO ALEN(BK1)                      
                                 GO BK1(I) 
                                 SELECT A42
                                 DELETE 
                          ENDFOR
                      ENDIF
                   ENDIF   
                   SELECT A42_1
                   SELECT A24
                   SEEK 'A041 '+SUBSTR(DTOS(DATE()),3,4)+A42_1.F01
                   IF !FOUND()
                       APPEND BLANK
                       RLOCK()
                       REPLACE  F01 WITH 'A041 '
                       REPLACE  F02 WITH SUBSTR(DTOS(DATE()),3,4)
                       REPLACE  F05 WITH 'AB'+F02
                       REPLACE  F06 WITH '物品請領作業'
                       REPLACE  F08 WITH A42_1.F01
                      UNLOCK           
                   ENDIF         
                   SELECT A42_1               
                   DELETE   
                   RELEASE ALL LIKE BK*       
             ELSE
                   DO file_impact                  
             ENDIF    
             UNLOCK ALL
            THISFORM.GRID1.SETFOCUS
           IF THISFORM.GRID1.ACTIVEROW=0
               THISFORM.PAGEFRAME1.PAGE2.ENABLED=.F.
	       THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
	       THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
	       THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
	       THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
	       THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
	       THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
               THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
               THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
	       THISFORM.ANS_BOTT.ENABLED=.F.
	       THISFORM.INVERSE_BOTT.ENABLED=.F.             
	       THISFORM.PRT_BOTT.ENABLED=.F.   
	    ELSE
	       THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
	       THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
	       THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
	       THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
	       THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T. 
	       THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  AND IIF(A42_1.F08<>'1',.T.,.F.)&&判斷有無修改的權限
               THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)  AND IIF(A42_1.F08<>'1',.T.,.F.)&&判斷有無刪除的權限
               THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)  AND IIF(A42_1.F08<>'1',.T.,.F.) &&&&判斷有無列印的權限  
	       THISFORM.ANS_BOTT.ENABLED=IIF(A02.F08='*',.T.,.F.) AND IIF(A42_1.F08<>'1',.T.,.F.)
	       THISFORM.INVERSE_BOTT.ENABLED=IIF(A02.F09='*',.T.,.F.) AND IIF(A42_1.F08 = '1',.T.,.F.)      
	       THISFORM.PRT_BOTT.ENABLED=IIF(A02.F10='*',.T.,.F.)   &&判斷有無列印總表的權限                        
	     ENDIF               
             THISFORM.SHRGROUP.ABANDON_BOTT.CLICK                 
        ELSE		&&單筆刪除
             SELECT A42
             LOCK()
             IF RLOCK()
                  SELECT A42
                  DELETE 
             ELSE
                  DO file_impact    
             ENDIF
             UNLOCK ALL
             THISFORM.GRID2.SETFOCUS
             IF THISFORM.GRID2.ACTIVEROW=0         &&如果單身被刪空     
                  SELECT  A24
                  SEEK 'A041 '+SUBSTR(DTOS(DATE()),3,4)+A42_1.F01
                  IF !FOUND()
                       APPEND BLANK
                       RLOCK()
                       REPLACE  F01 WITH 'A041 '
                       REPLACE  F02 WITH SUBSTR(DTOS(DATE()),3,4)
                       REPLACE  F05 WITH 'AB'+F02
                       REPLACE  F06 WITH '物品請領作業'
                       REPLACE  F08 WITH A42_1.F01
                      UNLOCK           
                 ENDIF                     
                 SELE A42_1
                 DELETE 
                 THISFORM.PAGEFRAME1.ACTIVEPAGE=1 
                 THISFORM.REFRESH    
                 THISFORM.SHRGROUP.ABANDON_BOTT.CLICK                   
             ENDIF
        ENDIF
    ENDIF      
  ENDPROC  
***
  PROCEDURE SHRGROUP.ABANDON_BOTT.CLICK
      THISFORM.SHRGROUP.ENABLED=.F.
      THISFORM.SHRGROUP.VISIBLE=.F.      
      THISFORM.ORPGROUP.ENABLED=.T.
      THISFORM.ORPGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
      THISFORM.CMDGROUP.ENABLED=.T.
      THISFORM.CMDGROUP.SETALL('ENABLED',.T.,'COMMANDBUTTON')
      THISFORM.CMDGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
      THISFORM.SETALL('READONLY',.T.,'TEXTBOX')  
      THISFORM.PAGEFRAME1.PAGE1.SETALL('READONLY',.T.,'TEXTBOX')  
      THISFORM.PAGEFRAME1.PAGE2.SETALL('READONLY',.T.,'TEXTBOX')  
      THISFORM.PAGEFRAME1.PAGE1.ENABLED=.T.
      THISFORM.PAGEFRAME1.PAGE2.ENABLED=.T.
      THISFORM.GRID1.ENABLED=.T.
      THISFORM.GRID2.ENABLED=.T.
      THISFORM.PAGEFRAME1.PAGE1.COMBOBOX07.VISIBLE=.F.
      THISFORM.PAGEFRAME1.PAGE2.COMBOBOX03.VISIBLE=.F.
      THISFORM.COMBOBOX04.VISIBLE=.F. 
      IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1       
          THISFORM.KEY_LIST.ENABLED=.T.      
          THISFORM.ANS_BOTT.VISIBLE=.T.  
          THISFORM.INVERSE_BOTT.VISIBLE=.T.        
         THISFORM.GRID1.SETFOCUS
      ELSE
         THISFORM.GRID1.ENABLED=.F.
         THISFORM.GRID2.SETFOCUS
          IF THISFORM.GRID2.ACTIVEROW=0
               SELECT  A24         
               SET ORDER TO 1
               APPEND BLANK
               LOCK()
               REPLACE  F01 WITH 'A041 '
               REPLACE  F02 WITH SUBSTR(DTOS(DATE()),3,4)
               REPLACE  F05 WITH 'AB'+F02
               REPLACE  F06 WITH '物品請領作業'
               REPLACE  F08 WITH PO_NO
               SELECT  A42_1
               DELETE
               THISFORM.PAGEFRAME1.ACTIVEPAGE=1
              THISFORM.REFRESH               
          ENDIF   
      ENDIF  
      UNLOCK ALL
  ENDPROC
  PROCEDURE SHRGROUP.FINISH_BOTT.CLICK
     IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
       SELECT  A24         
       SEEK 'A041 '+SUBSTR(DTOS(DATE()),3,4)+PO_NO
       IF !FOUND()
           APPEND BLANK
           RLOCK()
           REPLACE  F01 WITH 'A041 '
           REPLACE  F02 WITH SUBSTR(DTOS(DATE()),3,4)
           REPLACE  F05 WITH 'AB'+F02
           REPLACE  F06 WITH '物品請領作業'
           REPLACE  F08 WITH PO_NO
           UNLOCK  
        ENDIF   
       SELECT A42_1 
       DO CASE 
             CASE THISFORM.KEY_LIST.DISPLAYVALUE='依請領單號排列'
                         SET ORDER TO A42_11
             CASE THISFORM.KEY_LIST.DISPLAYVALUE='依請領人員排列'
                        SET ORDER TO A42_12
       ENDCASE       
    ENDIF    
   THISFORM.SHRGROUP.ABANDON_BOTT.CLICK
  ENDPROC     
**********  
  PROC ANS_BOTT.CLICK     &&確認程序
       IF MESSAGEBOX('是否要確認此筆資料?',4+32+256,'請確認') = 6	  
            IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
                 SELECT A42_1
                 LOCK()
                 IF RLOCK()
                     SELE RECNO() FROM A42 WHERE A42.F01=THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE INTO ARRAY BK1
                     JJ1=''                
                     IF _TALLY>0                   
                         FOR I= 1 TO ALEN(BK1)
                                JJ1=JJ1+ALLTRIM(STR(BK1(I)))+','
                         ENDFOR  
                         KK1=STUFF(JJ1,RAT(',',JJ1,1),1,'')
                         RLOCK(KK1,'A42')
                         LL1=RLOCK(KK1,'A42')
                         IF LL1=.T. AND LEN(ALLTRIM(JJ1))>0 
                             SELECT A42
                             FOR I= 1 TO ALEN(BK1)                      
                                     GO BK1(I) 
                                     
                                     REPLACE A42.F08 WITH '1'
                                     REPLACE A42.F90 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
                              ENDFOR
                          ENDIF
                      ENDIF   
                      SELECT A42_1
                      REPLACE A42_1.F08 WITH '1'
                      RELEASE ALL LIKE BK*       
                 ELSE
                      DO file_impact                  
                 ENDIF     
                 UNLOCK ALL  
                 THISFORM.GRID1.SETFOCUS                                        
            ENDIF
       ENDIF     
  ENDPROC
**********  
  PROC INVERSE_BOTT.CLICK     &&反確認程序
       IF MESSAGEBOX('是否要反確認此筆資料?',4+32+256,'請確認') = 6	   
            IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
                 SELECT A42_1
                 LOCK()
                 IF RLOCK()
                     SELE RECNO() FROM A42 WHERE A42.F01=THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE INTO ARRAY BK1
                     JJ1=''                
                     IF _TALLY>0                   
                         FOR I= 1 TO ALEN(BK1)
                                JJ1=JJ1+ALLTRIM(STR(BK1(I)))+','
                         ENDFOR  
                         KK1=STUFF(JJ1,RAT(',',JJ1,1),1,'')
                         RLOCK(KK1,'A42')
                         LL1=RLOCK(KK1,'A42')
                         IF LL1=.T. AND LEN(ALLTRIM(JJ1))>0 
                             SELECT A42
                             FOR I= 1 TO ALEN(BK1)                      
                                     GO BK1(I) 
                                     REPLACE A42.F08 WITH ' '
                                     REPLACE A42.F90 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
                              ENDFOR
                          ENDIF
                      ENDIF   
                      SELECT A42_1
                      REPLACE A42_1.F08 WITH ' '
                      RELEASE ALL LIKE BK*       
                 ELSE
                      DO file_impact                  
                 ENDIF     
                 UNLOCK ALL  
                 THISFORM.GRID1.SETFOCUS                        
            ENDIF
       ENDIF     
  ENDPROC    
  *************************************************物品類別
PROCEDURE COMBOBOX04.CLICK
    THISFORM.COMBOBOX04.CLEAR
    SELECT A42
    SELECT F04 FROM A42 WHERE F01 = THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE ORDER BY F04 INTO CURSOR A42_TEMP
    SELECT A41
    SELECT F02 FROM A41 WHERE F01 = THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE ORDER BY F02 INTO CURSOR A41B READWRITE 
    INDE ON F02 TAG A41B1
    SELECT A41B
    INDE ON F02 TAG A41B1
    SELECT A42_TEMP
    GO TOP
    DO WHILE !EOF()
           SELECT A41B
           SEEK A42_TEMP.F04
           IF FOUND()
                SELECT A41B
                DELETE 
           ENDIF
           SELECT A42_TEMP
           SKIP
    ENDDO
    SELECT A42_TEMP
    USE 
    SELECT A41B
    GO TOP
    THIS.ADDITEM('')
    DO WHILE  !EOF()
           THIS.ADDITEM(ALLTRIM(A41B.F02))
  	   SELECT  A41B
      	   SKIP
    ENDDO 
    SELECT A41B
    USE        
 ENDPROC      
 ****
  PROC PRT_BOTT.CLICK     &&列印總表  
    IF  A02.F10 <> '*'     
         A42_F03=''
         A42_F04=''
         A42_F06=0
         CREATE CURSOR A42_TEMP (F01 C(10),F02 C(8),F03 C(20),F04 C(30),F05 C(4),F06 N(4))
          SELECT * FROM A42 WHERE F08='1'  AND ALLTRIM(F07)=ALLTRIM(sys_oper) ORDER BY F03,F04 INTO CURSOR A42A
          SELECT A42A
          GO TOP
          IF _TALLY >0
               SELECT A42_TEMP
               APPEND BLANK 
               REPLACE A42_TEMP.F01 WITH A42A.F01
               REPLACE A42_TEMP.F02 WITH DTOC(A42A.F02)
               REPLACE A42_TEMP.F03 WITH A42A.F03
               REPLACE A42_TEMP.F04 WITH A42A.F04
               REPLACE A42_TEMP.F05 WITH A42A.F05
               REPLACE A42_TEMP.F06 WITH A42A.F06
               A42_F03 = A42A.F03
               A42_F04 = A42A.F04
               A42_F06 = A42A.F06
               SELECT A42A
               SKIP
               DO WHILE !EOF()
     		      IF  ALLTRIM(A42A.F03) = ALLTRIM(A42_F03) AND ALLTRIM(A42A.F04) = ALLTRIM(A42_F04)
	                   SELECT A42_TEMP
	                   APPEND BLANK 
	                   REPLACE A42_TEMP.F01 WITH A42A.F01
	                   REPLACE A42_TEMP.F02 WITH DTOC(A42A.F02)
	                   REPLACE A42_TEMP.F05 WITH A42A.F05
	                   REPLACE A42_TEMP.F06 WITH A42A.F06
	                   A42_F03 = A42A.F03
	                   A42_F04 = A42A.F04
	                   A42_F06 = A42_F06 + A42A.F06
	               ELSE    
	                   SELECT A42_TEMP
	                   APPEND BLANK 
	                   REPLACE A42_TEMP.F05 WITH '小計'
	                   REPLACE A42_TEMP.F06 WITH A42_F06
	                   SELECT A42_TEMP
	                   APPEND BLANK 
	                   REPLACE A42_TEMP.F01 WITH A42A.F01
	                   REPLACE A42_TEMP.F02 WITH DTOC(A42A.F02)
	                   REPLACE A42_TEMP.F03 WITH A42A.F03
	                   REPLACE A42_TEMP.F04 WITH A42A.F04
	                   REPLACE A42_TEMP.F05 WITH A42A.F05
	                   REPLACE A42_TEMP.F06 WITH A42A.F06
	                   A42_F03 = A42A.F03
	                   A42_F04 = A42A.F04
	                   A42_F06 = A42A.F06			           
	               ENDIF   
                       SELECT A42A
                       SKIP    
               ENDDO
	       SELECT A42_TEMP
	       APPEND BLANK 
	       REPLACE A42_TEMP.F05 WITH '小計'
	       REPLACE A42_TEMP.F06 WITH A42_F06         
	       SELECT A42_TEMP
	       GO TOP
	       REPORT FORM ALLTRIM(INT_116)+'A42B' TO PRINT PROMPT  PREVIEW
	       SELECT A42_TEMP
	       USE
	       SELECT A42A
	       USE
               CLEAR          
          ELSE
               =MESSAGEBOX('查無資料可列印',0+64,'提示訊息視窗')    
          ENDIF         
    ELSE
          RANG_SEEK=CREATEOBJECT("RANG_SEEK")  
          RANG_SEEK.SHOW      
    ENDIF 
    SELECT A42_1
    THISFORM.GRID1.SETFOCUS 
  ENDPROC   
ENDDEFINE    
***********************************************列印程序
PROCEDURE PNT_PRC  
         SELECT A42
         LK=A42_1.F01
         SELECT * FROM A42 WHERE A42.F01=LK ORDER BY F03,F04 NOWAIT 	
         REPORT FORM ALLTRIM(INT_116)+'A42A' TO PRINT PROMPT  PREVIEW
         CLEAR
ENDPROC
*************************************************員工編號
DEFINE CLASS COMBOBOX07 AS COMBOBOX 
       VISIBLE=.F.
       HEIGHT=INT_015*25
       WIDTH=INT_015*65
       FONTSIZE=INT_015*9   
       BOUNDCOLUMN=1
       ROWSOURCETYPE=1
       STYLE=2    
       VALUE=1
       NAME='COMBOBOX07'
 PROCEDURE INIT    
       SELECT F01,F03 FROM A01  ORDER BY F01 INTO CURSOR A01_TEMP
       SELECT A01_TEMP
       GO TOP  
       THIS.ADDITEM('')
       DO WHILE  !EOF()
              THIS.ADDITEM(ALLTRIM(A01_TEMP.F01)+SPACE(5-LEN(ALLTRIM(A01_TEMP.F01))+7)+A01_TEMP.F03)
      	      SELECT  A01_TEMP
      	      SKIP
       ENDDO 
       SELECT A01_TEMP
       USE   
  ENDPROC  
   PROCEDURE INTERACTIVECHANGE
           THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE=LEFT(THIS.DISPLAYVALUE,5)
           THISFORM.PAGEFRAME1.PAGE1.LBLF071.CAPTION=RIGHT(ALLTRIM(THIS.DISPLAYVALUE),LEN(ALLTRIM(THIS.DISPLAYVALUE))-10)
           THISFORM.PAGEFRAME1.PAGE1.TXTF07.REFRESH           
  ENDPROC       
ENDDEFINE
*************************************************物品類別
DEFINE CLASS COMBOBOX03 AS COMBOBOX 
       VISIBLE=.F.
       HEIGHT=INT_015*25
       WIDTH=INT_015*200
       FONTSIZE=INT_015*9   
       BOUNDCOLUMN=1
       ROWSOURCETYPE=1
       STYLE=2    
       VALUE=1
       NAME='COMBOBOX03'
 PROCEDURE INIT    
       SELECT A41
       SELECT F01 FROM A41 GROUP BY F01 ORDER BY F01 INTO CURSOR A41A
       SELECT A41A
       GO TOP
       THIS.ADDITEM('')
       DO WHILE  !EOF()
              THIS.ADDITEM(ALLTRIM(A41A.F01))
      	      SELECT  A41A
      	      SKIP
       ENDDO 
       SELECT A41A
       USE   
  ENDPROC  
   PROCEDURE INTERACTIVECHANGE
      THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=ALLTRIM(THIS.DISPLAYVALUE)+SPACE(20-LEN(ALLTRIM(THIS.DISPLAYVALUE)))
      THISFORM.PAGEFRAME1.PAGE2.TXTF03.REFRESH  
      THISFORM.COMBOBOX04.CLICK
      THISFORM.COMBOBOX04.VALUE=1
      THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE=''
      THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE=''       
  ENDPROC       
ENDDEFINE
*************************************************品項名稱
DEFINE CLASS COMBOBOX04 AS COMBOBOX 
       VISIBLE=.F.
       HEIGHT=INT_015*25
       WIDTH=INT_015*200
       FONTSIZE=INT_015*9   
       BOUNDCOLUMN=1
       ROWSOURCETYPE=1
       STYLE=2    
       VALUE=1
       NAME='COMBOBOX04'     
   PROCEDURE INTERACTIVECHANGE
      THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE=ALLTRIM(THIS.DISPLAYVALUE)+SPACE(30-LEN(ALLTRIM(THIS.DISPLAYVALUE)))
      THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE=IIF(SEEK(THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE + THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE,'A41'),A41.F03,'')
  ENDPROC       
ENDDEFINE
**********************************************************列印總表範圍
DEFINE CLASS RANG_SEEK AS FORM
       AUTOCENTER=.T.
       CAPTION='請輸入列印總表資料範圍'
       FONTSIZE=INT_015*9
       HEIGHT=INT_015*155
       WIDTH=INT_015*385
       FONTSIZE=INT_015*9
       CONTROLBOX=.F.
       BORDERSTYLE=2
       SHOWTIPS=.T.
       SHOWWINDOW=1
       WINDOWTYPE=1
       NAME='RANG_SEEK'
       ADD OBJECT LABELNOTE AS LABEL WITH;
           AUTOSIZE=.T.,;
           HEIGHT=INT_015*25,;
           LEFT=INT_015*35,;
           TOP=INT_015*30,;
           CAPTION='列印選擇',;
           NAME='LABELNOTE'       
       ADD OBJECT OPTIONGROUP_NOTE  AS OPTIONGROUP_NOTE WITH;
           VISIBLE=.T.,;
           LEFT=INT_015*85,;
           TOP=INT_015*10,; 
           ENABLED=.T. 
       ADD OBJECT LABEL1 AS LABEL WITH;
           AUTOSIZE=.T.,;
           HEIGHT=INT_015*25,;
           LEFT=INT_015*10,;
           TOP=INT_015*85,;
           CAPTION='起始人員編號',;
           NAME='LABEL1'
       ADD OBJECT LABEL11 AS LABEL WITH;
           AUTOSIZE=.T.,;
           HEIGHT=INT_015*25,;
           LEFT=INT_015*150,;
           TOP=INT_015*85,;
           CAPTION='',;
           NAME='LABEL11'           
       ADD OBJECT TEXT1 AS TEXTBOX WITH;
           TOP=INT_015*80,;
           LEFT=INT_015*85,;
           HEIGHT=INT_015*25,; 
           WIDTH=INT_015*50,;
           NAME='TEXT1'        
       ADD OBJECT COMBOBOX031 AS COMBOBOX03 WITH;
           TOP=INT_015*80,;
           LEFT=INT_015*85,;
           NAME='COMBOBOX031'                        
       ADD OBJECT COMBOBOX041 AS COMBOBOX04A WITH;
           TOP=INT_015*80,;
           LEFT=INT_015*85,;
           NAME='COMBOBOX041'                            
       ADD OBJECT LABEL2 AS LABEL WITH;
           AUTOSIZE=.T.,;
           HEIGHT=INT_015*25,;
           LEFT=INT_015*10,;
           TOP=INT_015*115,;
           CAPTION='截止人員編號',;
           NAME='LABEL2' 
       ADD OBJECT LABEL21 AS LABEL WITH;
           AUTOSIZE=.T.,;
           HEIGHT=INT_015*25,;
           LEFT=INT_015*150,;
           TOP=INT_015*115,;
           CAPTION='',;
           NAME='LABEL21'            
       ADD OBJECT TEXT2 AS TEXTBOX WITH;
           TOP=INT_015*110,;
           LEFT=INT_015*85,;
           HEIGHT=INT_015*25,;  
           WIDTH=INT_015*50,;       
           NAME='TEXT2'           
       ADD OBJECT COMBOBOX032 AS COMBOBOX03 WITH;
           TOP=INT_015*110,;
           LEFT=INT_015*85,;   
           NAME='COMBOBOX032'                 
       ADD OBJECT COMBOBOX042 AS COMBOBOX04A WITH;
           TOP=INT_015*110,;
           LEFT=INT_015*85,;   
           NAME='COMBOBOX042'                    
       ADD OBJECT CMND1 AS COMMANDBUTTON WITH;
           AUTOSIZE=.T.,;
           LEFT=INT_015*295,;    
           HEIGHT=INT_015*25,;   
           TOP=INT_015*80,;  
           WIDTH=INT_015*75,;
           CAPTION='\<Y.執行',;
           TOOLTIPTEXT='確認所輸入的範圍鍵值!快速鍵->ALT+Y',;
           NAME='CMND1'
       ADD OBJECT CMND2 AS COMMANDBUTTON WITH;
           AUTOSIZE=.T.,;
           LEFT=INT_015*295,;
           TOP=INT_015*110,;
           HEIGHT=INT_015*25,;
           WIDTH=INT_015*75,;
           CAPTION='\<C.取消',;
           TOOLTIPTEXT='取消作業!快速鍵->ALT+C',;
           NAME='CMND2'
       PROCEDURE INIT     
            THISFORM.SETALL('FONTSIZE',INT_015*9,'TEXTBOX')
            THISFORM.SETALL('FONTSIZE',INT_015*9,'LABEL')      
            THISFORM.SETALL('FONTSIZE',INT_015*9,'COMMANDBUTTON')             
            THISFORM.TEXT1.VALUE=A42_1.F07
            THISFORM.TEXT2.VALUE=A42_1.F07       
            THISFORM.LABEL11.CAPTION=A42_1.F071
            THISFORM.LABEL21.CAPTION=A42_1.F071                                  
       ENDPROC     
       *********        
       PROCEDURE TEXT1.INTERACTIVECHANGE
          IF THISFORM.OPTIONGROUP_NOTE.VALUE=1 
               THISFORM.LABEL11.CAPTION=IIF(SEEK(ALLTRIM(THIS.VALUE),'A01'),A01.F03,'')
          ENDIF  
       ENDPROC
       PROCEDURE TEXT2.INTERACTIVECHANGE
          IF THISFORM.OPTIONGROUP_NOTE.VALUE=1 
            THISFORM.LABEL21.CAPTION=IIF(SEEK(ALLTRIM(THIS.VALUE),'A01'),A01.F03,'')
          ENDIF 
       ENDPROC  
       **********     
       PROCEDURE CMND1.CLICK
          DO CASE 
                CASE THISFORM.OPTIONGROUP_NOTE.VALUE=1
                           SELECT * FROM A42 WHERE  ALLTRIM(A42.F07)>=ALLTRIM(THISFORM.TEXT1.VALUE) AND ALLTRIM(A42.F07)<=ALLTRIM(THISFORM.TEXT2.VALUE) ;
                                          AND A42.F08='1' ORDER BY F03,F04,F07 INTO CURSOR A42A                                                              
                CASE THISFORM.OPTIONGROUP_NOTE.VALUE=2
                           SELECT * FROM A42 WHERE  A42.F02>=THISFORM.TEXT1.VALUE AND A42.F02<=THISFORM.TEXT2.VALUE ;
                                          AND A42.F08='1' ORDER BY F03,F04,F07 INTO CURSOR A42A                    
                CASE THISFORM.OPTIONGROUP_NOTE.VALUE=3
                           SELECT * FROM A42 WHERE  ALLTRIM(A42.F03)>=ALLTRIM(THISFORM.COMBOBOX031.DISPLAYVALUE) AND ALLTRIM(A42.F03)<=ALLTRIM(THISFORM.COMBOBOX032.DISPLAYVALUE) ;
                                          AND A42.F08='1' ORDER BY F03,F04,F07 INTO CURSOR A42A                               
                CASE THISFORM.OPTIONGROUP_NOTE.VALUE=4
                           SELECT * FROM A42 WHERE  ALLTRIM(A42.F04)>=ALLTRIM(THISFORM.COMBOBOX041.DISPLAYVALUE) AND ALLTRIM(A42.F04)<=ALLTRIM(THISFORM.COMBOBOX042.DISPLAYVALUE) ;
                                          AND A42.F08='1' ORDER BY F03,F04,F07 INTO CURSOR A42A                                           
          ENDCASE     
          SELECT A42A
          GO TOP
	  IF _TALLY >0 
               A42_F03=''
               A42_F04=''
               A42_F06=0
               CREATE CURSOR A42_TEMP (F01 C(10),F02 C(8),F03 C(20),F04 C(30),F05 C(4),F06 N(4),F07 C(8))
               SELECT A42_TEMP
               APPEND BLANK 
               REPLACE A42_TEMP.F01 WITH A42A.F01
               REPLACE A42_TEMP.F02 WITH DTOC(A42A.F02)
               REPLACE A42_TEMP.F03 WITH A42A.F03
               REPLACE A42_TEMP.F04 WITH A42A.F04
               REPLACE A42_TEMP.F05 WITH A42A.F05
               REPLACE A42_TEMP.F06 WITH A42A.F06
               REPLACE A42_TEMP.F07 WITH IIF(SEEK(A42A.F07,'A01'),A01.F03,'')
               A42_F03 = A42A.F03
               A42_F04 = A42A.F04
               A42_F06 = A42A.F06
               SELECT A42A
               SKIP               
               DO WHILE !EOF()
     		      IF  ALLTRIM(A42A.F03) = ALLTRIM(A42_F03) AND ALLTRIM(A42A.F04) = ALLTRIM(A42_F04)
	                   SELECT A42_TEMP
	                   APPEND BLANK 
	                   REPLACE A42_TEMP.F01 WITH A42A.F01
	                   REPLACE A42_TEMP.F02 WITH DTOC(A42A.F02)
	                   REPLACE A42_TEMP.F05 WITH A42A.F05
	                   REPLACE A42_TEMP.F06 WITH A42A.F06
	                   REPLACE A42_TEMP.F07 WITH IIF(SEEK(A42A.F07,'A01'),A01.F03,'')
	                   A42_F03 = A42A.F03
	                   A42_F04 = A42A.F04
	                   A42_F06 = A42_F06 + A42A.F06
	               ELSE    
	                   SELECT A42_TEMP
	                   APPEND BLANK 
	                   REPLACE A42_TEMP.F05 WITH '小計'
	                   REPLACE A42_TEMP.F06 WITH A42_F06
	                   SELECT A42_TEMP
	                   APPEND BLANK 
	                   REPLACE A42_TEMP.F01 WITH A42A.F01
	                   REPLACE A42_TEMP.F02 WITH DTOC(A42A.F02)
	                   REPLACE A42_TEMP.F03 WITH A42A.F03
	                   REPLACE A42_TEMP.F04 WITH A42A.F04
	                   REPLACE A42_TEMP.F05 WITH A42A.F05
	                   REPLACE A42_TEMP.F06 WITH A42A.F06
	                   REPLACE A42_TEMP.F07 WITH IIF(SEEK(A42A.F07,'A01'),A01.F03,'')
	                   A42_F03 = A42A.F03
	                   A42_F04 = A42A.F04
	                   A42_F06 = A42A.F06			           
	               ENDIF   
                       SELECT A42A
                       SKIP    
               ENDDO               
	       SELECT A42_TEMP
	       APPEND BLANK 
	       REPLACE A42_TEMP.F05 WITH '小計'
	       REPLACE A42_TEMP.F06 WITH A42_F06                      
               SELECT A42_TEMP
               GO TOP
               REPORT FORM ALLTRIM(INT_116)+'A42C' TO PRINT PROMPT  PREVIEW  
               CLEAR 
               SELECT A42_TEMP
               USE
               SELECT A42A
               USE   
	  ELSE
		=MESSAGEBOX('查無資料可列印',0+64,'提示訊息視窗')
	  ENDIF    
          THISFORM.CMND2.CLICK           
    ENDPROC  
    PROCEDURE CMND2.CLICK
           FLG='1'   
           THISFORM.RELEASE                   
    ENDPROC        
 ENDDEFINE     
********列印選擇
DEFINE CLASS OPTIONGROUP_NOTE AS OPTIONGROUP
   VISIBLE=.T.
   HEIGHT=INT_015*55
   WIDTH=INT_015*275
   BUTTONCOUNT=4
   VALUE=1
   ENABLED=.T.	   
   NAME='OPTIONGROUP_NOTE'
   OPTION1.CAPTION='依人員編號列印'
   OPTION1.FONTSIZE=INT_015*9     
   OPTION1.TOP=INT_015*5
   OPTION1.AUTOSIZE=.T.
   OPTION1.LEFT=INT_015*5 
   OPTION1.NAME='OPTION1'
   OPTION2.CAPTION='依領用日期列印'
   OPTION2.FONTSIZE=INT_015*9
   OPTION2.TOP=INT_015*5
   OPTION2.AUTOSIZE=.T.
   OPTION2.LEFT=INT_015*165
   OPTION2.NAME='OPTION2'	 
   OPTION3.CAPTION='依物品類別列印'
   OPTION3.FONTSIZE=INT_015*9   
   OPTION3.TOP=INT_015*30
   OPTION3.AUTOSIZE=.T.
   OPTION3.LEFT=INT_015*5
   OPTION3.NAME='OPTION3' 	
   OPTION4.CAPTION='依品項名稱列印'
   OPTION4.FONTSIZE=INT_015*9   
   OPTION4.TOP=INT_015*30
   OPTION4.AUTOSIZE=.T.
   OPTION4.LEFT=INT_015*165
   OPTION4.NAME='OPTION4'     
   PROCEDURE INTERACTIVECHANGE
      DO CASE
            CASE THIS.VALUE=1
                       THISFORM.LABEL1.VISIBLE=.T.  
                       THISFORM.LABEL2.VISIBLE=.T.         
	               THISFORM.LABEL11.VISIBLE=.T.  
	               THISFORM.LABEL21.VISIBLE=.T.                              
                       THISFORM.TEXT1.VISIBLE=.T.  
                       THISFORM.TEXT2.VISIBLE=.T.                         
                       THISFORM.COMBOBOX031.VISIBLE=.F.  
                       THISFORM.COMBOBOX032.VISIBLE=.F.          
                       THISFORM.COMBOBOX041.VISIBLE=.F.  
                       THISFORM.COMBOBOX042.VISIBLE=.F.                 
                       THISFORM.LABEL1.CAPTION='起始人員編號'
            	       THISFORM.LABEL2.CAPTION='截止人員編號'
            	       THISFORM.TEXT1.WIDTH=INT_015*50
            	       THISFORM.TEXT2.WIDTH=INT_015*50
                       THISFORM.TEXT1.VALUE=A42_1.F07
                       THISFORM.TEXT2.VALUE=A42_1.F07
	               THISFORM.LABEL11.CAPTION=A42_1.F071
	               THISFORM.LABEL21.CAPTION=A42_1.F071                   
            CASE THIS.VALUE=2 
	               THISFORM.LABEL11.VISIBLE=.F.  
	               THISFORM.LABEL21.VISIBLE=.F.                                    
                       THISFORM.TEXT1.VISIBLE=.T.  
                       THISFORM.TEXT2.VISIBLE=.T.                         
                       THISFORM.COMBOBOX031.VISIBLE=.F.  
                       THISFORM.COMBOBOX032.VISIBLE=.F.          
                       THISFORM.COMBOBOX041.VISIBLE=.F.  
                       THISFORM.COMBOBOX042.VISIBLE=.F.                   
                       THISFORM.LABEL1.CAPTION='起始申請日期'
            	       THISFORM.LABEL2.CAPTION='截止申請日期'
            	       THISFORM.TEXT1.WIDTH=INT_015*75
            	       THISFORM.TEXT2.WIDTH=INT_015*75
                       THISFORM.TEXT1.VALUE=A42_1.F02
                       THISFORM.TEXT2.VALUE=A42_1.F02                          
            CASE THIS.VALUE=3
	               THISFORM.LABEL11.VISIBLE=.F.  
	               THISFORM.LABEL21.VISIBLE=.F.                                   
                       THISFORM.TEXT1.VISIBLE=.F.  
                       THISFORM.TEXT2.VISIBLE=.F.                         
                       THISFORM.COMBOBOX031.VISIBLE=.T.  
                       THISFORM.COMBOBOX032.VISIBLE=.T.          
                       THISFORM.COMBOBOX041.VISIBLE=.F.  
                       THISFORM.COMBOBOX042.VISIBLE=.F.                                
                       THISFORM.LABEL1.CAPTION='起始物品類別'
            	       THISFORM.LABEL2.CAPTION='截止物品類別'
            	       THISFORM.TEXT1.WIDTH=INT_015*180
            	       THISFORM.TEXT2.WIDTH=INT_015*180   
                       THISFORM.COMBOBOX031.WIDTH=INT_015*180
                       THISFORM.COMBOBOX032.WIDTH=INT_015*180                                                   
            CASE THIS.VALUE=4
	               THISFORM.LABEL11.VISIBLE=.F.  
	               THISFORM.LABEL21.VISIBLE=.F.                                   
                       THISFORM.TEXT1.VISIBLE=.F.  
                       THISFORM.TEXT2.VISIBLE=.F.                 
                       THISFORM.COMBOBOX031.VISIBLE=.F.  
                       THISFORM.COMBOBOX032.VISIBLE=.F.                                 
                       THISFORM.COMBOBOX041.VISIBLE=.T.  
                       THISFORM.COMBOBOX042.VISIBLE=.T.                
                       THISFORM.LABEL1.CAPTION='起始品項名稱'
            	       THISFORM.LABEL2.CAPTION='截止品項名稱'
            	       THISFORM.TEXT1.WIDTH=INT_015*180
            	       THISFORM.TEXT2.WIDTH=INT_015*180
                       THISFORM.COMBOBOX041.WIDTH=INT_015*180
                       THISFORM.COMBOBOX042.WIDTH=INT_015*180                  
      ENDCASE   
  ENDPROC  
ENDDEFINE
*************************************************品項名稱(列印總表用)
DEFINE CLASS COMBOBOX04A AS COMBOBOX 
       VISIBLE=.F.
       HEIGHT=INT_015*25
       WIDTH=INT_015*200
       FONTSIZE=INT_015*9   
       BOUNDCOLUMN=1
       ROWSOURCETYPE=1
       STYLE=2    
       VALUE=1
       NAME='COMBOBOX04A'     
 PROCEDURE INIT    
       SELECT A41
       SELECT F02 FROM A41 GROUP BY F02 ORDER BY F02 INTO CURSOR A41A
       SELECT A41A
       GO TOP
       THIS.ADDITEM('')
       DO WHILE  !EOF()
              THIS.ADDITEM(ALLTRIM(A41A.F02))
      	      SELECT  A41A
      	      SKIP
       ENDDO 
       SELECT A41A
       USE   
  ENDPROC         
   PROCEDURE INTERACTIVECHANGE
   
  ENDPROC       
ENDDEFINE