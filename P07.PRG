**程式名稱:待處理請購明細
set excl off
close all
clear 
AREA1='P07'
RE_NO = 0
FLG='0'
FCH=''
CHK=''
IF !USED('A01')
   SELE 0
   USE A01
ELSE 
   SELE A01
ENDIF
SET ORDER TO A01      
IF !USED('A02')
   SELE 0
   USE A02 INDE A02
ELSE
   SELE A02
ENDIF
SET ORDER TO A021      
SEEK sys_oper+'P07'      
IF !USED ('B01')
   SELE 0
   USE B01 
ELSE 
   SELE B01
ENDIF
SET ORDER TO B011  
IF !USED('C04')
   SELE 0
   USE C04
ELSE 
   SELE C04
ENDIF
SET ORDER TO C041  
IF !USED('P06')
   SELE 0
   USE P06 INDE P06
ELSE
   SELE P06
ENDIF
SET ORDER TO P061            
IF !USED('P07')
   SELE 0
   USE P07 
ELSE
   SELE P07
ENDIF
SET ORDER TO P071
GO TOP
SET RELA TO F10 INTO A01 
P07FORM=CREATEOBJECT("TKP07")
P07FORM.SHOW  
DEFINE CLASS TKP07 AS FORM
  CAPTION='P07.待處理請購明細'
*!*	  AUTOCENTER=.T.
  CONTROLBOX=.F.
  BORDERSTYLE=1  
  MAXBUTTON=.F.
  MINBUTTON=.F.
  MOVABLE=.F.
  CLOSABLE=.F.
  CONTROLCOUNT=57
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*550
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WIDTH=INT_015*800
  WINDOWTYPE=1
 ADD OBJECT LBL_REC AS LBL_REC WITH;
      LEFT=INT_015*640,;
      WIDTH=INT_015*75,;
      CAPTION='待處理筆數：',;
      TOP=INT_015*8  
  ADD OBJECT REC_COUNT AS REC_COUNT  WITH;
      CAPTION='',;
      LEFT=INT_015*720,;
      WIDTH=INT_015*60,;
      TOP=INT_015*7
  ADD OBJECT KEY_LIST AS KEY_LIST WITH;
      AUTOCENTER=.T.
  ADD OBJECT GRID1 AS GRID1 WITH;
      COLUMNCOUNT=10,;            
      RECORDSOURCE='P07',; 
      HEIGHT=INT_015*500,;     
      WIDTH=INT_015*800,;      
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;
      COLUMN3.NAME='COLUMN3',; 
      COLUMN4.NAME='COLUMN4',; 
      COLUMN5.NAME='COLUMN5',;             
      COLUMN6.NAME='COLUMN6',;       
      COLUMN7.NAME='COLUMN7',;       
      COLUMN8.NAME='COLUMN8',;
      COLUMN9.NAME='COLUMN9',;         
      COLUMN10.NAME='COLUMN10'
  ADD OBJECT ORPGROUP AS ORPGROUP WITH;      
      TOP=INT_015*0,;
      LEFT=INT_015*382              
  ADD OBJECT CMDGROUP AS CMDGROUP WITH;
      TOP=INT_015*0,;
      LEFT=INT_015*250,;
      ENABLED=.T.,;
      VISIBLE=.T.   
  ADD OBJECT CNL_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*5,;
      LEFT=INT_015*465,;
      HEIGHT=INT_015*25,;
      FONTSIZE=INT_015*9,;      
      WIDTH=INT_015*45,;
      CAPTION='\<C.取消',;
      NAME='CNL_BOTT'                        
  PROCEDURE INIT
       RE_NO = RECCOUNT()
       THISFORM.REC_COUNT.CAPTION = ALLTRIM(STR(RE_NO))
       THISFORM.ORPGROUP.NEW_BOTT.VISIBLE=.F.
       THISFORM.ORPGROUP.EDIT_BOTT.VISIBLE=.F.
       THISFORM.ORPGROUP.DEL_BOTT.VISIBLE=.F.
       THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限  
       THISFORM.CNL_BOTT.ENABLED=IIF(A02.F08='*',.T.,.F.)   &&判斷有無取消的權限  
       THISFORM.GRID1.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)    
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'COLUMN')
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'HEADER')
       THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(P07.F11=0 .AND. DATE()-P07.F02>INT_087,RGB(255,0,0),IIF(P07.F11>0 .AND.;
       DATE()-P07.F02>INT_088,RGB(255,255,0),IIF(P07.F11>0 .AND. DATE()-P07.F02=<INT_088,RGB(0,255,0),'')))","COLUMN")                                         
       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*80
       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*149
       THISFORM.GRID1.COLUMN3.WIDTH=INT_015*90
       THISFORM.GRID1.COLUMN4.WIDTH=INT_015*70
       THISFORM.GRID1.COLUMN5.WIDTH=INT_015*70
       THISFORM.GRID1.COLUMN6.WIDTH=INT_015*50
       THISFORM.GRID1.COLUMN7.WIDTH=INT_015*60
       THISFORM.GRID1.COLUMN8.WIDTH=INT_015*80
       THISFORM.GRID1.COLUMN9.WIDTH=INT_015*70       
       THISFORM.GRID1.COLUMN10.WIDTH=INT_015*80       
       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='請購單號'
	   THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='料        號'	          
  	   THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='請購數量'	   
	   THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='請購日期'	   	   
	   THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='需求日期'
  	   THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='對象編號'  	   
  	   THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='對象簡稱'
  	   THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='需求單號' 
  	   THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='請購人員'   	   
  	   THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='來源類別'   	
	   THISFORM.GRID1.COLUMN1.CONTROLSOURCE='P07.F01'
	   THISFORM.GRID1.COLUMN2.CONTROLSOURCE='P07.F06'
	   THISFORM.GRID1.COLUMN3.CONTROLSOURCE='P07.F07'
	   THISFORM.GRID1.COLUMN4.CONTROLSOURCE='P07.F02'
	   THISFORM.GRID1.COLUMN5.CONTROLSOURCE='P07.F08'
	   THISFORM.GRID1.COLUMN6.CONTROLSOURCE='P07.F03'
	   THISFORM.GRID1.COLUMN7.CONTROLSOURCE='P07.F04'
	   THISFORM.GRID1.COLUMN8.CONTROLSOURCE='P07.F05'	   
	   THISFORM.GRID1.COLUMN9.CONTROLSOURCE='A01.F03'	 
	   THISFORM.GRID1.COLUMN10.CONTROLSOURCE="IIF(P07.F03='C6666','特殊備料',ICASE(P07.F12='1','正式訂單',P07.F12='2','預購訂單','空頭訂單'))"	    
       THISFORM.GRID1.READONLY=.T.       
       THISFORM.GRID1.SETFOCUS        
       JK='請購單號'
  ENDPROC     
  PROC KEY_LIST.INIT 
       WITH THIS 
           .ADDITEM('依請購單號+料號排列')
           .ADDITEM('依需求對象+料號排列')
           .ADDITEM('依需求單號+料號排列')           
           .ADDITEM('依料號+需求日期排列')           
           .ADDITEM('依需求日期+料號排列')           
           .ADDITEM('依請購人員+料號排列')           
       ENDWITH      
  ENDPROC 
  PROC KEY_LIST.INTERACTIVECHANGE                 
       SELE P07
       DO CASE
          CASE THIS.DISPLAYVALUE='依請購單號+料號排列'
               SET ORDER TO P071 
               THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='請購單號'
	           THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='料        號'	          
         	   THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='請購數量'	   
	           THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='請購日期'	   	   
        	   THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='需求日期'
  	           THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='對象編號'  	   
        	   THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='對象簡稱'
  	           THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='需求單號' 
        	   THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='請購人員'   	   
	           THISFORM.GRID1.COLUMN1.CONTROLSOURCE='P07.F01'
        	   THISFORM.GRID1.COLUMN2.CONTROLSOURCE='P07.F06'
        	   THISFORM.GRID1.COLUMN3.CONTROLSOURCE='P07.F07'
        	   THISFORM.GRID1.COLUMN4.CONTROLSOURCE='P07.F02'
        	   THISFORM.GRID1.COLUMN5.CONTROLSOURCE='P07.F08'
        	   THISFORM.GRID1.COLUMN6.CONTROLSOURCE='P07.F03'
        	   THISFORM.GRID1.COLUMN7.CONTROLSOURCE='P07.F04'
        	   THISFORM.GRID1.COLUMN8.CONTROLSOURCE='P07.F05'	   
        	   THISFORM.GRID1.COLUMN9.CONTROLSOURCE='A01.F03'	     	   
               THISFORM.GRID1.COLUMN1.WIDTH=INT_015*80
               THISFORM.GRID1.COLUMN2.WIDTH=INT_015*149
               THISFORM.GRID1.COLUMN3.WIDTH=INT_015*90
               THISFORM.GRID1.COLUMN4.WIDTH=INT_015*70
               THISFORM.GRID1.COLUMN5.WIDTH=INT_015*70
               THISFORM.GRID1.COLUMN6.WIDTH=INT_015*50
               THISFORM.GRID1.COLUMN7.WIDTH=INT_015*60
               THISFORM.GRID1.COLUMN8.WIDTH=INT_015*80
               THISFORM.GRID1.COLUMN9.WIDTH=INT_015*70
          CASE THIS.DISPLAYVALUE='依需求對象+料號排列'
               SET ORDER TO P072          
  	           THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='對象編號'
        	   THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='對象簡稱'  	                        
	           THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='料        號'	                  	   
               THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='請購單號'
         	   THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='請購數量'	   
	           THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='請購日期'	   	   
        	   THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='需求日期'
  	           THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='需求單號' 
        	   THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='請購人員'   	   
	           THISFORM.GRID1.COLUMN1.CONTROLSOURCE='P07.F03'
        	   THISFORM.GRID1.COLUMN2.CONTROLSOURCE='P07.F04'
        	   THISFORM.GRID1.COLUMN3.CONTROLSOURCE='P07.F06'
        	   THISFORM.GRID1.COLUMN4.CONTROLSOURCE='P07.F07'
        	   THISFORM.GRID1.COLUMN5.CONTROLSOURCE='P07.F01'
        	   THISFORM.GRID1.COLUMN6.CONTROLSOURCE='P07.F02'
        	   THISFORM.GRID1.COLUMN7.CONTROLSOURCE='P07.F08'
        	   THISFORM.GRID1.COLUMN8.CONTROLSOURCE='P07.F05'	   
        	   THISFORM.GRID1.COLUMN9.CONTROLSOURCE='A01.F03'	     	   
               THISFORM.GRID1.COLUMN1.WIDTH=INT_015*50
               THISFORM.GRID1.COLUMN2.WIDTH=INT_015*70
               THISFORM.GRID1.COLUMN3.WIDTH=INT_015*149
               THISFORM.GRID1.COLUMN4.WIDTH=INT_015*80
               THISFORM.GRID1.COLUMN5.WIDTH=INT_015*90
               THISFORM.GRID1.COLUMN6.WIDTH=INT_015*70
               THISFORM.GRID1.COLUMN7.WIDTH=INT_015*70
               THISFORM.GRID1.COLUMN8.WIDTH=INT_015*80
               THISFORM.GRID1.COLUMN9.WIDTH=INT_015*70                           
          CASE THIS.DISPLAYVALUE='依需求單號+料號排列'
               SET ORDER TO P073                                     	                                       
  	           THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='需求單號'
	           THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='料        號'
	           THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='對象編號'	                  	   	           
        	   THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='對象簡稱'  	                        
               THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='請購單號'
         	   THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='請購數量'	   
	           THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='請購日期'	   	   
        	   THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='需求日期'
        	   THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='請購人員'   	   
        	  
	           THISFORM.GRID1.COLUMN1.CONTROLSOURCE='P07.F05'
        	   THISFORM.GRID1.COLUMN2.CONTROLSOURCE='P07.F06'
        	   THISFORM.GRID1.COLUMN3.CONTROLSOURCE='P07.F03'
        	   THISFORM.GRID1.COLUMN4.CONTROLSOURCE='P07.F04'
        	   THISFORM.GRID1.COLUMN5.CONTROLSOURCE='P07.F01'
        	   THISFORM.GRID1.COLUMN6.CONTROLSOURCE='P07.F07'
        	   THISFORM.GRID1.COLUMN7.CONTROLSOURCE='P07.F02'
        	   THISFORM.GRID1.COLUMN8.CONTROLSOURCE='P07.F08'	   
        	   THISFORM.GRID1.COLUMN9.CONTROLSOURCE='A01.F03'	     	   
               THISFORM.GRID1.COLUMN1.WIDTH=INT_015*80
               THISFORM.GRID1.COLUMN2.WIDTH=INT_015*149
               THISFORM.GRID1.COLUMN3.WIDTH=INT_015*50
               THISFORM.GRID1.COLUMN4.WIDTH=INT_015*80
               THISFORM.GRID1.COLUMN5.WIDTH=INT_015*80
               THISFORM.GRID1.COLUMN6.WIDTH=INT_015*90
               THISFORM.GRID1.COLUMN7.WIDTH=INT_015*70
               THISFORM.GRID1.COLUMN8.WIDTH=INT_015*70
               THISFORM.GRID1.COLUMN9.WIDTH=INT_015*70                           
          CASE THIS.DISPLAYVALUE='依料號+需求日期排列'
               SET ORDER TO P074          
   	           THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='料        號'
           	   THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='需求日期'
  	           THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='需求單號'
	           THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='對象編號'	                  	   	           
        	   THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='對象簡稱'  	                        
               THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='請購單號'
         	   THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='請購數量'	   
	           THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='請購日期'	   	   
        	   THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='請購人員'   	   
	           THISFORM.GRID1.COLUMN1.CONTROLSOURCE='P07.F06'
        	   THISFORM.GRID1.COLUMN2.CONTROLSOURCE='P07.F08'
        	   THISFORM.GRID1.COLUMN3.CONTROLSOURCE='P07.F05'
        	   THISFORM.GRID1.COLUMN4.CONTROLSOURCE='P07.F03'
        	   THISFORM.GRID1.COLUMN5.CONTROLSOURCE='P07.F04'
        	   THISFORM.GRID1.COLUMN6.CONTROLSOURCE='P07.F01'
        	   THISFORM.GRID1.COLUMN7.CONTROLSOURCE='P07.F07'
        	   THISFORM.GRID1.COLUMN8.CONTROLSOURCE='P07.F02'	   
        	   THISFORM.GRID1.COLUMN9.CONTROLSOURCE='A01.F03'	     	   
               THISFORM.GRID1.COLUMN1.WIDTH=INT_015*149
               THISFORM.GRID1.COLUMN2.WIDTH=INT_015*70
               THISFORM.GRID1.COLUMN3.WIDTH=INT_015*80
               THISFORM.GRID1.COLUMN4.WIDTH=INT_015*50
               THISFORM.GRID1.COLUMN5.WIDTH=INT_015*80
               THISFORM.GRID1.COLUMN6.WIDTH=INT_015*80
               THISFORM.GRID1.COLUMN7.WIDTH=INT_015*90
               THISFORM.GRID1.COLUMN8.WIDTH=INT_015*70
               THISFORM.GRID1.COLUMN9.WIDTH=INT_015*70                           
          CASE THIS.DISPLAYVALUE='依需求日期+料號排列'
           	   THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='需求日期'          
   	           THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='料        號'
  	           THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='需求單號'
	           THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='對象編號'	                  	   	           
        	   THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='對象簡稱'  	                        
               THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='請購單號'
         	   THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='請購數量'	   
	           THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='請購日期'	   	   
        	   THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='請購人員'   	   
	           THISFORM.GRID1.COLUMN1.CONTROLSOURCE='P07.F08'
        	   THISFORM.GRID1.COLUMN2.CONTROLSOURCE='P07.F06'
        	   THISFORM.GRID1.COLUMN3.CONTROLSOURCE='P07.F05'
        	   THISFORM.GRID1.COLUMN4.CONTROLSOURCE='P07.F03'
        	   THISFORM.GRID1.COLUMN5.CONTROLSOURCE='P07.F04'
        	   THISFORM.GRID1.COLUMN6.CONTROLSOURCE='P07.F01'
        	   THISFORM.GRID1.COLUMN7.CONTROLSOURCE='P07.F07'
        	   THISFORM.GRID1.COLUMN8.CONTROLSOURCE='P07.F02'	   
        	   THISFORM.GRID1.COLUMN9.CONTROLSOURCE='A01.F03'	     	   
               THISFORM.GRID1.COLUMN1.WIDTH=INT_015*70	   
               THISFORM.GRID1.COLUMN2.WIDTH=INT_015*149
               THISFORM.GRID1.COLUMN3.WIDTH=INT_015*80
               THISFORM.GRID1.COLUMN4.WIDTH=INT_015*50
               THISFORM.GRID1.COLUMN5.WIDTH=INT_015*80
               THISFORM.GRID1.COLUMN6.WIDTH=INT_015*80
               THISFORM.GRID1.COLUMN7.WIDTH=INT_015*90
               THISFORM.GRID1.COLUMN8.WIDTH=INT_015*70
               THISFORM.GRID1.COLUMN9.WIDTH=INT_015*70            
               SET ORDER TO P075               
          CASE THIS.DISPLAYVALUE='依請購人員+料號排列'  
               SET ORDER TO P076                                          
        	   THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='請購人員'   	             
   	           THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='料        號'
  	           THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='需求單號'
	           THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='對象編號'	                  	   	           
        	   THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='對象簡稱'  	                        
               THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='請購單號'
         	   THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='請購數量'	   
	           THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='請購日期'	   	   
           	   THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='需求日期'          
	           THISFORM.GRID1.COLUMN1.CONTROLSOURCE='A01.F03'
        	   THISFORM.GRID1.COLUMN2.CONTROLSOURCE='P07.F06'
        	   THISFORM.GRID1.COLUMN3.CONTROLSOURCE='P07.F05'
        	   THISFORM.GRID1.COLUMN4.CONTROLSOURCE='P07.F03'
        	   THISFORM.GRID1.COLUMN5.CONTROLSOURCE='P07.F04'
        	   THISFORM.GRID1.COLUMN6.CONTROLSOURCE='P07.F01'
        	   THISFORM.GRID1.COLUMN7.CONTROLSOURCE='P07.F07'
        	   THISFORM.GRID1.COLUMN8.CONTROLSOURCE='P07.F02'	   
        	   THISFORM.GRID1.COLUMN9.CONTROLSOURCE='P07.F08'	   
               THISFORM.GRID1.COLUMN1.WIDTH=INT_015*70                    	     	   
               THISFORM.GRID1.COLUMN2.WIDTH=INT_015*149
               THISFORM.GRID1.COLUMN3.WIDTH=INT_015*80
               THISFORM.GRID1.COLUMN4.WIDTH=INT_015*50
               THISFORM.GRID1.COLUMN5.WIDTH=INT_015*80
               THISFORM.GRID1.COLUMN6.WIDTH=INT_015*80
               THISFORM.GRID1.COLUMN7.WIDTH=INT_015*90
               THISFORM.GRID1.COLUMN8.WIDTH=INT_015*70
               THISFORM.GRID1.COLUMN9.WIDTH=INT_015*70        	                  
       ENDCASE 
       JK=THISFORM.GRID1.COLUMN1.HEADER1.CAPTION
       THISFORM.GRID1.REFRESH
       THISFORM.GRID1.SETFOCUS
  ENDPROC                
  PROC GRID1.AFTERROWCOLCHANGE
       LPARAMETERS nColIndex
       THISFORM.GRID1.TOOLTIPTEXT=IIF(P07.F11=0 .AND. DATE()-P07.F02>INT_087,'超過'+ALLTRIM(STR(INT_087))+'天未請購',IIF(P07.F11>0 .AND. DATE()-P07.F02>INT_088,'已請購且超過'+ALLTRIM(STR(INT_088))+'天未回覆',IIF(P07.F11>0 .AND. DATE()-P07.F02=<INT_088,'已請購','')))
       FCH=THISFORM.ACTIVECONTROL.NAME
       CHK=''
       THISFORM.REFRESH
  ENDPROC  
  PROC CNL_BOTT.CLICK
       IF MESSAGEBOX('是否確認取消此筆請購?',4+32+256,'請確認') = 6	        
          SELECT P07
          IF RLOCK()
             SELECT C04       &&取消單筆資料       
             SEEK P07.F05 + P07.F06
             IF FOUND()                                          
		        REPLACE C04.F11 WITH 0
		     ENDIF   
			 SELECT P06
			 SEEK P07.F01 + P07.F06
			 IF FOUND()     
			    REPLACE P06.F90 WITH DTOC(DATE()) + ' ' + IIF(SEEK(SYS_OPER,'A01'),A01.F03,'') + SPACE(2) + '取消'
			 ENDIF
             SELECT P07
             DELETE  
             RE_NO = RE_NO - 1
             THISFORM.REC_COUNT.CAPTION = ALLTRIM(STR(RE_NO))
             UNLOCK ALL              
             THISFORM.GRID1.SETFOCUS
          ELSE            
             DO FILE_IMPACT
             RETURN
          ENDIF   
       ENDIF
       UNLOCK ALL
       THISFORM.GRID1.SETFOCUS
   ENDPROC       
ENDDEFINE        
***********************************************列印程序
PROCEDURE PNT_PRC  
     PNT_CHK=CREATEOBJECT("PNT_CHK")  
     PNT_CHK.SHOW    
ENDPROC
********************************************************
DEFINE CLASS PNT_CHK AS FORM
  AUTOCENTER=.T.
  CAPTION='請選擇日期範圍'
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*110
  WIDTH=INT_015*350
  FONTSIZE=INT_015*9
  CLOSABLE=.F.
  CONTROLBOX=.F.
  MAXBUTTON=.F.
  MINBUTTON=.F.    
  BORDERSTYLE=2
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WINDOWTYPE=1
  NAME='PNT_CHK'
ADD OBJECT DATA_OPTION AS OPTIONGROUP WITH;
      LEFT=INT_015*17,;
      TOP=INT_015*20,;
      AUTOSIZE=.T.,;
      FONTSIZE=INT_015*12,;
      BUTTONCOUNT=2,;
      OPTION1.CAPTION='依請購日期範圍',;
      OPTION1.TOP=INT_015*0,;
      OPTION1.FONTSIZE=INT_015*9,;
      OPTION1.AUTOSIZE=.T.,;
      OPTION2.CAPTION='依需求日期範圍',;
      OPTION2.TOP=INT_015*40,;
      OPTION2.FONTSIZE=INT_015*9,;
      OPTION2.AUTOSIZE=.T.,; 
      NAME='DATA_OPTION'   
  ADD OBJECT LABEL1 AS LABEL WITH;
      WIDTH=INT_015*50,;
      HEIGHT=INT_015*25,;
      LEFT=INT_015*135,;
      TOP=INT_015*25,;
      CAPTION='起始日期'
  ADD OBJECT TEXT1 AS TEXTBOX WITH;
      WIDTH=INT_015*75,;
      TOP=INT_015*21,;
      LEFT=INT_015*185,; 
      HEIGHT=INT_015*25,; 
      NAME='TEXT1'
  ADD OBJECT LABEL2 AS LABEL WITH;
      WIDTH=INT_015*50,;
      HEIGHT=INT_015*25,;
      LEFT=INT_015*135,;
      TOP=INT_015*60,;
      CAPTION='截止日期'      
  ADD OBJECT TEXT2 AS TEXTBOX WITH;
      WIDTH=INT_015*75,;
      TOP=INT_015*56,;
      LEFT=INT_015*185,;
      HEIGHT=INT_015*25,;         
      NAME='TEXT2'          
  ADD OBJECT CMND1 AS COMMANDBUTTON WITH;
      LEFT=INT_015*280,;     
      TOP=INT_015*23,;  
      HEIGHT=INT_015*25,;    
      WIDTH=INT_015*50,;
      FONTSIZE=INT_015*10,;
      CAPTION='\<Y.確定',;
      TOOLTIPTEXT='確認所選擇的鍵值!快速鍵->ALT+Y',;
      NAME='CMND1'
  ADD OBJECT CMND2 AS COMMANDBUTTON WITH;
      LEFT=INT_015*280,;
      TOP=INT_015*61,;
      HEIGHT=INT_015*25,;    
      WIDTH=INT_015*50,;
      FONTSIZE=INT_015*10,;
      CAPTION='\<C.取消',;
      TOOLTIPTEXT='取消作業!快速鍵->ALT+C',;
      NAME='CMND2'     
  *****      
 PROC INIT  
      THISFORM.SETALL('FONTSIZE',INT_015*9,'TEXTBOX')
      THISFORM.SETALL('FONTSIZE',INT_015*9,'LABEL')
      THISFORM.SETALL('FONTSIZE',INT_015*9,'COMMANDBUTTON')
      THISFORM.TEXT1.VALUE = DATE()
      THISFORM.TEXT2.VALUE = DATE()
 ENDPROC  
 PROCEDURE CMND1.CLICK     
   SELE P07
   DO CASE 
      CASE KEY()='F01+F06'   
           SELECT P07.F01,;           
                  P07.F02,;
                  P07.F03,;
                  P07.F04,;
                  P07.F05,;                  
                  P07.F06,;
                  P07.F07,;                    
                  P07.F08,;
                  B01.F02,;
                  A01.F03;
           FROM P07,B01,A01 WHERE A01.F01=P07.F10 AND B01.F01=P07.F06 AND ;
           IIF(THISFORM.DATA_OPTION.VALUE=1,P07.F02,P07.F08) >= THISFORM.TEXT1.VALUE AND IIF(THISFORM.DATA_OPTION.VALUE=1,P07.F02,P07.F08) <=THISFORM.TEXT2.VALUE;
           ORDER BY P07.F01,P07.F06 NOWAIT
           IF _tally >0
              REPORT FORM ALLTRIM(INT_116)+'P07A' TO PRINT PROMPT PREVIEW 
           ENDIF  
      CASE KEY()='F03+F06'   
           SELECT P07.F01,;           
                  P07.F02,;
                  P07.F03,;
                  P07.F04,;
                  P07.F05,;                  
                  P07.F06,;
                  P07.F07,;                    
                  P07.F08,;
                  B01.F02,;
                  A01.F03;
           FROM P07,B01,A01 WHERE A01.F01=P07.F10 AND B01.F01=P07.F06 AND;
           IIF(THISFORM.DATA_OPTION.VALUE=1,P07.F02,P07.F08) >= THISFORM.TEXT1.VALUE AND IIF(THISFORM.DATA_OPTION.VALUE=1,P07.F02,P07.F08) <=THISFORM.TEXT2.VALUE;
           ORDER BY P07.F03,P07.F06 NOWAIT
           IF _tally >0
              REPORT FORM ALLTRIM(INT_116)+'P07B' TO PRINT PROMPT PREVIEW
           ENDIF             
      CASE KEY()='F05+F06'   
           SELECT P07.F01,;           
                  P07.F02,;
                  P07.F03,;
                  P07.F04,;
                  P07.F05,;                  
                  P07.F06,;
                  P07.F07,;                    
                  P07.F08,;
                  B01.F02,;
                  A01.F03;
           FROM P07,B01,A01 WHERE A01.F01=P07.F10 AND B01.F01=P07.F06 AND;
           IIF(THISFORM.DATA_OPTION.VALUE=1,P07.F02,P07.F08) >= THISFORM.TEXT1.VALUE AND IIF(THISFORM.DATA_OPTION.VALUE=1,P07.F02,P07.F08) <=THISFORM.TEXT2.VALUE;
           ORDER BY P07.F05,P07.F06 NOWAIT
           IF _tally >0
              REPORT FORM ALLTRIM(INT_116)+'P07C' TO PRINT PROMPT PREVIEW     
           ENDIF                   
      CASE KEY()='F06+DTOS(F08)'   
           SELECT P07.F01,;           
                  P07.F02,;
                  P07.F03,;
                  P07.F04,;
                  P07.F05,;                  
                  P07.F06,;
                  P07.F07,;                    
                  P07.F08,;
                  B01.F02,;
                  A01.F03;
           FROM P07,B01,A01 WHERE A01.F01=P07.F10 AND B01.F01=P07.F06 AND;
           IIF(THISFORM.DATA_OPTION.VALUE=1,P07.F02,P07.F08) >= THISFORM.TEXT1.VALUE AND IIF(THISFORM.DATA_OPTION.VALUE=1,P07.F02,P07.F08) <=THISFORM.TEXT2.VALUE;
           ORDER BY P07.F06,P07.F08 NOWAIT
           IF _tally >0
              REPORT FORM ALLTRIM(INT_116)+'P07D' TO PRINT PROMPT PREVIEW
           ENDIF                       
      CASE KEY()='DTOS(F08)+F06'   
           SELECT P07.F01,;           
                  P07.F02,;
                  P07.F03,;
                  P07.F04,;
                  P07.F05,;                  
                  P07.F06,;
                  P07.F07,;                    
                  P07.F08,;
                  B01.F02,;
                  A01.F03;
           FROM P07,B01,A01 WHERE A01.F01=P07.F10 AND B01.F01=P07.F06 AND;
           IIF(THISFORM.DATA_OPTION.VALUE=1,P07.F02,P07.F08) >= THISFORM.TEXT1.VALUE AND IIF(THISFORM.DATA_OPTION.VALUE=1,P07.F02,P07.F08) <=THISFORM.TEXT2.VALUE;
           ORDER BY P07.F08,P07.F06 NOWAIT
           IF _tally >0
              REPORT FORM ALLTRIM(INT_116)+'P07E' TO PRINT PROMPT PREVIEW
           ENDIF                   
      CASE KEY()='F10+F06+DTOS(F08)'   
           SELECT P07.F01,;           
                  P07.F02,;
                  P07.F03,;
                  P07.F04,;
                  P07.F05,;                  
                  P07.F06,;
                  P07.F07,;                    
                  P07.F08,;
                  B01.F02,;
                  A01.F03;
           FROM P07,B01,A01 WHERE A01.F01=P07.F10 AND B01.F01=P07.F06 AND;
           IIF(THISFORM.DATA_OPTION.VALUE=1,P07.F02,P07.F08) >= THISFORM.TEXT1.VALUE AND IIF(THISFORM.DATA_OPTION.VALUE=1,P07.F02,P07.F08) <=THISFORM.TEXT2.VALUE;
           ORDER BY P07.F10,P07.F06,P07.F08 NOWAIT
           IF _tally >0
              REPORT FORM ALLTRIM(INT_116)+'P07F' TO PRINT PROMPT PREVIEW
           ENDIF                                                         
       ENDCASE 
        THISFORM.RELEASE  
ENDPROC
 ***** 
  PROCEDURE CMND2.CLICK
      THISFORM.RELEASE
  ENDPROC      
ENDDEFINE 

