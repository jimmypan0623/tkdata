***程式名稱:S16.上下班紀錄作業
CLOSE ALL
CLEAR 
PRG_NO='S16'
FLG='0'
FCH=''
CHK=''
R=0
AREA1='S16_1'
AREA2='S16'
HK=''           		&&紀錄目前所在的薪資期間以便於各項資料使用
NMAXDAYS=0	&&判斷該月份之天數
IF !USED('A01')	&&操作人員資料設定
   SELE 0
   USE A01
ELSE 
   SELE A01
ENDIF
SET ORDER TO A01      
IF !USED('A02')	&&權限設定檔
   SELE 0
   USE A02 INDE A02
ELSE
   SELE A02
ENDIF
SET ORDER TO A021    
SEEK SYS_OPER+'S16'           
IF !USED('A23')	&&月份檔
    SELECT  0
    USE A23
ELSE 
   SELECT  A23
ENDIF
SET ORDER TO A231
IF !USED('S00')	&&薪資參數設定
   SELE 0
   USE S00 
ELSE
   SELE S00
ENDIF
SET ORDER TO S004
IF !USED('S05')	&&人事薪資基本資料
   SELE 0
   USE S05 
ELSE
   SELE S05
ENDIF
SET ORDER TO S051
IF !USED('S15')	&&年度假日設定檔
   SELE 0
   USE S15 
ELSE
   SELE S15
ENDIF
SET ORDER TO S151
IF !USED('S17')	&&請假作業檔
   SELE 0
   USE S17
ELSE 
   SELE S17
ENDIF
SET ORDER TO S171  
IF !USED('S18')	&&請假作業檔
   SELE 0
   USE S18
ELSE 
   SELE S18
ENDIF
SET ORDER TO S181  
IF !USED('S19')	&&請假作業檔
   SELE 0
   USE S19
ELSE 
   SELE S19
ENDIF
SET ORDER TO S191  
S21 = 'S21' + LEFT(DTOS(DATE()),6)
IF FILE('&S21'+'.DBF') = .T.
    IF !USED('&S21')	&&刷卡資料
       SELECT 0
       USE (S21) ALIA S21
    ELSE
       SELECT S21
    ENDIF
	S211 = 'S211' + LEFT(DTOS(DATE()),6)
	S212 = 'S212' + LEFT(DTOS(DATE()),6)   
ELSE
    CREATE CURSOR S21 (F01 C(4),F02 C(8),F03 C(6),F04 D(8),F05 C(1),F06 C(5))
	 INDE ON F01 TAG  S211 ASCENDING  
	 INDE ON F02 TAG  S212 ASCENDING    
ENDIF 
SELECT S21
SET ORDER TO S211
S16='S16'+LEFT(DTOS(DATE()),6)
S161='S161'+LEFT(DTOS(DATE()),6)
IF !USED('&S16')	&&上下班紀錄檔
   SELE 0
   USE (S16) ALIA S16
ELSE
   SELE S16
ENDIF
SET ORDER TO S161
****判斷已刷卡資料日期範圍
CREATE CURSOR S21_TEMP (F00 C(2),F01 N(1),F02 C(1),F03 C(1))
INDE ON F00 TAG S21_TEMP1
SET ORDER TO S21_TEMP1
SELECT F04 AS F04 FROM S21 GROUP BY F04 ORDER BY F04 DESC INTO CURSOR S21A
GO TOP
FOR I = 1 TO IIF(DOW(S21A.F04) = 6,DAY(S21A.F04) + 2,DAY(S21A.F04))
	SELECT S21_TEMP
	APPEND BLANK
	REPLACE S21_TEMP.F00 WITH PADL(ALLTRIM(STR(I)),2,'0')
	REPLACE S21_TEMP.F01 WITH DOW(CTOD(LEFT(DTCX(DATE()),8-INT_012) + S21_TEMP.F00))
	REPLACE S21_TEMP.F02 WITH IIF(INDEXSEEK(DTOS(CTOD(LEFT(DTCX(DATE()),8-INT_012) + S21_TEMP.F00)),.T.,'S15','S151'),S15.F03,'')
	IF (S21_TEMP.F01 = 1 OR S21_TEMP.F01 = 7) AND S21_TEMP.F02 = '2' 
	   REPLACE S21_TEMP.F03 WITH 'Y'
	ENDIF
	IF (S21_TEMP.F01 <> 1 AND S21_TEMP.F01 <> 7) AND S21_TEMP.F02 <> '1'
	   REPLACE S21_TEMP.F03 WITH 'Y'
	ENDIF
ENDFOR
SELECT S21A
USE
****記錄未打卡之日期
CREATE CURSOR S16_WORK (F00 C(4),F01 C(5),F02 C(6))
INDE ON F00 + F01 TAG S16_WORK1
SELECT F01,F02,F11,F12,F20,F23,F26,F18,F31,F32 FROM S16 WHERE F19 <> 'Y' AND EMPTY(F11) OR EMPTY(F12) AND IIF(A02.F10 <> '*',ALLTRIM(S16.F02) = IIF(SEEK(sys_oper,'A01'),A01.F12,.F.),.T.) ORDER BY F02,F01 INTO CURSOR S16B
SELECT S16B
GO TOP
DO WHILE !EOF()
   IF EMPTY(S16B.F23) AND S16B.F31 = ' ' AND IIF(SEEK(S16B.F01,'S21_TEMP'),S21_TEMP.F03 = 'Y',.F.)
      SELECT S16_WORK 
      APPEND BLANK 
      REPLACE S16_WORK.F00 WITH S16B.F02
      REPLACE S16_WORK.F01 WITH SUBSTR(DTOS(DATE()),5,2) + '/' + S16B.F01
      DO CASE
         CASE EMPTY(S16B.F11) AND EMPTY(S16B.F12)
              REPLACE S16_WORK.F02 WITH '上下班'
         CASE EMPTY(S16B.F11) AND !EMPTY(S16B.F12)
              REPLACE S16_WORK.F02 WITH '上班'
         CASE !EMPTY(S16B.F11) AND EMPTY(S16B.F12)
              REPLACE S16_WORK.F02 WITH '下班'
      ENDCASE      
   ENDIF 
   SELECT S16B
   SKIP
ENDDO
SELECT S16B
USE
SELECT S21_TEMP
USE
SELECT S16_WORK 
SET ORDER TO S16_WORK1
GO TOP
****
CREATE CURSOR S16_TEMP;
(F02 C(4),F03 C(8),F04 C(4),F05 C(8),F06 C(5),F07 C(5),F08 C(5),F09 C(5),F10 C(5),F19 C(1),SUM_F15 N(5),SUM_F16 N(5),SUM_F171 N(6,1),SUM_F172 N(6,1),SUM_F18 N(2),F99 C(17))
SELECT F01,F02,F03,F04,F05,F06,F07,F08,F09,F10,F19,F15,F16,F17,F18,F31,F99 FROM S16;
              WHERE IIF(A02.F10<>'*',ALLTRIM(S16.F02)=IIF(SEEK(sys_oper,'A01'),A01.F12,.F.),.T.) ORDER BY S16.F02   INTO CURSOR  S16A
SELECT S16A
GO TOP
DO WHILE !EOF()
       SELECT S16_TEMP
       APPEND BLANK 
       REPLACE S16_TEMP.F02 WITH S16A.F02
       REPLACE S16_TEMP.F03 WITH S16A.F03
       REPLACE S16_TEMP.F04 WITH S16A.F04
       REPLACE S16_TEMP.F05 WITH S16A.F05
       REPLACE S16_TEMP.F06 WITH S16A.F06
       REPLACE S16_TEMP.F07 WITH S16A.F07
       REPLACE S16_TEMP.F08 WITH S16A.F08
       REPLACE S16_TEMP.F09 WITH S16A.F09
       REPLACE S16_TEMP.F10 WITH S16A.F10
       REPLACE S16_TEMP.F19 WITH S16A.F19
       REPLACE S16_TEMP.SUM_F15 WITH S16_TEMP.SUM_F15+S16A.F15
       REPLACE S16_TEMP.SUM_F16 WITH S16_TEMP.SUM_F16+S16A.F16
       IF S16A.F18<>1 AND S16A.F18<>7 AND IIF(INDEXSEEK(DTOS(CTOD(LEFT(DTCX(DATE()),8-INT_012)+S16A.F01)),.T.,'S15','S151'),S15.F03<>'1',.T.)
           REPLACE S16_TEMP.SUM_F171 WITH S16_TEMP.SUM_F171+S16A.F17
       ELSE      
           REPLACE S16_TEMP.SUM_F172 WITH S16_TEMP.SUM_F172+S16A.F17
       ENDIF   
       REPLACE S16_TEMP.SUM_F18 WITH S16_TEMP.SUM_F18+IIF(S16A.F31='1',1,0)
       REPLACE S16_TEMP.F99 WITH S16A.F99 
       SELECT S16A
       SKIP
ENDDO
SELECT S16A
USE
SELECT F02,F03,F04,F05,F06,F07,F08,F09,F10,F19,SUM(SUM_F15),SUM(SUM_F16),SUM(SUM_F171),SUM(SUM_F172),SUM(SUM_F18),F99;
               FROM S16_TEMP ORDER BY S16_TEMP.F02 GROUP BY S16_TEMP.F02   INTO CURSOR S16_1 READWRITE 
INDE ON F02 TAG S16_11
INDE ON F03 TAG S16_12
SELECT S16_TEMP
USE
SELECT S16_1
SET ORDER TO S16_11   
GO TOP
********
S16FORM=CREATEOBJECT("TKS16")
S16FORM.SHOW  
DEFINE CLASS TKS16 AS FORM
  CAPTION='S16.上下班紀錄作業'
*!*	  AUTOCENTER=.T.
  CONTROLBOX=.F.
  BORDERSTYLE=1 
  MAXBUTTON=.F.
  MINBUTTON=.F.
  MOVABLE=.F.
  CLOSABLE=.F.
  CONTROLCOUNT=57
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*600
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WIDTH=INT_015*791
  WINDOWTYPE=1
  NAME='TKS16'
  ADD OBJECT SHAPE1 AS SHAPE1 WITH;
      AUTOCENTER=.T.  
  ADD OBJECT SHAPE2 AS SHAPE2 WITH;
      AUTOCENTER=.T.
  ADD OBJECT SHAPE3 AS SHAPE3 WITH;
      AUTOCENTER=.T.
  ADD OBJECT PAGEFRAME1 AS PAGEFRAME WITH;
      LEFT=INT_015*236,;
      WIDTH=INT_015*540,;
      HEIGHT=INT_015*515,;
      FONTSIZE=INT_015*9,;
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\harrow.cur',;        
      PAGECOUNT=2,;
      TABSTRETCH=1,;
      ACTIVEPAGE=1,;
      VISIBLE=.T.,;
      PAGE1.NAME='PAGE1',;
      PAGE1.VISIBLE=.T.,;
      PAGE1.CAPTION='人員資料',;      
      PAGE2.NAME='PAGE2',;
      PAGE2.VISIBLE=.T.,;
      PAGE2.CAPTION='上下班資料內容'        
  ADD OBJECT KEY_LIST AS KEY_LIST WITH;
      AUTOCENTER=.T.,;
      WIDTH=INT_015*130
  ADD OBJECT MTH_LIST AS MTH_LIST WITH;
      AUTOCENTER=.T.
  ADD OBJECT GRID1 AS GRID1 WITH;
      COLUMNCOUNT=3,;            
      RECORDSOURCE='S16_1',;      
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;
      COLUMN3.NAME='COLUMN3' 
  ADD OBJECT GRID2 AS GRID2 WITH;
      TOP=INT_015*252,;
      HEIGHT=INT_015*268,;      
      COLUMNCOUNT=11,;            
      RECORDSOURCE='S16',; 
      LINKMASTER='S16_1',;
      RELATIONALEXPR='F02',;
      CHILDORDER='S161',;   
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;
      COLUMN3.NAME='COLUMN3',;
      COLUMN4.NAME='COLUMN4',;
      COLUMN5.NAME='COLUMN5',;
      COLUMN6.NAME='COLUMN6',;
      COLUMN7.NAME='COLUMN7',;
      COLUMN8.NAME='COLUMN8',;
      COLUMN9.NAME='COLUMN9',;
      COLUMN10.NAME='COLUMN10',;
      COLUMN11.NAME='COLUMN11'
  ADD OBJECT CMDGROUP AS CMDGROUP WITH;
	AUTOSIZE=.T. 
  ADD OBJECT ORPGROUP AS ORPGROUP WITH;    
	AUTOSIZE=.T.             
  ADD OBJECT SHRGROUP AS SHRGROUP WITH;
      TOP=INT_015*210,;
      LEFT=INT_015*650          
 ADD OBJECT COMBOBOX02 AS COMBOBOX02 WITH;  &&人員編號
      TOP=INT_015*39,;  
      LEFT=INT_015*302            
  ADD OBJECT ANS_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*490,;
      LEFT=INT_015*13,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*55,;      
      FONTSIZE=INT_015*9,;
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\harrow.cur',;        
      CAPTION='\<A.確認',;
      TOOLTIPTEXT='確認目前所指紀錄內容!快速鍵->ALT+A',;
      NAME='ANS_BOTT'      
  ADD OBJECT OUT_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*490,;
      LEFT=INT_015*70,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*65,;      
      FONTSIZE=INT_015*9,;
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\harrow.cur',;        
      CAPTION='\<O.缺勤明細',;
      TOOLTIPTEXT='出勤紀錄不完全!快速鍵->ALT+O',;
      NAME='OUT_BOTT'            
  ADD OBJECT INOUT_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*490,;
      LEFT=INT_015*138,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*65,;      
      FONTSIZE=INT_015*9,;
      CAPTION='\<I.進出記錄',;
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\harrow.cur',;        
      NAME='INOUT_BOTT'                  
  ADD OBJECT WASTE_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*490,;
      LEFT=INT_015*165,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*57,;      
      FONTSIZE=INT_015*9,;
      CAPTION='\<W.曠    職',;
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\harrow.cur',;        
      NAME='WASTE_BOTT'      
  ADD OBJECT LEAVE_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*490,;
      LEFT=INT_015*106,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*57,;      
      FONTSIZE=INT_015*9,;
      CAPTION='\<L.離     職',;
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\harrow.cur',;        
      NAME='LEAVE_BOTT'                                 
**************            
PROCEDURE PAGEFRAME1.PAGE1.INIT  
  THIS.ADDOBJECT('LBLF02','LABEL')
     WITH THIS.LBLF02
         .VISIBLE=.T.
         .LEFT=INT_015*15
         .TOP=INT_015*20
         .WIDTH=INT_015*50
         .CAPTION='員工編號'
     ENDWITH         
 THIS.ADDOBJECT('TXTF02','TEXTBOX')          
     WITH THIS.TXTF02
          .VISIBLE=.T.
          .LEFT=INT_015*65
          .TOP=INT_015*14
          .WIDTH=INT_015*40
          .HEIGHT=INT_015*25
          .MAXLENGTH=4
      ENDWITH  
  THIS.ADDOBJECT('LBLF03','LABEL')
     WITH THIS.LBLF03
         .VISIBLE=.T.
         .LEFT=INT_015*120
         .TOP=INT_015*20
         .AUTOSIZE=.T.
         .CAPTION=''
     ENDWITH        
 THIS.ADDOBJECT('LBLF04','LABEL')
     WITH THIS.LBLF04
         .VISIBLE=.T.
         .LEFT=INT_015*15
         .TOP=INT_015*45
         .WIDTH=INT_015*50
         .CAPTION='部門編號'
     ENDWITH  
 THIS.ADDOBJECT('TXTF04','TEXTBOX')          
     WITH THIS.TXTF04
          .VISIBLE=.T.
          .LEFT=INT_015*65
          .TOP=INT_015*39
          .WIDTH=INT_015*40
          .HEIGHT=INT_015*25
          .MAXLENGTH=4
      ENDWITH       
 THIS.ADDOBJECT('LBLF05','LABEL')
     WITH THIS.LBLF05
         .VISIBLE=.T.
         .LEFT=INT_015*120
         .TOP=INT_015*45
         .AUTOSIZE=.T.
         .CAPTION=''
     ENDWITH                   
 THIS.ADDOBJECT('LBLF06','LABEL')
     WITH THIS.LBLF06
         .VISIBLE=.T.
         .LEFT=INT_015*15
         .TOP=INT_015*70
         .WIDTH=INT_015*50
         .CAPTION='上班時段'
     ENDWITH     
 THIS.ADDOBJECT('TXTF06','TEXTBOX')          
     WITH THIS.TXTF06
          .VISIBLE=.T.
          .LEFT=INT_015*65
          .TOP=INT_015*64
          .WIDTH=INT_015*40
          .HEIGHT=INT_015*25
      ENDWITH         
 THIS.ADDOBJECT('LBLF07','LABEL')
     WITH THIS.LBLF07
         .VISIBLE=.T.
         .LEFT=INT_015*15
         .TOP=INT_015*95
         .WIDTH=INT_015*50
         .CAPTION='下班時段'
     ENDWITH     
 THIS.ADDOBJECT('TXTF07','TEXTBOX')          
     WITH THIS.TXTF07
          .VISIBLE=.T.
          .LEFT=INT_015*65
          .TOP=INT_015*89
          .WIDTH=INT_015*40
          .HEIGHT=INT_015*25
      ENDWITH 
 THIS.ADDOBJECT('LBLF08','LABEL')
     WITH THIS.LBLF08
         .VISIBLE=.T.
         .LEFT=INT_015*120
         .TOP=INT_015*70
         .AUTOSIZE=.T.
         .CAPTION='上班遲到緩衝時間'
     ENDWITH     
 THIS.ADDOBJECT('TXTF08','TEXTBOX')          
     WITH THIS.TXTF08
          .VISIBLE=.T.
          .LEFT=INT_015*220
          .TOP=INT_015*64
          .WIDTH=INT_015*40
          .HEIGHT=INT_015*25
      ENDWITH               
 THIS.ADDOBJECT('LBLF09','LABEL')
     WITH THIS.LBLF09
         .VISIBLE=.T.
         .LEFT=INT_015*120
         .TOP=INT_015*95
         .AUTOSIZE=.T.
         .CAPTION='下班早退緩衝時間'
     ENDWITH     
 THIS.ADDOBJECT('TXTF09','TEXTBOX')          
     WITH THIS.TXTF09
          .VISIBLE=.T.
          .LEFT=INT_015*220
          .TOP=INT_015*89
          .WIDTH=INT_015*40
          .HEIGHT=INT_015*25
      ENDWITH      
 THIS.ADDOBJECT('LBLF10','LABEL')
     WITH THIS.LBLF10
         .VISIBLE=.T.
         .LEFT=INT_015*120
         .TOP=INT_015*120
         .AUTOSIZE=.T.
         .CAPTION='加班上班緩衝時間'
     ENDWITH     
 THIS.ADDOBJECT('TXTF10','TEXTBOX')          
     WITH THIS.TXTF10
          .VISIBLE=.T.
          .LEFT=INT_015*220
          .TOP=INT_015*114
          .WIDTH=INT_015*40
          .HEIGHT=INT_015*25
      ENDWITH                     
 THIS.ADDOBJECT('LBLF15','LABEL')
     WITH THIS.LBLF15
         .VISIBLE=.T.
         .LEFT=INT_015*314
         .TOP=INT_015*70
         .AUTOSIZE=.T.
         .CAPTION='遲到總分鐘數：'
     ENDWITH             
 THIS.ADDOBJECT('LBLF16','LABEL')
     WITH THIS.LBLF16
         .VISIBLE=.T.
         .LEFT=INT_015*314
         .TOP=INT_015*95
         .AUTOSIZE=.T.
         .CAPTION='早退總分鐘數：'
     ENDWITH        
 THIS.ADDOBJECT('LBLF171','LABEL')
     WITH THIS.LBLF171
         .VISIBLE=.T.
         .LEFT=INT_015*290
         .TOP=INT_015*120
         .AUTOSIZE=.T.
         .CAPTION='平日加班總小時數：'
     ENDWITH         
 THIS.ADDOBJECT('LBLF172','LABEL')
     WITH THIS.LBLF172
         .VISIBLE=.T.
         .LEFT=INT_015*290
         .TOP=INT_015*145
         .AUTOSIZE=.T.
         .CAPTION='假日加班總小時數：'
     ENDWITH        
 THIS.ADDOBJECT('LBLF18','LABEL')
     WITH THIS.LBLF18
         .VISIBLE=.T.
         .LEFT=INT_015*290
         .TOP=INT_015*170
         .AUTOSIZE=.T.
         .CAPTION=''
     ENDWITH        
 THIS.ADDOBJECT('LBLF19','LABEL')
     WITH THIS.LBLF19
         .VISIBLE=.T.
         .LEFT=INT_015*15
         .TOP=INT_015*145
         .WIDTH=INT_015*50
         .CAPTION='狀       態'
     ENDWITH    
 THIS.ADDOBJECT('LBLF191','LABEL')
     WITH THIS.LBLF191
         .VISIBLE=.T.
         .LEFT=INT_015*65
         .TOP=INT_015*145
         .AUTOSIZE=.T.
         .CAPTION=''
     ENDWITH          
 THIS.ADDOBJECT('LBLF_WORK','LABEL')
     WITH THIS.LBLF_WORK
         .VISIBLE=.F.
         .LEFT=INT_015*15
         .TOP=INT_015*170
         .WIDTH=INT_015*65
         .CAPTION='未打卡日期：'
     ENDWITH     
 THIS.ADDOBJECT('LBLF_WORK1','LABEL')
     WITH THIS.LBLF_WORK1
         .VISIBLE=.F.
         .LEFT=INT_015*83
         .TOP=INT_015*170
         .AUTOSIZE=.T.
         .CAPTION=''
         .BACKCOLOR=RGB(255,255,0)
     ENDWITH  
 THIS.ADDOBJECT('LBLF_WORK2','LABEL')
     WITH THIS.LBLF_WORK2
         .VISIBLE=.F.
         .LEFT=INT_015*83
         .TOP=INT_015*187
         .AUTOSIZE=.T.
         .CAPTION=''
         .BACKCOLOR=RGB(255,255,0)
     ENDWITH   
 THIS.ADDOBJECT('LBLF_WORK3','LABEL')
     WITH THIS.LBLF_WORK3
         .VISIBLE=.F.
         .LEFT=INT_015*83
         .TOP=INT_015*204
         .AUTOSIZE=.T.
         .CAPTION=''
         .BACKCOLOR=RGB(255,255,0)
     ENDWITH                  
ENDPROC       
**************************************      
PROCEDURE PAGEFRAME1.PAGE2.INIT 
  THIS.ADDOBJECT('LBLF01','LABEL')
     WITH THIS.LBLF01
         .VISIBLE=.T.
         .LEFT=INT_015*15
         .TOP=INT_015*20
         .WIDTH=INT_015*50
         .CAPTION='日       期'
     ENDWITH        
 THIS.ADDOBJECT('TXTF01','TEXTBOX')          
     WITH THIS.TXTF01
          .VISIBLE=.T.
          .LEFT=INT_015*65
          .TOP=INT_015*14
          .WIDTH=INT_015*25
          .HEIGHT=INT_015*25      
          .MAXLENGTH=2               
      ENDWITH  
  THIS.ADDOBJECT('LBLF11','LABEL')
     WITH THIS.LBLF11 
         .VISIBLE=.T.
         .LEFT=INT_015*15
         .TOP=INT_015*45
         .WIDTH=INT_015*50
         .CAPTION='上班時間'
     ENDWITH     
  THIS.ADDOBJECT('TXTF11','TXTF11')     
     WITH THIS.TXTF11
          .VISIBLE=.T.
          .LEFT=INT_015*65
          .TOP=INT_015*39
     ENDWITH               
  THIS.ADDOBJECT('LBLF12','LABEL')
     WITH THIS.LBLF12
         .VISIBLE=.T.
         .LEFT=INT_015*15
         .TOP=INT_015*70
         .WIDTH=INT_015*50
         .CAPTION='下班時間'
     ENDWITH      
  THIS.ADDOBJECT('TXTF12','TXTF12')     
     WITH THIS.TXTF12
          .VISIBLE=.T.
          .LEFT=INT_015*65
          .TOP=INT_015*64     
     ENDWITH                                    
  THIS.ADDOBJECT('LBLF13','LABEL')
     WITH THIS.LBLF13
         .VISIBLE=.T.
         .LEFT=INT_015*185
         .TOP=INT_015*45
         .WIDTH=INT_015*75
         .CAPTION='加班上班時間'
     ENDWITH        
  THIS.ADDOBJECT('TXTF13','TXTF13')     
     WITH THIS.TXTF13
          .VISIBLE=.T.
          .LEFT=INT_015*260
          .TOP=INT_015*39    
     ENDWITH        
  THIS.ADDOBJECT('LBLF14','LABEL')
     WITH THIS.LBLF14
         .VISIBLE=.T.
         .LEFT=INT_015*185
         .TOP=INT_015*70
         .WIDTH=INT_015*75
         .CAPTION='加班下班時間'
     ENDWITH        
  THIS.ADDOBJECT('TXTF14','TXTF14')     
     WITH THIS.TXTF14
          .VISIBLE=.T.
          .LEFT=INT_015*260
          .TOP=INT_015*64 
     ENDWITH               
     *******
  THIS.ADDOBJECT('LBLF15','LABEL')
     WITH THIS.LBLF15
         .VISIBLE=.T.
         .LEFT=INT_015*15
         .TOP=INT_015*100
         .WIDTH=INT_015*75
         .CAPTION='遲到分鐘數：'
     ENDWITH
  THIS.ADDOBJECT('LBLF151','LABEL')
     WITH THIS.LBLF151
         .VISIBLE=.T.
         .LEFT=INT_015*90
         .TOP=INT_015*100
         .AUTOSIZE=.T.
         .CAPTION=''
     ENDWITH      
  THIS.ADDOBJECT('LBLF16','LABEL')
     WITH THIS.LBLF16
         .VISIBLE=.T.
         .LEFT=INT_015*15
         .TOP=INT_015*125
         .WIDTH=INT_015*75
         .CAPTION='早退分鐘數：'
     ENDWITH
  THIS.ADDOBJECT('LBLF161','LABEL')
     WITH THIS.LBLF161
         .VISIBLE=.T.
         .LEFT=INT_015*90
         .TOP=INT_015*125
         .AUTOSIZE=.T.
         .CAPTION=''
     ENDWITH          
  THIS.ADDOBJECT('LBLF17','LABEL')
     WITH THIS.LBLF17
         .VISIBLE=.T.
         .LEFT=INT_015*185
         .TOP=INT_015*100
         .WIDTH=INT_015*75
         .CAPTION='加班小時數：'
     ENDWITH
  THIS.ADDOBJECT('LBLF171','LABEL')
     WITH THIS.LBLF171
         .VISIBLE=.T.
         .LEFT=INT_015*260 
         .TOP=INT_015*100
         .AUTOSIZE=.T.
         .CAPTION=''
     ENDWITH        
  THIS.ADDOBJECT('LBLF18','LABEL')
     WITH THIS.LBLF18
         .VISIBLE=.T.
         .LEFT=INT_015*15
         .TOP=INT_015*150
         .WIDTH=INT_015*75
         .CAPTION='假 日 判  斷：'
     ENDWITH
  THIS.ADDOBJECT('LBLF181','LABEL')
     WITH THIS.LBLF181
         .VISIBLE=.T.
         .LEFT=INT_015*90
         .TOP=INT_015*150
         .AUTOSIZE=.T.
         .CAPTION=''
     ENDWITH       
  THIS.ADDOBJECT('TXTF18','TEXTBOX')     
     WITH THIS.TXTF18
          .VISIBLE=.F.
          .LEFT=INT_015*260
          .TOP=INT_015*64
          .WIDTH=INT_015*20
          .HEIGHT=INT_015*25
          .MAXLENGTH=1       
     ENDWITH             
     *****
  THIS.ADDOBJECT('LBLF23','LABEL')
     WITH THIS.LBLF23
         .VISIBLE=.F.
         .LEFT=INT_015*342
         .TOP=INT_015*20
         .AUTOSIZE=.T.
         .CAPTION='S18.請假作業單號：'
     ENDWITH
  THIS.ADDOBJECT('LBLF231','LABEL')
     WITH THIS.LBLF231
         .VISIBLE=.F.
         .LEFT=INT_015*342
         .TOP=INT_015*45
         .AUTOSIZE=.T.
         .CAPTION='       請假假別名稱：'
     ENDWITH    
  THIS.ADDOBJECT('LBLF20','LABEL')
     WITH THIS.LBLF20
         .VISIBLE=.F.
         .LEFT=INT_015*330
         .TOP=INT_015*70
         .AUTOSIZE=.T.
         .CAPTION='S17.上下班變更單號：'
     ENDWITH    
  THIS.ADDOBJECT('LBLF21','LABEL')
     WITH THIS.LBLF21
         .VISIBLE=.F.
         .LEFT=INT_015*342
         .TOP=INT_015*95
         .AUTOSIZE=.T.
         .CAPTION='   變更前上班時間：'
     ENDWITH         
  THIS.ADDOBJECT('LBLF22','LABEL')
     WITH THIS.LBLF22
         .VISIBLE=.F.
         .LEFT=INT_015*342
         .TOP=INT_015*120
         .AUTOSIZE=.T.
         .CAPTION='   變更前下班時間：'
     ENDWITH               
  THIS.ADDOBJECT('LBLF26','LABEL')
     WITH THIS.LBLF26
         .VISIBLE=.F.
         .LEFT=INT_015*342
         .TOP=INT_015*145
         .AUTOSIZE=.T.
         .CAPTION='S19.加班申請單號：'
     ENDWITH               
  THIS.ADDOBJECT('LBLF27','LABEL')
     WITH THIS.LBLF27
         .VISIBLE=.F.
         .LEFT=INT_015*327
         .TOP=INT_015*170
         .AUTOSIZE=.T.
         .CAPTION='變更前加班上班時間：'
     ENDWITH      
  THIS.ADDOBJECT('LBLF28','LABEL')
     WITH THIS.LBLF28
         .VISIBLE=.F.
         .LEFT=INT_015*327
         .TOP=INT_015*195
         .AUTOSIZE=.T.
         .CAPTION='變更前加班下班時間：'
     ENDWITH       
  THIS.ADDOBJECT('LBLF31','LABEL')
     WITH THIS.LBLF31
         .VISIBLE=.T.
         .LEFT=INT_015*15
         .TOP=INT_015*170
         .AUTOSIZE=.T.
         .CAPTION=''
         .BACKCOLOR=RGB(255,255,0)
     ENDWITH                                                                                     
  THIS.ADDOBJECT('LBLF99','LABEL')
     WITH THIS.LBLF99
         .VISIBLE=.T.
         .LEFT=INT_015*15
         .TOP=INT_015*195
         .WIDTH=INT_015*55
         .CAPTION='安全資料'
     ENDWITH
  THIS.ADDOBJECT('LBLF991','LABEL')
     WITH THIS.LBLF991
         .VISIBLE=.T.
         .LEFT=INT_015*85
         .TOP=INT_015*195
         .AUTOSIZE=.T.
         .CAPTION=''
     ENDWITH        
ENDPROC                               
********  
  PROC INIT       
       HK=ALLTRIM(THISFORM.MTH_LIST.DISPLAYVALUE)
       THISFORM.ANS_BOTT.CAPTION=IIF(S16_1.F19 <> 'Y','\<A.確認','\<A.反確認')
       THISFORM.PAGEFRAME1.PAGE1.FONTITALIC=.T.
       THISFORM.PAGEFRAME1.PAGE1.FORECOLOR=RGB(0,0,255)      
       THISFORM.PAGEFRAME1.PAGE1.FONTSIZE=INT_015*10
       THISFORM.PAGEFRAME1.PAGE2.FONTSIZE=INT_015*10  
       THISFORM.SETALL('HEIGHT',INT_015*25,'TEXTBOX')
       THISFORM.SETALL('HEIGHT',INT_015*17,'LABEL')     
       THISFORM.SETALL('FONTSIZE',INT_015*9,'TEXTBOX')
       THISFORM.SETALL('FONTSIZE',INT_015*9,'LABEL')      
       THISFORM.SETALL('READONLY',.T.,'TEXTBOX')
       THISFORM.SHRGROUP.VISIBLE=.F.
       THISFORM.SHRGROUP.ENABLED=.F.
       THISFORM.ANS_BOTT.VISIBLE=.F. 
       THISFORM.WASTE_BOTT.VISIBLE=.F. 
       THISFORM.WASTE_BOTT.ENABLED=.F. 
       THISFORM.LEAVE_BOTT.VISIBLE=.F. 
       THISFORM.LEAVE_BOTT.ENABLED=.F.        
       THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.    
       THISFORM.GRID1.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)   
       THISFORM.GRID2.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)   
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'COLUMN')
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'HEADER')         
       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='員工編號'
       THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='員工姓名'
       THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='部門名稱'
       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='S16_1.F02'
       THISFORM.GRID1.COLUMN2.CONTROLSOURCE='S16_1.F03'
       THISFORM.GRID1.COLUMN3.CONTROLSOURCE='S16_1.F05'
       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*55
       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*55   
       THISFORM.GRID1.COLUMN3.WIDTH=INT_015*55
       THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(S16_1.F19<>'Y',RGB(255,0,0),,'')","COLUMN")    	     &&若為有尚未確認之內容則呈現紅色 
       THISFORM.GRID2.SETALL('FONTSIZE',INT_015*9,'COLUMN')
       THISFORM.GRID2.SETALL('FONTSIZE',INT_015*9,'HEADER') 
       THISFORM.GRID2.LOCKCOLUMNS=3   
       THISFORM.GRID2.LINKMASTER='S16_1'
       THISFORM.GRID2.RELATIONALEXPR='F02'        
       THISFORM.GRID2.COLUMN1.HEADER1.CAPTION='日期'    
       THISFORM.GRID2.COLUMN2.HEADER1.CAPTION='上班時間'       
       THISFORM.GRID2.COLUMN3.HEADER1.CAPTION='下班時間'
       THISFORM.GRID2.COLUMN4.HEADER1.CAPTION='加班上班時間'
       THISFORM.GRID2.COLUMN5.HEADER1.CAPTION='加班下班時間'
       THISFORM.GRID2.COLUMN6.HEADER1.CAPTION='遲到分鐘數' 
       THISFORM.GRID2.COLUMN7.HEADER1.CAPTION='早退分鐘數'
       THISFORM.GRID2.COLUMN8.HEADER1.CAPTION='加班小時數'
       THISFORM.GRID2.COLUMN9.HEADER1.CAPTION='請假起始時間' 
       THISFORM.GRID2.COLUMN10.HEADER1.CAPTION='請假截止時間'
       THISFORM.GRID2.COLUMN11.HEADER1.CAPTION='安全資料'
       THISFORM.GRID2.COLUMN1.CONTROLSOURCE='S16.F01'
       THISFORM.GRID2.COLUMN2.CONTROLSOURCE="IIF(EMPTY(S16.F31),S16.F11,'')"
       THISFORM.GRID2.COLUMN3.CONTROLSOURCE="IIF(EMPTY(S16.F31),S16.F12,'')"
       THISFORM.GRID2.COLUMN4.CONTROLSOURCE="IIF(EMPTY(S16.F31),S16.F13,'')"
       THISFORM.GRID2.COLUMN5.CONTROLSOURCE="IIF(EMPTY(S16.F31),S16.F14,'')"
       THISFORM.GRID2.COLUMN6.CONTROLSOURCE="IIF(EMPTY(S16.F31),IIF(EMPTY(S16.F15),'',S16.F15),'')"
       THISFORM.GRID2.COLUMN7.CONTROLSOURCE="IIF(EMPTY(S16.F31),IIF(EMPTY(S16.F16),'',S16.F16),'')"
       THISFORM.GRID2.COLUMN8.CONTROLSOURCE="IIF(EMPTY(S16.F31),IIF(EMPTY(S16.F17),'',S16.F17),'')"
       THISFORM.GRID2.COLUMN9.CONTROLSOURCE="IIF(EMPTY(S16.F31),IIF(EMPTY(S16.F24) OR LEN(ALLTRIM(S16.F24))=1,'',S16.F24),'')"
       THISFORM.GRID2.COLUMN10.CONTROLSOURCE="IIF(EMPTY(S16.F31),IIF(EMPTY(S16.F25) OR LEN(ALLTRIM(S16.F25))=1,'',S16.F25),'')"
       THISFORM.GRID2.COLUMN11.CONTROLSOURCE='S16.F99'                                         
       THISFORM.GRID2.COLUMN1.WIDTH=INT_015*30      
       THISFORM.GRID2.COLUMN2.WIDTH=INT_015*55
       THISFORM.GRID2.COLUMN3.WIDTH=INT_015*55
       THISFORM.GRID2.COLUMN4.WIDTH=INT_015*80
       THISFORM.GRID2.COLUMN5.WIDTH=INT_015*80
       THISFORM.GRID2.COLUMN6.WIDTH=INT_015*65
       THISFORM.GRID2.COLUMN7.WIDTH=INT_015*65
       THISFORM.GRID2.COLUMN8.WIDTH=INT_015*65
       THISFORM.GRID2.COLUMN9.WIDTH=INT_015*80
       THISFORM.GRID2.COLUMN10.WIDTH=INT_015*80
       THISFORM.GRID2.COLUMN11.WIDTH=INT_015*100
*!*	       THISFORM.GRID2.SETALL("DYNAMICBACKCOLOR","IIF(S16.F31='2',RGB(255,0,0),IIF(S16.F18=7 OR S16.F18=1 OR INDEXSEEK(DTOS(CTOD(HK+'/'+S16.F01)),.F.,'S15','S151')=.T.,RGB(0,255,255),IIF(S16.F31='1',RGB(255,255,0),'')))","COLUMN")          RGB(247,100,115)
       THISFORM.GRID2.SETALL("DYNAMICBACKCOLOR","IIF(S16.F31='2',RGB(255,0,0),IIF(S16.F31='1',RGB(255,255,0),IIF(!EMPTY(S16.F20) OR !EMPTY(S16.F23) OR !EMPTY(S16.F26),RGB(0,255,255),IIF(S16.F18=7 OR S16.F18=1 OR INDEXSEEK(DTOS(CTOD(HK+'/'+S16.F01)),.F.,'S15','S151')=.T.,RGB(213,205,168),''))))","COLUMN")         
       THISFORM.GRID1.READONLY=.T.      
       THISFORM.GRID2.READONLY=.T.           
       THISFORM.GRID1.SETFOCUS
       IF THISFORM.GRID1.ACTIVEROW=0
	   THISFORM.PAGEFRAME1.PAGE2.ENABLED=.F. 
           THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
	   THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
	   THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
	   THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.    
	   THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.	  
           THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F. 	   	         
           THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
           THISFORM.ANS_BOTT.ENABLED=.F.     
           THISFORM.INOUT_BOTT.ENABLED=.T.
           THISFORM.OUT_BOTT.ENABLED=.F.       
	   THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE=''
	   THISFORM.PAGEFRAME1.PAGE1.TXTF04.VALUE=''
	   THISFORM.PAGEFRAME1.PAGE1.TXTF06.VALUE=''
	   THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE=''
	   THISFORM.PAGEFRAME1.PAGE1.TXTF08.VALUE=''
	   THISFORM.PAGEFRAME1.PAGE1.TXTF09.VALUE='' 
	   THISFORM.PAGEFRAME1.PAGE1.TXTF10.VALUE='' 
	   THISFORM.PAGEFRAME1.PAGE1.LBLF03.CAPTION=''
	   THISFORM.PAGEFRAME1.PAGE1.LBLF05.CAPTION=''
	   THISFORM.PAGEFRAME1.PAGE1.LBLF15.CAPTION='遲到總分鐘數：'
	   THISFORM.PAGEFRAME1.PAGE1.LBLF16.CAPTION='早退總分鐘數：'
	   THISFORM.PAGEFRAME1.PAGE1.LBLF171.CAPTION='平日加班總小時數：'	   
	   THISFORM.PAGEFRAME1.PAGE1.LBLF172.CAPTION='假日加班總小時數：'	 
	   THISFORM.PAGEFRAME1.PAGE1.LBLF18.CAPTION=''  
	   THISFORM.PAGEFRAME1.PAGE1.LBLF191.CAPTION=''      
	   THISFORM.PAGEFRAME1.PAGE1.LBLF_WORK.VISIBLE=.F. 
	   THISFORM.PAGEFRAME1.PAGE1.LBLF_WORK1.VISIBLE=.F. 
	   THISFORM.PAGEFRAME1.PAGE1.LBLF_WORK2.VISIBLE=.F. 
	   THISFORM.PAGEFRAME1.PAGE1.LBLF_WORK3.VISIBLE=.F. 	       
       ELSE
	   THISFORM.PAGEFRAME1.PAGE2.ENABLED=.T.     
           THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
	   THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
	   THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
	   THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.    
	   THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.		          
	   THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)  AND IIF(S16_1.F19<>'Y',.T.,.F.)   &&判斷有無刪除的權限	            		      	   
           THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限  
           THISFORM.ANS_BOTT.ENABLED= IIF(S16_1.F19<>'Y',IIF(A02.F08='*',.T.,.F.),IIF(A02.F09='*',.T.,.F.))
           THISFORM.INOUT_BOTT.ENABLED=.T.
           THISFORM.OUT_BOTT.ENABLED=IIF(A02.F08='*',.T.,.F.) AND IIF(A02.F10='*',.T.,.F.)
       ENDIF          
       THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.)
       JK='員工編號'
       SELE S16_1
       GO TOP
       THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE=S16_1.F02
  ENDPROC      
  ***********
  PROCEDURE PAGEFRAME1.PAGE1.ACTIVATE
        R=0
        SELECT S16_1       
        DO CASE 
            CASE THISFORM.KEY_LIST.DISPLAYVALUE='依員工編號排列'
                 SET ORDER TO S16_11
            CASE THISFORM.KEY_LIST.DISPLAYVALUE='依員工姓名排列'
                 SET ORDER TO S16_12
         ENDCASE      
        THISFORM.PAGEFRAME1.PAGE1.FONTITALIC=.T.
        THISFORM.PAGEFRAME1.PAGE1.FORECOLOR=RGB(0,0,255)
        THISFORM.PAGEFRAME1.PAGE2.FONTITALIC=.F.
        THISFORM.PAGEFRAME1.PAGE2.FORECOLOR=RGB(0,0,0)        
        THISFORM.KEY_LIST.ENABLED=.T.  	
	THISFORM.MTH_LIST.ENABLED=.T. 
	THISFORM.ANS_BOTT.VISIBLE=.T.       	
        THISFORM.INOUT_BOTT.VISIBLE=.T.  
        THISFORM.OUT_BOTT.VISIBLE=.T.
        THISFORM.WASTE_BOTT.VISIBLE=.F. 
        THISFORM.WASTE_BOTT.ENABLED=.F. 
        THISFORM.LEAVE_BOTT.VISIBLE=.F. 
        THISFORM.LEAVE_BOTT.ENABLED=.F.         
        THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.  
        THISFORM.GRID1.ENABLED=.T.    
        THISFORM.GRID1.SETFOCUS  
       IF THISFORM.GRID1.ACTIVEROW=0 AND THISFORM.SHRGROUP.VISIBLE=.F.
           THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
	   THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
	   THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
	   THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.    
	   THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.	   
           THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F. 	   	         
           THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
           THISFORM.ANS_BOTT.ENABLED=.F. 
           THISFORM.INOUT_BOTT.ENABLED=.F.
           THISFORM.OUT_BOTT.ENABLED=.F. 
	   THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE=''
	   THISFORM.PAGEFRAME1.PAGE1.TXTF04.VALUE=''
	   THISFORM.PAGEFRAME1.PAGE1.TXTF06.VALUE=''
	   THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE=''
	   THISFORM.PAGEFRAME1.PAGE1.TXTF08.VALUE=''
	   THISFORM.PAGEFRAME1.PAGE1.TXTF09.VALUE='' 
	   THISFORM.PAGEFRAME1.PAGE1.TXTF10.VALUE='' 	   
	   THISFORM.PAGEFRAME1.PAGE1.LBLF03.CAPTION=''
	   THISFORM.PAGEFRAME1.PAGE1.LBLF05.CAPTION=''    
	   THISFORM.PAGEFRAME1.PAGE1.LBLF15.CAPTION='遲到總分鐘數：'
	   THISFORM.PAGEFRAME1.PAGE1.LBLF16.CAPTION='早退總分鐘數：'
	   THISFORM.PAGEFRAME1.PAGE1.LBLF171.CAPTION='平日加班總小時數：'	 
	   THISFORM.PAGEFRAME1.PAGE1.LBLF172.CAPTION='假日加班總小時數：'	 
	   THISFORM.PAGEFRAME1.PAGE1.LBLF18.CAPTION=''  
	   THISFORM.PAGEFRAME1.PAGE1.LBLF191.CAPTION=''  
	   THISFORM.PAGEFRAME1.PAGE1.LBLF_WORK.VISIBLE=.F. 
	   THISFORM.PAGEFRAME1.PAGE1.LBLF_WORK1.VISIBLE=.F. 
	   THISFORM.PAGEFRAME1.PAGE1.LBLF_WORK2.VISIBLE=.F. 
	   THISFORM.PAGEFRAME1.PAGE1.LBLF_WORK3.VISIBLE=.F. 	   
       ELSE
           THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
	   THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
	   THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
	   THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.    
	   THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.		          
	   THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)  AND IIF(S16_1.F19<>'Y',.T.,.F.)   &&判斷有無刪除的權限	            		      	   
           THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限  
           THISFORM.ANS_BOTT.ENABLED=IIF(S16_1.F19<>'Y',IIF(A02.F08='*',.T.,.F.),IIF(A02.F09='*',.T.,.F.))
           THISFORM.INOUT_BOTT.ENABLED=.T.
           THISFORM.OUT_BOTT.ENABLED=IIF(A02.F08='*',.T.,.F.) AND IIF(A02.F10='*',.T.,.F.)
       ENDIF  
       THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.)		 &&判斷有無新增的權限                     		                 
*!*	        THISFORM.REFRESH    
  ENDPROC     
**********             
  PROCEDURE PAGEFRAME1.PAGE2.ACTIVATE
	SELECT S16 	
        THISFORM.PAGEFRAME1.PAGE1.FONTITALIC=.F.
        THISFORM.PAGEFRAME1.PAGE1.FORECOLOR=RGB(0,0,0)
        THISFORM.PAGEFRAME1.PAGE2.FONTITALIC=.T.
        THISFORM.PAGEFRAME1.PAGE2.FORECOLOR=RGB(0,0,255)            
        THISFORM.KEY_LIST.ENABLED=.F.  	
	THISFORM.MTH_LIST.ENABLED=.F. 
	THISFORM.ANS_BOTT.VISIBLE=.F.  	 
	THISFORM.INOUT_BOTT.VISIBLE=.F.
	THISFORM.OUT_BOTT.VISIBLE=.F.
	THISFORM.WASTE_BOTT.VISIBLE=.T. 
	THISFORM.LEAVE_BOTT.VISIBLE=.T. 
	THISFORM.ORPGROUP.NEW_BOTT.ENABLED=.F.        
	THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.		
        IF THISFORM.SHRGROUP.ENABLED=.F.
             THISFORM.GRID2.READONLY=.T.  
             THISFORM.GRID2.ENABLED=.T.    
             THISFORM.GRID2.SETFOCUS   
        ENDIF
	IF THISFORM.GRID2.ACTIVEROW=0 AND THISFORM.SHRGROUP.ENABLED=.F.	
	      THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
	      THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
	      THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
	      THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.    
	      THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.	   
	      THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
	      THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.    
	      THISFORM.WASTE_BOTT.ENABLED=.F. 
	      THISFORM.LEAVE_BOTT.ENABLED=.F. 
	      THISFORM.PAGEFRAME1.PAGE2.TXTF01.VALUE=''   
	      THISFORM.PAGEFRAME1.PAGE2.TXTF11.VALUE=''   
	      THISFORM.PAGEFRAME1.PAGE2.TXTF12.VALUE='' 
	      THISFORM.PAGEFRAME1.PAGE2.TXTF13.VALUE='' 
	      THISFORM.PAGEFRAME1.PAGE2.TXTF14.VALUE=''    
	      THISFORM.PAGEFRAME1.PAGE2.TXTF18.VALUE=''      	      
	      THISFORM.PAGEFRAME1.PAGE2.LBLF151.CAPTION='' 
	      THISFORM.PAGEFRAME1.PAGE2.LBLF161.CAPTION=''  
	      THISFORM.PAGEFRAME1.PAGE2.LBLF171.CAPTION=''  
	      THISFORM.PAGEFRAME1.PAGE2.LBLF991.CAPTION=''     
	      THISFORM.PAGEFRAME1.PAGE2.LBLF23.CAPTION=''    
	      THISFORM.PAGEFRAME1.PAGE2.LBLF231.CAPTION='' 
	      THISFORM.PAGEFRAME1.PAGE2.LBLF20.CAPTION='' 
	      THISFORM.PAGEFRAME1.PAGE2.LBLF21.CAPTION='' 
	      THISFORM.PAGEFRAME1.PAGE2.LBLF22.CAPTION='' 
	      THISFORM.PAGEFRAME1.PAGE2.LBLF26.CAPTION='' 
	      THISFORM.PAGEFRAME1.PAGE2.LBLF27.CAPTION='' 
	      THISFORM.PAGEFRAME1.PAGE2.LBLF28.CAPTION='' 
	      THISFORM.PAGEFRAME1.PAGE2.LBLF31.VISIBLE=.F. 
	ELSE
	      THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
	      THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
	      THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.	
	      THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.			   
	      THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.		
     	      THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.) AND IIF(S16_1.F19='Y',.F.,.T.) AND IIF(S16.F31<>'1',.T.,.F.) &&判斷有無修改的權限
	      THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)  &&判斷有無列印的權限 
	      THISFORM.WASTE_BOTT.ENABLED=IIF(A02.F11='*',.T.,.F.) AND IIF(S16_1.F19='Y',.F.,.T.)  AND IIF(S16.F31='2',.F.,.T.) AND IIF(EMPTY(S16.F23) AND EMPTY(S16.F26),.T.,.F.) AND IIF(S16.F18=7 OR S16.F18=1 OR INDEXSEEK(DTOS(CTOD(HK+'/'+S16.F01)),.F.,'S15','S151')=.T.,.F.,.T.)&&判斷有無曠職的權限
	      THISFORM.WASTE_BOTT.CAPTION=IIF(S16.F31='1','\<W.反曠職','\<W.曠    職')		   
	      THISFORM.LEAVE_BOTT.ENABLED=IIF(A02.F12='*',.T.,.F.) AND IIF(S16_1.F19='Y',.F.,.T.) AND  IIF(EMPTY(S16.F23) AND EMPTY(S16.F26),.T.,.F.) &&判斷有無離職的權限
	      THISFORM.LEAVE_BOTT.CAPTION=IIF(S16.F31='2','\<L.反離職','\<L.離    職')			        
	      THISFORM.GRID2.AFTERROWCOLCHANGE 	
	ENDIF          	
        R=RECNO('&AREA1') 
        THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(RECNO('&AREA1')=R,RGB(255,255,0),'')","COLUMN")
        THISFORM.GRID1.ENABLED=.F.  
        THISFORM.KEY_LIST.ENABLED=.F. 	                 
*!*	        THISFORM.REFRESH    
  ENDPROC   
**********    
  PROC KEY_LIST.INIT 
       WITH THIS 
           .ADDITEM('依員工編號排列')
           .ADDITEM('依員工姓名排列')
           .VALUE=1
       ENDWITH             
  ENDPROC
********* 
  PROC KEY_LIST.INTERACTIVECHANGE                 
       SELE S16_1
       DO CASE
          CASE THIS.DISPLAYVALUE='依員工編號排列'
               SET ORDER TO S16_11 
	       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='員工編號'
	       THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='員工姓名'
	       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='S16_1.F02'
	       THISFORM.GRID1.COLUMN2.CONTROLSOURCE='S16_1.F03'
	       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*50
	       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*55 
          CASE THIS.DISPLAYVALUE='依員工姓名排列'
               SET ORDER TO S16_12
	       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='員工姓名'
	       THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='員工編號'
	       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='S16_1.F03'
	       THISFORM.GRID1.COLUMN2.CONTROLSOURCE='S16_1.F02'
	       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*55
	       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*50
       ENDCASE 
        THISFORM.GRID1.SETFOCUS
  ENDPROC      
***********
  PROC MTH_LIST.INTERACTIVECHANGE
    HK = ALLTRIM(THISFORM.MTH_LIST.DISPLAYVALUE)
    THISFORM.GRID1.RECORDSOURCE=''
    THISFORM.GRID2.RECORDSOURCE=''
    THISFORM.GRID2.LINKMASTER=''  
    SELECT S21
    USE
    SELECT S16_WORK 
    USE        
    SELECT S16_1
    USE
    SELECT S16
    USE
	S21 = 'S21' + LEFT(DTOS(CTOD(THIS.DISPLAYVALUE + '/01')),6)
	IF FILE('&S21'+'.DBF')=.T.
	    IF !USED('&S21')	&&刷卡資料
	       SELECT 0
	       USE (S21) ALIA S21
	    ELSE
	       SELECT S21
	    ENDIF
	    S211 = 'S211' + LEFT(DTOS(CTOD(HK + '/01')),6)
		S212 = 'S212' + LEFT(DTOS(CTOD(HK + '/01')),6)
	ELSE
	    CREATE CURSOR S21 (F01 C(4),F02 C(8),F03 C(6),F04 D(8),F05 C(1),F06 C(5))
		INDE ON F01 TAG  S211 ASCENDING  
		INDE ON F02 TAG  S212 ASCENDING    
	ENDIF 
	SELECT S21
	SET ORDER TO S211    
	S16 = 'S16' + LEFT(DTOS(CTOD(THIS.DISPLAYVALUE + '/01')),6)
	S161 = 'S161' + LEFT(DTOS(CTOD(THIS.DISPLAYVALUE + '/01')),6)
	IF !USED('&S16')	&&出缺勤紀錄檔
	   SELE 0
	   USE (S16) ALIA S16
	ELSE
	   SELE S16
	ENDIF
	SET ORDER TO S161
	****判斷已刷卡資料日期範圍
	CREATE CURSOR S21_TEMP (F00 C(2),F01 N(1),F02 C(1),F03 C(1))
	INDE ON F00 TAG S21_TEMP1
	SET ORDER TO S21_TEMP1
	SELECT F04 AS F04 FROM S21 GROUP BY F04 ORDER BY F04 DESC INTO CURSOR S21A
	GO TOP
	FOR I = 1 TO IIF(DOW(S21A.F04) = 6,DAY(S21A.F04) + 2,DAY(S21A.F04))
		SELECT S21_TEMP
		APPEND BLANK
		REPLACE S21_TEMP.F00 WITH PADL(ALLTRIM(STR(I)),2,'0')
		REPLACE S21_TEMP.F01 WITH DOW(CTOD(HK + '/' + S21_TEMP.F00))
		REPLACE S21_TEMP.F02 WITH IIF(INDEXSEEK(DTOS(CTOD(HK + '/' + S21_TEMP.F00)),.T.,'S15','S151'),S15.F03,'')
		IF (S21_TEMP.F01 = 1 OR S21_TEMP.F01 = 7) AND S21_TEMP.F02 = '2' 
		   REPLACE S21_TEMP.F03 WITH 'Y'
		ENDIF
		IF (S21_TEMP.F01 <> 1 AND S21_TEMP.F01 <> 7) AND S21_TEMP.F02 <> '1'
		   REPLACE S21_TEMP.F03 WITH 'Y'
		ENDIF
	ENDFOR
	SELECT S21A
	USE
	****記錄未打卡之日期
	CREATE CURSOR S16_WORK (F00 C(4),F01 C(5),F02 C(6))
	INDE ON F00 + F01 TAG S16_WORK1
	SELECT F01,F02,F11,F12,F20,F23,F26,F18,F31,F32 FROM S16 WHERE F19 <> 'Y' AND EMPTY(F11) OR EMPTY(F12) AND IIF(A02.F10 <> '*',ALLTRIM(S16.F02) = IIF(SEEK(sys_oper,'A01'),A01.F12,.F.),.T.) ORDER BY F02,F01 INTO CURSOR S16B
	SELECT S16B
	GO TOP
	DO WHILE !EOF()
	   IF EMPTY(S16B.F23) AND S16B.F31 = ' ' AND IIF(SEEK(S16B.F01,'S21_TEMP'),S21_TEMP.F03 = 'Y',.F.)
	      SELECT S16_WORK 
	      APPEND BLANK 
	      REPLACE S16_WORK.F00 WITH S16B.F02
	      REPLACE S16_WORK.F01 WITH RIGHT(HK,2) + '/' + S16B.F01
	      DO CASE
	         CASE EMPTY(S16B.F11) AND EMPTY(S16B.F12)
	              REPLACE S16_WORK.F02 WITH '上下班'
	         CASE EMPTY(S16B.F11) AND !EMPTY(S16B.F12)
	              REPLACE S16_WORK.F02 WITH '上班'
	         CASE !EMPTY(S16B.F11) AND EMPTY(S16B.F12)
	              REPLACE S16_WORK.F02 WITH '下班'
	      ENDCASE      
	   ENDIF 
	   SELECT S16B
	   SKIP
	ENDDO
	SELECT S16B
	USE
	SELECT S21_TEMP
	USE
	SELECT S16_WORK 
	SET ORDER TO S16_WORK1
	GO TOP	
	****
	CREATE CURSOR S16_TEMP;
	(F02 C(4),F03 C(8),F04 C(4),F05 C(8),F06 C(5),F07 C(5),F08 C(5),F09 C(5),F10 C(5),F19 C(1),SUM_F15 N(5),SUM_F16 N(5),SUM_F171 N(6,1),SUM_F172 N(6,1),SUM_F18 N(2),F99 C(17))
	SELECT F01,F02,F03,F04,F05,F06,F07,F08,F09,F10,F19,F15,F16,F17,F18,F31,F99 FROM S16;
	              WHERE IIF(A02.F10<>'*',ALLTRIM(S16.F02)=IIF(SEEK(sys_oper,'A01'),A01.F12,.F.),.T.) ORDER BY S16.F02   INTO CURSOR  S16A
	SELECT S16A
	GO TOP
	DO WHILE !EOF()
	       SELECT S16_TEMP
	       APPEND BLANK 
	       REPLACE S16_TEMP.F02 WITH S16A.F02
	       REPLACE S16_TEMP.F03 WITH S16A.F03
	       REPLACE S16_TEMP.F04 WITH S16A.F04
	       REPLACE S16_TEMP.F05 WITH S16A.F05
	       REPLACE S16_TEMP.F06 WITH S16A.F06
	       REPLACE S16_TEMP.F07 WITH S16A.F07
	       REPLACE S16_TEMP.F08 WITH S16A.F08
	       REPLACE S16_TEMP.F09 WITH S16A.F09
	       REPLACE S16_TEMP.F10 WITH S16A.F10
	       REPLACE S16_TEMP.F19 WITH S16A.F19
	       REPLACE S16_TEMP.SUM_F15 WITH S16_TEMP.SUM_F15+S16A.F15
	       REPLACE S16_TEMP.SUM_F16 WITH S16_TEMP.SUM_F16+S16A.F16
	       IF S16A.F18<>1 AND S16A.F18<>7 AND IIF(INDEXSEEK(DTOS(CTOD(HK+'/'+S16A.F01)),.T.,'S15','S151'),S15.F03<>'1',.T.)
	           REPLACE S16_TEMP.SUM_F171 WITH S16_TEMP.SUM_F171+S16A.F17
	       ELSE      
	           REPLACE S16_TEMP.SUM_F172 WITH S16_TEMP.SUM_F172+S16A.F17
	       ENDIF    
	       REPLACE S16_TEMP.SUM_F18 WITH S16_TEMP.SUM_F18+IIF(S16A.F31='1',1,0)
	       REPLACE S16_TEMP.F99 WITH S16A.F99
	       SELECT S16A
	       SKIP
	ENDDO
	SELECT S16A
	USE
	SELECT F02,F03,F04,F05,F06,F07,F08,F09,F10,F19,SUM(SUM_F15),SUM(SUM_F16),SUM(SUM_F171),SUM(SUM_F172),SUM(SUM_F18),F99;
	               FROM S16_TEMP ORDER BY S16_TEMP.F02 GROUP BY S16_TEMP.F02   INTO CURSOR S16_1 READWRITE 
	INDE ON F02 TAG S16_11
	INDE ON F03 TAG S16_12
	SELECT S16_TEMP
	USE
	SELECT S16_1
	SET ORDER TO S16_11   
	GO TOP
	***  
        THISFORM.ANS_BOTT.VISIBLE=.T.       
        THISFORM.WASTE_BOTT.VISIBLE=.F.
        THISFORM.WASTE_BOTT.ENABLED=.F.
        THISFORM.LEAVE_BOTT.VISIBLE=.F.
        THISFORM.LEAVE_BOTT.ENABLED=.F.        
        THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.  		
        THISFORM.GRID1.RECORDSOURCE='S16_1'  	     
        THISFORM.GRID2.RECORDSOURCE='S16'
        THISFORM.GRID2.LINKMASTER='S16_1'
        THISFORM.GRID2.RELATIONALEXPR='F02'
        THISFORM.GRID2.CHILDORDER='S161'    
        THISFORM.GRID1.COLUMN1.WIDTH=INT_015*55
        THISFORM.GRID1.COLUMN2.WIDTH=INT_015*55   
        THISFORM.GRID1.COLUMN3.WIDTH=INT_015*55        
       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='S16_1.F02'
       THISFORM.GRID1.COLUMN2.CONTROLSOURCE='S16_1.F03'
       THISFORM.GRID1.COLUMN3.CONTROLSOURCE='S16_1.F05'        
       THISFORM.KEY_LIST.INTERACTIVECHANGE  
        THISFORM.GRID2.COLUMN1.CONTROLSOURCE='S16.F01'
       THISFORM.GRID2.COLUMN2.CONTROLSOURCE="IIF(EMPTY(S16.F31),S16.F11,'')"
       THISFORM.GRID2.COLUMN3.CONTROLSOURCE="IIF(EMPTY(S16.F31),S16.F12,'')"
       THISFORM.GRID2.COLUMN4.CONTROLSOURCE="IIF(EMPTY(S16.F31),S16.F13,'')"
       THISFORM.GRID2.COLUMN5.CONTROLSOURCE="IIF(EMPTY(S16.F31),S16.F14,'')"
       THISFORM.GRID2.COLUMN6.CONTROLSOURCE="IIF(EMPTY(S16.F31),IIF(EMPTY(S16.F15),'',S16.F15),'')"
       THISFORM.GRID2.COLUMN7.CONTROLSOURCE="IIF(EMPTY(S16.F31),IIF(EMPTY(S16.F16),'',S16.F16),'')"
       THISFORM.GRID2.COLUMN8.CONTROLSOURCE="IIF(EMPTY(S16.F31),IIF(EMPTY(S16.F17),'',S16.F17),'')"
       THISFORM.GRID2.COLUMN9.CONTROLSOURCE="IIF(EMPTY(S16.F31),IIF(EMPTY(S16.F24) OR LEN(ALLTRIM(S16.F24))=1,'',S16.F24),'')"
       THISFORM.GRID2.COLUMN10.CONTROLSOURCE="IIF(EMPTY(S16.F31),IIF(EMPTY(S16.F25) OR LEN(ALLTRIM(S16.F25))=1,'',S16.F25),'')"
        THISFORM.GRID2.COLUMN11.CONTROLSOURCE='S16.F99'                      
        THISFORM.GRID1.READONLY=.T.      
        THISFORM.GRID2.READONLY=.T.     
        THISFORM.GRID1.SETFOCUS         
        IF THISFORM.GRID1.ACTIVEROW=0
            THISFORM.PAGEFRAME1.PAGE1.ENABLED=.F.
	    THISFORM.PAGEFRAME1.PAGE2.ENABLED=.F. 
            THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
	    THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
	    THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
	    THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.    
	    THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.	
            THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F. 	   	         
            THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
            THISFORM.INOUT_BOTT.ENABLED=.F.
            THISFORM.ANS_BOTT.ENABLED=.F.     
            THISFORM.OUT_BOTT.ENABLED=.F. 
	    THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE=''
	    THISFORM.PAGEFRAME1.PAGE1.TXTF04.VALUE=''
	    THISFORM.PAGEFRAME1.PAGE1.TXTF06.VALUE=''
	    THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE=''
	    THISFORM.PAGEFRAME1.PAGE1.TXTF08.VALUE=''
	    THISFORM.PAGEFRAME1.PAGE1.TXTF09.VALUE='' 
	    THISFORM.PAGEFRAME1.PAGE1.TXTF10.VALUE='' 
	    THISFORM.PAGEFRAME1.PAGE1.LBLF03.CAPTION=''
	    THISFORM.PAGEFRAME1.PAGE1.LBLF05.CAPTION=''
	    THISFORM.PAGEFRAME1.PAGE1.LBLF15.CAPTION='遲到總分鐘數：'
	    THISFORM.PAGEFRAME1.PAGE1.LBLF16.CAPTION='早退總分鐘數：'
	    THISFORM.PAGEFRAME1.PAGE1.LBLF171.CAPTION='平日加班總小時數：'	 
	    THISFORM.PAGEFRAME1.PAGE1.LBLF172.CAPTION='假日加班總小時數：'	  
	    THISFORM.PAGEFRAME1.PAGE1.LBLF18.CAPTION=''   
	    THISFORM.PAGEFRAME1.PAGE1.LBLF191.CAPTION=''                  
	    THISFORM.PAGEFRAME1.PAGE1.LBLF_WORK.VISIBLE=.F. 
	    THISFORM.PAGEFRAME1.PAGE1.LBLF_WORK1.VISIBLE=.F. 
	    THISFORM.PAGEFRAME1.PAGE1.LBLF_WORK2.VISIBLE=.F. 
	    THISFORM.PAGEFRAME1.PAGE1.LBLF_WORK3.VISIBLE=.F. 	    
        ELSE
            THISFORM.PAGEFRAME1.PAGE1.ENABLED=.T.
	    THISFORM.PAGEFRAME1.PAGE2.ENABLED=.T.     
            THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
	    THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
	    THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
	    THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.    
	    THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.		          
	    THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)  AND IIF(S16_1.F19<>'Y',.T.,.F.)   &&判斷有無刪除的權限	            		      	   
            THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限  
            THISFORM.ANS_BOTT.ENABLED=IIF(S16_1.F19<>'Y',IIF(A02.F08='*',.T.,.F.),IIF(A02.F09='*',.T.,.F.))
            THISFORM.INOUT_BOTT.ENABLED=.T.
            THISFORM.OUT_BOTT.ENABLED=IIF(A02.F08='*',.T.,.F.) AND IIF(A02.F10='*',.T.,.F.)
        ENDIF          
        THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.)
        JK='員工編號'
        SELECT  S16_1
        GO TOP
        THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE=S16_1.F02        
  ENDPROC
************
  PROC GRID1.AFTERROWCOLCHANGE
       LPARAMETERS NCOLINDEX
        THISFORM.ANS_BOTT.CAPTION=IIF(S16_1.F19 <> 'Y','\<A.確認','\<A.反確認')
        THISFORM.PAGEFRAME1.PAGE1.LBLF_WORK1.CAPTION=''
        THISFORM.PAGEFRAME1.PAGE1.LBLF_WORK2.CAPTION=''
        THISFORM.PAGEFRAME1.PAGE1.LBLF_WORK3.CAPTION=''
        SELECT * FROM S16_WORK WHERE S16_WORK.F00 = S16_1.F02 ORDER BY S16_WORK.F01 INTO CURSOR S16C
        SELECT S16C
        GO TOP
        IF _TALLY >0
              THISFORM.PAGEFRAME1.PAGE1.LBLF_WORK.VISIBLE = .T.
              FOR I = 1 TO 6
                     SELECT S16C
                     IF !EOF()
                          THISFORM.PAGEFRAME1.PAGE1.LBLF_WORK1.CAPTION= ALLTRIM(THISFORM.PAGEFRAME1.PAGE1.LBLF_WORK1.CAPTION)+','+S16C.F01+' '+S16C.F02
                          SELECT S16C
                          SKIP
                     ENDIF
              ENDFOR
              FOR I = 1 TO 6
                     SELECT S16C
                     IF !EOF()
                          THISFORM.PAGEFRAME1.PAGE1.LBLF_WORK2.CAPTION= ALLTRIM(THISFORM.PAGEFRAME1.PAGE1.LBLF_WORK2.CAPTION)+','+S16C.F01+' '+S16C.F02
                          SELECT S16C
                          SKIP
                     ENDIF
              ENDFOR       
              FOR I = 1 TO 20
                     SELECT S16C
                     IF !EOF()
                          THISFORM.PAGEFRAME1.PAGE1.LBLF_WORK3.CAPTION= ALLTRIM(THISFORM.PAGEFRAME1.PAGE1.LBLF_WORK3.CAPTION)+','+S16C.F01+' '+S16C.F02
                          SELECT S16C
                          SKIP
                     ENDIF
              ENDFOR                        
        ENDIF      
        THISFORM.PAGEFRAME1.PAGE1.LBLF_WORK1.CAPTION= STUFF(ALLTRIM(THISFORM.PAGEFRAME1.PAGE1.LBLF_WORK1.CAPTION),1,1,' ')    
        THISFORM.PAGEFRAME1.PAGE1.LBLF_WORK2.CAPTION= STUFF(ALLTRIM(THISFORM.PAGEFRAME1.PAGE1.LBLF_WORK2.CAPTION),1,1,' ')
        THISFORM.PAGEFRAME1.PAGE1.LBLF_WORK3.CAPTION= STUFF(ALLTRIM(THISFORM.PAGEFRAME1.PAGE1.LBLF_WORK3.CAPTION),1,1,' ') 
        THISFORM.PAGEFRAME1.PAGE1.LBLF_WORK.VISIBLE=IIF(LEN(ALLTRIM(THISFORM.PAGEFRAME1.PAGE1.LBLF_WORK1.CAPTION))>1,.T.,.F.)
        THISFORM.PAGEFRAME1.PAGE1.LBLF_WORK1.VISIBLE=IIF(LEN(ALLTRIM(THISFORM.PAGEFRAME1.PAGE1.LBLF_WORK1.CAPTION))>1,.T.,.F.)
        THISFORM.PAGEFRAME1.PAGE1.LBLF_WORK2.VISIBLE=IIF(LEN(ALLTRIM(THISFORM.PAGEFRAME1.PAGE1.LBLF_WORK2.CAPTION))>1,.T.,.F.)
        THISFORM.PAGEFRAME1.PAGE1.LBLF_WORK3.VISIBLE=IIF(LEN(ALLTRIM(THISFORM.PAGEFRAME1.PAGE1.LBLF_WORK3.CAPTION))>1,.T.,.F.)    
        SELECT S16_1
        THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(S16_1.F19<>'Y',RGB(255,0,0),'')","COLUMN")    	     &&若為有尚未確認之內容則呈現紅色否則為外包人員則秀出天空藍顏色      
        THISFORM.GRID1.TOOLTIPTEXT=IIF(S16_1.F19<>'Y','尚未確認','已確認')  
        THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE=S16_1.F02  
        THISFORM.PAGEFRAME1.PAGE1.TXTF04.VALUE=S16_1.F04
        THISFORM.PAGEFRAME1.PAGE1.TXTF06.VALUE=S16_1.F06
        THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE=S16_1.F07
        THISFORM.PAGEFRAME1.PAGE1.TXTF08.VALUE=S16_1.F08
        THISFORM.PAGEFRAME1.PAGE1.TXTF09.VALUE=S16_1.F09
        THISFORM.PAGEFRAME1.PAGE1.TXTF10.VALUE=S16_1.F10
        THISFORM.PAGEFRAME1.PAGE1.LBLF03.CAPTION=S16_1.F03   
        THISFORM.PAGEFRAME1.PAGE1.LBLF05.CAPTION=S16_1.F05  
	THISFORM.PAGEFRAME1.PAGE1.LBLF15.CAPTION='遲到總分鐘數：'+ALLTRIM(TRANSFORM(S16_1.SUM_SUM_F15,'@R 999,999'))+' 分鐘'
	THISFORM.PAGEFRAME1.PAGE1.LBLF16.CAPTION='早退總分鐘數：'+ALLTRIM(TRANSFORM(S16_1.SUM_SUM_F16,'@R 999,999'))+' 分鐘'
	THISFORM.PAGEFRAME1.PAGE1.LBLF171.CAPTION='平日加班總小時數：'+ALLTRIM(TRANSFORM(S16_1.SUM_SUM_F171,'@R 999,999.9'))+' 小時'      
	THISFORM.PAGEFRAME1.PAGE1.LBLF172.CAPTION='假日加班總小時數：'+ALLTRIM(TRANSFORM(S16_1.SUM_SUM_F172,'@R 999,999.9'))+' 小時'  
	THISFORM.PAGEFRAME1.PAGE1.LBLF15.BACKCOLOR=IIF(EMPTY(S16_1.SUM_SUM_F15),RGB(192,192,192),RGB(255,255,0))
	THISFORM.PAGEFRAME1.PAGE1.LBLF16.BACKCOLOR=IIF(EMPTY(S16_1.SUM_SUM_F16),RGB(192,192,192),RGB(255,255,0))
	THISFORM.PAGEFRAME1.PAGE1.LBLF171.BACKCOLOR=IIF(EMPTY(S16_1.SUM_SUM_F171),RGB(192,192,192),RGB(255,255,0))
	THISFORM.PAGEFRAME1.PAGE1.LBLF172.BACKCOLOR=IIF(EMPTY(S16_1.SUM_SUM_F172),RGB(192,192,192),RGB(255,255,0))
	THISFORM.PAGEFRAME1.PAGE1.LBLF18.VISIBLE=IIF(INDEXSEEK('G'+'A2',.T.,'S00','S003'),IIF(S16_1.SUM_SUM_F18>=S00.F29,.T.,.F.),.F.)		
	THISFORM.PAGEFRAME1.PAGE1.LBLF18.CAPTION=IIF(INDEXSEEK('G'+'A2',.T.,'S00','S003'),IIF(S16_1.SUM_SUM_F18>=S00.F29,'已超過年度曠職天數( '+ALLTRIM(TRANSFORM(S00.F29,'@R 999.9'))+' 天)',''),'')
	THISFORM.PAGEFRAME1.PAGE1.LBLF18.BACKCOLOR=IIF(INDEXSEEK('G'+'A2',.T.,'S00','S003'),IIF(S16_1.SUM_SUM_F18>=S00.F29,RGB(255,0,0),RGB(58,186,152)),RGB(58,186,152))		
        THISFORM.PAGEFRAME1.PAGE1.LBLF191.CAPTION=IIF(S16_1.F19<>'Y','尚未確認','已確認') 
        THISFORM.PAGEFRAME1.PAGE1.LBLF191.BACKCOLOR=IIF(S16_1.F19<>'Y',RGB(255,0,0),RGB(58,186,152))
        THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
       	IF THISFORM.GRID1.ACTIVEROW=0 
	       THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
	       THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
	       THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
	       THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
	       THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
	       THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
	       THISFORM.INOUT_BOTT.ENABLED=.F.	
	       THISFORM.ANS_BOTT.ENABLED=.F.   
	       THISFORM.OUT_BOTT.ENABLED=.F. 	       
	       THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE=''
	       THISFORM.PAGEFRAME1.PAGE1.TXTF04.VALUE=''
	       THISFORM.PAGEFRAME1.PAGE1.TXTF06.VALUE=''
	       THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE=''
	       THISFORM.PAGEFRAME1.PAGE1.TXTF08.VALUE=''
	       THISFORM.PAGEFRAME1.PAGE1.TXTF09.VALUE='' 
	       THISFORM.PAGEFRAME1.PAGE1.TXTF10.VALUE='' 	       
	       THISFORM.PAGEFRAME1.PAGE1.LBLF03.CAPTION=''
	       THISFORM.PAGEFRAME1.PAGE1.LBLF05.CAPTION=''
	       THISFORM.PAGEFRAME1.PAGE1.LBLF15.CAPTION='遲到總分鐘數：'
	       THISFORM.PAGEFRAME1.PAGE1.LBLF16.CAPTION='早退總分鐘數：'
	       THISFORM.PAGEFRAME1.PAGE1.LBLF171.CAPTION='平日加班總小時數：'     
	       THISFORM.PAGEFRAME1.PAGE1.LBLF172.CAPTION='假日加班總小時數：'       
	       THISFORM.PAGEFRAME1.PAGE1.LBLF191.CAPTION=''       
 	 ELSE
	       THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
	       THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
	       THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
	       THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
	       THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T. 
	       THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)  AND IIF(S16_1.F19='Y',.F.,.T.)  &&判斷有無刪除的權限	      
	       THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)  &&判斷有無列印的權限 	
	       THISFORM.ANS_BOTT.ENABLED=IIF(S16_1.F19<>'Y',IIF(A02.F08='*',.T.,.F.),IIF(A02.F09='*',.T.,.F.))
	       THISFORM.INOUT_BOTT.ENABLED=.T.
	       THISFORM.OUT_BOTT.ENABLED=IIF(A02.F08='*',.T.,.F.) AND IIF(A02.F10='*',.T.,.F.)   
         ENDIF	   
	THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.) &&判斷有無新增的權限	               
         FCH=THISFORM.ACTIVECONTROL.NAME
         JK=THIS.COLUMN1.HEADER1.CAPTION  
         IF THIS.ACTIVEROW=0
             THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
         ELSE
            THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.
         ENDIF   
         CHK=''     
*!*	       THISFORM.REFRESH
  ENDPROC     
**********  
  PROC GRID2.AFTERROWCOLCHANGE
       LPARAMETERS NCOLINDEX
         THISFORM.GRID2.SETALL("DYNAMICBACKCOLOR","IIF(S16.F31='2',RGB(255,0,0),IIF(S16.F31='1',RGB(255,255,0),IIF(!EMPTY(S16.F20) OR !EMPTY(S16.F23) OR !EMPTY(S16.F26),RGB(0,255,255),IIF(S16.F18=7 OR S16.F18=1 OR INDEXSEEK(DTOS(CTOD(HK+'/'+S16.F01)),.F.,'S15','S151')=.T.,RGB(213,205,168),''))))","COLUMN")         
         THISFORM.GRID2.TOOLTIPTEXT=DAY_WEEK(S16.F18)+IIF(INDEXSEEK(DTOS(CTOD(HK+'/'+S16.F01)),.T.,'S15','S151'),SPACE(5)+ALLTRIM(S15.F02),'')
         THISFORM.PAGEFRAME1.PAGE2.TXTF01.VALUE=S16.F01 
         THISFORM.PAGEFRAME1.PAGE2.TXTF11.VALUE=S16.F11
         THISFORM.PAGEFRAME1.PAGE2.TXTF12.VALUE=S16.F12
         THISFORM.PAGEFRAME1.PAGE2.TXTF13.VALUE=S16.F13
         THISFORM.PAGEFRAME1.PAGE2.TXTF14.VALUE=S16.F14
         THISFORM.PAGEFRAME1.PAGE2.TXTF18.VALUE=S16.F18
   	 THISFORM.PAGEFRAME1.PAGE2.LBLF151.CAPTION=ALLTRIM(STR(S16.F15))
   	 THISFORM.PAGEFRAME1.PAGE2.LBLF161.CAPTION=ALLTRIM(STR(S16.F16))
   	 THISFORM.PAGEFRAME1.PAGE2.LBLF171.CAPTION=ALLTRIM(TRANSFORM(S16.F17,'@R 999,999.9'))
   	 THISFORM.PAGEFRAME1.PAGE2.LBLF181.CAPTION=DAY_WEEK(S16.F18)+IIF(INDEXSEEK(DTOS(CTOD(HK+'/'+S16.F01)),.T.,'S15','S151'),SPACE(5)+ALLTRIM(S15.F02),'')
   	 THISFORM.PAGEFRAME1.PAGE2.LBLF181.BACKCOLOR=IIF(S16.F18=1 OR S16.F18=7 OR INDEXSEEK(DTOS(CTOD(HK+'/'+S16.F01)),.F.,'S15','S151')=.T.,RGB(247,100,115),RGB(58,186,152))
   	 THISFORM.PAGEFRAME1.PAGE2.LBLF991.CAPTION=S16.F99   
   	 ***** 
   	 THISFORM.PAGEFRAME1.PAGE2.LBLF23.VISIBLE=IIF(EMPTY(S16.F23),.F.,.T.)
   	 THISFORM.PAGEFRAME1.PAGE2.LBLF231.VISIBLE=IIF(EMPTY(S16.F23),.F.,.T.)
   	 THISFORM.PAGEFRAME1.PAGE2.LBLF20.VISIBLE=IIF(EMPTY(S16.F20),.F.,.T.) 
   	 THISFORM.PAGEFRAME1.PAGE2.LBLF21.VISIBLE=IIF(EMPTY(S16.F20),.F.,.T.) &&AND  IIF(LEN(ALLTRIM(S16.F21))=1 OR EMPTY(ALLTRIM(S16.F21)),.F.,.T.)
   	 THISFORM.PAGEFRAME1.PAGE2.LBLF22.VISIBLE=IIF(EMPTY(S16.F20),.F.,.T.) &&AND  IIF(LEN(ALLTRIM(S16.F22))=1 OR EMPTY(ALLTRIM(S16.F22)),.F.,.T.)
   	 THISFORM.PAGEFRAME1.PAGE2.LBLF26.VISIBLE=IIF(EMPTY(S16.F26),.F.,.T.)
   	 THISFORM.PAGEFRAME1.PAGE2.LBLF27.VISIBLE=IIF(EMPTY(S16.F26),.F.,.T.) &&AND  IIF(LEN(ALLTRIM(S16.F27))=1 OR EMPTY(ALLTRIM(S16.F27)),.F.,.T.)
   	 THISFORM.PAGEFRAME1.PAGE2.LBLF28.VISIBLE=IIF(EMPTY(S16.F26),.F.,.T.) &&AND  IIF(LEN(ALLTRIM(S16.F28))=1 OR EMPTY(ALLTRIM(S16.F28)),.F.,.T.)
	 THISFORM.PAGEFRAME1.PAGE2.LBLF23.CAPTION='S18.請假作業單號：'+S16.F23  
	 THISFORM.PAGEFRAME1.PAGE2.LBLF231.CAPTION='       請假假別名稱：'+IIF(INDEXSEEK(S16.F23,.T.,'S18','S181'),S18.F08,'')
	 THISFORM.PAGEFRAME1.PAGE2.LBLF20.CAPTION='S17.上下班變更單號：'+S16.F20
	 THISFORM.PAGEFRAME1.PAGE2.LBLF21.CAPTION='   變更前上班時間：'+S16.F21
	 THISFORM.PAGEFRAME1.PAGE2.LBLF22.CAPTION='   變更前下班時間：'+S16.F22
	 THISFORM.PAGEFRAME1.PAGE2.LBLF26.CAPTION='S19.加班申請單號：'+S16.F26
	 THISFORM.PAGEFRAME1.PAGE2.LBLF27.CAPTION='變更前加班上班時間：'+S16.F27
	 THISFORM.PAGEFRAME1.PAGE2.LBLF28.CAPTION='變更前加班下班時間：'+S16.F28
	 THISFORM.PAGEFRAME1.PAGE2.LBLF31.VISIBLE=IIF(S16.F31='1' OR S16.F31='2',.T.,.F.) 
	 THISFORM.PAGEFRAME1.PAGE2.LBLF31.CAPTION=IIF(S16.F31='1','已曠職','已離職') 
	 THISFORM.PAGEFRAME1.PAGE2.LBLF31.BACKCOLOR=IIF(S16.F31='1',RGB(255,255,0),RGB(255,0,0)) 
	 THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.) AND IIF(S16_1.F19='Y',.F.,.T.) AND IIF(S16.F31<>'1',.T.,.F.) &&判斷有無修改的權限
         THISFORM.ANS_BOTT.ENABLED=.F.
         THISFORM.INOUT_BOTT.ENABLED=.F.
         THISFORM.OUT_BOTT.ENABLED=.F.
         IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
             THISFORM.ORPGROUP.NEW_BOTT.ENABLED=.F.
             THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
             THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.   
             THISFORM.WASTE_BOTT.VISIBLE=.F.   
             THISFORM.LEAVE_BOTT.VISIBLE=.F.  
        ELSE
             THISFORM.WASTE_BOTT.VISIBLE=.T.
             THISFORM.LEAVE_BOTT.VISIBLE=.T.
	     THISFORM.WASTE_BOTT.ENABLED=IIF(A02.F11='*',.T.,.F.) AND IIF(S16_1.F19='Y',.F.,.T.)  AND IIF(S16.F31='2',.F.,.T.) AND IIF(EMPTY(S16.F23) AND EMPTY(S16.F26),.T.,.F.) AND IIF(S16.F18=7 OR S16.F18=1 OR INDEXSEEK(DTOS(CTOD(HK+'/'+S16.F01)),.F.,'S15','S151')=.T.,.F.,.T.)&&判斷有無曠職的權限
	     THISFORM.WASTE_BOTT.CAPTION=IIF(S16.F31='1','\<W.反曠職','\<W.曠    職')		   
	     THISFORM.LEAVE_BOTT.ENABLED=IIF(A02.F12='*',.T.,.F.) AND IIF(S16_1.F19='Y',.F.,.T.) AND  IIF(EMPTY(S16.F23) AND EMPTY(S16.F26),.T.,.F.) &&判斷有無離職的權限
	     THISFORM.LEAVE_BOTT.CAPTION=IIF(S16.F31='2','\<L.反離職','\<L.離    職')			              	 
        ENDIF			    			 
         FCH=THISFORM.ACTIVECONTROL.NAME
         JK=THIS.COLUMN1.HEADER1.CAPTION
         CHK=THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE 
         IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
             THISFORM. CMDGROUP.SEEK_BOTT.ENABLED=.F.
         ENDIF       
*       THISFORM.REFRESH
  ENDPROC 
***********
PROCEDURE ORPGROUP.NEW_BOTT.CLICK
     THISFORM.KEY_LIST.ENABLED=.F.
     THISFORM.MTH_LIST.ENABLED=.F.
     THISFORM.GRID1.ENABLED=.F.
     THISFORM.GRID2.ENABLED=.F.
     THISFORM.ANS_BOTT.ENABLED=.F.
     THISFORM.INOUT_BOTT.ENABLED=.F.
     THISFORM.OUT_BOTT.ENABLED=.F.
     IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
        THISFORM.PAGEFRAME1.PAGE1.ENABLED=.T.
        THISFORM.PAGEFRAME1.PAGE2.ENABLED=.F.
	  	THISFORM.PAGEFRAME1.PAGE1.TXTF02.READONLY=.F.
	  	THISFORM.SETALL('READONLY',.T.,'TEXTBOX')
		THISFORM.COMBOBOX02.VISIBLE=.T.
		THISFORM.COMBOBOX02.CLICK
		THISFORM.COMBOBOX02.VALUE=1
		THISFORM.PAGEFRAME1.PAGE1.TXTF02.VISIBLE=.F.
		THISFORM.PAGEFRAME1.PAGE1.TXTF04.VALUE=''
		THISFORM.PAGEFRAME1.PAGE1.TXTF06.VALUE=''
		THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE=''
		THISFORM.PAGEFRAME1.PAGE1.TXTF08.VALUE=''
		THISFORM.PAGEFRAME1.PAGE1.TXTF09.VALUE=''
		THISFORM.PAGEFRAME1.PAGE1.TXTF10.VALUE=''
		THISFORM.PAGEFRAME1.PAGE1.LBLF03.CAPTION=''
		THISFORM.PAGEFRAME1.PAGE1.LBLF05.CAPTION=''
	    THISFORM.PAGEFRAME1.PAGE1.LBLF15.CAPTION='遲到總分鐘數：'
	    THISFORM.PAGEFRAME1.PAGE1.LBLF16.CAPTION='早退總分鐘數：'
	    THISFORM.PAGEFRAME1.PAGE1.LBLF171.CAPTION='平日加班總小時數：'
	    THISFORM.PAGEFRAME1.PAGE1.LBLF172.CAPTION='假日加班總小時數：'
		THISFORM.PAGEFRAME1.PAGE1.LBLF191.CAPTION=''
		THISFORM.PAGEFRAME1.PAGE1.LBLF15.BACKCOLOR = RGB(192,192,192)
		THISFORM.PAGEFRAME1.PAGE1.LBLF16.BACKCOLOR = RGB(192,192,192)
		THISFORM.PAGEFRAME1.PAGE1.LBLF171.BACKCOLOR = RGB(192,192,192)
		THISFORM.PAGEFRAME1.PAGE1.LBLF172.BACKCOLOR = RGB(192,192,192)
	    THISFORM.COMBOBOX02.SETFOCUS
     ENDIF
  ENDPROC
*************  
PROCEDURE SHRGROUP.SHURE1_BOTT.CLICK               &&新增確認
    SELECT S16_1
    COD = SYS(21)
    SET ORDER TO &COD
    IF EMPTY(THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE)
       =MESSAGEBOX('員工編號不得空白!',0+64,'提示訊息視窗')
       THISFORM.COMBOBOX02.SETFOCUS
  	   SET ORDER TO &COD
  	   RETURN
    ENDIF
    SELECT S16_1
    APPEND BLANK
    LOCK()
    IF RLOCK()
	   REPLACE S16_1.F02 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE
	   REPLACE S16_1.F03 WITH ALLTRIM(THISFORM.PAGEFRAME1.PAGE1.LBLF03.CAPTION)
	   REPLACE S16_1.F04 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF04.VALUE
	   REPLACE S16_1.F05 WITH ALLTRIM(THISFORM.PAGEFRAME1.PAGE1.LBLF05.CAPTION)
	   REPLACE S16_1.F06 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF06.VALUE
	   REPLACE S16_1.F07 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE
	   REPLACE S16_1.F08 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF08.VALUE
	   REPLACE S16_1.F09 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF09.VALUE
	   REPLACE S16_1.F10 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF10.VALUE
	   REPLACE S16_1.F19 WITH 'N'
	   REPLACE S16_1.F99 WITH DTCX(DATE()) + IIF(SEEK(SYS_OPER,'A01'),A01.F03,'')
    ENDIF
    FOR I = 1 TO DAY_NUM(HK)
	    SELECT S16
	    APPEND BLANK
	    REPLACE S16.F01 WITH PADL(ALLTRIM(STR(I)),2,'0')
	    REPLACE S16.F02 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE
	    REPLACE S16.F03 WITH ALLTRIM(THISFORM.PAGEFRAME1.PAGE1.LBLF03.CAPTION)
	    REPLACE S16.F04 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF04.VALUE
	    REPLACE S16.F05 WITH ALLTRIM(THISFORM.PAGEFRAME1.PAGE1.LBLF05.CAPTION)
	    REPLACE S16.F06 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF06.VALUE
	    REPLACE S16.F07 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE
	    REPLACE S16.F08 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF08.VALUE
	    REPLACE S16.F09 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF09.VALUE
	    REPLACE S16.F10 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF10.VALUE
	    REPLACE S16.F18 WITH DOW(CTOD(ALLTRIM(HK + '/' + S16.F01)))
	    REPLACE S16.F19 WITH 'N'
        REPLACE S16.F99 WITH DTCX(DATE()) +  IIF(SEEK(SYS_OPER,'A01'),A01.F03,'')  
        IF IIF(INDEXSEEK(S16.F02,.T.,'S05','S051'),S05.F30 = '1',.F.) = .T.	&&判斷該人員是否需要刷卡
	       SELECT S21.* FROM S21 WHERE S21.F01 = S16.F02 AND DTOS(S21.F04) = DTOS(CTOD(HK + '/' + PADL(ALLTRIM(STR(I)),2,'0'))) ORDER BY S21.F01,S21.F05,S21.F06 INTO CURSOR S21_TEMP
	       SELECT S21_TEMP
	       GO TOP
	       IF _TALLY > 0
	          SELECT S16
	          REPLACE S16.F11 WITH S21_TEMP.F06		&&第一筆資料(上班)
	          SELECT S21_TEMP
	          GO BOTTOM
	          SELECT S16
		      IF ALLTRIM(S21_TEMP.F06) <> ALLTRIM(S16.F11)
		     	 REPLACE S16.F12 WITH S21_TEMP.F06	&&最後一筆資料(下班)
		      ENDIF
		      ***判斷第一筆資料是否在 班別:下班時段 之後
		      IF !EMPTY(S16.F11) AND S16.F11 > S16.F07
		         REPLACE S16.F11 WITH ''
		      ENDIF
		      ***判斷最後一筆資料是否在 班別:上班時段 之前
		      IF !EMPTY(S16.F12) AND S16.F12 < S16.F06
		         REPLACE S16.F12 WITH ''
		      ENDIF
		      REPLACE S16.F32 WITH '1'
	       ENDIF
	       SELECT S21_TEMP
	       USE
        ELSE
	       IF S16.F18 <> 1 AND S16.F18 <> 7 AND IIF(INDEXSEEK(DTOS(CTOD(HK + '/' + S16.F01)),.F.,'S15','S151'),S15.F03 <> '1',.T.)
              SELECT S16
              REPLACE S16.F11 WITH S16.F06
              REPLACE S16.F12 WITH S16.F07
           ENDIF
        ENDIF
    ENDFOR
    SELECT S16
    SET ORDER TO S161
	*****帶入各項單據
    S00_F63 = IIF(SEEK('Y','S00'),S00.F63,'F')		&&加班時間不滿時則以30分鐘計算
    S00_F64 = IIF(SEEK('Y','S00'),S00.F64,'F')		&&加班時間若滿時則以60分鐘計算
	S00_F65 = IIF(SEEK('Y','S00'),S00.F65,'2')		&&加班資料是否依S19加班申請(修改)作業為主(1:是 2:否)
	*****S17.上下班修改作業
	SELECT S17.* FROM S17,S16_1 WHERE S16_1.F02 = S17.F03 AND LEFT(DTOS(S17.F09),6) = LEFT(DTOS(CTOD(HK + '/01')),6) AND S17.F13 = 'Y' AND LEFT(ALLTRIM(S17.F02),2) = 'SA' ORDER BY S17.F02 INTO CURSOR S17B
	SELECT S17B
	GO TOP
	DO WHILE !EOF()
	   FOR I = 0 TO S17B.F10 - S17B.F09
	       D = VAL(RIGHT(DTOC(S17B.F09),2)) + I
	       SELECT S16
	       SEEK S17B.F03 + PADL(ALLTRIM(STR(D)),2,'0')
	       IF FOUND()
			  DO CASE
				 CASE !EMPTY(S17B.F11) AND !EMPTY(S17B.F12)		&&變更上下班
				      REPLACE S16.F21 WITH S16.F11	&&變更前上班時間
					  REPLACE S16.F22 WITH S16.F12	&&變更前下班時間
		              REPLACE S16.F11 WITH S17B.F11
	                  REPLACE S16.F12 WITH S17B.F12					 
	             CASE !EMPTY(S17B.F11) AND EMPTY(S17B.F12)		&&變更上班
	                  REPLACE S16.F21 WITH S16.F11
	                  REPLACE S16.F11 WITH S17B.F11
	             CASE EMPTY(S17B.F11) AND !EMPTY(S17B.F12)		&&變更下班
	                  REPLACE S16.F22 WITH S16.F12
	                  REPLACE S16.F12 WITH S17B.F12
	          ENDCASE
	       	  REPLACE S16.F20 WITH S17B.F02			&&S17.上下班修改補登作業單號
	       ENDIF
	   ENDFOR
	   SELECT S17B
	   SKIP
	ENDDO
	SELECT S17B
	USE	
	*****S19.加班申請(修改)作業
	IF S00_F65 = '1'	&&加班資料是否依S19加班申請(修改)作業為主(1:是 2:否)
	   SELECT S19.* FROM S19,S16_1 WHERE S16_1.F02 = S19.F03 AND  LEFT(DTOS(CTOD(HK + '/01')),6) = LEFT(DTOS(S19.F09),6) AND S19.F13='Y' ORDER BY S19.F02 INTO CURSOR S19B
	   SELECT S19B
	   GO TOP
	   DO WHILE !EOF()
		  FOR I = 0 TO S19B.F10 - S19B.F09
		      D = VAL(RIGHT(DTOC(S19B.F09),2)) + I
		      SELECT S16
		      SEEK S19B.F03 + PADL(ALLTRIM(STR(D)),2,'0')
		      IF FOUND()
	             DO CASE
	                CASE !EMPTY(S19B.F11) AND !EMPTY(S19B.F12)
	                     REPLACE S16.F27 WITH S16.F13	&&變更前加班上班時間
	                     REPLACE S16.F28 WITH S16.F14	&&變更前加班下班時間
	                     REPLACE S16.F13 WITH S19B.F11
	                     REPLACE S16.F14 WITH S19B.F12
	                CASE !EMPTY(S19B.F11) AND EMPTY(S19B.F12)
	                	 REPLACE S16.F27 WITH S16.F13
	                     REPLACE S16.F13 WITH S19B.F11
	                CASE EMPTY(S19B.F11) AND !EMPTY(S19B.F12)
	                     REPLACE S16.F28 WITH S16.F14
	                   	 REPLACE S16.F14 WITH S19B.F12
	             ENDCASE
		         REPLACE S16.F26 WITH S19B.F02
		         ****修正平常加班與假日加班之加班上班時間
		         IF S16.F18 <> 1 AND S16.F18 <> 7	&&平常日
		         	IF IIF(INDEXSEEK(DTOS(CTOD(HK + '/' + S16.F01)),.T.,'S15','S151'),S15.F03 <> '1',.T.) = .T.	&&平常日且非假日
		         	   IF S16.F13 < S16.F10
	                      REPLACE S16.F13 WITH S16.F10
	             	   ENDIF
		         	ENDIF
		         ENDIF
		         IF S16.F18 = 1 OR S16.F18 = 7		&&假日
		         	IF IIF(INDEXSEEK(DTOS(CTOD(HK + '/' + S16.F01)),.T.,'S15','S151'),S15.F03 = '2',.F.) = .T.	&&假日補班
		         	   IF S16.F13 < S16.F10
	                      REPLACE S16.F13 WITH S16.F10
	             	   ENDIF
		         	ENDIF
		         ENDIF
		      ENDIF
		  ENDFOR
		  SELECT S19B
		  SKIP
	   ENDDO
	   SELECT S19B
	   USE
	ENDIF
	*****整理加班時間
	FOR I = 1 TO DAY_NUM(HK)
		SELECT S16
		SEEK S16_1.F02 + PADL(ALLTRIM(STR(I)),2,'0')
		IF FOUND()
		   IF S00_F65 <> '1'	&&加班資料不依S19加班申請(修改)作業為主
		   	  IF S16.F18 <> 1 AND S16.F18 <> 7		&&平常日
		   	  	 IF IIF(INDEXSEEK(DTOS(CTOD(HK + '/' + S16.F01)),.T.,'S15','S151'),S15.F03 <> '1',.T.) = .T.	&&平常日且非假日
		   	  	 	IF S16.F12 > S16.F10 AND !EMPTY(S16.F12)
		   	  	 	   REPLACE S16.F14 WITH S16.F12	&&加班下班時間
		   	  	 	   REPLACE S16.F13 WITH S16.F10	&&加班上班時間
		   	  	 	   REPLACE S16.F12 WITH S16.F10 &&下班時間
		   	  	 	ENDIF
		   	  	 ENDIF
		   	  ENDIF
			  IF S16.F18 = 1 OR S16.F18 = 7			&&假日
			     IF IIF(INDEXSEEK(DTOS(CTOD(HK + '/' + S16.F01)),.T.,'S15','S151'),S15.F03 = '2',.F.) = .T.		&&假日補班
		   	  	 	IF S16.F12 > S16.F10 AND !EMPTY(S16.F12)
		   	  	 	   REPLACE S16.F14 WITH S16.F12	&&加班下班時間
		   	  	 	   REPLACE S16.F13 WITH S16.F10	&&加班上班時間
		   	  	 	   REPLACE S16.F12 WITH S16.F10 &&下班時間
		   	  	 	ENDIF
			     ENDIF
			  ENDIF
		   ELSE					&&假日有加班上下班時間但S19.加班申請(修改)作業中卻無資料
		   	  IF S16.F18 = 1 OR S16.F18 = 7	OR IIF(INDEXSEEK(DTOS(CTOD(HK + '/' + S16.F01)),.T.,'S15','S151'),S15.F03 = '1',.F.)	&&假日
		   	     IF IIF(INDEXSEEK(DTOS(CTOD(HK + '/' + S16.F01)),.T.,'S15','S151'),S15.F03 <> '2',.T.) = .T.	&&國定假日
		   	     	IF EMPTY(S16.F26)
		   	     	   REPLACE S16.F11 WITH ''
		   	     	   REPLACE S16.F12 WITH ''
		   	     	ENDIF
		   	     ENDIF
		   	  ENDIF
		   ENDIF
		ENDIF
	ENDFOR
	*****S18.請假作業  
	SELECT S18.* FROM S18,S16_1 WHERE S16_1.F02 = S18.F03 AND  LEFT(DTOS(CTOD(HK + '/01')),6) >= LEFT(DTOS(S18.F10),6);
	       AND LEFT(DTOS(CTOD(HK + '/01')),6) <= LEFT(DTOS(S18.F11),6) AND S18.F18 = 'Y' AND LEFT(ALLTRIM(S18.F02),2) = 'SB' ORDER BY S18.F02 INTO CURSOR S18B
	SELECT S18B
	GO TOP
	DO WHILE !EOF()
	   StarDate = S18B.F10	&&請假起始日期
	   DO WHILE LEFT(DTOS(StarDate),6) <> LEFT(DTOS(CTOD(HK + '/01')),6)
		  IF (MONTH(StarDate) + 1) < 13
			 StarDate = CTOD(ALLTRIM(STR(YEAR(StarDate))) + '/' + PADL(ALLTRIM(STR(MONTH(StarDate) + 1)),2,'0') + '/01')
		  ELSE
			 StarDate = CTOD(ALLTRIM(STR(YEAR(StarDate) + 1)) + '/01/01')
		  ENDIF
	   ENDDO
	   IF LEFT(DTOS(S18B.F11),6) <> LEFT(DTOS(CTOD(HK + '/01')),6)
		  EndDate = CTOD(LEFT(DTOC(StarDate),8-INT_012) + ALLTRIM(STR(DAY_NUM(ALLTRIM(LEFT(DTOC(S18B.F11),7-INT_012))))))
	   ELSE
		  EndDate = S18B.F11 &&請假截止日期
	   ENDIF 
	   FOR I = 0 TO DAY(EndDate) - DAY(StarDate)
		   SELECT S16
		   SEEK S18B.F03 + PADL(ALLTRIM(STR(I + DAY(StarDate))),2,'0')
		   IF FOUND()
			  REPLACE S16.F15 WITH 0
			  REPLACE S16.F16 WITH 0
			  REPLACE S16.F23 WITH S18B.F02
			  REPLACE S16.F24 WITH IIF(DAY(StarDate) = (I + DAY(StarDate)),S18B.F12,ALLTRIM(IIF(INDEXSEEK(S18B.F03,.T.,'S05','S051'),IIF(INDEXSEEK('I' + S05.F29,.T.,'S00','S005'),S00.F50,''),'')))
			  REPLACE S16.F25 WITH IIF((I + DAY(StarDate)) = DAY(EndDate),S18B.F13,ALLTRIM(IIF(INDEXSEEK(S18B.F03,.T.,'S05','S051'),IIF(INDEXSEEK('I' + S05.F29,.T.,'S00','S005'),S00.F51,''),'')))
			  REPLACE S16.F29 WITH S16.F11		&&請假前之上班時間
			  REPLACE S16.F30 WITH S16.F12		&&請假前之下班時間
	          *****調整上下班時間
	          DO CASE
	             CASE S16.F24 = S16.F06 AND S16.F25 = S16.F07	&&請整天
	                  REPLACE S16.F11 WITH ''
	                  REPLACE S16.F12 WITH ''
	             CASE S16.F24 <> S16.F06 AND S16.F25 = S16.F07
	                  REPLACE S16.F12 WITH S16.F24
	             CASE S16.F24 = S16.F06 AND S16.F25 <> S16.F07
	                  REPLACE S16.F11 WITH S16.F25
	          ENDCASE
			  S00_F52 = ALLTRIM(IIF(INDEXSEEK(S16.F02,.T.,'S05','S051'),IIF(INDEXSEEK('I' + S05.F29,.T.,'S00','S005'),S00.F52,''),''))	&&班別:休息時段起
			  S00_F53 = ALLTRIM(IIF(INDEXSEEK(S16.F02,.T.,'S05','S051'),IIF(INDEXSEEK('I' + S05.F29,.T.,'S00','S005'),S00.F53,''),''))	&&班別:休息時段止
	          IF !EMPTY(S16.F11) AND !EMPTY(S16.F12) AND !EMPTY(S00_F52) AND !EMPTY(S00_F53)
	             IF BETWEEN(S16.F11,S00_F52,S00_F53) AND S16.F12 > S00_F53
	                REPLACE S16.F11 WITH S00_F53
	             ENDIF
	             IF BETWEEN(S16.F12,S00_F52,S00_F53) AND S16.F11 < S00_F52
	                REPLACE S16.F12 WITH S00_F52
	             ENDIF
	          ENDIF
	          *****整理非假日補班之請假
			  IF S16.F18 = 1 OR S16.F18 = 7			&&假日
			     IF IIF(INDEXSEEK(DTOS(CTOD(HK + '/' + S16.F01)),.T.,'S15','S151'),S15.F03 <> '2',.T.) = .T.		&&假日補班
		   	  	 	IF !EMPTY(S16.F23)
		   	  	 	   REPLACE S16.F23 WITH ''
		   	  	 	   REPLACE S16.F24 WITH ''
		   	  	 	   REPLACE S16.F25 WITH ''
		   	  	 	ENDIF
			     ENDIF
			  ENDIF
	       ENDIF
	   ENDFOR
	   SELECT S18B
	   SKIP
	ENDDO
	SELECT S18B
	USE
	*****計算遲到、早退、加班時數
	FOR I = 1 TO DAY_NUM(HK)
		SELECT S16
		SEEK S16_1.F02 + PADL(ALLTRIM(STR(I)),2,'0')
		IF FOUND()
		   S00_F52 = ALLTRIM(IIF(INDEXSEEK(S16.F02,.T.,'S05','S051'),IIF(INDEXSEEK('I' + S05.F29,.T.,'S00','S005'),S00.F52,''),''))	&&班別:休息時段起
		   S00_F53 = ALLTRIM(IIF(INDEXSEEK(S16.F02,.T.,'S05','S051'),IIF(INDEXSEEK('I' + S05.F29,.T.,'S00','S005'),S00.F53,''),''))	&&班別:休息時段止
		   S00_F52_H = VAL(LEFT(ALLTRIM(S00_F52),2))		&&班別:休息時段起(時)
		   S00_F52_M = VAL(RIGHT(ALLTRIM(S00_F52),2))		&&班別:休息時段起(分)
		   S00_F53_H = VAL(LEFT(ALLTRIM(S00_F53),2))		&&班別:休息時段止(時)
		   S00_F53_M = VAL(RIGHT(ALLTRIM(S00_F53),2))		&&班別:休息時段止(分)
		   S16_F07_H = VAL(LEFT(ALLTRIM(S16.F07),2))		&&班別:下班時段(時)
		   S16_F07_M = VAL(RIGHT(ALLTRIM(S16.F07),2))   	&&班別:下班時段(分)
		   S16_F08_H = VAL(LEFT(ALLTRIM(S16.F08),2))		&&班別:上班遲到緩衝時間(時)
		   S16_F08_M = VAL(RIGHT(ALLTRIM(S16.F08),2))   	&&班別:上班遲到緩衝時間(分)
		   S16_F09_H = VAL(LEFT(ALLTRIM(S16.F09),2))		&&班別:下班早退緩衝時間(時)
		   S16_F09_M = VAL(RIGHT(ALLTRIM(S16.F09),2))   	&&班別:下班早退緩衝時間(分)
		   S16_F10_H = VAL(LEFT(ALLTRIM(S16.F10),2))		&&班別:加班上班緩衝時間(時)
		   S16_F10_M = VAL(RIGHT(ALLTRIM(S16.F10),2))   	&&班別:加班上班緩衝時間(分)
		   S16_F11_H = VAL(LEFT(ALLTRIM(S16.F11),2))		&&上班時間(時)
		   S16_F11_M = VAL(RIGHT(ALLTRIM(S16.F11),2))		&&上班時間(分)
		   S16_F12_H = VAL(LEFT(ALLTRIM(S16.F12),2))		&&下班時間(時)
		   S16_F12_M = VAL(RIGHT(ALLTRIM(S16.F12),2))		&&下班時間(分)
		   S16_F13_H = VAL(LEFT(ALLTRIM(S16.F13),2))		&&加班上班時間(時)
		   S16_F13_M = VAL(RIGHT(ALLTRIM(S16.F13),2))		&&加班上班時間(分)
		   S16_F14_H = VAL(LEFT(ALLTRIM(S16.F14),2)) + IIF(LEFT(ALLTRIM(S16.F14),2) = '00',24,0)	&&加班下班時間(時)
		   S16_F14_M = VAL(RIGHT(ALLTRIM(S16.F14),2))		&&加班下班時間(分)	
		   *****計算遲到分鐘數
		   IF S16.F11 >= S16.F08 AND !EMPTY(S16.F11) AND !EMPTY(S16.F08)
		      DO CASE
		         CASE S16_F11_M >= S16_F08_M
		              REPLACE S16.F15 WITH ((S16_F11_H - S16_F08_H) * 60) + (S16_F11_M - S16_F08_M)
		         CASE S16_F12_M < S16_F08_M
		              REPLACE S16.F15 WITH ((S16_F11_H - S16_F08_H) * 60) - (S16_F08_M - S16_F11_M)
		      ENDCASE
		   ENDIF
		   **判斷是否有請假
		   IF !EMPTY(S16.F23) AND S16.F11 >= S16.F25 AND !EMPTY(S16.F11)
		   	   REPLACE S16.F15 WITH 0
		   ENDIF
		   **無上班時間則遲到為零
		   IF EMPTY(S16.F11)
		     REPLACE S16.F15 WITH 0
		   ENDIF		   
		   *****計算早退分鐘數
		   IF S16.F12 <= S16.F09 AND !EMPTY(S16.F12) AND !EMPTY(S16.F09)
		      DO CASE
		         CASE S16_F12_M <= S16_F09_M
		              REPLACE S16.F16 WITH ((S16_F09_H - S16_F12_H) * 60) + (S16_F09_M - S16_F12_M)
		         CASE S16_F12_M > S16_F09_M
		              REPLACE S16.F16 WITH ((S16_F09_H - S16_F12_H) * 60) - (S16_F12_M - S16_F09_M)
		      ENDCASE
		   ENDIF
		   **判斷是否有請假
		   IF !EMPTY(S16.F23) AND S16.F12 <= S16.F25 AND !EMPTY(S16.F12)
		   	  REPLACE S16.F16 WITH 0
		   ENDIF
		   **無下班時間則早退為零
		   IF EMPTY(S16.F12)
		     REPLACE S16.F16 WITH 0
		   ENDIF			   
		   *****計算加班小時數
		   S16_F171=0
		   IF S16.F13 < S16.F14
		      IF S16.F18 = 7 OR S16.F18 = 1 OR IIF(INDEXSEEK(DTOS(CTOD(HK + '/' + S16.F01)),.F.,'S15','S151'),S15.F03 = '1',.F.)	&&假日加班
		         IF S16.F14 <= S16.F10
		   			DO CASE
		           	   CASE S16_F13_M <= S16_F14_H
		                    S16_F171 = ((S16_F14_H - S16_F13_H) * 60) + (S16_F14_M - S16_F13_M)
		           	   CASE S16_F13_M > S16_F14_H
		                    S16_F171 = ((S16_F14_H - S16_F13_H) * 60) - (S16_F13_M - S16_F14_M)
		            ENDCASE
		         ELSE
		   			DO CASE 
		           	   CASE S16_F13_M <= S16_F07_H
		                    S16_F171 = ((S16_F07_H - S16_F13_H) * 60) + (S16_F07_M - S16_F13_M)
		           	   CASE S16_F13_M > S16_F07_H
		                    S16_F171 = ((S16_F07_H - S16_F13_H) * 60) - (S16_F13_M - S16_F07_M)
		            ENDCASE
			        DO CASE
			           CASE S16_F10_M <= S16_F14_H
			                S16_F171 = S16_F171 + ((S16_F14_H - S16_F10_H) * 60) + (S16_F14_M - S16_F10_M)
			           CASE S16_F10_M > S16_F14_H
			                S16_F171 = S16_F171 + ((S16_F14_H - S16_F10_H) * 60) - (S16_F10_M - S16_F14_M)
			        ENDCASE
		         ENDIF
		         IF S16.F13 < S00_F52 AND S16.F14 > S00_F53
		            S16_F171 = S16_F171 - ((S00_F53_H - S00_F52_H) * 60) + (S00_F53_M - S00_F52_M)
		         ENDIF
		      ELSE		&&一般上班之加班
		         DO CASE
		            CASE S16.F13 >= S16.F10
		                 DO CASE 
		                    CASE S16_F13_M <= S16_F14_H
		                         S16_F171 = ((S16_F14_H - S16_F13_H) * 60) + (S16_F14_M - S16_F13_M)
		                    CASE S16_F13_M > S16_F14_H
		                       	 S16_F171 = ((S16_F14_H - S16_F13_H) * 60) - (S16_F13_M - S16_F14_M)
		                 ENDCASE
		            CASE S16.F13 < S16.F10
		                 DO CASE
		                    CASE S16_F10_M <= S16_F14_H
		                         S16_F171 = ((S16_F14_H - S16_F10_H) * 60) + (S16_F14_M - S16_F10_M)
		                    CASE S16_F10_M > S16_F14_H
		                       	 S16_F171 = ((S16_F14_H - S16_F10_H) * 60) - (S16_F10_M - S16_F14_M)
		                 ENDCASE
		        ENDCASE
		      ENDIF
		      *****判斷加班計算範圍
			  IF MOD(S16_F171,60) = 0
				 REPLACE S16.F17 WITH ROUND(S16_F171 / 60,1)
			  ELSE
				 DO CASE
			        CASE S00_F63 <> 'F' AND S00_F64 <> 'F'
			           	 IF MOD(S16_F171,60) >= VAL(S00_F63) AND MOD(S16_F171,60) < VAL(S00_F64)
			                REPLACE S16.F17 WITH INT(S16_F171 / 60) + 0.5
			             ELSE
			                IF MOD(S16_F171,60) >= VAL(S00_F64) AND MOD(S16_F171,60) < 60
			             	   REPLACE S16.F17 WITH INT(S16_F171 / 60) + 1
			                ELSE
			             	   REPLACE S16.F17 WITH INT(S16_F171 / 60)
			                ENDIF
			             ENDIF
			        CASE S00_F63 <> 'F' AND S00_F64 = 'F'
			             IF MOD(S16_F171,60) >= VAL(S00_F63) AND MOD(S16_F171,60) < 60
			                REPLACE S16.F17 WITH INT(S16_F171 / 60) + 0.5
			             ELSE
			                REPLACE S16.F17 WITH INT(S16_F171 / 60)
			             ENDIF
			        CASE S00_F63 = 'F' AND S00_F64 <> 'F'
			             IF MOD(S16_F171,60) >= VAL(S00_F64) AND MOD(S16_F171,60) < 60
			                REPLACE S16.F17 WITH INT(S16_F171 / 60) + 1
			             ELSE
			                REPLACE S16.F17 WITH INT(S16_F171 / 60)
			             ENDIF
			        CASE S00_F63 = 'F' AND S00_F64 = 'F'
			             REPLACE S16.F17 WITH ROUND(S16_F171 / 60,1)
			     ENDCASE
		      ENDIF
		   ENDIF
		   ***判斷加班小時數是否為零
		   IF S16.F17 = 0
		      REPLACE S16.F13 WITH ''
		      REPLACE S16.F14 WITH ''
		   ENDIF
		   ***無加班上下班時間加班小時數也為零
		   IF EMPTY(S16.F13) AND EMPTY(S16.F14)
		      REPLACE S16.F17 WITH 0
		   ENDIF		   
		   ***遲到、早退、加班之總計
		   REPLACE S16_1.SUM_SUM_F15 WITH S16_1.SUM_SUM_F15 + S16.F15
		   REPLACE S16_1.SUM_SUM_F16 WITH S16_1.SUM_SUM_F16 + S16.F16
	       IF S16.F18 <> 1 AND S16.F18 <> 7 AND IIF(INDEXSEEK(DTOS(CTOD(HK + '/' + S16.F01)),.T.,'S15','S151'),S15.F03 <> '1',.T.)
              SELECT S16_1
              REPLACE S16_1.SUM_SUM_F171 WITH S16_1.SUM_SUM_F171 + S16.F17
           ELSE
              SELECT S16_1
              REPLACE S16_1.SUM_SUM_F172 WITH S16_1.SUM_SUM_F172 + S16.F17
           ENDIF
		ENDIF
	ENDFOR
    UNLOCK ALL
    THISFORM.GRID1.ENABLED=.T.
    THISFORM.GRID1.SETFOCUS
    THISFORM.SHRGROUP.ABANDON_BOTT.CLICK
  ENDPROC  
***********
  PROCEDURE ORPGROUP.EDIT_BOTT.CLICK
     THISFORM.GRID1.ENABLED=.F.
     THISFORM.GRID2.ENABLED=.F.
     THISFORM.KEY_LIST.ENABLED=.F.
     THISFORM.MTH_LIST.ENABLED=.F.
     THISFORM.ANS_BOTT.ENABLED=.F.
     THISFORM.INOUT_BOTT.ENABLED=.F.
     THISFORM.OUT_BOTT.ENABLED=.F.
     THISFORM.WASTE_BOTT.ENABLED=.F.
     THISFORM.LEAVE_BOTT.ENABLED=.F.
     THISFORM.PAGEFRAME1.PAGE1.ENABLED=.F.
     THISFORM.PAGEFRAME1.PAGE2.TXTF01.READONLY=.T.
     THISFORM.PAGEFRAME1.PAGE2.TXTF11.READONLY=IIF(S16.F18<>1 AND S16.F18<>7 AND IIF(INDEXSEEK(DTOS(CTOD(HK+'/'+S16.F01)),.F.,'S15','S151'),S15.F03<>'1',.T.),.F.,.T.)
     THISFORM.PAGEFRAME1.PAGE2.TXTF12.READONLY=IIF(S16.F18<>1 AND S16.F18<>7 AND IIF(INDEXSEEK(DTOS(CTOD(HK+'/'+S16.F01)),.F.,'S15','S151'),S15.F03<>'1',.T.),.F.,.T.)
     THISFORM.PAGEFRAME1.PAGE2.TXTF13.READONLY=.F.
     THISFORM.PAGEFRAME1.PAGE2.TXTF14.READONLY=.F.
     THISFORM.PAGEFRAME1.PAGE2.TXTF18.VISIBLE=.F.
     THISFORM.PAGEFRAME1.PAGE2.LBLF991.CAPTION=''
     IF S16.F18<>1 AND S16.F18<>7 AND IIF(INDEXSEEK(DTOS(CTOD(HK+'/'+S16.F01)),.F.,'S15','S151'),S15.F03<>'1',.T.)
         THISFORM.PAGEFRAME1.PAGE2.TXTF11.SETFOCUS
     ELSE
         THISFORM.PAGEFRAME1.PAGE2.TXTF13.SETFOCUS
     ENDIF
     SELECT S16
     LOCK()
     IF !RLOCK()
        DO FILE_IMPACT
        RETURN
     ENDIF
 ENDPROC
**************
PROCEDURE SHRGROUP.SHURE2_BOTT.CLICK   &&修改確認        
      IF S16.F18<>1 AND S16.F18<>7 AND IIF(INDEXSEEK(DTOS(CTOD(HK+'/'+S16.F01)),.F.,'S15','S151'),S15.F03<>'1',.T.)
          IF EMPTY(ALLTRIM(LEFT(THISFORM.PAGEFRAME1.PAGE2.TXTF11.VALUE,2))) AND EMPTY(ALLTRIM(RIGHT(THISFORM.PAGEFRAME1.PAGE2.TXTF11.VALUE,2)))
              =MESSAGEBOX('上班時間不得空白!',0+64,'提示視窗')
              THISFORM.PAGEFRAME1.PAGE2.TXTF11.SETFOCUS
              RETURN
          ENDIF           
          IF LEN(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF11.VALUE))<>5 OR ;
              LEN(ALLTRIM(LEFT(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF11.VALUE),2)))=1 OR;
              LEN(ALLTRIM(RIGHT(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF11.VALUE),2)))=1 OR;
              VAL(LEFT(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF11.VALUE),2))>23 OR;
              VAL(RIGHT(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF11.VALUE),2))>59
              =MESSAGEBOX('上班時間格式不正確!',0+64,'提示視窗')
              THISFORM.PAGEFRAME1.PAGE2.TXTF11.SETFOCUS
              RETURN  
          ENDIF              
          IF EMPTY(ALLTRIM(LEFT(THISFORM.PAGEFRAME1.PAGE2.TXTF12.VALUE,2))) AND EMPTY(ALLTRIM(RIGHT(THISFORM.PAGEFRAME1.PAGE2.TXTF12.VALUE,2)))
              =MESSAGEBOX('下班時間不得空白!',0+64,'提示視窗')
              THISFORM.PAGEFRAME1.PAGE2.TXTF12.SETFOCUS
              RETURN
          ENDIF       
          IF LEN(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF12.VALUE))<>5 OR ;
              LEN(ALLTRIM(LEFT(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF12.VALUE),2)))=1 OR;
              LEN(ALLTRIM(RIGHT(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF12.VALUE),2)))=1 OR;
              VAL(LEFT(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF12.VALUE),2))>23 OR;
              VAL(RIGHT(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF12.VALUE),2))>59
              =MESSAGEBOX('下班時間格式不正確!',0+64,'提示視窗')
              THISFORM.PAGEFRAME1.PAGE2.TXTF12.SETFOCUS
              RETURN
          ENDIF      
      ENDIF      
      ***
      IF LEN(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF13.VALUE))>1
	  IF LEN(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF13.VALUE))<>5 OR ;
	      LEN(ALLTRIM(LEFT(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF13.VALUE),2)))=1 OR;
	      LEN(ALLTRIM(RIGHT(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF13.VALUE),2)))=1 OR;
	      VAL(LEFT(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF13.VALUE),2))>23 OR;
	      VAL(RIGHT(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF13.VALUE),2))>59
	      =MESSAGEBOX('加班上班時間格式不正確!',0+64,'提示視窗')
	      THISFORM.PAGEFRAME1.PAGE2.TXTF13.SETFOCUS
	      RETURN  
	  ENDIF  
          IF EMPTY(ALLTRIM(LEFT(THISFORM.PAGEFRAME1.PAGE2.TXTF14.VALUE,2))) AND EMPTY(ALLTRIM(RIGHT(THISFORM.PAGEFRAME1.PAGE2.TXTF14.VALUE,2)))
              =MESSAGEBOX('加班上班時間已有資料故加班下班時間不得空白!',0+64,'提示視窗')
              THISFORM.PAGEFRAME1.PAGE2.TXTF14.SETFOCUS
              RETURN
          ENDIF  	  
	  IF LEN(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF14.VALUE))<>5 OR ;
	      LEN(ALLTRIM(LEFT(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF14.VALUE),2)))=1 OR;
	      LEN(ALLTRIM(RIGHT(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF14.VALUE),2)))=1 OR;
	      VAL(LEFT(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF14.VALUE),2))>23 OR;
	      VAL(RIGHT(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF14.VALUE),2))>59
	      =MESSAGEBOX('加班下班時間格式不正確!',0+64,'提示視窗')
	      THISFORM.PAGEFRAME1.PAGE2.TXTF14.SETFOCUS
	      RETURN  
	  ENDIF  
          IF ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF13.VALUE)=ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF14.VALUE)
	      =MESSAGEBOX('加班上下班時間不可相同!',0+64,'提示視窗')
	      THISFORM.PAGEFRAME1.PAGE2.TXTF13.SETFOCUS
	      RETURN  	           
          ENDIF	  
	  IF ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF13.VALUE)>ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF14.VALUE);
	      AND (ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF14.VALUE)<'00:01' OR ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF14.VALUE)<'24:01')
	      =MESSAGEBOX('加班上班時間不可大於加班下班時間!',0+64,'提示視窗')
	      THISFORM.PAGEFRAME1.PAGE2.TXTF13.SETFOCUS
	      RETURN  	      
	  ENDIF
      ENDIF
      ***
      IF LEN(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF14.VALUE))>1
          IF EMPTY(ALLTRIM(LEFT(THISFORM.PAGEFRAME1.PAGE2.TXTF13.VALUE,2))) AND EMPTY(ALLTRIM(RIGHT(THISFORM.PAGEFRAME1.PAGE2.TXTF13.VALUE,2)))
              =MESSAGEBOX('加班下班時間已有資料故加班上班時間不得空白!',0+64,'提示視窗')
              THISFORM.PAGEFRAME1.PAGE2.TXTF13.SETFOCUS
              RETURN
          ENDIF  	 	  	  
	  IF LEN(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF13.VALUE))<>5 OR ;
	      LEN(ALLTRIM(LEFT(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF13.VALUE),2)))=1 OR;
	      LEN(ALLTRIM(RIGHT(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF13.VALUE),2)))=1 OR;
	      VAL(LEFT(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF13.VALUE),2))>23 OR;
	      VAL(RIGHT(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF13.VALUE),2))>59
	      =MESSAGEBOX('加班上班時間格式不正確!',0+64,'提示視窗')
	      THISFORM.PAGEFRAME1.PAGE2.TXTF13.SETFOCUS
	      RETURN  
	  ENDIF  
	  IF LEN(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF14.VALUE))<>5 OR ;
	      LEN(ALLTRIM(LEFT(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF14.VALUE),2)))=1 OR;
	      LEN(ALLTRIM(RIGHT(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF14.VALUE),2)))=1 OR;
	      VAL(LEFT(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF14.VALUE),2))>23 OR;
	      VAL(RIGHT(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF14.VALUE),2))>59
	      =MESSAGEBOX('加班下班時間格式不正確!',0+64,'提示視窗')
	      THISFORM.PAGEFRAME1.PAGE2.TXTF14.SETFOCUS
	      RETURN     
	  ENDIF 
          IF ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF13.VALUE)=ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF14.VALUE)
	      =MESSAGEBOX('加班上下班時間不可相同!',0+64,'提示視窗')
	      THISFORM.PAGEFRAME1.PAGE2.TXTF14.SETFOCUS
	      RETURN  	           
          ENDIF	  
	  IF ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF13.VALUE)>ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF14.VALUE);
	      AND (ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF14.VALUE)<'00:01' OR ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF14.VALUE)<'24:01')
	      =MESSAGEBOX('加班下班時間不可小於加班上班時間!',0+64,'提示視窗')
	      THISFORM.PAGEFRAME1.PAGE2.TXTF14.SETFOCUS
	      RETURN  	      
	  ENDIF	   	           
      ENDIF          
      ***	    
      SELECT S16
      IF RLOCK()
	  IF  S16.F18<>1 AND S16.F18<>7 AND IIF(INDEXSEEK(DTOS(CTOD(HK+'/'+S16.F01)),.T.,'S15','S151'),S15.F03<>'1',.T.)
	       SELECT S16_1
	       REPLACE S16_1.SUM_SUM_F171 WITH S16_1.SUM_SUM_F171-S16.F17	
	  ELSE
	       SELECT S16_1
	       REPLACE S16_1.SUM_SUM_F172 WITH S16_1.SUM_SUM_F172-S16.F17	
	  ENDIF          
	  REPLACE S16_1.SUM_SUM_F15 WITH S16_1.SUM_SUM_F15-S16.F15	
	  REPLACE S16_1.SUM_SUM_F16 WITH S16_1.SUM_SUM_F16-S16.F16		      
	  SELECT S16
	  REPLACE F11 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF11.VALUE
	  REPLACE F12 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF12.VALUE
	  REPLACE F13 WITH IIF(LEN(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF13.VALUE))>1,THISFORM.PAGEFRAME1.PAGE2.TXTF13.VALUE,'')
	  REPLACE F14 WITH IIF(LEN(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF14.VALUE))>1,THISFORM.PAGEFRAME1.PAGE2.TXTF14.VALUE,'')
	  REPLACE F15 WITH VAL(THISFORM.PAGEFRAME1.PAGE2.LBLF151.CAPTION)
	  REPLACE F16 WITH VAL(THISFORM.PAGEFRAME1.PAGE2.LBLF161.CAPTION)
	  REPLACE F17 WITH VAL(THISFORM.PAGEFRAME1.PAGE2.LBLF171.CAPTION)
	  REPLACE F99 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')  
	  IF  S16.F18<>1 AND S16.F18<>7 AND IIF(INDEXSEEK(DTOS(CTOD(HK+'/'+S16.F01)),.T.,'S15','S151'),S15.F03<>'1',.T.)
	       SELECT S16_1
	       REPLACE S16_1.SUM_SUM_F171 WITH S16_1.SUM_SUM_F171+S16.F17	
	  ELSE
	       SELECT S16_1
	       REPLACE S16_1.SUM_SUM_F172 WITH S16_1.SUM_SUM_F172+S16.F17	
	  ENDIF          
	  REPLACE S16_1.SUM_SUM_F15 WITH S16_1.SUM_SUM_F15+S16.F15	
	  REPLACE S16_1.SUM_SUM_F16 WITH S16_1.SUM_SUM_F16+S16.F16	
	  SELECT S16_WORK  
	  SEEK  S16.F02+RIGHT(ALLTRIM(HK),2)+'/'+S16.F01
	  IF FOUND()
	      SELECT S16_WORK
	      DELETE 
	  ENDIF
    ELSE
      DO FILE_IMPACT
      RETURN   
    ENDIF  
    UNLOCK ALL
    SELECT S16
    THISFORM.GRID2.SETFOCUS		      		          	    	              
    THISFORM.SHRGROUP.ABANDON_BOTT.CLICK    
ENDPROC   
*************
PROC ORPGROUP.DEL_BOTT.CLICK                    &&刪除資料程序
  IF  MESSAGEBOX('是否確定要刪除此筆資料',4+32+256,'請確認')=6 
      SELECT S16_1
      LOCK()
      IF RLOCK()
 	     IF S16_1.F19='Y'
 	   	    =MESSAGEBOX('此資料已確認,無法刪除!',0+64,'提示訊息視窗')
 	     ELSE
 	        DELETE FROM S16 WHERE ALLTRIM(S16.F02)=ALLTRIM(THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE) 
 	        SELECT S16_1
     	    DELETE 
     	    UNLOCK
     	    SKIP -1
     	    IF BOF()
     	       GO TOP
     	    ENDIF  
 	     ENDIF
      ELSE
         DO FILE_IMPACT
      ENDIF
      THISFORM.GRID1.SETFOCUS 	
      THISFORM.PAGEFRAME1.PAGE1.ACTIVATE
  ENDIF       	           
*!*	  THISFORM.REFRESH	       
ENDPROC  
****************
  PROCEDURE SHRGROUP.ABANDON_BOTT.CLICK 
      THISFORM.SHRGROUP.ENABLED=.F.
      THISFORM.SHRGROUP.VISIBLE=.F.      
      THISFORM.ORPGROUP.ENABLED=.T.
      THISFORM.ORPGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
      THISFORM.CMDGROUP.ENABLED=.T.
      THISFORM.CMDGROUP.SETALL('ENABLED',.T.,'COMMANDBUTTON')
      THISFORM.CMDGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
      THISFORM.SETALL('READONLY',.T.,'TEXTBOX')  
      THISFORM.SETALL('VISIBLE',.T.,'TEXTBOX')
      THISFORM.PAGEFRAME1.PAGE1.ENABLED=.T.      
      THISFORM.PAGEFRAME1.PAGE2.ENABLED=.T.    
      THISFORM.PAGEFRAME1.PAGE1.TXTF02.VISIBLE=.T.           
      THISFORM.COMBOBOX02.VISIBLE=.F.
      THISFORM.PAGEFRAME1.PAGE2.TXTF11.READONLY=.T. 
      THISFORM.PAGEFRAME1.PAGE2.TXTF12.READONLY=.T. 
      THISFORM.PAGEFRAME1.PAGE2.TXTF13.READONLY=.T. 
      THISFORM.PAGEFRAME1.PAGE2.TXTF14.READONLY=.T. 
      THISFORM.PAGEFRAME1.PAGE2.TXTF18.VISIBLE=.F.          
      THISFORM.GRID1.ENABLED=.T.   
      THISFORM.GRID2.ENABLED=.T.   
      IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
          THISFORM.PAGEFRAME1.PAGE1.ACTIVATE
          THISFORM.KEY_LIST.ENABLED=.T.  	
	  THISFORM.MTH_LIST.ENABLED=.T. 
          THISFORM.ANS_BOTT.VISIBLE=.T.  
          THISFORM.INOUT_BOTT.VISIBLE=.T.  
          THISFORM.OUT_BOTT.VISIBLE=.T. 
          THISFORM.WASTE_BOTT.VISIBLE=.F. 
          THISFORM.LEAVE_BOTT.VISIBLE=.F. 
          THISFORM.GRID1.SETFOCUS       
      ELSE 
          THISFORM.PAGEFRAME1.PAGE2.ACTIVATE
          THISFORM.KEY_LIST.ENABLED=.F.  	
	  THISFORM.MTH_LIST.ENABLED=.F.           
          THISFORM.ANS_BOTT.VISIBLE=.F.   
          THISFORM.INOUT_BOTT.VISIBLE=.F.  
          THISFORM.OUT_BOTT.VISIBLE=.F. 
          THISFORM.WASTE_BOTT.VISIBLE=.T. 
          THISFORM.LEAVE_BOTT.VISIBLE=.T. 
          THISFORM.GRID2.SETFOCUS 
      ENDIF
*!*	      THISFORM.REFRESH   
      UNLOCK ALL          
  ENDPROC
**********  
  PROCEDURE SHRGROUP.FINISH_BOTT.CLICK
      SELECT S16_1
      DO CASE 
            CASE THISFORM.KEY_LIST.DISPLAYVALUE='依員工編號排列'
                       SET ORDER TO S16_11
            CASE THISFORM.KEY_LIST.DISPLAYVALUE='依員工姓名排列'
                       SET ORDER TO S16_12
      ENDCASE   
      THISFORM.SHRGROUP.ABANDON_BOTT.CLICK
 ENDPROC   
 ****************人員編號	IIF(A02.F10<>'*',S05.F27=.T.,.T.)
PROCEDURE COMBOBOX02.CLICK
   THISFORM.COMBOBOX02.CLEAR
    SELECT S05.F01,S05.F02,S05.F10,S05.F28 FROM S05 WHERE IIF(A02.F10<>'*',ALLTRIM(F02)=IIF(SEEK(sys_oper,'A01'),ALLTRIM(A01.F03),''),.T.) ORDER BY S05.F01 INTO CURSOR S05_TEMP READWRITE
    INDE ON F01 TAG S05_TEMP1
    SET ORDER TO S05_TEMP1
    SELECT S16.F02 FROM S16 ORDER BY S16.F02 GROUP BY S16.F02 INTO CURSOR S16_TEMP
    SELECT S16_TEMP
    GO TOP
    DO WHILE !EOF()
           SELECT S05_TEMP
           SEEK S16_TEMP.F02
           IF FOUND()
                DELETE 
           ENDIF
           SELECT S16_TEMP
           SKIP
    ENDDO
    SELECT S05_TEMP
    GO TOP
    THIS.ADDITEM('')      
    DO WHILE  !EOF()
           DO CASE 
                 CASE EMPTY(F10) OR  F28='A' OR F28='B' OR F28='C' OR F28='2' OR F28='4' OR F28='9'
                           THIS.ADDITEM(ALLTRIM(S05_TEMP.F01)+SPACE(5)+ALLTRIM(S05_TEMP.F02))
                 CASE F28='1' OR F28='3' OR F28='7' OR F28='8' AND LEFT(DTOS(F10),6)=LEFT(DTOS(CTOD(HK+'/01')),6)
                           THIS.ADDITEM(ALLTRIM(S05_TEMP.F01)+SPACE(5)+ALLTRIM(S05_TEMP.F02))       
           ENDCASE      
      	   SELECT  S05_TEMP
      	   SKIP
    ENDDO
    SELECT S16_TEMP
    USE
    SELECT S05_TEMP
    USE        
  ENDPROC  
********
 PROC WASTE_BOTT.CLICK     &&曠職作業
    SELECT S16
    LOCK()
    IF S16.F31='1'
        IF  MESSAGEBOX('您是否要將'+HK+'/'+S16.F01+'反曠職!',4+32+256,'請確認')=6
             REPLACE S16_1.SUM_SUM_F18 WITH IIF(S16_1.SUM_SUM_F18=0,0,S16_1.SUM_SUM_F18-1)
             REPLACE S16.F31 WITH ''
*!*	             =MESSAGEBOX('反曠職設定已成功!',0+64,'提示訊息視窗')
        ENDIF        
    ELSE
        IF  MESSAGEBOX('您是否要將'+HK+'/'+S16.F01+'設定為曠職!',4+32+256,'請確認')=6
             REPLACE S16_1.SUM_SUM_F18 WITH S16_1.SUM_SUM_F18+1
             REPLACE S16.F31 WITH '1'
*!*	             =MESSAGEBOX('曠職設定已成功!',0+64,'提示訊息視窗')
        ENDIF
    ENDIF
    UNLOCK
    THISFORM.GRID2.SETFOCUS     
 ENDPROC         
********
 PROCEDURE LEAVE_BOTT.CLICK     &&離職作業
    SELECT S16
    LOCK()
    IF S16.F31='2'
       IF MESSAGEBOX('您是否要將'+HK+'/'+S16.F01+'反離職!',4+32+256,'請確認')=6
          REPLACE S16.F31 WITH ''
*!*	          =MESSAGEBOX('反離職設定已成功!',0+64,'提示訊息視窗')
       ENDIF        
    ELSE
       IF MESSAGEBOX('您是否要將'+HK+'/'+S16.F01+'設定為離職!',4+32+256,'請確認')=6
          REPLACE S16.F31 WITH '2'
*!*	          =MESSAGEBOX('離職設定已成功!',0+64,'提示訊息視窗')
       ENDIF
    ENDIF
    UNLOCK
    THISFORM.GRID2.SETFOCUS     
 ENDPROC     
***************
 PROCEDURE ANS_BOTT.CLICK     &&確認 AND 反確認 作業     
 IF S16_1.F19 <> 'Y'
    IF MESSAGEBOX('您是否要確認此筆資料!',4+32+256,'請確認')=6
       IF S16_1.F19 <> 'Y'
          S10 = 'S10' + LEFT(DTOS(CTOD(HK + '/01')),6)
	      S101 = 'S101' + LEFT(DTOS(CTOD(HK + '/01')),6)
	      IF !USED('&S10')
	         SELECT 0
	         USE (S10) ALIA S10
	      ELSE
	         SELECT S10
	      ENDIF
	      SELECT S10
	      SET ORDER TO S101
	      SEEK S16_1.F02
	      IF FOUND()
	         IF S10.F98 = 'Y'
	            =MESSAGEBOX('此人員已在'+HK+'之S10.薪資計算作業中已確認,故無法執行確認!',0+64,'提示視窗')
		        SELECT S10
		        USE
		        THISFORM.GRID1.SETFOCUS
		        RETURN	
	         ELSE
		        =MESSAGEBOX('此人員已在'+HK+'之S10.薪資計算作業中已有資料,故不得執行確認,請至S10刪除基本考勤資料後才可確認!',0+64,'提示視窗')
		        SELECT S10
		        USE
		        THISFORM.GRID1.SETFOCUS
		        RETURN		             
	         ENDIF
	      ENDIF
	      SELECT S10
	      USE
	      ****
	      SELECT S16.F01 FROM S16 WHERE S16.F02 = S16_1.F02 ORDER BY S16.F02 INTO CURSOR S16_TEMP
	      IF RECCOUNT('S16_TEMP') <> DAY_NUM(HK)
	         =MESSAGEBOX('此人員之出勤天數不正確,請查明後在確認',0+64,'提示訊息視窗') 
             SELECT S16_TEMP
             USE
             THISFORM.GRID1.SETFOCUS  
             RETURN
	      ENDIF
	      SELECT S16_TEMP
	      USE
          SELECT * FROM S16 WHERE S16.F02 = S16_1.F02 AND S16.F18 <> 1 AND S16.F18 <> 7 AND  IIF(INDEXSEEK(DTOS(CTOD(HK + '/' + S16.F01)),.T.,'S15','S151'),S15.F03 <> '1',.T.);
                 AND (EMPTY(S16.F11) OR EMPTY(S16.F12)) AND EMPTY(S16.F23) AND S16.F31 <> '1' AND S16.F31 <> '2' INTO CURSOR S16_TEMP 
          IF _TALLY > 0
             =MESSAGEBOX('此人員尚有上下班資料不完整,請查明後在確認',0+64,'提示訊息視窗') 
             SELECT S16_TEMP
             USE
             THISFORM.GRID1.SETFOCUS  
             RETURN
          ELSE
             SELECT S16_TEMP
             USE               
             SELECT S16_1
             LOCK()
             IF RLOCK()  
                SUM_F05 = 0
                SUM_F06 = 0
                SUM_F07 = 0
                SUM_F09 = 0
                SUM_F10 = 0
                SUM_F171 = 0
                SUM_F172 = 0
                SUM_F311 = 0
                SUM_F312 = 0
 	            SELECT * FROM S16 WHERE S16.F02 = S16_1.F02 ORDER BY S16.F01 INTO CURSOR S16_TEMP
 	            SELECT S16_TEMP
 	            GO TOP
     	        DO WHILE !EOF()
     	           IF S16_TEMP.F31 = '2'	&&離職
 	                  SUM_F312 = SUM_F312 + 1
 	               ELSE
 	                  IF S16_TEMP.F31 = '1'	&&曠職
 	                     SUM_F311 = SUM_F311 + 1
 	                  ENDIF
 	                  SUM_F05 = SUM_F05 + S16_TEMP.F15
 	                  SUM_F06 = SUM_F06 + S16_TEMP.F16
 	                  SUM_F07 = SUM_F07 + 1
 	                  IF S16_TEMP.F18 <> 1 AND S16_TEMP.F18 <> 7 AND IIF(INDEXSEEK(DTOS(CTOD(HK + '/'+ S16_TEMP.F01)),.T.,'S15','S151'),S15.F03 <> '1',.T.)
 	                     IF IIF(SEEK('Y','S00'),S00.F65,'2') = '2'  
 	                        SUM_F09 = SUM_F09 + S16_TEMP.F17
 	                        SUM_F171 = SUM_F171 + IIF(S16_TEMP.F17 <> 0,1,0)
 	                     ELSE
 	                        SUM_F09 = SUM_F09 + IIF(EMPTY(S16_TEMP.F26),0,S16_TEMP.F17)
 	                        SUM_F171 = SUM_F171 + IIF(EMPTY(S16_TEMP.F26),0,IIF(S16_TEMP.F17 <> 0,1,0))                            
 	                     ENDIF     
 	                  ELSE     
     	                 IF IIF(SEEK('Y','S00'),S00.F65,'2') = '2'  
     	                    SUM_F10 = SUM_F10 + S16_TEMP.F17
     	                    SUM_F172 = SUM_F172 + IIF(S16_TEMP.F17 <> 0,1,0)
     	                 ELSE 
     	                    SUM_F10 = SUM_F10 + IIF(EMPTY(S16_TEMP.F26),0,S16_TEMP.F17)
     	                    SUM_F172 = SUM_F172 + IIF(EMPTY(S16_TEMP.F26),0,IIF(S16_TEMP.F17 <> 0,1,0))                                  
     	                 ENDIF
     	              ENDIF   
     	           ENDIF
     	           SELECT S16_TEMP
     	           SKIP
     	        ENDDO
     	        SELECT S16_TEMP
     	        USE
     	        IF !USED('S14')
			       SELECT  0
			       USE S14 
		        ELSE
			       SELECT  S14
		        ENDIF
		        SET ORDER TO S141
		        SEEK S16_1.F02 + DTOS(CTOD(HK + '/01'))
		        IF FOUND()
		           REPLACE S14.F05 WITH SUM_F05				&&遲到總分鐘數   
		           REPLACE S14.F06 WITH SUM_F06				&&早退總分鐘數 
		           REPLACE S14.F07 WITH SUM_F07				&&上班總天數  
		           REPLACE S14.F09 WITH SUM_F09 			&&平日加班總小時數 
		           REPLACE S14.F10 WITH SUM_F10 			&&假日加班總小時數 	
		           REPLACE S14.F12 WITH SUM_F171 			&&平日加班天數 	
		           REPLACE S14.F13 WITH SUM_F172 			&&假日加班天數 		       
		           REPLACE S14.F99 WITH DTCX(DATE()) +  IIF(SEEK(SYS_OPER,'A01'),A01.F03,'') 
		        ELSE    
		           SELECT S14
		           APPEND BLANK 
		           REPLACE S14.F01 WITH S16_1.F02
		           REPLACE S14.F02 WITH S16_1.F03
		           REPLACE S14.F03 WITH S16_1.F04
		           REPLACE S14.F04 WITH S16_1.F05
		           REPLACE S14.F05 WITH SUM_F05	 
		           REPLACE S14.F06 WITH SUM_F06	
		           REPLACE S14.F07 WITH SUM_F07	
		           REPLACE S14.F09 WITH SUM_F09 	
		           REPLACE S14.F10 WITH SUM_F10
		           REPLACE S14.F08 WITH CTOD(HK + '/01')
		           REPLACE S14.F12 WITH SUM_F171
		           REPLACE S14.F13 WITH SUM_F172
		           REPLACE S14.F99 WITH DTCX(DATE()) +  IIF(SEEK(SYS_OPER,'A01'),A01.F03,'') 		   
		        ENDIF
		        SELECT S14
		        USE
		        ***若有曠職則加入S0A.年度缺勤紀錄檔中
		        IF SUM_F311 > 0
		           IF !USED('S0A')
			          SELECT  0
			          USE S0A 
		           ELSE
			          SELECT  S0A
		           ENDIF
		           SELECT S0A
		           SET ORDER TO S0A1 && F01+F05+DTOS(F08)+F09+F10
		           SEEK S16_1.F02 + 'A2' + DTOS(CTOD(HK + '/01')) + 'D' + 'SB16' + ALLTRIM(LEFT(DTOS(CTOD(HK + '/01')),6))
		           IF FOUND()
		              REPLACE S0A.F07 WITH S0A.F07 + SUM_F311
		           ELSE
		              SELECT S0A
		              APPEND BLANK 
		              REPLACE S0A.F01 WITH S16_1.F02
		              REPLACE S0A.F02 WITH S16_1.F03
		              REPLACE S0A.F03 WITH S16_1.F04
		              REPLACE S0A.F04 WITH S16_1.F05
		              REPLACE S0A.F05 WITH 'A2'
		              REPLACE S0A.F06 WITH '曠職'
		              REPLACE S0A.F07 WITH SUM_F311
		              REPLACE S0A.F08 WITH CTOD(HK + '/01')  
		              REPLACE S0A.F09 WITH 'D'
		              REPLACE S0A.F10 WITH 'SB16' + ALLTRIM(LEFT(DTOS(CTOD(HK + '/01')),6))
		              REPLACE S0A.F99 WITH DTCX(DATE()) + IIF(SEEK(SYS_OPER,'A01'),A01.F03,'') 
		           ENDIF
		           SELECT S0A
		           USE
		        ENDIF    
                SELECT S16
                REPLACE S16.F19 WITH 'Y' FOR S16.F02 = S16_1.F02 ALL
                REPLACE S16.F99 WITH DTCX(DATE()) +  IIF(SEEK(SYS_OPER,'A01'),A01.F03,'') FOR S16.F02 = S16_1.F02 ALL
                SELECT S16_1
     	        REPLACE S16_1.F19 WITH 'Y' 
     	        REPLACE S16_1.F99 WITH DTCX(DATE()) +  IIF(SEEK(SYS_OPER,'A01'),A01.F03,'') 		   
     	        =MESSAGEBOX('此人員已確認成功',0+64,'提示訊息視窗') 
     	     ENDIF    
          ENDIF
       ELSE  
          =MESSAGEBOX('此筆資料已確認過,請查明後再作確認!',0+64,'提示訊息視窗')
       ENDIF          
     ENDIF   
  ELSE &&反確認  
     IF MESSAGEBOX('您是否要反確認此筆資料!',4+32+256,'請確認') = 6
        SELECT S16_1
        LOCK()
        IF RLOCK()  
           IF S16_1.F19 <> 'Y'      
              =MESSAGEBOX('此筆資料尚未確認過,請查明後再作反確認!',0+64,'提示訊息視窗')
           ELSE    
              S10 = 'S10' + LEFT(DTOS(CTOD(HK + '/01')),6)
	          S101 = 'S101' + LEFT(DTOS(CTOD(HK + '/01')),6)
	          IF !USED('&S10')
	             SELECT 0
	             USE (S10) ALIA S10
	          ELSE
	             SELECT S10
	          ENDIF
	          SELECT S10
	          SET ORDER TO S101
	          SEEK S16_1.F02
	          IF FOUND()
	             IF S10.F98 = 'Y'
	             	=MESSAGEBOX('此人員已在' + HK + '之S10.薪資計算作業中已確認,故無法執行反確認!',0+64,'提示視窗')
		            SELECT S10
		            USE
		            THISFORM.GRID1.SETFOCUS
		            RETURN	
	             ELSE
		            =MESSAGEBOX('此人員已在' + HK + '之S10.薪資計算作業中已有資料,故不得執行確認,請至S10刪除基本考勤資料後才可反確認!',0+64,'提示視窗')
		            SELECT S10
		            USE
		            THISFORM.GRID1.SETFOCUS
		            RETURN		             
	             ENDIF
	          ENDIF
	          SELECT S10
	          USE
     	      IF !USED('S14')
	             SELECT  0
		         USE S14 
              ELSE
		         SELECT  S14
	          ENDIF
	          SET ORDER TO S141
	          SELECT S14
	          SEEK S16_1.F02 + DTOS(CTOD(HK + '/01'))               
	          IF FOUND()
	             DELETE 
	          ENDIF
	          SELECT S14
	          USE
	          IF !USED('S0A')
		         SELECT  0
		         USE S0A 
		      ELSE
		         SELECT  S0A
		      ENDIF
		      SELECT S0A
		      SET ORDER TO S0A1
		      SEEK S16_1.F02 + 'A2'+DTOS(CTOD(HK + '/01')) + 'D' + 'SB16' + ALLTRIM(LEFT(DTOS(CTOD(HK + '/01')),6))
		      IF FOUND()
		         DELETE 
		      ENDIF
		      SELECT S0A
		      USE
	          SELECT S16
	          REPLACE S16.F19 WITH 'N' FOR ALLTRIM(S16.F02) = ALLTRIM(S16_1.F02) ALL
              SELECT S16_1
              REPLACE S16_1.F19 WITH 'N'
              =MESSAGEBOX('此人員已反確認成功',0+64,'提示訊息視窗') 
           ENDIF    
        ENDIF    
        UNLOCK ALL  
     ENDIF   
  ENDIF
  UNLOCK ALL 
  THISFORM.GRID1.SETFOCUS	
  THISFORM.PAGEFRAME1.PAGE1.ACTIVATE 	   
 ENDPROC  
***************
 PROC INOUT_BOTT.CLICK     &&進出記錄
    SELECT S21
    SET FILTER TO S21.F01=S16_1.F02
    SELECT S21
    GO TOP
    S21_SEEK=CREATEOBJECT("S21_SEEK")  
    S21_SEEK.SHOW    
    THISFORM.GRID1.SETFOCUS	
    THISFORM.PAGEFRAME1.PAGE1.ACTIVATE 	   
 ENDPROC                
***************
 PROC OUT_BOTT.CLICK     &&缺勤明細   
      SELECT * FROM S16 WHERE S16.F18<>7 AND S16.F18<>1 AND IIF(INDEXSEEK(DTOS(CTOD(HK+'/'+S16.F01)),.T.,'S15','S151'),S15.F03<>'1',.T.);
                     AND (EMPTY(S16.F11) OR EMPTY(S16.F12)) AND  EMPTY(F23) ORDER BY F02,F01 INTO CURSOR  S16_TEMP
      IF _TALLY >0
         REPORT FORM ALLTRIM(INT_116)+'S16C' TO PRINT PROMPT   PREVIEW
      ELSE
         =MESSAGEBOX('查無缺勤資料',0+48,'警示')   
      ENDIF
      CLEAR
      SELECT S16_TEMP
      USE
      THISFORM.GRID1.SETFOCUS        
 ENDPROC   
ENDDEFINE    
***********************************************列印程序
PROCEDURE PNT_PRC  
   SELECT  S16_1
   ANS_RANGE=CREATEOBJECT("ANS_RANGE")  
   ANS_RANGE.SHOW       
ENDPROC 
***********************************************列印範圍選定
DEFINE CLASS ANS_RANGE AS FORM
*!*	  AUTOCENTER=.T.
  CAPTION='請輸入列印資料範圍'
  TOP=INT_015*200
  LEFT=INT_015*250   
  HEIGHT=INT_015*120
  WIDTH=INT_015*280
  FONTSIZE=INT_015*9
  MOVABLE=.F.
  MAXBUTTON=.F.
  MINBUTTON=.F.    
  CONTROLBOX=.F.
  BORDERSTYLE=2
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WINDOWTYPE=1
  NAME='ANS_RANGE'
  ADD OBJECT LABEL1 AS LABEL WITH;
      AUTOSIZE=.T.,;
      HEIGHT=INT_015*25,;
      LEFT=INT_015*30,;
      TOP=INT_015*30,;
      CAPTION='起始員工編號',;
      NAME='LABEL1'
  ADD OBJECT TEXT1 AS TEXTBOX WITH;
      TOP=INT_015*24,;
      LEFT=INT_015*110,;
      HEIGHT=INT_015*25,; 
      WIDTH=INT_015*60,; 
      MAXLENGTH=4,;
      NAME='TEXT1'      
  ADD OBJECT LABEL2 AS LABEL WITH;
      AUTOSIZE=.T.,;
      HEIGHT=INT_015*25,;
      LEFT=INT_015*30,;
      TOP=INT_015*61,;
      CAPTION='截止員工編號',;
      NAME='LABEL2'
  ADD OBJECT TEXT2 AS TEXTBOX WITH;
      TOP=INT_015*55,;
      LEFT=INT_015*110,;
      HEIGHT=INT_015*25,;   
      WIDTH=INT_015*60,;     
      MAXLENGTH=4,;   
      NAME='TEXT2'    
  ADD OBJECT CMND1 AS COMMANDBUTTON WITH;
      LEFT=INT_015*190,;    
      HEIGHT=INT_015*25,; 
      WIDTH=INT_015*70,;    
      TOP=INT_015*14,;  
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\harrow.cur',;        
      CAPTION='\<P.列         印',;
      TOOLTIPTEXT='列印所輸入的範圍鍵值!快速鍵->ALT+Y',;
      NAME='CMND1'
  ADD OBJECT CMND2 AS COMMANDBUTTON WITH;
      LEFT=INT_015*190,;    
      HEIGHT=INT_015*25,; 
      WIDTH=INT_015*70,;    
      TOP=INT_015*45,;  
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\harrow.cur',;        
      CAPTION='\<E.轉EXCEL',;
      TOOLTIPTEXT='將資料轉至EXCEL格式!快速鍵->ALT+Y',;
      NAME='CMND2'      
  ADD OBJECT CMND3 AS COMMANDBUTTON WITH;
      LEFT=INT_015*190,;
      TOP=INT_015*76,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*70,; 
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\harrow.cur',;        
      CAPTION='\<C.取        消',;
      TOOLTIPTEXT='取消作業!快速鍵->ALT+C',;
      NAME='CMND3'
  PROCEDURE INIT 
      THISFORM.SETALL('FONTSIZE',INT_015*10,'TEXTBOX')
      THISFORM.SETALL('FONTSIZE',INT_015*10,'LABEL')      
      THISFORM.SETALL('FONTSIZE',INT_015*10,'COMMANDBUTTON')        
      THISFORM.TEXT1.VALUE=S16_1.F02
      THISFORM.TEXT2.VALUE=S16_1.F02         
  ENDPROC    
  PROCEDURE CMND1.CLICK 
      IF  EMPTY(THISFORM.TEXT1.VALUE)
           =MESSAGEBOX('起始員工編號不得為空白!',0+64,'提示訊息視窗')
           THISFORM.TEXT1.SETFOCUS
  	   RETURN 
      ENDIF
      IF  EMPTY(THISFORM.TEXT2.VALUE)
           =MESSAGEBOX('截止員工編號不得為空白!',0+64,'提示訊息視窗')
           THISFORM.TEXT2.SETFOCUS
  	   RETURN 
      ENDIF      
*!*	      CREATE CURSOR S16_TEMP;
*!*	     (P1 C(30),P2 N(8),P3 N(8),P4 N(8),F01 C(5),F02 C(5),F03 C(5),F04 C(5),F05 C(5),F06 C(5),F07 C(5),F08 C(5),F09 C(5),F10 C(5),F11 C(5),F12 C(5),F13 C(5),F14 C(5),F15 C(5),F16 C(5))
      SELECT F02,F15,F16,F17 FROM S16 WHERE F02>=THISFORM.TEXT1.VALUE AND F02<=THISFORM.TEXT2.VALUE  ORDER BY F02,F01 INTO CURSOR S16B
      SELECT F02,F03,F04,F05 FROM S16 WHERE F02>=THISFORM.TEXT1.VALUE AND F02<=THISFORM.TEXT2.VALUE GROUP BY F02 ORDER BY F02 INTO CURSOR S16A READWRITE 
      ALTER TABLE S16A ADD SUM_F15 N(6,1)
      ALTER TABLE S16A ADD SUM_F16 N(6,1)
      ALTER TABLE S16A ADD SUM_F17 N(6,1)
      INDE ON F02 TAG S16A1
      SELECT S16A
      SET ORDER TO S16A1
      SELECT S16B
      GO TOP
      DO WHILE !EOF()
             SELECT S16A
             SEEK S16B.F02
             IF FOUND()
                  REPLACE S16A.SUM_F15 WITH S16A.SUM_F15 + S16B.F15
                  REPLACE S16A.SUM_F16 WITH S16A.SUM_F16 + S16B.F16
                  REPLACE S16A.SUM_F17 WITH S16A.SUM_F17 + S16B.F17
             ENDIF
             SELECT S16B
             SKIP
      ENDDO
      SELECT S16B
      USE
      SELECT S16A
      SET ORDER TO S16A1
      GO TOP
      IF  _TALLY >0
           REPORT FORM ALLTRIM(INT_116)+'S16A' TO PRINT PROMPT   PREVIEW
           SELECT S16A
           USE
      ELSE
           =MESSAGEBOX('查無此範圍資料',0+48,'警示')
           SELECT S16A
           USE
           THISFORM.TEXT1.SETFOCUS
           RETURN     
      ENDIF      
      THISFORM.CMND3.CLICK
  ENDPROC  
  ***  
  PROCEDURE CMND2.CLICK 
      IF  EMPTY(THISFORM.TEXT1.VALUE)
           =MESSAGEBOX('起始員工編號不得為空白!',0+64,'提示訊息視窗')
           THISFORM.TEXT1.SETFOCUS
  	   RETURN 
      ENDIF
      IF  EMPTY(THISFORM.TEXT2.VALUE)
           =MESSAGEBOX('截止員工編號不得為空白!',0+64,'提示訊息視窗')
           THISFORM.TEXT2.SETFOCUS
  	   RETURN 
      ENDIF      
      SELECT F01 日期,F02 員工編號,F03 員工姓名,F04 部門編號,F05 部門名稱,F11 上班時間,F12 下班時間,F13 加班上班,F14 加班下班,;
                     F15 當日遲到分鐘數,F16 當日早退分鐘數,F17 當日加班時數,DAY_WEEK(F18) 假日判斷,IIF(F31='1','曠職',IIF(F31='2','離職','')) 曠職或離職 ;
                     FROM S16 WHERE F02>=THISFORM.TEXT1.VALUE AND F02<=THISFORM.TEXT2.VALUE  ORDER BY F02,F01 NOWAIT
      IF  _TALLY >0
            FILENAME=LEFT(ALLTRIM(HK),2)+'年'+RIGHT(ALLTRIM(HK),2)+'月上下班記錄明細'
	   GCDELIMFILE=PUTFILE('儲存路徑',FILENAME,'XLS')
	   IF !EMPTY(GCDELIMFILE) 
	        ON ERROR DO FILE_IMPACT
	       COPY TO (GCDELIMFILE) TYPE XL5     
	       =MESSAGEBOX('儲存成功',0+64,'提示訊息視窗') 
	  ENDIF  
      ELSE
             =MESSAGEBOX('查無此範圍資料',0+48,'警示')
             THISFORM.TEXT1.SETFOCUS
             RETURN     
      ENDIF      
      THISFORM.CMND3.CLICK
  ENDPROC   
  ***********       
  PROCEDURE CMND3.CLICK
      THISFORM.RELEASE
  ENDPROC      
  PROC CMND1.MOUSEENTER      
       LPARAMETERS nButton, nShift, nXCoord, nYCoord 
             THISFORM.CMND1.FORECOLOR=RGB(255,0,0)
             THISFORM.CMND1.TOP=INT_015*15
             THISFORM.CMND1.LEFT=INT_015*191
  ENDPROC     
  PROC CMND1.MOUSELEAVE      
        LPARAMETERS nButton, nShift, nXCoord, nYCoord 
             THISFORM.CMND1.FORECOLOR=RGB(0,0,0)  
             THISFORM.CMND1.TOP=INT_015*14
             THISFORM.CMND1.LEFT=INT_015*190                  
  ENDPROC     
  PROC CMND2.MOUSEENTER      
       LPARAMETERS nButton, nShift, nXCoord, nYCoord 
             THISFORM.CMND2.FORECOLOR=RGB(255,0,0)
             THISFORM.CMND2.TOP=INT_015*46
             THISFORM.CMND2.LEFT=INT_015*191
  ENDPROC     
  PROC CMND2.MOUSELEAVE      
        LPARAMETERS nButton, nShift, nXCoord, nYCoord 
             THISFORM.CMND2.FORECOLOR=RGB(0,0,0)  
             THISFORM.CMND2.TOP=INT_015*45
             THISFORM.CMND2.LEFT=INT_015*190                  
  ENDPROC     
  PROC CMND3.MOUSEENTER      
       LPARAMETERS nButton, nShift, nXCoord, nYCoord 
             THISFORM.CMND3.FORECOLOR=RGB(255,0,0)
             THISFORM.CMND3.TOP=INT_015*77
             THISFORM.CMND3.LEFT=INT_015*191
  ENDPROC     
  PROC CMND3.MOUSELEAVE      
        LPARAMETERS nButton, nShift, nXCoord, nYCoord 
             THISFORM.CMND3.FORECOLOR=RGB(0,0,0)  
             THISFORM.CMND3.TOP=INT_015*76
             THISFORM.CMND3.LEFT=INT_015*190                  
  ENDPROC   
ENDDEFINE  
*********人員編號
DEFINE CLASS COMBOBOX02 AS COMBOBOX 
       VISIBLE=.F.
       HEIGHT=INT_015*25
       WIDTH=INT_015*115
       FONTSIZE=INT_015*9   
       BOUNDCOLUMN=1
       ROWSOURCETYPE=1
       STYLE=2    
       VALUE=1
       NAME='COMBOBOX02' 
   PROCEDURE INTERACTIVECHANGE
    THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE=LEFT(ALLTRIM(THIS.DISPLAYVALUE),4)  
     IF THIS.VALUE=1
	 THISFORM.PAGEFRAME1.PAGE1.TXTF04.VALUE='' 
	 THISFORM.PAGEFRAME1.PAGE1.TXTF06.VALUE='' 
	 THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE='' 
	 THISFORM.PAGEFRAME1.PAGE1.TXTF08.VALUE='' 
	 THISFORM.PAGEFRAME1.PAGE1.TXTF09.VALUE='' 
	 THISFORM.PAGEFRAME1.PAGE1.TXTF10.VALUE='' 
	 THISFORM.PAGEFRAME1.PAGE1.LBLF03.CAPTION=''
	 THISFORM.PAGEFRAME1.PAGE1.LBLF04.CAPTION=''
     ELSE
         SELECT S05
         SET ORDER TO S051 
         SEEK THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE
         IF FOUND()      
	     THISFORM.PAGEFRAME1.PAGE1.TXTF04.VALUE=S05.F05
	     THISFORM.PAGEFRAME1.PAGE1.TXTF06.VALUE=IIF(INDEXSEEK('I'+S05.F29,.T.,'S00','S005'),S00.F50,'')
	     THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE=IIF(INDEXSEEK('I'+S05.F29,.T.,'S00','S005'),S00.F51,'')
	     THISFORM.PAGEFRAME1.PAGE1.TXTF08.VALUE=IIF(INDEXSEEK('I'+S05.F29,.T.,'S00','S005'),S00.F54,'')
	     THISFORM.PAGEFRAME1.PAGE1.TXTF09.VALUE=IIF(INDEXSEEK('I'+S05.F29,.T.,'S00','S005'),S00.F55,'')
	     THISFORM.PAGEFRAME1.PAGE1.TXTF10.VALUE=IIF(INDEXSEEK('I'+S05.F29,.T.,'S00','S005'),S00.F56,'')
	     THISFORM.PAGEFRAME1.PAGE1.LBLF03.CAPTION=S05.F02
	     THISFORM.PAGEFRAME1.PAGE1.LBLF05.CAPTION=S05.F06
	 ENDIF 
     ENDIF    
     THISFORM.PAGEFRAME1.PAGE1.TXTF02.REFRESH   
     THISFORM.PAGEFRAME1.PAGE1.TXTF04.REFRESH 
     THISFORM.PAGEFRAME1.PAGE1.TXTF06.REFRESH 
     THISFORM.PAGEFRAME1.PAGE1.TXTF07.REFRESH 
     THISFORM.PAGEFRAME1.PAGE1.TXTF08.REFRESH    
  ENDPROC       
ENDDEFINE 
******************上班時間
DEFINE CLASS TXTF11 AS TEXTBOX
        VISIBLE=.T.
        READONLY=.T.
        FONTSIZE=INT_015*9
        HEIGHT=INT_015*25     
	WIDTH=INT_015*45  
	MAXLENGTH=5
	INPUTMASK='99:99'  
   PROCEDURE INTERACTIVECHANGE	&&遲到
       F08_H=VAL(LEFT(ALLTRIM(THISFORM.PAGEFRAME1.PAGE1.TXTF08.VALUE),2))		&&上班遲到緩衝時間(時)
       F08_M=VAL(RIGHT(ALLTRIM(THISFORM.PAGEFRAME1.PAGE1.TXTF08.VALUE),2))	&&上班遲到緩衝時間(分)
       F11_H=VAL(LEFT(ALLTRIM(THIS.VALUE),2))		&&上班時間(時)
       F11_M=VAL(RIGHT(ALLTRIM(THIS.VALUE),2))	&&上班時間(分)
       F12_H=VAL(LEFT(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF12.VALUE),2))		&&下班時間(時)
       F12_M=VAL(RIGHT(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF12.VALUE),2))	&&下班時間(分)       
       IF ALLTRIM(THIS.VALUE)>=ALLTRIM(THISFORM.PAGEFRAME1.PAGE1.TXTF08.VALUE) AND LEN(ALLTRIM(THIS.VALUE)) <> 1
           DO CASE
                  CASE F11_M>=F08_M
                             THISFORM.PAGEFRAME1.PAGE2.LBLF151.CAPTION=ALLTRIM(STR((F11_H-F08_H)*60+(F11_M-F08_M)))
                  CASE F12_M<F09_M
                             THISFORM.PAGEFRAME1.PAGE2.LBLF151.CAPTION=ALLTRIM(STR((F11_H-F08_H)*60-(F08_M-F11_M)))       
           ENDCASE
       ELSE
           THISFORM.PAGEFRAME1.PAGE2.LBLF151.CAPTION='0' 
       ENDIF 
  ENDPROC       
ENDDEFINE 
******************下班時間
DEFINE CLASS TXTF12 AS TEXTBOX
        VISIBLE=.T.
        READONLY=.T.
        FONTSIZE=INT_015*9
        HEIGHT=INT_015*25     
	WIDTH=INT_015*45  
	MAXLENGTH=5
	INPUTMASK='99:99' 
   PROCEDURE INTERACTIVECHANGE	&&早退
       F09_H=VAL(LEFT(ALLTRIM(THISFORM.PAGEFRAME1.PAGE1.TXTF09.VALUE),2))		&&下班早退緩衝時間(時)
       F09_M=VAL(RIGHT(ALLTRIM(THISFORM.PAGEFRAME1.PAGE1.TXTF09.VALUE),2))	&&下班早退緩衝時間(分)   
       F11_H=VAL(LEFT(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF11.VALUE),2))		&&上班時間(時)
       F11_M=VAL(RIGHT(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF11.VALUE),2))	&&上班時間(分)       
       F12_H=VAL(LEFT(ALLTRIM(THIS.VALUE),2))		&&下班時間(時)
       F12_M=VAL(RIGHT(ALLTRIM(THIS.VALUE),2))	&&下班時間(分)
       IF ALLTRIM(THIS.VALUE)<=ALLTRIM(THISFORM.PAGEFRAME1.PAGE1.TXTF09.VALUE) AND LEN(ALLTRIM(THIS.VALUE)) <> 1
           DO CASE
                  CASE F12_M<=F09_M
                             THISFORM.PAGEFRAME1.PAGE2.LBLF161.CAPTION=ALLTRIM(STR((F09_H-F12_H)*60+(F09_M-F12_M)))
                  CASE F12_M>F09_M
                             THISFORM.PAGEFRAME1.PAGE2.LBLF161.CAPTION=ALLTRIM(STR((F09_H-F12_H)*60-(F12_M-F09_M)))
           ENDCASE
       ELSE
           THISFORM.PAGEFRAME1.PAGE2.LBLF161.CAPTION='0' 
       ENDIF        
  ENDPROC       
ENDDEFINE 
******************加班上班時間
DEFINE CLASS TXTF13 AS TEXTBOX
        VISIBLE=.T.
        READONLY=.T.
        FONTSIZE=INT_015*9
        HEIGHT=INT_015*25     
	WIDTH=INT_015*45  
	MAXLENGTH=5
	INPUTMASK='99:99' 
   PROCEDURE INTERACTIVECHANGE
       F10_H=VAL(LEFT(ALLTRIM(THISFORM.PAGEFRAME1.PAGE1.TXTF10.VALUE),2))		&&加班上班緩衝時間(時)
       F10_M=VAL(RIGHT(ALLTRIM(THISFORM.PAGEFRAME1.PAGE1.TXTF10.VALUE),2))	&&加班上班緩衝時間(分)   
       F13_H=VAL(LEFT(ALLTRIM(THIS.VALUE),2))		&&加班上班時間(時)
       F13_M=VAL(RIGHT(ALLTRIM(THIS.VALUE),2))	&&加班上班時間(分)
       F14_H=VAL(LEFT(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF14.VALUE),2))+IIF(LEFT(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF14.VALUE),2)='00',24,0)	  &&加班下班時間(時)
       F14_M=VAL(RIGHT(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF14.VALUE),2))	&&加班下班時間(分)
       S00_F63=IIF(SEEK('Y','S00'),S00.F63,'F')			&&加班時間不滿時則以30分鐘計算
       S00_F64=IIF(SEEK('Y','S00'),S00.F64,'F')			&&加班時間若滿時則以60分鐘計算
       S16_F171=0       
       IF ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF13.VALUE)<ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF14.VALUE)
            IF  THISFORM.PAGEFRAME1.PAGE2.TXTF18.VALUE<>1 AND THISFORM.PAGEFRAME1.PAGE2.TXTF18.VALUE<>7 ;
                 AND IIF(INDEXSEEK(DTOS(CTOD(HK+'/'+THISFORM.PAGEFRAME1.PAGE2.TXTF01.VALUE)),.T.,'S15','S151'),S15.F03<>'1',.T.)
                 ****非假日則需考慮加班上班緩衝時間
                 DO CASE
                       CASE ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF13.VALUE)>=ALLTRIM(THISFORM.PAGEFRAME1.PAGE1.TXTF10.VALUE) 
                       	         DO CASE 
                       	                CASE F13_M<=F14_H 
                       	                           S16_F171=((F14_H-F13_H)*60)+(F14_M-F13_M)
                       	                CASE F13_M>F14_H
                       	                           S16_F171=((F14_H-F13_H)*60)-(F13_M-F14_M)                  
                       	         ENDCASE           	
                       CASE ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF13.VALUE)<ALLTRIM(THISFORM.PAGEFRAME1.PAGE1.TXTF10.VALUE)
                       	         DO CASE 
                       	                CASE F10_M<=F14_H 
                       	                           S16_F171=((F14_H-F10_H)*60)+(F14_M-F10_M)
                       	                CASE F10_M>F14_H
                       	                           S16_F171=((F14_H-F10_H)*60)-(F10_M-F14_M)                  
                       	         ENDCASE                                     
                 ENDCASE
            ELSE    	&&假日
                 DO CASE 
                        CASE F13_M<=F14_H 
                   	           S16_F171=((F14_H-F13_H)*60)+(F14_M-F13_M)
                   	CASE F13_M>F14_H
                   	           S16_F171=((F14_H-F13_H)*60)-(F13_M-F14_M)                  
                 ENDCASE     
	    ENDIF
	    *******
	    IF MOD(S16_F171,60)=0
	        THISFORM.PAGEFRAME1.PAGE2.LBLF171.CAPTION=ALLTRIM(TRANSFORM(ROUND(S16_F171/60,1),'@R 999.9')) 
	    ELSE    
	        DO CASE
	              CASE ALLTRIM(S00_F63)<>'F' AND ALLTRIM(S00_F64)<>'F'
	          		 IF MOD(S16_F171,60)>=VAL(S00_F63)  AND MOD(S16_F171,60)<VAL(S00_F64)
	             		     THISFORM.PAGEFRAME1.PAGE2.LBLF171.CAPTION=ALLTRIM(TRANSFORM(INT(S16_F171/60)+0.5,'@R 999.9')) 
	             		 ELSE
	             		     IF MOD(S16_F171,60)>=VAL(S00_F64) AND MOD(S16_F171,60)<60 
	             		         THISFORM.PAGEFRAME1.PAGE2.LBLF171.CAPTION=ALLTRIM(TRANSFORM(INT(S16_F171/60)+1,'@R 999.9')) 
	             		     ELSE
	             		         THISFORM.PAGEFRAME1.PAGE2.LBLF171.CAPTION=ALLTRIM(TRANSFORM(INT(S16_F171/60),'@R 999.9'))
	             		     ENDIF    
	             		 ENDIF             		           
	              CASE ALLTRIM(S00_F63)<>'F' AND ALLTRIM(S00_F64)='F'
	             		 IF  MOD(S16_F171,60)>=VAL(S00_F63) AND MOD(S16_F171,60)<60
	             		     THISFORM.PAGEFRAME1.PAGE2.LBLF171.CAPTION=ALLTRIM(TRANSFORM(INT(S16_F171/60)+0.5,'@R 999.9')) 
	             		 ELSE
	             		     THISFORM.PAGEFRAME1.PAGE2.LBLF171.CAPTION=ALLTRIM(TRANSFORM(INT(S16_F171/60),'@R 999.9'))
	             		 ENDIF
	              CASE ALLTRIM(S00_F63)='F' AND ALLTRIM(S00_F64)<>'F'
	             		 IF MOD(S16_F171,60)>=VAL(S00_F64) AND MOD(S16_F171,60)<60 
	             		     THISFORM.PAGEFRAME1.PAGE2.LBLF171.CAPTION=ALLTRIM(TRANSFORM(INT(S16_F171/60)+1,'@R 999.9')) 
	             		 ELSE
	             		     THISFORM.PAGEFRAME1.PAGE2.LBLF171.CAPTION=ALLTRIM(TRANSFORM(INT(S16_F171/60),'@R 999.9')) 
	             		 ENDIF             
	              CASE ALLTRIM(S00_F63)='F' AND ALLTRIM(S00_F64)='F'
	             	         THISFORM.PAGEFRAME1.PAGE2.LBLF171.CAPTION=ALLTRIM(TRANSFORM(ROUND(S16_F171/60,1),'@R 999.9')) 
	        ENDCASE
	    ENDIF
       ELSE
            THISFORM.PAGEFRAME1.PAGE2.LBLF171.CAPTION='加班上班時間不可大於加班下班時間'
       ENDIF
  ENDPROC       
ENDDEFINE 
******************加班下班時間 
DEFINE CLASS TXTF14 AS TEXTBOX
        VISIBLE=.T.
        READONLY=.T.
        FONTSIZE=INT_015*9
        HEIGHT=INT_015*25     
	WIDTH=INT_015*45  
	MAXLENGTH=5
	INPUTMASK='99:99' 
   PROCEDURE INTERACTIVECHANGE
       F10_H=VAL(LEFT(ALLTRIM(THISFORM.PAGEFRAME1.PAGE1.TXTF10.VALUE),2))				&&加班上班緩衝時間(時)
       F10_M=VAL(RIGHT(ALLTRIM(THISFORM.PAGEFRAME1.PAGE1.TXTF10.VALUE),2))			&&加班上班緩衝時間(分)      
       F13_H=VAL(LEFT(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF13.VALUE),2))				&&加班上班時間(時)
       F13_M=VAL(RIGHT(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF13.VALUE),2))			&&加班上班時間(分)
       F14_H=VAL(LEFT(ALLTRIM(THIS.VALUE),2))+IIF(LEFT(ALLTRIM(THIS.VALUE),2)='00',24,0)	  	&&加班下班時間(時)
       F14_M=VAL(RIGHT(ALLTRIM(THIS.VALUE),2))	&&加班下班時間(分)
       S00_F63=IIF(SEEK('Y','S00'),S00.F63,'F')			&&加班時間不滿時則以30分鐘計算
       S00_F64=IIF(SEEK('Y','S00'),S00.F64,'F')			&&加班時間若滿時則以60分鐘計算
       S16_F171=0       
       IF ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF13.VALUE)<ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF14.VALUE)
            IF  THISFORM.PAGEFRAME1.PAGE2.TXTF18.VALUE<>1 AND THISFORM.PAGEFRAME1.PAGE2.TXTF18.VALUE<>7 ;
                 AND IIF(INDEXSEEK(DTOS(CTOD(HK+'/'+THISFORM.PAGEFRAME1.PAGE2.TXTF01.VALUE)),.T.,'S15','S151'),S15.F03<>'1',.T.)
                 ****非假日則需考慮加班上班緩衝時間
                 DO CASE
                       CASE ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF13.VALUE)>=ALLTRIM(THISFORM.PAGEFRAME1.PAGE1.TXTF10.VALUE) 
                       	         DO CASE 
                       	                CASE F13_M<=F14_H 
                       	                           S16_F171=((F14_H-F13_H)*60)+(F14_M-F13_M)
                       	                CASE F13_M>F14_H
                       	                           S16_F171=((F14_H-F13_H)*60)-(F13_M-F14_M)                  
                       	         ENDCASE           	
                       CASE ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF13.VALUE)<ALLTRIM(THISFORM.PAGEFRAME1.PAGE1.TXTF10.VALUE)
                       	         DO CASE 
                       	                CASE F10_M<=F14_H 
                       	                           S16_F171=((F14_H-F10_H)*60)+(F14_M-F10_M)
                       	                CASE F10_M>F14_H
                       	                           S16_F171=((F14_H-F10_H)*60)-(F10_M-F14_M)                  
                       	         ENDCASE                                     
                 ENDCASE
            ELSE    	&&假日
                 DO CASE 
                        CASE F13_M<=F14_H 
                   	           S16_F171=((F14_H-F13_H)*60)+(F14_M-F13_M)
                   	CASE F13_M>F14_H
                   	           S16_F171=((F14_H-F13_H)*60)-(F13_M-F14_M)                  
                 ENDCASE     
	    ENDIF
	    *******
	    IF MOD(S16_F171,60)=0
	        THISFORM.PAGEFRAME1.PAGE2.LBLF171.CAPTION=ALLTRIM(TRANSFORM(ROUND(S16_F171/60,1),'@R 999.9')) 
	    ELSE    
	        DO CASE
	              CASE ALLTRIM(S00_F63)<>'F' AND ALLTRIM(S00_F64)<>'F'
	          		 IF MOD(S16_F171,60)>=VAL(S00_F63)  AND MOD(S16_F171,60)<VAL(S00_F64)
	             		     THISFORM.PAGEFRAME1.PAGE2.LBLF171.CAPTION=ALLTRIM(TRANSFORM(INT(S16_F171/60)+0.5,'@R 999.9')) 
	             		 ELSE
	             		     IF MOD(S16_F171,60)>=VAL(S00_F64) AND MOD(S16_F171,60)<60 
	             		         THISFORM.PAGEFRAME1.PAGE2.LBLF171.CAPTION=ALLTRIM(TRANSFORM(INT(S16_F171/60)+1,'@R 999.9')) 
	             		     ELSE
	             		         THISFORM.PAGEFRAME1.PAGE2.LBLF171.CAPTION=ALLTRIM(TRANSFORM(INT(S16_F171/60),'@R 999.9'))
	             		     ENDIF    
	             		 ENDIF             		           
	              CASE ALLTRIM(S00_F63)<>'F' AND ALLTRIM(S00_F64)='F'
	             		 IF  MOD(S16_F171,60)>=VAL(S00_F63) AND MOD(S16_F171,60)<60
	             		     THISFORM.PAGEFRAME1.PAGE2.LBLF171.CAPTION=ALLTRIM(TRANSFORM(INT(S16_F171/60)+0.5,'@R 999.9')) 
	             		 ELSE
	             		     THISFORM.PAGEFRAME1.PAGE2.LBLF171.CAPTION=ALLTRIM(TRANSFORM(INT(S16_F171/60),'@R 999.9'))
	             		 ENDIF
	              CASE ALLTRIM(S00_F63)='F' AND ALLTRIM(S00_F64)<>'F'
	             		 IF MOD(S16_F171,60)>=VAL(S00_F64) AND MOD(S16_F171,60)<60 
	             		     THISFORM.PAGEFRAME1.PAGE2.LBLF171.CAPTION=ALLTRIM(TRANSFORM(INT(S16_F171/60)+1,'@R 999.9')) 
	             		 ELSE
	             		     THISFORM.PAGEFRAME1.PAGE2.LBLF171.CAPTION=ALLTRIM(TRANSFORM(INT(S16_F171/60),'@R 999.9')) 
	             		 ENDIF             
	              CASE ALLTRIM(S00_F63)='F' AND ALLTRIM(S00_F64)='F'
	             	         THISFORM.PAGEFRAME1.PAGE2.LBLF171.CAPTION=ALLTRIM(TRANSFORM(ROUND(S16_F171/60,1),'@R 999.9')) 
	        ENDCASE
	    ENDIF
       ELSE
            THISFORM.PAGEFRAME1.PAGE2.LBLF171.CAPTION='加班下班時間不可小於加班上班時間'
       ENDIF
  ENDPROC       
ENDDEFINE 
**************************************S21.進出記錄         
DEFINE CLASS S21_SEEK AS FORM
*!*	  AUTOCENTER=.T.
  TOP=INT_015*110
  LEFT=INT_015*250      
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*350
  WIDTH=INT_015*331
  MAXBUTTON=.F.
  MINBUTTON=.F.    
  CLOSABLE=.F.
  CONTROLBOX=.F.
  BORDERSTYLE=2
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WINDOWTYPE=1
  NAME='S21_SEEK'
  ADD OBJECT GRDD01 AS GRID WITH;          
      AUTOCENTER=.T.,;
      TOP=37,;
      WIDTH=INT_015*330,;      
      HEIGHT=INT_015*320,;      
      ROWHEIGHT=INT_015*18,;
      HEADERHEIGHT=INT_015*19,;
      ALLOWCELLSELECTION=.F.,;
      DELETEMARK=.F.,;
      READONLY=.T.,;
      RECORDSOURCETYPE=1,;
      COLUMNCOUNT=4,;            
      RECORDSOURCE='S21',;      
      NAME='GRDD01',;
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;      
      COLUMN3.NAME='COLUMN3',; 
      COLUMN4.NAME='COLUMN4'  
  ADD OBJECT CMND1 AS COMMANDBUTTON WITH;
      AUTOSIZE=.T.,;
      LEFT=INT_015*240,;
      TOP=INT_015*2,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*80,;
      FONTSIZE=INT_015*9,;     
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\HARROW.CUR',;         
      CAPTION='\<C.離開',;
      TOOLTIPTEXT='取消此搜尋畫面!快速鍵->ALT+C'
      NAME='CMND1'
 PROCEDURE INIT 
         THISFORM.CAPTION=ALLTRIM(S16_1.F03)+SPACE(5)+'S21.進出紀錄檔'
         THISFORM.SETALL('MOVABLE',.F.,'COLUMN')
         THISFORM.GRDD01.SETALL('FONTSIZE',INT_015*9,'COLUMN') 
         THISFORM.GRDD01.SETALL('FONTSIZE',INT_015*9,'HEADER')          
         THISFORM.GRDD01.SETALL("DYNAMICBACKCOLOR","IIF(DOW(S21.F04)=7 OR DOW(S21.F04)=1 OR INDEXSEEK(DTOS(S21.F04),.F.,'S15','S151')=.T.,RGB(0,255,255),'')","COLUMN")            
         THISFORM.GRDD01.COLUMN1.WIDTH=INT_015*70
         THISFORM.GRDD01.COLUMN2.WIDTH=INT_015*55
         THISFORM.GRDD01.COLUMN3.WIDTH=INT_015*55
         THISFORM.GRDD01.COLUMN4.WIDTH=INT_015*120
         THISFORM.GRDD01.COLUMN1.HEADER1.CAPTION='進出日期'
         THISFORM.GRDD01.COLUMN2.HEADER1.CAPTION='進出時段'		
         THISFORM.GRDD01.COLUMN3.HEADER1.CAPTION='進出時間'	
         THISFORM.GRDD01.COLUMN4.HEADER1.CAPTION='假日判斷'   
         THISFORM.GRDD01.COLUMN1.CONTROLSOURCE='S21.F04'
         THISFORM.GRDD01.COLUMN2.CONTROLSOURCE="IIF(S21.F05='1','上午','下午')"
         THISFORM.GRDD01.COLUMN3.CONTROLSOURCE='S21.F06'
         THISFORM.GRDD01.COLUMN4.CONTROLSOURCE="DAY_WEEK(DOW(S21.F04))+IIF(INDEXSEEK(DTOS(S21.F04),.T.,'S15','S151'),SPACE(5)+ALLTRIM(S15.F02),'')"
         THISFORM.GRDD01.SETFOCUS
         IF THISFORM.GRDD01.ACTIVEROW<>0
              THISFORM.GRDD01.AFTERROWCOLCHANGE 
         ENDIF 
 ENDPROC
 ***   
 PROCEDURE CMND1.CLICK
          THISFORM.RELEASE
  ENDPROC      
ENDDEFINE  
*****假日判斷
FUNCTION DAY_WEEK
     PARA JUK4
     JO4=''
     DO CASE
        CASE JUK4=2
             JO4='星期一'     
        CASE JUK4=3
             JO4='星期二'   
        CASE JUK4=4
             JO4='星期三'   
        CASE JUK4=5
             JO4='星期四'   
        CASE JUK4=6
             JO4='星期五'   
        CASE JUK4=7
             JO4='星期六'   
        CASE JUK4=1
             JO4='星期日' 
     ENDCASE
     RETURN JO4   