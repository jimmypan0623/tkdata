***程式名稱:G07其他委外入庫費用明細
close all
clear 
FLG='0'
FCH=''
CHK=''
CHK_STR=''
R=0
QTY=0
TQTY=0
AREA1='G09_1'
AREA2='G09'
IF !USED('A09')
   SELE 0
   USE A09
ELSE
   SELE A09
ENDIF
SET ORDER TO 1
IF !USED('A23')
    SELE 0
    USE A23
ELSE 
   SELE A23
ENDIF
SET ORDER TO 1         

SELE A23
SET ORDER TO 1
SEEK LEFT(DTOS(DATE()),6)+'01'
IF ! USED('A01')
   SELE 0
   USE A01 INDE A01
ELSE
   SELE A01
ENDIF      
SET ORDER TO A01
IF !USED('A02')
   SELE 0
   USE A02 INDE A02
ELSE
   SELE A02
ENDIF
SET ORDER TO A021      
SEEK sys_oper+'G07'
IF !USED('B01')
   SELE 0
   USE B01 INDE B01
ELSE
   SELE B01
ENDIF
SET ORDER TO 1     
E20='E20'+LEFT(DTOS(DATE()),6)
E201='E201'+LEFT(DTOS(DATE()),6)
IF !USED('&E20')
   SELE 0
   USE (E20) ALIA E20
ELSE
   SELE E20
ENDIF
SET ORDER TO 1      
E17='E17'+LEFT(DTOS(DATE()),6)
E175='E175'+LEFT(DTOS(DATE()),6)
IF !USED('&E17')
   SELE 0
   USE (E17) ALIA E17
ELSE
   SELE E17
ENDIF
SET ORDER TO E175      
B07='B07'+LEFT(DTOS(DATE()),6)
B071='B071'+LEFT(DTOS(DATE()),6)
IF !USED('&B07')
   SELE 0
   USE (B07) ALIA B07
ELSE
   SELE B07
ENDIF
SET ORDER TO 1      
G09='G09'+LEFT(DTOS(DATE()),6)
G091='G091'+LEFT(DTOS(DATE()),6)
IF !USED('&G09')
   SELE 0
   USE (G09) ALIA G09
ELSE
   SELE G09
ENDIF
SET ORDER TO 1      
SET RELA TO F05 INTO B01
CREATE CURSOR G09_1;
(F01 C(10),F02 N(10.2),F03 C(30),F04 C(17))
INDE ON F01 TAG G09_11
SELE F01,F02,F03,F04 FROM G09 GROUP BY F01 ORDER BY F01 INTO CURSOR G09_2
SELE G09_2
GO TOP
DO WHILE !EOF()
   SELE G09_1
   APPEND BLANK
   REPL F01 WITH G09_2.F01
   REPL F02 WITH G09_2.F02
   REPL F03 WITH G09_2.F03
   REPL F04 WITH G09_2.F04
   SELE G09_2
   SKIP   
ENDDO
SELE G09_2
USE   
SELE G09_1
SET ORDER TO 1
G07form=createobject("tkG07")
G07form.show  
define class tkG07 as form
  caption='G07.其他委外入庫費用明細'
  controlbox=.F.
  BORDERSTYLE=3  
  MAXBUTTON=.F.
  MINBUTTON=.F.
  MOVABLE=.F.
  CLOSABLE=.F.
  controlcount=57
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*550
  showtips=.t.
  showwindow=1
  WIDTH=INT_015*789
  windowtype=1
  NAME='TKG07'
  add object shape1 as shape1 with;
      autocenter=.t.
  ADD OBJECT LBL_REC AS LBL_REC WITH;
      AUTOCENTER =.T.
  ADD OBJECT REC_COUNT AS REC_COUNT  with;
      caption=str(reccount())        
  add object shape2 as shape2 with;
      autocenter=.t.
  add object shape3 as shape3 with;
      autocenter=.t.
  ADD OBJECT PAGEFRAME1 AS PAGEFRAME WITH;
      LEFT=INT_015*236,;
      WIDTH=INT_015*540,;
      HEIGHT=INT_015*200,;
      FONTSIZE=INT_015*9,;
      PAGECOUNT=2,;
      TABSTRETCH=1,;
      ACTIVEPAGE=1,;
      VISIBLE=.T.,;
      PAGE1.NAME='PAGE1',;
      PAGE1.VISIBLE=.T.,;
      PAGE1.CAPTION='表頭資料',;
      PAGE2.NAME='PAGE2',;
      PAGE2.VISIBLE=.T.,;
      PAGE2.CAPTION='表身詳細資料內容'   
  ADD OBJECT KEY_LIST AS KEY_LIST WITH;
      autocenter=.t.,;
      WIDTH=INT_015*130
  ADD OBJECT MTH_LIST AS MTH_LIST WITH;
      autocenter=.t.
  ADD OBJECT grid1 AS grid1 WITH;
      columncount=1,;            
      RECORDSOURCE='G09_1',;      
      COLUMN1.NAME='COLUMN1'
  ADD OBJECT grid2 AS grid2 WITH;
      columncount=6,;            
      RECORDSOURCE='G09',; 
      LINKMASTER='G09_1',;
      RELATIONALEXPR='F01',;
      childorder=G091,;  
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;
      COLUMN3.NAME='COLUMN3',;
      COLUMN4.NAME='COLUMN4',;
      COLUMN5.NAME='COLUMN5',;
      COLUMN6.NAME='COLUMN6'
  ADD OBJECT CMDGROUP AS CMDGROUP WITH;
      AUTOSIZE=.T.              
  ADD OBJECT ORPGROUP AS ORPGROUP WITH;    
      AUTOSIZE=.T.              
  ADD OBJECT SHRGROUP AS SHRGROUP WITH;
      TOP=INT_015*173,;
      LEFT=INT_015*558          
  PROCEDURE PAGEFRAME1.PAGE1.INIT     
     THIS.ADDOBJECT('LBLF01','LABEL')
     WITH THIS.LBLF01
          .VISIBLE=.T.
          .LEFT=INT_015*14
          .TOP=INT_015*13
          .WIDTH=INT_015*50
          .CAPTION='入貨單號'          
     ENDWITH
     THIS.ADDOBJECT('LBLF02','LABEL')     
     WITH THIS.LBLF02
          .VISIBLE=.T.
          .LEFT=INT_015*14
          .TOP=INT_015*63
          .WIDTH=INT_015*50  
          .CAPTION='入貨費用'
     ENDWITH            
     THIS.ADDOBJECT('LBLF03','LABEL')
     WITH THIS.LBLF03
         .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*138
         .WIDTH=INT_015*50
         .CAPTION='備註說明'
     ENDWITH    
     THIS.ADDOBJECT('LBLF04','LABEL')
     WITH THIS.LBLF04
         .VISIBLE=.T.
         .LEFT=INT_015*368
         .TOP=INT_015*63
         .WIDTH=INT_015*50
         .CAPTION='安全資料'
     ENDWITH    
     THIS.ADDOBJECT('LBLF041','LABEL')
     WITH THIS.LBLF041
         .VISIBLE=.T.
         .LEFT=INT_015*419
         .TOP=INT_015*63
         .AUTOSIZE=.T.
     ENDWITH    
     THIS.ADDOBJECT('TXTF01','TEXTBOX')          
     WITH THIS.TXTF01
          .VISIBLE=.T.
          .LEFT=INT_015*64
          .TOP=INT_015*9
          .WIDTH=INT_015*81
          .HEIGHT=INT_015*25
          .MAXLENGTH=10
     ENDWITH        
     THIS.ADDOBJECT('TXTF02','TEXTBOX')          
     WITH THIS.TXTF02
          .VISIBLE=.T.
          .LEFT=INT_015*64
          .TOP=INT_015*59
          .WIDTH=INT_015*100
          .HEIGHT=INT_015*25
          .INPUTMASK='9999999.99'
     ENDWITH        
     THIS.ADDOBJECT('TXTF03','TEXTBOX')          
     WITH THIS.TXTF03
          .VISIBLE=.T.
          .LEFT=INT_015*64
          .TOP=INT_015*134
          .WIDTH=INT_015*261
          .HEIGHT=INT_015*25
          .MAXLENGTH=43
     ENDWITH      
  ENDPROC   
  PROCEDURE PAGEFRAME1.PAGE2.INIT
	THIS.ADDOBJECT('LBLF05','LABEL')
	WITH THIS.LBLF05  
	     .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*18
	     .WIDTH=INT_015*50
         .CAPTION='料品編號'
    ENDWITH  
    THIS.ADDOBJECT('LBLF051','LABEL')
    WITH THIS.LBLF051
         .VISIBLE=.T.
         .LEFT=INT_015*326
	     .TOP=INT_015*18
	     .autosize=.t.
	ENDWITH     
    THIS.ADDOBJECT('LBLF06','Label')
    WITH THIS.LBLF06
         .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*43
         .WIDTH=INT_015*50
         .CAPTION='進貨數量'         
    ENDWITH     
    THIS.ADDOBJECT('LBLF07','Label')
    WITH THIS.LBLF07
         .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*68
         .WIDTH=INT_015*50
         .CAPTION='進貨單價'         
    ENDWITH         
    THIS.ADDOBJECT('LBLFTL','Label')
    WITH THIS.LBLFTL
         .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*93
         .WIDTH=INT_015*50
         .CAPTION='金額小計'         
    ENDWITH             
    THIS.ADDOBJECT('LBLFTL1','Label')
    WITH THIS.LBLFTL1
         .VISIBLE=.T.
         .LEFT=INT_015*65
         .TOP=INT_015*93
         .AUTOSIZE=.T.
         .CAPTION=''         
    ENDWITH                 
    THIS.ADDOBJECT('LBLF08','Label')
    WITH THIS.LBLF08
         .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*118
         .WIDTH=INT_015*50
         .CAPTION='百 分 比'         
    ENDWITH             
    THIS.ADDOBJECT('LBLF09','Label')
    WITH THIS.LBLF09
         .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*143
         .WIDTH=INT_015*50
         .CAPTION='分攤金額'         
    ENDWITH                 
	THIS.ADDOBJECT('TXTF05','TEXTBOX')
	WITH THIS.TXTF05      
	     .VISIBLE=.T.
	     .LEFT=INT_015*65
	     .TOP=INT_015*14
	     .WIDTH=INT_015*261
	     .HEIGHT=INT_015*25
	     .MAXLENGTH=43
	     .NAME='TXTF05'  
	ENDWITH         
	THIS.ADDOBJECT('TXTF06','TEXTBOX')
	WITH THIS.TXTF06      
	     .VISIBLE=.T.
	     .LEFT=INT_015*65
	     .TOP=INT_015*39
	     .WIDTH=INT_015*100
	     .HEIGHT=INT_015*25
	     .INPUTMASK='99999999.999'
	     .NAME='TXTF06'  
	ENDWITH         	
	THIS.ADDOBJECT('TXTF07','TEXTBOX')
	WITH THIS.TXTF07      
	     .VISIBLE=.T.
	     .LEFT=INT_015*65
	     .TOP=INT_015*64
	     .WIDTH=INT_015*100
	     .HEIGHT=INT_015*25
	     .INPUTMASK='99999999.999999'
	     .NAME='TXTF07'  
	ENDWITH     
	THIS.ADDOBJECT('TXTF08','TEXTBOX')
	WITH THIS.TXTF08
	     .VISIBLE=.T.
	     .LEFT=INT_015*65
	     .TOP=INT_015*114
	     .WIDTH=INT_015*100
	     .HEIGHT=INT_015*25
	     .INPUTMASK='999.999999'
	     .NAME='TXTF08'	    
	ENDWITH     
	THIS.ADDOBJECT('TXTF09','TEXTBOX')
	WITH THIS.TXTF09
	     .VISIBLE=.T.
	     .LEFT=INT_015*65
	     .TOP=INT_015*139
	     .WIDTH=INT_015*100
	     .HEIGHT=INT_015*25
	     .INPUTMASK='999999999.99'
	     .NAME='TXTF09'	    
	ENDWITH     	

  ENDPROC       
  PROCEDURE PAGEFRAME1.PAGE1.activate
     R=0
     SELE G09_1
     IF THISFORM.SHRGROUP.VISIBLE=.F.
        THISFORM.GRID1.ENABLED=.T.   
        THISFORM.GRID1.SETFOCUS   
        THISFORM.KEY_LIST.ENABLED=.T.
        THISFORM.MTH_LIST.ENABLED=.T.
     ELSE
       THISFORM.KEY_LIST.ENABLED=.F.   
       THISFORM.MTH_LIST.ENABLED=.F.   
     ENDIF                
    IF THISFORM.GRID1.ACTIVEROW=0 .AND. thisform.SHRGROUP.ENABLED=.F.
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
        THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
        THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
        THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
        THISFORM.PAGEFRAME1.PAGE1.SETALL('VALUE','','TEXTBOX')        
        THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=''
        THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE=0
        THISFORM.PAGEFRAME1.PAGE1.TXTF03.VALUE=''
        THISFORM.PAGEFRAME1.PAGE1.LBLF041.CAPTION=''                   
        THISFORM.PAGEFRAME1.PAGE2.ENABLED=.F.      
     ELSE
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.
        THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  AND !IIF(SEEK(DTOS(CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/01')),'A23','A231'),A23.F09,.F.) &&判斷有無修改的權限
        THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)    AND !IIF(SEEK(DTOS(CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/01')),'A23','A231'),A23.F09,.F.)&&判斷有無刪除的權限
        THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)    &&判斷有無列印的權限  
        THISFORM.PAGEFRAME1.PAGE2.ENABLED=.T.
     ENDIF   
     THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.);
     AND !IIF(SEEK(DTOS(CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/01')),'A23','A231'),A23.F09,.F.)
  ENDPROC
  PROCEDURE PAGEFRAME1.PAGE2.activate
     SELE G09
     IF THISFORM.SHRGROUP.ENABLED=.F.
        THISFORM.GRID2.READONLY=.T.   
        THISFORM.GRID2.SETFOCUS   
     ENDIF   
     IF THISFORM.GRID2.ACTIVEROW=0 .and. thisform.SHRGROUP.ENABLED=.F.
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
        THISFORM.PAGEFRAME1.PAGE2.SETALL('VALUE','','TEXTBOX')
        THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE=''
        THISFORM.PAGEFRAME1.PAGE2.LBLF051.CAPTION=''
        THISFORM.PAGEFRAME1.PAGE2.LBLFTL1.CAPTION=''
     ELSE
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.

        THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)  &&&&判斷有無列印的權限  
     ENDIF   
     THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
     THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
     R=RECNO('&AREA1')
     THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(RECNO('&AREA1')=R,RGB(255,255,0),'')","COLUMN")
     THISFORM.GRID1.ENABLED=.F.     
     THISFORM.ORPGROUP.NEW_BOTT.ENABLED=.F.
     THISFORM.KEY_LIST.ENABLED=.F.     
     THISFORM.MTH_LIST.ENABLED=.F.     
  ENDPROC     
  PROC INIT       
       thisform.setall('height',INT_015*25,'textbox')
       thisform.setall('height',INT_015*17,'label')
       thisform.setall('FONTSIZE',INT_015*9,'textbox')
       thisform.setall('FONTSIZE',INT_015*9,'label')       
       THISFORM.SETALL('READONLY',.T.,'TEXTBOX')
       THISFORM.SHRGROUP.VISIBLE=.F.
       THISFORM.SHRGROUP.ENABLED=.F.
       THISFORM.GRID1.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)
       THISFORM.GRID2.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)
       thisform.GRID1.setall('FONTSIZE',INT_015*9,'COLUMN')
       thisform.GRID1.setall('FONTSIZE',INT_015*9,'HEADER')         
       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='入貨單號'
       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='G09_1.F01'
       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*81
       thisform.GRID2.setall('FONTSIZE',INT_015*9,'COLUMN')
       thisform.GRID2.setall('FONTSIZE',INT_015*9,'HEADER')           
       THISFORM.grid2.COLUMN1.HEADER1.CAPTION='料品編號'
       THISFORM.grid2.COLUMN2.HEADER1.CAPTION='品名規格'
	   THISFORM.grid2.COLUMN3.HEADER1.CAPTION='金額小計'	   
	   THISFORM.GRID2.COLUMN4.HEADER1.CAPTION='分攤百分比'
	   THISFORM.GRID2.COLUMN5.HEADER1.CAPTION='分攤金額'	   
	   THISFORM.GRID2.COLUMN6.HEADER1.CAPTION='製令編號'	   	   
	   THISFORM.GRID2.LINKMASTER='G09_1'
       THISFORM.GRID2.RELATIONALEXPR='F01'
	   THISFORM.grid2.COLUMN1.CONTROLSOURCE='G09.F05'
	   THISFORM.grid2.COLUMN2.CONTROLSOURCE='B01.F02'
	   THISFORM.grid2.COLUMN3.CONTROLSOURCE='ROUND(G09.F06*G09.F07,INT_070)'
	   THISFORM.GRID2.COLUMN4.CONTROLSOURCE='G09.F08'
	   THISFORM.GRID2.COLUMN5.CONTROLSOURCE='G09.F09'	   
	   THISFORM.GRID2.COLUMN6.CONTROLSOURCE='G09.F10'	   	   
	   THISFORM.grid2.COLUMN1.WIDTH=INT_015*149
	   THISFORM.GRID2.COLUMN2.WIDTH=INT_015*100
       THISFORM.grid2.COLUMN3.WIDTH=INT_015*90
       THISFORM.GRID2.COLUMN4.WIDTH=INT_015*90
       THISFORM.GRID2.COLUMN5.WIDTH=INT_015*90
       THISFORM.GRID2.COLUMN6.WIDTH=INT_015*80       
       THISFORM.grid1.READONLY=.T.      
       THISFORM.grid2.READONLY=.T.            
       THISFORM.grid1.SETFOCUS
       IF THISFORM.GRID1.ACTIVEROW=0
          THISFORM.CMDGROUP.ENABLED=.F.
          THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
          THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
          THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
       ELSE
          THISFORM.CMDGROUP.ENABLED=.T.      
          THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  AND !IIF(SEEK(DTOS(CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/01')),'A23','A231'),A23.F09,.F.) &&判斷有無修改的權限
          THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)   AND !IIF(SEEK(DTOS(CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/01')),'A23','A231'),A23.F09,.F.)&&判斷有無刪除的權限
          THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限       
       ENDIF          
       JK='入貨單號'
       SELE G09_1
       THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=G09_1.F01
  ENDPROC               
  PROC KEY_LIST.INIT 
       with this 
           .additem('依入貨單號排列')
           .VALUE=1
       endwith             
  ENDPROC 
  PROC KEY_LIST.INTERACTIVECHANGE                 

  ENDPROC      
  PROC MTH_LIST.INTERACTIVECHANGE
       THISFORM.GRID1.RECORDSOURCE=''
       THISFORM.GRID2.RECORDSOURCE=''
       THISFORM.GRID2.LINKMASTER=''
       THISFORM.GRID2.RELATIONALEXPR=''
       THISFORM.GRID2.childorder=''
       SELE E17
       USE
       SELE E20
       USE
       SELE B07
       USE
       SELE G09
       set rela off into b01
       SET RELA OFF INTO G09_1
       USE
       SELE G09_1
       USE
       E20='E20'+LEFT(DTOS(CTOD(THIS.DISPLAYVALUE+'/01')),6)
       E201='E201'+LEFT(DTOS(CTOD(THIS.DISPLAYVALUE+'/01')),6)
       IF !USED('&E20')
          SELE 0
          USE (E20) ALIA E20
       ELSE
          SELE E20
       ENDIF
       SET ORDER TO 1                    
       E17='E17'+LEFT(DTOS(CTOD(THIS.DISPLAYVALUE+'/01')),6)
       E175='E175'+LEFT(DTOS(CTOD(THIS.DISPLAYVALUE+'/01')),6)
       IF !USED('&E17')
          SELE 0
          USE (E17) ALIA E17
       ELSE
          SELE E17
       ENDIF
       SET ORDER TO E175                           
       B07='B07'+LEFT(DTOS(CTOD(THIS.DISPLAYVALUE+'/01')),6)
       B071='B071'+LEFT(DTOS(CTOD(THIS.DISPLAYVALUE+'/01')),6)
       IF !USED('&B07')
          SELE 0
          USE (B07) ALIA B07
       ELSE
          SELE B07
       ENDIF
       SET ORDER TO 1             
       G09='G09'+LEFT(DTOS(CTOD(THIS.DISPLAYVALUE+'/01')),6)
       G091='G091'+LEFT(DTOS(CTOD(THIS.DISPLAYVALUE+'/01')),6)
       IF !USED('&G09')
          SELE 0
          USE (G09) ALIA G09
       ELSE
          SELE G09
       ENDIF
       SET ORDER TO 1      
       SET RELA TO F05 INTO B01
       CREATE CURSOR G09_1;
       (F01 C(10),F02 N(10.2),F03 C(30),F04 C(17))
       INDE ON F01 TAG G09_11
       SELE F01,F02,F03,F04 FROM G09 GROUP BY F01 ORDER BY F01 INTO CURSOR G09_2
       SELE G09_2
       GO TOP
       DO WHILE !EOF()
          SELE G09_1
          APPEND BLANK
          REPL F01 WITH G09_2.F01
          REPL F02 WITH G09_2.F02
          REPL F03 WITH G09_2.F03
          REPL F04 WITH G09_2.F04
          SELE G09_2
          SKIP
       ENDDO
       SELE G09_2
       USE   
       SELE G09_1
       SET ORDER TO 1
       THISFORM.GRID1.RECORDSOURCE='G09_1'
       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='G09_1.F01'     
       THISFORM.GRID2.RECORDSOURCE='G09'
	   THISFORM.GRID2.LINKMASTER='G09_1'
       THISFORM.GRID2.RELATIONALEXPR='F01'      
       THISFORM.GRID2.CHILDORDER=G091  
	   THISFORM.grid2.COLUMN1.CONTROLSOURCE='G09.F05'
	   THISFORM.grid2.COLUMN2.CONTROLSOURCE='B01.F02'
	   THISFORM.grid2.COLUMN3.CONTROLSOURCE='ROUND(G09.F06*G09.F07,INT_070)'
	   THISFORM.GRID2.COLUMN4.CONTROLSOURCE='G09.F08'
	   THISFORM.GRID2.COLUMN5.CONTROLSOURCE='G09.F09'	   
	   THISFORM.GRID2.COLUMN6.CONTROLSOURCE='G09.F10'	   	   
       THISFORM.KEY_LIST.INTERACTIVECHANGE
	   THISFORM.PAGEFRAME1.ACTIVEPAGE=1
	   THISFORM.REFRESH
	   thisform.grid1.setfocus        
       IF THISFORM.GRID1.ACTIVEROW=0
          THISFORM.CMDGROUP.ENABLED=.F.
          THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
          THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
          THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
       ELSE
          THISFORM.CMDGROUP.ENABLED=.T.      
          THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  AND !IIF(SEEK(DTOS(CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/01')),'A23','A231'),A23.F09,.F.) &&判斷有無修改的權限
          THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)  AND !IIF(SEEK(DTOS(CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/01')),'A23','A231'),A23.F09,.F.) &&判斷有無刪除的權限
          THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限    
       ENDIF          
  ENDPROC
  PROC grid1.AFTERROWCOLCHANGE
       LPARAMETERS nColIndex
       THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=G09_1.F01
       THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE=G09_1.F02
       THISFORM.PAGEFRAME1.PAGE1.TXTF03.VALUE=G09_1.F03
       THISFORM.PAGEFRAME1.PAGE1.lblf041.caption=G09_1.F04
       THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  AND !IIF(SEEK(DTOS(CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/01')),'A23','A231'),A23.F09,.F.) &&判斷有無修改的權限
       THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)  AND !IIF(SEEK(DTOS(CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/01')),'A23','A231'),A23.F09,.F.) &&判斷有無刪除的權限
       FCH=THISFORM.ACTIVECONTROL.NAME
       JK=THIS.COLUMN1.HEADER1.CAPTION  
       IF THIS.ACTIVEROW=0
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
       ELSE
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.
       ENDIF   
       CHK=''     
*       thisform.refresh
  ENDPROC     
  PROC grid2.AFTERROWCOLCHANGE
       LPARAMETERS nColIndex
       THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE=G09.F05
       THISFORM.PAGEFRAME1.PAGE2.LBLF051.CAPTION=B01.F02
       THISFORM.PAGEFRAME1.PAGE2.TXTF06.VALUE=G09.F06      
       THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE=G09.F07
       THISFORM.PAGEFRAME1.PAGE2.TXTF08.VALUE=G09.F08       
       THISFORM.PAGEFRAME1.PAGE2.TXTF09.VALUE=G09.F09  
       THISFORM.PAGEFRAME1.PAGE2.LBLFTL1.CAPTION=TRANSFORM(ROUND(G09.F06*G09.F07,INT_070),'@R 999999999.99')
       FCH=THISFORM.ACTIVECONTROL.NAME
       JK=THIS.COLUMN1.HEADER1.CAPTION
       CHK=THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
       if thisform.pageframe1.activepage=1
          thisform. CMDGROUP.SEEK_BOTT.ENABLED=.F.
       ENDIF   
*       thisform.refresh
  ENDPROC 
  PROCEDURE ORPGROUP.NEW_BOTT.CLICK    
    THISFORM.KEY_LIST.ENABLED=.F. 
    THISFORM.MTH_LIST.ENABLED=.F. 
    THISFORM.PAGEFRAME1.ACTIVEPAGE=1       
     SELE G09_1
       THISFORM.GRID2.RECORDSOURCE=''
       THISFORM.GRID2.CHILDORDER=''
       THISFORM.PAGEFRAME1.PAGE1.SETALL('READONLY',.F.,'TEXTBOX')     &&處理表頭新增
       THISFORM.GRID1.ENABLED=.F.   
       THISFORM.GRID2.ENABLED=.F.   
       THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=''
       THISFORM.PAGEFRAME1.PAGE1.TXTF01.READONLY=.F.
        THISFORM.PAGEFRAME1.PAGE1.TXTF01.SETFOCUS
        THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE=0
        THISFORM.PAGEFRAME1.PAGE1.TXTF03.VALUE=''
        THISFORM.PAGEFRAME1.PAGE1.LBLF041.CAPTION=''        
        THISFORM.PAGEFRAME1.PAGE2.ENABLED=.F.

*     ENDIF   

  ENDPROC  
  PROCEDURE ORPGROUP.EDIT_BOTT.CLICK
     THISFORM.KEY_LIST.ENABLED=.F. 
     THISFORM.MTH_LIST.ENABLED=.F. 
     THISFORM.GRID1.ENABLED=.F.   
     THISFORM.GRID2.ENABLED=.F.   
     IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
        SELE G09_1
        PO_NO=G09_1.F01
        SELE RECNO() FROM G09 WHERE G09.F01=PO_NO  INTO ARRAY BK1
        JJ1=''                
        IF _TALLY>0                   
           FOR I= 1 TO ALEN(BK1)
               JJ1=JJ1+ALLTRIM(STR(BK1(I)))+','
           ENDFOR  
           KK1=STUFF(JJ1,RAT(',',JJ1,1),1,'')
           RLOCK(KK1,'G09')
           LL1=RLOCK(KK1,'G09')
        ELSE 
           LL1=.T.
        ENDIF   
        SELE RECNO() FROM E20 WHERE E20.F02+E20.F05=THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE+THISFORM.PAGEFRAME1.PAGE1.TXTF03.VALUE  AND ALLTRIM(E20.F20)='FE' INTO ARRAY BK2
        JJ2=''                
        IF _TALLY>0                   
           FOR I= 1 TO ALEN(BK2)
               JJ2=JJ2+ALLTRIM(STR(BK2(I)))+','
           ENDFOR  
           KK2=STUFF(JJ2,RAT(',',JJ2,1),1,'')
           RLOCK(KK2,'E20')
           LL2=RLOCK(KK2,'E20')
        ELSE 
           LL2=.T.
        ENDIF           
        IF LL1 .AND. LL2=.T.
           THISFORM.PAGEFRAME1.PAGE1.SETALL('READONLY',.F.,'TEXTBOX')     &&處理表頭修改
           THISFORM.PAGEFRAME1.PAGE1.TXTF01.READONLY=.T.
           THISFORM.PAGEFRAME1.PAGE1.TXTF03.READONLY=.T.           
           THISFORM.PAGEFRAME1.PAGE2.ENABLED=.F.
           THISFORM.PAGEFRAME1.PAGE1.TXTF02.SETFOCUS
        ELSE 
           DO file_impact
           UNLOCK ALL
           THISFORM.SHRGROUP.ABANDON_BOTT.CLICK
        endif   
     ENDIF   
     RELEASE ALL LIKE BK*
  endproc    
  PROC ORPGROUP.DEL_BOTT.CLICK                    &&刪除資料程序
       IF messagebox('是否確定要刪除此筆資料',4+32+256,'請確認') = 6	        
                     
             SELE G09_1             &&刪除整張訂單
                PO_NO=G09_1.F01
                SELE RECNO() FROM G09 WHERE G09.F01=PO_NO  INTO ARRAY BK1              
                JJ1=''                
                IF _TALLY>0   
                   FOR I= 1 TO ALEN(BK1)
                       JJ1=JJ1+ALLTRIM(STR(BK1(I)))+','
                   ENDFOR    
                   KK1=STUFF(JJ1,RAT(',',JJ1,1),1,'')              
                   RLOCK(KK1,'G09')
                   LL1=RLOCK(KK1,'G09')
                ELSE
                   LL1=.T.   
                ENDIF                   
               SELE RECNO() FROM E20 WHERE E20.F02+E20.F05=THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE+THISFORM.PAGEFRAME1.PAGE1.TXTF03.VALUE  AND ALLTRIM(E20.F20)='FE' INTO ARRAY BK2
               JJ2=''                
               IF _TALLY>0                   
                  FOR I= 1 TO ALEN(BK2)
                     JJ2=JJ2+ALLTRIM(STR(BK2(I)))+','
                  ENDFOR  
                  KK2=STUFF(JJ2,RAT(',',JJ2,1),1,'')
                  RLOCK(KK2,'E20')
                  LL2=RLOCK(KK2,'E20')
               ELSE 
                  LL2=.T.
               ENDIF                           
                IF LL1 .AND. LL2=.T.
                   DELE FROM G09 WHERE G09.F01=PO_NO
                   DELE FROM E20 WHERE F02+F05=THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE+THISFORM.PAGEFRAME1.PAGE1.TXTF03.VALUE AND ALLTRIM(F20)='FE'
                   DELE FROM E17 WHERE F04+F03=THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE+THISFORM.PAGEFRAME1.PAGE1.TXTF03.VALUE AND ALLTRIM(F05)='FE'+SUBSTR(DTOS(CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/01')),3,4)
                ELSE
                   DO file_impact                  
                ENDIF             
                SELE G09_1
                DELE
                SKIP -1
                IF BOF()
                   GO TOP
                ENDIF   
             THISFORM.GRID1.SETFOCUS
             IF THISFORM.GRID1.ACTIVEROW=0
                THISFORM.CMDGROUP.ENABLED=.F.
                THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
                THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.               
                THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
             ELSE      
                THISFORM.CMDGROUP.ENABLED=.T.
                THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  AND !IIF(SEEK(DTOS(CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/01')),'A23','A231'),A23.F09,.F.) &&判斷有無修改的權限
                THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)   AND !IIF(SEEK(DTOS(CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/01')),'A23','A231'),A23.F09,.F.) &&判斷有無刪除的權限
                THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限
             ENDIF     
       ENDIF
       
       RELEASE ALL LIKE BK*   
  ENDPROC  
  PROCEDURE SHRGROUP.SHURE1_BOTT.CLICK               &&新增確認
    IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
       THISFORM.GRID2.RECORDSOURCE='G09'
       THISFORM.GRID2.CHILDORDER=G091
	   THISFORM.grid2.COLUMN1.CONTROLSOURCE='G09.F05'
	   THISFORM.grid2.COLUMN2.CONTROLSOURCE='B01.F02'
	   THISFORM.grid2.COLUMN3.CONTROLSOURCE='ROUND(G09.F06*G09.F07,INT_070)'
	   THISFORM.GRID2.COLUMN4.CONTROLSOURCE='G09.F08'
	   THISFORM.GRID2.COLUMN5.CONTROLSOURCE='G09.F09'	
	   THISFORM.GRID2.COLUMN6.CONTROLSOURCE='G09.F10'          
       SELE G09_1 
       SET ORDER TO 1
       IF SEEK(THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE,'B07')=.F.
          =MESSAGEBOX('本月份無此進貨單號',0+48,'提示訊息視窗')
          THISFORM.PAGEFRAME1.PAGE1.TXTF01.SETFOCUS
          RETURN
       ENDIF
       IF SEEK(THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE,'G09_1')=.T.
          =MESSAGEBOX('已有輸入本張入貨單之資料!',0+48,'提示訊息視窗')
          THISFORM.PAGEFRAME1.PAGE1.TXTF01.SETFOCUS
          RETURN
       ENDIF
       IF THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE<=0         
          =MESSAGEBOX('費用不得小於等於 0 !',0+48,'提示訊息視窗') 
          THISFORM.PAGEFRAME1.PAGE1.TXTF02.SETFOCUS
          RETURN
        ENDIF           
       IF EMPTY(THISFORM.PAGEFRAME1.PAGE1.TXTF03.VALUE)
          =MESSAGEBOX('備註說明不得空白 !',0+48,'提示訊息視窗') 
          THISFORM.PAGEFRAME1.PAGE1.TXTF03.SETFOCUS
          RETURN
        ENDIF                   
       SELE G09_1          
       APPEND BLANK
       LOCK()
       IF RLOCK()
          REPLACE F01 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
          REPLACE F02 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE
          REPLACE F03 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF03.VALUE
          REPLACE F04 WITH IIF(INT_012=1,PADL(ALLTRIM(STR(YEAR(DATE())-1911)),3,' ')+RIGHT(DTOC(DATE()),6),dtoc(DATE())+' ')+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
       ENDIF   
*       UNLOCK
       SEEK THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
        
       THISFORM.REFRESH
       SELE B07
       SEEK THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
       IF FOUND()          
          SELE E17
          APPEND BLANK
          REPL F01 WITH B07.F02
          REPL F02 WITH B07.F07
          REPL F03 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF03.VALUE
          REPL F04 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
          REPL F05 WITH 'FE'+SUBSTR(DTOS(CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/01')),3,4)
          REPL F06 WITH INT_011
          REPL F07 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE
          REPL F08 WITH 1
          SELE E20
          APPEND BLANK
          REPLACE  F01 WITH CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/'+B07.F02)
          REPLACE  F02 WITH B07.F01
          REPLACE  F03 WITH B07.F07
          REPLACE  F04 WITH 'FE'+SUBSTR(DTOS(CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/01')),3,4)
          REPLACE  F05 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF03.VALUE
          REPLACE  F06 WITH 1
          REPLACE  F07 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE
          REPLACE  F08 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE
          REPLACE  F09 WITH '1'
          REPLACE  F12 WITH IIF(SEEK(sys_oper,'A01'),A01.F03,'')
          REPLACE  F13 WITH INT_011
          REPLACE  F14 WITH 1
          REPLACE  F17 WITH '委外入庫費用明細轉入'
          REPL F20 WITH 'FE'
          SELE B07
          DO WHILE F01=THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE           
             IF !EMPTY(IIF(SEEK(B07.F03,'B01'),B01.F98,''))
                SELE G09
                APPEND BLANK                        
                REPLACE F01 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
                REPLACE F02 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE
                REPLACE F03 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF03.VALUE
                REPLACE F04 WITH IIF(INT_012=1,PADL(ALLTRIM(STR(YEAR(DATE())-1911)),3,' ')+RIGHT(DTOC(DATE()),6),dtoc(DATE())+' ')+IIF(SEEK(sys_oper,'A01'),A01.F03,'')                       
                REPLACE F05 WITH B07.F03
                REPLACE F06 WITH B07.F04
                REPLACE F07 WITH ROUND(B07.F17*B07.F18,6)
                REPLACE F10 WITH B07.F09
                
             ENDIF   
             SELE B07
             SKIP
          ENDDO
       ENDIF
       SELE G09
       CALC SUM(F06*F07) TO QTY FOR F01=THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE

       seek thisform.pageframe1.page1.txtf01.value
       TQTY=0
       IF FOUND()                                     &&計算分攤比例
          DO WHILE F01=thisform.pageframe1.page1.txtf01.value
             REPLACE F08 WITH ROUND(100*F06*F07/QTY,6) 
             REPLACE F09 WITH ROUND(F02*F08/100,INT_070)
             TQTY=TQTY+F09   &&計算分攤後之總計
             SKIP
          ENDDO
       ENDIF
       SEEK THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
       REPL F09 WITH F09+(F02-TQTY)   &&修正值加到第一筆
       THISFORM.PAGEFRAME1.PAGE1.ENABLED=.T.  
       THISFORM.PAGEFRAME1.PAGE2.ENABLED=.T.       
         THISFORM.SHRGROUP.ABANDON_BOTT.CLICK    
         THISFORM.PAGEFRAME1.ACTIVEPAGE=2
       thisform.grid2.enabled=.t.
       thisform.grid2.setfocus  
       THISFORM.PAGEFRAME1.ACTIVEPAGE=1
    ENDIF  
  ENDPROC
  PROCEDURE SHRGROUP.SHURE2_BOTT.CLICK                          &&修改確認
     IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
       IF THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE<=0         
          =MESSAGEBOX('費用不得小於等於 0 !',0+48,'提示訊息視窗') 
          THISFORM.PAGEFRAME1.PAGE1.TXTF02.SETFOCUS
          RETURN
        ENDIF           
           SELE G09
           SEEK G09_1.F01
           TQTY=0
           IF FOUND()
              DO WHILE F01=G09_1.F01
                 REPL F02 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE
                 REPL F03 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF03.VALUE
                 REPL F04 WITH IIF(INT_012=1,PADL(ALLTRIM(STR(YEAR(DATE())-1911)),3,' ')+RIGHT(DTOC(DATE()),6),dtoc(DATE())+' ')+IIF(SEEK(sys_oper,'A01'),A01.F03,'') 
                 REPL F09 WITH ROUND(F02*F08/100,INT_070)
                 TQTY=TQTY+F09
                 SKIP
              ENDDO    
           ENDIF        
           SEEK THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
           REPL F09 WITH F09+(F02-TQTY)
           SELE E17
           LOCATE FOR F04+F03=THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE+THISFORM.PAGEFRAME1.PAGE1.TXTF03.VALUE AND ALLTRIM(F05)='FE'+SUBSTR(DTOS(CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/01')),3,4)
           IF FOUND()
              REPL F07 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE
           ENDIF   
           SELE E20
           LOCATE FOR F02+F05=THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE+THISFORM.PAGEFRAME1.PAGE1.TXTF03.VALUE AND ALLTRIM(F20)='FE'
           IF FOUND()
              REPL F07 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE
              REPL F08 WITH F07
           ENDIF
           SELE G09_1           
           REPL F02 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE
           REPL F04 WITH IIF(INT_012=1,PADL(ALLTRIM(STR(YEAR(DATE())-1911)),3,' ')+RIGHT(DTOC(DATE()),6),dtoc(DATE())+' ')+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
           UNLOCK ALL                   
    ENDIF   
    THISFORM.SHRGROUP.ABANDON_BOTT.CLICK    
  ENDPROC   
  procedure SHRGROUP.ABANDON_BOTT.CLICK
      THISFORM.SHRGROUP.ENABLED=.F.
      THISFORM.SHRGROUP.VISIBLE=.F.      
      THISFORM.ORPGROUP.ENABLED=.T.
      THISFORM.ORPGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
      THISFORM.CMDGROUP.ENABLED=.T.
      THISFORM.CMDGROUP.SETALL('ENABLED',.T.,'COMMANDBUTTON')
      THISFORM.CMDGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
      THISFORM.SETALL('READONLY',.T.,'TEXTBOX')  
      THISFORM.PAGEFRAME1.PAGE1.SETALL('READONLY',.T.,'TEXTBOX')  
      THISFORM.PAGEFRAME1.PAGE2.SETALL('READONLY',.T.,'TEXTBOX')  
      THISFORM.PAGEFRAME1.PAGE1.ENABLED=.T.
      THISFORM.PAGEFRAME1.PAGE2.ENABLED=.T.
      THISFORM.grid1.ENABLED=.T.
      THISFORM.grid2.ENABLED=.T.
      IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1         
         THISFORM.GRID1.SETFOCUS
         THISFORM.KEY_LIST.ENABLED=.T.
         THISFORM.MTH_LIST.ENABLED=.T.      
      ENDIF       
      UNLOCK ALL
  ENDPROC
  PROCEDURE SHRGROUP.FINISH_BOTT.CLICK
      IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
         IF THISFORM.GRID2.RECORDSOURCE<>'G09'
            THISFORM.GRID2.RECORDSOURCE='G09'
            THISFORM.GRID2.CHILDORDER=G091
  	        THISFORM.grid2.COLUMN1.CONTROLSOURCE='G09.F05'
	        THISFORM.grid2.COLUMN2.CONTROLSOURCE='B01.F02'
	        THISFORM.grid2.COLUMN3.CONTROLSOURCE='ROUND(G09.F06*G09.F07,INT_070)'
	        THISFORM.GRID2.COLUMN4.CONTROLSOURCE='G09.F08'
	        THISFORM.GRID2.COLUMN5.CONTROLSOURCE='G09.F09'	            
	        THISFORM.GRID2.COLUMN6.CONTROLSOURCE='G09.F10'	            	        
	     ENDIF   
       ENDIF  
       THISFORM.SHRGROUP.ABANDON_BOTT.CLICK
  ENDPROC     

enddefine    

***********************************************列印程序
PROCEDURE PNT_PRC  
     LK=G09_1.F01     
     HK=LEFT(DTOC(A23.F01),5)
     SELECT G09.F01,;
            G09.F02,;
            G09.F03,;
            G09.F04,;                    
            G09.F05,;
            G09.F07,;
            A14.F02,;
            B01.F02;            
     FROM G09,A14,B01 WHERE G09.F01=LK AND A14.F01=G09.F05 AND B01.F01=G09.F03 ORDER BY G09.F03 NOWAIT
     IF _tally >0
*        REPORT FORM ALLTRIM(INT_116)+'G09' PREVIEW
         report form ALLTRIM(INT_116)+'G09' to print prompt 
     ENDIF  
ENDPROC
