**程式名稱:B15.進貨紀錄表
SET EXCL OFF
CLOSE ALL
CLEAR 
AREA1='D10'
FLG='0'
FCH=''
CHK=''
IF !USED('A01')
   SELE 0
   USE A01
ELSE 
   SELE A01
ENDIF
SET ORDER TO A01      
IF !USED('A02')
   SELE 0
   USE A02 INDE A02
ELSE
   SELE A02
ENDIF
SET ORDER TO A021      
SEEK SYS_OPER+'B15'   
IF !USED('B01')
   SELE 0
   USE B01 INDE B01
ELSE
   SELE B01
ENDIF
SET ORDER TO 1
IF !USED('D10')
   SELE 0
   USE D10 INDE D10
ELSE
   SELE D10
ENDIF
SET ORDER TO D101
SET RELA TO F02 INTO B01
GO TOP
*****************
B15FORM=CREATEOBJECT("TKB15")
B15FORM.SHOW  
DEFINE CLASS TKB15 AS FORM
  CAPTION='B15.進貨紀錄表'
  AUTOCENTER=.T.
  CONTROLBOX=.F.
  BORDERSTYLE=3  
  MAXBUTTON=.F.
  MINBUTTON=.F.
  MOVABLE=.F.
  CLOSABLE=.F.
  CONTROLCOUNT=57
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*550
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WIDTH=INT_015*789
  WINDOWTYPE=1
*!*	  ADD OBJECT SHAPE1 AS SHAPE1 WITH;
*!*	      AUTOCENTER=.T.
*!*	  ADD OBJECT SHAPE2 AS SHAPE2 WITH;
*!*	      AUTOCENTER=.T.
*!*	  ADD OBJECT SHAPE3 AS SHAPE3 WITH;
*!*	      AUTOCENTER=.T.
  ADD OBJECT LBL_REC AS LBL_REC WITH;
      LEFT=INT_015*660,;
      AUTOCENTER =.T.,;
      CAPTION='資料筆數',;
      TOP=INT_015*9
  ADD OBJECT REC_COUNT AS REC_COUNT  WITH;
      TOP=INT_015*9
  ADD OBJECT KEY_LIST AS KEY_LIST WITH;
      AUTOCENTER=.T.
  ADD OBJECT GRID1 AS GRID1 WITH;
      COLUMNCOUNT=6,;            
      RECORDSOURCE='D10',; 
      HEIGHT=INT_015*500,;     
      WIDTH=INT_015*780,;      
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;
      COLUMN3.NAME='COLUMN3',; 
      COLUMN4.NAME='COLUMN4',;
      COLUMN5.NAME='COLUMN5',; 
      COLUMN6.NAME='COLUMN6'                        
  ADD OBJECT ORPGROUP AS ORPGROUP WITH;      
      TOP=INT_015*0,;
      LEFT=INT_015*435             
  ADD OBJECT CMDGROUP AS CMDGROUP WITH;
      TOP=INT_015*0,;
      LEFT=INT_015*220,;
      ENABLED=.T.,;
      VISIBLE=.T.  
*****************                       
PROCEDURE INIT
       THISFORM.ORPGROUP.NEW_BOTT.VISIBLE=.F.
       THISFORM.ORPGROUP.EDIT_BOTT.VISIBLE=.F.
       THISFORM.ORPGROUP.DEL_BOTT.VISIBLE=.F.
       THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限    
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'COLUMN')
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'HEADER')       
       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*85
       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*200
       THISFORM.GRID1.COLUMN3.WIDTH=INT_015*149
       THISFORM.GRID1.COLUMN4.WIDTH=INT_015*75
       THISFORM.GRID1.COLUMN5.WIDTH=INT_015*85
       THISFORM.GRID1.COLUMN6.WIDTH=INT_015*85  
       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='採購單號'
	   THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='料    號'
	   THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='品名規格'	   
  	   THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='交貨日期'
  	   THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='進貨單號'
  	   THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='數    量' 
	   THISFORM.GRID1.COLUMN1.CONTROLSOURCE='D10.F01'
	   THISFORM.GRID1.COLUMN2.CONTROLSOURCE='D10.F02'
	   THISFORM.GRID1.COLUMN3.CONTROLSOURCE='B01.F02'
	   THISFORM.GRID1.COLUMN4.CONTROLSOURCE='D10.F03'
	   THISFORM.GRID1.COLUMN5.CONTROLSOURCE='D10.F04'
	   THISFORM.GRID1.COLUMN6.CONTROLSOURCE='D10.F05'
       THISFORM.GRID1.READONLY=.T.       
       THISFORM.GRID1.SETFOCUS
       JK='採購單號'
  ENDPROC     
  PROC KEY_LIST.INIT 
       WITH THIS 
           .ADDITEM('依採購單號排列')   
           .ADDITEM('依料品編號排列')
           .ADDITEM('依進貨單號排列') 
       ENDWITH      
  ENDPROC 
  PROC KEY_LIST.INTERACTIVECHANGE  
  SELE D10               
       DO CASE
        CASE THIS.DISPLAYVALUE='依採購單號排列'      
           SET ORDER TO D101
	       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*85
	       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*200
	       THISFORM.GRID1.COLUMN3.WIDTH=INT_015*149
	       THISFORM.GRID1.COLUMN4.WIDTH=INT_015*75
	       THISFORM.GRID1.COLUMN5.WIDTH=INT_015*85
	       THISFORM.GRID1.COLUMN6.WIDTH=INT_015*85
	       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='採購單號'
		   THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='料    號'
		   THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='品名規格'	   
	  	   THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='交貨日期'
	  	   THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='進貨單號'
	  	   THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='數    量' 
		   THISFORM.GRID1.COLUMN1.CONTROLSOURCE='D10.F01'
		   THISFORM.GRID1.COLUMN2.CONTROLSOURCE='D10.F02'
		   THISFORM.GRID1.COLUMN3.CONTROLSOURCE='B01.F02'
		   THISFORM.GRID1.COLUMN4.CONTROLSOURCE='D10.F03'
		   THISFORM.GRID1.COLUMN5.CONTROLSOURCE='D10.F04'
		   THISFORM.GRID1.COLUMN6.CONTROLSOURCE='D10.F05' 
        CASE THIS.DISPLAYVALUE='依料品編號排列'     
           SET ORDER TO D102    
	       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*200
	       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*149
	       THISFORM.GRID1.COLUMN3.WIDTH=INT_015*85
	       THISFORM.GRID1.COLUMN4.WIDTH=INT_015*75
	       THISFORM.GRID1.COLUMN5.WIDTH=INT_015*85
	       THISFORM.GRID1.COLUMN6.WIDTH=INT_015*85 
	       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='料    號'
		   THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='品名規格'	 
	       THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='採購單號'
	  	   THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='交貨日期'
	  	   THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='進貨單號'
	  	   THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='數    量' 
	  	   THISFORM.GRID1.COLUMN1.CONTROLSOURCE='D10.F02'
		   THISFORM.GRID1.COLUMN2.CONTROLSOURCE='B01.F02'
		   THISFORM.GRID1.COLUMN3.CONTROLSOURCE='D10.F01'
		   THISFORM.GRID1.COLUMN4.CONTROLSOURCE='D10.F03'
		   THISFORM.GRID1.COLUMN5.CONTROLSOURCE='D10.F04'
		   THISFORM.GRID1.COLUMN6.CONTROLSOURCE='D10.F05'       
       CASE THIS.DISPLAYVALUE='依進貨單號排列'  
           SET ORDER TO D103 
           THISFORM.GRID1.COLUMN1.WIDTH=INT_015*85       
	       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*85
	       THISFORM.GRID1.COLUMN3.WIDTH=INT_015*200
	       THISFORM.GRID1.COLUMN4.WIDTH=INT_015*149
	       THISFORM.GRID1.COLUMN5.WIDTH=INT_015*75
	       THISFORM.GRID1.COLUMN6.WIDTH=INT_015*85
	       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='進貨單號'
	       THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='採購單號'
		   THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='料    號'
		   THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='品名規格'	   
	  	   THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='交貨日期'
	  	   THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='數    量' 
	  	   THISFORM.GRID1.COLUMN1.CONTROLSOURCE='D10.F04'
		   THISFORM.GRID1.COLUMN2.CONTROLSOURCE='D10.F01'
		   THISFORM.GRID1.COLUMN3.CONTROLSOURCE='D10.F02'
		   THISFORM.GRID1.COLUMN4.CONTROLSOURCE='B01.F02'
		   THISFORM.GRID1.COLUMN5.CONTROLSOURCE='D10.F03'
		   THISFORM.GRID1.COLUMN6.CONTROLSOURCE='D10.F05'                          
       ENDCASE 
        JK=THISFORM.GRID1.COLUMN1.HEADER1.CAPTION
       THISFORM.GRID1.REFRESH
       THISFORM.GRID1.SETFOCUS
  ENDPROC
*********************************                  
  PROC GRID1.AFTERROWCOLCHANGE
       LPARAMETERS NCOLINDEX
       THISFORM.REC_COUNT.CAPTION=STR(RECCOUNT('D10'))
       FCH=THISFORM.ACTIVECONTROL.NAME
       CHK=''
       THISFORM.REFRESH
  ENDPROC       
ENDDEFINE        
***********************************************列印程序
PROCEDURE PNT_PRC  
   FLG='0'
   SELE D10
   ANS_RANGE=CREATEOBJECT("ANS_RANGE")  
   ANS_RANGE.SHOW    
   IF FLG<>'1'
       =MESSAGEBOX('無此範圍資料',0+48,'警示')
   ENDIF   
   FLG='0'     
ENDPROC
***********************************************列印範圍選定
DEFINE CLASS ANS_RANGE AS FORM
  AUTOCENTER=.T.
  CAPTION='請輸入列印資料範圍'
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*190
  WIDTH=INT_015*480
  FONTSIZE=INT_015*9
  CONTROLBOX=.F.
  BORDERSTYLE=2
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WINDOWTYPE=1
  NAME='ANS_RANGE'
  ADD OBJECT LABEL1 AS LABEL WITH;
      AUTOSIZE=.T.,;
      HEIGHT=INT_015*25,;
      LEFT=INT_015*30,;
      TOP=INT_015*75,;
      NAME='LABEL1'
  ADD OBJECT LABEL2 AS LABEL WITH;
      AUTOSIZE=.T.,;
      HEIGHT=INT_015*25,;
      LEFT=INT_015*250,;
      TOP=INT_015*75,;
      NAME='LABEL2'
  ADD OBJECT TEXT1 AS TEXTBOX WITH;
      AUTOSIZE=.T.,;
      TOP=INT_015*70,;
      LEFT=INT_015*80,;
      HEIGHT=INT_015*25,; 
      NAME='TEXT1'
  ADD OBJECT TEXT2 AS TEXTBOX WITH;
      AUTOSIZE=.T.,;
      TOP=INT_015*70,;
      LEFT=INT_015*300,;
      HEIGHT=INT_015*25,;         
      NAME='TEXT2'    
  ADD OBJECT CMND1 AS COMMANDBUTTON WITH;
      AUTOSIZE=.T.,;
      LEFT=INT_015*120,;    
      HEIGHT=INT_015*25,;   
      TOP=INT_015*144,;  
      WIDTH=INT_015*80,;
      CAPTION='\<Y.執行',;
      TOOLTIPTEXT='確認所輸入的範圍鍵值!快速鍵->ALT+Y',;
      NAME='CMND1'
  ADD OBJECT CMND2 AS COMMANDBUTTON WITH;
      AUTOSIZE=.T.,;
      LEFT=INT_015*260,;
      TOP=INT_015*144,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*80,;
      CAPTION='\<C.取消',;
      TOOLTIPTEXT='取消作業!快速鍵->ALT+C',;
      NAME='CMND2'
 PROCEDURE INIT 
      THISFORM.SETALL('FONTSIZE',INT_015*9,'TEXTBOX')
      THISFORM.SETALL('FONTSIZE',INT_015*9,'LABEL')      
      THISFORM.SETALL('FONTSIZE',INT_015*9,'COMMANDBUTTON')            
      DO CASE                                 
         CASE KEY()='F01+F02'       
              THISFORM.LABEL1.CAPTION='起始單號'
              THISFORM.LABEL2.CAPTION='截止單號'
              THISFORM.TEXT1.WIDTH=INT_015*80
              THISFORM.TEXT2.WIDTH=INT_015*80              
              THISFORM.TEXT1.MAXLENGTH=10              
              THISFORM.TEXT2.MAXLENGTH=10                            
              THISFORM.TEXT1.VALUE=D10.F01
              THISFORM.TEXT2.VALUE=D10.F01   
         CASE KEY()='F02+F01'    
              THISFORM.LABEL1.CAPTION='起始料號'
              THISFORM.LABEL2.CAPTION='截止料號'
              THISFORM.LABEL1.LEFT=INT_015*30
              THISFORM.LABEL2.LEFT=INT_015*30
              THISFORM.LABEL1.TOP=INT_015*35
              THISFORM.LABEL2.TOP=INT_015*90
              THISFORM.TEXT1.WIDTH=INT_015*261
              THISFORM.TEXT2.WIDTH=INT_015*261
              THISFORM.TEXT1.LEFT=INT_015*80
              THISFORM.TEXT2.LEFT=INT_015*80
              THISFORM.TEXT1.TOP=INT_015*30
              THISFORM.TEXT2.TOP=INT_015*85
              THISFORM.TEXT1.MAXLENGTH=35              
              THISFORM.TEXT2.MAXLENGTH=35                            
              THISFORM.TEXT1.VALUE=D10.F02
              THISFORM.TEXT2.VALUE=D10.F02              
         CASE KEY()='F04+F02'   
              THISFORM.LABEL1.CAPTION='起始單號'
              THISFORM.LABEL2.CAPTION='截止單號'
              THISFORM.TEXT1.WIDTH=INT_015*80
              THISFORM.TEXT2.WIDTH=INT_015*80              
              THISFORM.TEXT1.MAXLENGTH=10              
              THISFORM.TEXT2.MAXLENGTH=10                            
              THISFORM.TEXT1.VALUE=D10.F04
              THISFORM.TEXT2.VALUE=D10.F04                                                         
      ENDCASE   
  ENDPROC
  ***********
 PROCEDURE CMND1.CLICK 
 DO CASE
      CASE KEY()='F01+F02'   
           SELECT * FROM D10 WHERE  F01>=THISFORM.TEXT1.VALUE AND F01<=THISFORM.TEXT2.VALUE  ORDER BY F01 NOWAIT
           IF _TALLY >0              
              REPORT FORM ALLTRIM(INT_116)+'B15A' PREVIEW 
*               REPORT FORM ALLTRIM(INT_116)+'B15A' TO PRINT PROMPT        
              FLG='1'
           ENDIF  
      CASE KEY()='F02+F01'   
           SELECT * FROM D10 WHERE F02>=THISFORM.TEXT1.VALUE AND F02<=THISFORM.TEXT2.VALUE  ORDER BY F02 NOWAIT
           IF _TALLY >0              
              REPORT FORM ALLTRIM(INT_116)+'B15B' PREVIEW 
*               REPORT FORM ALLTRIM(INT_116)+'B15B' TO PRINT PROMPT        
              FLG='1'
           ENDIF
       CASE KEY()='F04+F02'   
           SELECT * FROM D10 WHERE  F04>=THISFORM.TEXT1.VALUE AND F04<=THISFORM.TEXT2.VALUE  ORDER BY F04 NOWAIT
           IF _TALLY >0              
              REPORT FORM ALLTRIM(INT_116)+'B15C' PREVIEW 
*               REPORT FORM ALLTRIM(INT_116)+'B15C' TO PRINT PROMPT        
              FLG='1'
       	    ENDIF                                                   
       ENDCASE 
       THISFORM.RELEASE                         
  ENDPROC
***********************  
PROCEDURE CMND2.CLICK
  THISFORM.RELEASE
   FLG='1'
ENDPROC 
ENDDEFINE  