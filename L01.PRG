*L01 財產資料管理
SET EXCL OFF
CLOSE ALL
CLEAR 
AREA1='L01'
FLG='0'
FCH=''
CHK=''
EXBO=''
IF !USED('A01')
   SELE 0
   USE A01
ELSE 
   SELE A01
ENDIF
SET ORDER TO A01      
IF !USED('A02')
   SELE 0
   USE A02 INDE A02
ELSE
   SELE A02
ENDIF
SET ORDER TO A021      
SEEK sys_oper+'L01'
IF !USED('A0I')
   SELE 0
   USE A0I
ELSE
   SELE A0I
ENDIF
SET ORDER TO 1  
IF !USED('A14')
   SELE 0
   USE A14
ELSE
   SELE A14
ENDIF
SET ORDER TO 1
IF !USED('S50')
   SELE 0
   USE S50
ELSE
   SELE S50
ENDIF
SET ORDER TO 1
IF !USED('L00')
   SELE 0
   USE L00 INDE L00
ELSE
   SELE L00
ENDIF
SET ORDER TO L001
IF !USED('L01')
   SELE 0
   USE L01 INDE L01
ELSE
   SELE L01
ENDIF
SET ORDER TO L011
SET RELATION TO F04 INTO A14
SET RELATION TO F27 INTO L00 ADDI
SET RELATION TO F05 INTO S50 ADDI
L01form=createobject("tkL01")
L01form.show  
define class tkL01 as form
  caption='L01.財產資料管理'
*!*	  autocenter=.t.
  controlbox=.F.
  BORDERSTYLE=1  
  MAXBUTTON=.F.
  MINBUTTON=.F.
  MOVABLE=.F.
  CLOSABLE=.F.
  controlcount=57
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*550
  showtips=.t.
  showwindow=1
  WIDTH=INT_015*789
  windowtype=1
  add object shape1 as shape1 with;
      autocenter=.t.
  add object shape2 as shape2 with;
      autocenter=.t.
  add object shape3 as shape3 with;
      autocenter=.t.
  ADD OBJECT LBL_REC AS LBL_REC WITH;
      AUTOCENTER =.T.
  ADD OBJECT REC_COUNT AS REC_COUNT  with;
      caption=str(reccount())        
  ADD OBJECT LBLF01 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*27,;
      WIDTH=INT_015*50,;
      CAPTION='財產編號'
  ADD OBJECT TXTF01 AS TEXTBOX WITH;      
      LEFT=INT_015*295,;
      TOP=INT_015*23,;
      WIDTH=INT_015*110,;
      MAXLENGTH=15,;
      NAME='TXTF01'        
  ADD OBJECT LBLF02 AS LABEL WITH;      
      LEFT=INT_015*244,;
      TOP=INT_015*52,;
      WIDTH=INT_015*50,;
      CAPTION='規格說明'      
  ADD OBJECT TXTF02 AS TEXTBOX WITH;
      LEFT=INT_015*295,;
      TOP=INT_015*48,;
      WIDTH=INT_015*261,;
      HEIGHT=INT_015*25,;
      MAXLENGTH=60,;
      NAME='TXTF02'           
  ADD OBJECT LBLF04 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*77,;
      WIDTH=INT_015*50,;
      CAPTION='保管部門'
  ADD OBJECT LBLF041 AS LABEL WITH;
      LEFT=INT_015*342,;
      TOP=INT_015*77,;
      WIDTH=INT_015*50,;
      CAPTION=''      
  ADD OBJECT TXTF04 AS TEXTBOX WITH;      
      LEFT=INT_015*295,;
      TOP=INT_015*73,;
      WIDTH=INT_015*45,;
      MAXLENGTH=5,;
      NAME='TXTF04'               
  ADD OBJECT LBLF05 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*102,;
      WIDTH=INT_015*50,;
      MAXLENGTH=4,;
      CAPTION='保管人員'
  ADD OBJECT LBLF051 AS LABEL WITH;
      LEFT=INT_015*342,;
      TOP=INT_015*102,;
      WIDTH=INT_015*50,;
      CAPTION=''      
  ADD OBJECT TXTF05 AS TEXTBOX WITH;
      LEFT=INT_015*295,;
      TOP=INT_015*98,;
      WIDTH=INT_015*45,;
      MAXLENGTH=4,;
      NAME='TXTF05'           
  ADD OBJECT LBLF03 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*127,;
      WIDTH=INT_015*50,;
      CAPTION='取得日期'
  ADD OBJECT TXTF03 AS TEXTBOX WITH;
      LEFT=INT_015*295,;
      TOP=INT_015*123,;
      WIDTH=INT_015*75,;
      NAME='TXTF03'               
  ADD OBJECT LBLF06 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*152,;
      WIDTH=INT_015*50,;
      CAPTION='取得金額'         
  ADD OBJECT TXTF06 AS TEXTBOX WITH;
      LEFT=INT_015*295,;
      TOP=INT_015*148,;
      WIDTH=INT_015*100,;
      INPUTMASK='999999999.99',;
      NAME='TXTF06'                  
  ADD OBJECT LBLF07 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*177,;
      WIDTH=INT_015*50,;
      CAPTION='改良更換'         
  ADD OBJECT TXTF07 AS TEXTBOX WITH;
      LEFT=INT_015*295,;
      TOP=INT_015*173,;
      WIDTH=INT_015*100,;
      INPUTMASK='999999999.99',;
      NAME='TXTF07'                        
  ADD OBJECT LBLF27 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*202,;
      WIDTH=INT_015*50,;
      CAPTION='類別區分'
  ADD OBJECT LBLF271 AS LABEL WITH;
      LEFT=INT_015*355,;
      TOP=INT_015*202,;
      AUTOSIZE=.T.
  ADD OBJECT TXTF27 AS TEXTBOX WITH;
      LEFT=INT_015*295,;
      TOP=INT_015*198,;
      WIDTH=INT_015*50,;
      HEIGHT=INT_015*25,;
      MAXLENGTH=4,;
      NAME='TXTF27'                                 
  ADD OBJECT MT_TYPE AS COMBOBOX WITH;
      LEFT=INT_015*295,;
      TOP=INT_015*198,;
      WIDTH=INT_015*120,;
      FONTSIZE=INT_015*9,;
      HEIGHT=INT_015*25,;
      ROWSOURCETYPE=1,;
      SPECIALEFFECT=0,;
      STYLE=2,;
      NAME='MT_TYPE'           
  ADD OBJECT LBLF09 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*227,;
      WIDTH=INT_015*50,;
      CAPTION='是否攤提'         
  ADD OBJECT TXTF09 AS TEXTBOX WITH;
      LEFT=INT_015*295,;
      TOP=INT_015*223,;
      WIDTH=INT_015*20,;
      MAXLENGTH=1,;
      NAME='TXTF09'                  
  ADD OBJECT LBLRAT AS LABEL WITH;
      LEFT=INT_015*344,;
      TOP=INT_015*227,;
      WIDTH=INT_015*50,;
      CAPTION='月折舊率'         
  ADD OBJECT LBLRAT1 AS LABEL WITH;
      LEFT=INT_015*452,;
      TOP=INT_015*227,;
      WIDTH=INT_015*50,;
      CAPTION='%'               
  ADD OBJECT TXTRAT AS TEXTBOX WITH;
      LEFT=INT_015*395,;
      TOP=INT_015*223,;
      WIDTH=INT_015*55,;
      INPUTMASK='999.9999',;
      NAME='TXTRAT'                               
  ADD OBJECT LBLF10 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*252,;
      WIDTH=INT_015*50,;
      CAPTION='耐用月數'         
  ADD OBJECT TXTF10 AS TEXTBOX WITH;
      LEFT=INT_015*295,;
      TOP=INT_015*248,;
      WIDTH=INT_015*40,;
      INPUTMASK='999',;
      NAME='TXTF10'       
  ADD OBJECT LBLF13 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*277,;
      WIDTH=INT_015*50,;
      CAPTION='起始年月'      
  ADD OBJECT TXTF13 AS TEXTBOX WITH;
      LEFT=INT_015*295,;
      TOP=INT_015*273,;
      WIDTH=INT_015*60,;     
      INPUTMASK='####/##',;
      NAME='TXTF13'            
  ADD OBJECT LBLF14 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*302,;
      WIDTH=INT_015*50,;
      INPUTMASK='####/##',;
      CAPTION='截止年月'         
  ADD OBJECT TXTF14 AS TEXTBOX WITH;
      LEFT=INT_015*295,;
      TOP=INT_015*298,;
      WIDTH=INT_015*60,;
      INPUTMASK='9999/99'
      NAME='TXTF14'                      
  ADD OBJECT LBLF11 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*327,;
      WIDTH=INT_015*50,;
      CAPTION='攤提借方'         
 ADD OBJECT TXTF11 AS TEXTBOX WITH;
      LEFT=INT_015*295, ;
      TOP=INT_015*323, ;
      WIDTH=INT_015*65, ;
      MAXLENGTH=7,;
      NAME='TXTF11'            
  ADD OBJECT LBLF12 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*352,;
      WIDTH=INT_015*50,;
      CAPTION='攤提貸方'         
 ADD OBJECT TXTF12 AS TEXTBOX WITH;
      LEFT=INT_015*295, ;
      TOP=INT_015*348, ;
      WIDTH=INT_015*65, ;
      MAXLENGTH=7,;
      NAME='TXTF12'                        
  ADD OBJECT LBLF15 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*377,;
      WIDTH=INT_015*50,;
      CAPTION='備註一'              
  ADD OBJECT TXTF15 AS TEXTBOX WITH;
      LEFT=INT_015*295,;
      TOP=INT_015*373,;
      WIDTH=INT_015*300,;
      MAXLENGTH=40,;
      NAME='TXTF15'                                                                                                            
  ADD OBJECT LBLF16 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*402,;
      WIDTH=INT_015*50,;
      CAPTION='備註二'         
  ADD OBJECT TXTF16 AS TEXTBOX WITH;
      LEFT=INT_015*295,;
      TOP=INT_015*398,;
      WIDTH=INT_015*300,;
      MAXLENGTH=40,;
      NAME='TXTF16'                  
  ADD OBJECT LBLF08 AS LABEL WITH;
      LEFT=INT_015*498,;
      TOP=INT_015*102,;
      WIDTH=INT_015*50,;
      CAPTION='憑證單號'         
  ADD OBJECT TXTF08 AS TEXTBOX WITH;
      AUTOSIZE=.T.,;
      LEFT=INT_015*549,;
      TOP=INT_015*98,;
      WIDTH=INT_015*147,;
      MAXLENGTH=15,;
      NAME='TXTF08'      
  ADD OBJECT LBLF31 AS LABEL WITH;
      LEFT=INT_015*498,;
      TOP=INT_015*127,;
      WIDTH=INT_015*50,;
      CAPTION='目前狀況'
  ADD OBJECT TXTF31 AS TEXTBOX WITH;
      LEFT=INT_015*549,;
      TOP=INT_015*123,;
      WIDTH=INT_015*75,;
      MAXLENGTH=8,;
      NAME='TXTF31'               
  ADD OBJECT LBLF17 AS LABEL WITH;
      LEFT=INT_015*473,;
      TOP=INT_015*152,;
      WIDTH=INT_015*73,;
      CAPTION='每月取得攤提'        
  ADD OBJECT TXTF17 AS TEXTBOX WITH;
      LEFT=INT_015*549,;
      TOP=INT_015*148,;
      WIDTH=INT_015*100,;
      INPUTMASK='999999999.99',;
      NAME='TXTF17'                 
  ADD OBJECT LBLF18 AS LABEL WITH;
      LEFT=INT_015*473,;
      TOP=INT_015*177,;
      WIDTH=INT_015*73,;
      CAPTION='每月改良攤提'        
  ADD OBJECT TXTF18 AS TEXTBOX WITH;
      LEFT=INT_015*549,;
      TOP=INT_015*173,;
      WIDTH=INT_015*100,;
      INPUTMASK='999999999.99',;
      NAME='TXTF18'                       
  ADD OBJECT LBLF32 AS LABEL WITH;
      LEFT=INT_015*473,;
      TOP=INT_015*202,;
      WIDTH=INT_015*73,;
      CAPTION='累積折舊攤提'
  ADD OBJECT TXTF32 AS TEXTBOX WITH;
      LEFT=INT_015*549,;
      TOP=INT_015*198,;
      WIDTH=INT_015*100,;
      INPUTMASK='999999999.99',;
      NAME='TXTF32'            
  ADD OBJECT LBLF25 AS LABEL WITH;
      LEFT=INT_015*498,;
      TOP=INT_015*227,;
      WIDTH=INT_015*50,;
      CAPTION='目前殘值'
  ADD OBJECT TXTF25 AS TEXTBOX WITH;
      LEFT=INT_015*549,;
      TOP=INT_015*223,;
      WIDTH=INT_015*100,;
      INPUTMASK='999999999.99',;
      NAME='TXTF25'      
  ADD OBJECT LBLF26 AS LABEL WITH;
      LEFT=INT_015*498,;
      TOP=INT_015*252,;
      WIDTH=INT_015*100,;
      CAPTION='預留殘值'         
  ADD OBJECT TXTF26 AS TEXTBOX WITH;
      LEFT=INT_015*549,;
      TOP=INT_015*248,;
      WIDTH=INT_015*100,;
      INPUTMASK='999999999.99',;
      NAME='TXTF26'               
  ADD OBJECT LBLF19 AS LABEL WITH;
      LEFT=INT_015*498,;
      TOP=INT_015*277,;
      WIDTH=INT_015*50,;
      CAPTION='已攤年月'          
  ADD OBJECT TXTF19 AS TEXTBOX WITH;
      LEFT=INT_015*549,;
      TOP=INT_015*273,;
      WIDTH=INT_015*60,;
      INPUTMASK='####/##',;
      NAME='TXTF19'                                           
  ADD OBJECT LBLF20 AS LABEL WITH;
      LEFT=INT_015*498,;
      TOP=INT_015*302,;
      WIDTH=INT_015*50,;
      CAPTION='已攤月數'         
  ADD OBJECT TXTF20 AS TEXTBOX WITH;
      LEFT=INT_015*549,;
      TOP=INT_015*298,;
      WIDTH=INT_015*74,;
      INPUTMASK='999'
      NAME='TXTF20'             
  ADD OBJECT LBLF28 AS LABEL WITH;
      LEFT=INT_015*498,;
      TOP=INT_015*327,;
      WIDTH=INT_015*50,;
      CAPTION='下次校驗'         
 ADD OBJECT TXTF28 AS TEXTBOX WITH;
      LEFT=INT_015*549, ;
      TOP=INT_015*323, ;
      WIDTH=INT_015*65, ;
      MAXLENGTH=7,;
      NAME='TXTF28'                              
  ADD OBJECT LBLF33 AS LABEL WITH;
      LEFT=INT_015*498,;
      TOP=INT_015*352,;
      WIDTH=INT_015*50,;
      CAPTION='保險資料'         
 ADD OBJECT TXTF33 AS TEXTBOX WITH;
      LEFT=INT_015*549, ;
      TOP=INT_015*348, ;
      WIDTH=INT_015*120, ;
      MAXLENGTH=15,;
      NAME='TXTF33'                        
  ADD OBJECT LBLF23 AS LABEL WITH;
      LEFT=INT_015*498,;
      TOP=INT_015*430,;
      WIDTH=INT_015*50,;
      CAPTION='安全資料'   
  ADD OBJECT LBLF231 AS LABEL WITH;
      LEFT=INT_015*549,;
      TOP=INT_015*430,;
      WIDTH=INT_015*150,;
      MAXLENGTH=20,;
      NAME='LBLF231'                                         
  ADD OBJECT KEY_LIST AS KEY_LIST WITH;
      AUTOCENTER=.T.
  ADD OBJECT GRID1 AS GRID1 WITH;
      columncount=2,;            
      RECORDSOURCE='L01',;      
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2'
  ADD OBJECT CMDGROUP AS CMDGROUP WITH;
      AUTOSIZE=.T.              
  ADD OBJECT ORPGROUP AS ORPGROUP WITH;      
      AUTOSIZE=.T.              
  ADD OBJECT SHRGROUP AS SHRGROUP WITH;
      TOP=INT_015*455,;
      LEFT=INT_015*498           
  PROCEDURE INIT
       THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.)   &&判斷有無新增的權限
       THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  &&判斷有無修改的權限
       THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)   &&判斷有無刪除的權限
       THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限     
       THISFORM.MT_TYPE.VISIBLE=.F.
       THISFORM.SHRGROUP.VISIBLE=.F.
       THISFORM.SHRGROUP.ENABLED=.F.
       THISFORM.SETALL('HEIGHT',INT_015*25,'TEXTBOX')
       THISFORM.SETALL('HEIGHT',INT_015*17,'LABEL')
       THISFORM.SETALL('FONTSIZE',INT_015*9,'TEXTBOX')
       THISFORM.SETALL('FONTSIZE',INT_015*9,'LABEL')       
       THISFORM.SETALL('READONLY',.T.,'TEXTBOX')
       THISFORM.GRID1.BACKCOLOR=IIF(SEEK(SYS_OPER,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)       
       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*120
       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*120
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'COLUMN')
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'HEADER')         
       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='財產編號'
	   THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='規格說明'		   
	   THISFORM.GRID1.COLUMN1.CONTROLSOURCE='L01.F01'
	   THISFORM.GRID1.COLUMN2.CONTROLSOURCE='L01.F02'
       THISFORM.GRID1.READONLY=.T.       
       THISFORM.GRID1.SETFOCUS      
       JK='財產編號'
  ENDPROC     
  PROC KEY_LIST.INIT 
       WITH THIS 
           .ADDITEM('依財產編號排列')
           .ADDITEM('依部門編號排列')
           .ADDITEM('依保管人員排列')
           .ADDITEM('依類別區分排列')
           .ADDITEM('依憑證單號排列')                                            
       ENDWITH      
  ENDPROC 
  PROCEDURE KEY_LIST.INTERACTIVECHANGE
            SELECT L01
            DO CASE
               CASE THIS.VALUE=1
                    SET ORDER TO L011
                    THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='財產編號'
                    THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='規格說明'
    	            THISFORM.GRID1.COLUMN1.CONTROLSOURCE='L01.F01'
                    THISFORM.GRID1.COLUMN2.CONTROLSOURCE='L01.F02'     
                    THISFORM.GRID1.COLUMN1.WIDTH=INT_015*120
                    THISFORM.GRID1.COLUMN2.WIDTH=INT_015*120                                   
               CASE THIS.VALUE=2
                    SET ORDER TO L012
                    THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='部門編號'
                    THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='部門名稱'
    	            THISFORM.GRID1.COLUMN1.CONTROLSOURCE='L01.F04'
                    THISFORM.GRID1.COLUMN2.CONTROLSOURCE='A14.F02'     
                    THISFORM.GRID1.COLUMN1.WIDTH=INT_015*60
                    THISFORM.GRID1.COLUMN2.WIDTH=INT_015*80                             
               CASE THIS.VALUE=3
                     SET ORDER TO L013
                    THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='人員編號'
                    THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='人員名稱'
    	            THISFORM.GRID1.COLUMN1.CONTROLSOURCE='L01.F05'
                    THISFORM.GRID1.COLUMN2.CONTROLSOURCE='S50.F02'     
                    THISFORM.GRID1.COLUMN1.WIDTH=INT_015*50
                    THISFORM.GRID1.COLUMN2.WIDTH=INT_015*80                              
               CASE THIS.VALUE=4  
                     SET ORDER TO L014
                    THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='類別代號'
                    THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='類別說明'
    	            THISFORM.GRID1.COLUMN1.CONTROLSOURCE='L01.F27'
                    THISFORM.GRID1.COLUMN2.CONTROLSOURCE='L00.F04'     
                    THISFORM.GRID1.COLUMN1.WIDTH=INT_015*50
                    THISFORM.GRID1.COLUMN2.WIDTH=INT_015*80                               
               CASE THIS.VALUE=5      
                    SET ORDER TO L015    
                    THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='憑證單號'
                    THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='財產編號'
    	            THISFORM.GRID1.COLUMN1.CONTROLSOURCE='L01.F08'
                    THISFORM.GRID1.COLUMN2.CONTROLSOURCE='L01.F01'     
                    THISFORM.GRID1.COLUMN1.WIDTH=INT_015*120
                    THISFORM.GRID1.COLUMN2.WIDTH=INT_015*120                             
            ENDCASE                    
                    THISFORM.GRID1.REFRESH
                    THISFORM.GRID1.SETFOCUS                 
                           
  ENDPROC
  PROC GRID1.AFTERROWCOLCHANGE
       LPARAMETERS nColIndex
       THISFORM.TXTF01.VALUE=L01.F01
       THISFORM.TXTF02.VALUE=L01.F02
       THISFORM.TXTF03.VALUE=L01.F03
       THISFORM.TXTF04.VALUE=L01.F04
       THISFORM.TXTF05.VALUE=L01.F05
       THISFORM.TXTF06.VALUE=L01.F06
       THISFORM.TXTF07.VALUE=L01.F07
       THISFORM.TXTF08.VALUE=L01.F08
       THISFORM.TXTF09.VALUE=L01.F09
       THISFORM.TXTF10.VALUE=L01.F10
       THISFORM.TXTF11.VALUE=L01.F11
       THISFORM.TXTF12.VALUE=L01.F12       
       THISFORM.TXTF13.VALUE=L01.F13
       THISFORM.TXTF14.VALUE=L01.F14
       THISFORM.TXTF15.VALUE=L01.F15
       THISFORM.TXTF16.VALUE=L01.F16
       THISFORM.TXTF17.VALUE=L01.F17
       THISFORM.TXTF18.VALUE=L01.F18       
       THISFORM.TXTF19.VALUE=L01.F19
       THISFORM.TXTF20.VALUE=L01.F20
       THISFORM.TXTF25.VALUE=L01.F25
       THISFORM.TXTF26.VALUE=L01.F26              
       THISFORM.TXTF27.VALUE=L01.F27
       THISFORM.TXTF28.VALUE=L01.F28
       THISFORM.TXTF31.VALUE=L01.F31
       THISFORM.TXTF32.VALUE=L01.F32
       THISFORM.TXTF33.VALUE=L01.F33       
       THISFORM.TXTRAT.VALUE=ROUND(THISFORM.TXTF17.VALUE/THISFORM.TXTF06.VALUE*100,4)
       THISFORM.LBLF041.CAPTION=A14.F02
       THISFORM.LBLF051.CAPTION=S50.F02
       THISFORM.LBLF231.CAPTION=L01.F23 
       THISFORM.MT_TYPE.VALUE=VAL(L01.F27)
       THISFORM.LBLF271.CAPTION=L00.F04
       FCH=THISFORM.ACTIVECONTROL.NAME
       CHK=''
       thisform.refresh
  ENDPROC       
  PROCEDURE MT_TYPE.INIT
           SELECT L00
           GO TOP
           DO WHILE !EOF()
                THIS.ADDITEM(L00.F01+SPACE(2)+L00.F04)
               SKIP
           ENDDO
  ENDPROC
  PROCEDURE MT_TYPE.INTERACTIVECHANGE
            THISFORM.TXTF27.VALUE=LEFT(THIS.DISPLAYVALUE,4)
            THISFORM.TXTF26.VALUE=THISFORM.TXTF06.VALUE*IIF(SEEK(LEFT(THIS.DISPLAYVALUE,4),'L00'),L00.F02/100,0)+L01.F30
            THISFORM.TXTF10.VALUE=IIF(SEEK(LEFT(THIS.DISPLAYVALUE,4),'L00'),L00.F05*12+L00.F06,1)             
             THISFORM.TXTF17.VALUE=(THISFORM.TXTF06.VALUE-THISFORM.TXTF26.VALUE)/THISFORM.TXTF10.VALUE
             THISFORM.TXTRAT.VALUE=100*THISFORM.TXTF17.VALUE/THISFORM.TXTF06.VALUE
             THISFORM.TXTF32.VALUE=THISFORM.TXTF17.VALUE*THISFORM.TXTF20.VALUE+(L01.F07-L01.F29)
             THISFORM.TXTF25.VALUE=(THISFORM.TXTF06.VALUE-THISFORM.TXTF17.VALUE*THISFORM.TXTF20.VALUE)+L01.F29
             THISFORM.TXTF10.INTERACTIVECHANGE          
  ENDPROC
  PROCEDURE TXTF04.INTERACTIVECHANGE
    IF AT('?',ALLTRIM(THIS.VALUE))<>0
       IF AT('?',ALLTRIM(THIS.VALUE))>1             
          SELECT F01,F02 FROM A14 INTO CURSOR DEPART ORDER BY F01 WHERE LEFT(F01,AT('?',THIS.VALUE)-1)=LEFT(THIS.VALUE,AT('?',THIS.VALUE)-1) 
       ELSE
          SELECT F01,F02 FROM A14 INTO CURSOR DEPART ORDER BY F01
       ENDIF   
       DEPART_SEEK=CREATEOBJECT("DEPART_SEEK")  
       DEPART_SEEK.SHOW    
       THIS.VALUE=FLG
       THIS.REFRESH
       FLG='0'
    ENDIF   
       THISFORM.LBLF041.CAPTION=IIF(SEEK(THIS.VALUE,'A14'),A14.F02,'')  
  ENDPROC
  PROCEDURE TXTF05.INTERACTIVECHANGE
    IF AT('?',ALLTRIM(THIS.VALUE))<>0
       IF AT('?',ALLTRIM(THIS.VALUE))>1             
          SELECT F01AS F01 ,F02 AS F03 FROM S50 INTO CURSOR MAN ORDER BY F01 WHERE  LEFT(F01,AT('?',THIS.VALUE)-1)=LEFT(THIS.VALUE,AT('?',THIS.VALUE)-1)
       ELSE
          SELECT F01 AS F01 ,F02 AS F03  FROM S50 INTO CURSOR MAN ORDER BY F01 
       ENDIF   
       MAN_SEEK=CREATEOBJECT("MAN_SEEK")  
       MAN_SEEK.SHOW    
       THIS.VALUE=FLG
       THIS.REFRESH
       FLG='0'
    ENDIF   
       THISFORM.LBLF051.CAPTION=IIF(SEEK(THIS.VALUE,'S50'),S50.F02,'')  
  ENDPROC  
  PROCEDURE TXTF06.INTERACTIVECHANGE
       THISFORM.TXTF17.VALUE=THIS.VALUE*THISFORM.TXTRAT.VALUE/100
       THISFORM.TXTF25.VALUE=THIS.VALUE-THISFORM.TXTF17.VALUE*(VAL(LEFT(THISFORM.TXTF19.VALUE,4))*12+VAL(RIGHT(THISFORM.TXTF19.VALUE,2))-VAL(LEFT(THISFORM.TXTF13.VALUE,4))*12-VAL(RIGHT(THISFORM.TXTF13.VALUE,2)))+L01.F29
       THISFORM.TXTF26.VALUE=THIS.VALUE-THISFORM.TXTF17.VALUE*THISFORM.TXTF10.VALUE+L01.F30
       THISFORM.TXTF32.VALUE=THISFORM.TXTF17.VALUE*(VAL(LEFT(THISFORM.TXTF19.VALUE,4))*12+VAL(RIGHT(THISFORM.TXTF19.VALUE,2))-VAL(LEFT(THISFORM.TXTF13.VALUE,4))*12-VAL(RIGHT(THISFORM.TXTF13.VALUE,2)))+(L01.F07-L01.F29)
  ENDPROC
  PROCEDURE TXTRAT.INTERACTIVECHANGE
       THISFORM.TXTF17.VALUE=ROUND(THISFORM.TXTF06.VALUE*THIS.VALUE/100,4)
       THISFORM.TXTF17.INTERACTIVECHANGE
  ENDPROC
  PROCEDURE  TXTF10.INTERACTIVECHANGE
       X=VAL(RIGHT(THISFORM.TXTF13.VALUE,2))+THIS.VALUE
       Y=PADL(ALLTRIM(STR(VAL(LEFT(THISFORM.TXTF13.VALUE,4))+INT(X/12))),4,'0')
       Z=PADL(ALLTRIM(STR(IIF(X%12=0,12,X%12))),2,'0')
       THISFORM.TXTF14.VALUE=TRANSFORM(Y+Z,'@R ####/##')
       THISFORM.TXTF06.INTERACTIVECHANGE
  ENDPROC
    PROCEDURE TXTF13.INTERACTIVECHANGE
          THISFORM.TXTF20.VALUE=VAL(LEFT(thisform.txtf19.value,4))*12+VAL(RIGHT(THISFORM.TXTF19.VALUE,2))-VAL(LEFT(THIS.VALUE,4))*12-VAL(RIGHT(THIS.VALUE,2))    
          THISFORM.TXTF10.INTERACTIVECHANGE
  ENDPROC
  PROCEDURE TXTF14.INTERACTIVECHANGE
          THISFORM.TXTF10.VALUE=VAL(LEFT(THIS.VALUE,4))*12+VAL(RIGHT(THIS.VALUE,2))-VAL(LEFT(THISFORM.TXTF13.VALUE,4))*12-VAL(RIGHT(THISFORM.TXTF13.VALUE,2))
          THISFORM.TXTF10.INTERACTIVECHANGE
  ENDPROC
  PROCEDURE TXTF17.INTERACTIVECHANGE
            THISFORM.TXTRAT.VALUE=100*THIS.VALUE/THISFORM.TXTF06.VALUE
            THISFORM.TXTF06.INTERACTIVECHANGE         
  ENDPROC
  PROCEDURE TXTF26.INTERACTIVECHANGE
           THISFORM.TXTF17.VALUE=(THISFORM.TXTF06.VALUE-THIS.VALUE)/THISFORM.TXTF10.VALUE
           THISFORM.TXTRAT.VALUE=100*THISFORM.TXTF17.VALUE/THISFORM.TXTF06.VALUE
           THISFORM.TXTF32.VALUE=THISFORM.TXTF17.VALUE*THISFORM.TXTF20.VALUE+(L01.F07-L01.F29)           
           THISFORM.TXTF25.VALUE=THISFORM.TXTF06.VALUE-THISFORM.TXTF17.VALUE*THISFORM.TXTF20.VALUE+L01.F29
  ENDPROC
  PROCEDURE TXTF19.INTERACTIVECHANGE
            THISFORM.TXTF20.VALUE=VAL(LEFT(THIS.VALUE,4))*12+VAL(RIGHT(THIS.VALUE,2))-VAL(LEFT(THISFORM.TXTF13.VALUE,4))*12-VAL(RIGHT(THISFORM.TXTF13.VALUE,2))
            THISFORM.TXTF32.VALUE=THISFORM.TXTF17.VALUE*THISFORM.TXTF20.VALUE+(L01.F07-L01.F29)
            THISFORM.TXTF25.VALUE=THISFORM.TXTF06.VALUE-THISFORM.TXTF17.VALUE*THISFORM.TXTF20.VALUE+L01.F29
  ENDPROC
  PROCEDURE TXTF20.INTERACTIVECHANGE
            X=VAL(RIGHT(THISFORM.TXTF13.VALUE,2))+THIS.VALUE
            Y=PADL(ALLTRIM(STR(VAL(LEFT(THISFORM.TXTF13.VALUE,4))+INT(X/12))),4,'0')
            Z=PADL(ALLTRIM(STR(IIF(X%12=0,12,X%12))),2,'0')
            THISFORM.TXTF19.VALUE=TRANSFORM(Y+Z,'@R ####/##')
            THISFORM.TXTF32.VALUE=THISFORM.TXTF17.VALUE*THIS.VALUE+(L01.F07-L01.F29)
            THISFORM.TXTF25.VALUE=THISFORM.TXTF06.VALUE-THISFORM.TXTF17.VALUE*THIS.VALUE+L01.F29           
  ENDPROC
  PROCEDURE TXTF09.VALID
    LPARAMETERS  NINDEX
    IF ALLTRIM(THIS.VALUE)='Y' .OR. ALLTRIM(THIS.VALUE)='N'
       NINDEX=.T.
    ELSE
       =MESSAGEBOX("請輸入'Y'代表每月攤提折舊','N'則代表無須攤提!",0+64,"提示視窗")    
       NINDEX=.F.
    ENDIF
    RETURN NINDEX
  ENDPROC            
  PROCEDURE TXTF13.VALID
    LPARAMETERS  NINDEX
    IF VAL(RIGHT(ALLTRIM(THIS.VALUE),2))<=12 AND VAL(RIGHT(ALLTRIM(THIS.VALUE),2))>0 AND VAL(LEFT(ALLTRIM(THIS.VALUE),4))>0
       NINDEX=.T.
    ELSE
       =MESSAGEBOX("無此月份",0+48,"提示視窗")    
       NINDEX=.F.
    ENDIF
    RETURN NINDEX
  ENDPROC              
  PROCEDURE TXTF14.VALID
    LPARAMETERS  NINDEX
    IF VAL(RIGHT(ALLTRIM(THIS.VALUE),2))<=12 AND VAL(RIGHT(ALLTRIM(THIS.VALUE),2))>0 AND VAL(LEFT(ALLTRIM(THIS.VALUE),4))>0
       NINDEX=.T.
    ELSE
       =MESSAGEBOX("無此月份",0+48,"提示視窗")    
       NINDEX=.F.
    ENDIF
    RETURN NINDEX
  ENDPROC                
  PROCEDURE TXTF19.VALID
    LPARAMETERS  NINDEX
    IF VAL(RIGHT(ALLTRIM(THIS.VALUE),2))<=12 AND VAL(RIGHT(ALLTRIM(THIS.VALUE),2))>0 AND VAL(LEFT(ALLTRIM(THIS.VALUE),4))>0
       NINDEX=.T.
    ELSE
       =MESSAGEBOX("無此月份",0+48,"提示視窗")    
       NINDEX=.F.
    ENDIF
    RETURN NINDEX
  ENDPROC                  
  PROCEDURE ORPGROUP.NEW_BOTT.CLICK 
    THISFORM.SETALL('READONLY',.F.,'TEXTBOX')    
    THISFORM.TXTF07.READONLY=.T.
    THISFORM.TXTF18.READONLY=.T.
    THISFORM.TXTF01.VALUE=''
    THISFORM.TXTF02.VALUE=''
    THISFORM.TXTF03.VALUE=DATE()
    THISFORM.TXTF04.VALUE=''
    THISFORM.TXTF05.VALUE=''
    THISFORM.TXTF06.VALUE=0
    THISFORM.TXTF07.VALUE=0
    THISFORM.TXTF08.VALUE=''
    THISFORM.TXTF09.VALUE='Y'
    THISFORM.TXTF10.VALUE=1
    THISFORM.TXTF11.VALUE=''
    THISFORM.TXTF12.VALUE=''
    THISFORM.TXTF13.VALUE=IIF(INT_012=2,TRANSFORM(LEFT(DTOS(DATE()),6),'@R ####/##'),TRANSFORM(PADL(ALLTRIM(STR(YEAR(DATE())-1911)),4,'0')+SUBSTR(DTOS(DATE()),5,2),'@R ####/##'))
    THISFORM.TXTF14.VALUE=''
    THISFORM.TXTF15.VALUE=''
    THISFORM.TXTF16.VALUE=''
    THISFORM.TXTF17.VALUE=0
    THISFORM.TXTF18.VALUE=0
    THISFORM.TXTF19.VALUE=THISFORM.TXTF13.VALUE
    THISFORM.TXTF20.VALUE=0    
    THISFORM.TXTF25.VALUE=0
    THISFORM.TXTF26.VALUE=0    
    THISFORM.TXTF27.VALUE=''
    THISFORM.LBLF041.CAPTION=''    
    THISFORM.LBLF051.CAPTION=''        
    THISFORM.LBLF231.CAPTION=''
    THISFORM.TXTF31.VALUE=''    
    THISFORM.TXTF28.VALUE=CTOD('')
    THISFORM.TXTRAT.VALUE=0
    THISFORM.TXTF01.SETFOCUS
    THISFORM.MT_TYPE.VISIBLE=.T.        
    THISFORM.GRID1.ENABLED=.F.
    FLG='1'
  ENDPROC  
  PROCEDURE ORPGROUP.EDIT_BOTT.CLICK    
     THISFORM.TXTF01.READONLY=.T.
     THISFORM.TXTF07.READONLY=.T.
     THISFORM.TXTF18.READONLY=.T.     
     THISFORM.GRID1.ENABLED=.F.
     THISFORM.MT_TYPE.VISIBLE=.T.     
     THISFORM.MT_TYPE.DISPLAYVALUE=THISFORM.TXTF27.VALUE+SPACE(2)+L00.F04
     THISFORM.TXTF03.SETFOCUS
     SELECT L01
     LOCK()
     IF !RLOCK()
        DO file_impact
        THISFORM.SHRGROUP.ABANDON_BOTT.CLICK                    
*        return
     endif
  endproc 
  PROCEDURE ORPGROUP.DEL_BOTT.CLICK
     if messagebox('是否確定要刪除此筆資料',4+32+256,'請確認') = 6	      
        SELE L01
        LOCK()
        IF RLOCK()
           IF !USED('L02')
              SELECT 0
              USE L02
           ELSE
             SELECT L02
           ENDIF
           SET ORDER TO 1      
                PO_NO=L01.F01
                SELE RECNO() FROM L02 WHERE L02.F01=PO_NO  INTO ARRAY BK1              
                JJ1=''                
                IF _TALLY>0   
                   FOR I= 1 TO ALEN(BK1)
                       JJ1=JJ1+ALLTRIM(STR(BK1(I)))+','
                   ENDFOR    
                   KK1=STUFF(JJ1,RAT(',',JJ1,1),1,'')              
                   RLOCK(KK1,'L02')
                   LL1=RLOCK(KK1,'L02')
                ELSE
                   LL1=.T.   
                ENDIF   
                IF LL1=.T.
                   DELETE FROM L02 WHERE L02.F01=PO_NO
                   SELECT L02
                   USE
                ELSE
                   =MESSAGEBOX('檔案鎖住請稍後再執行此程式',0+48,'提示訊息視窗')
                   UNLOCK ALL
                   RETURN   
                ENDIF       
            SELE L01
            DELE
            unlock
            SKIP -1
            IF BOF()
               GO TOP
            ENDIF  
            THISFORM.GRID1.SETFOCUS
            IF THISFORM.GRID1.ACTIVEROW=0
               THISFORM.SETALL('VALUE','','TEXTBOX')
               THISFORM.LBLF231.CAPTION=''
               THISFORM.CMDGROUP.ENABLED=.F.
            ELSE
               THISFORM.CMDGROUP.ENABLED=.T.            
               THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  &&判斷有無修改的權限
               THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)   &&判斷有無刪除的權限
               THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限   
            ENDIF 
        ELSE
           DO file_impact    
        ENDIF       
     ENDIF        
  ENDPROC     
  PROCEDURE SHRGROUP.SHURE1_BOTT.CLICK
    SELE L01
    SET ORDER TO L011    
    COD=SYS(21)
    IF EMPTY(THISFORM.TXTF01.VALUE)
       =MESSAGEBOX('財產編號不得空白!',0+48,'提示訊息視窗')
       SET ORDER TO &COD       
       THISFORM.TXTF01.SETFOCUS
       RETURN
    ENDIF     
    seek ALLTRIM(THISFORM.TXTF01.VALUE)
    if found()
       =messagebox('財產編號重複!',0+64,'提示視窗')
       SET ORDER TO &COD
       THISFORM.TXTF01.SETFOCUS
       RETURN
    ENDIF    
    IF EMPTY(THISFORM.TXTF02.VALUE) 
       =MESSAGEBOX('規格說明不得空白',0+48,'提示視窗')  
       SET ORDER TO &COD 
       THISFORM.TXTF02.SETFOCUS
       RETURN
    ENDIF   
    IF SEEK(THISFORM.TXTF04.VALUE,'A14')=.F.
       =MESSAGEBOX('A09部門設定資料無此部門編號!',0+48,'提示訊息視窗!')
       SET ORDER TO &COD 
       THISFORM.TXTF04.SETFOCUS
       RETURN
    ENDIF
    IF SEEK(THISFORM.TXTF05.VALUE,'S50')=.F.
       =MESSAGEBOX('S50人事基本資料無此編號!',0+48,'提示訊息視窗!')
       SET ORDER TO &COD 
       THISFORM.TXTF05.SETFOCUS
       RETURN
    ENDIF    
    IF THISFORM.TXTF06.VALUE<=0
       =MESSAGEBOX('取得金額不得小於等於 0 ',0+48,'提視訊息視窗!')
       SET ORDER TO &COD 
       THISFORM.TXTF06.SETFOCUS
       RETURN              
    ENDIF
    IF THISFORM.TXTRAT.VALUE<=0
       =MESSAGEBOX('月折舊率不得小於等於 0 ',0+48,'提視訊息視窗!')
       SET ORDER TO &COD 
       THISFORM.TXTRAT.SETFOCUS
       RETURN              
    ENDIF        
    IF EMPTY(THISFORM.TXTF27.VALUE)
       =MESSAGEBOX('請選擇類別!',0+48,'提示訊息視窗!')
       SET ORDER TO &COD
       THISFORM.MT_TYPE.SETFOCUS
       RETURN
    ENDIF
    IF THISFORM.TXTF10.VALUE<=0
       =MESSAGEBOX('耐用月數不得小於等於 0 ',0+48,'提示訊息視窗!')
       SET ORDER TO &COD
       THISFORM.TXTF10.SETFOCUS
       RETURN
    ENDIF
    IF EMPTY(THISFORM.TXTF08.VALUE)
       =MESSAGEBOX('憑證編號不得空白!',0+48,'提示訊息視窗!')
       SET ORDER TO &COD
       THISFORM.TXTF08.SETFOCUS       
       RETURN
    ENDIF
    IF SEEK(THISFORM.TXTF08.VALUE,'L01','L015')
       =MESSAGEBOX('憑證編號重覆!',0+48,'提示訊息視窗!')
       SET ORDER TO &COD
       THISFORM.TXTF08.SETFOCUS       
       RETURN
    ENDIF    
    IF THISFORM.TXTF14.VALUE<THISFORM.TXTF13.VALUE
       =MESSAGEBOX('截止日期不可能小於起始日期!',0+48,'提示訊息視窗!')
       SET ORDER TO &COD
       THISFORM.TXTF14.SETFOCUS
       RETURN
    ENDIF
    IF THISFORM.TXTF20.VALUE>THISFORM.TXTF10.VALUE
       =MESSAGEBOX('已攤月數不可能大於耐用月數!',0+48,'提示訊息視窗!')
       SET ORDER TO &COD
       THISFORM.TXTF20.SETFOCUS              
    ENDIF
    APPEND BLANK
    LOCK()
    IF RLOCK()
        REPLACE F01 WITH THISFORM.TXTF01.VALUE
        REPLACE F02 WITH THISFORM.TXTF02.VALUE
        REPLACE F03 WITH THISFORM.TXTF03.VALUE
        REPLACE F04 WITH THISFORM.TXTF04.VALUE
        REPLACE F05 WITH THISFORM.TXTF05.VALUE
        REPLACE F06 WITH THISFORM.TXTF06.VALUE
        REPLACE F08 WITH THISFORM.TXTF08.VALUE
        REPLACE F09 WITH THISFORM.TXTF09.VALUE
        REPLACE F10 WITH THISFORM.TXTF10.VALUE
        REPLACE F11 WITH THISFORM.TXTF11.VALUE
       REPLACE F12 WITH THISFORM.TXTF12.VALUE
       REPLACE F13 WITH THISFORM.TXTF13.VALUE
       REPLACE F14 WITH THISFORM.TXTF14.VALUE       
       REPLACE F15 WITH THISFORM.TXTF15.VALUE
       REPLACE F16 WITH THISFORM.TXTF16.VALUE
       REPLACE F17 WITH THISFORM.TXTF17.VALUE
       REPLACE F19 WITH THISFORM.TXTF19.VALUE    
       REPLACE F20 WITH THISFORM.TXTF20.VALUE   
       REPLACE F21 WITH THISFORM.TXTF25.VALUE-L01.F29
       REPLACE F22 WITH THISFORM.TXTF26.VALUE-L01.F30
       REPLACE F23 WITH IIF(INT_012=1,PADL(ALLTRIM(STR(YEAR(DATE())-1911)),3,' ')+RIGHT(DTOC(DATE()),6),dtoc(DATE())+' ')+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
       REPLACE F25 WITH THISFORM.TXTF25.VALUE
       REPLACE F26 WITH THISFORM.TXTF26.VALUE
       REPLACE F27 WITH THISFORM.TXTF27.VALUE
       REPLACE F28 WITH THISFORM.TXTF28.VALUE    
       REPLACE F31 WITH THISFORM.TXTF31.VALUE           
       REPLACE F32 WITH THISFORM.TXTF32.VALUE           
       REPLACE F33 WITH THISFORM.TXTF33.VALUE           
    ENDIF
    UNLOCK    
    SET ORDER TO &COD  
    THISFORM.REC_COUNT.CAPTION=STR(RECCOUNT())
    THISFORM.GRID1.ENABLED=.T.
    THISFORM.REFRESH
    THISFORM.GRID1.SETFOCUS    
    THISFORM.ORPGROUP.NEW_BOTT.CLICK            
  ENDPROC
  PROCEDURE SHRGROUP.SHURE2_BOTT.CLICK
    IF EMPTY(THISFORM.TXTF02.VALUE) 
       =MESSAGEBOX('規格說明不得空白',0+48,'提示視窗')  
       THISFORM.TXTF02.SETFOCUS
       RETURN
    ENDIF   
    IF SEEK(THISFORM.TXTF04.VALUE,'A14')=.F.
       =MESSAGEBOX('A09部門設定資料無此部門編號!',0+48,'提示訊息視窗!')
       THISFORM.TXTF04.SETFOCUS
       RETURN
    ENDIF
    IF SEEK(THISFORM.TXTF05.VALUE,'S50')=.F.
       =MESSAGEBOX('S50人事基本資料無此編號!',0+48,'提示訊息視窗!')
       THISFORM.TXTF05.SETFOCUS
       RETURN
    ENDIF    
    IF THISFORM.TXTF06.VALUE<=0
       =MESSAGEBOX('取得金額不得小於等於 0 ',0+48,'提視訊息視窗!')
       THISFORM.TXTF06.SETFOCUS
       RETURN              
    ENDIF
    IF THISFORM.TXTRAT.VALUE<=0
       =MESSAGEBOX('月折舊率不得小於等於 0 ',0+48,'提視訊息視窗!')
       THISFORM.TXTRAT.SETFOCUS
       RETURN              
    ENDIF        
    IF EMPTY(THISFORM.TXTF27.VALUE)
       =MESSAGEBOX('請選擇類別!',0+48,'提示訊息視窗!')
       THISFORM.MT_TYPE.SETFOCUS
       RETURN
    ENDIF
    IF THISFORM.TXTF10.VALUE<=0
       =MESSAGEBOX('耐用月數不得小於等於 0 ',0+48,'提示訊息視窗!')
       THISFORM.TXTF10.SETFOCUS
       RETURN
    ENDIF
    IF EMPTY(THISFORM.TXTF08.VALUE)
       =MESSAGEBOX('憑證編號不得空白!',0+48,'提示訊息視窗!')
       THISFORM.TXTF08.SETFOCUS       
       RETURN
    ENDIF
    IF THISFORM.TXTF14.VALUE<THISFORM.TXTF13.VALUE
       =MESSAGEBOX('截止日期不可能小於起始日期!',0+48,'提示訊息視窗!')
       THISFORM.TXTF14.SETFOCUS
       RETURN
    ENDIF
    IF THISFORM.TXTF20.VALUE>THISFORM.TXTF10.VALUE
       =MESSAGEBOX('已攤月數不可能大於耐用月數!',0+48,'提示訊息視窗!')
       THISFORM.TXTF20.SETFOCUS              
    ENDIF
    SELE L01
    IF RLOCK()
       REPLACE F01 WITH THISFORM.TXTF01.VALUE
       REPLACE F02 WITH THISFORM.TXTF02.VALUE
       REPLACE F03 WITH THISFORM.TXTF03.VALUE
       REPLACE F04 WITH THISFORM.TXTF04.VALUE
       REPLACE F05 WITH THISFORM.TXTF05.VALUE
       REPLACE F06 WITH THISFORM.TXTF06.VALUE
       REPLACE F08 WITH THISFORM.TXTF08.VALUE
       REPLACE F09 WITH THISFORM.TXTF09.VALUE
       REPLACE F10 WITH THISFORM.TXTF10.VALUE
       REPLACE F11 WITH THISFORM.TXTF11.VALUE
       REPLACE F12 WITH THISFORM.TXTF12.VALUE
       REPLACE F13 WITH THISFORM.TXTF13.VALUE
       REPLACE F14 WITH THISFORM.TXTF14.VALUE       
       REPLACE F15 WITH THISFORM.TXTF15.VALUE
       REPLACE F16 WITH THISFORM.TXTF16.VALUE
       REPLACE F17 WITH THISFORM.TXTF17.VALUE       
       REPLACE F19 WITH THISFORM.TXTF19.VALUE
       REPLACE F20 WITH THISFORM.TXTF20.VALUE      
       REPLACE F21 WITH THISFORM.TXTF25.VALUE-L01.F29
       REPLACE F22 WITH THISFORM.TXTF26.VALUE-L01.F30       
       REPLACE F23 WITH IIF(INT_012=1,PADL(ALLTRIM(STR(YEAR(DATE())-1911)),3,' ')+RIGHT(DTOC(DATE()),6),dtoc(DATE())+' ')+IIF(SEEK(sys_oper,'A01'),A01.F03,'')    
       REPLACE F25 WITH THISFORM.TXTF25.VALUE          
       REPLACE F26 WITH THISFORM.TXTF26.VALUE       
       REPLACE F27 WITH THISFORM.TXTF27.VALUE          
       REPLACE F28 WITH THISFORM.TXTF28.VALUE
       REPLACE F31 WITH THISFORM.TXTF31.VALUE       
       REPLACE F32 WITH THISFORM.TXTF32.VALUE
       REPLACE F33 WITH THISFORM.TXTF33.VALUE       
    ELSE
      DO file_impact
      return   
    ENDIF   
    THISFORM.SHRGROUP.ABANDON_BOTT.CLICK    
  ENDPROC   
  procedure SHRGROUP.ABANDON_BOTT.CLICK
      THISFORM.SHRGROUP.ENABLED=.F.
      THISFORM.SHRGROUP.VISIBLE=.F.      
      THISFORM.ORPGROUP.ENABLED=.T.
      THISFORM.MT_TYPE.VISIBLE=.F.      
      THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.)   &&判斷有無新增的權限
      THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  &&判斷有無修改的權限
      THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)   &&判斷有無刪除的權限
      THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限      
      THISFORM.ORPGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
      THISFORM.CMDGROUP.ENABLED=.T.
      THISFORM.CMDGROUP.SETALL('ENABLED',.T.,'COMMANDBUTTON')
      THISFORM.CMDGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
      THISFORM.KEY_LIST.ENABLED=.T.      
      THISFORM.SETALL('READONLY',.T.,'TEXTBOX')  
      UNLOCK ALL 
      SELE L01
      THISFORM.GRID1.ENABLED=.T.
      THISFORM.GRID1.SETFOCUS    
  ENDPROC
  PROCEDURE SHRGROUP.FINISH_BOTT.CLICK

       SELE L01
       THISFORM.SHRGROUP.ABANDON_BOTT.CLICK
  ENDPROC     
ENDDEFINE      
**************************************列印程序 
PROC PNT_PRC
   SELECT L01
   PO_NO=L01.F01
   ANS_RANGE=CREATEOBJECT("ANS_RANGE")  
   ANS_RANGE.SHOW         
ENDPROC
***********************************************列印範圍選定
DEFINE CLASS ANS_RANGE AS FORM
  AUTOCENTER=.T.
  CAPTION='請輸入列印資料範圍'
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*110
  WIDTH=INT_015*410
  FONTSIZE=INT_015*9
  CONTROLBOX=.F.
  BORDERSTYLE=2
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WINDOWTYPE=1
  NAME='ANS_RANGE'
  ADD OBJECT LABEL1 AS LABEL WITH;
      WIDTH=INT_015*60,;
      HEIGHT=INT_015*25,;
      LEFT=INT_015*25,;
      TOP=INT_015*25,;
      CAPTION='起始編號',;
      NAME='LABEL1'
  ADD OBJECT LABEL2 AS LABEL WITH;
      WIDTH=INT_015*60,;
      HEIGHT=INT_015*25,;
      LEFT=INT_015*192,;
      TOP=INT_015*25,;
      CAPTION='截止編號',;
      NAME='LABEL2'
  ADD OBJECT TEXT1 AS TEXTBOX WITH;
      WIDTH=INT_015*100,;
      TOP=INT_015*19,;
      LEFT=INT_015*85,;
      HEIGHT=INT_015*25,; 
      MAXLENGTH=5,; 
      NAME='TEXT1'
  ADD OBJECT TEXT2 AS TEXTBOX WITH;
      WIDTH=INT_015*100,;
      TOP=INT_015*19,;
      LEFT=INT_015*250,;
      HEIGHT=INT_015*25,;  
      MAXLENGTH=5,;        
      NAME='TEXT2'    
  ADD OBJECT CMND1 AS COMMANDBUTTON WITH;
      LEFT=INT_015*90,;    
      HEIGHT=INT_015*25,;   
      TOP=INT_015*70,;  
      WIDTH=INT_015*50,;
      CAPTION='\<Y.執行',;
      TOOLTIPTEXT='確認所輸入的範圍鍵值!快速鍵->ALT+Y',;
      NAME='CMND1'
  ADD OBJECT CMND2 AS COMMANDBUTTON WITH;
      LEFT=INT_015*215,;
      TOP=INT_015*70,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*50,;
      CAPTION='\<C.取消',;
      TOOLTIPTEXT='取消作業!快速鍵->ALT+C',;
      NAME='CMND2'
  PROCEDURE INIT 
      SELECT L01
      THISFORM.SETALL('FONTSIZE',INT_015*9,'TEXTBOX')
      THISFORM.SETALL('FONTSIZE',INT_015*9,'LABEL')      
      THISFORM.SETALL('FONTSIZE',INT_015*9,'COMMANDBUTTON')                                             
      DO CASE
            CASE KEY()='F01'
                      THISFORM.LABEL1.CAPTION='起始編號'
                      THISFORM.LABEL2.CAPTION='截止編號'
                      THISFORM.TEXT1.MAXLENGTH=15
                      THISFORM.TEXT2.MAXLENGTH=15
                      THISFORM.TEXT1.VALUE=L01.F01
                      THISFORM.TEXT2.VALUE=L01.F01     
            CASE KEY()='F04+F01'
                      THISFORM.LABEL1.CAPTION='起始部門'
                      THISFORM.LABEL2.CAPTION='截止部門'
                      THISFORM.TEXT1.MAXLENGTH=5
                      THISFORM.TEXT2.MAXLENGTH=5           
                      THISFORM.TEXT1.VALUE=L01.F04
                      THISFORM.TEXT2.VALUE=L01.F04                                 
            CASE KEY()='F05+F01'
                      THISFORM.LABEL1.CAPTION='起始人員'
                      THISFORM.LABEL2.CAPTION='截止人員'
                      THISFORM.TEXT1.MAXLENGTH=4
                      THISFORM.TEXT2.MAXLENGTH=4           
                      THISFORM.TEXT1.VALUE=L01.F05
                      THISFORM.TEXT2.VALUE=L01.F05
            CASE KEY()='F27+F01'
                      THISFORM.LABEL1.CAPTION='起始類別'
                      THISFORM.LABEL2.CAPTION='截止類別'
                      THISFORM.TEXT1.MAXLENGTH=4
                      THISFORM.TEXT2.MAXLENGTH=4            
                      THISFORM.TEXT1.VALUE=L01.F27
                      THISFORM.TEXT2.VALUE=L01.F27   
            CASE KEY()='F08'
                      THISFORM.LABEL1.CAPTION='起始憑證'
                      THISFORM.LABEL2.CAPTION='截止憑證'
                      THISFORM.TEXT1.MAXLENGTH=15
                      THISFORM.TEXT2.MAXLENGTH=15          
                      THISFORM.TEXT1.VALUE=L01.F08
                      THISFORM.TEXT2.VALUE=L01.F08                         
      ENDCASE
  ENDPROC    
  PROCEDURE CMND1.CLICK     
      DO CASE
            CASE KEY()='F01'
                      SELECT L01.F01,L01.F02,L01.F03,L01.F04,L01.F05,L01.F08,L01.F27,L00.F04,A14.F02,S50.F02 FROM L01,L00,A14,S50 WHERE  L01.F01>=THISFORM.TEXT1.VALUE .AND. L01.F01<=THISFORM.TEXT2.VALUE ;
                      AND L00.F01=L01.F27 AND A14.F01=L01.F04 AND S50.F01=L01.F05 ORDER BY L01.F01
            CASE KEY()='F04+F01'
                      SELECT L01.F01,L01.F02,L01.F03,L01.F04,L01.F05,L01.F08,L01.F27,L00.F04,A14.F02,S50.F02 FROM L01,L00,A14,S50 WHERE  L01.F04>=THISFORM.TEXT1.VALUE .AND. L01.F04<=THISFORM.TEXT2.VALUE ;
                      AND L00.F01=L01.F27 AND A14.F01=L01.F04 AND S50.F01=L01.F05 ORDER BY L01.F04
            CASE KEY()='F05+F01'
                      SELECT L01.F01,L01.F02,L01.F03,L01.F04,L01.F05,L01.F08,L01.F27,L00.F04,A14.F02,S50.F02 FROM L01,L00,A14,S50 WHERE  L01.F05>=THISFORM.TEXT1.VALUE .AND. L01.F05<=THISFORM.TEXT2.VALUE ;
                      AND L00.F01=L01.F27 AND A14.F01=L01.F04 AND S50.F01=L01.F05 ORDER BY L01.F05                        
            CASE KEY()='F27+F01'
                      SELECT L01.F01,L01.F02,L01.F03,L01.F04,L01.F05,L01.F08,L01.F27,L00.F04,A14.F02,S50.F02 FROM L01,L00,A14,S50 WHERE  L01.F27>=THISFORM.TEXT1.VALUE .AND. L01.F27<=THISFORM.TEXT2.VALUE ;
                      AND L00.F01=L01.F27 AND A14.F01=L01.F04 AND S50.F01=L01.F05 ORDER BY L01.F27                       
            CASE KEY()='F08'
                      SELECT L01.F01,L01.F02,L01.F03,L01.F04,L01.F05,L01.F08,L01.F27,L00.F04,A14.F02,S50.F02 FROM L01,L00,A14,S50 WHERE  L01.F08>=THISFORM.TEXT1.VALUE .AND. L01.F08<=THISFORM.TEXT2.VALUE ;
                      AND L00.F01=L01.F27 AND A14.F01=L01.F04 AND S50.F01=L01.F05 ORDER BY L01.F08                        
        ENDCASE

	IF _TALLY>0
*	     REPORT FORM ALLTRIM(INT_116)+'L01' PREVIEW
         REPORT FORM ALLTRIM(INT_116)+'L01' TO PRINT PROMPT  
	     THISFORM.CMND2.CLICK
	ELSE
	     =MESSAGEBOX('無此範圍資料',0+48,'警示')
      	     THISFORM.TEXT1.VALUE=''
      	     THISFORM.TEXT2.VALUE=''	     
	     THISFORM.TEXT1.SETFOCUS
	ENDIF         
  ENDPROC
  PROCEDURE CMND2.CLICK
      THISFORM.RELEASE
  ENDPROC        
ENDDEFINE   
 