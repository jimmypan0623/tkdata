*********A40.支付證明單
CLOSE ALL
CLEAR 
HD1='A040 '
HD2='AA'
HD3='支付證明單/簽呈'
FLG='0'
FCH=''
AREA1='A40'
CHK=''
PRT_BOTT=.F.
IF !USED('A02')
   SELE 0
   USE A02 INDE A02
ELSE 
   SELE A02
ENDIF
SET ORDER TO A021      
SEEK sys_oper+'A40'   
IF !USED('A01')
   SELE 0
   USE A01 INDE A01
ELSE 
   SELE A01
ENDIF
SET ORDER TO A01
IF !USED('A09')
   SELE 0
   USE A09
ELSE
   SELE A09
ENDIF
SET ORDER TO A091
IF !USED('A14')
   SELE 0
   USE A14
ELSE 
   SELE A14
ENDIF
SET ORDER TO A141  
A24='A24'+LEFT(DTOS(DATE()),6)     &&單號暫存檔
IF !USED('&A24')
   SELE 0
   USE (A24) ALIA A24
ELSE
   SELE A24
ENDIF
SET ORDER TO 1      
IF !USED('A4Z')
   SELE 0
   USE A4Z
ELSE 
   SELE A4Z
ENDIF
SET ORDER TO 1 
IF !USED('A40')
   SELE 0
   USE A40
ELSE 
   SELE A40
ENDIF
SET ORDER TO A401  
SELECT F04 FROM A40 WHERE F98='1' ORDER BY F04 INTO CURSOR A40_F04
SELECT A40
SET RELATION TO F03 INTO A01
SET RELATION TO F01 INTO A4Z ADDI
DO CASE 
   CASE A02.F09='*'  &&判斷是否有權限可處理所有員工
        SET FILTER TO  EMPTY(F98)
   CASE A02.F11='*'      
        SET FILTER TO F11=IIF(SEEK(sys_oper,'A01'),A01.F04,'')
OTHERWISE
   SET FILTER TO F03=sys_oper  .AND. EMPTY(F98)    
ENDCASE
A40FORM=CREATEOBJECT("TKA40")
A40FORM.SHOW  
DEFINE CLASS TKA40 AS FORM
  CAPTION='A40.支付證明單/簽呈'
*!*	  AUTOCENTER=.T.
  CONTROLBOX=.F.
  BORDERSTYLE=1
  MAXBUTTON=.F.
  MINBUTTON=.F.
  MOVABLE=.F.
  CLOSABLE=.F.
  CONTROLCOUNT=57
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*550
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WIDTH=INT_015*791
  WINDOWTYPE=1
  NAME='TKA40'
  ADD OBJECT SHAPE1 AS SHAPE1 WITH;
      AUTOCENTER=.T.
  ADD OBJECT SHAPE2 AS SHAPE2 WITH;
      AUTOCENTER=.T.
  ADD OBJECT SHAPE3 AS SHAPE3 WITH;
      AUTOCENTER=.T.  
  ADD OBJECT ANS_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*490,;
      LEFT=INT_015*15,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*42,;      
      FONTSIZE=INT_015*9,;
      CAPTION='\<A.確認',;
      NAME='ANS_BOTT'             
  ADD OBJECT PRT_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*490,;
      LEFT=INT_015*59,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*65,;      
      FONTSIZE=INT_015*9,;
      CAPTION='\<K.列印總表',;
      NAME='PRT_BOTT'    
  ADD OBJECT SUBJECT_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*490,;
      LEFT=INT_015*126,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*63,;      
      FONTSIZE=INT_015*9,;
      CAPTION='\<S.新增科目',;
      NAME='SUBJECT_BOTT'                    
  ADD OBJECT LBLF01 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*29,;
      WIDTH=INT_015*50,;
      CAPTION='單據編號'      
  ADD OBJECT TXTF01 AS TEXTBOX WITH;      
      LEFT=INT_015*295,;
      TOP=INT_015*23,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*80,;
      MAXLENGTH=10,;
      NAME='TXTF01'        
   ADD OBJECT LBLF10 AS LABEL WITH;
      LEFT=INT_015*388,;
      TOP=INT_015*29,;
      AUTOSIZE=.T.,;
      CAPTION=''      
  ADD OBJECT OPTF10 AS OPTIONGROUP WITH;      
      LEFT=INT_015*388,;
      TOP=INT_015*23,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*130,;
      BUTTONCOUNT=2,;
      OPTION1.CAPTION='支出單',;
      OPTION1.FONTSIZE=INT_015*9,;
      OPTION1.LEFT=INT_015*4,;
      OPTION1.TOP=INT_015*4,;
      OPTION1.AUTOSIZE=.T.,;
      OPTION2.CAPTION='簽  呈',;
      OPTION2.FONTSIZE=INT_015*9,;
      OPTION2.LEFT=INT_015*64,;
      OPTION2.TOP=INT_015*4,;
      OPTION2.AUTOSIZE=.T.,;     
      VISIBLE=.F.,;     
      NAME='OPTF10'             
  ADD OBJECT LBLF02 AS LABEL WITH;      
      LEFT=INT_015*244,;
      TOP=INT_015*56,;
      WIDTH=INT_015*50,;
      CAPTION='申請日期'
  ADD OBJECT TXTF02 AS TEXTBOX WITH;
      AUTOSIZE=.T.,;
      LEFT=INT_015*295,;
      TOP=INT_015*50,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*80,;
      NAME='TXTF02'           
  ADD OBJECT LBLF03 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*83,;
      WIDTH=INT_015*50,;
      CAPTION='申請人員'         
  ADD OBJECT LBLF031 AS LABEL WITH;
      LEFT=INT_015*370,;
      TOP=INT_015*83,;
      AUTOSIZE=.T.,;
      CAPTION=''           
  ADD OBJECT TXTF03 AS TEXTBOX WITH;
      LEFT=INT_015*295,;
      TOP=INT_015*77,;
      WIDTH=INT_015*65,;
      HEIGHT=INT_015*25,;
      MAXLENGTH=5,;
      NAME='TXTF03'       
 ADD OBJECT COMBOBOX03 AS COMBOBOX03 WITH;      
      VISIBLE=.F.,;
       LEFT=INT_015*295,;
       TOP=INT_015*77            
  ADD OBJECT LBLF04 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*110,;
      WIDTH=INT_015*50,;
      CAPTION='支付科目'             
  ADD OBJECT TXTF04 AS TEXTBOX WITH;
      LEFT=INT_015*295,;
      TOP=INT_015*104,;
      WIDTH=INT_015*150,;
      HEIGHT=INT_015*25,;
      MAXLENGTH=30,;
      NAME='TXTF04'     
 ADD OBJECT COMBOBOX04 AS COMBOBOX04 WITH;      
      VISIBLE=.F.,;
       LEFT=INT_015*295,;
       TOP=INT_015*104           
  ADD OBJECT LBLF06 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*137,;
      WIDTH=INT_015*50,;
      CAPTION='支付金額'             
  ADD OBJECT TXTF06 AS TEXTBOX WITH;
      LEFT=INT_015*295,;
      TOP=INT_015*131,;
      WIDTH=INT_015*90,;
      HEIGHT=INT_015*25,;
      ALIGNMENT=1,;
      INPUTMASK='999999999.99',;
      NAME='TXTF06'              
  ADD OBJECT LBLF07 AS LABEL WITH;
      LEFT=INT_015*444,;
      TOP=INT_015*137,;
      WIDTH=INT_015*50,;
      CAPTION='附件張數'             
  ADD OBJECT TXTF07 AS TEXTBOX WITH;
      LEFT=INT_015*495,;
      TOP=INT_015*131,;
      WIDTH=INT_015*35,;
      HEIGHT=INT_015*25,;
      MAXLENGTH=3,;
      NAME='TXTF07'         
  ADD OBJECT LBLF05 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*164,;
      WIDTH=INT_015*50,;
      CAPTION='用途說明'             
  ADD OBJECT TXTF05 AS TEXTBOX WITH;
      LEFT=INT_015*295,;
      TOP=INT_015*158,;
      WIDTH=INT_015*300,;
      HEIGHT=INT_015*25,;
      MAXLENGTH=80,;
      NAME='TXTF05'      
   ADD OBJECT LBLF08 AS LABEL WITH;
      LEFT=INT_015*246,;
      TOP=INT_015*203,;
      WIDTH=INT_015*50,;
      CAPTION='說        明'                  
  ADD OBJECT TXTF08 AS EDITBOX WITH;&&文書編輯EDITBOX
      LEFT=INT_015*295,;
      TOP=INT_015*185,;
      WIDTH=INT_015*430,;
      HEIGHT=INT_015*60,;
      READONLY=.T.,;
      MAXLENGTH=254,;
      FONTSIZE=INT_015*9,;
      ALIGNMENT=0,;
      NAME='TXTF08'                 
    ADD OBJECT LBLF09 AS LABEL WITH;
      LEFT=INT_015*246,;
      TOP=INT_015*263,;
      WIDTH=INT_015*50,;
      CAPTION='意        見'                  
  ADD OBJECT TXTF09 AS EDITBOX WITH;&&文書編輯EDITBOX
      LEFT=INT_015*295,;
      TOP=INT_015*250,;
      WIDTH=INT_015*430,;
      HEIGHT=INT_015*50,;
      READONLY=.T.,;
      MAXLENGTH=160,;
      FONTSIZE=INT_015*9,;
      ALIGNMENT=0,;
      NAME='TXTF09'                      
  ADD OBJECT LBLF97 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*440,;
      WIDTH=INT_015*50,;
      CAPTION='狀        態'
  ADD OBJECT LBLF971 AS LABEL WITH;
      LEFT=INT_015*295,;
      TOP=INT_015*440,;
      AUTOSIZE=.T.                
  ADD OBJECT LBLF99 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*465,;
      WIDTH=INT_015*50,;
      CAPTION='安全資料'
  ADD OBJECT LBLF991 AS LABEL WITH;
      LEFT=INT_015*295,;
      TOP=INT_015*465,;
      AUTOSIZE=.T.                
  ADD OBJECT LBLF90 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*490,;
      WIDTH=INT_015*50,;
      CAPTION='確認人員'
  ADD OBJECT LBLF901 AS LABEL WITH;
      LEFT=INT_015*295,;
      TOP=INT_015*490,;
      AUTOSIZE=.T.              
  ADD OBJECT KEY_LIST AS KEY_LIST WITH;
      AUTOCENTER=.T.
  ADD OBJECT GRID1 AS GRID1 WITH;
      COLUMNCOUNT=2,;            
      RECORDSOURCE='A40',;      
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2'
  ADD OBJECT CMDGROUP AS CMDGROUP WITH;
      AUTOSIZE=.T.              
  ADD OBJECT ORPGROUP AS ORPGROUP WITH;    
      AUTOSIZE=.T.
  ADD OBJECT SHRGROUP AS SHRGROUP WITH;
      TOP=INT_015*490,;
      LEFT=INT_015*558          
  PROC INIT  
       SELECT A40
       GO BOTTOM 
       THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(A40.F97<>'1',RGB(255,0,0),'')","COLUMN")        
       THISFORM.SHRGROUP.VISIBLE=.F.
       THISFORM.SHRGROUP.ENABLED=.F.
       THISFORM.SETALL('HEIGHT',INT_015*25,'TEXTBOX')
       THISFORM.SETALL('FONTSIZE',INT_015*9,'LABEL')
       THISFORM.SETALL('FONTSIZE',INT_015*9,'TEXTBOX')
       THISFORM.SETALL('HEIGHT',INT_015*17,'LABEL')       
       THISFORM.SETALL('READONLY',.T.,'TEXTBOX')
       THISFORM.SETALL('FONTSIZE',INT_015*9,'COLUMN')
       THISFORM.SETALL('FONTSIZE',INT_015*9,'HEADER')      
       THISFORM.GRID1.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146) 
       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*75
       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*60
       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='單據編號'
       THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='申請人員'
       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='A40.F01'
       THISFORM.GRID1.COLUMN2.CONTROLSOURCE="IIF(SEEK(A40.F03,'A01'),A01.F03,'')"
       THISFORM.GRID1.READONLY=.T.       
       THISFORM.GRID1.SETFOCUS
       IF THISFORM.GRID1.ACTIVEROW=0
          THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
          THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
          THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
          THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.       
          THISFORM.CMDGROUP.ENABLED=.F.
          THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
          THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
          THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
          THISFORM.ANS_BOTT.ENABLED=.F.
          THISFORM.PRT_BOTT.ENABLED=.F.
          THISFORM.TXTF01.VALUE=''
          THISFORM.TXTF02.VALUE=''
          THISFORM.TXTF03.VALUE=''
          THISFORM.TXTF04.VALUE=''  
          THISFORM.TXTF05.VALUE=''
          THISFORM.TXTF06.VALUE=''     
          THISFORM.TXTF07.VALUE=''
          THISFORM.LBLF031.CAPTION=''
          THISFORM.LBLF901.CAPTION=''
          THISFORM.LBLF10.CAPTION=''
          THISFORM.LBLF971.CAPTION=''
          THISFORM.LBLF991.CAPTION=''
       ELSE
          THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
          THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
          THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
          THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.            
          THISFORM.CMDGROUP.ENABLED=.T.      
          THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  .AND. IIF(A40.F97<>'1',.T.,.F.) &&判斷有無修改的權限
          THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)   .AND. IIF(A40.F97<>'1',.T.,.F.) &&判斷有無刪除的權限
          THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限
          THISFORM.ANS_BOTT.ENABLED=IIF(A02.F08='*',.T.,.F.)  .AND. IIF(A40.F97<>'1',.T.,.F.)   &&判斷有無確認的權限
          THISFORM.PRT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印總表的權限
       ENDIF      
       THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.)  &&判斷有無新增的權限 
       THISFORM.SUBJECT_BOTT.ENABLED=IIF(A02.F10='*',.T.,.F.)   &&判斷有無新增科目的權限       
       JK='單據編號'
  ENDPROC
  ***********     
  PROC KEY_LIST.INIT 
       WITH THIS 
           .ADDITEM('依單據編號排列')
       ENDWITH      
  ENDPROC 
  PROCEDURE OPTF10.INTERACTIVECHANGE
        IF THIS.VALUE=1
           THISFORM.LBLF05.CAPTION='用途說明'
           THISFORM.LBLF08.VISIBLE=.F.
           THISFORM.LBLF09.VISIBLE=.F.
           THISFORM.TXTF08.VISIBLE=.F.
           THISFORM.TXTF09.VISIBLE=.F.
        ELSE
           THISFORM.LBLF05.CAPTION='事        由'
           THISFORM.LBLF08.VISIBLE=.T.
           THISFORM.LBLF09.VISIBLE=.T.
           THISFORM.TXTF08.VISIBLE=.T.
           THISFORM.TXTF09.VISIBLE=.T.
        ENDIF
  ENDPROC
  *********
  PROC GRID1.AFTERROWCOLCHANGE
       LPARAMETERS nColIndex
       THISFORM.TXTF01.VALUE=F01
       THISFORM.TXTF02.VALUE=F02
       THISFORM.TXTF03.VALUE=F03
       THISFORM.TXTF04.VALUE=F04
       THISFORM.TXTF05.VALUE=F05
       THISFORM.TXTF06.VALUE=F06
       THISFORM.TXTF07.VALUE=F07
       THISFORM.TXTF08.VALUE=A4Z.F08
       THISFORM.TXTF09.VALUE=A4Z.F09
       THISFORM.LBLF10.CAPTION=IIF(F10='1','支付證明單','簽  呈')
       THISFORM.LBLF05.CAPTION=IIF(F10='1','用途說明','事        由')
       THISFORM.LBLF031.CAPTION=A01.F03 
       THISFORM.LBLF901.CAPTION=F90
       THISFORM.LBLF971.CAPTION=IIF(A40.F97<>'1','尚未確認','已確認') 
       THISFORM.LBLF971.BACKCOLOR=IIF(A40.F97<>'1',RGB(255,0,0),RGB(58,186,152)) 
       THISFORM.LBLF991.CAPTION=F99    
       THISFORM.LBLF08.VISIBLE=(F10='2')
       THISFORM.LBLF09.VISIBLE=(F10='2')
       THISFORM.TXTF08.VISIBLE=(F10='2')
       THISFORM.TXTF09.VISIBLE=(F10='2')
       THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  .AND. IIF(A40.F97<>'1',.T.,.F.) &&判斷有無修改的權限
       THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)   .AND. IIF(A40.F97<>'1',.T.,.F.) &&判斷有無刪除的權限
       THISFORM.ANS_BOTT.ENABLED=IIF(A02.F08='*',.T.,.F.)  .AND. IIF(A40.F97<>'1',.T.,.F.)   &&判斷有無確認的權限
       FCH=THISFORM.ACTIVECONTROL.NAME
       CHK=''
       THISFORM.REFRESH
  ENDPROC      
  ********** 
  PROCEDURE ORPGROUP.NEW_BOTT.CLICK    
  IF RECCOUNT('A40_F04')<>0
       THISFORM.SETALL('READONLY',.F.,'TEXTBOX')    
        HD=HD1+SUBSTR(DTOS(DATE()),3,4)
        DO ODR_CRT
       THISFORM.TXTF01.READONLY=.T.                    
       THISFORM.TXTF01.VALUE=PO_NO
       THISFORM.TXTF02.VALUE=DATE()
       THISFORM.TXTF03.VALUE=IIF(A02.F09='*','',sys_oper)
       THISFORM.TXTF04.VALUE=THISFORM.COMBOBOX04.DISPLAYVALUE
       THISFORM.TXTF05.VALUE=''
       THISFORM.TXTF06.VALUE=0
       THISFORM.TXTF07.VALUE=0
       THISFORM.TXTF03.READONLY=IIF(A02.F09='*',.F.,.T.)
       THISFORM.COMBOBOX03.VISIBLE=IIF(A02.F09='*',.T.,.F.)
       THISFORM.COMBOBOX04.VISIBLE=.T.
       THISFORM.OPTF10.VISIBLE=.T.
       THISFORM.OPTF10.VALUE=1
       THISFORM.COMBOBOX03.VALUE=1
       THISFORM.COMBOBOX04.VALUE=1
       THISFORM.LBLF08.VISIBLE=.F.
       THISFORM.LBLF09.VISIBLE=.F.
       THISFORM.TXTF08.VISIBLE=.F.
       THISFORM.TXTF09.VISIBLE=.F.
       THISFORM.TXTF08.READONLY=.F.
       THISFORM.TXTF09.READONLY=.F.
       THISFORM.TXTF08.VALUE=''
       THISFORM.TXTF09.VALUE='請  鈞長簽核'
       THISFORM.LBLF031.CAPTION=IIF(A02.F09='*','',IIF(SEEK(sys_oper,'A01'),A01.F03,''))
       THISFORM.LBLF901.CAPTION=''
       THISFORM.LBLF991.CAPTION=''
       THISFORM.TXTF01.SETFOCUS()
       THISFORM.GRID1.ENABLED=.F.
       FLG='1'
    ELSE
       THISFORM.SHRGROUP.VISIBLE=.F.  
       =MESSAGEBOX('目前無支付科目資料,請先新增支付科目名稱!',0+64,'提示視窗')
       THISFORM.SHRGROUP.ABANDON_BOTT.CLICK 
    ENDIF   
  ENDPROC  
************
  PROCEDURE SHRGROUP.SHURE1_BOTT.CLICK
       IF SEEK(THISFORM.TXTF01.VALUE,'A40')=.T.  &&如果單號重覆
           SELE MAX(F01) FROM A40 INTO ARRAY GB NOWAIT
           HD='A040 '+SUBSTR(DTOS(DATE()),3,4)+THISFORM.TXTF01.VALUE    
           DO ODR_RPT
	       THISFORM.TXTF01.VALUE=PO_NO
	       THISFORM.TXTF01.REFRESH      
       ENDIF   
    IF EMPTY(THISFORM.TXTF02.VALUE)
       =MESSAGEBOX('申請日期不得空白!',0+64,'提示視窗')
       THISFORM.TXTF02.SETFOCUS
       RETURN
    ENDIF  
    IF EMPTY(THISFORM.TXTF03.VALUE)
       =MESSAGEBOX('申請人員不得空白!',0+64,'提示視窗')
       THISFORM.TXTF03.SETFOCUS
       RETURN
    ENDIF       
    IF EMPTY(THISFORM.TXTF06.VALUE) AND THISFORM.OPTF10.VALUE=1
       =MESSAGEBOX('支出金額不得為零!',0+64,'提示視窗')
       THISFORM.TXTF06.SETFOCUS
       RETURN
    ENDIF     
    IF EMPTY(THISFORM.TXTF05.VALUE)
       =MESSAGEBOX('用途說明不得空白!',0+64,'提示視窗')
       THISFORM.TXTF05.SETFOCUS
       RETURN
    ENDIF                   
    
    SELECT  A40
    APPEND BLANK
    LOCK()
    IF RLOCK()
       REPLACE F01 WITH THISFORM.TXTF01.VALUE
       REPLACE F02 WITH THISFORM.TXTF02.VALUE
       REPLACE F03 WITH THISFORM.TXTF03.VALUE
       REPLACE F04 WITH THISFORM.TXTF04.VALUE
       REPLACE F05 WITH ALLTRIM(THISFORM.TXTF05.VALUE)
       REPLACE F06 WITH THISFORM.TXTF06.VALUE
       REPLACE F07 WITH THISFORM.TXTF07.VALUE       
       REPLACE F10 WITH ALLTRIM(STR(THISFORM.OPTF10.VALUE))
       REPLACE F11 WITH IIF(SEEK(F03,'A01'),A01.F04,'')
       REPLACE F99 WITH IIF(INT_012=1,PADL(ALLTRIM(STR(YEAR(DATE())-1911)),3,' ')+RIGHT(DTOC(DATE()),6),dtoc(DATE())+' ')+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
       IF THISFORM.OPTF10.VALUE=2
          SELECT A4Z
          APPEND BLANK
          REPLACE F01 WITH THISFORM.TXTF01.VALUE
          REPLACE F08 WITH THISFORM.TXTF08.VALUE
          REPLACE F09 WITH THISFORM.TXTF09.VALUE
       ENDIF
    ENDIF
    UNLOCK all
    THISFORM.GRID1.ENABLED=.T.
    THISFORM.REFRESH
    THISFORM.GRID1.SETFOCUS    
    THISFORM.SHRGROUP.ABANDON_BOTT.CLICK             
  ENDPROC
************  
  PROCEDURE ORPGROUP.EDIT_BOTT.CLICK
     SELECT A40
     THISFORM.GRID1.ENABLED=.F.
     THISFORM.SETALL('READONLY',.F.,'TEXTBOX')   
     THISFORM.TXTF01.READONLY=.T.
     THISFORM.TXTF03.READONLY=IIF(A02.F09='*',.F.,.T.)
     THISFORM.COMBOBOX03.VISIBLE=IIF(A02.F09='*',.T.,.F.)
     THISFORM.COMBOBOX03.DISPLAYVALUE=ALLTRIM(THISFORM.TXTF03.VALUE)+SPACE(7)+ALLTRIM(THISFORM.LBLF031.CAPTION)
     THISFORM.COMBOBOX04.VISIBLE=.T.
     THISFORM.COMBOBOX04.DISPLAYVALUE=THISFORM.TXTF04.VALUE
     THISFORM.OPTF10.VISIBLE=.T.
     THISFORM.OPTF10.VALUE=VAL(A40.F10)
     THISFORM.TXTF08.READONLY=.F.
     THISFORM.TXTF09.READONLY=.F.
     IF EMPTY(THISFORM.TXTF08.VALUE)
        THISFORM.TXTF08.VALUE=SPACE(254)
     ENDIF
     IF EMPTY(THISFORM.TXTF09.VALUE)
        THISFORM.TXTF09.VALUE='請  鈞長簽核'
     ENDIF
     THISFORM.LBLF901.CAPTION=''     
     THISFORM.LBLF991.CAPTION=''
     THISFORM.TXTF02.SETFOCUS
     LOCK()
     IF !RLOCK()
        DO FILE_IMPACT
        RETURN
     ENDIF
  ENDPROC 
************  
  PROCEDURE SHRGROUP.SHURE2_BOTT.CLICK    
     IF EMPTY(THISFORM.TXTF06.VALUE) AND THISFORM.OPTF10.VALUE=1
       =MESSAGEBOX('支出金額不得為零!',0+64,'提示視窗')
       THISFORM.TXTF06.SETFOCUS
       RETURN
    ENDIF     
    SELECT  A40
    IF RLOCK()
        REPLACE F02 WITH THISFORM.TXTF02.VALUE
        REPLACE F03 WITH THISFORM.TXTF03.VALUE
        REPLACE F04 WITH THISFORM.TXTF04.VALUE  
        REPLACE F05 WITH THISFORM.TXTF05.VALUE
        REPLACE F06 WITH THISFORM.TXTF06.VALUE  
        REPLACE F07 WITH THISFORM.TXTF07.VALUE
        REPLACE F11 WITH IIF(SEEK(F03,'A01'),A01.F04,'')
        IF THISFORM.OPTF10.VALUE=2
           SELECT A4Z
           SEEK THISFORM.TXTF01.VALUE
           IF !FOUND()
              APPEND BLANK
              REPLACE F01 WITH THISFORM.TXTF01.VALUE
           ENDIF      
           REPLACE F08 WITH THISFORM.TXTF08.VALUE
           REPLACE F09 WITH THISFORM.TXTF09.VALUE         
        ELSE
           IF A40.F10='2'
              DELETE FROM A4Z WHERE F01=THISFORM.TXTF01.VALUE   
           ENDIF   
        ENDIF   
        SELECT A40   
        REPLACE F10 WITH ALLTRIM(STR(THISFORM.OPTF10.VALUE))
        REPLACE F99 WITH IIF(INT_012=1,PADL(ALLTRIM(STR(YEAR(DATE())-1911)),3,' ')+RIGHT(DTOC(DATE()),6),dtoc(DATE())+' ')+IIF(SEEK(sys_oper,'A01'),A01.F03,'')    
    ELSE
        DO file_impact
        RETURN   
    ENDIF 
    UNLOCK ALL   
    THISFORM.SHRGROUP.ABANDON_BOTT.CLICK    
  ENDPROC
*******************
  PROCEDURE ORPGROUP.DEL_BOTT.CLICK
     IF MESSAGEBOX('是否確定要刪除此筆資料',4+32+256,'請確認') = 6	      
         SELECT  A40
         LOCK()
         IF RLOCK()        
             SELECT  A40
             PO_NO=A40.F01
             DELE
             UNLOCK
             SKIP -1
             IF BOF()
                 GO TOP
             ENDIF   
             IF INT_099=.T. AND SUBSTR(DTOS(DATE()),3,4)=SUBSTR(PO_NO,3,4)
                HD=HD1+SUBSTR(DTOS(DATE()),3,4)+PO_NO
                DO ODR_RJT
             ENDIF   
             THISFORM.GRID1.SETFOCUS
             IF THISFORM.GRID1.ACTIVEROW=0
                 THISFORM.SETALL('VALUE','','TEXTBOX')
                 THISFORM.CMDGROUP.ENABLED=.F.
                 THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
                 THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
                 THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
              ELSE
                 THISFORM.CMDGROUP.ENABLED=.T.
                 THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  &&判斷有無修改的權限
                 THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)   &&判斷有無刪除的權限
                 THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限              
              ENDIF
        ELSE
              DO file_impact    
        ENDIF
     ENDIF        
  ENDPROC
*************   
  PROCEDURE SHRGROUP.ABANDON_BOTT.CLICK
      THISFORM.SHRGROUP.ENABLED=.F.
      THISFORM.SHRGROUP.VISIBLE=.F.      
      THISFORM.ORPGROUP.ENABLED=.T.
      THISFORM.ORPGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
      THISFORM.CMDGROUP.ENABLED=.T.
      THISFORM.CMDGROUP.SETALL('ENABLED',.T.,'COMMANDBUTTON')
      THISFORM.CMDGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
      THISFORM.SETALL('READONLY',.T.,'TEXTBOX')   
      THISFORM.KEY_LIST.ENABLED=.T.      
      THISFORM.COMBOBOX03.VISIBLE=.F.
      THISFORM.COMBOBOX04.VISIBLE=.F.
      THISFORM.TXTF08.READONLY=.T.
      THISFORM.TXTF09.READONLY=.T.
      THISFORM.OPTF10.VISIBLE=.F.
      UNLOCK ALL
      SELECT  A40
      THISFORM.GRID1.ENABLED=.T. 
      THISFORM.GRID1.SETFOCUS   
       IF THISFORM.GRID1.ACTIVEROW=0
          THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
          THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
          THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
          THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.       
          THISFORM.CMDGROUP.ENABLED=.F.
          THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
          THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
          THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
          THISFORM.ANS_BOTT.ENABLED=.F.
          THISFORM.PRT_BOTT.ENABLED=.F.
          THISFORM.TXTF01.VALUE=''
          THISFORM.TXTF02.VALUE=''
          THISFORM.TXTF03.VALUE=''
          THISFORM.TXTF04.VALUE=''  
          THISFORM.TXTF05.VALUE=''
          THISFORM.TXTF06.VALUE=''  
          THISFORM.TXTF07.VALUE=''          
          THISFORM.LBLF031.CAPTION=''
          THISFORM.LBLF901.CAPTION=''
          THISFORM.LBLF971.CAPTION=''
          THISFORM.LBLF991.CAPTION=''
       ELSE
          THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
          THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
          THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
          THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.            
          THISFORM.CMDGROUP.ENABLED=.T.      
          THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  .AND. IIF(A40.F97<>'1',.T.,.F.) &&判斷有無修改的權限
          THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)   .AND. IIF(A40.F97<>'1',.T.,.F.) &&判斷有無刪除的權限
          THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限
          THISFORM.ANS_BOTT.ENABLED=IIF(A02.F08='*',.T.,.F.)  .AND. IIF(A40.F97<>'1',.T.,.F.)   &&判斷有無確認的權限
          THISFORM.PRT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印總表的權限
       ENDIF      
  ENDPROC
  ********
  PROCEDURE SHRGROUP.FINISH_BOTT.CLICK  
       HD=HD1+SUBSTR(DTOS(DATE()),3,4)+PO_NO
       DO ODR_RJT
       SELECT A40
       THISFORM.SHRGROUP.ABANDON_BOTT.CLICK
  ENDPROC     
*******  支付科目
PROCEDURE COMBOBOX04.CLICK
    THISFORM.COMBOBOX04.CLEAR
    SELECT A40_F04  
    GO TOP
    DO WHILE  !EOF()
           THIS.ADDITEM(ALLTRIM(A40_F04.F04))
      	   SELECT  A40_F04
      	   SKIP
    ENDDO
*!*	    SELECT A40_F04
*!*	    USE  
 ENDPROC      
**********  
  PROC ANS_BOTT.CLICK     &&確認程序
       IF MESSAGEBOX('是否要確認此筆資料?',4+32+256,'請確認') = 6	   
           SELECT A40
           LOCK()
           IF RLOCK()   
                REPLACE F97 WITH '1'
                REPLACE F90 WITH IIF(INT_012=1,PADL(ALLTRIM(STR(YEAR(DATE())-1911)),3,' ')+RIGHT(DTOC(DATE()),6),dtoc(DATE())+' ')+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
           ELSE
                DO file_impact
                UNLOCK ALL
                RETURN
           ENDIF   
           UNLOCK ALL   
       ENDIF 
       THISFORM.GRID1.SETFOCUS   
  ENDPROC
**********       
  PROC PRT_BOTT.CLICK     &&列印總表  
    IF  A02.F09<>'*'  
          SELECT * FROM A40 WHERE F97='1'  .AND. EMPTY(F98)  .AND. ALLTRIM(F03)=ALLTRIM(sys_oper) ORDER BY F01 NOWAIT  
          IF _TALLY >0 
              REPORT FORM ALLTRIM(INT_116)+'A40B' TO PRINT PROMPT  PREVIEW
              CLEAR    
           ELSE
              =MESSAGEBOX('查無資料可列印',0+64,'提示訊息視窗')
           ENDIF         
    ELSE
          RANG_SEEK=CREATEOBJECT("RANG_SEEK")  
          RANG_SEEK.SHOW      
    ENDIF 
     THISFORM.GRID1.SETFOCUS 
  ENDPROC  
**********       
  PROC SUBJECT_BOTT.CLICK     &&新增科目
       SELECT  A40
       NO=A40.F01
       SUBJECT_SEEK=CREATEOBJECT("SUBJECT_SEEK")  
       SUBJECT_SEEK.SHOW                
       FLG='0'                    
       SELECT  A40   
       SEEK NO
       THISFORM.GRID1.SETFOCUS
       THISFORM.COMBOBOX04.CLICK
  ENDPROC   
ENDDEFINE    
***********************************************列印程序
PROCEDURE PNT_PRC  
         SELECT A40
         LK=A40.F01
         IF A40.F10='1'
             SELECT * FROM A40 WHERE A40.F01=LK  NOWAIT 	
             IF _TALLY>0
                REPORT FORM ALLTRIM(INT_116)+'A40A' TO PRINT PROMPT  PREVIEW
             ENDIF   
         ELSE
             SELECT A40.*,A4Z.F08,A4Z.F09 FROM A40,A4Z WHERE A40.F01=LK AND A4Z.F01=LK NOWAIT
             IF _TALLY>0
                REPORT FORM ALLTRIM(INT_116)+'A40C' TO PRINT PROMPT  PREVIEW
             ENDIF 
         ENDIF    
     CLEAR
ENDPROC
*************************************************員工編號
DEFINE CLASS COMBOBOX03 AS COMBOBOX 
       VISIBLE=.F.
       HEIGHT=INT_015*25
       WIDTH=INT_015*65
       FONTSIZE=INT_015*9   
       BOUNDCOLUMN=1
       ROWSOURCETYPE=1
       STYLE=2    
       VALUE=1
       NAME='COMBOBOX03'
 PROCEDURE INIT    
       SELECT F01,F03 FROM A01  ORDER BY F01 INTO CURSOR A01_TEMP
       SELECT A01_TEMP
       GO TOP  
       THIS.ADDITEM('')
       DO WHILE  !EOF()
              THIS.ADDITEM(ALLTRIM(A01_TEMP.F01)+SPACE(5-LEN(ALLTRIM(A01_TEMP.F01))+7)+A01_TEMP.F03)
      	      SELECT  A01_TEMP
      	      SKIP
       ENDDO
       SELECT A01_TEMP
       USE   
  ENDPROC  
   PROCEDURE INTERACTIVECHANGE
       IF PRT_BOTT=.T.
       ELSE
           THISFORM.TXTF03.VALUE=LEFT(THIS.DISPLAYVALUE,5)
           THISFORM.LBLF031.CAPTION=RIGHT(ALLTRIM(THIS.DISPLAYVALUE),LEN(ALLTRIM(THIS.DISPLAYVALUE))-10)
           THISFORM.TXTF03.REFRESH         
       ENDIF    
  ENDPROC       
ENDDEFINE
*************************************************支出科目
DEFINE CLASS COMBOBOX04 AS COMBOBOX 
       VISIBLE=.F.
       HEIGHT=INT_015*25
       WIDTH=INT_015*150
       FONTSIZE=INT_015*9   
       BOUNDCOLUMN=1
       ROWSOURCETYPE=1
       STYLE=2    
       VALUE=1
       NAME='COMBOBOX04'
 PROCEDURE INIT    
       SELECT A40_F04   
       GO TOP
       DO WHILE  !EOF()
              THIS.ADDITEM(ALLTRIM(A40_F04.F04))
      	      SELECT  A40_F04
      	      SKIP
       ENDDO 
*!*	       SELECT A40_F04
*!*	       USE   
  ENDPROC  
   PROCEDURE INTERACTIVECHANGE
       IF PRT_BOTT=.T.
       ELSE
           THISFORM.TXTF04.VALUE=ALLTRIM(THIS.DISPLAYVALUE)
           THISFORM.TXTF04.REFRESH  
       ENDIF 
  ENDPROC       
ENDDEFINE
**********************************************************列印總表範圍
DEFINE CLASS RANG_SEEK AS FORM
       AUTOCENTER=.T.
       CAPTION='請輸入列印總表資料範圍'
       FONTSIZE=INT_015*9
       HEIGHT=INT_015*155
       WIDTH=INT_015*385
       FONTSIZE=INT_015*9
       CONTROLBOX=.F.
       BORDERSTYLE=2
       SHOWTIPS=.T.
       SHOWWINDOW=1
       WINDOWTYPE=1
       NAME='RANG_SEEK'
       ADD OBJECT LABELNOTE AS LABEL WITH;
           AUTOSIZE=.T.,;
           HEIGHT=INT_015*25,;
           LEFT=INT_015*35,;
           TOP=INT_015*30,;
           CAPTION='列印選擇',;
           NAME='LABELNOTE'       
       ADD OBJECT OPTIONGROUP_NOTE  AS OPTIONGROUP_NOTE WITH;
           VISIBLE=.T.,;
           LEFT=INT_015*85,;
           TOP=INT_015*10,; 
           ENABLED=.T. 
       ADD OBJECT LABEL1 AS LABEL WITH;
           AUTOSIZE=.T.,;
           HEIGHT=INT_015*25,;
           LEFT=INT_015*10,;
           TOP=INT_015*85,;
           CAPTION='起始人員編號',;
           NAME='LABEL1'
       ADD OBJECT LABEL11 AS LABEL WITH;
           AUTOSIZE=.T.,;
           HEIGHT=INT_015*25,;
           LEFT=INT_015*150,;
           TOP=INT_015*85,;
           CAPTION='',;
           NAME='LABEL11'           
       ADD OBJECT TEXT1 AS TEXTBOX WITH;
           TOP=INT_015*80,;
           LEFT=INT_015*85,;
           HEIGHT=INT_015*25,; 
           WIDTH=INT_015*50,;
           NAME='TEXT1'        
       ADD OBJECT COMBOBOX041 AS COMBOBOX04 WITH;
           TOP=INT_015*80,;
           LEFT=INT_015*85,;
           NAME='COMBOBOX041'                            
       ADD OBJECT LABEL2 AS LABEL WITH;
           AUTOSIZE=.T.,;
           HEIGHT=INT_015*25,;
           LEFT=INT_015*10,;
           TOP=INT_015*115,;
           CAPTION='截止人員編號',;
           NAME='LABEL2' 
       ADD OBJECT LABEL21 AS LABEL WITH;
           AUTOSIZE=.T.,;
           HEIGHT=INT_015*25,;
           LEFT=INT_015*150,;
           TOP=INT_015*115,;
           CAPTION='',;
           NAME='LABEL21'            
       ADD OBJECT TEXT2 AS TEXTBOX WITH;
           TOP=INT_015*110,;
           LEFT=INT_015*85,;
           HEIGHT=INT_015*25,;  
           WIDTH=INT_015*50,;       
           NAME='TEXT2'           
       ADD OBJECT COMBOBOX042 AS COMBOBOX04 WITH;
           TOP=INT_015*110,;
           LEFT=INT_015*85,;   
           NAME='COMBOBOX042'                    
       ADD OBJECT CMND1 AS COMMANDBUTTON WITH;
           AUTOSIZE=.T.,;
           LEFT=INT_015*295,;    
           HEIGHT=INT_015*25,;   
           TOP=INT_015*80,;  
           WIDTH=INT_015*75,;
           CAPTION='\<Y.執行',;
           TOOLTIPTEXT='確認所輸入的範圍鍵值!快速鍵->ALT+Y',;
           NAME='CMND1'
       ADD OBJECT CMND2 AS COMMANDBUTTON WITH;
           AUTOSIZE=.T.,;
           LEFT=INT_015*295,;
           TOP=INT_015*110,;
           HEIGHT=INT_015*25,;
           WIDTH=INT_015*75,;
           CAPTION='\<C.取消',;
           TOOLTIPTEXT='取消作業!快速鍵->ALT+C',;
           NAME='CMND2'
       PROCEDURE INIT 
            PRT_BOTT=.T.        
            THISFORM.SETALL('FONTSIZE',INT_015*9,'TEXTBOX')
            THISFORM.SETALL('FONTSIZE',INT_015*9,'LABEL')      
            THISFORM.SETALL('FONTSIZE',INT_015*9,'COMMANDBUTTON')             
            THISFORM.TEXT1.VALUE=A40.F03
            THISFORM.TEXT2.VALUE=A40.F03       
            THISFORM.LABEL11.CAPTION=A01.F03
            THISFORM.LABEL21.CAPTION=A01.F03                                      
       ENDPROC     
       *********        
       PROCEDURE TEXT1.INTERACTIVECHANGE
          IF THISFORM.OPTIONGROUP_NOTE.VALUE=1 
               THISFORM.LABEL11.CAPTION=IIF(SEEK(ALLTRIM(THIS.VALUE),'A01'),A01.F03,'')
          ENDIF  
       ENDPROC
       PROCEDURE TEXT2.INTERACTIVECHANGE
          IF THISFORM.OPTIONGROUP_NOTE.VALUE=1 
            THISFORM.LABEL21.CAPTION=IIF(SEEK(ALLTRIM(THIS.VALUE),'A01'),A01.F03,'')
          ENDIF 
       ENDPROC  
       **********     
       PROCEDURE CMND1.CLICK
          DO CASE 
                CASE THISFORM.OPTIONGROUP_NOTE.VALUE=1
                           SELECT  A40.F01,A40.F02,A40.F03,A40.F04,A40.F05,A40.F06,A01.F03 FROM A40,A01;
                                          WHERE  F97='1' .AND. EMPTY(F98) .AND. ALLTRIM(A40.F03)=ALLTRIM(A01.F01);
                                          .AND. ALLTRIM(A40.F03)>=ALLTRIM(THISFORM.TEXT1.VALUE) .AND. ;
                                          ALLTRIM(A40.F03)<=ALLTRIM(THISFORM.TEXT2.VALUE)  ORDER BY A40.F03 NOWAIT
		           IF _TALLY >0 
		               REPORT FORM ALLTRIM(INT_116)+'A40C_1' TO PRINT PROMPT  PREVIEW
		               CLEAR    
		           ELSE
		               =MESSAGEBOX('查無資料可列印',0+64,'提示訊息視窗')
		           ENDIF                      
                CASE THISFORM.OPTIONGROUP_NOTE.VALUE=2
                           SELECT  A40.F01,A40.F02,A40.F03,A40.F04,A40.F05,A40.F06,A01.F03 FROM A40,A01;
                                          WHERE  F97='1' .AND. EMPTY(F98) .AND. ALLTRIM(A40.F03)=ALLTRIM(A01.F01);
                                          .AND. A40.F02>=THISFORM.TEXT1.VALUE .AND.  A40.F02<=THISFORM.TEXT2.VALUE  ORDER BY A40.F02 NOWAIT
		           IF _TALLY >0 
		               REPORT FORM ALLTRIM(INT_116)+'A40C_2' TO PRINT PROMPT  PREVIEW
		               CLEAR    
		           ELSE
		               =MESSAGEBOX('查無資料可列印',0+64,'提示訊息視窗')
		           ENDIF                 
                CASE THISFORM.OPTIONGROUP_NOTE.VALUE=3
                           SELECT  A40.F01,A40.F02,A40.F03,A40.F04,A40.F05,A40.F06,A01.F03 FROM A40,A01;
                                          WHERE  F97='1' .AND. EMPTY(F98) .AND. ALLTRIM(A40.F03)=ALLTRIM(A01.F01);
                                          .AND. ALLTRIM(A40.F04)>=ALLTRIM(THISFORM.COMBOBOX041.DISPLAYVALUE) .AND. ;
                                          ALLTRIM(A40.F04)<=ALLTRIM(THISFORM.COMBOBOX042.DISPLAYVALUE)  ORDER BY A40.F04 NOWAIT
		           IF _TALLY >0 
		               REPORT FORM ALLTRIM(INT_116)+'A40C_3' TO PRINT PROMPT  PREVIEW
		               CLEAR    
		           ELSE
		               =MESSAGEBOX('查無資料可列印',0+64,'提示訊息視窗')
		           ENDIF                            
                CASE THISFORM.OPTIONGROUP_NOTE.VALUE=4
                           SELECT  A40.F01,A40.F02,A40.F03,A40.F04,A40.F05,A40.F06,A01.F03 FROM A40,A01;
                                          WHERE  F97='1' .AND. EMPTY(F98) .AND. ALLTRIM(A40.F03)=ALLTRIM(A01.F01) ORDER BY A40.F01 NOWAIT
		           IF _TALLY >0 
		               REPORT FORM ALLTRIM(INT_116)+'A40C_4' TO PRINT PROMPT  PREVIEW
		               CLEAR    
		           ELSE
		               =MESSAGEBOX('查無資料可列印',0+64,'提示訊息視窗')
		           ENDIF                                           
          ENDCASE      
          THISFORM.CMND2.CLICK           
    ENDPROC  
    PROCEDURE CMND2.CLICK
           FLG='1'   
           PRT_BOTT=.F.
           THISFORM.RELEASE                   
    ENDPROC        
 ENDDEFINE     
********列印選擇
DEFINE CLASS OPTIONGROUP_NOTE AS OPTIONGROUP
   VISIBLE=.T.
   HEIGHT=INT_015*55
   WIDTH=INT_015*275
   BUTTONCOUNT=4
   VALUE=1
   ENABLED=.T.	   
   NAME='OPTIONGROUP_NOTE'
   OPTION1.CAPTION='依人員編號列印'
   OPTION1.FONTSIZE=INT_015*9     
   OPTION1.TOP=INT_015*5
   OPTION1.AUTOSIZE=.T.
   OPTION1.LEFT=INT_015*5 
   OPTION1.NAME='OPTION1'
   OPTION2.CAPTION='依申請日期列印'
   OPTION2.FONTSIZE=INT_015*9
   OPTION2.TOP=INT_015*5
   OPTION2.AUTOSIZE=.T.
   OPTION2.LEFT=INT_015*165
   OPTION2.NAME='OPTION2'	 
   OPTION3.CAPTION='依支付科目列印'
   OPTION3.FONTSIZE=INT_015*9   
   OPTION3.TOP=INT_015*30
   OPTION3.AUTOSIZE=.T.
   OPTION3.LEFT=INT_015*5
   OPTION3.NAME='OPTION3' 	
   OPTION4.CAPTION='全部列印'
   OPTION4.FONTSIZE=INT_015*9   
   OPTION4.TOP=INT_015*30
   OPTION4.AUTOSIZE=.T.
   OPTION4.LEFT=INT_015*165
   OPTION4.NAME='OPTION4'     
   PROCEDURE INTERACTIVECHANGE
      DO CASE
            CASE THIS.VALUE=1
                       THISFORM.LABEL1.VISIBLE=.T.  
                       THISFORM.LABEL2.VISIBLE=.T.         
	               THISFORM.LABEL11.VISIBLE=.T.  
	               THISFORM.LABEL21.VISIBLE=.T.                              
                       THISFORM.TEXT1.VISIBLE=.T.  
                       THISFORM.TEXT2.VISIBLE=.T.                         
                       THISFORM.COMBOBOX041.VISIBLE=.F.  
                       THISFORM.COMBOBOX042.VISIBLE=.F.                
                       THISFORM.LABEL1.CAPTION='起始人員編號'
            	       THISFORM.LABEL2.CAPTION='截止人員編號'
            	       THISFORM.TEXT1.WIDTH=INT_015*50
            	       THISFORM.TEXT2.WIDTH=INT_015*50
                       THISFORM.TEXT1.VALUE=A40.F03
                       THISFORM.TEXT2.VALUE=A40.F03
	               THISFORM.LABEL11.CAPTION=A01.F03
	               THISFORM.LABEL21.CAPTION=A01.F03                          
            CASE THIS.VALUE=2
                       THISFORM.LABEL1.VISIBLE=.T.  
                       THISFORM.LABEL2.VISIBLE=.T.     
	               THISFORM.LABEL11.VISIBLE=.F.  
	               THISFORM.LABEL21.VISIBLE=.F.                                    
                       THISFORM.TEXT1.VISIBLE=.T.  
                       THISFORM.TEXT2.VISIBLE=.T.                         
                       THISFORM.COMBOBOX041.VISIBLE=.F.  
                       THISFORM.COMBOBOX042.VISIBLE=.F.                
                       THISFORM.LABEL1.CAPTION='起始申請日期'
            	       THISFORM.LABEL2.CAPTION='截止申請日期'
            	       THISFORM.TEXT1.WIDTH=INT_015*75
            	       THISFORM.TEXT2.WIDTH=INT_015*75
                       THISFORM.TEXT1.VALUE=A40.F02
                       THISFORM.TEXT2.VALUE=A40.F02                                 
            CASE THIS.VALUE=3
                       THISFORM.LABEL1.VISIBLE=.T.  
                       THISFORM.LABEL2.VISIBLE=.T.     
	               THISFORM.LABEL11.VISIBLE=.F.  
	               THISFORM.LABEL21.VISIBLE=.F.                                   
                       THISFORM.TEXT1.VISIBLE=.F.  
                       THISFORM.TEXT2.VISIBLE=.F.                         
                       THISFORM.COMBOBOX041.VISIBLE=.T.  
                       THISFORM.COMBOBOX042.VISIBLE=.T.                
                       THISFORM.LABEL1.CAPTION='起始支付科目'
            	       THISFORM.LABEL2.CAPTION='截止支付科目'
            	       THISFORM.TEXT1.WIDTH=INT_015*180
            	       THISFORM.TEXT2.WIDTH=INT_015*180
                       THISFORM.TEXT1.VALUE=A40.F02
                       THISFORM.TEXT2.VALUE=A40.F02      
                       THISFORM.COMBOBOX041.WIDTH=INT_015*180
                       THISFORM.COMBOBOX042.WIDTH=INT_015*180                                                   
            CASE THIS.VALUE=4
                       THISFORM.LABEL1.VISIBLE=.F.  
                       THISFORM.LABEL2.VISIBLE=.F.  
	               THISFORM.LABEL11.VISIBLE=.F.  
	               THISFORM.LABEL21.VISIBLE=.F.                          
                       THISFORM.TEXT1.VISIBLE=.F.  
                       THISFORM.TEXT2.VISIBLE=.F.                         
                       THISFORM.COMBOBOX041.VISIBLE=.F.  
                       THISFORM.COMBOBOX042.VISIBLE=.F.                 
      ENDCASE   
  ENDPROC  
ENDDEFINE
**********************************************************新增科目
DEFINE CLASS SUBJECT_SEEK AS FORM
  AUTOCENTER=.T.
  CAPTION='新增科目'
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*370
  WIDTH=INT_015*280
  FONTSIZE=INT_015*9
  CONTROLBOX=.F.
  BORDERSTYLE=2
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WINDOWTYPE=1
  NAME='SUBJECT_SEEK'
  ADD OBJECT SHAPE1 AS SHAPE1 WITH;
      LEFT=INT_015*3,;
      WIDTH=INT_015*273,;
      HEIGHT=INT_015*65
  ADD OBJECT SHAPE2 AS SHAPE2 WITH;    
      LEFT=INT_015*3,;
      TOP=INT_015*67,;
      WIDTH=INT_015*273,;
      HEIGHT=INT_015*265
  ADD OBJECT SHAPE3 AS SHAPE3 WITH;
      LEFT=INT_015*3,;
      TOP=INT_015*334,;
      WIDTH=INT_015*273,;
      HEIGHT=INT_015*35    
  ADD OBJECT CMDGROUP AS CMDGROUP WITH;      
      TOP=INT_015*299,;
      LEFT=INT_015*50
  ADD OBJECT ORPGROUP AS ORPGROUP WITH;    
      TOP=INT_015*335,;
      LEFT=INT_015*50
  ADD OBJECT KEY_LIST AS KEY_LIST WITH;
      VISIBLE=.F.    
  ADD OBJECT LBLF04 AS LABEL WITH;
      TOP=INT_015*8,;
      LEFT=INT_015*10,;
      WIDTH=INT_015*50,;
      CAPTION='科目名稱'
  ADD OBJECT TXTF04 AS TEXTBOX WITH;
      TOP=INT_015*4,;
      LEFT=INT_015*61,;
      WIDTH=INT_015*200,;
      HEIGHT=INT_015*25,;
      MAXLENGTH=30,;
      NAME='TXTF04'      
  ADD OBJECT LBLF99 AS LABEL WITH;
      TOP=INT_015*36,;
      LEFT=INT_015*10,;
      WIDTH=INT_015*50,;
      CAPTION='安全資料'        
  ADD OBJECT LBLF991 AS LABEL WITH;
      TOP=INT_015*36,;
      LEFT=INT_015*61,;
      AUTOSIZE=.T.               
  ADD OBJECT SHRGROUP AS SHRGROUP WITH;
      TOP=INT_015*30,;
      LEFT=INT_015*180                
  ADD OBJECT GRID1 AS GRID WITH;        
      AUTOCENTER=.T.,;
      LEFT=INT_015*10,;
      TOP=INT_015*71,;
      WIDTH=INT_015*260,;      
      HEIGHT=INT_015*230,;      
      ROWHEIGHT=INT_015*18,;
      HEADERHEIGHT=INT_015*19,;      
      DELETEMARK=.F.,;
      READONLY=.T.,;
      RECORDSOURCETYPE=1,;
      COLUMNCOUNT=1,;            
      NAME='GRID1',;
      COLUMN1.NAME='COLUMN1'
  ADD OBJECT CMND2 AS COMMANDBUTTON WITH;
      LEFT=INT_015*181,;
      TOP=INT_015*340,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;
      CAPTION='\<X.離開',;
      TOOLTIPTEXT='取消此作業畫面!快速鍵->ALT+X'
      NAME='CMND2'
   ********   
      PROCEDURE INIT 
         THISFORM.SETALL('FONTSIZE',INT_015*9,'TEXTBOX') 
         THISFORM.SETALL('FONTSIZE',INT_015*9,'LABEL')          
         SELECT  A40
         SET FILTER TO F98='1'
         GO TOP
         THISFORM.GRID1.READONLY=.T. 
         THISFORM.GRID1.RECORDSOURCE='A40'
         THISFORM.CMDGROUP.SEEK_BOTT.VISIBLE=.F.
         THISFORM.ORPGROUP.PNT_BOTT.VISIBLE=.F.
         THISFORM.ORPGROUP.ESC_BOTT.VISIBLE=.F.
         THISFORM.SHRGROUP.VISIBLE=.F.
         THISFORM.SHRGROUP.ENABLED=.F.         
         THISFORM.SETALL('READONLY',.T.,'TEXTBOX')
         THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'COLUMN')
         THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'HEADER')         
         THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='科目名稱'
         THISFORM.GRID1.COLUMN1.WIDTH=INT_015*225
         THISFORM.GRID1.COLUMN1.CONTROLSOURCE='A40.F04'
         THISFORM.GRID1.SETFOCUS       
         FCH='GRID1'
         IF THISFORM.GRID1.ACTIVEROW=0
              THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
	      THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
	      THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
	      THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
	      THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.   
	      THISFORM.CMDGROUP.ENABLED=.F.             
              THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
              THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
              THISFORM.LBLF991.CAPTION='' 
         ELSE
              THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
	      THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
	      THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
	      THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
	      THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.             
              THISFORM.CMDGROUP.ENABLED=.T.         
              THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.T.                            
              THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.T.
         ENDIF                     
         THISFORM.CMND2.ENABLED=.T.       
         THISFORM.ORPGROUP.NEW_BOTT.ENABLED=.T.           
      ENDPROC
   *************   
      PROC GRID1.AFTERROWCOLCHANGE
         LPARAMETERS XColIndex     
         THISFORM.TXTF04.VALUE=A40.F04
         THISFORM.LBLF991.CAPTION=A40.F99
         FCH=THISFORM.ACTIVECONTROL.NAME 
         IF THIS.ACTIVEROW=0
              THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
	      THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
	      THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
	      THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
	      THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.   
              THISFORM.CMDGROUP.ENABLED=.F.
              THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
              THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
              THISFORM.TXTF04.VALUE=''
              THISFORM.LBLF991.CAPTION=''
         ELSE
              THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
	      THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
	      THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
	      THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
	      THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.             
              THISFORM.CMDGROUP.ENABLED=.T.         
              THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.T.                           
              THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.T.         
         ENDIF            
      ENDPROC 
********** 
      PROCEDURE CMND2.CLICK
         SELE A40
         SET FILTER TO
	 SELECT F04 FROM A40 WHERE F98='1' ORDER BY F04 INTO CURSOR A40_F04
	 SELECT A40
	 SET RELATION TO F03 INTO A01
	 IF  A02.F09<>'*'  &&判斷是否有權限可處理所有員工
	      SET FILTER TO F03=sys_oper  .AND. EMPTY(F98)
	 ELSE
	       SET FILTER TO  EMPTY(F98)
	 ENDIF         
         THISFORM.RELEASE         
      ENDPROC 
  *******       
      PROC ORPGROUP.NEW_BOTT.CLICK
           THISFORM.CMND2.ENABLED=.T.  
           THISFORM.GRID1.ENABLED=.F.
           THISFORM.TXTF04.READONLY=.F.
           THISFORM.TXTF04.VALUE=''
           THISFORM.TXTF04.SETFOCUS
           THISFORM.LBLF991.CAPTION=''     
      ENDPROC
  ********    
     PROC SHRGROUP.SHURE1_BOTT.CLICK
           IF EMPTY(THISFORM.TXTF04.VALUE)=.T.
               =MESSAGEBOX('科目名稱不得空白!',0+64,'提示訊息視窗')
               THISFORM.TXTF04.SETFOCUS
               RETURN              
           ENDIF
           IF INDEXSEEK(SPACE(10)+THISFORM.TXTF04.VALUE,.F.,'A40','A401')=.T.
               =MESSAGEBOX('此科目名稱已存在,請重新輸入!',0+64,'提示訊息視窗')
               THISFORM.TXTF04.SETFOCUS
               RETURN              
           ENDIF           
           SELECT  A40
           APPEND BLANK
           RLOCK()
           REPLACE  F04 WITH THISFORM.TXTF04.VALUE
           REPLACE  F98 WITH '1'
           REPLACE  F99 WITH IIF(INT_012=1,PADL(ALLTRIM(STR(YEAR(DATE())-1911)),3,' ')+RIGHT(DTOC(DATE()),6),dtoc(DATE())+' ')+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
           UNLOCK
          THISFORM.SHRGROUP.ABANDON_BOTT.CLICK    
      ENDPROC         
   ******     
      PROC ORPGROUP.EDIT_BOTT.CLICK
           THISFORM.CMND2.ENABLED=.F.     
           THISFORM.GRID1.ENABLED=.F. 
           SELECT  A40
           RLOCK()
           IF !RLOCK()
               DO file_impact
               THISFORM.GRID1.SETFOCUS
               THISFORM.SHRGROUP.ABANDON_BOTT.CLICK 
           ELSE
               THISFORM.TXTF04.READONLY=.F.
               THISFORM.TXTF04.SETFOCUS   
           ENDIF                 
      ENDPROC  
**********
      PROC SHRGROUP.SHURE2_BOTT.CLICK
           SELE A40
           REPLACE  F04 WITH THISFORM.TXTF04.VALUE
           REPLACE  F99 WITH IIF(INT_012=1,PADL(ALLTRIM(STR(YEAR(DATE())-1911)),3,' ')+RIGHT(DTOC(DATE()),6),dtoc(DATE())+' ')+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
           THISFORM.SHRGROUP.ABANDON_BOTT.CLICK    
      ENDPROC      
   *******         
      PROC ORPGROUP.DEL_BOTT.CLICK
           IF MESSAGEBOX('是否確定要刪除此筆資料',4+32+256,'請確認') = 6	            
              SELECT  A40            
              IF RLOCK()                
                  SELECT  A40
                  DELE
                  UNLOCK             
                  IF BOF()
                       GO TOP
                   ELSE
                       SKIP -1   
                   ENDIF   
              ELSE
                   DO file_impact                             
              ENDIF         
              THISFORM.GRID1.SETFOCUS
              IF THISFORM.GRID1.ACTIVEROW=0
                 THISFORM.CMDGROUP.ENABLED=.F.
                 THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
                 THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.   
                 THISFORM.ORPGROUP.NEW_BOTT.ENABLED=.T.            
                 THISFORM.SETALL('VALUE','','TEXTBOX')
                 THISFORM.LBLF991.CAPTION=''
              ELSE      
                 THISFORM.CMDGROUP.ENABLED=.T.
                 THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.T.
                 THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.T.
              ENDIF           
           ENDIF   
      ENDPROC
    ***********  
      PROC SHRGROUP.ABANDON_BOTT.CLICK
           THISFORM.SHRGROUP.ENABLED=.F.
           THISFORM.SHRGROUP.VISIBLE=.F.      
           THISFORM.ORPGROUP.ENABLED=.T.
           THISFORM.ORPGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
           THISFORM.CMDGROUP.ENABLED=.T.
           THISFORM.CMDGROUP.SETALL('ENABLED',.T.,'COMMANDBUTTON')
           THISFORM.CMDGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
           THISFORM.SETALL('READONLY',.T.,'TEXTBOX')   
           THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.T.                  
           THISFORM.CMND2.ENABLED=.T.                                                                  
           THISFORM.GRID1.ENABLED=.T.
           THISFORM.GRID1.SETFOCUS     
            IF THISFORM.GRID1.ACTIVEROW=0
                THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
	        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
	        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
	        THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
	        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.   
                THISFORM.CMDGROUP.ENABLED=.F.
                THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
                THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
                THISFORM.TXTF04.VALUE=''
                THISFORM.LBLF991.CAPTION=''
            ELSE
                THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
	        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
	        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
	        THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
	        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.             
                THISFORM.CMDGROUP.ENABLED=.T.         
                THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.T.                           
                THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.T.         
            ENDIF              
           UNLOCK ALL      
      ENDPROC
      PROC SHRGROUP.FINISH_BOTT.CLICK
           THISFORM.SHRGROUP.ABANDON_BOTT.CLICK
      ENDPROC          
ENDDEFINE     
