**程式名稱:C66.入貨異動記錄
SET EXCL OFF
CLOSE ALL
CLEAR 
AREA1='C66A'
CH = '1'
FLG='0'
FCH=''
CHK=''
HK=''
C2 = ''
D1 = ''
D2 = ''
IF !USED('A01')
   SELE 0
   USE A01
ELSE 
   SELE A01
ENDIF
SET ORDER TO A01  
IF !USED('A02')
   SELE 0
   USE A02 INDE A02
ELSE
   SELE A02
ENDIF
SET ORDER TO A021    
SEEK SYS_OPER+'C66' 
IF !USED('A23')	&&月份檔
    SELECT  0
    USE A23
ELSE 
   SELECT  A23
ENDIF
SET ORDER TO A231
IF !USED('C01')
   SELE 0
   USE C01
ELSE 
   SELE C01
ENDIF
SET ORDER TO C011
IF !USED('C03')
   SELE 0
   USE C03 
ELSE 
   SELE C03 
ENDIF
SET ORDER TO C031
IF !USED('D01')
   SELE 0
   USE D01
ELSE
   SELE D01
ENDIF
SET ORDER TO D011
IF !USED('D07')
   SELE 0
   USE D07 
ELSE
   SELE D07
ENDIF
SET ORDER TO D074
IF !USED('P05')
   SELE 0
   USE P05
ELSE 
   SELE P05
ENDIF
SET ORDER TO P051
IF !USED('C66')
   SELE 0
   USE C66
ELSE 
   SELE C66
ENDIF
SET ORDER TO C661
DELETE FROM C66 WHERE F12+F04 NOT IN(SELE F01+F02 FROM D07)   &&一進入畫面若發現進貨計劃已無此資料即刪除
SELECT C66.*,ICASE(F08 = 'A','海運    ',F08 = 'B','海運提前',F08 = 'C','空運    ',F08 = 'D','空運提前',F08 = 'E','快遞    ',F08 = 'F','快遞提前',F08 = 'G','海運延後',F08 = 'H','空運延後',F08 = 'J','快遞延後',SPACE(8)) AS F088;
	   FROM C66 WHERE F02 = CH AND LEFT(DTOS(F03),6) = LEFT(DTOS(DATE()),6) INTO CURSOR C66A READWRITE
INDEX ON F04 + F11 + F02 + DTOS(F03) TAG C66A1
INDEX ON F11 + F04 + F02 + DTOS(F03) TAG C66A2
INDEX ON F13 + F04 + F02 + DTOS(F03) TAG C66A3
INDEX ON F20 + F04 + F02 + DTOS(F03) TAG C66A4
INDEX ON F02 +DTOS(F03) + F04 + ALLTRIM(TRANSFORM(F05,"@R 99,999,999.99")) + F08 + F10 + F11 + F12 + F13 TAG C66A5
SELECT C66A
SET ORDER TO C66A1
COD = SYS(21)
GO TOP
*******
C66FORM=CREATEOBJECT("TKC66")
C66FORM.SHOW  
DEFINE CLASS TKC66 AS FORM
  CAPTION='C66.入貨異動記錄'
*!*	  AUTOCENTER=.T.
  CONTROLBOX=.F.
  BORDERSTYLE=1  
  MAXBUTTON=.F.
  MINBUTTON=.F.
  MOVABLE=.F.
  CLOSABLE=.F.
  CONTROLCOUNT=57
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*550
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WIDTH=INT_015*791
  WINDOWTYPE=1
  ADD OBJECT KEY_LIST1 AS KEY_LIST WITH;
      TOP=INT_015*5,; 
      WIDTH=INT_015*160,;
      AUTOCENTER=.T.
  ADD OBJECT KEY_LIST AS KEY_LIST WITH;
      TOP=INT_015*33,;
      WIDTH=INT_015*96,;
      AUTOCENTER=.T.
  ADD OBJECT MTH_LIST AS MTH_LIST WITH;
      TOP=INT_015*33,;
      LEFT=INT_015*105,;
      WIDTH=INT_015*63,;
      AUTOCENTER=.T.          
  ADD OBJECT GRID1 AS GRID1 WITH;
      COLUMNCOUNT=14,;            
      RECORDSOURCE='C66A',;
      TOP=INT_015*86,; 
      HEIGHT=INT_015*440,;     
      WIDTH=INT_015*780,;      
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;
      COLUMN3.NAME='COLUMN3',; 
      COLUMN4.NAME='COLUMN4',; 
      COLUMN5.NAME='COLUMN5',;             
      COLUMN6.NAME='COLUMN6',;       
      COLUMN7.NAME='COLUMN7',;       
      COLUMN8.NAME='COLUMN8',;
      COLUMN9.NAME='COLUMN9',;   
      COLUMN10.NAME='COLUMN10',;
      COLUMN11.NAME='COLUMN11',;
      COLUMN12.NAME='COLUMN12',;
      COLUMN13.NAME='COLUMN13',;
      COLUMN14.NAME='COLUMN14'
   ADD OBJECT LBLF09 AS LABEL WITH;
      TOP=INT_015*38,;
      LEFT=INT_015*175,;
      HEIGHT=INT_015*17,;      
      WIDTH=INT_015*60,;
      FONTSIZE=INT_015*9,;
       CAPTION='回覆交期'            
  ADD OBJECT TXTF09 AS TEXTBOX WITH;
      TOP=INT_015*33,;
      LEFT=INT_015*225,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*65,;
      MAXLENGTH=8,;
      FONTSIZE=INT_015*9
   ADD OBJECT LBLF16 AS LABEL WITH;
      TOP=INT_015*38,;
      LEFT=INT_015*295,;
      HEIGHT=INT_015*17,;      
      WIDTH=INT_015*60,;
      FONTSIZE=INT_015*9,;
       CAPTION='回覆數量'            
  ADD OBJECT TXTF16 AS TEXTBOX WITH;
      TOP=INT_015*33,;
      LEFT=INT_015*345,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*80,;
      INPUTMASK='99999999.99',;
      FONTSIZE=INT_015*9
  ADD OBJECT LBLF14 AS LABEL WITH;
      TOP=INT_015*65,;
      LEFT=INT_015*175,;
      HEIGHT=INT_015*20,;      
      WIDTH=INT_015*60,;
      FONTSIZE=INT_015*9,;
      CAPTION='備註說明'     
  ADD OBJECT TXTF14 AS TEXTBOX WITH;
      TOP=INT_015*59,;
      LEFT=INT_015*225,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*440,;
      MAXLENGTH=80,;
      FONTSIZE=INT_015*9   
  ADD OBJECT LBLF01 AS LABEL WITH;
      TOP=INT_015*65,;
      LEFT=INT_015*10,;
      HEIGHT=INT_015*18,;      
      AUTOSIZE=.T.,;
      FONTSIZE=INT_015*9,;
      BACKCOLOR = RGB(255,255,0),;
      CAPTION='異動狀態：'   
  ADD OBJECT LBLF99 AS LABEL WITH;
      TOP=INT_015*38,;
      LEFT=INT_015*430,;
      HEIGHT=INT_015*18,;      
      WIDTH=INT_015*60,;
      FONTSIZE=INT_015*9,;
      CAPTION='安全資料'   
  ADD OBJECT LBLF991 AS LABEL WITH;
      TOP=INT_015*38,;
      LEFT=INT_015*480,;
      HEIGHT=INT_015*18,;      
      WIDTH=INT_015*100,;
      FONTSIZE=INT_015*9,;
      CAPTION=''   
  ADD OBJECT LBLF98 AS LABEL WITH;
      TOP=INT_015*38,;
      LEFT=INT_015*600,;
      HEIGHT=INT_015*17,;      
      WIDTH=INT_015*60,;
      FONTSIZE=INT_015*9,;
      CAPTION='回覆安資'   
  ADD OBJECT LBLF981 AS LABEL WITH;
      TOP=INT_015*38,;
      LEFT=INT_015*650,;
      HEIGHT=INT_015*17,;      
      WIDTH=INT_015*100,;
      FONTSIZE=INT_015*9,;
      CAPTION=''          
   ADD OBJECT CMDGROUP AS CMDGROUP WITH;
      TOP=INT_015*0,;
      LEFT=INT_015*165,;
      ENABLED=.T.,;
      VISIBLE=.T.            
  ADD OBJECT ORPGROUP AS ORPGROUP WITH;
      TOP=INT_015*0,;
      LEFT=INT_015*443    
  ADD OBJECT INSCH AS COMMANDBUTTON WITH;
      TOP=INT_015*5,;
      LEFT=INT_015*507,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*65,;
      FONTSIZE=INT_015*9,;
      CAPTION='\<A.進貨計畫'   
  ADD OBJECT DEL_BOT AS COMMANDBUTTON WITH;
      TOP=INT_015*5,;
      LEFT=INT_015*380,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\harrow.cur',;           
      CAPTION='\<D.刪除'    
  ADD OBJECT REPLY_REMARK AS COMMANDBUTTON WITH;
      TOP=INT_015*5,;
      LEFT=INT_015*422,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;
      CAPTION='\<E.修改' 
  ADD OBJECT CHANGE_BOT AS COMMANDBUTTON WITH;
      TOP=INT_015*5,;
      LEFT=INT_015*465,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\harrow.cur',;           
      CAPTION='\<C.異動'  
  ADD OBJECT YES AS COMMANDBUTTON WITH;
      TOP=INT_015*5,;
      LEFT=INT_015*700,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;
      CAPTION='\<Y.確定'
  ADD OBJECT NO AS COMMANDBUTTON WITH;
      TOP=INT_015*5,;
      LEFT=INT_015*742,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;
      CAPTION='\<N.取消'                                                                         
  PROCEDURE INIT
       THISFORM.ORPGROUP.NEW_BOTT.VISIBLE=.F.
       THISFORM.ORPGROUP.EDIT_BOTT.VISIBLE=.F.
       THISFORM.ORPGROUP.DEL_BOTT.VISIBLE=.F.
       THISFORM.YES.VISIBLE=.F.
       THISFORM.NO.VISIBLE=.F.
       THISFORM.GRID1.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)
       THISFORM.SETALL('READONLY',.T.,'TEXTBOX') 
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'COLUMN')
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'HEADER') 
       HK = ALLTRIM(THISFORM.MTH_LIST.DISPLAYVALUE)  
       THISFORM.GRID1.LOCKCOLUMNS=2
       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*149
       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*60
       THISFORM.GRID1.COLUMN3.WIDTH=INT_015*70
       THISFORM.GRID1.COLUMN4.WIDTH=INT_015*60
       THISFORM.GRID1.COLUMN5.WIDTH=INT_015*60
       THISFORM.GRID1.COLUMN6.WIDTH=INT_015*60
       THISFORM.GRID1.COLUMN7.WIDTH=INT_015*60
       THISFORM.GRID1.COLUMN8.WIDTH=INT_015*70
       THISFORM.GRID1.COLUMN9.WIDTH=INT_015*80
       THISFORM.GRID1.COLUMN10.WIDTH=INT_015*60       
       THISFORM.GRID1.COLUMN11.WIDTH=INT_015*55
       THISFORM.GRID1.COLUMN12.WIDTH=INT_015*55
       THISFORM.GRID1.COLUMN13.WIDTH=INT_015*55
       THISFORM.GRID1.COLUMN14.WIDTH=INT_015*75
       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='料號'
       THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='異動日期'
       THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='異動數量'	   
       THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='原訂交期'	   
       THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='希望交期'
       THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='載運方式'
       THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='回覆交期'     
       THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='回覆數量' 
       THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='回覆說明'
       THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='客戶簡稱'  
       THISFORM.GRID1.COLUMN11.HEADER1.CAPTION='業務'+ALLTRIM(INT_209)  
       THISFORM.GRID1.COLUMN12.HEADER1.CAPTION='業助姓名'
       THISFORM.GRID1.COLUMN13.HEADER1.CAPTION='廠商簡稱'    
       THISFORM.GRID1.COLUMN14.HEADER1.CAPTION='採購單號'
       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='C66A.F04'	   	
       THISFORM.GRID1.COLUMN2.CONTROLSOURCE='C66A.F03'
       THISFORM.GRID1.COLUMN3.CONTROLSOURCE='C66A.F05'
       THISFORM.GRID1.COLUMN4.CONTROLSOURCE='C66A.F06'
       THISFORM.GRID1.COLUMN5.CONTROLSOURCE='C66A.F07'
       THISFORM.GRID1.COLUMN6.CONTROLSOURCE='C66A.F088'
       THISFORM.GRID1.COLUMN7.CONTROLSOURCE='C66A.F09'
       THISFORM.GRID1.COLUMN8.CONTROLSOURCE='C66A.F16'
       THISFORM.GRID1.COLUMN9.CONTROLSOURCE='C66A.F15'
       THISFORM.GRID1.COLUMN10.CONTROLSOURCE="IIF(SEEK(C66A.F11,'C01'),C01.F05,C66A.F11)"
       THISFORM.GRID1.COLUMN11.CONTROLSOURCE="IIF(SEEK(C66A.F13,'A01'),A01.F03,C66A.F13)"
       THISFORM.GRID1.COLUMN12.CONTROLSOURCE="IIF(SEEK(C66A.F20,'A01'),A01.F03,C66A.F20)"
       THISFORM.GRID1.COLUMN13.CONTROLSOURCE="IIF(SEEK(C66A.F18,'D01'),D01.F04,C66A.F18)"
       THISFORM.GRID1.COLUMN14.CONTROLSOURCE='C66A.F12'
       THISFORM.GRID1.READONLY=.T.       
       THISFORM.GRID1.SETFOCUS    
       IF THISFORM.GRID1.ACTIVEROW=0 
          THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
	      THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
	      THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
	      THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.    
	      THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.	        
	      THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F. 
	      THISFORM.REPLY_REMARK.ENABLED=.F.  
	      THISFORM.DEL_BOT.ENABLED=.F.
	      THISFORM.CHANGE_BOT.ENABLED=.F.
	      THISFORM.INSCH.ENABLED=.F.&&進貨計劃
      	  THISFORM.TXTF09.VALUE=''
          THISFORM.TXTF14.VALUE=''
          THISFORM.TXTF16.VALUE=''
          THISFORM.LBLF991.CAPTION=''
          THISFORM.LBLF981.CAPTION=''
        ELSE
          THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
	      THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
	      THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
	      THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.    
	      THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.	        
	      THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限 
	      THISFORM.REPLY_REMARK.ENABLED=IIF(A02.F05='*',.T.,.F.) AND (A02.F09 = '*' OR IIF(SEEK(C66A.F11,'C01'),C01.F18 = SYS_OPER OR C01.F23 = SYS_OPER OR C01.F33 = SYS_OPER,.F.) OR C66A.F13 = SYS_OPER)
	      THISFORM.DEL_BOT.ENABLED=IIF(A02.F06='*',.T.,.F.) AND (A02.F09 = '*' OR IIF(SEEK(C66A.F11,'C01'),C01.F18 = SYS_OPER OR C01.F23 = SYS_OPER OR C01.F33 = SYS_OPER,.F.) OR C66A.F13 = SYS_OPER)
	      THISFORM.CHANGE_BOT.ENABLED = A02.F09 = '*' OR IIF(SEEK(C66A.F11,'C01'),C01.F18 = SYS_OPER OR C01.F23 = SYS_OPER OR C01.F33 = SYS_OPER,.F.) OR C66A.F13 = SYS_OPER
	      THISFORM.INSCH.ENABLED=.T.&&進貨計劃
	      THISFORM.TXTF09.VALUE=C66A.F09
          THISFORM.TXTF14.VALUE=C66A.F14
          THISFORM.TXTF16.VALUE=C66A.F16
          THISFORM.LBLF991.CAPTION=C66A.F99
          THISFORM.LBLF981.CAPTION=C66A.F98
          THISFORM.LBLF01.CAPTION='異動狀態：' + IIF(C66A.F01 = 0,'尚未列印',IIF(!EMPTY(C66A.F09),'已回覆','已列印'))
        ENDIF   
       JK='料號'
  ENDPROC 
*********** 
  PROC GRID1.AFTERROWCOLCHANGE
       LPARAMETERS NCOLINDEX
       SELECT C66A
       THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","ICASE(EMPTY(C66A.F09) = .T.,RGB(255,255,0),EMPTY(C66A.F09) = .F. AND (C66A.F09 > C66A.F07 OR C66A.F16 < C66A.F05),RGB(255,0,0),'')","COLUMN")   
       THISFORM.GRID1.TOOLTIPTEXT=ICASE(EMPTY(C66A.F09) = .T.,'尚未回覆交期',EMPTY(C66A.F09) = .F. AND (C66A.F09 > C66A.F07 OR C66A.F16 < C66A.F05),'回覆之交期或數量不符合希望交期或異動數量','')
       THISFORM.TXTF09.VALUE=C66A.F09
       THISFORM.TXTF14.VALUE=C66A.F14
       THISFORM.TXTF16.VALUE=C66A.F16
       THISFORM.LBLF991.CAPTION=C66A.F99  
       THISFORM.LBLF981.CAPTION=C66A.F98     
       THISFORM.LBLF01.CAPTION='異動狀態：' + IIF(C66A.F01 = 0,'尚未列印',IIF(!EMPTY(C66A.F09),'已回覆','已列印'))
	   THISFORM.REPLY_REMARK.ENABLED=IIF(A02.F05='*',.T.,.F.) AND (A02.F09 = '*' OR IIF(SEEK(C66A.F11,'C01'),C01.F18 = SYS_OPER OR C01.F23 = SYS_OPER OR C01.F33 = SYS_OPER,.F.) OR C66A.F13 = SYS_OPER)
	   THISFORM.DEL_BOT.ENABLED=IIF(A02.F06='*',.T.,.F.) AND (A02.F09 = '*' OR IIF(SEEK(C66A.F11,'C01'),C01.F18 = SYS_OPER OR C01.F23 = SYS_OPER OR C01.F33 = SYS_OPER,.F.) OR C66A.F13 = SYS_OPER)
	   THISFORM.CHANGE_BOT.ENABLED = A02.F09 = '*' OR IIF(SEEK(C66.F11,'C01'),C01.F18 = SYS_OPER OR C01.F23 = SYS_OPER OR C01.F33 = SYS_OPER,.F.) OR C66A.F13 = SYS_OPER
       FCH=THISFORM.ACTIVECONTROL.NAME
       CHK=''
       THISFORM.REFRESH
  ENDPROC   
  PROC KEY_LIST1.INIT 
       WITH THIS 
           .ADDITEM('依料號+客戶編號排列')
           .ADDITEM('依客戶編號+料號排列')
           .ADDITEM('依業務'+ALLTRIM(INT_209)+'編號+料號排列') 
           .ADDITEM('依業助編號+料號排列')
           .VALUE=1      
       ENDWITH      
  ENDPROC 
  PROC KEY_LIST1.INTERACTIVECHANGE                 
       SELECT  C66A
       DO CASE
       	  CASE THIS.DISPLAYVALUE='依料號+客戶編號排列'
       	  	   SET ORDER TO C66A1
		       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*149
		       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*60
		       THISFORM.GRID1.COLUMN3.WIDTH=INT_015*70
		       THISFORM.GRID1.COLUMN4.WIDTH=INT_015*60
		       THISFORM.GRID1.COLUMN5.WIDTH=INT_015*60
		       THISFORM.GRID1.COLUMN6.WIDTH=INT_015*IIF(CH ='4',110,60)
		       THISFORM.GRID1.COLUMN7.WIDTH=INT_015*60
		       THISFORM.GRID1.COLUMN8.WIDTH=INT_015*70
		       THISFORM.GRID1.COLUMN9.WIDTH=INT_015*80
		       THISFORM.GRID1.COLUMN10.WIDTH=INT_015*60       
		       THISFORM.GRID1.COLUMN11.WIDTH=INT_015*55
		       THISFORM.GRID1.COLUMN12.WIDTH=INT_015*55
		       THISFORM.GRID1.COLUMN13.WIDTH=INT_015*55
		       THISFORM.GRID1.COLUMN14.WIDTH=INT_015*75
		       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='料號'
		       THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='異動日期'
		       THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='異動數量'	   
		       THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='原訂交期'	   
		       THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='希望交期'
		       THISFORM.GRID1.COLUMN6.HEADER1.CAPTION=IIF(CH ='4','異動類別+載運方式','載運方式')
		       THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='回覆交期'     
		       THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='回覆數量' 
		       THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='回覆說明'
		       THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='客戶簡稱'  
		       THISFORM.GRID1.COLUMN11.HEADER1.CAPTION='業務'+ALLTRIM(INT_209)      
		       THISFORM.GRID1.COLUMN12.HEADER1.CAPTION='業助姓名'
		       THISFORM.GRID1.COLUMN13.HEADER1.CAPTION='廠商簡稱'    
		       THISFORM.GRID1.COLUMN14.HEADER1.CAPTION='採購單號'
		       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='C66A.F04'	   	
		       THISFORM.GRID1.COLUMN2.CONTROLSOURCE='C66A.F03'
		       THISFORM.GRID1.COLUMN3.CONTROLSOURCE='C66A.F05'
		       THISFORM.GRID1.COLUMN4.CONTROLSOURCE='C66A.F06'
		       THISFORM.GRID1.COLUMN5.CONTROLSOURCE='C66A.F07'
		       THISFORM.GRID1.COLUMN6.CONTROLSOURCE="IIF(CH ='4',ICASE(C66A.F02 = '1','提前交期,',C66A.F02 = '2','延後交期,','取消請購') + C66A.F088,C66A.F088)"
		       THISFORM.GRID1.COLUMN7.CONTROLSOURCE='C66A.F09'
		       THISFORM.GRID1.COLUMN8.CONTROLSOURCE='C66A.F16'
		       THISFORM.GRID1.COLUMN9.CONTROLSOURCE='C66A.F15'
		       THISFORM.GRID1.COLUMN10.CONTROLSOURCE="IIF(SEEK(C66A.F11,'C01'),C01.F05,C66A.F11)"
		       THISFORM.GRID1.COLUMN11.CONTROLSOURCE="IIF(SEEK(C66A.F13,'A01'),A01.F03,C66A.F13)"
		       THISFORM.GRID1.COLUMN12.CONTROLSOURCE="IIF(SEEK(C66A.F20,'A01'),A01.F03,C66A.F13)"
		       THISFORM.GRID1.COLUMN13.CONTROLSOURCE="IIF(SEEK(C66A.F18,'D01'),D01.F04,C66A.F18)"
		       THISFORM.GRID1.COLUMN14.CONTROLSOURCE='C66A.F12'
		       JK = '料號'
       	  CASE THIS.DISPLAYVALUE='依客戶編號+料號排列'
       	  	   SET ORDER TO C66A2
       	  	   THISFORM.GRID1.COLUMN1.WIDTH=INT_015*60		       
		       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*149
		       THISFORM.GRID1.COLUMN3.WIDTH=INT_015*60
		       THISFORM.GRID1.COLUMN4.WIDTH=INT_015*70
		       THISFORM.GRID1.COLUMN5.WIDTH=INT_015*60
		       THISFORM.GRID1.COLUMN6.WIDTH=INT_015*60
		       THISFORM.GRID1.COLUMN7.WIDTH=INT_015*IIF(CH ='4',110,60)
		       THISFORM.GRID1.COLUMN8.WIDTH=INT_015*60
		       THISFORM.GRID1.COLUMN9.WIDTH=INT_015*70
		       THISFORM.GRID1.COLUMN10.WIDTH=INT_015*80      
		       THISFORM.GRID1.COLUMN11.WIDTH=INT_015*55
		       THISFORM.GRID1.COLUMN12.WIDTH=INT_015*55
		       THISFORM.GRID1.COLUMN13.WIDTH=INT_015*55
		       THISFORM.GRID1.COLUMN14.WIDTH=INT_015*75
		       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='客戶簡稱'
		       THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='料號'
		       THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='異動日期'
		       THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='異動數量'	   
		       THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='原訂交期'	   
		       THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='希望交期'
		       THISFORM.GRID1.COLUMN7.HEADER1.CAPTION=IIF(CH ='4','異動類別+載運方式','載運方式')
		       THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='回覆交期'     
		       THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='回覆數量' 
		       THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='回覆說明' 
		       THISFORM.GRID1.COLUMN11.HEADER1.CAPTION='業務'+ALLTRIM(INT_209)   
		       THISFORM.GRID1.COLUMN12.HEADER1.CAPTION='業助姓名'      
		       THISFORM.GRID1.COLUMN13.HEADER1.CAPTION='廠商簡稱'    
		       THISFORM.GRID1.COLUMN14.HEADER1.CAPTION='採購單號'
		       THISFORM.GRID1.COLUMN1.CONTROLSOURCE="IIF(SEEK(C66A.F11,'C01'),C01.F05,C66A.F11)"
		       THISFORM.GRID1.COLUMN2.CONTROLSOURCE='C66A.F04'	   	
		       THISFORM.GRID1.COLUMN3.CONTROLSOURCE='C66A.F03'
		       THISFORM.GRID1.COLUMN4.CONTROLSOURCE='C66A.F05'
		       THISFORM.GRID1.COLUMN5.CONTROLSOURCE='C66A.F06'
		       THISFORM.GRID1.COLUMN6.CONTROLSOURCE='C66A.F07'
		       THISFORM.GRID1.COLUMN7.CONTROLSOURCE="IIF(CH ='4',ICASE(C66A.F02 = '1','提前交期,',C66A.F02 = '2','延後交期,','取消請購') + C66A.F088,C66A.F088)"
		       THISFORM.GRID1.COLUMN8.CONTROLSOURCE='C66A.F09'
		       THISFORM.GRID1.COLUMN9.CONTROLSOURCE='C66A.F16'
		       THISFORM.GRID1.COLUMN10.CONTROLSOURCE='C66A.F15'
		       THISFORM.GRID1.COLUMN11.CONTROLSOURCE="IIF(SEEK(C66A.F13,'A01'),A01.F03,C66A.F13)" 
		       THISFORM.GRID1.COLUMN12.CONTROLSOURCE="IIF(SEEK(C66A.F20,'A01'),A01.F03,C66A.F20)"
		       THISFORM.GRID1.COLUMN13.CONTROLSOURCE="IIF(SEEK(C66A.F18,'D01'),D01.F04,C66A.F18)"
		       THISFORM.GRID1.COLUMN14.CONTROLSOURCE='C66A.F12'
		       JK = '客戶編號'     
       	  CASE THIS.DISPLAYVALUE='依業務'+ALLTRIM(INT_209)+'編號+料號排列'
       	  	   SET ORDER TO C66A3
       	  	   THISFORM.GRID1.COLUMN1.WIDTH=INT_015*55
		       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*149   
		       THISFORM.GRID1.COLUMN3.WIDTH=INT_015*60
		       THISFORM.GRID1.COLUMN4.WIDTH=INT_015*70
		       THISFORM.GRID1.COLUMN5.WIDTH=INT_015*60
		       THISFORM.GRID1.COLUMN6.WIDTH=INT_015*60
		       THISFORM.GRID1.COLUMN7.WIDTH=INT_015*IIF(CH ='4',110,60)
		       THISFORM.GRID1.COLUMN8.WIDTH=INT_015*60
		       THISFORM.GRID1.COLUMN9.WIDTH=INT_015*70
		       THISFORM.GRID1.COLUMN10.WIDTH=INT_015*80
		       THISFORM.GRID1.COLUMN11.WIDTH=INT_015*60  
		       THISFORM.GRID1.COLUMN12.WIDTH=INT_015*55     
		       THISFORM.GRID1.COLUMN13.WIDTH=INT_015*55
		       THISFORM.GRID1.COLUMN14.WIDTH=INT_015*75
		       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='業務'+ALLTRIM(INT_209)
		       THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='料號'
		       THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='異動日期'
		       THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='異動數量'	   
		       THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='原訂交期'	   
		       THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='希望交期'
		       THISFORM.GRID1.COLUMN7.HEADER1.CAPTION=IIF(CH ='4','異動類別+載運方式','載運方式')
		       THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='回覆交期'     
		       THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='回覆數量' 
		       THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='回覆說明'
		       THISFORM.GRID1.COLUMN11.HEADER1.CAPTION='客戶簡稱'   
		       THISFORM.GRID1.COLUMN12.HEADER1.CAPTION='業助姓名'  
		       THISFORM.GRID1.COLUMN13.HEADER1.CAPTION='廠商簡稱'    
		       THISFORM.GRID1.COLUMN14.HEADER1.CAPTION='採購單號'
		       THISFORM.GRID1.COLUMN1.CONTROLSOURCE="IIF(SEEK(C66A.F13,'A01'),A01.F03,C66A.F13)"
		       THISFORM.GRID1.COLUMN2.CONTROLSOURCE='C66A.F04'	   	
		       THISFORM.GRID1.COLUMN3.CONTROLSOURCE='C66A.F03'
		       THISFORM.GRID1.COLUMN4.CONTROLSOURCE='C66A.F05'
		       THISFORM.GRID1.COLUMN5.CONTROLSOURCE='C66A.F06'
		       THISFORM.GRID1.COLUMN6.CONTROLSOURCE='C66A.F07'
		       THISFORM.GRID1.COLUMN7.CONTROLSOURCE="IIF(CH ='4',ICASE(C66A.F02 = '1','提前交期,',C66A.F02 = '2','延後交期,','取消請購') + C66A.F088,C66A.F088)"
		       THISFORM.GRID1.COLUMN8.CONTROLSOURCE='C66A.F09'
		       THISFORM.GRID1.COLUMN9.CONTROLSOURCE='C66A.F16'
		       THISFORM.GRID1.COLUMN10.CONTROLSOURCE='C66A.F15'
		       THISFORM.GRID1.COLUMN11.CONTROLSOURCE="IIF(SEEK(C66A.F11,'C01'),C01.F05,C66A.F11)"
		       THISFORM.GRID1.COLUMN12.CONTROLSOURCE="IIF(SEEK(C66A.F20,'A01'),A01.F03,C66A.F20)"
		       THISFORM.GRID1.COLUMN13.CONTROLSOURCE="IIF(SEEK(C66A.F18,'D01'),D01.F04,C66A.F18)"
		       THISFORM.GRID1.COLUMN14.CONTROLSOURCE='C66A.F12'
		       JK = '業務' + ALLTRIM(INT_209) + '編號' 	  
       	  CASE THIS.DISPLAYVALUE='依業助編號+料號排列'
       	  	   SET ORDER TO C66A4
       	  	   THISFORM.GRID1.COLUMN1.WIDTH=INT_015*55
		       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*149   
		       THISFORM.GRID1.COLUMN3.WIDTH=INT_015*60
		       THISFORM.GRID1.COLUMN4.WIDTH=INT_015*70
		       THISFORM.GRID1.COLUMN5.WIDTH=INT_015*60
		       THISFORM.GRID1.COLUMN6.WIDTH=INT_015*60
		       THISFORM.GRID1.COLUMN7.WIDTH=INT_015*IIF(CH ='4',110,60)
		       THISFORM.GRID1.COLUMN8.WIDTH=INT_015*60
		       THISFORM.GRID1.COLUMN9.WIDTH=INT_015*70
		       THISFORM.GRID1.COLUMN10.WIDTH=INT_015*80
		       THISFORM.GRID1.COLUMN11.WIDTH=INT_015*60  
		       THISFORM.GRID1.COLUMN12.WIDTH=INT_015*55     
		       THISFORM.GRID1.COLUMN13.WIDTH=INT_015*55
		       THISFORM.GRID1.COLUMN14.WIDTH=INT_015*75
		       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='業助姓名'
		       THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='料號'
		       THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='異動日期'
		       THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='異動數量'	   
		       THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='原訂交期'	   
		       THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='希望交期'
		       THISFORM.GRID1.COLUMN7.HEADER1.CAPTION=IIF(CH ='4','異動類別+載運方式','載運方式')
		       THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='回覆交期'     
		       THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='回覆數量' 
		       THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='回覆說明'
		       THISFORM.GRID1.COLUMN11.HEADER1.CAPTION='客戶簡稱'   
		       THISFORM.GRID1.COLUMN12.HEADER1.CAPTION='業務'+ALLTRIM(INT_209)  
		       THISFORM.GRID1.COLUMN13.HEADER1.CAPTION='廠商簡稱'    
		       THISFORM.GRID1.COLUMN14.HEADER1.CAPTION='採購單號'
		       THISFORM.GRID1.COLUMN1.CONTROLSOURCE="IIF(SEEK(C66A.F20,'A01'),A01.F03,C66A.F20)"
		       THISFORM.GRID1.COLUMN2.CONTROLSOURCE='C66A.F04'	   	
		       THISFORM.GRID1.COLUMN3.CONTROLSOURCE='C66A.F03'
		       THISFORM.GRID1.COLUMN4.CONTROLSOURCE='C66A.F05'
		       THISFORM.GRID1.COLUMN5.CONTROLSOURCE='C66A.F06'
		       THISFORM.GRID1.COLUMN6.CONTROLSOURCE='C66A.F07'
		       THISFORM.GRID1.COLUMN7.CONTROLSOURCE="IIF(CH ='4',ICASE(C66A.F02 = '1','提前交期,',C66A.F02 = '2','延後交期,','取消請購') + C66A.F088,C66A.F088)"
		       THISFORM.GRID1.COLUMN8.CONTROLSOURCE='C66A.F09'
		       THISFORM.GRID1.COLUMN9.CONTROLSOURCE='C66A.F16'
		       THISFORM.GRID1.COLUMN10.CONTROLSOURCE='C66A.F15'
		       THISFORM.GRID1.COLUMN11.CONTROLSOURCE="IIF(SEEK(C66A.F11,'C01'),C01.F05,C66A.F11)"
		       THISFORM.GRID1.COLUMN12.CONTROLSOURCE="IIF(SEEK(C66A.F13,'A01'),A01.F03,C66A.F13)"
		       THISFORM.GRID1.COLUMN13.CONTROLSOURCE="IIF(SEEK(C66A.F18,'D01'),D01.F04,C66A.F18)"
		       THISFORM.GRID1.COLUMN14.CONTROLSOURCE='C66A.F12'
		       JK = '業助姓名'          
       ENDCASE
       COD = SYS(21)
       THISFORM.GRID1.REFRESH
       THISFORM.GRID1.SETFOCUS
  ENDPROC 
  PROC KEY_LIST.INIT 
       WITH THIS 
           .ADDITEM('提前交期記錄')
           .ADDITEM('延後交期記錄')
           .ADDITEM('取消請購記錄') 
           .ADDITEM('全部異動記錄')          
           .VALUE=1      
       ENDWITH      
  ENDPROC 
  PROC KEY_LIST.INTERACTIVECHANGE  
  	   THISFORM.MTH_LIST.ENABLED = .T.
  	   THISFORM.GRID1.RECORDSOURCE=''               
       SELECT C66A
       USE
       DO CASE
       	  CASE THIS.DISPLAYVALUE='提前交期記錄' 
				CH ='1'
       	  CASE THIS.DISPLAYVALUE='延後交期記錄'
				CH ='2'     	  
       	  CASE THIS.DISPLAYVALUE='取消請購記錄' 
  	     		CH ='3'
       	  CASE THIS.DISPLAYVALUE='全部異動記錄' 
  	     		CH ='4'
  	     		THISFORM.MTH_LIST.ENABLED = .F.
       ENDCASE
		SELECT C66.*,ICASE(F08 = 'A','海運    ',F08 = 'B','海運提前',F08 = 'C','空運    ',F08 = 'D','空運提前',F08 = 'E','快遞    ',F08 = 'F','快遞提前',F08 = 'G','海運延後',F08 = 'H','空運延後',F08 = 'J','快遞延後',SPACE(8)) AS F088;
			   FROM C66 WHERE IIF(CH = '4',.T.,F02 = CH) AND LEFT(DTOS(F03),6) = LEFT(DTOS(CTOD(HK+'/01')),6) INTO CURSOR C66A READWRITE
		INDEX ON F04 + F11 + F02 + DTOS(F03) TAG C66A1
		INDEX ON F11 + F04 + F02 + DTOS(F03) TAG C66A2
		INDEX ON F13 + F04 + F02 + DTOS(F03) TAG C66A3
		INDEX ON F20 + F04 + F02 + DTOS(F03) TAG C66A4
		INDEX ON F02 +DTOS(F03) + F04 + ALLTRIM(TRANSFORM(F05,"@R 99,999,999.99")) + F08 + F10 + F11 + F12 + F13 TAG C66A5
		SELECT C66A
		SET ORDER TO C66A1
		GO TOP  
	   THISFORM.GRID1.RECORDSOURCE='C66A'
	   THISFORM.KEY_LIST1.INTERACTIVECHANGE
	   THISFORM.GRID1.REFRESH
       THISFORM.GRID1.SETFOCUS
       IF THISFORM.GRID1.ACTIVEROW=0 
          THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
	      THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
	      THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
	      THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.    
	      THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.	        
	      THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F. 
	      THISFORM.REPLY_REMARK.ENABLED=.F.  
	      THISFORM.DEL_BOT.ENABLED=.F.       
	      THISFORM.INSCH.ENABLED=.F.&&進貨計劃
	      THISFORM.CHANGE_BOT.ENABLED=.F.
      	  THISFORM.TXTF09.VALUE=''
          THISFORM.TXTF14.VALUE=''
          THISFORM.TXTF16.VALUE=''
          THISFORM.LBLF991.CAPTION=''     
          THISFORM.LBLF981.CAPTION=''   
       ELSE
          THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
	      THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
	      THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
	      THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.    
	      THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.	        
	      THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限 
	      THISFORM.REPLY_REMARK.ENABLED=IIF(A02.F05='*',.T.,.F.) AND (A02.F09 = '*' OR IIF(SEEK(C66A.F11,'C01'),C01.F18 = SYS_OPER OR C01.F23 = SYS_OPER OR C01.F33 = SYS_OPER,.F.) OR C66A.F13 = SYS_OPER)
	      THISFORM.DEL_BOT.ENABLED=IIF(A02.F06='*',.T.,.F.) AND (A02.F09 = '*' OR IIF(SEEK(C66A.F11,'C01'),C01.F18 = SYS_OPER OR C01.F23 = SYS_OPER OR C01.F33 = SYS_OPER,.F.) OR C66A.F13 = SYS_OPER)   
	      THISFORM.CHANGE_BOT.ENABLED =  A02.F09 = '*' OR IIF(SEEK(C66A.F11,'C01'),C01.F18 = SYS_OPER OR C01.F23 = SYS_OPER OR C01.F33 = SYS_OPER,.F.) OR C66A.F13 = SYS_OPER
	      THISFORM.INSCH.ENABLED=.T.&&進貨計劃
      	  THISFORM.TXTF09.VALUE=C66A.F09
          THISFORM.TXTF14.VALUE=C66A.F14
          THISFORM.TXTF16.VALUE=C66A.F16
          THISFORM.LBLF991.CAPTION=C66A.F99
          THISFORM.LBLF981.CAPTION=C66A.F98
          THISFORM.LBLF01.CAPTION='異動狀態：' + IIF(C66A.F01 = 0,'尚未列印',IIF(!EMPTY(C66A.F09),'已回覆','已列印'))
       ENDIF       
       JK=THISFORM.GRID1.COLUMN1.HEADER1.CAPTION
       THISFORM.GRID1.REFRESH
  ENDPROC        
**************  
  PROC MTH_LIST.INIT        
       WITH THIS
            SELE A23
            GO TOP
            K=0
            S=0
            DO WHILE !EOF()                
               K=K+1
               IF INT_012=1
                   SHDT=PADL(ALLTRIM(STR(VAL(LEFT(DTOS(A23.F01),4))-1911)),4,'0')+'/'+SUBSTR(DTOS(A23.F01),5,2)
               ELSE
                   SHDT=LEFT(DTOS(A23.F01),4)+'/'+SUBSTR(DTOS(A23.F01),5,2)
               ENDIF    
               .ADDITEM(SHDT) &&               
               IF LEFT(DTOS(DATE()),6)=LEFT(DTOS(A23.F01),6)
                   S=K
               ENDIF       
               SKIP
            ENDDO   
            .VALUE=S
       ENDWITH    
  ENDPROC      
***********      
PROC MTH_LIST.INTERACTIVECHANGE
	   HK = ALLTRIM(THISFORM.MTH_LIST.DISPLAYVALUE)
	   THISFORM.GRID1.RECORDSOURCE=''               
       SELECT C66A
       USE		
	   SELECT C66.*,ICASE(F08 = 'A','海運    ',F08 = 'B','海運提前',F08 = 'C','空運    ',F08 = 'D','空運提前',F08 = 'E','快遞    ',F08 = 'F','快遞提前',F08 = 'G','海運延後',F08 = 'H','空運延後',F08 = 'J','快遞延後',SPACE(8)) AS F088;
			   FROM C66 WHERE IIF(CH = '4',.T.,F02 = CH)  AND LEFT(DTOS(F03),6) = LEFT(DTOS(CTOD(HK+'/01')),6)  INTO CURSOR C66A READWRITE
	   INDEX ON F04 + F11 + F02 + DTOS(F03) TAG C66A1
	   INDEX ON F11 + F04 + F02 + DTOS(F03) TAG C66A2
	   INDEX ON F13 + F04 + F02 + DTOS(F03) TAG C66A3
	   INDEX ON F20 + F04 + F02 + DTOS(F03) TAG C66A4
	   INDEX ON F02 +DTOS(F03) + F04 + ALLTRIM(TRANSFORM(F05,"@R 99,999,999.99")) + F08 + F10 + F11 + F12 + F13 TAG C66A5
	   SELECT C66A
	   SET ORDER TO C66A1
	   GO TOP  
	   THISFORM.GRID1.RECORDSOURCE='C66A'
	   THISFORM.KEY_LIST1.INTERACTIVECHANGE
	   THISFORM.GRID1.REFRESH
       IF THISFORM.GRID1.ACTIVEROW=0 
          THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
	      THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
	      THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
	      THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.    
	      THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.	        
	      THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F. 
	      THISFORM.REPLY_REMARK.ENABLED=.F.  
	      THISFORM.DEL_BOT.ENABLED=.F.       
	      THISFORM.INSCH.ENABLED=.F.&&進貨計劃
	      THISFORM.CHANGE_BOT.ENABLED=.F.
      	  THISFORM.TXTF09.VALUE=''
          THISFORM.TXTF14.VALUE=''
          THISFORM.TXTF16.VALUE=''
          THISFORM.LBLF991.CAPTION=''  
          THISFORM.LBLF981.CAPTION=''      
       ELSE
          THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
	      THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
	      THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
	      THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.    
	      THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.	        
	      THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限 
	      THISFORM.REPLY_REMARK.ENABLED=IIF(A02.F05='*',.T.,.F.) AND (A02.F09 = '*' OR IIF(SEEK(C66A.F11,'C01'),C01.F18 = SYS_OPER OR C01.F23 = SYS_OPER OR C01.F33 = SYS_OPER,.F.) OR C66A.F13 = SYS_OPER)
	      THISFORM.DEL_BOT.ENABLED=IIF(A02.F06='*',.T.,.F.) AND (A02.F09 = '*' OR IIF(SEEK(C66A.F11,'C01'),C01.F18 = SYS_OPER OR C01.F23 = SYS_OPER OR C01.F33 = SYS_OPER,.F.) OR C66A.F13 = SYS_OPER)
	      THISFORM.INSCH.ENABLED=.T.&&進貨計劃
	      THISFORM.CHANGE_BOT.ENABLED = A02.F09 = '*' OR IIF(SEEK(C66A.F11,'C01'),C01.F18 = SYS_OPER OR C01.F23 = SYS_OPER OR C01.F33 = SYS_OPER,.F.) OR C66A.F13 = SYS_OPER
      	  THISFORM.TXTF09.VALUE=C66A.F09
          THISFORM.TXTF14.VALUE=C66A.F14
          THISFORM.TXTF16.VALUE=C66A.F16
          THISFORM.LBLF991.CAPTION=C66A.F99
          THISFORM.LBLF981.CAPTION=C66A.F98
          THISFORM.LBLF01.CAPTION='異動狀態：' + IIF(C66A.F01 = 0,'尚未列印',IIF(!EMPTY(C66A.F09),'已回覆','已列印'))
       ENDIF       
	   JK=THISFORM.GRID1.COLUMN1.HEADER1.CAPTION
       THISFORM.GRID1.REFRESH 	
ENDPROC           
  **********刪除
  PROC DEL_BOT.CLICK 
     IF A02.F09 = '*' OR IIF(SEEK(C66.F11,'C01'),C01.F18 = SYS_OPER OR C01.F23 = SYS_OPER OR C01.F33 = SYS_OPER,.F.) OR C66.F13 = SYS_OPER 
        IF MESSAGEBOX('是否確定要刪除此筆進貨異動資料',4+32+256,'請確認') = 6
       	   SELECT C66
		   SET ORDER TO C661   && F02+DTOS(F03)+F04+ALLTRIM(TRANSFORM(F05,"@R 99,999,999.99"))+F08+F10+F11+F12+F13
		   SEEK C66A.F02 + DTOS(C66A.F03) + C66A.F04 + ALLTRIM(TRANSFORM(C66A.F05,"@R 99,999,999.99")) + C66A.F08 + C66A.F10 + C66A.F11 + C66A.F12 + C66A.F13
		   IF FOUND()
		  	  SELECT C66 
		  	  DELETE    	  
	       	  SELECT C66A
			  DELETE	 
	       ENDIF   	   
         ENDIF
    ELSE
	    =MESSAGEBOX('您不是此筆客戶之負責人員,無權刪除資料!',0+64,'提示視窗')
	    THISFORM.GRID1.SETFOCUS  
    ENDIF 
    SELECT C66A
    THISFORM.GRID1.REFRESH
    THISFORM.GRID1.SETFOCUS 
  ENDPROC
  **********
 PROC REPLY_REMARK.CLICK &&修改回覆交期與備註 
    IF A02.F09 = '*' OR IIF(SEEK(C66.F11,'C01'),C01.F18 = SYS_OPER OR C01.F23 = SYS_OPER OR C01.F33 = SYS_OPER,.F.) OR C66.F13 = SYS_OPER 
       SELECT C66A
	   THISFORM.YES.VISIBLE=.T.
	   THISFORM.NO.VISIBLE=.T.	
	   THISFORM.LBLF99.VISIBLE=.F.
	   THISFORM.LBLF991.VISIBLE=.F.
	   THISFORM.LBLF98.VISIBLE=.F.
	   THISFORM.LBLF981.VISIBLE=.F.
	   THISFORM.KEY_LIST.ENABLED=.F.
	   THISFORM.MTH_LIST.ENABLED=.F.
	   THISFORM.GRID1.ENABLED=.F.
	   THISFORM.CHANGE_BOT.ENABLED=.F.
	   THISFORM.REPLY_REMARK.ENABLED=.F.
	   THISFORM.DEL_BOT.ENABLED=.F.
	   THISFORM.INSCH.ENABLED=.F.&&進貨計劃
	   THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
	   THISFORM.ORPGROUP.ESC_BOTT.ENABLED=.F.
	   THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
	   THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
	   THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
	   THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
	   THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F. 
	   THISFORM.SETALL('READONLY',.F.,'TEXTBOX') 
	   THISFORM.TXTF09.SETFOCUS
	   LOCK()
	   IF !RLOCK()
		   DO FILE_IMPACT
		   RETURN
	   ENDIF 
   ELSE
       =MESSAGEBOX('您不是此筆客戶之負責人員,無權執行修改之作業!',0+64,'提示視窗')
       THISFORM.GRID1.SETFOCUS  
   ENDIF
 ENDPROC  
  **********   
 PROC YES.CLICK &&修改確認 
      SELECT C66
	  SET ORDER TO C661 &&F02+DTOS(F03)+F04+ALLTRIM(TRANSFORM(F05,"@R 99,999,999.99"))+F08+F10+F11+F12+F13
	  SEEK C66A.F02 + DTOS(C66A.F03) + C66A.F04 + ALLTRIM(TRANSFORM(C66A.F05,"@R 99,999,999.99")) + C66A.F08 + C66A.F10 + C66A.F11 + C66A.F12 + C66A.F13
	  IF FOUND()
		 IF C66.F09 <> THISFORM.TXTF09.VALUE OR C66.F16 <> THISFORM.TXTF16.VALUE
		    REPLACE C66.F98 WITH IIF(INT_012=1,PADL(ALLTRIM(STR(YEAR(DATE())-1911)),3,' ')+RIGHT(DTOC(DATE()),6),dtoc(DATE())+' ')+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
		 ENDIF
		 IF C66.F14 <> THISFORM.TXTF14.VALUE
		    REPLACE C66.F99 WITH IIF(INT_012=1,PADL(ALLTRIM(STR(YEAR(DATE())-1911)),3,' ')+RIGHT(DTOC(DATE()),6),dtoc(DATE())+' ')+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
		 ENDIF
		 REPLACE C66.F09 WITH THISFORM.TXTF09.VALUE
		 REPLACE C66.F14 WITH THISFORM.TXTF14.VALUE
		 REPLACE C66.F16 WITH THISFORM.TXTF16.VALUE
		 SELECT C66A
		 REPLACE C66A.F09 WITH C66.F09
		 REPLACE C66A.F14 WITH C66.F14	
		 REPLACE C66A.F16 WITH C66.F16
		 REPLACE C66A.F98 WITH C66.F98  
		 REPLACE C66A.F99 WITH C66.F99	 
	  ENDIF	 
 	  THISFORM.NO.CLICK	  
 ENDPROC
 *********
 PROC NO.CLICK &&修改取消  
   THISFORM.SETALL('READONLY',.T.,'TEXTBOX') 
   THISFORM.YES.VISIBLE=.F.
   THISFORM.NO.VISIBLE=.F.
   THISFORM.LBLF99.VISIBLE=.T.
   THISFORM.LBLF991.VISIBLE=.T.
   THISFORM.LBLF98.VISIBLE=.T.
   THISFORM.LBLF981.VISIBLE=.T.
   THISFORM.KEY_LIST.ENABLED=.T.
   THISFORM.MTH_LIST.ENABLED=.T.
   THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
   THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
   THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
   THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
   THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T. 
   THISFORM.ORPGROUP.ESC_BOTT.ENABLED=.T.
   THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限  
   THISFORM.REPLY_REMARK.ENABLED=IIF(A02.F05='*',.T.,.F.) AND (A02.F09 = '*' OR IIF(SEEK(C66A.F11,'C01'),C01.F18 = SYS_OPER OR C01.F23 = SYS_OPER OR C01.F33 = SYS_OPER,.F.) OR C66A.F13 = SYS_OPER)
   THISFORM.DEL_BOT.ENABLED=IIF(A02.F06='*',.T.,.F.) AND (A02.F09 = '*' OR IIF(SEEK(C66A.F11,'C01'),C01.F18 = SYS_OPER OR C01.F23 = SYS_OPER OR C01.F33 = SYS_OPER,.F.) OR C66A.F13 = SYS_OPER)
   THISFORM.CHANGE_BOT.ENABLED = A02.F09 = '*' OR IIF(SEEK(C66A.F11,'C01'),C01.F18 = SYS_OPER OR C01.F23 = SYS_OPER OR C01.F33 = SYS_OPER,.F.) OR C66A.F13 = SYS_OPER
   THISFORM.INSCH.ENABLED=.T.&&進貨計劃
   THISFORM.GRID1.ENABLED=.T.     
   THISFORM.GRID1.SETFOCUS
   SELECT C66A
   UNLOCK ALL
   THISFORM.REFRESH 
 ENDPROC 
  **********
  PROC CHANGE_BOT.CLICK    &&異動      
      SELECT IIF(C66.F01 = 0,1,0) AS EXP_1,C66.*,ICASE(F08 = 'A','海運    ',F08 = 'B','海運提前',F08 = 'C','空運    ',F08 = 'D','空運提前',F08 = 'E','快遞    ',F08 = 'F','快遞提前',F08 = 'G','海運延後',F08 = 'H','空運延後',F08 = 'J','快遞延後',SPACE(8)) AS F088;
      FROM C66 WHERE C66.F04 = C66A.F04 AND C66.F12 = C66A.F12 AND C66.F11 = C66A.F11  ORDER BY C66.F03 INTO CURSOR C66_TEMP READWRITE
      SELECT C66_TEMP
      GO TOP
      CH_SEEK=CREATEOBJECT("CH_SEEK")  
      CH_SEEK.SHOW    
      SELECT C66A    
      SET ORDER TO &COD
      THISFORM.GRID1.SETFOCUS
  ENDPROC 
****************查看進貨計劃
  PROC INSCH.CLICK    
       LK=C66.F04
       SELE D07.F01,D07.F02,D07.F03,D07.F04,D07.F07,D07.F08,D07.F09,D07.F13,D07.F14,D07.F15 FROM D07 WHERE D07.F02 = C66A.F04 ORDER BY D07.F03 INTO CURSOR INSCH
       SELECT INSCH
       GO TOP
       IF _TALLY>0
          INSCH_SEEK=CREATEOBJECT("INSCH_SEEK")  
          INSCH_SEEK.SHOW           
       ELSE
          =MESSAGEBOX('此項料品已無採購訂單,請洽採購人員查詢',0+48,'提示訊息視窗')
       ENDIF
       SELECT C66A
       THISFORM.GRID1.SETFOCUS
  ENDPROC 
ENDDEFINE  
***********************************************列印程序
PROCEDURE PNT_PRC  
   ANS_RANGE=CREATEOBJECT("ANS_RANGE")  
   ANS_RANGE.SHOW 
   SELECT C66A    
ENDPROC
***********************************************列印範圍選定
DEFINE CLASS ANS_RANGE AS FORM
*!*	  AUTOCENTER=.T.
  CAPTION='請輸入異動列印資料範圍'
  TOP=INT_015*200
  LEFT=INT_015*200    
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*100
  WIDTH=INT_015*360
  FONTSIZE=INT_015*9
  MOVABLE=.F.
  MAXBUTTON=.F.
  MINBUTTON=.F.        
  CONTROLBOX=.F.
  BORDERSTYLE=2
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WINDOWTYPE=1
  NAME='ANS_RANGE' 
  ADD OBJECT LABEL3 AS LABEL WITH;
      AUTOSIZE=.T.,;
      HEIGHT=INT_015*25,;
      LEFT=INT_015*20,;
      TOP=INT_015*10,;
      CAPTION='異動客戶'
  ADD OBJECT LABEL31 AS LABEL WITH;
      AUTOSIZE=.T.,;
      HEIGHT=INT_015*25,;
      LEFT=INT_015*155,;
      TOP=INT_015*10,;
      CAPTION='',;
      NAME='LABEL31'
  ADD OBJECT TEXT3 AS TXTF3 WITH;
      TOP=INT_015*6,;
      LEFT=INT_015*100,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*50,;
      MAXLENGTH=5 
  ADD OBJECT LABEL1 AS LABEL WITH;
      WIDTH=INT_015*90,;
      HEIGHT=INT_015*25,;
      LEFT=INT_015*20,;
      TOP=INT_015*42,;
      CAPTION='異動起始日期',;
      NAME='LABEL1'
  ADD OBJECT TEXT1 AS TEXTBOX WITH;
      TOP=INT_015*36,;
      LEFT=INT_015*100,;
      WIDTH=INT_015*70,;
      HEIGHT=INT_015*25,; 
      NAME='TEXT1'      
  ADD OBJECT LABEL2 AS LABEL WITH;
      WIDTH=INT_015*90,;
      HEIGHT=INT_015*25,;
      LEFT=INT_015*20,;
      TOP=INT_015*72,;
      CAPTION='異動截止日期',;
      NAME='LABEL2'
  ADD OBJECT TEXT2 AS TEXTBOX WITH;
      TOP=INT_015*66,;
      LEFT=INT_015*100,;
      WIDTH=INT_015*70,;
      HEIGHT=INT_015*25,;          
      NAME='TEXT2' 
  ADD OBJECT CMND1 AS COMMANDBUTTON WITH;
      LEFT=INT_015*260,;    
      HEIGHT=INT_015*25,;   
      TOP=INT_015*6,;  
      WIDTH=INT_015*70,;
      CAPTION='\<Y.確定',;
      TOOLTIPTEXT='列印!快速鍵->ALT+Y',;
      NAME='CMND1' 
  ADD OBJECT CMND2 AS COMMANDBUTTON WITH;
      LEFT=INT_015*260,;    
      HEIGHT=INT_015*25,;   
      TOP=INT_015*37,;  
      WIDTH=INT_015*70,;
      CAPTION='\<T.轉EXCEL',;
      TOOLTIPTEXT='轉EXCEL!快速鍵->ALT+T',;
      NAME='CMND2'            
  ADD OBJECT CMND3 AS COMMANDBUTTON WITH;
      LEFT=INT_015*260,;
      TOP=INT_015*68,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*70,;
      CAPTION='\<E.離開',;
      TOOLTIPTEXT='離開作業!快速鍵->ALT+E',;
      NAME='CMND3'
  PROCEDURE INIT 
      THISFORM.SETALL('FONTSIZE',INT_015*9,'TEXTBOX')
      THISFORM.SETALL('FONTSIZE',INT_015*9,'LABEL')      
      THISFORM.SETALL('FONTSIZE',INT_015*9,'COMMANDBUTTON')    
      THISFORM.SETALL('MOUSEPOINTER',99,'COMMANDBUTTON')
      THISFORM.SETALL('MOUSEICON','BMPS\harrow.CUR','COMMANDBUTTON') 
      THISFORM.TEXT1.VALUE = DATE()
      THISFORM.TEXT2.VALUE = DATE() 
      THISFORM.TEXT3.VALUE = C66A.F11
      THISFORM.LABEL31.CAPTION=IIF(SEEK(C66A.F11,'C01'),C01.F05,'')  
  ENDPROC  
  PROCEDURE CMND1.CLICK 
   IF SEEK(THISFORM.TEXT3.VALUE,'C01')=.F. .OR. EMPTY(THISFORM.TEXT3.VALUE)
      =MESSAGEBOX('無此客戶編號請先建立!',0+64,'提示訊息視窗')
      THISFORM.TEXT3.SETFOCUS
      RETURN
   ENDIF  
   IF EMPTY(DTOC(THISFORM.TEXT1.VALUE))
      =MESSAGEBOX('異動起始日期輸入錯誤!',0+64,'提示訊息視窗') 
      THISFORM.TEXT1.SETFOCUS
      RETURN
   ENDIF  
   IF EMPTY(DTOC(THISFORM.TEXT2.VALUE)) 
      =MESSAGEBOX('異動截止日期輸入錯誤!',0+64,'提示訊息視窗') 
      THISFORM.TEXT2.SETFOCUS
      RETURN 
   ENDIF 
   D1=THISFORM.TEXT1.VALUE
   D2=THISFORM.TEXT2.VALUE
   SELECT IIF(C66.F01 = 0,1,0) AS EXP_1,C66.*,ICASE(F08 = 'A','海運    ',F08 = 'B','海運提前',F08 = 'C','空運    ',F08 = 'D','空運提前',F08 = 'E','快遞    ',F08 = 'F','快遞提前',F08 = 'G','海運延後',F08 = 'H','空運延後',F08 = 'J','快遞延後',SPACE(8)) AS F088;
          FROM C66 WHERE C66.F11 = THISFORM.TEXT3.VALUE AND C66.F03 >= D1 AND C66.F03 <= D2 ORDER BY C66.F02,C66.F03,C66.F04 INTO CURSOR C66K READWRITE
   SELECT C66K
   GO TOP
   IF _TALLY<= 0
	  =MESSAGEBOX('無此範圍資料',0+48,'警示')
      THISFORM.TEXT1.SETFOCUS
      C2 = ''
      RETURN 
   ELSE
      IF C2 = '1'
         FILENAME = ALLTRIM(THISFORM.LABEL31.CAPTION) + '異動申請資料' + DTOS(D1) + '~' + DTOS(D2)
         SELECT IIF(F01 = 1,'已列印','尚未列印') AS 列印狀態,ICASE(F02 = '1','提前交期',F02 = '2','延後交期','取消請購') AS 異動類別,F03 AS 異動日期,F04 AS 料品編號,F05 AS 異動數量,;
                IIF(F17 =  '1',DTCX(F06),'尚未回覆') AS 原訂交期,F07 AS 希望交期,F088 AS 載運方式,ICASE(F10 = '1','客戶負擔',F10 = '2','公司負擔','') AS 運費對象,F12 AS 採購單號,IIF(SEEK(F18,'D01'),D01.F04,C66K.F18) AS 廠商簡稱,;
                F14 AS 備註說明,IIF(EMPTY(F09),'尚未回覆',F09) AS 回覆交期,F15 AS 回覆結果說明,F16 AS 回覆數量,F98 AS 回覆安全資料,F99 AS 安全資料 FROM C66K ORDER BY F02,F03,F04 INTO CURSOR C66_TEMP
 		 SELECT C66_TEMP
 		 GO TOP
		 GCDELIMFILE=PUTFILE('儲存路徑',FILENAME,'XLS')
		 IF !EMPTY(GCDELIMFILE) 
		     ON ERROR DO FILE_IMPACT
		     COPY TO (GCDELIMFILE) TYPE XL5     
		     =MESSAGEBOX('儲存成功',0+64,'提示訊息視窗') 
		 ENDIF   			               
         SELECT C66_TEMP
         USE 
      ELSE
	     PRN_BO=CREATEOBJECT("PRN_BO")  
	     PRN_BO.SHOW   
	  ENDIF
   ENDIF
   SELECT C66K
   USE 
   SELECT C66A    
   SET ORDER TO &COD 
   THISFORM.CMND3.CLICK  
  ENDPROC
  PROCEDURE CMND2.CLICK 
      C2 = '1'
      THISFORM.CMND1.CLICK 
  ENDPROC 
 ***** 
  PROCEDURE CMND3.CLICK
	  C2 = '' 
      THISFORM.RELEASE
  ENDPROC           
ENDDEFINE   
******************************************
DEFINE CLASS PRN_BO AS FORM
*!*	  AUTOCENTER=.T.
  FONTSIZE=INT_015*9
  TOP=INT_015*110
  LEFT=INT_015*70    
  HEIGHT=INT_015*280
  WIDTH=INT_015*640
  FONTSIZE=INT_015*9
  MOVABLE=.T.
  MAXBUTTON=.F.
  MINBUTTON=.F.      
  CONTROLBOX=.F.
  BORDERSTYLE=2
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WINDOWTYPE=1  
  NAME='PRN_BO'
  ADD OBJECT GRID1 AS GRID WITH;       
      WIDTH=INT_015*645,;      
      HEIGHT=INT_015*240,;     
      ROWHEIGHT=INT_015*18,;
      HEADERHEIGHT=INT_015*19,; 
      RECORDSOURCE='C66K',;
	  READONLY=.T.,;
      DELETEMARK=.F.,;
      RECORDSOURCETYPE=1,;
      ALLOWCELLSELECTION=.T.,;
      HIGHLIGHTROWLINEWIDTH=4,;
      ALLOWROWSIZING=.F.,;
      COLUMNCOUNT=8,;            
      NAME='GRID1',;
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;      
      COLUMN3.NAME='COLUMN3',; 
      COLUMN4.NAME='COLUMN4',;      
      COLUMN5.NAME='COLUMN5',;
      COLUMN6.NAME='COLUMN6',; 
      COLUMN7.NAME='COLUMN7',; 
      COLUMN8.NAME='COLUMN8'  
  ADD OBJECT CMND1 AS COMMANDBUTTON WITH;
      LEFT=INT_015*320,;    
      HEIGHT=INT_015*25,;   
      TOP=INT_015*252,;        
      WIDTH=INT_015*45,;    
      FONTSIZE=INT_015*9,;
      CAPTION='\<P.列印',;
      TOOLTIPTEXT='選擇游標所指的紀錄!快速鍵->ALT+P'
      NAME='CMND1'
  ADD OBJECT CMND2 AS COMMANDBUTTON WITH;
      LEFT=INT_015*370,;
      HEIGHT=INT_015*25,;
      TOP=INT_015*252,;        
      WIDTH=INT_015*45,;   
      FONTSIZE=INT_015*9,;      
      CAPTION='\<X.離開',;
      TOOLTIPTEXT='離開此畫面!快速鍵->ALT+X'
      NAME='CMND2'  
  ADD OBJECT CMND3 AS COMMANDBUTTON WITH;
      LEFT=INT_015*220,;    
      HEIGHT=INT_015*25,;   
      TOP=INT_015*252,;        
      WIDTH=INT_015*45,;   
      FONTSIZE=INT_015*9,;
      CAPTION='\<A.全選',;
      TOOLTIPTEXT='全選所有資料!快速鍵->ALT+A'
      NAME='CMND3'
  ADD OBJECT CMND4 AS COMMANDBUTTON WITH;
      LEFT=INT_015*270,;    
      HEIGHT=INT_015*25,;   
      TOP=INT_015*252,;        
      WIDTH=INT_015*45,;  
      FONTSIZE=INT_015*9,;
      CAPTION='\<C.清除',;
      TOOLTIPTEXT='清除已全選之資料!快速鍵->ALT+C'
      NAME='CMND4'             
  PROCEDURE INIT 
         THISFORM.CAPTION='異動客戶：'+ IIF(SEEK(C66K.F11,'C01'),C01.F05,'') +'   列印日期範圍：'+  DTOC(D1) + '∼' + DTOC(D2)
         THISFORM.SETALL('MOVABLE',.F.,'COLUMN') 
         THISFORM.SETALL('MOUSEPOINTER',99,'COMMANDBUTTON')
         THISFORM.SETALL('MOUSEICON','BMPS\HARROW.CUR','COMMANDBUTTON')                         
         THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'COLUMN')
         THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'HEADER')   
         THISFORM.GRID1.COLUMN1.HEADER1.CAPTION=''
         THISFORM.GRID1.COLUMN1.WIDTH=INT_015*20
         THISFORM.GRID1.COLUMN1.CONTROLSOURCE='C66K.EXP_1' 
         THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='列印狀態'
         THISFORM.GRID1.COLUMN2.WIDTH=INT_015*55
         THISFORM.GRID1.COLUMN2.CONTROLSOURCE="IIF(EMPTY(C66K.F01),'尚未列印','已列印')"         
         THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='異動類別'
         THISFORM.GRID1.COLUMN3.CONTROLSOURCE="ICASE(C66K.F02='1','提前交期',C66K.F02='2','延後交期','取消請購')"
         THISFORM.GRID1.COLUMN3.WIDTH=INT_015*55
         THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='料    號'         
         THISFORM.GRID1.COLUMN4.CONTROLSOURCE='C66K.F04' 
         THISFORM.GRID1.COLUMN4.WIDTH=INT_015*220 
         THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='異動數量'         
         THISFORM.GRID1.COLUMN5.CONTROLSOURCE='C66K.F05'
         THISFORM.GRID1.COLUMN5.WIDTH=INT_015*80
         THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='希望交期'         
         THISFORM.GRID1.COLUMN6.CONTROLSOURCE='C66K.F07'
         THISFORM.GRID1.COLUMN6.WIDTH=INT_015*65  
         THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='載運方式'         
         THISFORM.GRID1.COLUMN7.CONTROLSOURCE='C66K.F088'
         THISFORM.GRID1.COLUMN7.WIDTH=INT_015*55 
         THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='運費對象'         
         THISFORM.GRID1.COLUMN8.CONTROLSOURCE="ICASE(C66K.F10 ='1','客戶負擔',C66K.F10 ='2','公司負擔','')"
         THISFORM.GRID1.COLUMN8.WIDTH=INT_015*55           
         THISFORM.GRID1.SETFOCUS                               
  ENDPROC 
  PROC GRID1.INIT      
	 THISFORM.GRID1.COLUMN1.READONLY=.F.
	 THISFORM.GRID1.COLUMN2.READONLY=.T.
	 THISFORM.GRID1.COLUMN3.READONLY=.T.
	 THISFORM.GRID1.COLUMN4.READONLY=.T.
	 THISFORM.GRID1.COLUMN5.READONLY=.T.
	 THISFORM.GRID1.COLUMN6.READONLY=.T.
	 THISFORM.GRID1.COLUMN7.READONLY=.T.
	 THISFORM.GRID1.COLUMN8.READONLY=.T.
	 THISFORM.GRID1.COLUMN1.removeobject("TEXT1")
	 THISFORM.GRID1.COLUMN1.AddObject("CheckBox2","CheckBox2") 
	 THISFORM.GRID1.COLUMN1.CurrentControl="CheckBox2" 
	 THISFORM.GRID1.COLUMN1.Sparse=.F.
	 THISFORM.GRID1.COLUMN1.CheckBox2.Visible=.T.
	 THISFORM.GRID1.COLUMN1.CheckBox2.CAPTION=''
	 THISFORM.GRID1.COLUMN1.CheckBox2.AUTOSIZE=.T.
	 THISFORM.GRID1.COLUMN1.CheckBox2.CENTERED=.T.
	 THISFORM.GRID1.COLUMN1.CheckBox2.BACKSTYLE=0
	 THISFORM.GRID1.COLUMN1.CheckBox2.LEFT=5	 
  ENDPROC 
  *****
   PROC GRID1.AFTERROWCOLCHANGE
         LPARAMETERS XCOLINDEX
           THISFORM.GRID1.TOOLTIPTEXT=IIF(EMPTY(C66K.F01),'尚未列印','已列印')
           THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(C66K.F01 = 0,RGB(255,0,0),'')","COLUMN") 
  ENDPROC 
  PROCEDURE CMND1.CLICK
 	CH_F02 = '' 
 	MAIL_TEXT = ''
    SELECT * FROM C66K WHERE C66K.EXP_1 = 1 INTO CURSOR C66_1	
    SELECT C66_1
    GO TOP
    IF _TALLY > 0
       SELECT C66_1.F02,C66_1.F11,C66_1.F18 FROM C66_1 GROUP BY C66_1.F02 ORDER BY C66_1.F02 INTO CURSOR C66_2
       SELECT C66_2
       IF RECCOUNT('C66_2') > 1
          DO WHILE !EOF()
             CH_F02 = CH_F02 + ICASE(C66_2.F02 = '1','提前交期、',C66_2.F02 = '2','延後交期、','取消請購、')
             SELECT C66_2
             SKIP
          ENDDO
          =MESSAGEBOX('此列印作業將會預覽列印共 ' + ALLTRIM(STR(RECCOUNT('C66_2'))) + ' 張入貨異動申請單，異動類別包含：' + LEFT(ALLTRIM(CH_F02),LEN(ALLTRIM(CH_F02)) - 2),0+64,'提示訊息視窗')
       ENDIF
	   SELECT C66_2
	   GO TOP
	   DO WHILE !EOF()
	      SELECT C66K.* FROM C66K WHERE C66K.EXP_1 = 1 AND C66K.F02 = C66_2.F02 ORDER BY C66K.F03 INTO CURSOR C66ABC
	      REPORT FORM ALLTRIM(INT_116)+'C66' TO PRINT PROMPT PREVIEW 
	      CLEAR
	      ******傳送MAIL給該廠商負責之採購人員
	      WAIT WINDOW "傳送郵件,請稍後!" AT 0,150 NOWAIT NOCLEAR 
	      SELECT C66ABC
	      TMPCHR=IIF(OS()="Windows 5.01",CHR(13)+CHR(10),'<br/>')
	      GO TOP
	      DO WHILE !EOF()
	         MAIL_TEXT = MAIL_TEXT + '廠商簡稱：' + IIF(SEEK(C66ABC.F18,'D01'),D01.F04,C66ABC.F18) +TMPCHR + ;
	         			 '採購單號：' + C66ABC.F12 + TMPCHR + ;
	         			 '料品編號：' + C66ABC.F04 + TMPCHR + ;
	         			 '異動類別：' + ICASE(C66ABC.F02 = '1','提前交期',C66ABC.F02 = '2','延後交期','取消請購') + TMPCHR + ;
	         			 '異動數量：' + ALLTRIM(TRANSFORM(C66ABC.F05,'@R 99,999,999.99'))  + TMPCHR + ;
	         			 '希望交期：' + DTCX(C66ABC.F07) + TMPCHR + ;
	         			 '載運方式：' + C66ABC.F088 + TMPCHR + ;
	         			 '運費對象：' + ICASE(C66ABC.F10 = '1','客戶負擔',C66ABC.F10 = '1','公司負擔','') +TMPCHR + ;
	         			 '備註說明：' + C66ABC.F14 + TMPCHR + ;
	         			 '************************************************' + TMPCHR
 	         SELECT C66ABC
 	         SKIP
 	      ENDDO
 	      ****傳送MAIL給負責此廠商之採購
 	      IF SEEK(C66_1.F18,'D01') = .T. AND EMPTY(D01.F39) = .F. AND  SEEK(D01.F39,'A01') = .T. AND ALLTRIM(A01.F06) = 'Y' AND AT('@',A01.F10) <> 0 AND EMPTY(MAIL_TEXT) = .F.
 	         PRS_NO=A01.F01
 	         IF OS()="Windows 5.01"
                SEND_MAIL(ALLTRIM(INT_MAI),ALLTRIM(A01.F10),ALLTRIM(INT_DNS),'系統通知：C66.入貨異動申請單、客戶簡稱：' + IIF(SEEK(C66_2.F11,'C01'),C01.F05,C66_2.F11) + '、異動類別：' + ICASE(C66_2.F02 = '1','提前交期',C66_2.F02 = '2','延後交期','取消請購'),'TEXT',MAIL_TEXT)
             ELSE
                IF !EMPTY(ALLTRIM(PRS_NO))
                   FILE_NAME=ALLTRIM(INT_DAT)+ALLTRIM(PRS_NO)+'.TXT'                  
                   STRTOFILE('<TR><TD>'+MAIL_TEXT+'<TD>C66.入貨異動申請單、客戶簡稱：'+IIF(SEEK(C66_2.F11,'C01'),C01.F05,C66_2.F11) + '、異動類別：' + ICASE(C66_2.F02 = '1','提前交期',C66_2.F02 = '2','延後交期','取消請購')+'<TD>'+TTOC(DATETIME())+ CHR(13) + CHR(10),FILE_NAME,1) 
                ENDIF    
             ENDIF
          ELSE
             PRS_NO=''   
          ENDIF
 	      ****傳送MAIL給負責此廠商之採購主管
 	      IF SEEK(C66_1.F18,'D01') = .T. AND EMPTY(D01.F25) = .F. AND  SEEK(LEFT(D01.F25,5),'A01') = .T. AND ALLTRIM(A01.F06) = 'Y' AND AT('@',A01.F10) <> 0 AND EMPTY(MAIL_TEXT) = .F.
 	         PRS_CHEF=A01.F01
             IF OS()="Windows 5.01"
                SEND_MAIL(ALLTRIM(INT_MAI),ALLTRIM(A01.F10),ALLTRIM(INT_DNS),'系統通知：C66.入貨異動申請單、客戶簡稱：' + IIF(SEEK(C66_2.F11,'C01'),C01.F05,C66_2.F11) + '、異動類別：' + ICASE(C66_2.F02 = '1','提前交期',C66_2.F02 = '2','延後交期','取消請購'),'TEXT',MAIL_TEXT)
             ELSE
                IF !EMPTY(ALLTRIM(PRS_CHEF))
                   FILE_NAME=ALLTRIM(INT_DAT)+ALLTRIM(PRS_CHEF)+'.TXT'                  
                   STRTOFILE('<TR><TD>'+MAIL_TEXT+'<TD>C66.入貨異動申請單、客戶簡稱：'+IIF(SEEK(C66_2.F11,'C01'),C01.F05,C66_2.F11) + '、異動類別：' + ICASE(C66_2.F02 = '1','提前交期',C66_2.F02 = '2','延後交期','取消請購')+'<TD>'+TTOC(DATETIME())+ CHR(13) + CHR(10),FILE_NAME,1) 
                ENDIF    
             ENDIF
          ELSE
             PRS_CHEF=''   
          ENDIF
          ****傳送MAIL給負責業助
 	      IF SEEK(C66_1.F11,'C01') = .T. AND EMPTY(C01.F23) = .F. AND ALLTRIM(SYS_OPER) <> ALLTRIM(C01.F23) AND  SEEK(C01.F23,'A01') = .T. AND ALLTRIM(A01.F06) = 'Y' AND AT('@',A01.F10) <> 0 AND EMPTY(MAIL_TEXT) = .F.
             ASSIS_NO=A01.F01
             IF OS()="Windows 5.01"
                SEND_MAIL(ALLTRIM(INT_MAI),ALLTRIM(A01.F10),ALLTRIM(INT_DNS),'系統通知：C66.入貨異動申請單、客戶簡稱：' + IIF(SEEK(C66_2.F11,'C01'),C01.F05,C66_2.F11) + '、異動類別：' + ICASE(C66_2.F02 = '1','提前交期',C66_2.F02 = '2','延後交期','取消請購'),'TEXT',MAIL_TEXT)
             ELSE
                IF !EMPTY(ALLTRIM(ASSIS_NO))
                   FILE_NAME=ALLTRIM(INT_DAT)+ALLTRIM(ASSIS_NO)+'.TXT'                  
                   STRTOFILE('<TR><TD>'+MAIL_TEXT+'<TD>C66.入貨異動申請單、客戶簡稱：'+IIF(SEEK(C66_2.F11,'C01'),C01.F05,C66_2.F11) + '、異動類別：' + ICASE(C66_2.F02 = '1','提前交期',C66_2.F02 = '2','延後交期','取消請購')+'<TD>'+TTOC(DATETIME())+ CHR(13) + CHR(10),FILE_NAME,1) 
                ENDIF    
             ENDIF
          ELSE
             ASSIS_NO=''   
          ENDIF
           ****傳送MAIL給負責業務B
 	      IF SEEK(C66_1.F11,'C01') = .T. AND EMPTY(C01.F33) = .F. AND ALLTRIM(SYS_OPER) <> ALLTRIM(C01.F33) AND  SEEK(C01.F33,'A01') = .T. AND ALLTRIM(A01.F06) = 'Y' AND AT('@',A01.F10) <> 0 AND EMPTY(MAIL_TEXT) = .F.
             SALES_B_NO=A01.F01
             IF SALES_B_NO<>ASSIS_NO
                IF OS()="Windows 5.01"
                   SEND_MAIL(ALLTRIM(INT_MAI),ALLTRIM(A01.F10),ALLTRIM(INT_DNS),'系統通知：C66.入貨異動申請單、客戶簡稱：' + IIF(SEEK(C66_2.F11,'C01'),C01.F05,C66_2.F11) + '、異動類別：' + ICASE(C66_2.F02 = '1','提前交期',C66_2.F02 = '2','延後交期','取消請購'),'TEXT',MAIL_TEXT)
                ELSE
                   IF !EMPTY(ALLTRIM(SALES_B_NO))
                      FILE_NAME=ALLTRIM(INT_DAT)+ALLTRIM(SALES_B_NO)+'.TXT'                  
                      STRTOFILE('<TR><TD>'+MAIL_TEXT+'<TD>C66.入貨異動申請單、客戶簡稱：'+IIF(SEEK(C66_2.F11,'C01'),C01.F05,C66_2.F11) + '、異動類別：' + ICASE(C66_2.F02 = '1','提前交期',C66_2.F02 = '2','延後交期','取消請購')+'<TD>'+TTOC(DATETIME())+ CHR(13) + CHR(10),FILE_NAME,1) 
                   ENDIF    
                ENDIF
             ENDIF   
          ELSE
             SALES_B_NO=''   
          ENDIF
          ****傳送MAIL給負責業務A
 	      IF SEEK(C66_1.F11,'C01') = .T. AND EMPTY(C01.F18) = .F. AND ALLTRIM(SYS_OPER) <> ALLTRIM(C01.F18) AND  SEEK(C01.F18,'A01') = .T. AND ALLTRIM(A01.F06) = 'Y' AND AT('@',A01.F10) <> 0 AND EMPTY(MAIL_TEXT) = .F.
             SALES_A_NO=A01.F01
             IF SALES_A_NO<>SALES_B_NO
                IF OS()="Windows 5.01"
                   SEND_MAIL(ALLTRIM(INT_MAI),ALLTRIM(A01.F10),ALLTRIM(INT_DNS),'系統通知：C66.入貨異動申請單、客戶簡稱：' + IIF(SEEK(C66_2.F11,'C01'),C01.F05,C66_2.F11) + '、異動類別：' + ICASE(C66_2.F02 = '1','提前交期',C66_2.F02 = '2','延後交期','取消請購'),'TEXT',MAIL_TEXT)
                ELSE
                   IF !EMPTY(ALLTRIM(SALES_A_NO))
                      FILE_NAME=ALLTRIM(INT_DAT)+ALLTRIM(SALES_A_NO)+'.TXT'                  
                      STRTOFILE('<TR><TD>'+MAIL_TEXT+'<TD>C66.入貨異動申請單、客戶簡稱：'+IIF(SEEK(C66_2.F11,'C01'),C01.F05,C66_2.F11) + '、異動類別：' + ICASE(C66_2.F02 = '1','提前交期',C66_2.F02 = '2','延後交期','取消請購')+'<TD>'+TTOC(DATETIME())+ CHR(13) + CHR(10),FILE_NAME,1) 
                   ENDIF    
                ENDIF
             ENDIF
          ELSE
             SALES_A_NO=''      
          ENDIF         
          WAIT CLEAR
		  SELECT C66ABC
		  USE 
	      SELECT C66_2
	      SKIP 
	   ENDDO
	   SELECT C66_2
	   USE
	   SELECT C66K
	   GO TOP
	   DO WHILE !EOF()
	      IF C66K.EXP_1 = 1
	         SELECT C66A
	         SET ORDER TO C66A5
	     	 SEEK C66K.F02 + DTOS(C66K.F03) + C66K.F04 + ALLTRIM(TRANSFORM(C66K.F05,"@R 99,999,999.99")) + C66K.F08 + C66K.F10 + C66K.F11 + C66K.F12 + C66K.F13
			 IF FOUND()
	            REPLACE C66A.F01 WITH 1
	            REPLACE C66A.F03 WITH DATE()
	         ENDIF
	     	 SELECT C66
	     	 SET ORDER TO C661 &&F02+DTOS(F03)+F04+ALLTRIM(TRANSFORM(F05,"@R 99,999,999.99"))+F08+F10+F11+F12+F13
	     	 SEEK C66K.F02 + DTOS(C66K.F03) + C66K.F04 + ALLTRIM(TRANSFORM(C66K.F05,"@R 99,999,999.99")) + C66K.F08 + C66K.F10 + C66K.F11 + C66K.F12 + C66K.F13
		 	 IF FOUND()
		    	REPLACE C66.F01 WITH 1
		    	REPLACE C66.F03 WITH DATE()
		    	REPLACE C66.F15 WITH ''
		    	REPLACE C66.F16 WITH 0
		    	REPLACE C66.F98 WITH ''
		 	 ENDIF 
			 SELECT D07
			 SET ORDER TO D074   && F01+F02+DTOS(F03)
			 SEEK C66K.F12 + C66K.F04 + IIF(!EMPTY(C66K.F09),DTOS(C66K.F09),DTOS(C66K.F06))
			 IF FOUND()
			    REPLACE D07.F15 WITH DATE()
			 ENDIF
	      ENDIF
	      SELECT C66K
	      SKIP   
	   ENDDO
    ELSE
      =MESSAGEBOX('請選擇欲列印之資料!',0+64,'提示訊息視窗')
      THISFORM.GRID1.SETFOCUS 
      RETURN
    ENDIF
    SELECT C66_1
    USE                                                                            
    THISFORM.CMND2.CLICK  
  ENDPROC  
  PROCEDURE CMND2.CLICK  
      THISFORM.RELEASE
  ENDPROC   
 **
 PROCEDURE CMND3.CLICK     
      SELECT C66K
      RE=RECNO('C66K')
      GO TOP
      DO WHILE !EOF()
	     REPLACE C66K.EXP_1 WITH 1 
	     SELECT C66K
	     SKIP
      ENDDO
      SELECT C66K
      GO RE  
      THISFORM.GRID1.SETFOCUS 
 ENDPROC      
  PROCEDURE CMND4.CLICK
      SELECT C66K
      RE=RECNO('C66K') 
      GO TOP
      DO WHILE !EOF()
         REPLACE C66K.EXP_1 WITH 0 
         SELECT C66K
         SKIP
      ENDDO
      SELECT C66K
      GO RE
      THISFORM.GRID1.SETFOCUS 
 ENDPROC 
ENDDEFINE 
*********     
  DEFINE CLASS CheckBox2 AS CheckBox
      PROCEDURE CLICK
         SELECT C66K
         IF THIS.VALUE=1
              REPLACE C66K.EXP_1 WITH 1
         ELSE
              REPLACE C66K.EXP_1 WITH 0           
         ENDIF
         THISFORM.GRID1.SETFOCUS     
   ENDPROC  
  ENDDEFINE 
***************************************進貨計劃 
DEFINE CLASS INSCH_SEEK AS FORM
*!*	  AUTOCENTER=.T.
  FONTSIZE=INT_015*9
  TOP=INT_015*110
  LEFT=INT_015*10    
  HEIGHT=INT_015*320
  WIDTH=INT_015*770
  FONTSIZE=INT_015*9
  MOVABLE=.T.
  MAXBUTTON=.F.
  MINBUTTON=.F.      
  CONTROLBOX=.F.
  BORDERSTYLE=2
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WINDOWTYPE=1
  NAME='INSCH_SEEK'
  ADD OBJECT CMDGROUP AS CMDGROUP WITH;      
      TOP=INT_015*290,;
      LEFT=INT_015*210
  ADD OBJECT GRID1 AS GRID WITH;       
      HIGHLIGHTROWLINEWIDTH=4,; 
      AUTOCENTER=.T.,;
      WIDTH=INT_015*770,;      
      HEIGHT=INT_015*293,;     
      ROWHEIGHT=INT_015*18,;
      HEADERHEIGHT=INT_015*19,; 
      DELETEMARK=.F.,;
      READONLY=.T.,;
      RECORDSOURCETYPE=1,;
      COLUMNCOUNT=8,;            
      NAME='GRID1',;
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;      
      COLUMN3.NAME='COLUMN3',; 
      COLUMN4.NAME='COLUMN4',;      
      COLUMN5.NAME='COLUMN5',;
      COLUMN6.NAME='COLUMN6',; 
      COLUMN7.NAME='COLUMN7',;  
      COLUMN8.NAME='COLUMN8'            
  ADD OBJECT CMND1 AS COMMANDBUTTON WITH;
      LEFT=INT_015*425,;
      TOP=INT_015*295,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\harrow.CUR',;
      CAPTION='\<X.離開',;
      TOOLTIPTEXT='取消此作業畫面!快速鍵->ALT+X'
      NAME='CMND1'
      PROCEDURE INIT 
         THISFORM.CAPTION='進貨計劃'+'---->'+C66A.F04    
         AREA1='INSCH'  
         SELE INSCH
         THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'COLUMN')
         THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'HEADER')
         THISFORM.GRID1.READONLY=.T. 
         THISFORM.GRID1.RECORDSOURCE='INSCH'
         THISFORM.CMDGROUP.SEEK_BOTT.VISIBLE=.F.         
         THISFORM.SETALL('READONLY',.T.,'TEXTBOX')
         THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(DATE()-CTOD(LEFT(INSCH.F08,8))<=5 AND INSCH.F09='1',RGB(0,255,255),IIF(INSCH.F09<>'1',RGB(255,255,0),IIF(INSCH.F03<DATE() AND INSCH.F09='1',RGB(255,0,0),'')))","COLUMN")
         THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='訂單號碼'
         THISFORM.GRID1.COLUMN1.CONTROLSOURCE='INSCH.F01'
         THISFORM.GRID1.COLUMN1.WIDTH=INT_015*75
         THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='進貨日期'
         THISFORM.GRID1.COLUMN2.WIDTH=INT_015*60
         THISFORM.GRID1.COLUMN2.CONTROLSOURCE='INSCH.F03'         
         THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='進貨數量'
         THISFORM.GRID1.COLUMN3.CONTROLSOURCE='INSCH.F04'
         THISFORM.GRID1.COLUMN3.WIDTH=INT_015*70
         THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='採購用途'         
         THISFORM.GRID1.COLUMN4.CONTROLSOURCE='INSCH.F07'
         THISFORM.GRID1.COLUMN4.WIDTH=INT_015*130
         THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='運貨方式'         
         THISFORM.GRID1.COLUMN5.CONTROLSOURCE='INSCH.F13' 
         THISFORM.GRID1.COLUMN5.WIDTH=INT_015*80    
         THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='客戶PO/NO'         
         THISFORM.GRID1.COLUMN6.CONTROLSOURCE="IIF(SEEK(LEFT(ALLTRIM(INSCH.F07),10),'P05'),IIF(SEEK(P05.F06,'C03'),C03.F14,''),'')"
         THISFORM.GRID1.COLUMN6.WIDTH=INT_015*130
         THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='異動狀態'   
		 THISFORM.GRID1.COLUMN7.CONTROLSOURCE="ICASE(INSCH.F14 = '1','提前中 / ',INSCH.F14 = '2','延後中 / ',INSCH.F14 = '3','取消中 / ',INSCH.F14 = '4','異動資料已回覆','') + IIF(EMPTY(INSCH.F15),'',DTOC(INSCH.F15))"
         THISFORM.GRID1.COLUMN7.WIDTH=INT_015*105 
         THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='安全資料'         
         THISFORM.GRID1.COLUMN8.CONTROLSOURCE='INSCH.F08'
         THISFORM.GRID1.COLUMN8.WIDTH=INT_015*120                        
         THISFORM.GRID1.SETFOCUS 
      ENDPROC 
      PROC GRID1.AFTERROWCOLCHANGE
           LPARAMETERS XCOLINDEX
           THISFORM.GRID1.TOOLTIPTEXT=IIF(DATE()-CTOD(LEFT(INSCH.F08,8))<=5 AND INSCH.F09='1','剛回覆交期',IIF(INSCH.F09<>'1','超過10天未回覆交期',IIF(INSCH.F03<DATE() AND INSCH.F09='1','應到貨而未到貨','')))
      ENDPROC 
      PROCEDURE CMND1.CLICK
          SELE INSCH
          USE
          AREA1='C66A'
         THISFORM.RELEASE
      ENDPROC    
ENDDEFINE  
**************************************異動 
DEFINE CLASS CH_SEEK AS FORM
  AUTOCENTER=.T.
  FONTSIZE=INT_015*9 
  TOP=INT_015*110
  LEFT=INT_015*40    
  HEIGHT=INT_015*350
  WIDTH=INT_015*550
  FONTSIZE=INT_015*9
  MOVABLE=.T.
  MAXBUTTON=.F.
  MINBUTTON=.F.      
  CONTROLBOX=.F.
  BORDERSTYLE=2
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WINDOWTYPE=1
  NAME='CH_SEEK'      
  ADD OBJECT GRID1 AS GRID WITH;        
      LEFT=INT_015*10,;
      TOP=INT_015*165,;
      WIDTH=INT_015*540,;      
      HEIGHT=INT_015*150,;      
      ROWHEIGHT=INT_015*18,;
      HEADERHEIGHT=INT_015*19,;  
      RECORDSOURCE='C66_TEMP',;    
      DELETEMARK=.F.,;
      READONLY=.T.,;
      RECORDSOURCETYPE=1,;
      ALLOWCELLSELECTION=.T.,;
      HIGHLIGHTROWLINEWIDTH=4,;
      ALLOWROWSIZING=.F.,;
      COLUMNCOUNT=9,;            
      NAME='GRID1',;
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;      
      COLUMN3.NAME='COLUMN3',; 
      COLUMN4.NAME='COLUMN4',;
      COLUMN5.NAME='COLUMN5',;      
      COLUMN6.NAME='COLUMN6',;
      COLUMN7.NAME='COLUMN7',;
      COLUMN8.NAME='COLUMN8',;
      COLUMN9.NAME='COLUMN9'    
  ADD OBJECT KEY_LIST AS KEY_LIST WITH;
      AUTOCENTER=.T.
  ADD OBJECT CMDGROUP AS CMDGROUP WITH;
      AUTOSIZE=.T.  
  ADD OBJECT LBLF03 AS LABEL WITH;
      TOP=INT_015*10,;
      LEFT=INT_015*10,;
      HEIGHT=INT_015*17,;      
      WIDTH=INT_015*60,;
      CAPTION='異動日期'            
  ADD OBJECT TXTF03 AS TEXTBOX WITH;
      TOP=INT_015*5,;
      LEFT=INT_015*65,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*80,;
      MAXLENGTH=8   
  ADD OBJECT LBLF08 AS LABEL WITH;
      TOP=INT_015*10,;
      LEFT=INT_015*390,;
      HEIGHT=INT_015*17,;      
      WIDTH=INT_015*60,;
      CAPTION='運貨方式'   
 ADD OBJECT COMBOBOX08 AS COMBOBOX WITH;      
      TOP=INT_015*5,;
      LEFT=INT_015*445,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*80,;
      STYLE=2,;
      FONTSIZE=INT_015*9   
  ADD OBJECT TXTF08 AS TEXTBOX WITH;
      TOP=INT_015*5,;
      LEFT=INT_015*445,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*80,; 
      MAXLENGTH=10       
  ADD OBJECT LBLF02 AS LABEL WITH;
      TOP=INT_015*36,;
      LEFT=INT_015*10,;
      HEIGHT=INT_015*17,;      
      WIDTH=INT_015*60,;
      CAPTION='異動類別'      
 ADD OBJECT COMBOBOX02 AS COMBOBOX WITH;      
      TOP=INT_015*31,;
      LEFT=INT_015*65,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*80,;
      STYLE=2,;
      FONTSIZE=INT_015*9    
  ADD OBJECT TXTF02 AS TEXTBOX WITH;
      TOP=INT_015*31,;
      LEFT=INT_015*65,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*80              
  ADD OBJECT LBLF10 AS LABEL WITH;
      TOP=INT_015*36,;
      LEFT=INT_015*390,;
      HEIGHT=INT_015*17,;      
      WIDTH=INT_015*60,;
       CAPTION='運費對象'    
 ADD OBJECT COMBOBOX10 AS COMBOBOX WITH;      
      TOP=INT_015*31,;
      LEFT=INT_015*445,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*80,;
      STYLE=2,;
      FONTSIZE=INT_015*9         
  ADD OBJECT TXTF10 AS TEXTBOX WITH;
      TOP=INT_015*31,;
      LEFT=INT_015*445,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*80,; 
      MAXLENGTH=10  
  ADD OBJECT LBLF06 AS LABEL WITH;
      TOP=INT_015*62,;
      LEFT=INT_015*10,;
      HEIGHT=INT_015*17,;      
      WIDTH=INT_015*60,;
       CAPTION='原訂交期'            
  ADD OBJECT TXTF06 AS TEXTBOX WITH;
      TOP=INT_015*57,;
      LEFT=INT_015*65,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*80,;
      MAXLENGTH=8
  ADD OBJECT LBLF05 AS LABEL WITH;
      TOP=INT_015*62,;
      LEFT=INT_015*390,;
      HEIGHT=INT_015*17,;      
      WIDTH=INT_015*60,;
      CAPTION='異動數量'            
  ADD OBJECT TXTF05 AS TEXTBOX WITH;
      TOP=INT_015*57,;
      LEFT=INT_015*445,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*80,;
      MAXLENGTH=13      
  ADD OBJECT LBLF07 AS LABEL WITH;
      TOP=INT_015*88,;
      LEFT=INT_015*10,;
      HEIGHT=INT_015*17,;      
      WIDTH=INT_015*60,;
      CAPTION='希望交期'            
  ADD OBJECT TXTF07 AS TEXTBOX WITH;
      TOP=INT_015*83,;
      LEFT=INT_015*65,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*80,;
      MAXLENGTH=8                
  ADD OBJECT LBLF14 AS LABEL WITH;
      TOP=INT_015*114,;
      LEFT=INT_015*10,;
      HEIGHT=INT_015*17,;      
      WIDTH=INT_015*60,;
      CAPTION='備註說明'            
  ADD OBJECT TXTF14 AS TEXTBOX WITH;
      TOP=INT_015*109,;
      LEFT=INT_015*65,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*460,;
      MAXLENGTH=80     
  ADD OBJECT LBLF99 AS LABEL WITH;
      TOP=INT_015*140,;
      LEFT=INT_015*10,;
      HEIGHT=INT_015*17,;      
      AUTOSIZE=.T.,;
      CAPTION=''     
  ADD OBJECT ORPGROUP AS ORPGROUP WITH;    
      TOP=INT_015*316,;
      LEFT=INT_015*70
  ADD OBJECT SHRGROUP AS SHRGROUP WITH;
      TOP=INT_015*316,;
      LEFT=INT_015*370    
  ADD OBJECT PNT_BT AS COMMANDBUTTON WITH;
      LEFT=INT_015*200,;
      TOP=INT_015*321,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\harrow.CUR',;
      CAPTION='\<P.列印',;
      TOOLTIPTEXT='列印資料!快速鍵->ALT+P'
      NAME='PNT_BT' 
  ADD OBJECT CMND1 AS COMMANDBUTTON WITH;
      LEFT=INT_015*243,;
      TOP=INT_015*321,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\harrow.CUR',;
      CAPTION='\<X.離開',;
      TOOLTIPTEXT='取消此作業畫面!快速鍵->ALT+X'
      NAME='CMND1'  
 PROC INIT   
       THISFORM.CAPTION='C66.入貨異動單' + '   料號：' + ALLTRIM(C66A.F04) + '   客戶：' + IIF(SEEK(C66A.F11,'C01'),C01.F05,C66A.F11) + '   採購單號：' + C66A.F12
       THISFORM.SETALL('HEIGHT',INT_015*25,'TEXTBOX')
       THISFORM.SETALL('HEIGHT',INT_015*17,'LABEL')
       THISFORM.SETALL('FONTSIZE',INT_015*9,'TEXTBOX')
       THISFORM.SETALL('FONTSIZE',INT_015*9,'LABEL')       
       THISFORM.SETALL('READONLY',.T.,'TEXTBOX')  
	   THISFORM.KEY_LIST.VISIBLE=.F.                
	   THISFORM.CMDGROUP.VISIBLE=.F.
       THISFORM.SHRGROUP.VISIBLE=.F.
       THISFORM.SHRGROUP.ENABLED=.F.
       THISFORM.ORPGROUP.ESC_BOTT.VISIBLE=.F.
       THISFORM.ORPGROUP.PNT_BOTT.VISIBLE=.F.
       THISFORM.COMBOBOX02.VISIBLE = .T.
       THISFORM.COMBOBOX08.VISIBLE = .T.
       THISFORM.COMBOBOX10.VISIBLE = .T.
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'COLUMN')
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'HEADER')    
       THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(C66_TEMP.F01 = 0,RGB(255,0,0),'')","COLUMN") 
       THISFORM.GRID1.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)
       THISFORM.GRID1.COLUMN4.BACKCOLOR = RGB(255,255,0)
       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION=''
       THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='列印狀態'    
       THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='異動日期'
       THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='異動類別'
       THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='原定交期'
       THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='希望交期'
       THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='異動數量'
       THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='運貨方式'
       THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='運費對象'
       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='C66_TEMP.EXP_1'
       THISFORM.GRID1.COLUMN2.CONTROLSOURCE="IIF(C66_TEMP.F01 = 0,'尚未列印','已列印')"
       THISFORM.GRID1.COLUMN3.CONTROLSOURCE='C66_TEMP.F03'
       THISFORM.GRID1.COLUMN4.CONTROLSOURCE="ICASE(C66_TEMP.F02 = '1','提前交期',C66_TEMP.F02 = '2','延後交期','取消請購')"
       THISFORM.GRID1.COLUMN5.CONTROLSOURCE="IIF(!EMPTY(C66A.F09),C66A.F09,IIF(C66A.F17 = '1',C66A.F06,'尚未回覆'))"
       THISFORM.GRID1.COLUMN6.CONTROLSOURCE='C66_TEMP.F07'
       THISFORM.GRID1.COLUMN7.CONTROLSOURCE='C66_TEMP.F05'
       THISFORM.GRID1.COLUMN8.CONTROLSOURCE='C66_TEMP.F088'
       THISFORM.GRID1.COLUMN9.CONTROLSOURCE="ICASE(C66_TEMP.F10 = '1','客戶負擔',C66_TEMP.F10 = '2','公司負擔','')"
       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*20
       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*55
       THISFORM.GRID1.COLUMN3.WIDTH=INT_015*65
       THISFORM.GRID1.COLUMN4.WIDTH=INT_015*55
       THISFORM.GRID1.COLUMN5.WIDTH=INT_015*65
       THISFORM.GRID1.COLUMN6.WIDTH=INT_015*65
       THISFORM.GRID1.COLUMN7.WIDTH=INT_015*70
       THISFORM.GRID1.COLUMN8.WIDTH=INT_015*55
       THISFORM.GRID1.COLUMN9.WIDTH=INT_015*55     
       THISFORM.GRID1.SETFOCUS
       IF THISFORM.GRID1.ACTIVEROW=0
		  THISFORM.SETALL('VALUE','','TEXTBOX') 
		  THISFORM.LBLF99.CAPTION = ''
	      THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
	      THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
	      THISFORM.PNT_BT.ENABLED=.F.
       ELSE
	      THISFORM.ORPGROUP.EDIT_BOTT.ENABLED = IIF(A02.F05 = '*',.T.,.F.)
	      THISFORM.ORPGROUP.DEL_BOTT.ENABLED = IIF(A02.F06 = '*',.T.,.F.)
	      THISFORM.PNT_BT.ENABLED = IIF(A02.F07 = '*',.T.,.F.)
	      THISFORM.TXTF02.VALUE = ICASE(C66_TEMP.F02 = '1','提前交期',C66_TEMP.F02 = '2','延後交期','取消請購')
	      THISFORM.TXTF03.VALUE = C66_TEMP.F03
	      THISFORM.TXTF05.VALUE = C66_TEMP.F05
	      THISFORM.TXTF06.VALUE = IIF(!EMPTY(C66A.F09),C66A.F09,IIF(C66A.F17 = '1',C66A.F06,'尚未回覆'))
	      THISFORM.TXTF07.VALUE = C66_TEMP.F07
	      THISFORM.TXTF08.VALUE = C66_TEMP.F088
	      THISFORM.TXTF10.VALUE = ICASE(C66_TEMP.F10 = '1','客戶負擔',C66_TEMP.F10 = '2','公司負擔','')
	      THISFORM.TXTF14.VALUE = C66_TEMP.F14
	      THISFORM.LBLF99.CAPTION = '安全資料 ' + C66_TEMP.F99
       ENDIF
       THISFORM.ORPGROUP.NEW_BOTT.ENABLED = IIF(A02.F04 = '*',.T.,.F.)
   ENDPROC   
  PROC GRID1.INIT      
	 THISFORM.GRID1.COLUMN1.READONLY=.F.
	 THISFORM.GRID1.COLUMN2.READONLY=.T.
	 THISFORM.GRID1.COLUMN3.READONLY=.T.
	 THISFORM.GRID1.COLUMN4.READONLY=.T.
	 THISFORM.GRID1.COLUMN5.READONLY=.T.
	 THISFORM.GRID1.COLUMN6.READONLY=.T.
	 THISFORM.GRID1.COLUMN7.READONLY=.T.
	 THISFORM.GRID1.COLUMN8.READONLY=.T.
	 THISFORM.GRID1.COLUMN9.READONLY=.T.
	 THISFORM.GRID1.COLUMN1.removeobject("TEXT1")
	 THISFORM.GRID1.COLUMN1.AddObject("CheckBox1","CheckBox1") 
	 THISFORM.GRID1.COLUMN1.CurrentControl="CheckBox1" 
	 THISFORM.GRID1.COLUMN1.Sparse=.F.
	 THISFORM.GRID1.COLUMN1.CheckBox1.Visible=.T.
	 THISFORM.GRID1.COLUMN1.CheckBox1.CAPTION=''
	 THISFORM.GRID1.COLUMN1.CheckBox1.AUTOSIZE=.T.
	 THISFORM.GRID1.COLUMN1.CheckBox1.CENTERED=.T.
	 THISFORM.GRID1.COLUMN1.CheckBox1.BACKSTYLE=0
	 THISFORM.GRID1.COLUMN1.CheckBox1.LEFT=5	 
  ENDPROC 
  PROCEDURE GRID1.AFTERROWCOLCHANGE
       LPARAMETERS NCOLINDEX
	      THISFORM.GRID1.TOOLTIPTEXT = IIF(C66_TEMP.F01 = 0,'尚未列印','已列印')
	      THISFORM.TXTF02.VALUE = ICASE(C66_TEMP.F02 = '1','提前交期',C66_TEMP.F02 = '2','延後交期','取消請購')
	      THISFORM.TXTF03.VALUE = C66_TEMP.F03
	      THISFORM.TXTF05.VALUE = C66_TEMP.F05
	      THISFORM.TXTF06.VALUE = IIF(!EMPTY(C66_TEMP.F09),C66_TEMP.F09,IIF(C66_TEMP.F17 = '1',C66_TEMP.F06,'尚未回覆'))
	      THISFORM.TXTF07.VALUE = C66_TEMP.F07
	      THISFORM.TXTF08.VALUE = C66_TEMP.F088
	      THISFORM.TXTF10.VALUE = ICASE(C66_TEMP.F10 = '1','客戶負擔',C66_TEMP.F10 = '2','公司負擔','')
	      THISFORM.TXTF14.VALUE = C66_TEMP.F14 
	      THISFORM.LBLF99.CAPTION = '安全資料 ' + C66_TEMP.F99
  ENDPROC 
   PROCEDURE COMBOBOX02.INIT
		WITH THIS
   			.ADDITEM('提前交期')
   			.ADDITEM('延後交期')
   			.ADDITEM('取消請購')
   			.VALUE = 1
    	ENDWITH
   ENDPROC     
PROCEDURE COMBOBOX02.INTERACTIVECHANGE 
	 THISFORM.COMBOBOX08.CLEAR
	 THISFORM.TXTF08.VISIBLE = .F.
	 THISFORM.TXTF10.VISIBLE = .T.
	 THISFORM.COMBOBOX08.VISIBLE = .T.
	 THISFORM.COMBOBOX10.VISIBLE = .F.	
	 THISFORM.COMBOBOX08.VALUE = 1
	 THISFORM.TXTF07.ENABLED = .T.
	 THISFORM.TXTF07.VALUE = DATE()
	 THISFORM.TXTF10.VALUE = ''
	 DO CASE
	 	CASE  THISFORM.COMBOBOX02.VALUE = 1
	 	      THISFORM.COMBOBOX08.ADDITEM('海運')
	 	      THISFORM.COMBOBOX08.ADDITEM('海運提前')
	 	      THISFORM.COMBOBOX08.ADDITEM('空運')
	 	      THISFORM.COMBOBOX08.ADDITEM('空運提前')
	 	      THISFORM.COMBOBOX08.ADDITEM('快遞')
	 	      THISFORM.COMBOBOX08.ADDITEM('快遞提前')
	 	      THISFORM.TXTF08.VALUE = IIF(THISFORM.COMBOBOX08.VALUE = 1 OR THISFORM.COMBOBOX08.VALUE = 2,'',THISFORM.COMBOBOX10.DISPLAYVALUE)
	 	CASE  THISFORM.COMBOBOX02.VALUE = 2
	 		  THISFORM.COMBOBOX08.ADDITEM('海運延後') 
	 	      THISFORM.COMBOBOX08.ADDITEM('空運延後') 
	 	      THISFORM.COMBOBOX08.ADDITEM('快遞延後')
	 	      THISFORM.TXTF08.VALUE = IIF(THISFORM.COMBOBOX08.VALUE = 1,'',THISFORM.COMBOBOX10.DISPLAYVALUE)
	 	CASE  THISFORM.COMBOBOX02.VALUE = 3
	 		  THISFORM.TXTF07.ENABLED = .F.
	 		  THISFORM.TXTF07.VALUE = ''
	 	      THISFORM.TXTF08.VISIBLE = .T.
	 	      THISFORM.COMBOBOX08.VISIBLE = .F.
	 	      THISFORM.TXTF08.VALUE = ''
			  THISFORM.TXTF10.VISIBLE = .T.
			  THISFORM.COMBOBOX10.VISIBLE = .F.
	 ENDCASE   
ENDPROC    
   PROCEDURE COMBOBOX08.INIT
		WITH THIS
   			.ADDITEM('海運')
   			.ADDITEM('海運提前')
   			.ADDITEM('空運')
   			.ADDITEM('空運提前')
   			.ADDITEM('快遞')
   			.ADDITEM('快遞提前')
   			.VALUE = 1
    	ENDWITH           
   ENDPROC  
PROCEDURE COMBOBOX08.INTERACTIVECHANGE   
      IF THISFORM.COMBOBOX08.DISPLAYVALUE = '海運' OR THISFORM.COMBOBOX08.DISPLAYVALUE = '海運提前' OR THISFORM.COMBOBOX08.DISPLAYVALUE = '海運延後'
		 THISFORM.TXTF10.VISIBLE = .T.
		 THISFORM.COMBOBOX10.VISIBLE = .F. 
	  ELSE
		 THISFORM.TXTF10.VISIBLE = .F.
		 THISFORM.COMBOBOX10.VISIBLE = .T. 
		 THISFORM.COMBOBOX10.VALUE = 1  
	  ENDIF
 ENDPROC 
   PROCEDURE COMBOBOX10.INIT
		WITH THIS
   			.ADDITEM('客戶負擔')
   			.ADDITEM('公司負擔')
   			.VALUE = 1
    	ENDWITH           
   ENDPROC     
PROCEDURE ORPGROUP.NEW_BOTT.CLICK 
	   THISFORM.ORPGROUP.ENABLED = .F.
	   THISFORM.CMND1.ENABLED =.F.
       THISFORM.GRID1.ENABLED=.F.
       THISFORM.PNT_BT.ENABLED = .F.
       THISFORM.SETALL('READONLY',.F.,'TEXTBOX') 
       THISFORM.TXTF02.VISIBLE = .F.
       THISFORM.TXTF08.VISIBLE = .F.      
       THISFORM.TXTF03.READONLY= .T.
       THISFORM.TXTF06.READONLY= .T.
       THISFORM.TXTF08.READONLY= .T.
       THISFORM.TXTF10.READONLY= .T.
       THISFORM.COMBOBOX02.VISIBLE = .T.
       THISFORM.COMBOBOX08.VISIBLE = .T.
       THISFORM.COMBOBOX10.VISIBLE = .F.
       THISFORM.COMBOBOX02.VALUE = 1
       THISFORM.TXTF02.VALUE = ''
       THISFORM.TXTF03.VALUE = DATE()
       THISFORM.TXTF05.VALUE = C66A.F05
       THISFORM.TXTF06.VALUE = IIF(!EMPTY(C66A.F09),C66A.F09,IIF(C66A.F17 = '1',C66A.F06,'尚未回覆'))
       THISFORM.TXTF07.VALUE = DATE()
       THISFORM.TXTF08.VALUE = ''
       THISFORM.TXTF10.VALUE = ''
       THISFORM.TXTF14.VALUE = ''
       THISFORM.LBLF99.CAPTION = ''
       THISFORM.COMBOBOX02.SETFOCUS 
 ENDPROC
 PROCEDURE SHRGROUP.SHURE1_BOTT.CLICK  
      IF EMPTY(THISFORM.TXTF07.VALUE) = .T. AND THISFORM.COMBOBOX02.VALUE <> 3
          =MESSAGEBOX('希望交期不得空白!',0+64,'提示訊息視窗')
          THISFORM.TXTF07.SETFOCUS
          RETURN            
      ENDIF 
      IF C66A.F17 = '1'
         IF THISFORM.COMBOBOX02.VALUE = 2 AND THISFORM.TXTF07.VALUE <= IIF(!EMPTY(C66A.F09),C66A.F09,C66A.F06)
            =MESSAGEBOX('延後之希望交期不得小於原定交期!',0+64,'提示訊息視窗')
            THISFORM.TXTF07.SETFOCUS
            RETURN            
         ENDIF     
      ENDIF
      IF THISFORM.TXTF05.VALUE <= 0
          =MESSAGEBOX('異動數量不得小於等於零!',0+64,'提示訊息視窗')
          THISFORM.TXTF05.SETFOCUS
          RETURN            
      ENDIF     
      IF THISFORM.TXTF05.VALUE > IIF(INDEXSEEK(C66A.F12 + C66A.F04 + IIF(!EMPTY(C66A.F09),DTOS(C66A.F09),DTOS(C66A.F06)),.T.,'D07','D074'),D07.F04,C66_TEMP.F05)
          =MESSAGEBOX('異動數量不得大於訂購數量!',0+64,'提示訊息視窗')
          THISFORM.TXTF05.SETFOCUS
          RETURN            
      ENDIF
      SELECT C66
      APPEND BLANK
      REPLACE C66.F02 WITH ALLTRIM(STR(THISFORM.COMBOBOX02.VALUE))
      REPLACE C66.F03 WITH THISFORM.TXTF03.VALUE
      REPLACE C66.F04 WITH C66A.F04
      REPLACE C66.F05 WITH THISFORM.TXTF05.VALUE
      REPLACE C66.F06 WITH IIF(!EMPTY(C66A.F09),C66A.F09,C66A.F06)
      REPLACE C66.F07 WITH IIF(C66.F02 = '3',CTOD(''),THISFORM.TXTF07.VALUE)
      REPLACE C66.F08 WITH IIF(C66.F02 = '3','',CHR(IIF(C66.F02 = '1',64,70) + THISFORM.COMBOBOX08.VALUE))
      REPLACE C66.F10 WITH IIF(THISFORM.COMBOBOX10.VISIBLE = .T.,ALLTRIM(STR(THISFORM.COMBOBOX10.VALUE)),'')
      REPLACE C66.F11 WITH C66A.F11
      REPLACE C66.F12 WITH C66A.F12
      REPLACE C66.F13 WITH IIF(SEEK(C66.F11,'C01'),IIF(ALLTRIM(INT_209) = 'A',C01.F18,C01.F33),sys_oper)
      REPLACE C66.F14 WITH THISFORM.TXTF14.VALUE
      REPLACE C66.F17 WITH C66A.F17
      REPLACE C66.F18 WITH C66A.F18
      REPLACE C66.F20 WITH IIF(SEEK(C66.F11,'C01'),C01.F23,sys_oper)
      REPLACE C66.F99 WITH IIF(INT_012=1,PADL(ALLTRIM(STR(YEAR(DATE())-1911)),3,' ')+RIGHT(DTOC(DATE()),6),dtoc(DATE())+' ')+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
      IF ALLTRIM(STR(THISFORM.COMBOBOX02.VALUE)) = CH OR CH ='4'
	      SELECT C66A
	      APPEND BLANK
	      REPLACE C66A.F02 WITH ALLTRIM(STR(THISFORM.COMBOBOX02.VALUE))
	      REPLACE C66A.F03 WITH THISFORM.TXTF03.VALUE
	      REPLACE C66A.F04 WITH C66.F04
	      REPLACE C66A.F05 WITH THISFORM.TXTF05.VALUE
	      REPLACE C66A.F06 WITH IIF(!EMPTY(C66A.F09),C66A.F09,C66A.F06)
	      REPLACE C66A.F07 WITH IIF(C66.F02 = '3',CTOD(''),THISFORM.TXTF07.VALUE)
	      REPLACE C66A.F08 WITH IIF(C66.F02 = '3','',CHR(IIF(C66.F02 = '1',64,70) + THISFORM.COMBOBOX08.VALUE))
	      REPLACE C66A.F088 WITH IIF(C66.F02 = '3','',ALLTRIM(THISFORM.COMBOBOX08.DISPLAYVALUE))
	      REPLACE C66A.F10 WITH IIF(THISFORM.COMBOBOX10.VISIBLE = .T.,ALLTRIM(STR(THISFORM.COMBOBOX10.VALUE)),'')
	      REPLACE C66A.F11 WITH C66.F11
	      REPLACE C66A.F12 WITH C66.F12
	      REPLACE C66A.F13 WITH IIF(SEEK(C66.F11,'C01'),IIF(ALLTRIM(INT_209) = 'A',C01.F18,C01.F33),sys_oper)
	      REPLACE C66A.F14 WITH THISFORM.TXTF14.VALUE
	      REPLACE C66A.F17 WITH C66.F17
	      REPLACE C66A.F18 WITH C66.F18
	      REPLACE C66A.F20 WITH IIF(SEEK(C66.F11,'C01'),C01.F23,sys_oper)
	      REPLACE C66A.F99 WITH IIF(INT_012=1,PADL(ALLTRIM(STR(YEAR(DATE())-1911)),3,' ')+RIGHT(DTOC(DATE()),6),dtoc(DATE())+' ')+IIF(SEEK(sys_oper,'A01'),A01.F03,'') 
      ENDIF
   	  SELECT C66_TEMP
      APPEND BLANK
      REPLACE C66_TEMP.EXP_1 WITH 1
      REPLACE C66_TEMP.F02 WITH ALLTRIM(STR(THISFORM.COMBOBOX02.VALUE))
      REPLACE C66_TEMP.F03 WITH THISFORM.TXTF03.VALUE
      REPLACE C66_TEMP.F04 WITH C66A.F04
      REPLACE C66_TEMP.F05 WITH THISFORM.TXTF05.VALUE
      REPLACE C66_TEMP.F06 WITH IIF(!EMPTY(C66A.F09),C66A.F09,C66A.F06)
      REPLACE C66_TEMP.F07 WITH IIF(C66_TEMP.F02 = '3',CTOD(''),THISFORM.TXTF07.VALUE)
      REPLACE C66_TEMP.F08 WITH IIF(C66_TEMP.F02 = '3','',CHR(IIF(C66_TEMP.F02 = '1',64,70) + THISFORM.COMBOBOX08.VALUE))
      REPLACE C66_TEMP.F088 WITH IIF(C66_TEMP.F02 = '3','',ALLTRIM(THISFORM.COMBOBOX08.DISPLAYVALUE))
      REPLACE C66_TEMP.F10 WITH IIF(THISFORM.COMBOBOX10.VISIBLE = .T.,ALLTRIM(STR(THISFORM.COMBOBOX10.VALUE)),'')
      REPLACE C66_TEMP.F11 WITH C66A.F11
      REPLACE C66_TEMP.F12 WITH C66A.F12
      REPLACE C66_TEMP.F13 WITH IIF(SEEK(C66_TEMP.F11,'C01'),IIF(ALLTRIM(INT_209) = 'A',C01.F18,C01.F33),sys_oper)
      REPLACE C66_TEMP.F14 WITH THISFORM.TXTF14.VALUE
      REPLACE C66_TEMP.F17 WITH C66A.F17
      REPLACE C66_TEMP.F18 WITH C66A.F18
      REPLACE C66_TEMP.F20 WITH IIF(SEEK(C66_TEMP.F11,'C01'),C01.F23,sys_oper)
      REPLACE C66_TEMP.F99 WITH IIF(INT_012=1,PADL(ALLTRIM(STR(YEAR(DATE())-1911)),3,' ')+RIGHT(DTOC(DATE()),6),dtoc(DATE())+' ')+IIF(SEEK(sys_oper,'A01'),A01.F03,'') 
	  SELECT D07
	  SET ORDER TO D074   && F01+F02+DTOS(F03)
	  SEEK C66A.F12 + C66A.F04 + IIF(!EMPTY(C66A.F09),DTOS(C66A.F09),DTOS(C66A.F06))
	  IF FOUND()
	     REPLACE D07.F14 WITH ALLTRIM(STR(THISFORM.COMBOBOX02.VALUE))
	     REPLACE D07.F15 WITH THISFORM.TXTF03.VALUE
	  ENDIF
	  SELECT C66_TEMP
	  UNLOCK ALL
	  THISFORM.GRID1.ENABLED=.T.
	  THISFORM.GRID1.SETFOCUS  
	  THISFORM.ORPGROUP.NEW_BOTT.CLICK
 ENDPROC
 PROCEDURE ORPGROUP.EDIT_BOTT.CLICK 
	   THISFORM.ORPGROUP.ENABLED = .F.
	   THISFORM.CMND1.ENABLED =.F.
	   THISFORM.PNT_BT.ENABLED = .F.
       THISFORM.GRID1.ENABLED=.F.
       THISFORM.SETALL('READONLY',.F.,'TEXTBOX') 
       THISFORM.TXTF02.VISIBLE = .F.
       THISFORM.TXTF08.VISIBLE = .F.
       THISFORM.TXTF03.READONLY= .T.
       THISFORM.TXTF06.READONLY= .T.
       THISFORM.TXTF08.READONLY= .T.
       THISFORM.TXTF10.READONLY= .T.
       THISFORM.COMBOBOX02.VISIBLE = .T.
       THISFORM.COMBOBOX08.VISIBLE = .T.
       THISFORM.COMBOBOX10.VISIBLE = .F.
       THISFORM.COMBOBOX02.VALUE = VAL(C66_TEMP.F02)
       THISFORM.COMBOBOX02.INTERACTIVECHANGE
       THISFORM.COMBOBOX08.VALUE = ASC(C66_TEMP.F08) - IIF(C66_TEMP.F02 = '1',64,70)
       THISFORM.TXTF10.VISIBLE = IIF(EMPTY(C66_TEMP.F10),.T.,.F.)
       THISFORM.COMBOBOX10.VISIBLE = IIF(EMPTY(C66_TEMP.F10),.F.,.T.)
       THISFORM.COMBOBOX10.VALUE = VAL(C66_TEMP.F10)
       THISFORM.TXTF07.VALUE = C66_TEMP.F07
       THISFORM.TXTF10.VALUE = ICASE(C66_TEMP.F10 = '1','客戶負擔',C66_TEMP.F10 = '1','公司負擔','')
       THISFORM.COMBOBOX02.SETFOCUS 
 ENDPROC 
 PROCEDURE SHRGROUP.SHURE2_BOTT.CLICK  
      IF EMPTY(THISFORM.TXTF07.VALUE) = .T. AND THISFORM.COMBOBOX02.VALUE <> 3
          =MESSAGEBOX('希望交期不得空白!',0+64,'提示訊息視窗')
          THISFORM.TXTF07.SETFOCUS
          RETURN            
      ENDIF 
      IF C66A.F17 = '1'
         IF THISFORM.COMBOBOX02.VALUE = 2 AND THISFORM.TXTF07.VALUE <= IIF(!EMPTY(C66A.F09),C66A.F09,C66A.F06)
            =MESSAGEBOX('延後之希望交期不得小於原定交期!',0+64,'提示訊息視窗')
            THISFORM.TXTF07.SETFOCUS
            RETURN            
         ENDIF     
      ENDIF
      IF THISFORM.TXTF05.VALUE <= 0
          =MESSAGEBOX('異動數量不得小於等於零!',0+64,'提示訊息視窗')
          THISFORM.TXTF05.SETFOCUS
          RETURN            
      ENDIF     
      IF THISFORM.TXTF05.VALUE > IIF(INDEXSEEK(C66A.F12 + C66A.F04 + IIF(!EMPTY(C66A.F09),DTOS(C66A.F09),DTOS(C66A.F06)),.T.,'D07','D074'),D07.F04,C66_TEMP.F05)
          =MESSAGEBOX('異動數量不得大於訂購數量!',0+64,'提示訊息視窗')
          THISFORM.TXTF05.SETFOCUS
          RETURN            
      ENDIF
      SELECT C66
      SET ORDER TO C661 &&F02+DTOS(F03)+F04+ALLTRIM(TRANSFORM(F05,"@R 99,999,999.99"))+F08+F10+F11+F12+F13
      SEEK C66_TEMP.F02 + DTOS(C66_TEMP.F03) + C66_TEMP.F04 + ALLTRIM(TRANSFORM(C66_TEMP.F05,"@R 99,999,999.99")) + C66_TEMP.F08 + C66_TEMP.F10 + C66_TEMP.F11 + C66_TEMP.F12 + C66_TEMP.F13
	  IF FOUND()
	     REPLACE C66.F01 WITH 0
	     REPLACE C66.F02 WITH ALLTRIM(STR(THISFORM.COMBOBOX02.VALUE))
	     REPLACE C66.F05 WITH THISFORM.TXTF05.VALUE
	     REPLACE C66.F07 WITH IIF(C66.F02 = '3',CTOD(''),THISFORM.TXTF07.VALUE)
	     REPLACE C66.F08 WITH IIF(C66.F02 = '3','',CHR(IIF(C66.F02 = '1',64,70) + THISFORM.COMBOBOX08.VALUE))
	     REPLACE C66.F10 WITH IIF(THISFORM.COMBOBOX10.VISIBLE = .T.,ALLTRIM(STR(THISFORM.COMBOBOX10.VALUE)),'')
	     REPLACE C66.F14 WITH THISFORM.TXTF14.VALUE
	     REPLACE C66.F99 WITH IIF(INT_012=1,PADL(ALLTRIM(STR(YEAR(DATE())-1911)),3,' ')+RIGHT(DTOC(DATE()),6),dtoc(DATE())+' ')+IIF(SEEK(sys_oper,'A01'),A01.F03,'')    
	  ENDIF
	  SELECT C66A
	  SET ORDER TO C66A5
	  SEEK C66_TEMP.F02 + DTOS(C66_TEMP.F03) + C66_TEMP.F04 + ALLTRIM(TRANSFORM(C66_TEMP.F05,"@R 99,999,999.99")) + C66_TEMP.F08 + C66_TEMP.F10 + C66_TEMP.F11 + C66_TEMP.F12 + C66_TEMP.F13
	  IF FOUND()
	     REPLACE C66A.F01 WITH 0
	     REPLACE C66A.F02 WITH ALLTRIM(STR(THISFORM.COMBOBOX02.VALUE))
	     REPLACE C66A.F05 WITH THISFORM.TXTF05.VALUE
	     REPLACE C66A.F07 WITH IIF(C66A.F02 = '3',CTOD(''),THISFORM.TXTF07.VALUE)
	     REPLACE C66A.F08 WITH IIF(C66A.F02 = '3','',CHR(IIF(C66A.F02 = '1',64,70) + THISFORM.COMBOBOX08.VALUE))
	     REPLACE C66A.F088 WITH IIF(C66A.F02 = '3','',ALLTRIM(THISFORM.COMBOBOX08.DISPLAYVALUE))
	     REPLACE C66A.F10 WITH IIF(THISFORM.COMBOBOX10.VISIBLE = .T.,ALLTRIM(STR(THISFORM.COMBOBOX10.VALUE)),'')
	     REPLACE C66A.F14 WITH THISFORM.TXTF14.VALUE
	     REPLACE C66A.F99 WITH IIF(INT_012=1,PADL(ALLTRIM(STR(YEAR(DATE())-1911)),3,' ')+RIGHT(DTOC(DATE()),6),dtoc(DATE())+' ')+IIF(SEEK(sys_oper,'A01'),A01.F03,'')   
	     IF C66_TEMP.F02 <> C66A.F02 AND CH <> '4'
	        DELETE 
	     ENDIF         
      ENDIF
   	  SELECT C66_TEMP
      LOCK()
      IF RLOCK()
	      REPLACE C66_TEMP.EXP_1 WITH 1
	      REPLACE C66_TEMP.F01 WITH 0
	      REPLACE C66_TEMP.F02 WITH ALLTRIM(STR(THISFORM.COMBOBOX02.VALUE))
	      REPLACE C66_TEMP.F05 WITH THISFORM.TXTF05.VALUE
	      REPLACE C66_TEMP.F07 WITH IIF(C66_TEMP.F02 = '3',CTOD(''),THISFORM.TXTF07.VALUE)
	      REPLACE C66_TEMP.F08 WITH IIF(C66_TEMP.F02 = '3','',CHR(IIF(C66_TEMP.F02 = '1',64,70) + THISFORM.COMBOBOX08.VALUE))
	      REPLACE C66_TEMP.F088 WITH IIF(C66_TEMP.F02 = '3','',ALLTRIM(THISFORM.COMBOBOX08.DISPLAYVALUE))
	      REPLACE C66_TEMP.F10 WITH IIF(THISFORM.COMBOBOX10.VISIBLE = .T.,ALLTRIM(STR(THISFORM.COMBOBOX10.VALUE)),'')
	      REPLACE C66_TEMP.F14 WITH THISFORM.TXTF14.VALUE
	      REPLACE C66_TEMP.F99 WITH IIF(INT_012=1,PADL(ALLTRIM(STR(YEAR(DATE())-1911)),3,' ')+RIGHT(DTOC(DATE()),6),dtoc(DATE())+' ')+IIF(SEEK(sys_oper,'A01'),A01.F03,'')       
      ENDIF
	  SELECT D07
	  SET ORDER TO D074   && F01+F02+DTOS(F03)
	  SEEK C66A.F12 + C66A.F04 + IIF(!EMPTY(C66A.F09),DTOS(C66A.F09),DTOS(C66A.F06))
	  IF FOUND()
	     REPLACE D07.F14 WITH ALLTRIM(STR(THISFORM.COMBOBOX02.VALUE))
	     REPLACE D07.F15 WITH THISFORM.TXTF03.VALUE
	  ENDIF
	  SELECT C66_TEMP
	  UNLOCK ALL
	  THISFORM.GRID1.ENABLED=.T.
	  THISFORM.GRID1.SETFOCUS  
	  THISFORM.SHRGROUP.ABANDON_BOTT.CLICK  
 ENDPROC  
 PROCEDURE ORPGROUP.DEL_BOTT.CLICK
      IF MESSAGEBOX('是否確定要刪除此筆資料',4+32+256,'請確認') = 6
	     SELECT C66
	     SET ORDER TO C661 &&F02+DTOS(F03)+F04+ALLTRIM(TRANSFORM(F05,"@R 99,999,999.99"))+F08+F10+F11+F12+F13
	     SEEK C66_TEMP.F02 + DTOS(C66_TEMP.F03) + C66_TEMP.F04 + ALLTRIM(TRANSFORM(C66_TEMP.F05,"@R 99,999,999.99")) + C66_TEMP.F08 + C66_TEMP.F10 + C66_TEMP.F11 + C66_TEMP.F12 + C66_TEMP.F13
		 IF FOUND()
		    SELECT C66
		    DELETE 
		 ENDIF
		 SELECT C66A
		 SET ORDER TO C66A5
		 SEEK C66_TEMP.F02 + DTOS(C66_TEMP.F03) + C66_TEMP.F04 + ALLTRIM(TRANSFORM(C66_TEMP.F05,"@R 99,999,999.99")) + C66_TEMP.F08 + C66_TEMP.F10 + C66_TEMP.F11 + C66_TEMP.F12 + C66_TEMP.F13
		 IF FOUND()
		    SELECT C66A
		    DELETE 
		 ENDIF
		 SELECT C66_TEMP
		 DELETE 
      ENDIF
      THISFORM.GRID1.SETFOCUS 
      IF THISFORM.GRID1.ACTIVEROW=0
		  SELECT D07
		  SET ORDER TO D074   && F01+F02+DTOS(F03)
		  SEEK C66A.F12 + C66A.F04 + IIF(!EMPTY(C66A.F09),DTOS(C66A.F09),DTOS(C66A.F06))
		  IF FOUND()
		     REPLACE D07.F14 WITH ''
		     REPLACE D07.F15 WITH CTOD('')
		  ENDIF
		  THISFORM.SETALL('VALUE','','TEXTBOX') 
	      THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
	      THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
	      THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
      ENDIF
      SELECT C66_TEMP
 ENDPROC
 PROCEDURE SHRGROUP.ABANDON_BOTT.CLICK
	  SELECT C66_TEMP 
	  THISFORM.CMND1.ENABLED=.T.
	  THISFORM.ORPGROUP.ENABLED=.T.
      THISFORM.ORPGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
	  THISFORM.SHRGROUP.ENABLED=.F.
      THISFORM.SHRGROUP.VISIBLE=.F.
      THISFORM.TXTF07.ENABLED = .T.
      THISFORM.COMBOBOX02.VISIBLE = .T.
      THISFORM.COMBOBOX08.VISIBLE = .T.
      THISFORM.COMBOBOX10.VISIBLE = .T.
      THISFORM.SETALL('READONLY',.T.,'TEXTBOX')
      THISFORM.SETALL('VISIBLE',.T.,'TEXTBOX') 
	  THISFORM.GRID1.ENABLED=.T.
	  THISFORM.GRID1.SETFOCUS  
      IF THISFORM.GRID1.ACTIVEROW=0
	     THISFORM.SETALL('VALUE','','TEXTBOX') 
	     THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
	     THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
	     THISFORM.PNT_BT.ENABLED=.F. 
      ELSE
	     THISFORM.ORPGROUP.EDIT_BOTT.ENABLED = IIF(A02.F05 = '*',.T.,.F.)
	     THISFORM.ORPGROUP.DEL_BOTT.ENABLED = IIF(A02.F06 = '*',.T.,.F.)
	     THISFORM.PNT_BT.ENABLED = IIF(A02.F07 = '*',.T.,.F.)
      ENDIF
      THISFORM.ORPGROUP.NEW_BOTT.ENABLED = IIF(A02.F04 = '*',.T.,.F.)
 ENDPROC
 PROCEDURE SHRGROUP.FINISH_BOTT.CLICK
   THISFORM.SHRGROUP.ABANDON_BOTT.CLICK
 ENDPROC
 PROCEDURE CMND1.CLICK
     THISFORM.RELEASE
     RETURN 
 ENDPROC  
 PROCEDURE PNT_BT.CLICK  
 	CH_F02 = '' 
 	MAIL_TEXT = ''
    SELECT * FROM C66_TEMP WHERE C66_TEMP.EXP_1 = 1 INTO CURSOR C66_1	
    SELECT C66_1
    GO TOP
    IF _TALLY > 0
       SELECT C66_1.F02,C66_1.F11,C66_1.F18 FROM C66_1 GROUP BY C66_1.F02 ORDER BY C66_1.F02 INTO CURSOR C66_2
       SELECT C66_2
       IF RECCOUNT('C66_2') > 1
          DO WHILE !EOF()
             CH_F02 = CH_F02 + ICASE(C66_2.F02 = '1','提前交期、',C66_2.F02 = '2','延後交期、','取消請購、')
             SELECT C66_2
             SKIP
          ENDDO
          =MESSAGEBOX('此列印作業將會預覽列印共 ' + ALLTRIM(STR(RECCOUNT('C66_2'))) + ' 張入貨異動申請單，異動類別包含：' + LEFT(ALLTRIM(CH_F02),LEN(ALLTRIM(CH_F02)) - 2),0+64,'提示訊息視窗')
       ENDIF
	   SELECT C66_2
	   GO TOP
	   DO WHILE !EOF()
	      SELECT C66_TEMP.* FROM C66_TEMP WHERE C66_TEMP.EXP_1 = 1 AND C66_TEMP.F02 = C66_2.F02 ORDER BY C66_TEMP.F03 INTO CURSOR C66ABC
	      REPORT FORM ALLTRIM(INT_116)+'C66' TO PRINT PROMPT PREVIEW 
	      CLEAR
	      ******傳送MAIL給該廠商負責之採購人員
	      WAIT WINDOW "傳送郵件,請稍後!" AT 0,150 NOWAIT NOCLEAR  
	      SELECT C66ABC
	      TMPCHR=IIF(OS()="Windows 5.01",CHR(13)+CHR(10),'<br/>')
	      GO TOP
	      DO WHILE !EOF()
	         MAIL_TEXT = MAIL_TEXT + '廠商簡稱：' + IIF(SEEK(C66ABC.F18,'D01'),D01.F04,C66ABC.F18) + TMPCHR + ;
	         			 '採購單號：' + C66ABC.F12 + TMPCHR + ;
	         			 '料品編號：' + C66ABC.F04 + TMPCHR + ;
	         			 '異動類別：' + ICASE(C66ABC.F02 = '1','提前交期',C66ABC.F02 = '2','延後交期','取消請購') + TMPCHR + ;
	         			 '異動數量：' + ALLTRIM(TRANSFORM(C66ABC.F05,'@R 99,999,999.99'))  + TMPCHR + ;
	         			 '希望交期：' + DTOC(C66ABC.F07) + TMPCHR+ ;
	         			 '載運方式：' + C66ABC.F088 +TMPCHR + ;
	         			 '運費對象：' + ICASE(C66ABC.F10 = '1','客戶負擔',C66ABC.F10 = '1','公司負擔','') + TMPCHR + ;
	         			 '備註說明：' + C66ABC.F14 + TMPCHR + ;
	         			 '************************************************' + TMPCHR
 	         SELECT C66ABC
 	         SKIP
 	      ENDDO
 	      ****傳送MAIL給負責此廠商之採購
 	      IF SEEK(C66_1.F18,'D01') = .T. AND EMPTY(D01.F39) = .F. AND  SEEK(D01.F39,'A01') = .T. AND ALLTRIM(A01.F06) = 'Y' AND AT('@',A01.F10) <> 0 AND EMPTY(MAIL_TEXT) = .F.
 	         PRS_NO=A01.F01
             IF OS()="Windows 5.01"
                SEND_MAIL(ALLTRIM(INT_MAI),ALLTRIM(A01.F10),ALLTRIM(INT_DNS),'系統通知：C66.入貨異動申請單、客戶簡稱：' + IIF(SEEK(C66_2.F11,'C01'),C01.F05,C66_2.F11) + '、異動類別：' + ICASE(C66_2.F02 = '1','提前交期',C66_2.F02 = '2','延後交期','取消請購'),'TEXT',MAIL_TEXT)
              ELSE
                 IF !EMPTY(ALLTRIM(PRS_NO))
                    FILE_NAME=ALLTRIM(INT_DAT)+ALLTRIM(PRS_NO)+'.TXT'                  
                    STRTOFILE('<TR><TD>'+MAIL_TEXT+'<TD>C66.入貨異動申請單、客戶簡稱：'+IIF(SEEK(C66_2.F11,'C01'),C01.F05,C66_2.F11) + '、異動類別：' + ICASE(C66_2.F02 = '1','提前交期',C66_2.F02 = '2','延後交期','取消請購')+'<TD>'+TTOC(DATETIME())+ CHR(13) + CHR(10),FILE_NAME,1) 
                 ENDIF     
              ENDIF
          ELSE
             PRS_NO=''
          ENDIF
 	      ****傳送MAIL給負責此廠商之採購主管
 	      IF SEEK(C66_1.F18,'D01') = .T. AND EMPTY(D01.F25) = .F. AND  SEEK(LEFT(D01.F25,5),'A01') = .T. AND ALLTRIM(A01.F06) = 'Y' AND AT('@',A01.F10) <> 0 AND EMPTY(MAIL_TEXT) = .F.
             PRS_CHEF=A01.F01
             IF OS()="Windows 5.01"
                SEND_MAIL(ALLTRIM(INT_MAI),ALLTRIM(A01.F10),ALLTRIM(INT_DNS),'系統通知：C66.入貨異動申請單、客戶簡稱：' + IIF(SEEK(C66_2.F11,'C01'),C01.F05,C66_2.F11) + '、異動類別：' + ICASE(C66_2.F02 = '1','提前交期',C66_2.F02 = '2','延後交期','取消請購'),'TEXT',MAIL_TEXT)
             ELSE
                IF !EMPTY(ALLTRIM(PRS_CHEF))
                    FILE_NAME=ALLTRIM(INT_DAT)+ALLTRIM(PRS_CHEF)+'.TXT'                  
                    STRTOFILE('<TR><TD>'+MAIL_TEXT+'<TD>C66.入貨異動申請單、客戶簡稱：'+IIF(SEEK(C66_2.F11,'C01'),C01.F05,C66_2.F11) + '、異動類別：' + ICASE(C66_2.F02 = '1','提前交期',C66_2.F02 = '2','延後交期','取消請購')+'<TD>'+TTOC(DATETIME())+ CHR(13) + CHR(10),FILE_NAME,1) 
                 ENDIF     
             ENDIF
          ELSE
             PRS_CHEF=''
          ENDIF
          ****傳送MAIL給負責業助
 	      IF SEEK(C66_1.F11,'C01') = .T. AND EMPTY(C01.F23) = .F. AND ALLTRIM(SYS_OPER) <> ALLTRIM(C01.F23) AND  SEEK(C01.F23,'A01') = .T. AND ALLTRIM(A01.F06) = 'Y' AND AT('@',A01.F10) <> 0 AND EMPTY(MAIL_TEXT) = .F.
             ASSIS_NO=A01.F01
             IF OS()="Windows 5.01"
                SEND_MAIL(ALLTRIM(INT_MAI),ALLTRIM(A01.F10),ALLTRIM(INT_DNS),'系統通知：C66.入貨異動申請單、客戶簡稱：' + IIF(SEEK(C66_2.F11,'C01'),C01.F05,C66_2.F11) + '、異動類別：' + ICASE(C66_2.F02 = '1','提前交期',C66_2.F02 = '2','延後交期','取消請購'),'TEXT',MAIL_TEXT)
             ELSE
                IF !EMPTY(ALLTRIM(ASSIS_NO))
                    FILE_NAME=ALLTRIM(INT_DAT)+ALLTRIM(ASSIS_NO)+'.TXT'                  
                    STRTOFILE('<TR><TD>'+MAIL_TEXT+'<TD>C66.入貨異動申請單、客戶簡稱：'+IIF(SEEK(C66_2.F11,'C01'),C01.F05,C66_2.F11) + '、異動類別：' + ICASE(C66_2.F02 = '1','提前交期',C66_2.F02 = '2','延後交期','取消請購')+'<TD>'+TTOC(DATETIME())+ CHR(13) + CHR(10),FILE_NAME,1) 
                 ENDIF     
             ENDIF
          ELSE
             ASSIS_NO=''
          ENDIF
          ****傳送MAIL給負責業務B
 	      IF SEEK(C66_1.F11,'C01') = .T. AND EMPTY(C01.F33) = .F. AND ALLTRIM(SYS_OPER) <> ALLTRIM(C01.F33) AND  SEEK(C01.F33,'A01') = .T. AND ALLTRIM(A01.F06) = 'Y' AND AT('@',A01.F10) <> 0 AND EMPTY(MAIL_TEXT) = .F.
             SALES_B_NO=A01.F01
             IF SALES_B_NO<>ASSIS_NO
                IF OS()="Windows 5.01"
                   SEND_MAIL(ALLTRIM(INT_MAI),ALLTRIM(A01.F10),ALLTRIM(INT_DNS),'系統通知：C66.入貨異動申請單、客戶簡稱：' + IIF(SEEK(C66_2.F11,'C01'),C01.F05,C66_2.F11) + '、異動類別：' + ICASE(C66_2.F02 = '1','提前交期',C66_2.F02 = '2','延後交期','取消請購'),'TEXT',MAIL_TEXT)
                ELSE
                   IF !EMPTY(ALLTRIM(SALES_B_NO))
                      FILE_NAME=ALLTRIM(INT_DAT)+ALLTRIM(SALES_B_NO)+'.TXT'                  
                      STRTOFILE('<TR><TD>'+MAIL_TEXT+'<TD>C66.入貨異動申請單、客戶簡稱：'+IIF(SEEK(C66_2.F11,'C01'),C01.F05,C66_2.F11) + '、異動類別：' + ICASE(C66_2.F02 = '1','提前交期',C66_2.F02 = '2','延後交期','取消請購')+'<TD>'+TTOC(DATETIME())+ CHR(13) + CHR(10),FILE_NAME,1) 
                   ENDIF     
                ENDIF
             ENDIF   
          ELSE
             SALES_B_NO=''   
          ENDIF
          ****傳送MAIL給負責業務A
 	      IF SEEK(C66_1.F11,'C01') = .T. AND EMPTY(C01.F18) = .F. AND ALLTRIM(SYS_OPER) <> ALLTRIM(C01.F18) AND  SEEK(C01.F18,'A01') = .T. AND ALLTRIM(A01.F06) = 'Y' AND AT('@',A01.F10) <> 0 AND EMPTY(MAIL_TEXT) = .F.
             SALES_A_NO=A01.F01
             IF SALES_A_NO<>SALES_B_NO
                IF OS()="Windows 5.01"
                   SEND_MAIL(ALLTRIM(INT_MAI),ALLTRIM(A01.F10),ALLTRIM(INT_DNS),'系統通知：C66.入貨異動申請單、客戶簡稱：' + IIF(SEEK(C66_2.F11,'C01'),C01.F05,C66_2.F11) + '、異動類別：' + ICASE(C66_2.F02 = '1','提前交期',C66_2.F02 = '2','延後交期','取消請購'),'TEXT',MAIL_TEXT)
                ELSE
                   IF !EMPTY(ALLTRIM(SALES_A_NO))
                      FILE_NAME=ALLTRIM(INT_DAT)+ALLTRIM(SALES_A_NO)+'.TXT'                  
                      STRTOFILE('<TR><TD>'+MAIL_TEXT+'<TD>C66.入貨異動申請單、客戶簡稱：'+IIF(SEEK(C66_2.F11,'C01'),C01.F05,C66_2.F11) + '、異動類別：' + ICASE(C66_2.F02 = '1','提前交期',C66_2.F02 = '2','延後交期','取消請購')+'<TD>'+TTOC(DATETIME())+ CHR(13) + CHR(10),FILE_NAME,1) 
                    ENDIF     
                ENDIF
             ENDIF   
          ELSE
             SALES_A_NO=''   
          ENDIF         
          
          WAIT CLEAR 
		  SELECT C66ABC
		  USE   
	      SELECT C66_2
	      SKIP 
	   ENDDO
	   SELECT C66_2
	   USE
	   SELECT C66_TEMP
	   GO TOP
	   DO WHILE !EOF()
	      IF C66_TEMP.EXP_1 = 1
	         REPLACE C66_TEMP.EXP_1 WITH 0
	         REPLACE C66_TEMP.F01 WITH 1
	         REPLACE C66_TEMP.F03 WITH DATE()
	     	 SELECT C66
	     	 SET ORDER TO C661 &&F02+DTOS(F03)+F04+ALLTRIM(TRANSFORM(F05,"@R 99,999,999.99"))+F08+F10+F11+F12+F13
	     	 SEEK C66_TEMP.F02 + DTOS(C66_TEMP.F03) + C66_TEMP.F04 + ALLTRIM(TRANSFORM(C66_TEMP.F05,"@R 99,999,999.99")) + C66_TEMP.F08 + C66_TEMP.F10 + C66_TEMP.F11 + C66_TEMP.F12 + C66_TEMP.F13
		 	 IF FOUND()
		    	REPLACE C66.F01 WITH 1
		    	REPLACE C66.F03 WITH DATE()
		    	REPLACE C66.F15 WITH ''
		    	REPLACE C66.F16 WITH 0
		    	REPLACE C66.F98 WITH ''
		 	 ENDIF 
			 SELECT D07
			 SET ORDER TO D074   && F01+F02+DTOS(F03)
			 SEEK C66_TEMP.F12 + C66_TEMP.F04 + IIF(!EMPTY(C66_TEMP.F09),DTOS(C66_TEMP.F09),DTOS(C66_TEMP.F06))
			 IF FOUND()
			    REPLACE D07.F15 WITH DATE()
			 ENDIF
	      ENDIF
	      SELECT C66_TEMP
	      SKIP   
	   ENDDO
    ELSE
      =MESSAGEBOX('請選擇欲列印之資料!',0+64,'提示訊息視窗')
      THISFORM.GRID1.SETFOCUS 
      RETURN
    ENDIF
    SELECT C66_1
    USE
    SELECT C66_TEMP                                                                                    
    THISFORM.GRID1.SETFOCUS 
 ENDPROC 
ENDDEFINE   
**********
  DEFINE CLASS CheckBox1 AS CheckBox
      PROCEDURE CLICK
        IF THIS.VALUE=1
           REPLACE C66_TEMP.EXP_1 WITH 1
        ELSE
           REPLACE C66_TEMP.EXP_1 WITH 0      
        ENDIF
        THISFORM.GRID1.SETFOCUS     
   ENDPROC  
  ENDDEFINE 
***************************************************特殊輸入欄位設定-----------客戶
DEFINE CLASS TXTF3 AS TEXTBOX
  READONLY=.F.
  MAXLENGTH=5
  FONTSIZE=INT_015*9
  PROCEDURE INTERACTIVECHANGE
    IF AT('?',ALLTRIM(THIS.VALUE))<>0 
       IF AT('?',ALLTRIM(THIS.VALUE))>1             
          SELECT F02,F01,F04 FROM C01 INTO CURSOR VDR ORDER BY F02 WHERE LEFT(F02,AT('?',THIS.VALUE)-1)=LEFT(THIS.VALUE,AT('?',THIS.VALUE)-1)
       ELSE
          SELECT F02,F01,F04 FROM C01 INTO CURSOR VDR ORDER BY F02 
       ENDIF
       IF _TALLY>0          
          VDR_SEEK=createobject("VDR_SEEK")  
          VDR_SEEK.SHOW    
          THIS.VALUE=FLG
          THIS.REFRESH
          FLG='0'        
       ENDIF   
    ELSE
       IF LEN(ALLTRIM(THIS.VALUE))=4
          SELECT F02,F01,F04 FROM C01 INTO CURSOR VDR ORDER BY F02 WHERE F02=ALLTRIM(THIS.VALUE)
          DO CASE
             CASE _TALLY=1
                  THIS.VALUE=VDR.F01
                  THIS.REFRESH
             CASE _TALLY>1
                  VDR_SEEK=createobject("VDR_SEEK")  
                  VDR_SEEK.SHOW    
                  THIS.VALUE=FLG
                  THIS.REFRESH
                  FLG='0'        
          ENDCASE      
       ENDIF    
    ENDIF      
       THISFORM.LABEL31.CAPTION=IIF(SEEK(THIS.VALUE,'C01'),C01.F05,'')  
  ENDPROC
ENDDEFINE