****程式名稱 核對庫存報表
CLOSE ALL
CLEAR
IF !USED('A02')
   SELE 0
   USE A02 INDE A02
ELSE
   SELE A02
ENDIF
SET ORDER TO A021      
SEEK sys_oper+'B38'
IF !USED('A23')
   SELE 0
   USE A23
ELSE
   SELE A23
ENDIF
SET ORDER TO 1
SEEK LEFT(DTOS(DATE()),6)+'01'
SKIP -1
IF F07<>.T.
   =MESSAGEBOX('上個月的月庫存報表尚未結轉,請結轉後再執行此功能!',0+48,'提示訊息視窗')
   CLOSE ALL
   RETURN
ENDIF   
IF !USED('B11')
   SELE 0
   USE B11
ELSE
   SELE B11
ENDIF
SET ORDER TO B111
DELETE  FOR F04=0
B25='B25'+LEFT(DTOS(DATE()),6)    &&部門別月報表
B251='B251'+LEFT(DTOS(DATE()),6)
IF !USED('&B25')
   SELE 0
   USE (B25) ALIA B25
ELSE
   SELE B25
ENDIF
SET ORDER TO B251     
*****
B38FORM=CREATEOBJECT("TKB38")
B38FORM.SHOW  
DEFINE CLASS TKB38 AS FORM
  CAPTION='B38.核對庫存報表'
*!*	  AUTOCENTER=.T.
  CONTROLBOX=.F.
  BORDERSTYLE=1  
  MAXBUTTON=.F.
  MINBUTTON=.F.
  MOVABLE=.F.
  CLOSABLE=.F.
  CONTROLCOUNT=57
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*550
  WIDTH=INT_015*791
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WINDOWTYPE=1
  NAME='TKB38' 
  ADD OBJECT CMND1 AS COMMANDBUTTON WITH;
      VISIBLE=.F.,;
      LEFT=INT_015*131,;
      TOP=INT_015*340,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\harrow.cur',;        
      CAPTION='\<C.選擇',;
      TOOLTIPTEXT='選擇此作業畫面!快速鍵->ALT+A'
      NAME='CMND1'        
  PROCEDURE  INIT       
      v_scrx=SYSMETRIC(1)
      v_scry=SYSMETRIC(2)
      DO CASE
           CASE  v_scrx=640 AND v_scry=480 
                      THISFORM.PICTURE='BMPS\XP800600.JPG' 
           CASE  v_scrx=800 AND v_scry=600 
                      THISFORM.PICTURE='BMPS\XP800600.JPG' 
           CASE  v_scrx=1024 AND v_scry=768
  	              THISFORM.PICTURE='BMPS\XP1024768.JPG' 
           OTHERWISE
     	              THISFORM.PICTURE='BMPS\XP1024768.JPG' 
      ENDCASE  
 ENDPROC
 PROCEDURE ACTIVATE
       THISFORM.CMND1.SETFOCUS
       THISFORM.CMND1.CLICK	
 ENDPROC
 PROCEDURE CMND1.CLICK  
      TKB38_TEMP=CREATEOBJECT("TKB38_TEMP")  
      TKB38_TEMP.SHOW    
      THISFORM.RELEASE      
      IF !USED('A05')
           SELE 0
           USE A05 
      ELSE
           SELE A05
      ENDIF   
      SET ORDER TO 1    
      SEEK sys_oper+'B38'
      IF FOUND()
         DELETE 
      ENDIF   
      UNLOCK ALL                  
      CLOSE TABLE ALL
      THISFORM.RELEASE 
      RETURN  
ENDPROC                  
ENDDEFINE
*****     
DEFINE CLASS TKB38_TEMP AS FORM
*!*	  AUTOCENTER=.T.
  CAPTION='B38.核對庫存報表'
  TOP=INT_015*170
  LEFT=INT_015*240    
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*200
  WIDTH=INT_015*320
  MAXBUTTON=.F.
  MINBUTTON=.F.
  MOVABLE=.F.
  CLOSABLE=.F.    
  CONTROLBOX=.F.
  BORDERSTYLE=2
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WINDOWTYPE=1
  NAME='TKB38_TEMP'
  ADD OBJECT LBL1 AS LABEL WITH;
      LEFT=INT_015*5,;
      TOP=INT_015*40,;
      AUTOSIZE=.T.,;
      CAPTION='更動料號'
  ADD OBJECT LBL11 AS LABEL WITH;
      LEFT=INT_015*200,;
      TOP=INT_015*40,;
      AUTOSIZE=.T.,;
      CAPTION='/'+ALLTRIM(STR(RECCOUNT('B11')))
  ADD OBJECT LBL2 AS LABEL WITH;
      LEFT=INT_015*5,;
      TOP=INT_015*100,;
      AUTOSIZE=.T.,;
      CAPTION='更動數量'     
  ADD OBJECT LBL21 AS LABEL WITH;
      LEFT=INT_015*200,;
      TOP=INT_015*100,;
      AUTOSIZE=.T.,;
      CAPTION='/'+ALLTRIM(STR(RECCOUNT('B25')))                  
  ADD OBJECT TXT2 AS TEXTBOX WITH;
      LEFT=INT_015*75,;
      TOP=INT_015*35,;
      HEIGHT=INT_015*30,;
      WIDTH=INT_015*120,;
       ALIGNMENT=1,;
      NAME='TXT2'          
  ADD OBJECT TXT3 AS TEXTBOX WITH;
      LEFT=INT_015*75,;
      TOP=INT_015*95,;
      HEIGHT=INT_015*30,;
      WIDTH=INT_015*120,;
      ALIGNMENT=1,;
      NAME='TXT3'                
  ADD OBJECT CMND1 AS COMMANDBUTTON WITH;
      LEFT=INT_015*60,;
      TOP=INT_015*150,;
      HEIGHT=INT_015*30,;
      WIDTH=INT_015*65,;
      FONTSIZE=INT_015*12,;
      CAPTION='\<Y.確認',;
      TOOLTIPTEXT='確認後開始執行核對',;
      NAME='CMND1'
  ADD OBJECT CMND2 AS COMMANDBUTTON WITH;
      LEFT=INT_015*200,;
      TOP=INT_015*150,;
      HEIGHT=INT_015*30,;
      WIDTH=INT_015*65,;
      FONTSIZE=INT_015*12,;
      CAPTION='\<C.離開',;
      TOOLTIPTEXT='離開執行,並離開此查詢尋畫面!快速鍵->ALT+C'
      NAME='CMND2'
  PROCEDURE INIT 
      THISFORM.SETALL('FONTSIZE',INT_015*11,'LABEL')
      THISFORM.SETALL('HEIGHT',INT_015*25,'TEXTBOX')
      THISFORM.SETALL('FONTSIZE',INT_015*11,'TEXTBOX')
      THISFORM.SETALL('READONLY',.T.,'TEXTBOX')
      THISFORM.SETALL('FONTSIZE',INT_015*11,'COMMANDBUTTON')  
      THISFORM.SETALL('MOUSEPOINTER',99,'COMMANDBUTTON')  
      THISFORM.SETALL('MOUSEICON','BMPS\harrow.cur','COMMANDBUTTON')  
      THISFORM.CMND1.SETFOCUS            
  ENDPROC
  **
  PROCEDURE CMND1.CLICK
      THISFORM.TXT2.VALUE=0 
      THISFORM.TXT3.VALUE=0 
      THISFORM.CMND1.ENABLED=.F.
      THISFORM.CMND2.ENABLED=.F.
      DELETE FROM B11 WHERE F01+F03 NOT IN (SELE F01+F02 FROM B25)
      DELETE FROM B11 WHERE F01+F03 =ANY(SELE F01+F02 FROM B25 WHERE F15=0)
      SELECT B11.F01,B11.F03,B11.F04,B25.F15 FROM B11,B25 WHERE B25.F01+B25.F02=B11.F01+B11.F03 AND B25.F15<>B11.F04 ORDER BY B11.F01,B11.F03 INTO CURSOR CHTK1 NOWAIT
      IF _TALLY>0
        SELECT CHTK1
        GO TOP
        DO WHILE !EOF()
           SELECT B11
           SEEK CHTK1.F01+CHTK1.F03
           IF FOUND()
              REPLACE F04 WITH CHTK1.F15
           ENDIF
           THISFORM.TXT2.VALUE=B11.F03
           THISFORM.TXT3.VALUE=B11.F04
           SELECT CHTK1
           SKIP
        ENDDO
      ENDIF
      SELECT B25.F01,B25.F02,B25.F15 FROM B25 WHERE B25.F01+B25.F02 NOT IN(SELE F01+F03 FROM B11) AND B25.F15<>0 ORDER BY B25.F01,B25.F02 INTO CURSOR CHTK3 NOWAIT
      IF _TALLY>0
         SELECT CHTK3
         GO TOP
         DO WHILE !EOF()
            SELECT B11
            APPEND BLANK
            REPLACE F01 WITH CHTK3.F01
            REPLACE F03 WITH CHTK3.F02
            REPLACE F04 WITH CHTK3.F15
            THISFORM.TXT2.VALUE=B11.F03
            THISFORM.TXT3.VALUE=B11.F04            
            SELECT CHTK3
            SKIP
         ENDDO
      ENDIF
       =MESSAGEBOX('核對庫存報表作業已成功',0+64,'提示訊息視窗')  
      THISFORM.CMND1.ENABLED=.T.
      THISFORM.CMND2.ENABLED=.T.    
      THISFORM.CMND2.SETFOCUS 
  ENDPROC   
  PROCEDURE CMND2.CLICK        
       CLOSE TABLE ALL
       THISFORM.RELEASE 
       RETURN  
  ENDPROC   
**
 PROC CMND1.MOUSEENTER      
       LPARAMETERS nButton, nShift, nXCoord, nYCoord 
             THISFORM.CMND1.FORECOLOR=RGB(255,0,0)
             THISFORM.CMND1.TOP=INT_015*151
             THISFORM.CMND1.LEFT=INT_015*61
  ENDPROC     
  PROC CMND1.MOUSELEAVE      
        LPARAMETERS nButton, nShift, nXCoord, nYCoord 
             THISFORM.CMND1.FORECOLOR=RGB(0,0,0)  
             THISFORM.CMND1.TOP=INT_015*150
             THISFORM.CMND1.LEFT=INT_015*60                
  ENDPROC 
 PROC CMND2.MOUSEENTER      
       LPARAMETERS nButton, nShift, nXCoord, nYCoord 
             THISFORM.CMND2.FORECOLOR=RGB(255,0,0)
             THISFORM.CMND2.TOP=INT_015*151
             THISFORM.CMND2.LEFT=INT_015*201
  ENDPROC     
  PROC CMND2.MOUSELEAVE      
        LPARAMETERS nButton, nShift, nXCoord, nYCoord 
             THISFORM.CMND2.FORECOLOR=RGB(0,0,0)  
             THISFORM.CMND2.TOP=INT_015*150
             THISFORM.CMND2.LEFT=INT_015*200
 ENDPROC         
ENDDEFINE            
