******借入明細表
close all
clear 
FLG='0'
FCH=''
CHK=''
R=0
AREA1='B65_1'
AREA2='B65_3'
IF ! USED('A01')
   SELE 0
   USE A01 INDE A01
ELSE
   SELE A01
ENDIF      
SET ORDER TO A01
IF !USED('A02')
   SELE 0
   USE A02 INDE A02
ELSE
   SELE A02
ENDIF
SET ORDER TO A021      
SEEK sys_oper+'B65'
IF !USED('B01')
   SELE 0
   USE B01 INDE B01
ELSE
   SELE B01
ENDIF
SET ORDER TO 1   
SELE 0
USE D01
SET ORDER TO 1
SELE 0
IF !USED('C05')
   SELE 0
   USE C05
ELSE
   SELE C05
ENDIF
SET ORDER TO C053
SET FILTER TO LEFT(F01,2)='BU'
CREATE CURSOR B65_1;
(F06 C(5),FL1 N(12))
INDE ON F06 TAG B65_11
SELE F06 FROM C05 GROUP BY F06 ORDER BY F06 INTO CURSOR B65_1A WHERE LEFT(F01,2)='BU'
SELE B65_1A
GO TOP
DO WHILE !EOF()
   SELE B65_1
   APPEND BLANK
   REPL F06 WITH B65_1A.F06  
   REPL FL1 WITH TTL1(B65_1A.F06)
   SELE B65_1A
   SKIP   
ENDDO
SELE B65_1A
USE   
SELE B65_1
SET ORDER TO 1
SET RELA TO F06 INTO D01      
CREATE CURSOR B65_2;
(F02 C(43),FL2 N(12))
INDE ON F02 TAG B65_21
SELE F02 FROM C05 GROUP BY F02 ORDER BY F02 INTO CURSOR B65_2A WHERE LEFT(F01,2)='BU'
SELE B65_2A
GO TOP
DO WHILE !EOF()
   SELE B65_2
   APPEND BLANK
   REPL F02 WITH B65_2A.F02  
   REPL FL2 WITH TTL2(B65_2A.F02)
   SELE B65_2A
   SKIP   
ENDDO
SELE B65_2A
USE 
SELE B65_2
SET ORDER TO 1
CREATE CURSOR B65_3;
(F02 C(43),F04 N(12),F06 C(5))
INDE ON F06+F02 TAG B65_31
INDE ON F02+F06 TAG B65_32
SELE F02,SUM(F04),F06 FROM C05 GROUP BY F06,F02 ORDER BY F06,F02 INTO CURSOR B65_3A WHERE LEFT(F01,2)='BU'
SELE B65_3A
GO TOP
DO WHILE !EOF()
   SELE B65_3
   APPEND BLANK
   REPL F02 WITH B65_3A.F02
   REPL F04 WITH B65_3A.SUM_F04
   REPL F06 WITH B65_3A.F06
   SELE B65_3A
   SKIP
ENDDO
SELE B65_3A
USE
SELE B65_3
SET ORDER TO 1
SET RELA TO F02 INTO B01
B65form=createobject("tkB65")
B65form.show  
define class tkB65 as form
  caption='B65.借入明細帳'
*!*	  autocenter=.t.
  controlbox=.F.
  BORDERSTYLE=1  
  MAXBUTTON=.F.
  MINBUTTON=.F.
  MOVABLE=.F.
  CLOSABLE=.F.
  controlcount=57
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*550
  showtips=.t.
  showwindow=1
  width=INT_015*789
  windowtype=1
  NAME='TKB11'
  add object shape1 as shape1 with;
      autocenter=.t.

  ADD OBJECT LBL_REC AS LBL_REC WITH;
      AUTOCENTER =.T.
  ADD OBJECT REC_COUNT AS REC_COUNT  with;
      caption=str(reccount())        
  add object shape2 as shape2 with;
      autocenter=.t.
  add object shape3 as shape3 with;
      autocenter=.t.
  ADD OBJECT PAGEFRAME1 AS PAGEFRAME WITH;
      LEFT=INT_015*236,;
      WIDTH=INT_015*540,;
      HEIGHT=INT_015*200,;
      PAGECOUNT=2,;
      TABSTRETCH=1,;
      ACTIVEPAGE=1,;
      VISIBLE=.T.,;
      PAGE1.NAME='PAGE1',;
      PAGE1.VISIBLE=.T.,;
      PAGE1.CAPTION='依照廠商搜尋紀錄',;
      PAGE2.NAME='PAGE2',;
      PAGE2.VISIBLE=.T.,;
      PAGE2.CAPTION='詳細資料內容'   
  ADD OBJECT KEY_LIST AS KEY_LIST WITH;
      AUTOCENTER=.T.
  ADD OBJECT grid1 AS grid1 WITH;
      columncount=2,;            
      RECORDSOURCE='B65_1',;
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2'      
  ADD OBJECT grid2 AS grid2 WITH;
      columncount=5,;            
      RECORDSOURCE='B65_3',;
      LINKMASTER='B65_1',;
      RELATIONALEXPR='F06',;
      CHILDORDER='B65_31',;      
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;
      COLUMN3.NAME='COLUMN3',;
      COLUMN4.NAME='COLUMN4',;
      COLUMN5.NAME='COLUMN5'
  ADD OBJECT CMDGROUP AS CMDGROUP WITH;
      TOP=INT_015*415,;
      LEFT=INT_015*10,;
      ENABLED=.T.,;
      VISIBLE=.T.  
  ADD OBJECT ORPGROUP AS ORPGROUP WITH;
      TOP=INT_015*455,;
      LEFT=INT_015*10                            
  PROCEDURE PAGEFRAME1.PAGE1.INIT     
     THIS.ADDOBJECT('LBLF01','LABEL')
     WITH THIS.LBLF01
          .VISIBLE=.T.
          .LEFT=INT_015*14
          .TOP=INT_015*27
          .WIDTH=INT_015*50
          .CAPTION='廠商編號'          
     ENDWITH
     THIS.ADDOBJECT('LBLF011','LABEL')     
     WITH THIS.LBLF011
          .VISIBLE=.T.
          .LEFT=INT_015*140
          .TOP=INT_015*27
          .AUTOSIZE=.T.  
     ENDWITH            
     THIS.ADDOBJECT('LBLTTL1','LABEL')     
     WITH THIS.LBLTTL1
          .VISIBLE=.T.
          .LEFT=INT_015*14
          .TOP=INT_015*52
          .WIDTH=INT_015*50
          .CAPTION='金額總計'  
     ENDWITH                 
     THIS.ADDOBJECT('LBLTTL11','LABEL')     
     WITH THIS.LBLTTL11
          .VISIBLE=.T.
          .LEFT=INT_015*64
          .TOP=INT_015*52
          .AUTOSIZE=.T.
     ENDWITH                      
     THIS.ADDOBJECT('TXTF01','TEXTBOX')     
     WITH THIS.TXTF01
          .VISIBLE=.T.
          .LEFT=INT_015*64
          .TOP=INT_015*23
          .WIDTH=INT_015*74
          .HEIGHT=INT_015*25
          .MAXLENGTH=5
     ENDWITH        
  ENDPROC   
  PROCEDURE PAGEFRAME1.PAGE2.INIT
	THIS.ADDOBJECT('LBLF06','LABEL')
	WITH THIS.LBLF06  
         .LEFT=INT_015*14
         .TOP=INT_015*13
	     .WIDTH=INT_015*50
         .CAPTION='廠商編號'
    ENDWITH  
    THIS.ADDOBJECT('LBLF061','LABEL')
    WITH THIS.LBLF061
         .LEFT=INT_015*126
	     .TOP=INT_015*14
	     .autosize=.t.
	ENDWITH     
    THIS.ADDOBJECT('LBLF02','LABEL')
    WITH THIS.LBLF02
         .VISIBLE=.T.
	     .LEFT=INT_015*14
	     .TOP=INT_015*14
	     .WIDTH=INT_015*50
	     .CAPTION='品        號'
	ENDWITH     
    THIS.ADDOBJECT('LBLF021','Label')
    WITH THIS.LBLF021
         .VISIBLE=.T.
         .LEFT=INT_015*337
         .TOP=INT_015*14
         .WIDTH=INT_015*144         
    ENDWITH     
    THIS.ADDOBJECT('LBLF04','LABEL')
    WITH THIS.LBLF04
         .VISIBLE=.T.    
         .LEFT=INT_015*14
         .TOP=INT_015*39
         .WIDTH=INT_015*50
         .CAPTION='借入數量'       
    ENDWITH     
    THIS.ADDOBJECT('LBLF05','LABEL')
    WITH THIS.LBLF05
         .VISIBLE=.T.    
         .LEFT=INT_015*14
         .TOP=INT_015*64
         .WIDTH=INT_015*50
         .CAPTION='進貨單價'       
    ENDWITH     
    THIS.ADDOBJECT('LBLF07','LABEL')
    WITH THIS.LBLF07
         .VISIBLE=.T.    
         .LEFT=INT_015*14
         .TOP=INT_015*89
         .WIDTH=INT_015*50
         .CAPTION='金額小計'       
    ENDWITH         
	THIS.ADDOBJECT('TXTF06','TEXTBOX')
	WITH THIS.TXTF06      
	     .LEFT=INT_015*65
	     .TOP=INT_015*10
	     .WIDTH=INT_015*60
	     .HEIGHT=INT_015*25
	     .MAXLENGTH=5
	     .NAME='TXTF06'  
	ENDWITH     
	THIS.ADDOBJECT('TXTF02','TEXTBOX')
	WITH THIS.TXTF02
	     .VISIBLE=.T.
	     .LEFT=INT_015*65
	     .TOP=INT_015*10
	     .WIDTH=INT_015*261
	     .HEIGHT=INT_015*25
	     .MAXLENGTH=43
	     .NAME='TXTF02'	    
	ENDWITH     
    THIS.ADDOBJECT('TXTF04','TEXTBOX')
    WITH THIS.TXTF04
         .VISIBLE=.T.           
         .LEFT=INT_015*65
         .TOP=INT_015*35
         .WIDTH=INT_015*120
         .INPUTMASK='999999999999.9999'
         .NAME='TXTF04'
    ENDWITH             
    THIS.ADDOBJECT('TXTF05','TEXTBOX')
    WITH THIS.TXTF05
         .VISIBLE=.T.           
         .LEFT=INT_015*65
         .TOP=INT_015*60
         .WIDTH=INT_015*120
         .INPUTMASK='99999999999.9999'
         .NAME='TXTF05'
    ENDWITH                 
    THIS.ADDOBJECT('TXTF07','TEXTBOX')
    WITH THIS.TXTF07
         .VISIBLE=.T.           
         .LEFT=INT_015*65
         .TOP=INT_015*85
         .WIDTH=INT_015*120
         .INPUTMASK='99999999999.9999'
         .NAME='TXTF07'
    ENDWITH                     
  ENDPROC       
  PROCEDURE PAGEFRAME1.PAGE1.activate
     R=0
     IF THISFORM.KEY_LIST.DISPLAYVALUE='依廠商編號排列'
        SELE B65_1
     ELSE
        SELE B65_2
     ENDIF      
     SEEK THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE          
     THISFORM.GRID1.ENABLED=.T.          
     THISFORM.GRID1.SETFOCUS     
     IF THISFORM.GRID1.ACTIVEROW=0
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
        THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=''
        THISFORM.PAGEFRAME1.PAGE1.LBLF011.CAPTION=''
        THISFORM.PAGEFRAME1.PAGE1.LBLTTL11.CAPTION=''
     ELSE
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.
     ENDIF   
     THISFORM.KEY_LIST.ENABLED=.T.
  ENDPROC
  PROCEDURE PAGEFRAME1.PAGE2.activate
     SELE B65_3
     THISFORM.GRID2.ENABLED=.T.
     THISFORM.GRID2.SETFOCUS 
     IF THISFORM.GRID2.ACTIVEROW=0 
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
        THISFORM.PAGEFRAME1.PAGE2.SETALL('VALUE','','TEXTBOX')
        THISFORM.PAGEFRAME1.PAGE2.TXTF06.VALUE=''
        THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE=''
        THISFORM.PAGEFRAME1.PAGE2.LBLF061.CAPTION=''
        THISFORM.PAGEFRAME1.PAGE2.LBLF021.CAPTION=''
     ELSE
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.  
     ENDIF   
     R=RECNO('&AREA1')
     THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(RECNO('&AREA1')=R,RGB(255,255,0),'')","COLUMN")
     THISFORM.GRID1.ENABLED=.F.     
     THISFORM.KEY_LIST.ENABLED=.F.     
  ENDPROC   
  PROC INIT              
       thisform.setall('height',INT_015*25,'textbox')
       thisform.setall('height',INT_015*17,'label')
       thisform.setall('FONTSIZE',INT_015*9,'textbox')
       thisform.setall('FONTSIZE',INT_015*9,'label')       
       THISFORM.SETALL('READONLY',.T.,'TEXTBOX')
       THISFORM.ORPGROUP.NEW_BOTT.VISIBLE=.F.
       THISFORM.ORPGROUP.EDIT_BOTT.VISIBLE=.F.
       THISFORM.ORPGROUP.DEL_BOTT.VISIBLE=.F. 
       THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限      
       THISFORM.PAGEFRAME1.PAGE1.LBLTTL1.VISIBLE=IIF(A02.F08='*',.T.,.F.)    &&判斷有無查看成本的權利
       THISFORM.PAGEFRAME1.PAGE1.LBLTTL11.VISIBLE=IIF(A02.F08='*',.T.,.F.)   &&判斷有無查看成本的權利
       THISFORM.PAGEFRAME1.PAGE2.LBLF05.VISIBLE=IIF(A02.F08='*',.T.,.F.)   &&判斷有無查看成本的權利
       THISFORM.PAGEFRAME1.PAGE2.LBLF07.VISIBLE=IIF(A02.F08='*',.T.,.F.)   &&判斷有無查看成本的權利                
       THISFORM.PAGEFRAME1.PAGE2.TXTF05.VISIBLE=IIF(A02.F08='*',.T.,.F.)   &&判斷有無查看成本的權利
       THISFORM.PAGEFRAME1.PAGE2.TXTF07.VISIBLE=IIF(A02.F08='*',.T.,.F.)   &&判斷有無查看成本的權利
       THISFORM.GRID2.COLUMN4.VISIBLE=IIF(A02.F08='*',.T.,.F.)   &&判斷有無查看成本的權利
       THISFORM.GRID2.COLUMN5.VISIBLE=IIF(A02.F08='*',.T.,.F.)   &&判斷有無查看成本的權利       
       thisform.GRID1.setall('FONTSIZE',INT_015*9,'COLUMN')
       thisform.GRID1.setall('FONTSIZE',INT_015*9,'HEADER')       
       THISFORM.GRID1.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)
       THISFORM.GRID2.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)       
       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*50
       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*50
       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='廠商編號'
       THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='廠商名稱'
       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='B65_1.F06'
       THISFORM.GRID1.COLUMN2.CONTROLSOURCE='D01.F04'
       thisform.GRID2.setall('FONTSIZE',INT_015*9,'COLUMN')
       thisform.GRID2.setall('FONTSIZE',INT_015*9,'HEADER')       
       THISFORM.grid2.COLUMN1.HEADER1.CAPTION='料品編號'
       THISFORM.grid2.COLUMN2.HEADER1.CAPTION='品名規格'
	   THISFORM.grid2.COLUMN3.HEADER1.CAPTION='借入數量'
	   THISFORM.grid2.COLUMN4.HEADER1.CAPTION='進貨單價'
	   THISFORM.grid2.COLUMN5.HEADER1.CAPTION='金額小計'	   
	   THISFORM.grid2.COLUMN1.CONTROLSOURCE='B65_3.F02'
	   THISFORM.grid2.COLUMN2.CONTROLSOURCE='B01.F02'
	   THISFORM.grid2.COLUMN3.CONTROLSOURCE='B65_3.F04'
	   THISFORM.grid2.COLUMN4.CONTROLSOURCE='B01.F38'
	   THISFORM.grid2.COLUMN5.CONTROLSOURCE='ROUND(B65_3.F04*B01.F38,0)'	   
	   THISFORM.grid2.COLUMN1.WIDTH=INT_015*149
	   THISFORM.GRID2.COLUMN2.WIDTH=INT_015*149
       THISFORM.grid2.COLUMN3.WIDTH=INT_015*100
       THISFORM.GRID2.COLUMN4.WIDTH=INT_015*63
       THISFORM.grid1.READONLY=.T.    
       THISFORM.grid2.READONLY=.T.       
       THISFORM.grid1.SETFOCUS
       IF THISFORM.GRID1.ACTIVEROW=0
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
       ELSE
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.      
       ENDIF          
       THISFORM.KEY_LIST.DISPLAYVALUE='依廠商編號排列'       
       JK='廠商編號'
       SELE B65_1
       GO TOP
       THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=B65_1.F06
       THISFORM.PAGEFRAME1.PAGE1.LBLF011.CAPTION=D01.F03
  ENDPROC           
  PROC KEY_LIST.INIT 
       with this 
           .additem('依廠商編號排列')
           .additem('依料品編號排列')
       endwith      
  ENDPROC 
  PROC KEY_LIST.INTERACTIVECHANGE                 
       SELE B65_1
       SET RELA OFF INTO B65_3
       SELE B01
       SET RELA OFF INTO B65_3
       SELE B65_3
       SET RELA OFF INTO B65_1
       SET RELA OFF INTO B01       
       THISFORM.GRID1.RECORDSOURCE=''
       THISFORM.GRID1.CHILDORDER=''
       DO CASE
          CASE THIS.DISPLAYVALUE='依廠商編號排列'
               THISFORM.PAGEFRAME1.PAGE1.CAPTION='依照廠商搜尋紀錄'
               SELE B65_1
               GO TOP
               AREA1='B65_1'
               SELE B65_3
               SET ORDER TO 1     
               SET RELA TO F02 INTO B01       
               THISFORM.PAGEFRAME1.PAGE1.LBLF01.CAPTION='廠商編號'
               THISFORM.PAGEFRAME1.PAGE1.TXTF01.WIDTH=INT_015*74
               THISFORM.PAGEFRAME1.PAGE1.TXTF01.MAXLENGTH=5
               THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=B65_1.F06
               THISFORM.PAGEFRAME1.PAGE1.LBLF011.LEFT=INT_015*140
               THISFORM.PAGEFRAME1.PAGE1.LBLF011.CAPTION=D01.F03
               THISFORM.PAGEFRAME1.PAGE2.LBLF06.VISIBLE=.F.
               THISFORM.PAGEFRAME1.PAGE2.LBLF061.VISIBLE=.F.
               THISFORM.PAGEFRAME1.PAGE2.TXTF06.VISIBLE=.F.
               THISFORM.PAGEFRAME1.PAGE2.TXTF06.ENABLED=.F.
               THISFORM.PAGEFRAME1.PAGE2.LBLF02.VISIBLE=.T.
               THISFORM.PAGEFRAME1.PAGE2.LBLF021.VISIBLE=.T.
               THISFORM.PAGEFRAME1.PAGE2.TXTF02.VISIBLE=.T.
               THISFORM.PAGEFRAME1.PAGE2.TXTF02.ENABLED=.T.
               THISFORM.GRID1.RECORDSOURCE='B65_1'
               THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='廠商編號'
               THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='廠商名稱'
               THISFORM.GRID1.COLUMN1.CONTROLSOURCE='B65_1.F06'
               THISFORM.GRID1.COLUMN2.CONTROLSOURCE='D01.F04'   
               THISFORM.GRID1.COLUMN1.WIDTH=INT_015*50
               THISFORM.GRID1.COLUMN2.WIDTH=INT_015*50
               THISFORM.GRID2.LINKMASTER='B65_1'
               THISFORM.GRID2.RELATIONALEXPR='F06'
               THISFORM.GRID2.CHILDORDER='B65_31'            
               THISFORM.grid2.COLUMN1.HEADER1.CAPTION='料品編號'
               THISFORM.grid2.COLUMN1.CONTROLSOURCE='B65_3.F02'
               THISFORM.grid2.COLUMN1.WIDTH=INT_015*149
               THISFORM.grid2.COLUMN2.HEADER1.CAPTION='品名規格'
               THISFORM.grid2.COLUMN2.CONTROLSOURCE='B01.F02'   
               THISFORM.grid2.COLUMN2.WIDTH=INT_015*100                     
          CASE THIS.DISPLAYVALUE='依料品編號排列'
               THISFORM.PAGEFRAME1.PAGE1.CAPTION='依照料號搜尋紀錄'          
               SELE B65_2
               GO TOP
               AREA1='B65_2'
               SELE B65_2
               SET ORDER TO 1
               SET RELA TO F02 INTO B01
               SELE B65_3
               SET ORDER TO 2
               SET RELA TO F06 INTO B65_1
               THISFORM.PAGEFRAME1.PAGE1.LBLF01.CAPTION='料品編號'
               THISFORM.PAGEFRAME1.PAGE1.TXTF01.WIDTH=INT_015*261
               THISFORM.PAGEFRAME1.PAGE1.TXTF01.MAXLENGTH=43
               THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=B65_2.F02
               THISFORM.PAGEFRAME1.PAGE1.LBLF011.LEFT=INT_015*337
               THISFORM.PAGEFRAME1.PAGE1.LBLF011.CAPTION=B01.F02
               THISFORM.PAGEFRAME1.PAGE2.LBLF06.VISIBLE=.T.
               THISFORM.PAGEFRAME1.PAGE2.LBLF061.VISIBLE=.T.
               THISFORM.PAGEFRAME1.PAGE2.TXTF06.VISIBLE=.T.
               THISFORM.PAGEFRAME1.PAGE2.TXTF06.ENABLED=.T.
               THISFORM.PAGEFRAME1.PAGE2.LBLF02.VISIBLE=.F.
               THISFORM.PAGEFRAME1.PAGE2.LBLF021.VISIBLE=.F.
               THISFORM.PAGEFRAME1.PAGE2.TXTF02.VISIBLE=.F.
               THISFORM.PAGEFRAME1.PAGE2.TXTF02.ENABLED=.F.                
               THISFORM.GRID1.RECORDSOURCE='B65_2'
               THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='料品編號'
               THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='品名規格'
               THISFORM.GRID1.COLUMN1.CONTROLSOURCE='B65_2.F02'
               THISFORM.GRID1.COLUMN2.CONTROLSOURCE='B01.F02'
               THISFORM.GRID1.COLUMN1.WIDTH=INT_015*149
               THISFORM.GRID1.COLUMN2.WIDTH=INT_015*149   
               THISFORM.GRID2.LINKMASTER='B65_2'
               THISFORM.GRID2.RELATIONALEXPR='F02'
               THISFORM.GRID2.CHILDORDER='B65_32'  
               THISFORM.grid2.COLUMN1.HEADER1.CAPTION='廠商編號'
               THISFORM.grid2.COLUMN1.CONTROLSOURCE='B65_3.F06'
               THISFORM.grid2.COLUMN1.WIDTH=INT_015*50               
               THISFORM.grid2.COLUMN2.HEADER1.CAPTION='廠商名稱'
               THISFORM.grid2.COLUMN2.CONTROLSOURCE='D01.F04'       
               THISFORM.grid2.COLUMN2.WIDTH=INT_015*50                                        
       ENDCASE 
        THISFORM.PAGEFRAME1.ACTIVEPAGE=2
        THISFORM.PAGEFRAME1.ACTIVEPAGE=1
        SELE &AREA1
        THISFORM.grid1.SETFOCUS
  ENDPROC      
  PROC grid1.AFTERROWCOLCHANGE
       LPARAMETERS nColIndex
       IF THISFORM.KEY_list.DISPLAYVALUE='依廠商編號排列'
          THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=B65_1.F06
          THISFORM.PAGEFRAME1.PAGE1.LBLF011.CAPTION=D01.F03
          THISFORM.PAGEFRAME1.PAGE1.LBLTTL11.CAPTION=TRANSFORM(B65_1.FL1,'@R 999,999,999,999')
       ELSE          
          THISFORM.PAGEFRAME1.page1.TXTF01.VALUE=B65_2.F02
          THISFORM.PAGEFRAME1.PAGE1.LBLF011.CAPTION=B01.F02
          THISFORM.PAGEFRAME1.PAGE1.LBLTTL11.CAPTION=TRANSFORM(B65_2.FL2,'@R 999,999,999,999')          
       ENDif

       FCH=THISFORM.ACTIVECONTROL.NAME
       JK=THIS.COLUMN1.HEADER1.CAPTION  
       IF THIS.ACTIVEROW=0
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
       ELSE
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.
       ENDIF   
       CHK=''     
       thisform.refresh
  ENDPROC     
  PROC grid2.AFTERROWCOLCHANGE
       LPARAMETERS nColIndex
       THISFORM.PAGEFRAME1.PAGE2.TXTF06.VALUE=B65_3.F06
       THISFORM.PAGEFRAME1.PAGE2.LBLF061.CAPTION=D01.F03
       THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE=B65_3.F02
       THISFORM.PAGEFRAME1.PAGE2.LBLF021.CAPTION=B01.F02
       THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE=B65_3.F04
       THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE=B01.F38
       THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE=ROUND(B65_3.F04*B01.F38,0)
     
       FCH=THISFORM.ACTIVECONTROL.NAME
       JK=THIS.COLUMN1.HEADER1.CAPTION
       CHK=THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
       if thisform.pageframe1.activepage=1
          thisform. CMDGROUP.SEEK_BOTT.ENABLED=.F.
       ENDIF   
  ENDPROC 
ENDDEFINE    
***********************************************列印程序
PROCEDURE PNT_PRC  
  IF AREA1='B65_1'
     LK=B65_1.F06
     SELE B65_3.F02,;
          B65_3.F04,;
          B01.F02,;
          B01.F38,;
          D01.F04,;
          B65_1.FL1;
     FROM B65_3,B01,D01,B65_1 WHERE B65_3.F06=LK AND B01.F01=B65_3.F02 AND D01.F01=LK AND B65_1.F06=LK ORDER BY B65_3.F02 NOWAIT
     IF _TALLY>0
        REPORT FORM ALLTRIM(INT_116)+'B65' TO PRINT PROMPT PREVIEW     
     ENDIF   
  ELSE
     =MESSAGEBOX('依料品編號排列方式列印您不覺得好像是在脫褲子放屁嗎?',0+48,'麥擱Ｚ啊啦!')   
  ENDIF 
ENDPROC
*******************************************   廠商別計算借入總金額
FUNC TTL1
     PARA BKK_NO
     qt_od=0
     sele C05
     SET ORDER TO C053
     SET RELA TO F02 INTO B01
     SEEK BKK_NO
     IF FOUND()
        DO WHILE F06=BKK_NO            
           qt_od=qt_od+f04*B01.F38
           SELE C05
           SKIP
        ENDDO
     ELSE
       qt_od=0
     ENDIF
     SELE B65_1
     RETURN ROUND(qt_od,0)
**********************************************  計算該料借入總金額
FUNC TTL2
     PARA BKK_NO
     qt_od=0
     sele C05
     SET ORDER TO C055
     SET RELA TO F02 INTO B01
     SEEK BKK_NO
     IF FOUND()
        DO WHILE F02=BKK_NO            
            qt_od=qt_od+f04*B01.F38
            SELE C05 
           SKIP
        ENDDO
     ELSE
       qt_od=0
     ENDIF
     SELE B65_2
     RETURN ROUND(qt_od,0)
