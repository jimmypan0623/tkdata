CLEAR ALL
CLOSE ALL
SET DELETED ON
SET EXCLUSIVE OFF
K=0
S=1
SELECT 0
USE \\192.168.10.160\MISD2\B01 ALIAS B01  
SET ORDER TO 1
SELECT 0
USE \\192.168.10.160\MISD2\C20 ALIAS C20
SET ORDER TO 1
SELECT B01.F01,B01.F02,B01.F41,VAL(C20.F03),C20.F11 FROM B01,C20 WHERE !EMPTY(B01.F41) AND C20.F01=B01.F01 AND LEFT(B01.F02,3)="JST" INTO TABLE TKSTOCKSRS ORDER BY B01.F01 NOWAIT
SELECT B01
USE
SELECT C20
USE

SELECT TKSTOCKSRS

 

GO TOP
DO WHILE !EOF()
   FILE_NAME="H:\tkmis\json\STOCKSRS"+PADL(S,3,'0')+".json"
   STRTOFILE('{'+'"'+'ITEM'+'"'+':'+'"'+ALLTRIM(STR(RECNO()))+'"'+','+'"'+'STOCKNO'+'"'+':'+'"'+ALLTRIM(F01)+'"'+','+'"'+'DSCRPT'+'"'+':'+'"'+ALLTRIM(F02)+'"'+','+'"'+'SRSNO'+'"'+':'+'"'+ALLTRIM(F41)+'"'+','+'"'+'MPQ'+'"'+':'+'"'+ALLTRIM(STR(EXP_4))+'"'+','+'"'+'PQ'+'"'+':'+'"'+ALLTRIM(STR(F11))+'"'+'}'+CHR(13) + CHR(10),FILE_NAME,1)
   SELECT TKSTOCKSRS
   K=K+1
   IF K=50
      S=S+1
      K=0
  ENDIF
  FILE_NAME="H:\TKMIS\JSON\STOCKSRSTTL.txt"
  STRTOFILE(TKSTOCKSRS.F41+CHR(13) + CHR(10),FILE_NAME,1)
  SKIP
ENDDO
CLOSE ALL