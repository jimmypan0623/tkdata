***程式名稱:B55完工入庫單
close all
clear 
FLG='0'
FCH=''
CHK=''
CHK_STR=''
R=0
QTY=0
TQTY=0
HD1='B020 '
HD2='BT'
HD3='完工入庫單'
AREA1='B55_1'
AREA2='B55'
IF !USED('A09')
   SELE 0
   USE A09
ELSE
   SELE A09
ENDIF
SET ORDER TO 1
IF !USED('A23')
    SELE 0
    USE A23
ELSE 
   SELE A23
ENDIF
SET ORDER TO 1         
A24='A24'+LEFT(DTOS(DATE()),6)     &&單號暫存檔
IF !USED('&A24')
   SELE 0
   USE (A24) ALIA A24
ELSE
   SELE A24
ENDIF
SET ORDER TO 1      
B25='B25'+LEFT(DTOS(DATE()),6)    &&部門別月報表
IF !USED('&B25')
   SELE 0
   USE (B25) ALIA B25
ELSE
   SELE B25
ENDIF
SET ORDER TO 1      
B26='B26'+LEFT(DTOS(DATE()),6)   &&庫存異動記錄
IF !USED('&B26')
   SELE 0
   USE (B26) ALIA B26
ELSE
   SELE B26
ENDIF
SET ORDER TO 1      
B39='B39'+LEFT(DTOS(DATE()),6)   &&未過帳單據查詢檔
IF !USED('&B39')
   SELE 0
   USE (B39) ALIA B39
ELSE
   SELE B39
ENDIF
SET ORDER TO 1      
SELE A23
SET ORDER TO 1
SEEK LEFT(DTOS(DATE()),6)+'01'
IF ! USED('A01')
   SELE 0
   USE A01 INDE A01
ELSE
   SELE A01
ENDIF      
SET ORDER TO A01
IF !USED('A02')
   SELE 0
   USE A02 INDE A02
ELSE
   SELE A02
ENDIF
SET ORDER TO A021      
SEEK sys_oper+'B55'
IF !USED('A14')
   SELE 0
   USE A14
ELSE 
   SELE A14
ENDIF
SET FILTER TO F04='*' AND F13='*'
SET ORDER TO 1    
CREATE CURSOR A14_1 (F01 C(5),F02 C(8))
INDE ON F01 TAG A14_11
SELE F01,F02 FROM A14 INTO CURSOR A14_2 ORDER BY F01 WHERE F04='*' AND F05='*' AND F13='*' AND LEN(ALLTRIM(F01))=4
GO TOP
DO WHILE !EOF()
   SELE A14_1
   APPEND BLANK
   REPL F01 WITH A14_2.F01
   REPL F02 WITH A14_2.F02
   SELE A14_2
   SKIP
ENDDO   
SELE A14_2
USE 
SELE A14_1
SET ORDER TO 1      
IF !USED('C03')
   SELE 0
   USE C03 INDE C03
ELSE
   SELE C03
ENDIF
SET ORDER TO C031 
IF !USED('B01')
   SELE 0
   USE B01 INDE B01
ELSE
   SELE B01
ENDIF
SET ORDER TO 1   
IF !USED('B11')
   SELE 0
   USE B11 
ELSE
   SELE B11
ENDIF
SET ORDER TO B111
IF !USED('E00')
    SELECT 0
    USE E00
ELSE
    SELECT E00
ENDIF
SET ORDER TO 1
IF !USED('E03')
    SELECT 0
    USE E03
ELSE
    SELECT E03
ENDIF
SET ORDER TO E031      
IF !USED('E05')
     SELECT 0
     USE E05
ELSE
     SELECT E05
ENDIF
SET ORDER TO E051          
IF !USED('E06')
     SELECT 0
     USE E06
ELSE
     SELECT E06
ENDIF
SET ORDER TO E061          
IF !USED('E07')
   SELE 0
   USE E07
ELSE
   SELE E07
ENDIF
SET ORDER TO E072      
E13='E13'+LEFT(DTOS(DATE()),6)   &&製程完工日報表
IF !USED('&E13')
   SELE 0
   USE (E13) ALIA E13
ELSE
   SELE E13
ENDIF
SET ORDER TO 1                 
E14='E14'+LEFT(DTOS(DATE()),6)   &&生產耗料日報表
IF !USED('&E14')
   SELE 0
   USE (E14) ALIA E14
ELSE
   SELE E14
ENDIF
SET ORDER TO 2               
IF !USED('E11')
     SELECT 0
     USE E11
ELSE
    SELECT E11
ENDIF
SET ORDER TO E111         
IF !USED('E16')
    SELECT 0
    USE E16
ELSE
   SELECT E16
ENDIF
SET ORDER TO E169       
B55='B55'+LEFT(DTOS(DATE()),6)
B551='B551'+LEFT(DTOS(DATE()),6)
IF !USED('&B55')
   SELE 0
   USE (B55) ALIA B55
ELSE
   SELE B55
ENDIF
SET ORDER TO 1      
SET RELA TO F08 INTO B01
CREATE CURSOR B55_1;
(F01 C(10),F02 C(2),F07 C(5),F13 C(1),F04 C(5),F06 C(17),F90 C(90))
INDE ON F01 TAG B55_11
INDE ON F07 TAG B55_12
INDE ON F04 TAG B55_13
SELE F01,F02,F07,F13,F04,F06,F90 FROM B55 GROUP BY F01 ORDER BY F01 INTO CURSOR B55_2
SELE B55_2
GO TOP
DO WHILE !EOF()
   SELE B55_1
   APPEND BLANK
   REPL F01 WITH B55_2.F01
   REPL F02 WITH B55_2.F02
   REPL F07 WITH B55_2.F07
   REPL F13 WITH B55_2.F13 
   REPL F04 WITH B55_2.F04
   REPL F06 WITH B55_2.F06
   REPL F90 WITH B55_2.F90
   SELE B55_2
   SKIP   
ENDDO
SELE B55_2
USE   
SELE B55_1
SET ORDER TO 1
SET RELA TO F04 INTO A14 
SET RELA TO F07 INTO A14_1 ADDI
B55form=createobject("tkB55")
B55form.show  
define class tkB55 as form
  caption='B55.完工入庫單'
*!*	  autocenter=.t.
  controlbox=.F.
  BORDERSTYLE=1  
  MAXBUTTON=.F.
  MINBUTTON=.F.
  MOVABLE=.F.
  CLOSABLE=.F.
  controlcount=57
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*550
  showtips=.t.
  showwindow=1
  WIDTH=INT_015*789
  windowtype=1
  NAME='TKB55'
  add object shape1 as shape1 with;
      autocenter=.t.
  ADD OBJECT LBL_REC AS LBL_REC WITH;
      AUTOCENTER =.T.
  ADD OBJECT REC_COUNT AS REC_COUNT  with;
      caption=str(reccount())        
  add object shape2 as shape2 with;
      autocenter=.t.
  add object shape3 as shape3 with;
      autocenter=.t.
  ADD OBJECT PAGEFRAME1 AS PAGEFRAME WITH;
      LEFT=INT_015*236,;
      WIDTH=INT_015*540,;
      HEIGHT=INT_015*200,;
      FONTSIZE=INT_015*9,;
      PAGECOUNT=2,;
      TABSTRETCH=1,;
      ACTIVEPAGE=1,;
      VISIBLE=.T.,;
      PAGE1.NAME='PAGE1',;
      PAGE1.VISIBLE=.T.,;
      PAGE1.CAPTION='表頭資料',;
      PAGE2.NAME='PAGE2',;
      PAGE2.VISIBLE=.T.,;
      PAGE2.CAPTION='表身詳細資料內容'   
  ADD OBJECT KEY_LIST AS KEY_LIST WITH;
      autocenter=.t.,;
      WIDTH=INT_015*130
  ADD OBJECT MTH_LIST AS MTH_LIST WITH;
      autocenter=.t.
  ADD OBJECT grid1 AS grid1 WITH;
      columncount=5,;            
      RECORDSOURCE='B55_1',;      
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;      
      COLUMN3.NAME='COLUMN3',;      
      COLUMN4.NAME='COLUMN4',;
      COLUMN5.NAME='COLUMN5'      
  ADD OBJECT grid2 AS grid2 WITH;
      columncount=6,;            
      RECORDSOURCE='B55',; 
      LINKMASTER='B55_1',;
      RELATIONALEXPR='F01',;
      childorder=B551,;  
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;
      COLUMN3.NAME='COLUMN3',;
      COLUMN4.NAME='COLUMN4',;
      COLUMN5.NAME='COLUMN5',;
      COLUMN6.NAME='COLUMN6'
  ADD OBJECT CMDGROUP AS CMDGROUP WITH;
      AUTOSIZE=.T.              
  ADD OBJECT ORPGROUP AS ORPGROUP WITH;    
      AUTOSIZE=.T.              
  ADD OBJECT SHRGROUP AS SHRGROUP WITH;
      TOP=INT_015*173,;
      LEFT=INT_015*558          
  ADD OBJECT ANS_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*490,;
      LEFT=INT_015*15,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*40,;      
      FONTSIZE=INT_015*9,;
      CAPTION='\<A.過帳',;
      NAME='ANS_BOTT'                  
  ADD OBJECT VRT_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*490,;
      LEFT=INT_015*57,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*50,;      
      FONTSIZE=INT_015*9,;
      TOOLTIPTEXT='將已過入庫存及帳款之資料轉回未過帳狀態!快速鍵->ALT+V',;      
      CAPTION='\<V.反過帳',;
      NAME='VRT_BOTT'                   
  PROCEDURE PAGEFRAME1.PAGE1.INIT     
     THIS.ADDOBJECT('LBLF01','LABEL')
     WITH THIS.LBLF01
          .VISIBLE=.T.
          .LEFT=INT_015*14
          .TOP=INT_015*13
          .WIDTH=INT_015*50
          .CAPTION='收料單號'          
     ENDWITH
     THIS.ADDOBJECT('LBLF07','LABEL')     
     WITH THIS.LBLF07
          .VISIBLE=.T.
          .LEFT=INT_015*14
          .TOP=INT_015*63
          .WIDTH=INT_015*50  
          .CAPTION='完工部門'
     ENDWITH            
     THIS.ADDOBJECT('LBLF071','LABEL')     
     WITH THIS.LBLF071
          .VISIBLE=.T.
          .LEFT=INT_015*115
          .TOP=INT_015*63
          .AUTOSIZE=.T.
     ENDWITH                 
     THIS.ADDOBJECT('LBLF04','LABEL')
     WITH THIS.LBLF04
         .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*88
         .WIDTH=INT_015*50
         .CAPTION='收料部門'
     ENDWITH    
     THIS.ADDOBJECT('LBLF041','LABEL')
     WITH THIS.LBLF041
         .VISIBLE=.T.
         .LEFT=INT_015*115
         .TOP=INT_015*88
         .AUTOSIZE=.T. 
     ENDWITH    
     THIS.ADDOBJECT('LBLF02','LABEL')
     WITH THIS.LBLF02
         .VISIBLE=.T.
         .LEFT=INT_015*368
         .TOP=INT_015*13
         .WIDTH=INT_015*50
         .CAPTION='收料日期'
     ENDWITH    
     THIS.ADDOBJECT('LBLF13','LABEL')
     WITH THIS.LBLF13
         .VISIBLE=.T.
         .LEFT=INT_015*368
         .TOP=INT_015*38
         .WIDTH=INT_015*50
         .CAPTION='過  帳  碼'
     ENDWITH    
     THIS.ADDOBJECT('LBLF131','LABEL')
     WITH THIS.LBLF131
         .VISIBLE=.T.
         .LEFT=INT_015*419
         .TOP=INT_015*38
         .AUTOSIZE=.T.
     ENDWITH    
     THIS.ADDOBJECT('LBLF06','LABEL')
     WITH THIS.LBLF06
         .VISIBLE=.T.
         .LEFT=INT_015*368
         .TOP=INT_015*63
         .WIDTH=INT_015*50
         .CAPTION='安全資料'
     ENDWITH    
     THIS.ADDOBJECT('LBLF061','LABEL')
     WITH THIS.LBLF061
         .VISIBLE=.T.
         .LEFT=INT_015*419
         .TOP=INT_015*63
         .AUTOSIZE=.T.
     ENDWITH    
     THIS.ADDOBJECT('LBLF90','LABEL')
     WITH THIS.LBLF90
         .VISIBLE=.T.
         .LEFT=INT_015*368
         .TOP=INT_015*88
         .WIDTH=INT_015*50
         .CAPTION='確認人員'
     ENDWITH    
     THIS.ADDOBJECT('LBLF901','LABEL')
     WITH THIS.LBLF901
         .VISIBLE=.T.
         .LEFT=INT_015*419
         .TOP=INT_015*88
         .AUTOSIZE=.T.
     ENDWITH         
     THIS.ADDOBJECT('TXTF01','TEXTBOX')          
     WITH THIS.TXTF01
          .VISIBLE=.T.
          .LEFT=INT_015*64
          .TOP=INT_015*9
          .WIDTH=INT_015*81
          .HEIGHT=INT_015*25
          .MAXLENGTH=10
     ENDWITH        
     THIS.ADDOBJECT('TXTF07','TXTF07')          
     WITH THIS.TXTF07
          .VISIBLE=.T.
          .LEFT=INT_015*64
          .TOP=INT_015*59
          .WIDTH=INT_015*49
          .HEIGHT=INT_015*25
          .MAXLENGTH=5
     ENDWITH        
     THIS.ADDOBJECT('TXTF04','TXTF04')          
     WITH THIS.TXTF04
          .VISIBLE=.T.
          .LEFT=INT_015*64
          .TOP=INT_015*84
          .WIDTH=INT_015*49
          .HEIGHT=INT_015*25
          .MAXLENGTH=5
     ENDWITH                               
     THIS.ADDOBJECT('TXTF02','TEXTBOX')          
     WITH THIS.TXTF02
          .VISIBLE=.T.
          .LEFT=INT_015*418
          .TOP=INT_015*9
          .WIDTH=INT_015*40
          .HEIGHT=INT_015*25
          .MAXLENGTH=2
     ENDWITH        
  ENDPROC   
  PROCEDURE PAGEFRAME1.PAGE2.INIT
	THIS.ADDOBJECT('LBLF08','LABEL')
	WITH THIS.LBLF08  
	     .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*9
	     .WIDTH=INT_015*50
         .CAPTION='完成品號'
        ENDWITH  
    THIS.ADDOBJECT('LBLF081','LABEL')
    WITH THIS.LBLF081
         .VISIBLE=.T.
         .LEFT=INT_015*327
	     .TOP=INT_015*9
	     .autosize=.t.
	ENDWITH    
	THIS.ADDOBJECT('LBLF11','LABEL')
	WITH THIS.LBLF11  
	     .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*34
	     .WIDTH=INT_015*50
         .CAPTION='版       次'
        ENDWITH  
    THIS.ADDOBJECT('LBLF111','LABEL')
    WITH THIS.LBLF111
         .VISIBLE=.T.
         .LEFT=INT_015*65
	     .TOP=INT_015*34
	     .autosize=.t.
	ENDWITH    	
    THIS.ADDOBJECT('LBLF05','Label')
    WITH THIS.LBLF05
         .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*59
         .WIDTH=INT_015*50
         .CAPTION='製令號碼'         
    ENDWITH   	 	
    THIS.ADDOBJECT('LBLF09','Label')
    WITH THIS.LBLF09
         .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*84
         .WIDTH=INT_015*50
         .CAPTION='完工類別'         
    ENDWITH   	 
    THIS.ADDOBJECT('LBLF091','Label')
    WITH THIS.LBLF091
         .VISIBLE=.T.
         .LEFT=INT_015*65
         .TOP=INT_015*84
         .AUTOSIZE=.T.
         .CAPTION=''         
    ENDWITH   	     
    THIS.ADDOBJECT('LBLF12','Label')
    WITH THIS.LBLF12
         .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*109
         .WIDTH=INT_015*50
         .CAPTION='入庫數量'         
    ENDWITH     
    THIS.ADDOBJECT('LBLF10','Label')
    WITH THIS.LBLF10
         .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*134
         .AUTOSIZE=.T.
         .CAPTION='製作時間                    '+IIF(INT_030='1','秒',IIF(INT_030='2','分' ,'時'))
    ENDWITH       
    THIS.ADDOBJECT('LBLF06','LABEL')
    WITH THIS.LBLF06
        .VISIBLE=.T.           
        .LEFT=INT_015*328
        .TOP=INT_015*143
        .WIDTH=INT_015*50
        .CAPTION='安全資料'         
    ENDWITH    
    THIS.ADDOBJECT('LBLF061','LABEL')
    WITH THIS.LBLF061
        .VISIBLE=.T.           
        .LEFT=INT_015*380
        .TOP=INT_015*143
        .AUTOSIZE=.T.
    ENDWITH    
	THIS.ADDOBJECT('TXTF08','TXTF08')
	WITH THIS.TXTF08      
	     .VISIBLE=.T.
	     .LEFT=INT_015*65
	     .TOP=INT_015*5
	     .WIDTH=INT_015*261
	     .HEIGHT=INT_015*25
	     .MAXLENGTH=43
	     .NAME='TXTF08'  
	ENDWITH  
	THIS.ADDOBJECT('TXTF05','TXTF05')
	WITH THIS.TXTF05      
	     .VISIBLE=.T.
	     .LEFT=INT_015*65
	     .TOP=INT_015*55
	     .WIDTH=INT_015*90
	     .HEIGHT=INT_015*25
	     .MAXLENGTH=12
	     .NAME='TXTF05'  
	ENDWITH  	
	THIS.ADDOBJECT('TXTF12','TEXTBOX')
	WITH THIS.TXTF12
	     .VISIBLE=.T.
	     .LEFT=INT_015*65
	     .TOP=INT_015*105
	     .WIDTH=INT_015*100
	     .HEIGHT=INT_015*25
	     .INPUTMASK='99999999.99'
	     .NAME='TXTF12'	    
	ENDWITH   
	THIS.ADDOBJECT('TXTF10','TEXTBOX')
	WITH THIS.TXTF10      
	     .VISIBLE=.T.
	     .LEFT=INT_015*65
	     .TOP=INT_015*130
	     .WIDTH=INT_015*50
	     .HEIGHT=INT_015*25
	     .INPUTMASK='99999'
	     .NAME='TXTF10'  
	ENDWITH  	  
  ENDPROC       
  PROCEDURE PAGEFRAME1.PAGE1.activate
     R=0
          SELE B55_1    
     IF THISFORM.SHRGROUP.VISIBLE=.F.
        THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(B55_1.F13<>'2',RGB(255,0,0),'')","COLUMN")         
        THISFORM.GRID1.ENABLED=.T.   
        THISFORM.GRID1.SETFOCUS 
        THISFORM.KEY_LIST.ENABLED=.T.
        THISFORM.MTH_LIST.ENABLED=.T.
     ELSE
       THISFORM.KEY_LIST.ENABLED=.F.   
       THISFORM.MTH_LIST.ENABLED=.F.   
     ENDIF           
    IF THISFORM.GRID1.ACTIVEROW=0 .AND. thisform.SHRGROUP.ENABLED=.F.
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
        THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
        THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
        THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
        THISFORM.ANS_BOTT.ENABLED=.F.
        THISFORM.VRT_BOTT.ENABLED=.F.        
        THISFORM.PAGEFRAME1.PAGE1.SETALL('VALUE','','TEXTBOX')        
        THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=''
        THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE=''
        THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE=''
        THISFORM.PAGEFRAME1.PAGE1.TXTF04.VALUE=''
*        THISFORM.PAGEFRAME1.PAGE1.TXTF08.VALUE=''        
        THISFORM.PAGEFRAME1.PAGE1.LBLF071.CAPTION=''
        THISFORM.PAGEFRAME1.PAGE1.LBLF041.CAPTION=''
        THISFORM.PAGEFRAME1.PAGE1.LBLF131.CAPTION=''
        THISFORM.PAGEFRAME1.PAGE1.LBLF061.CAPTION=''        
        THISFORM.PAGEFRAME1.PAGE1.LBLF901.CAPTION=''                     
        THISFORM.PAGEFRAME1.PAGE2.ENABLED=.F.      
     ELSE
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.
        THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  .AND. B55_1.F13<>'2' &&判斷有無修改的權限
        THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)   .AND. B55_1.F13<>'2' &&判斷有無刪除的權限
        THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)    &&判斷有無列印的權限  
        THISFORM.ANS_BOTT.ENABLED=IIF(B55_1.F13='2',.F.,.T.) .AND. IIF(A02.F11='*',.T.,.F.) .AND. !THISFORM.SHRGROUP.ENABLED .AND. !IIF(SEEK(DTOS(CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/01')),'A23','A231'),A23.F07,.F.)              
        THISFORM.VRT_BOTT.ENABLED=IIF(EMPTY(B55_1.F13),.F.,.T.) .AND. IIF(A02.F12='*',.T.,.F.) .AND. !THISFORM.SHRGROUP.ENABLED .AND. !IIF(SEEK(DTOS(CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/01')),'A23','A231'),A23.F07,.F.)              
        THISFORM.PAGEFRAME1.PAGE2.ENABLED=.T.
     ENDIF   
     THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.);
     .AND. !IIF(SEEK(DTOS(CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/01')),'A23','A231'),A23.F07,.F.)
  ENDPROC
  PROCEDURE PAGEFRAME1.PAGE2.activate
       SELE B55   
     IF THISFORM.SHRGROUP.ENABLED=.F.
        THISFORM.GRID2.READONLY=.T.       
        THISFORM.GRID2.SETFOCUS   
     ENDIF 
     IF THISFORM.GRID2.ACTIVEROW=0 .and. thisform.SHRGROUP.ENABLED=.F.
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
        THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
        THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
        THISFORM.ANS_BOTT.ENABLED=.F.
        THISFORM.VRT_BOTT.ENABLED=.F.        
        THISFORM.PAGEFRAME1.PAGE2.SETALL('VALUE','','TEXTBOX')
        THISFORM.PAGEFRAME1.PAGE2.TXTF08.VALUE=''
        THISFORM.PAGEFRAME1.PAGE2.LBLF081.CAPTION=''
     ELSE
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.
        THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.) .AND. B55.F13<>'2'  &&判斷有無修改的權限
        THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)  .AND. B55.F13<>'2' &&判斷有無刪除的權限
        THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)  &&&&判斷有無列印的權限  
        THISFORM.ANS_BOTT.ENABLED=IIF(B55.F13='2',.F.,.T.) .AND. IIF(A02.F11='*',.T.,.F.) .AND. !THISFORM.SHRGROUP.ENABLED .AND. !IIF(SEEK(DTOS(CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/01')),'A23','A231'),A23.F07,.F.)                      
        THISFORM.VRT_BOTT.ENABLED=IIF(EMPTY(B55_1.F13),.F.,.T.) .AND. IIF(A02.F12='*',.T.,.F.) .AND. !THISFORM.SHRGROUP.ENABLED .AND. !IIF(SEEK(DTOS(CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/01')),'A23','A231'),A23.F07,.F.)                      
     ENDIF   
     R=RECNO('&AREA1')
     THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(RECNO('&AREA1')=R,RGB(255,255,0),'')","COLUMN")
     THISFORM.GRID1.ENABLED=.F.     
     THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.)   .AND. B55_1.F13<>'2' &&判斷有無新增的權限
     THISFORM.KEY_LIST.ENABLED=.F.     
     THISFORM.MTH_LIST.ENABLED=.F.     
  ENDPROC     
  PROC INIT       
       thisform.setall('height',INT_015*25,'textbox')
       thisform.setall('height',INT_015*17,'label')     
       thisform.setall('FONTSIZE',INT_015*9,'textbox')
       thisform.setall('FONTSIZE',INT_015*9,'label')         
       THISFORM.SETALL('READONLY',.T.,'TEXTBOX')
       THISFORM.SHRGROUP.VISIBLE=.F.
       THISFORM.SHRGROUP.ENABLED=.F.
       thisform.GRID1.setall('FONTSIZE',INT_015*9,'COLUMN')
       thisform.GRID1.setall('FONTSIZE',INT_015*9,'HEADER')         
       THISFORM.GRID1.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)
       THISFORM.GRID2.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)
       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='完工單號'
       THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='完工部門編號'
       THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='完工部門簡稱'
       THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='收料部門編號'
       THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='收料部門簡稱'
       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='B55_1.F01'
       THISFORM.GRID1.COLUMN2.CONTROLSOURCE='B55_1.F07'
       THISFORM.GRID1.COLUMN3.CONTROLSOURCE='A14.F02'
       THISFORM.GRID1.COLUMN4.CONTROLSOURCE='B55_1.F04'
       THISFORM.GRID1.COLUMN5.CONTROLSOURCE='A14_1.F02'
       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*81
       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*49
       THISFORM.GRID1.COLUMN3.WIDTH=INT_015*80
       THISFORM.GRID1.COLUMN4.WIDTH=INT_015*49
       THISFORM.GRID1.COLUMN5.WIDTH=INT_015*80
       THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(B55_1.F13<>'2',RGB(255,0,0),'')","COLUMN")         
       thisform.GRID2.setall('FONTSIZE',INT_015*9,'COLUMN')
       thisform.GRID2.setall('FONTSIZE',INT_015*9,'HEADER')       
       THISFORM.grid2.COLUMN1.HEADER1.CAPTION='完成品號'       
       THISFORM.grid2.COLUMN2.HEADER1.CAPTION='品名規格'
       THISFORM.grid2.COLUMN3.HEADER1.CAPTION='製令號碼'       
       THISFORM.grid2.COLUMN4.HEADER1.CAPTION='類別'
       THISFORM.grid2.COLUMN5.HEADER1.CAPTION='入庫數量'
       THISFORM.grid2.COLUMN6.HEADER1.CAPTION='製作時間(分)'
	   THISFORM.GRID2.LINKMASTER='B55_1'
       THISFORM.GRID2.RELATIONALEXPR='F01'
	   THISFORM.grid2.COLUMN1.CONTROLSOURCE='B55.F08'
	   THISFORM.grid2.COLUMN2.CONTROLSOURCE='B01.F02'
	   THISFORM.grid2.COLUMN3.CONTROLSOURCE='B55.F05'	   
	   THISFORM.grid2.COLUMN4.CONTROLSOURCE="IIF(B55.F09='1','正常',' 重工')"
	   THISFORM.grid2.COLUMN5.CONTROLSOURCE='B55.F12'
	   THISFORM.grid2.COLUMN6.CONTROLSOURCE='B55.F10'
	   THISFORM.grid2.COLUMN1.WIDTH=INT_015*149
	   THISFORM.GRID2.COLUMN2.WIDTH=INT_015*149
           THISFORM.GRID2.COLUMN3.WIDTH=INT_015*80	   
	   THISFORM.grid2.COLUMN4.WIDTH=INT_015*25
       THISFORM.grid2.COLUMN5.WIDTH=INT_015*70
       THISFORM.grid2.COLUMN6.WIDTH=INT_015*75
       THISFORM.grid1.READONLY=.T.      
       THISFORM.grid2.READONLY=.T.            
       THISFORM.grid1.SETFOCUS
       IF THISFORM.GRID1.ACTIVEROW=0
          THISFORM.CMDGROUP.ENABLED=.F.
          THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
          THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
          THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
          THISFORM.ANS_BOTT.ENABLED=.F.
          THISFORM.VRT_BOTT.ENABLED=.F.
       ELSE
          THISFORM.CMDGROUP.ENABLED=.T.      
          THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.) .AND. B55_1.F13<>'2'  &&判斷有無修改的權限
          THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)  .AND. B55_1.F13<>'2' &&判斷有無刪除的權限
          THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限       
          THISFORM.ANS_BOTT.ENABLED=IIF(B55_1.F13='2',.F.,.T.)  .AND. IIF(A02.F11='*',.T.,.F.) .AND. !THISFORM.SHRGROUP.ENABLED
          THISFORM.VRT_BOTT.ENABLED=IIF(EMPTY(B55_1.F13),.F.,.T.) .AND. IIF(A02.F12='*',.T.,.F.) .AND. !THISFORM.SHRGROUP.ENABLED .AND. !IIF(SEEK(DTOS(CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/01')),'A23','A231'),A23.F07,.F.)                                
       ENDIF          
*       THISFORM.KEY_LIST.DISPLAYVALUE='依移轉單號排列'      
       JK='收料單號'
       SELE B55_1
       THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=B55_1.F01
  ENDPROC               
  PROC KEY_LIST.INIT 
       with this 
           .additem('依完工單號排列')
           .additem('依完工部門排列')
           .additem('依收料部門排列')
           .VALUE=1
       endwith             
  ENDPROC 
  PROC KEY_LIST.INTERACTIVECHANGE                 
       SELE B55_1 
       DO CASE
          CASE THIS.DISPLAYVALUE='依收料單號排列'
               set order to 1 
               THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='收料單號'
               THISFORM.GRID1.COLUMN1.CONTROLSOURCE='B55_1.F01'
               THISFORM.GRID1.COLUMN1.WIDTH=INT_015*81
               THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='完工部門編號'
               THISFORM.GRID1.COLUMN2.CONTROLSOURCE='B55_1.F07'
               THISFORM.GRID1.COLUMN2.WIDTH=INT_015*49
               THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='完工部門簡稱'
               THISFORM.GRID1.COLUMN3.CONTROLSOURCE='A14.F02'
               THISFORM.GRID1.COLUMN3.WIDTH=INT_015*80
               THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='收料部門編號'
               THISFORM.GRID1.COLUMN4.CONTROLSOURCE='B55_1.F04'
               THISFORM.GRID1.COLUMN4.WIDTH=INT_015*49               
               THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='收料部門簡稱'
               THISFORM.GRID1.COLUMN5.CONTROLSOURCE='A14_1.F02'
               THISFORM.GRID1.COLUMN5.WIDTH=INT_015*80                                
          CASE THIS.DISPLAYVALUE='依完工部門排列'
               set order to 2
               THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='完工部門編號'
               THISFORM.GRID1.COLUMN1.CONTROLSOURCE='B55_1.F07'
               THISFORM.GRID1.COLUMN1.WIDTH=INT_015*49
               THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='完工部門簡稱'
               THISFORM.GRID1.COLUMN2.CONTROLSOURCE='A14.F02'
               THISFORM.GRID1.COLUMN2.WIDTH=INT_015*80
               THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='收料單號'
               THISFORM.GRID1.COLUMN3.CONTROLSOURCE='B55_1.F01'
               THISFORM.GRID1.COLUMN3.WIDTH=INT_015*81                                                   
               THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='完工部門編號'
               THISFORM.GRID1.COLUMN4.CONTROLSOURCE='B55_1.F04'
               THISFORM.GRID1.COLUMN4.WIDTH=INT_015*49  
               THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='完工部門簡稱'
               THISFORM.GRID1.COLUMN5.CONTROLSOURCE='A14_1.F02'
               THISFORM.GRID1.COLUMN5.WIDTH=INT_015*58                 
          CASE THIS.DISPLAYVALUE='依收料部門排列'
               set order to 3
               THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='收料部門編號'
               THISFORM.GRID1.COLUMN1.CONTROLSOURCE='B55_1.F04'
               THISFORM.GRID1.COLUMN1.WIDTH=INT_015*49
               THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='收料部門簡稱'
               THISFORM.GRID1.COLUMN2.CONTROLSOURCE='A14_1.F02'
               THISFORM.GRID1.COLUMN2.WIDTH=INT_015*80
               THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='收料單號'
               THISFORM.GRID1.COLUMN3.CONTROLSOURCE='B55_1.F01'
               THISFORM.GRID1.COLUMN3.WIDTH=INT_015*81               
               THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='完工部門編號'
               THISFORM.GRID1.COLUMN4.CONTROLSOURCE='B55_1.F07'
               THISFORM.GRID1.COLUMN4.WIDTH=INT_015*49                  
               THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='完工部門簡稱'
               THISFORM.GRID1.COLUMN5.CONTROLSOURCE='A14.F02'
               THISFORM.GRID1.COLUMN5.WIDTH=INT_015*80                                                            
       ENDCASE 
        THISFORM.grid1.SETFOCUS
  ENDPROC      
  PROC MTH_LIST.INTERACTIVECHANGE
       THISFORM.GRID1.RECORDSOURCE=''
       THISFORM.GRID2.RECORDSOURCE=''
       THISFORM.GRID2.LINKMASTER=''
       THISFORM.GRID2.RELATIONALEXPR=''
       THISFORM.GRID2.childorder=''
       SELE A24
       USE
       SELECT A23
       SEEK DTOS(CTOD(THIS.DISPLAYVALUE+'/01'))
       A24='A24'+LEFT(DTOS(CTOD(THIS.DISPLAYVALUE+'/01')),6)
       IF !USED('&A24')
          SELE 0
          USE (A24) ALIA A24
       ELSE
          SELE A24
       ENDIF
       SET ORDER TO 1             
       SELE B25
       USE
       B25='B25'+LEFT(DTOS(CTOD(THIS.DISPLAYVALUE+'/01')),6)
       IF !USED('&B25')
          SELE 0
          USE (B25) ALIA B25
       ELSE
          SELE B25
       ENDIF
       SET ORDER TO 1                    
       SELE B26
       USE
       B26='B26'+LEFT(DTOS(CTOD(THIS.DISPLAYVALUE+'/01')),6)
       IF !USED('&B26')
          SELE 0
          USE (B26) ALIA B26
       ELSE
          SELE B26
       ENDIF
       SET ORDER TO 1                           
       SELE B39
       USE
       B39='B39'+LEFT(DTOS(CTOD(THIS.DISPLAYVALUE+'/01')),6)
       IF !USED('&B39')
          SELE 0
          USE (B39) ALIA B39
       ELSE
          SELE B39
       ENDIF
       SET ORDER TO 1                                  
       SELECT E13
       USE
       E13='E13'+LEFT(DTOS(CTOD(THIS.DISPLAYVALUE+'/01')),6)
       IF !USED('&E13')
          SELE 0
          USE (E13) ALIA E13
       ELSE
          SELE E13
       ENDIF
       SET ORDER TO 1              
       SELECT E14 
       USE 
       E14='E14'+LEFT(DTOS(CTOD(THIS.DISPLAYVALUE+'/01')),6)
       IF !USED('&E14')
          SELE 0
          USE (E14) ALIA E14
       ELSE
          SELE E14
       ENDIF
       SET ORDER TO 2                            
       SELE B55
       set rela off into b01
       SET RELA OFF INTO B55_1
       USE
       SELE B55_1
       SET RELA OFF INTO A14
       SET RELA OFF INTO A14_1
       USE       
       B55='B55'+LEFT(DTOS(CTOD(THIS.DISPLAYVALUE+'/01')),6)
       B551='B551'+LEFT(DTOS(CTOD(THIS.DISPLAYVALUE+'/01')),6)
       IF !USED('&B55')
          SELE 0
          USE (B55) ALIA B55
       ELSE
          SELE B55
       ENDIF
       SET ORDER TO 1      
       SET RELA TO F08 INTO B01
       CREATE CURSOR B55_1;
       (F01 C(10),F02 C(2),F07 C(5),F13 C(1),F04 C(5),F06 C(17),F90 C(17))
       INDE ON F01 TAG B55_11
       INDE ON F07 TAG B55_12
       INDE ON F04 TAG B55_13
       SELE F01,F02,F07,F13,F04,F06,F90 FROM B55 GROUP BY F01 ORDER BY F01 INTO CURSOR B55_2
       SELE B55_2
       GO TOP
       DO WHILE !EOF()
          SELE B55_1
          APPEND BLANK
          REPL F01 WITH B55_2.F01
          REPL F02 WITH B55_2.F02
          REPL F07 WITH B55_2.F07         
          REPL F13 WITH B55_2.F13
          REPL F04 WITH B55_2.F04
          REPL F06 WITH B55_2.F06
          REPL F90 WITH B55_2.F90
          SELE B55_2
          SKIP
       ENDDO
       SELE B55_2
       USE   
       SELE B55_1
       SET ORDER TO 1
       SET RELA TO F04 INTO A14 
       SET RELA TO F07 INTO A14_1 ADDI
       THISFORM.GRID1.RECORDSOURCE='B55_1'
       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='B55_1.F01'
       THISFORM.GRID1.COLUMN2.CONTROLSOURCE='B55_1.F07'       
       THISFORM.GRID1.COLUMN3.CONTROLSOURCE='A14.F02' 
       THISFORM.GRID1.COLUMN4.CONTROLSOURCE='B55_1.F04'              
       THISFORM.GRID1.COLUMN5.CONTROLSOURCE='A14_1.F02'     
       THISFORM.GRID2.RECORDSOURCE='B55'
	   THISFORM.GRID2.LINKMASTER='B55_1'
       THISFORM.GRID2.RELATIONALEXPR='F01'      
       THISFORM.GRID2.CHILDORDER=B551  
	   THISFORM.grid2.COLUMN1.CONTROLSOURCE='B55.F08'
	   THISFORM.grid2.COLUMN2.CONTROLSOURCE='B01.F02'
	   THISFORM.grid2.COLUMN3.CONTROLSOURCE='B55.F05'            	   
	   THISFORM.grid2.COLUMN4.CONTROLSOURCE="IIF(B55.F09='1','正常','重工')"
	   THISFORM.grid2.COLUMN5.CONTROLSOURCE='B55.F12'
	   THISFORM.grid2.COLUMN6.CONTROLSOURCE='B55.F10'
       THISFORM.KEY_LIST.INTERACTIVECHANGE
	   THISFORM.PAGEFRAME1.ACTIVEPAGE=1
	   THISFORM.REFRESH
	   thisform.grid1.setfocus        
       IF THISFORM.GRID1.ACTIVEROW=0
          THISFORM.CMDGROUP.ENABLED=.F.
          THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
          THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
          THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
          THISFORM.ANS_BOTT.ENABLED=.F.
       ELSE
          THISFORM.CMDGROUP.ENABLED=.T.      
          THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.) .AND. B55_1.F13<>'2'  &&判斷有無修改的權限
          THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)  .AND. B55_1.F13<>'2' &&判斷有無刪除的權限
          THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限    
          THISFORM.ANS_BOTT.ENABLED=IIF(B55_1.F13='2',.F.,.T.)  .AND. IIF(A02.F11='*',.T.,.F.) .AND. !THISFORM.SHRGROUP.ENABLED               
       ENDIF          
*!*	       THISFORM.KEY_LIST.DISPLAYVALUE='依出貨單號排列'      
*!*	       JK='訂單編號'
*!*	       SELE B55_1
*!*	       THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=B55_1.F01	   
*       THISFORM.REFRESH       
  ENDPROC
  PROC grid1.AFTERROWCOLCHANGE
       LPARAMETERS nColIndex
       THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=B55_1.F01
*!*	       THISFORM.PAGEFRAME1.PAGE1.TXTF08.VALUE=B55_1.F08
       THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE=B55_1.F07
       THISFORM.PAGEFRAME1.PAGE1.LBLF071.CAPTION=A14_1.F02
       THISFORM.PAGEFRAME1.PAGE1.TXTF04.VALUE=B55_1.F04
       THISFORM.PAGEFRAME1.PAGE1.LBLF041.CAPTION=A14.F02
       THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE=B55_1.F02
       THISFORM.PAGEFRAME1.PAGE1.lblF131.caption=B55_1.F13
       THISFORM.PAGEFRAME1.PAGE1.lblF061.caption=B55_1.F06
       THISFORM.PAGEFRAME1.PAGE1.lblF901.caption=B55_1.F90
       THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.) .AND. B55_1.F13<>'2'  &&判斷有無修改的權限
       THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)  .AND. B55_1.F13<>'2' &&判斷有無刪除的權限
       THISFORM.ANS_BOTT.ENABLED=IIF(B55_1.F13='2',.F.,.T.) .AND. IIF(A02.F11='*',.T.,.F.) .AND. !THISFORM.SHRGROUP.ENABLED        
       THISFORM.VRT_BOTT.ENABLED=IIF(B55_1.F13='2',.T.,.F.) .AND. IIF(A02.F12='*',.T.,.F.) .AND. !THISFORM.SHRGROUP.ENABLED               
       FCH=THISFORM.ACTIVECONTROL.NAME
       JK=THIS.COLUMN1.HEADER1.CAPTION  
       IF THIS.ACTIVEROW=0
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
       ELSE
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.
       ENDIF   
       CHK=''     
*       thisform.refresh
  ENDPROC     
  PROC grid2.AFTERROWCOLCHANGE
       LPARAMETERS nColIndex
       THISFORM.PAGEFRAME1.PAGE2.TXTF08.VALUE=B55.F08
       THISFORM.PAGEFRAME1.PAGE2.LBLF081.CAPTION=B01.F02
       THISFORM.PAGEFRAME1.PAGE2.LBLF091.CAPTION=IIF(B55.F09='2','重工','正常')
       THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE=B55.F05
       THISFORM.PAGEFRAME1.PAGE2.TXTF12.VALUE=B55.F12      
       THISFORM.PAGEFRAME1.PAGE2.TXTF10.VALUE=B55.F10  
       THISFORM.PAGEFRAME1.PAGE2.LBLF061.CAPTION=B55.F06
       THISFORM.PAGEFRAME1.PAGE2.LBLF111.CAPTION=B55.F11      
       FCH=THISFORM.ACTIVECONTROL.NAME
       JK=THIS.COLUMN1.HEADER1.CAPTION
       CHK=B55_1.F01
*       CHK=THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
       if thisform.pageframe1.activepage=1
          thisform.CMDGROUP.SEEK_BOTT.ENABLED=.F.
       ENDIF   
*       thisform.refresh
  ENDPROC 
  PROCEDURE ORPGROUP.NEW_BOTT.CLICK    
    THISFORM.KEY_LIST.ENABLED=.F. 
    THISFORM.MTH_LIST.ENABLED=.F. 
    THISFORM.ANS_BOTT.ENABLED=.F.
    IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1       
       THISFORM.GRID2.RECORDSOURCE=''
       THISFORM.GRID2.CHILDORDER=''
       THISFORM.PAGEFRAME1.PAGE1.SETALL('READONLY',.F.,'TEXTBOX')     &&處理表頭新增
       THISFORM.GRID1.ENABLED=.F.   
       THISFORM.GRID2.ENABLED=.F.   
          HD=HD1+SUBSTR(DTOS(CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/01')),3,4)
          DO ODR_CRT 
          THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=PO_NO
          THISFORM.PAGEFRAME1.PAGE1.TXTF01.REFRESH
          thisform.PAGEFRAME1.PAGE1.txtf01.readonly=.t.
          THISFORM.PAGEFRAME1.PAGE1.TXTF07.SETFOCUS
        THISFORM.PAGEFRAME1.PAGE2.ENABLED=.F.
        THISFORM.PAGEFRAME1.PAGE1.TXTF07.READONLY=.F.
        THISFORM.PAGEFRAME1.PAGE1.TXTF04.READONLY=.F.    
        THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE=''
*!*	        THISFORM.PAGEFRAME1.PAGE1.TXTF08.VALUE=''
        THISFORM.PAGEFRAME1.PAGE1.TXTF04.VALUE=''                
        THISFORM.PAGEFRAME1.PAGE1.LBLF071.CAPTION=''
        THISFORM.PAGEFRAME1.PAGE1.LBLF041.CAPTION=''        
        THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE=RIGHT(DTOS(DATE()),2)
        THISFORM.PAGEFRAME1.PAGE1.LBLF061.CAPTION=''
        THISFORM.PAGEFRAME1.PAGE1.LBLF131.CAPTION=''      
        THISFORM.PAGEFRAME1.PAGE1.lblF901.caption=''
     ELSE
        THISFORM.PAGEFRAME1.PAGE1.ENABLED=.F.              &&處理表身新增
        THISFORM.GRID2.ENABLED=.F.   
        THISFORM.PAGEFRAME1.PAGE2.SETALL('READONLY',.F.,'TEXTBOX')     
        THISFORM.PAGEFRAME1.PAGE2.TXTF08.READONLY=.F.
        THISFORM.PAGEFRAME1.PAGE2.TXTF08.SETFOCUS
        THISFORM.PAGEFRAME1.PAGE2.TXTF08.VALUE=''          
        THISFORM.PAGEFRAME1.PAGE2.lblF081.caption=''                  
        THISFORM.PAGEFRAME1.PAGE2.TXTF05.READONLY=.F.
        THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE=''
        THISFORM.PAGEFRAME1.PAGE2.TXTF12.VALUE=0
        THISFORM.PAGEFRAME1.PAGE2.LBLF061.CAPTION=''      
        THISFORM.PAGEFRAME1.PAGE2.LBLF111.CAPTION=''
        THISFORM.PAGEFRAME1.PAGE2.LBLF091.CAPTION=''
        THISFORM.PAGEFRAME1.PAGE2.TXTF10.VALUE=0
     ENDIF   

  ENDPROC  
  PROCEDURE ORPGROUP.EDIT_BOTT.CLICK
     THISFORM.KEY_LIST.ENABLED=.F. 
     THISFORM.MTH_LIST.ENABLED=.F. 
     THISFORM.ANS_BOTT.ENABLED=.F.
     THISFORM.GRID1.ENABLED=.F.   
     THISFORM.GRID2.ENABLED=.F.   
     IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
        PO_NO=B55_1.F01     
        SELE RECNO() FROM B55 WHERE B55.F01=PO_NO AND F13<>'2' INTO ARRAY BK1
        JJ1=''                
        IF _TALLY>0                   
           FOR I= 1 TO ALEN(BK1)
               JJ1=JJ1+ALLTRIM(STR(BK1(I)))+','
           ENDFOR  
           KK1=STUFF(JJ1,RAT(',',JJ1,1),1,'')
           RLOCK(KK1,'B55')
           LL1=RLOCK(KK1,'B55')
        ELSE 
           =MESSAGEBOX('此單據已由別的工作站過帳中無法修改!',0+64,'提示訊息視窗')
           SELE B55_1           
           UNLOCK ALL
           REPL F13 WITH '2'
           THISFORM.SHRGROUP.ABANDON_BOTT.CLICK   
        ENDIF   
        IF LL1 =.T.
           THISFORM.PAGEFRAME1.PAGE1.SETALL('READONLY',.F.,'TEXTBOX')     &&處理表頭修改
           THISFORM.PAGEFRAME1.PAGE1.TXTF01.READONLY=.T.
           THISFORM.PAGEFRAME1.PAGE1.TXTF04.READONLY=.F.
           THISFORM.PAGEFRAME1.PAGE2.ENABLED=.F.
           THISFORM.PAGEFRAME1.PAGE1.TXTF04.SETFOCUS
        ELSE 
           DO file_impact
           UNLOCK ALL
           THISFORM.SHRGROUP.ABANDON_BOTT.CLICK
        endif   
     ELSE                                     &&處理表身修改
              SELE RECNO() FROM E06 WHERE F01=THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE INTO ARRAY BK1
              JJ1=''                
              IF _TALLY>0                   
                  FOR I= 1 TO ALEN(BK1)
                          JJ1=JJ1+ALLTRIM(STR(BK1(I)))+','
                  ENDFOR  
                  KK1=STUFF(JJ1,RAT(',',JJ1,1),1,'')
                  RLOCK(KK1,'E06')
                  LL1=RLOCK(KK1,'E06')
              ELSE
                  LL1=.T.   
              ENDIF 
              SELECT RECNO() FROM E07 WHERE F01=THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE AND F08=THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE INTO ARRAY BK2
              JJ2=''
              IF _TALLY>0
                  FOR I=1 TO ALEN(BK2)
                           JJ2=JJ2+ALLTRIM(STR(BK2(I)))+','                         
                  ENDFOR
                  KK2=STUFF(JJ2,RAT(',',JJ2,1),1,'')
                  RLOCK(KK2,'E07')
                  LL2=RLOCK(KK2,'E07')
              ELSE
                  LL2=.T.
              ENDIF
              SELECT RECNO() FROM E03 WHERE F03=THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE INTO ARRAY BK3
              JJ3=''
              IF _TALLY>0
                  FOR I=1 TO ALEN(BK3)
                           JJ3=JJ3+ALLTRIM(STR(BK3(I)))+','             
                  ENDFOR
                  KK3=STUFF(JJ3,RAT(',',JJ3,1),1,'')
                  RLOCK(KK3,'E03')
                  LL3=RLOCK(KK3,'E03')
              ELSE
                  LL3=.T.
              ENDIF                                 
        SELE B55                                                     
        IF RLOCK('B55')  .AND. LL1 .AND. LL2 .AND. LL3 =.T.  
           THISFORM.PAGEFRAME1.PAGE2.SETALL('READONLY',.F.,'TEXTBOX') 
           THISFORM.PAGEFRAME1.PAGE2.TXTF12.SETFOCUS
        ELSE  
           DO file_impact 
           unlock all
           THISFORM.SHRGROUP.ABANDON_BOTT.CLICK           
       endif        
     ENDIF   
     RELEASE ALL LIKE BK*
  endproc    
  PROC ORPGROUP.DEL_BOTT.CLICK                    &&刪除資料程序
       IF messagebox('是否確定要刪除此筆資料',4+32+256,'請確認') = 6	        
          if ALIA()='B55_1'           &&刪除整張訂單             
             SELE B55_1             
                PO_NO=B55_1.F01
                SELE RECNO() FROM B55 WHERE B55.F01=PO_NO  AND B55.F13<>'2' INTO ARRAY BK1              
                JJ1=''                
                IF _TALLY>0   
                   FOR I= 1 TO ALEN(BK1)
                       JJ1=JJ1+ALLTRIM(STR(BK1(I)))+','
                   ENDFOR    
                   KK1=STUFF(JJ1,RAT(',',JJ1,1),1,'')              
                   RLOCK(KK1,'B55')
                   LL1=RLOCK(KK1,'B55')
                ELSE
                   LL1=.T.   
                ENDIF    
                SELE RECNO() FROM E06 WHERE F01= ANY (SELE F05 FROM B55 WHERE F01=PO_NO) INTO ARRAY BK2
                JJ2=''                
                IF _TALLY>0                   
                    FOR I= 1 TO ALEN(BK2)
                        JJ2=JJ2+ALLTRIM(STR(BK2(I)))+','
                    ENDFOR  
                    KK2=STUFF(JJ2,RAT(',',JJ2,1),1,'')
                    RLOCK(KK2,'E06')
                    LL2=RLOCK(KK2,'E06')
                ELSE
                   LL2=.T.   
                ENDIF   
                SELE RECNO() FROM E07 WHERE F01= ANY (SELE F05 FROM B55 WHERE F01=PO_NO) AND F08=THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE INTO ARRAY BK4
                JJ4=''                
                IF _TALLY>0                   
                    FOR I= 1 TO ALEN(BK4)
                        JJ4=JJ4+ALLTRIM(STR(BK4(I)))+','
                    ENDFOR  
                    KK4=STUFF(JJ4,RAT(',',JJ4,1),1,'')
                    RLOCK(KK4,'E07')
                    LL4=RLOCK(KK4,'E07')
                ELSE
                   LL4=.T.   
                ENDIF                   
                SELE RECNO() FROM E03 WHERE F03+F01=ANY (SELE F05+F08 FROM B55 WHERE F01=PO_NO) INTO ARRAY BK5
                JJ5=''                
                IF _TALLY>0   
                   FOR I= 1 TO ALEN(BK5)
                       JJ5=JJ5+ALLTRIM(STR(BK5(I)))+','
                   ENDFOR    
                   KK5=STUFF(JJ5,RAT(',',JJ5,1),1,'')              
                   RLOCK(KK5,'E03')
                   LL5=RLOCK(KK5,'E03')
                ELSE
                   LL5=.T.   
                ENDIF                                                          
                IF LL1 .AND.  LL2 .AND. LL4 .AND. LL5 =.T.
                     SELECT B55
                     FOR I= 1 TO ALEN(BK1)
                             GO BK1(I)
                               SELE E06                                             
                               SEEK B55.F05+B55.F08
                               IF FOUND()
                                   REPLACE F06 WITH F06+B55.F12*(-1)
                               ENDIF
                               SELECT E07
                               SEEK B55.F05                                  
                               IF FOUND()
                                    DO WHILE F01=B55.F05
                                           IF F08=B55.F07 AND EMPTY(F12)
                                                REPLACE F10 WITH F10+CEILING(F99^IIF(IIF(SEEK(E07.F07,'E00'),E00.F05,'')='4',-1,1)*B55.F12)*(-1)
                                           ENDIF
                                           SKIP
                                    ENDDO
                               ENDIF
                               SELECT E03
                               SEEK B55.F05
                               IF FOUND()
                                   REPLACE F13 WITH F13+B55.F12*(-1)
                               ENDIF       
                               SELECT B55
                       ENDFOR                  
                   SELE B55
                   DELE FROM B55 WHERE B55.F01=PO_NO
                   SELE B39                     &&刪除未過帳單據紀錄
                   SEEK A02.F03+B55_1.F01                   
                   IF FOUND()
                      DELE
                   ENDIF   
                   SELE B55_1
                   DELE
                   UNLOCK ALL
                   IF INT_099=.T. .AND. SUBSTR(PO_NO,3,4)=SUBSTR(DTOS(CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/01')),3,4)              
                      HD=HD1+SUBSTR(DTOS(CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/01')),3,4)+PO_NO
                      DO ODR_RJT
                   ENDIF  
                ELSE
                   DO file_impact                  
                ENDIF             
             THISFORM.GRID1.SETFOCUS
             IF THISFORM.GRID1.ACTIVEROW=0
                THISFORM.CMDGROUP.ENABLED=.F.
                THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
                THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.               
                THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
                THISFORM.ANS_BOTT.ENABLED=.F.
             ELSE      
                THISFORM.CMDGROUP.ENABLED=.T.
                THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  .AND. B55_1.F13>'2' &&判斷有無修改的權限
                THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)   .AND. B55_1.F13<>'2' &&判斷有無刪除的權限
                THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限
                THISFORM.ANS_BOTT.ENABLED=IIF(B55_1.F13='2',.F.,.T.) .AND. IIF(A02.F11='*',.T.,.F.)  .AND. !THISFORM.SHRGROUP.ENABLED                
             ENDIF     
          ELSE                   &&刪除單筆資料  
                   SELE RECNO() FROM E06 WHERE F01+F02=THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF08.VALUE  INTO ARRAY BK1
                   JJ1=''                
                   IF _TALLY>0                   
                        FOR I= 1 TO ALEN(BK1)
                                JJ1=JJ1+ALLTRIM(STR(BK1(I)))+','
                        ENDFOR  
                        KK1=STUFF(JJ1,RAT(',',JJ1,1),1,'')
                        RLOCK(KK1,'E06')
                        LL1=RLOCK(KK1,'E06')
                   ELSE
                        LL1=.T.   
                   ENDIF 
                   SELE RECNO() FROM E07 WHERE F01=THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE AND F08=THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE INTO ARRAY BK2
                   JJ2=''                
                   IF _TALLY>0                   
                        FOR I= 1 TO ALEN(BK2)
                                JJ2=JJ2+ALLTRIM(STR(BK2(I)))+','
                        ENDFOR  
                        KK2=STUFF(JJ2,RAT(',',JJ2,1),1,'')
                        RLOCK(KK2,'E07')
                        LL2=RLOCK(KK2,'E07')
                   ELSE
                        LL2=.T.   
                   ENDIF                   
                   SELECT E03
                   SEEK B55.F05
                   IF FOUND()
                       RLOCK()
                       LL3=RLOCK()
                   ELSE
                       LL3=.T.
                   ENDIF           
              SELE B55                       
              RLOCK('B55')                               
              IF LL1 .AND. LL2 .AND. LL3 .AND. RLOCK('B55')
                               SELE E06                        
                               SEEK B55.F05+B55.F08
                               IF FOUND()
                                    REPLACE F06 WITH F06+B55.F12*(-1)
                               ENDIF
                               SELECT E07
                               SEEK B55.F05
                               IF FOUND()
                                   DO WHILE F01=B55.F05
                                          IF F08=B55.F07 AND EMPTY(F12)
                                               REPLACE F10 WITH F10+CEILING(F99^IIF(IIF(SEEK(E07.F07,'E00'),E00.F05,'')='4',-1,1)*B55.F12)*(-1)
                                          ENDIF
                                          SKIP
                                   ENDDO
                               ENDIF      
                               SELECT E03
                               SEEK B55.F05
                               IF FOUND()
                                   REPLACE F13 WITH F13+B55.F12*(-1)
                               ENDIF              
                 SELE B55
                 DELE
                 SKIP -1
                 IF BOF()
                    GO TOP
                 ENDIF   
              ELSE
                 DO file_impact                  
              ENDIF     
              THISFORM.GRID2.SETFOCUS
              IF THISFORM.GRID2.ACTIVEROW=0         &&如果單身被刪空
                 SELE B39                           &&刪除未過帳單據紀錄       
                 SEEK A02.F03+B55_1.F01
                 IF FOUND()
                    DELE
                 ENDIF                    
                 SELE B55_1                        
                 PO_NO=B55_1.F01                    
                 DELE                               &&連表頭也要刪除
                 IF INT_099=.T. .AND. SUBSTR(PO_NO,3,4)=SUBSTR(DTOS(CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/01')),3,4)
                    HD=HD1+SUBSTR(DTOS(CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/01')),3,4)+PO_NO
                    DO ODR_RJT
                 ENDIF
                 SELE B55_1
                 SKIP -1
                 IF BOF()
                    GO TOP
                 ENDIF   
                 THISFORM.PAGEFRAME1.ACTIVEPAGE=1 
                 THISFORM.REFRESH          
              ENDIF
          ENDIF
       ENDIF
       RELEASE ALL LIKE BK*   
  ENDPROC  
  PROCEDURE SHRGROUP.SHURE1_BOTT.CLICK               &&新增確認
    IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
       THISFORM.GRID2.RECORDSOURCE='B55'
       THISFORM.GRID2.CHILDORDER=B551
	   THISFORM.grid2.COLUMN1.CONTROLSOURCE='B55.F08'
	   THISFORM.grid2.COLUMN2.CONTROLSOURCE='B01.F02'
	   THISFORM.grid2.COLUMN3.CONTROLSOURCE='B55.F05'       	   
	   THISFORM.grid2.COLUMN4.CONTROLSOURCE="IIF(B55.F09='1','正常','重工')"
	   THISFORM.grid2.COLUMN5.CONTROLSOURCE='B55.F12'
	   THISFORM.grid2.COLUMN6.CONTROLSOURCE='B55.F10'
       SELE B55_1 
       COD=SYS(21)
       SET ORDER TO 1
       IF SEEK(THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE,'B55')=.T.       &&如果編號重複
             SELECT MAX(F01) FROM B55 INTO ARRAY GB NOWAIT
             HD=HD1+SUBSTR(DTOS(CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/01')),3,4)+THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
             DO ODR_RPT
             THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=PO_NO
             THISFORM.PAGEFRAME1.PAGE1.TXTF01.REFRESH           	           
       ENDIF
       IF SEEK(THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE,'A14_1')=.F. .OR. EMPTY(THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE) 
          =MESSAGEBOX('工作部門主檔中無此生產部門編號請先建立!',0+64,'提示訊息視窗')
          THISFORM.PAGEFRAME1.PAGE1.TXTF07.SETFOCUS
          SET ORDER TO &COD
          RETURN            
       ENDIF
       IF SEEK(THISFORM.PAGEFRAME1.PAGE1.TXTF04.VALUE,'A14')=.F. .OR. EMPTY(THISFORM.PAGEFRAME1.PAGE1.TXTF04.VALUE)
          =MESSAGEBOX('收料部門無此編號請先建立!',0+64,'提示訊息視窗')
          THISFORM.PAGEFRAME1.PAGE1.TXTF04.SETFOCUS
          SET ORDER TO &COD
          RETURN            
       ENDIF       
       IF EMPTY(CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/'+THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE))          
          =MESSAGEBOX('收料日期輸入錯誤!',0+64,'提示訊息視窗') 
          THISFORM.PAGEFRAME1.PAGE1.TXTF02.SETFOCUS
          SET ORDER TO &COD          
          RETURN
       ENDIF   
       SELE B55_1          
       APPEND BLANK
       LOCK()
       IF RLOCK()
          REPLACE F01 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
          REPLACE F02 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE
          REPLACE F07 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE
*!*	          REPLACE F08 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF08.VALUE
          REPLACE F04 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF04.VALUE
          REPLACE F06 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
       ENDIF   
 *       UNLOCK
       SEEK THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
       SET ORDER TO &COD
       SELE B39
       APPEND BLANK
       REPL F01 WITH A02.F03
       REPL F02 WITH B55_1.F01
       REPL F03 WITH B55_1.F02
       REPL F05 WITH B55_1.F07
       REPL F06 WITH IIF(SEEK(B55_1.F07,'A14'),A14.F02,'')
       REPL F07 WITH B55_1.F04
       THISFORM.PAGEFRAME1.PAGE1.ENABLED=.F.
       THISFORM.PAGEFRAME1.PAGE2.ENABLED=.T.  
       THISFORM.PAGEFRAME1.ACTIVEPAGE=2
       THISFORM.ORPGROUP.NEW_BOTT.CLICK
       THISFORM.REFRESH
    ELSE                      &&表身新增確認 
       IF SEEK(THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF08.VALUE,'E06')=.F.
          =MESSAGEBOX('無此筆製令資料!',0+48,'提示訊息視窗')          
          THISFORM.PAGEFRAME1.PAGE2.TXTF08.SETFOCUS
          RETURN
       ENDIF   
       IF IIF(SEEK(THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF08.VALUE,'E06'),E06.F05,'')<>B55_1.F07
           =MESSAGEBOX('此生產部門無此筆製令資料!',0+48,'提示訊息視窗')
           THISFORM.PAGEFRAME1.PAGE2.TXTF08.SETFOCUS
           RETURN
       ENDIF
        IF THISFORM.PAGEFRAME1.PAGE2.TXTF12.VALUE>;
             IIF(SEEK(THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF08.VALUE,'E06'),;
             E06.F04-E06.F06,0)
             =MESSAGEBOX('完工數量不得大於';
             +ALLTRIM(STR(IIF(SEEK(THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF08.VALUE,'E06'),;
             E06.F04-E06.F06,0))),0+48,'提示訊息視窗')
             THISFORM.PAGEFRAME1.PAGE2.TXTF12.SETFOCUS
             RETURN
        ENDIF                     
       IF THISFORM.PAGEFRAME1.PAGE2.TXTF12.VALUE<=0
          =MESSAGEBOX('收料數量不得小於等於 0',0+48,'提示訊息視窗')
          THISFORM.PAGEFRAME1.PAGE2.TXTF12.SETFOCUS
          RETURN
       ENDIF   
       IF SEEK(THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF08.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE,'B55')=.T.           
          =MESSAGEBOX('此料號與製令在此張收料單重複!',0+48,'提示訊息視窗')
          THISFORM.PAGEFRAME1.PAGE2.TXTF08.VALUE=''
          THISFORM.PAGEFRAME1.PAGE2.TXTF08.REFRESH
          THISFORM.PAGEFRAME1.PAGE2.TXTF08.SETFOCUS
          RETURN            
       ENDIF           
       SELECT F01,F08,F09 FROM E07 WHERE F01=THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE AND F09>0 AND F08<>THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE NOWAIT
       IF _TALLY>0
           =MESSAGEBOX('前段製程尚未完工,或是請去E04製令工單修改製程加工部門',0+48,'提示訊息視窗')
           THISFORM.PAGEFRAME1.PAGE2.TXTF05.SETFOCUS
           RETURN
       ENDIF
                SELE RECNO() FROM E06 WHERE F01= THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE INTO ARRAY BK2
                JJ2=''                
                IF _TALLY>0                   
                    FOR I= 1 TO ALEN(BK2)
                        JJ2=JJ2+ALLTRIM(STR(BK2(I)))+','
                    ENDFOR  
                    KK2=STUFF(JJ2,RAT(',',JJ2,1),1,'')
                    RLOCK(KK2,'E06')
                    LL2=RLOCK(KK2,'E06')
                ELSE
                   LL2=.T.   
                ENDIF
                SELE RECNO() FROM E07 WHERE F01= THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE AND F08=THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE INTO ARRAY BK3
                JJ3=''                
                IF _TALLY>0                   
                    FOR I= 1 TO ALEN(BK3)
                        JJ3=JJ3+ALLTRIM(STR(BK3(I)))+','
                    ENDFOR  
                    KK3=STUFF(JJ3,RAT(',',JJ3,1),1,'')
                    RLOCK(KK3,'E07')
                    LL3=RLOCK(KK3,'E07')
                ELSE
                   LL3=.T.   
                ENDIF                
                SELE RECNO() FROM E03 WHERE F03=THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE INTO ARRAY BK4
                JJ4=''                
                IF _TALLY>0                   
                    FOR I= 1 TO ALEN(BK4)
                        JJ4=JJ4+ALLTRIM(STR(BK4(I)))+','
                    ENDFOR  
                    KK4=STUFF(JJ4,RAT(',',JJ4,1),1,'')
                    RLOCK(KK4,'E03')
                    LL4=RLOCK(KK4,'E03')
                ELSE
                   LL4=.T.   
                ENDIF                                        
        IF (LL2 .AND. LL3 .AND. LL4)<>.T.
              DO file_impact
              RELEASE ALL LIKE BK*
              THISFORM.PAGEFRAME1.PAGE2.TXTF08.SETFOCUS
              RETURN
        ENDIF  
        
       SELE B55
       APPEND BLANK
       LOCK()
       IF RLOCK()
          REPLACE F01 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
          REPLACE F02 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE          
          REPLACE F05 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE          
          REPLACE F12 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF12.VALUE
          REPLACE F07 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE
          REPLACE F08 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF08.VALUE
          REPLACE F04 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF04.VALUE
          REPLACE F09 WITH IIF(SEEK(THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE,'E03'),E03.F20,'1')
          REPLACE F10 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF10.VALUE
          REPLACE F11 WITH THISFORM.PAGEFRAME1.PAGE2.LBLF111.CAPTION
          REPLACE F06 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
       ENDIF
       RELEASE ALL LIKE BK*
       UNLOCK ALL         
       seek thisform.pageframe1.page1.txtf01.value+thisform.pageframe1.page2.txtF08.value+THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE
       thisform.grid2.enabled=.t.
       thisform.grid2.setfocus  
          SELE E06                  &&寫入生產計劃                                                        
          SEEK B55.F05+B55.F08 
          IF FOUND()
               REPLACE F06 WITH F06+B55.F12                       
          ENDIF
          SELECT E03
          SEEK B55.F05
          IF FOUND()
               REPLACE F13 WITH F13+B55.F12 
          ENDIF
          SELECT E07
          SEEK B55.F05
          IF FOUND()
               DO WHILE F01=B55.F05
                       IF F08=B55.F07 AND EMPTY(F12)
                            REPLACE F10 WITH F10+CEILING(B55.F12*F99^IIF(IIF(SEEK(E07.F07,'E00'),E00.F05,'')='4',-1,1))
                        ENDIF   
                      SKIP
               ENDDO
          ENDIF       
       THISFORM.ORPGROUP.NEW_BOTT.CLICK      
    ENDIF  
  ENDPROC
  PROCEDURE SHRGROUP.SHURE2_BOTT.CLICK                          &&修改確認
     IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
       IF EMPTY(CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/'+THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE))          
          =MESSAGEBOX('收料日期輸入錯誤!',0+64,'提示訊息視窗') 
          THISFORM.PAGEFRAME1.PAGE1.TXTF02.SETFOCUS
          RETURN
        ENDIF           
        IF SEEK(THISFORM.PAGEFRAME1.PAGE1.TXTF04.VALUE,'A14')=.F. .OR. EMPTY(THISFORM.PAGEFRAME1.PAGE1.TXTF04.VALUE)
          =MESSAGEBOX('收料部門無此編號請先建立!',0+64,'提示訊息視窗')
          THISFORM.PAGEFRAME1.PAGE1.TXTF04.SETFOCUS
          RETURN            
       ENDIF       
           SELE B55
           SEEK B55_1.F01
           IF FOUND()
              DO WHILE F01=B55_1.F01
                 REPL F02 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE
                 REPL F06 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')                 
                 REPL F04 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF04.VALUE
                 SKIP
              ENDDO    
           ENDIF        
        SELE B55_1
           REPL F02 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE
           REPL F04 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF04.VALUE
           REPL F06 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
           UNLOCK ALL
     ELSE                                                        &&表身修改確認     
              IF THISFORM.PAGEFRAME1.PAGE2.TXTF12.VALUE>;
                   IIF(SEEK(THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF08.VALUE,'E06'),;
                   E06.F04-E06.F06+B55.F12,0)
                   =MESSAGEBOX('完工數量不得大於';
                   +ALLTRIM(STR(IIF(SEEK(THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF08.VALUE,'E06'),;
                   E06.F04-E06.F06+B55.F12,0))),0+48,'提示訊息視窗')
                   THISFORM.PAGEFRAME1.PAGE2.TXTF12.SETFOCUS
                   RETURN
              ENDIF         
              IF THISFORM.PAGEFRAME1.PAGE2.TXTF12.VALUE<=0
                   =MESSAGEBOX('完工數量不得小於等於 0 !',0+48,'提示訊息視窗')
                   THISFORM.PAGEFRAME1.PAGE2.TXTF12.SETFOCUS
                   RETURN
              ENDIF
                  SELECT E03                      &&將相關檔案回復成之前狀態
                  SEEK B55.F05
                   IF FOUND()
                        REPLACE F13 WITH F13+B55.F12*(-1)
                   ENDIF          
                  SELE E06                           
                  SEEK B55.F05+B55.F08
                  IF FOUND()
                       REPLACE F06 WITH F06+B55.F12*(-1)
                  ENDIF    
                  SELECT E07
                  SEEK B55.F05
                  IF FOUND()
                      DO WHILE F01=B55.F05
                             IF F08=B55.F07 AND EMPTY(F12)
                                 REPLACE F10 WITH F10+CEILING(B55.F12*F99^IIF(IIF(SEEK(E07.F07,'E00'),E00.F05,'')='4',-1,1))*(-1)
                              ENDIF   
                             SKIP
                      ENDDO
                  ENDIF                      
              SELE B55                    
              REPLACE F08 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF08.VALUE
              REPLACE F12 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF12.VALUE      
              REPLACE F10 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF10.VALUE       
              REPLACE F06 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')                         
                  SELE E06                  &&寫入生產計劃                                                                       
                  SEEK B55.F05+B55.F08
                  IF FOUND()
                       REPLACE F06 WITH F06+B55.F12
                  ENDIF
                  SELECT E07
                  SEEK B55.F05
                  IF FOUND()
                      DO WHILE F01=B55.F05
                             IF F08=B55.F07 AND EMPTY(F12)
                                 REPLACE F10 WITH F10+CEILING(B55.F12*F99^IIF(IIF(SEEK(E07.F07,'E00'),E00.F05,'')='4',-1,1))
                             ENDIF 
                             SKIP
                      ENDDO
                  ENDIF
                  SELECT E03
                  SEEK B55.F05
                  IF FOUND()
                      REPLACE F13 WITH F13+B55.F12
                  ENDIF                  
                 
              UNLOCK ALL
    ENDIF   
    THISFORM.SHRGROUP.ABANDON_BOTT.CLICK    
  ENDPROC   
  procedure SHRGROUP.ABANDON_BOTT.CLICK
      THISFORM.SHRGROUP.ENABLED=.F.
      THISFORM.SHRGROUP.VISIBLE=.F.      
      THISFORM.ORPGROUP.ENABLED=.T.
      THISFORM.ORPGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
      THISFORM.CMDGROUP.ENABLED=.T.
      THISFORM.CMDGROUP.SETALL('ENABLED',.T.,'COMMANDBUTTON')
      THISFORM.CMDGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
      THISFORM.SETALL('READONLY',.T.,'TEXTBOX')  
      THISFORM.PAGEFRAME1.PAGE1.SETALL('READONLY',.T.,'TEXTBOX')  
      THISFORM.PAGEFRAME1.PAGE2.SETALL('READONLY',.T.,'TEXTBOX')  
      THISFORM.PAGEFRAME1.PAGE1.TXTF07.READONLY=.T.
      THISFORM.PAGEFRAME1.PAGE1.TXTF04.READONLY=.T.  
      THISFORM.PAGEFRAME1.PAGE2.TXTF08.READONLY=.T.   
      THISFORM.PAGEFRAME1.PAGE2.TXTF05.READONLY=.T.         
      THISFORM.PAGEFRAME1.PAGE1.ENABLED=.T.
      THISFORM.PAGEFRAME1.PAGE2.ENABLED=.T.
      IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1    
          THISFORM.grid1.ENABLED=.T.
          THISFORM.grid2.ENABLED=.T.       
         THISFORM.GRID1.SETFOCUS
         THISFORM.KEY_LIST.ENABLED=.T.
         THISFORM.MTH_LIST.ENABLED=.T.      
      ELSE
          THISFORM.grid1.ENABLED=.F.
          THISFORM.grid2.ENABLED=.T.      
         THISFORM.GRID2.SETFOCUS
         IF THISFORM.GRID2.ACTIVEROW=0
            SELE A24         
            SEEK 'B020 '+SUBSTR(DTOS(CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/01')),3,4)+PO_NO
            IF !FOUND()
                 APPEND BLANK
                 LOCK()
                 REPLACE  F01 WITH 'B020 '
                 REPLACE  F02 WITH SUBSTR(DTOS(CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/01')),3,4)
		 REPLACE  F05 WITH 'BT'+f02
                 REPL F06 WITH '完工入庫單'
                 REPLACE  F08 WITH PO_NO
                 UNLOCK
            ENDIF     
            SELE B39
            SEEK A02.F03+B55_1.F01
            SET ORDER TO 1
            IF FOUND()
               DELE            
            ENDIF   
            SELE B55_1
            DELE
            THISFORM.PAGEFRAME1.ACTIVEPAGE=1
            THISFORM.REFRESH  
         ENDIF   
      ENDIF       
      UNLOCK ALL
      THISFORM.ANS_BOTT.ENABLED=IIF(B55_1.F13='2',.F.,.T.) .AND. IIF(A02.F11='*',.T.,.F.) .AND. !THISFORM.SHRGROUP.ENABLED               
  ENDPROC
  PROCEDURE SHRGROUP.FINISH_BOTT.CLICK
      IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
         IF THISFORM.GRID2.RECORDSOURCE<>'B55'
            THISFORM.GRID2.RECORDSOURCE='B55'
            THISFORM.GRID2.CHILDORDER=B551
	   THISFORM.grid2.COLUMN1.CONTROLSOURCE='B55.F08'
	   THISFORM.grid2.COLUMN2.CONTROLSOURCE='B01.F02'
	   THISFORM.grid2.COLUMN3.CONTROLSOURCE='B55.F05'         	   
	   THISFORM.grid2.COLUMN4.CONTROLSOURCE="IIF(B55.F09='1','正常','重工')"
	   THISFORM.grid2.COLUMN5.CONTROLSOURCE='B55.F12'
	   THISFORM.grid2.COLUMN6.CONTROLSOURCE='B55.F10'
	     ENDIF   
	     IF INT_099=.T.
            SELE A24         
            SEEK 'B020 '+SUBSTR(DTOS(CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/01')),3,4)+PO_NO
            IF !FOUND()
                 APPEND BLANK
                 LOCK()
                 REPLACE  F01 WITH 'B020 '
                 REPLACE  F02 WITH SUBSTR(DTOS(CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/01')),3,4)
		 REPLACE  F05 WITH 'BT'+f02
                 REPLACE  F06 WITH '完工入庫單'
                 REPLACE  F08 WITH PO_NO
                 UNLOCK
             ENDIF    
         ENDIF   
         SELE B55_1
         DO CASE 
            CASE THISFORM.KEY_LIST.DISPLAYVALUE='依收料單號排列'
                 SET ORDER TO 1
            CASE THISFORM.KEY_LIST.DISPLAYVALUE='依完工部門排列'
                 SET ORDER TO 2
            CASE THISFORM.KEY_LIST.DISPLAYVALUE='依收料部門排列'
                 SET ORDER TO 3
         ENDCASE   
       ENDIF  
       THISFORM.SHRGROUP.ABANDON_BOTT.CLICK
  ENDPROC     
  PROC ANS_BOTT.CLICK     &&過帳程序
       IF MESSAGEBOX('是否確認資料無誤可以過帳?',4+32+256,'請確認') = 6	 
            ORGDTE=CTOD('')       
            PO_NO=B55_1.F01
            SELE RECNO() FROM B55 WHERE B55.F01=PO_no  AND F13<>'2' INTO ARRAY BK1              
            JJ1=''                
            IF _TALLY>0   
                FOR I= 1 TO ALEN(BK1)
                       JJ1=JJ1+ALLTRIM(STR(BK1(I)))+','
                 ENDFOR    
                 KK1=STUFF(JJ1,RAT(',',JJ1,1),1,'')              
                 RLOCK(KK1,'B55')
                 LL1=RLOCK(KK1,'B55')
             ELSE
                 LL1=.T.   
             ENDIF 
             SELE RECNO() FROM E06 WHERE F01+F02= ANY (SELE F05+F08 FROM B55 WHERE F01=PO_NO) INTO ARRAY BK2
             JJ2=''                
             IF _TALLY>0                   
                 FOR I= 1 TO ALEN(BK2)
                         JJ2=JJ2+ALLTRIM(STR(BK2(I)))+','
                 ENDFOR  
                 KK2=STUFF(JJ2,RAT(',',JJ2,1),1,'')
                 RLOCK(KK2,'E06')
                 LL2=RLOCK(KK2,'E06')
             ELSE
                 LL2=.T.   
            ENDIF   
            SELE RECNO() FROM E07 WHERE F01=ANY(SELE F05 FROM B55 WHERE F01=PO_NO) INTO ARRAY BK5
            JJ5=''
            IF _TALLY>0   
                FOR I= 1 TO ALEN(BK5)
                       JJ5=JJ5+ALLTRIM(STR(BK5(I)))+','
                 ENDFOR    
                KK5=STUFF(JJ5,RAT(',',JJ5,1),1,'')              
                RLOCK(KK5,'E07')
                LL5=RLOCK(KK5,'E07')
            ELSE
                LL5=.T.   
            ENDIF                   
            SELE RECNO() FROM E03 WHERE F03 =ANY(SELE F05  FROM B55 WHERE F01=PO_NO) INTO ARRAY BK6
            JJ6=''
            IF _TALLY>0   
               FOR I= 1 TO ALEN(BK6)
                   JJ6=JJ6+ALLTRIM(STR(BK6(I)))+','
               ENDFOR    
               KK6=STUFF(JJ6,RAT(',',JJ6,1),1,'')              
               RLOCK(KK6,'E03')
               LL6=RLOCK(KK6,'E03')
            ELSE
               LL6=.T.   
            ENDIF                                           
            SELE RECNO() FROM E11 WHERE F07>F09 AND F01 =ANY(SELE F05  FROM B55 WHERE F01=PO_NO) INTO ARRAY BK7
            JJ7=''
            IF _TALLY>0   
               FOR I= 1 TO ALEN(BK7)
                   JJ7=JJ7+ALLTRIM(STR(BK7(I)))+','
               ENDFOR    
               KK7=STUFF(JJ7,RAT(',',JJ7,1),1,'')              
               RLOCK(KK7,'E11')
               LL7=RLOCK(KK7,'E11')
            ELSE
               LL7=.T.   
            ENDIF                                           
            SELE RECNO() FROM E16 WHERE   F01 =ANY(SELE F05  FROM B55 WHERE F01=PO_NO) INTO ARRAY BK8
            JJ8=''
            IF _TALLY>0   
               FOR I= 1 TO ALEN(BK8)
                   JJ8=JJ8+ALLTRIM(STR(BK8(I)))+','
               ENDFOR    
               KK8=STUFF(JJ8,RAT(',',JJ8,1),1,'')              
               RLOCK(KK8,'E16')
               LL8=RLOCK(KK8,'E16')
            ELSE
               LL8=.T.   
            ENDIF                                                       
            IF LL1 .AND. LL2 .AND. LL5 .AND. LL6 .AND. LL7 .AND. LL8    =.T.                                
                 IF LEN(ALLTRIM(JJ1))>0 
                    IF !USED('E08')
                       SELECT 0
                       USE E08
                     ELSE
                        SELECT E08
                     ENDIF
                     SET ORDER TO E083      
                     SELE B55
                     FOR I= 1 TO ALEN(BK1)                      
                             GO BK1(I) 
                               SELE B01                                            &&物料基本主檔
                               SEEK B55.F08
                               IF FOUND()                                          &&物料基本主檔存在才做計算
                                    IF !EMPTY(F98)                                   &&如果不是虛擬料號才做庫存運算                     
                                         SELECT  B11                                            &&部門庫存明細檔 
                                         SET ORDER TO 1
                                         SEEK B55.F04+B55.F08+SPACE(5) &&IIF(INT_028,IIF(SEEK('CA'+LEFT(B55.F05,8),'C03','C031'),C03.F03,SPACE(5)),SPACE(5))
                                         IF FOUND()
                                             REPLACE  F04 WITH F04+B55.F12
                                             IF  F04=0
                                                  DELE
                                             ELSE   
                                                  IF F05<CTOD((THISFORM.MTH_LIST.DISPLAYVALUE+'/'+B55.F02))
                                                      REPLACE  F05 WITH CTOD((THISFORM.MTH_LIST.DISPLAYVALUE+'/'+B55.F02))
                                                      REPLACE  F06 WITH B55.F05+IIF(B55.F09='1','正常','重工')
                                                  ENDIF
                                             ENDIF   
                                         ELSE
                                             APPEND BLANK
                                             REPLACE  F01 WITH B55.F04
                                             REPLACE  F03 WITH B55.F08
                                             REPLACE  F04 WITH B55.F12
                                             REPLACE  F05 WITH CTOD((THISFORM.MTH_LIST.DISPLAYVALUE+'/'+B55.F02))
                                             REPLACE  F06 WITH B55.F05+IIF(B55.F09='1','正常','重工')     
                                             IF INT_028
                                                REPLACE F08 WITH IIF(SEEK('CA'+LEFT(B55.F05,8),'C03'),C03.F03,SPACE(5))
                                             ENDIF                         
                                         ENDIF   
                                         IF B55.F09='2'   &&重工以轉出處理
                                             SEEK B55.F07+B55.F08+SPACE(5)
                                             IF FOUND()
                                                  REPLACE F04 WITH F04+B55.F12*(-1)
                                                  IF F04=0
                                                       DELETE
                                                  ELSE
                                                      IF F05<CTOD((THISFORM.MTH_LIST.DISPLAYVALUE+'/'+B55.F02))
                                                          REPLACE  F05 WITH CTOD((THISFORM.MTH_LIST.DISPLAYVALUE+'/'+B55.F02))                                                      
                                                      ENDIF                                                       
                                                  ENDIF     
                                             ELSE
                                                 APPEND BLANK
                                                 REPLACE  F01 WITH B55.F07
                                                 REPLACE  F03 WITH B55.F08
                                                 REPLACE  F04 WITH B55.F12*(-1)
                                                 REPLACE  F05 WITH CTOD((THISFORM.MTH_LIST.DISPLAYVALUE+'/'+B55.F02))
                                             ENDIF
                                         ENDIF
                                         SELE B25                                             &&分部門庫存月報表 
                                         SEEK B55.F04+B55.F08                       &&收料部門          
                                         IF !FOUND()
                                             APPEND BLANK
                                             REPLACE  F01 WITH B55.F04
                                             REPLACE  F02 WITH B55.F08
                                         ENDIF
                                         REPLACE  F08 WITH F08+B55.F12
                                         REPLACE  F15 WITH F15+B55.F12            
                                         SEEK B55.F07+B55.F08                     &&完工部門
                                         IF !FOUND()
                                              APPEND BLANK
                                              REPLACE F01 WITH B55.F07
                                              REPLACE F02 WITH B55.F08
                                         ENDIF
                                         IF B55.F09='2'    &&若為重工
                                             REPLACE F11 WITH F11+B55.F12       &&當做生產耗用
                                             REPLACE F15 WITH F15+B55.F12*(-1)   &&要扣除期末數量                                        
                                         ENDIF    
                                         REPLACE F10 WITH F10+B55.F12         &&生產數量                                                                           
                                         REPLACE F09 WITH F09+B55.F12         &&轉出數量
                                         SELE B26                                            &&庫存異動紀錄
                                         APPEND BLANK
                                         REPLACE  F01 WITH B55.F08
                                         REPLACE  F02 WITH B55.F04
                                         REPLACE  F03 WITH B55.F02
                                         REPLACE  F04 WITH B55.F12
                                         REPLACE  F06 WITH 'T'
                                         REPLACE  F07 WITH B55.F01
                                         REPLACE  F08 WITH '製'+B55.F05+IIF(B55.F09='2','重工','')
                                         IF B55.F09='2'         &&若為重工以移轉處理
                                             APPEND BLANK
                                             REPLACE  F01 WITH B55.F08
                                             REPLACE  F02 WITH B55.F07
                                             REPLACE  F03 WITH B55.F02
                                             REPLACE  F04 WITH B55.F12*(-1)
                                             REPLACE  F06 WITH 'T'
                                             REPLACE  F07 WITH B55.F01
                                             REPLACE  F08 WITH '製'+B55.F05+'重工'                
                                         ENDIF
                                    ENDIF
                               ENDIF   
                               SELE E06                                            &&生產計劃                           
                               SEEK B55.F05+B55.F08
                               IF FOUND()
                                    ORGDTE=E06.F03
                                    SELECT E06                                                         
                                    REPLACE F06 WITH F06+B55.F12*(-1)
                                    REPLACE F04 WITH F04+B55.F12*(-1)
                                    IF F04=0
                                        DELETE
                                    ENDIF    
                               ENDIF                                 
                               SELECT E08
                               SEEK B55.F08
                               IF FOUND()
                                  REPLACE F20 WITH F20+B55.F12*(-1)
                               ELSE
                                  APPEND BLANK
                                  REPLACE F01 WITH CTOD(THISFORM.MTH_LIST.DISPLAYVALUE+'/'+B55.F02)
                                  REPLACE F02 WITH B55.F08
                                  REPLACE F20 WITH B55.F12*(-1)
                               ENDIF
                               SELECT E03
                               SEEK B55.F05
                               IF FOUND()                                  
                                   REPLACE F13 WITH F13+B55.F12*(-1)
                                   REPLACE F05 WITH F05+B55.F12
                               ENDIF                                      
                               SELECT E07
                               SEEK B55.F05
                               IF FOUND()
                                    DO WHILE F01=B55.F05
                                           IF F08=B55.F07 AND EMPTY(F12)
                                                MTH_VLE=ALLTRIM(THISFORM.MTH_LIST.DISPLAYVALUE)
                                                DO XTU   
                                                SELECT E13
                                                APPEND BLANK
                                                REPLACE F01 WITH E07.F01
                                                REPLACE F02 WITH E07.F07
                                                REPLACE F03 WITH B55.F02
                                                REPLACE F04 WITH B55.F01
                                                REPLACE F99 WITH E07.F99
                                                REPLACE F05 WITH CEILING(B55.F12*F99^IIF(IIF(SEEK(F02,'E00'),E00.F05,'')='4',-1,1))
                                                REPLACE F06 WITH E07.F06
                                                REPLACE F07 WITH B55.F07
                                                REPLACE F08 WITH E07.F98
                                                SELECT E07                                        
                                                REPLACE F10 WITH F10+CEILING(F99^IIF(IIF(SEEK(E07.F07,'E00'),E00.F05,'')='4',-1,1)*B55.F12)*(-1)
                                                REPLACE F09 WITH F09+CEILING(F99^IIF(IIF(SEEK(E07.F07,'E00'),E00.F05,'')='4',-1,1)*B55.F12)*(-1)
                                                IF F09<=0
                                                    DELE
                                                ENDIF
                                           ENDIF  
                                           SELECT E07
                                           SKIP
                                    ENDDO
                               ENDIF                                                   
                               SELE B55
                              REPLACE  F13 WITH '2'
                              REPLACE  F90 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')             
                              REPLACE F11 WITH E06.F16
                              REPLACE F19 WITH ORGDTE       
                     ENDFOR   
                     SELECT E08
                     USE
                     SELE B39                    &&未過帳庫存單據查詢檔
                     SEEK A02.F03+B55_1.F01
                     IF FOUND()
                         DELE
                     ENDIF                                             
                     SELE B55_1
                     REPLACE  F13 WITH '2'
                     REPLACE  F90 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'') 
                ELSE
                     =MESSAGEBOX('此單據已由別的工作站過帳完成',0+64,'提示訊息視窗')
                     SELE B55_1
                     REPLACE  F13 WITH '2'
                ENDIF           
                THIS.ENABLED=.F.
                THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
                THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.             
                UNLOCK ALL
                IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
                    THISFORM.GRID1.SETFOCUS
                ELSE
                     THISFORM.GRID2.SETFOCUS
                     THISFORM.ORPGROUP.NEW_BOTT.ENABLED=.F.
                ENDIF
                THISFORM.REFRESH
          ELSE
                DO file_impact
                 unlock all
                 return
          ENDIF             
          unlock all
          RELEASE ALL LIKE BK*
          THISFORM.VRT_BOTT.ENABLED=IIF(A02.F12='*',.T.,.F.)
      ENDIF      
  ENDPROC
  PROC VRT_BOTT.CLICK     &&反過帳程序  
         if messagebox('是否確認資料無誤可以過帳?',4+32+256,'請確認') = 6	            
             PO_NO=B55_1.F01
             SELE RECNO() FROM B55 WHERE B55.F01=PO_NO AND F13='2' INTO ARRAY BK1              
            JJ1=''                
            IF _TALLY>0   
               FOR I= 1 TO ALEN(BK1)
                   JJ1=JJ1+ALLTRIM(STR(BK1(I)))+','
               ENDFOR    
               KK1=STUFF(JJ1,RAT(',',JJ1,1),1,'')              
               RLOCK(KK1,'B55')
               LL1=RLOCK(KK1,'B55')
            ELSE
               LL1=.T.   
            ENDIF                   
            SELE RECNO() FROM E06 WHERE F01+F02= ANY (SELE F05+F08 FROM B55 WHERE F01=PO_NO) INTO ARRAY BK2
            JJ2=''                
            IF _TALLY>0                   
               FOR I= 1 TO ALEN(BK2)
                   JJ2=JJ2+ALLTRIM(STR(BK2(I)))+','
                ENDFOR  
                KK2=STUFF(JJ2,RAT(',',JJ2,1),1,'')
                RLOCK(KK2,'E06')
                LL2=RLOCK(KK2,'E06')
            ELSE
               LL2=.T.   
            ENDIF   
            SELECT RECNO() FROM E16 WHERE F01=ANY(SELE F05 FROM B55 WHERE F01=PO_NO) INTO ARRAY BK3
            JJ3=''                
            IF _TALLY>0                   
               FOR I= 1 TO ALEN(BK3)
                   JJ3=JJ3+ALLTRIM(STR(BK3(I)))+','
                ENDFOR  
                KK3=STUFF(JJ3,RAT(',',JJ3,1),1,'')
                RLOCK(KK3,'E16')
                LL3=RLOCK(KK3,'E16')
            ELSE
               LL3=.T.   
            ENDIF               
            SELE RECNO() FROM E11 WHERE F01 =ANY (SELE F05 FROM B55 WHERE F01=PO_NO) INTO ARRAY BK5           
            JJ5=''                
            IF _TALLY>0   
               FOR I= 1 TO ALEN(BK5)
                   JJ5=JJ5+ALLTRIM(STR(BK5(I)))+','
               ENDFOR    
               KK5=STUFF(JJ5,RAT(',',JJ5,1),1,'')              
               RLOCK(KK5,'E11')
               LL5=RLOCK(KK5,'E11')
            ELSE
               LL5=.T.   
            ENDIF                     
            SELE RECNO() FROM E03 WHERE F03=ANY (SELE F05  FROM B55 WHERE F01=PO_NO) INTO ARRAY BK6           
            JJ6=''                
            IF _TALLY>0   
               FOR I= 1 TO ALEN(BK6)
                   JJ6=JJ6+ALLTRIM(STR(BK6(I)))+','
               ENDFOR    
               KK6=STUFF(JJ6,RAT(',',JJ6,1),1,'')              
               RLOCK(KK6,'E03')
               LL6=RLOCK(KK6,'E03')
            ELSE
               LL6=.T.   
            ENDIF                                           
            IF LL1 .AND. LL2 .AND. LL3 .AND.  LL5 .AND. LL6 =.T. 
                IF LEN(ALLTRIM(JJ1))>0 
                       IF !USED('E08')
                          SELECT 0
                          USE E08
                       ELSE
                          SELECT E08
                       ENDIF
                       SET ORDER TO E083      
                       SELE B55
                       FOR I= 1 TO ALEN(BK1)                      
                               GO BK1(I) 
                                     SELE B01                                            &&物料基本主檔
                                     SEEK B55.F08
                                     IF FOUND()                                          &&物料基本主檔存在才做計算
                                          IF !EMPTY(F98)                                   &&如果不是虛擬料號才做庫存運算                     
                                               SELE B11                                            &&部門庫存明細檔 
                                               SET ORDER TO 1
                                               SEEK B55.F04+B55.F08+SPACE(5) &&IIF(INT_028,IIF(SEEK('CA'+LEFT(B55.F05,8),'C03'),C03.F03,SPACE(5)),SPACE(5))
                                               IF FOUND()
                                                   REPLACE  F04 WITH F04+B55.F12*(-1)
                                                   IF F04=0
                                                       DELE
                                                   ELSE   
                                                       IF F05<CTOD((THISFORM.MTH_LIST.DISPLAYVALUE+'/'+B55.F02))
                                                           REPLACE  F05 WITH CTOD((THISFORM.MTH_LIST.DISPLAYVALUE+'/'+B55.F02))
                                                           REPLACE  F06 WITH B55.F05
                                                      ENDIF
                                                  ENDIF   
                                               ELSE
                                                  APPEND BLANK
                                                  REPLACE  F01 WITH B55.F04
                                                  REPLACE  F03 WITH B55.F08
                                                  REPLACE  F04 WITH B55.F12 *(-1)
                                                  REPLACE  F05 WITH CTOD((THISFORM.MTH_LIST.DISPLAYVALUE+'/'+B55.F02))
                                                  REPLACE  F06 WITH B55.F05                             
                                                  IF INT_028
                                                     REPLACE F08 WITH IIF(SEEK('CA'+LEFT(B55.F05,8),'C03'),C03.F03,SPACE(5))
                                                  ENDIF    
                                              ENDIF   
                                              IF B55.F09='2'          &&如果是重工以移轉處理
                                                   SEEK B55.F07+B55.F08+SPACE(5)
                                                   IF FOUND()
                                                       REPLACE F04 WITH F04+B55.F12
                                                       IF F04=0
                                                           DELETE
                                                       ELSE
                                                           IF F05<CTOD((THISFORM.MTH_LIST.DISPLAYVALUE+'/'+B55.F02))
                                                               REPLACE  F05 WITH CTOD((THISFORM.MTH_LIST.DISPLAYVALUE+'/'+B55.F02))
                                                           ENDIF    
                                                       ENDIF    
                                                   ELSE
                                                       APPEND BLANK
                                                       REPLACE  F01 WITH B55.F07
                                                       REPLACE  F03 WITH B55.F08
                                                       REPLACE  F04 WITH B55.F12  
                                                       REPLACE  F05 WITH CTOD((THISFORM.MTH_LIST.DISPLAYVALUE+'/'+B55.F02))
                                                   ENDIF    
                                              ENDIF
                                              SELE B25                                             &&分部門庫存月報表 
                                              SEEK B55.F04+B55.F08
                                              IF !FOUND()
                                                  APPEND BLANK
                                                  REPLACE  F01 WITH B55.F04
                                                  REPLACE  F02 WITH B55.F08                                              
                                              ENDIF
                                              REPLACE  F08 WITH F08+B55.F12*(-1)
                                              REPLACE  F15 WITH F15+B55.F12*(-1)       
                                              SEEK B55.F07+B55.F08
                                              IF !FOUND()
                                                  APPEND BLANK
                                                  REPLACE  F01 WITH B55.F07
                                                  REPLACE  F02 WITH B55.F08                                              
                                              ENDIF
                                              REPLACE  F09 WITH F09+B55.F12*(-1)
                                              IF B55.F09='2'                                    &&如果是重工
                                                  REPLACE F15 WITH F15+B55.F12
                                              ELSE
                                                  REPLACE  F10 WITH F10+B55.F12*(-1)
                                              ENDIF    
 
                                              IF B55.F09='2'         &&若為重工以移轉處理
                                                  APPEND BLANK
                                                  REPLACE  F01 WITH B55.F08
                                                  REPLACE  F02 WITH B55.F07
                                                  REPLACE  F03 WITH B55.F02
                                                  REPLACE  F04 WITH B55.F12 
                                                  REPLACE  F06 WITH 'T'
                                                  REPLACE  F07 WITH B55.F01
                                                  REPLACE  F08 WITH '重工反過帳'                
                                              ENDIF                                                             
                                          ENDIF
                                    ENDIF   
                                SELE E06                                            &&產出計劃                                      
                                SEEK B55.F05
                                IF FOUND()
                                     REPLACE F04 WITH F04+(B55.F12)
                                     REPLACE F06 WITH F06+(B55.F12)
                                ELSE 
                                     SELE E06
                                     APPEND BLANK
                                     REPLACE F01 WITH B55.F05
                                     REPLACE F02 WITH B55.F08
                                     REPLACE F03 WITH B55.F19
                                     REPLACE F04 WITH B55.F12
                                     REPLACE F05 WITH B55.F07
                                     REPLACE F06 WITH B55.F12
                                     REPLACE F07 WITH IIF(SEEK('CA'+LEFT(B55.F05,8),'C03'),C03.F03,'')
                                     REPLACE F08 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
                                     REPLACE F09 WITH '1'
                                     REPLACE F11 WITH B55.F19
                                     REPLACE F16 WITH B55.F11
                                ENDIF
                                SELECT E08
                                SEEK B55.F08
                                IF FOUND()
                                   REPLACE F20 WITH F20+B55.F12
                                ELSE
                                   APPEND BLANK
                                   REPLACE F01 WITH E06.F03
                                   REPLACE F02 WITH B55.F12
                                   REPLACE F20 WITH B55.F12
                                ENDIF
                                SELECT E13                                &&將製令製程回復成原來狀態
                                SEEK B55.F01+B55.F05
                                IF FOUND()    
                                    DO WHILE F04+F01=B55.F01+B55.F05
                                           IF F07=B55.F07
                                               SELECT E07
                                               SEEK E13.F01+E13.F02
                                               IF FOUND()
                                                   IF EMPTY(F12)
                                                      REPLACE F09 WITH F09+E13.F05
                                                      REPLACE F10 WITH F10+E13.F05
                                                      REPLACE F15 WITH F15+E13.F05
                                                   ENDIF   
                                               ELSE
                                                   APPEND BLANK
                                                   REPLACE F01 WITH E13.F01
                                                   REPLACE F02 WITH B55.F08
                                                   REPLACE F03 WITH B55.F11
                                                   REPLACE F04 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
                                                   REPLACE F06 WITH E13.F06
                                                   REPLACE F07 WITH E13.F02
                                                   REPLACE F08 WITH B55.F07
                                                   REPLACE F98 WITH E13.F08
                                                   REPLACE F99 WITH E13.F99
                                                   REPLACE F09 WITH E13.F05
                                                   REPLACE F10 WITH E13.F05
                                                   REPLACE F15 WITH E13.F05                                                                                                                                      
                                                ENDIF
                                                MTH_VLE=ALLTRIM(THISFORM.MTH_LIST.DISPLAYVALUE)                                                
                                                DO YUV    &&還原領料計劃  
                                           ENDIF                                     
                                                      
                                           SELECT E13
                                           IF F07=B55.F07
                                               DELETE
                                            ENDIF   
                                           SKIP
                                    ENDDO
                                ENDIF                                        
                                SELECT E03
                                SEEK B55.F05
                                IF FOUND()
                                     REPLACE F05 WITH F05+B55.F12*(-1)
                                     REPLACE F13 WITH F13+B55.F12
                                ENDIF                                                         
                                SELE B55
                           REPLACE  F13 WITH ' '
                           REPLACE  F90 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
                   ENDFOR                          
                   SELECT B26
                   DELETE FROM B26 WHERE F07=B55_1.F01
                   SELECT E08
                   USE                             
                 SELE B39                    &&未過帳庫存單據查詢檔
                 APPEND BLANK
                 REPL F01 WITH A02.F03
                 REPL F02 WITH B55_1.F01
                 REPL F03 WITH B55_1.F02
                 REPL F04 WITH IIF(SEEK(B55.F05,'E06'),E06.F07,'')
                 REPL F05 WITH B55_1.F07              
                 REPLACE F06 WITH  IIF(SEEK(F05,'A14'),A14.F02,'')
                 REPLACE F07 WITH B55_1.F04                                
                 SELE B55_1
                 REPL F13 WITH ''
                 REPLACE  F90 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'') 
               ELSE
                  =MESSAGEBOX('此單據已由別的工作站過帳完成',0+64,'提示訊息視窗')
                  SELE B55_1
                  REPL F13 WITH ' '
               ENDIF           
               THIS.ENABLED=.F.
               THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
               THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.             
               UNLOCK ALL
               IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
                  THISFORM.GRID1.SETFOCUS
               ELSE
                   THISFORM.GRID2.SETFOCUS
                   THISFORM.ORPGROUP.NEW_BOTT.ENABLED=.F.
               ENDIF
               
               THISFORM.REFRESH      
            ELSE
              DO file_impact
              unlock all
              return
            ENDIF   
       unlock all
       RELEASE ALL LIKE BK*
       THISFORM.ANS_BOTT.ENABLED= IIF(A02.F11='*',.T.,.F.)       
    ENDIF   
    
  ENDPROC  
enddefine    

***********************************************列印程序
PROCEDURE PNT_PRC  
     LK=B55_1.F01     
     HK=LEFT(DTOC(A23.F01),5)
     FRMDPT=IIF(SEEK(B55_1.F07,'A14'),A14.F02,'')
     TODDPT=IIF(SEEK(B55_1.F04,'A14_1'),A14_1.F02,'')
     SELECT B55.F01,;
            B55.F02,;
            B55.F05,;
            B55.F12,;                    
            B55.F07,;
            B55.F08,;
            B55.F04,;
            C03.F03,;
            C01.F05,;
            B01.F02;            
     FROM B55,C03,C01,B01 WHERE B55.F01=LK AND C03.F02='CA'+LEFT(B55.F05,8) AND C01.F01=C03.F03 AND B01.F01=B55.F08 ORDER BY B55.F08 NOWAIT
     IF _tally >0
       FRMDPT=IIF(SEEK(B55_1.F07,'A14'),A14.F02,'')
       TODDPT=IIF(SEEK(B55_1.F04,'A14'),A14.F02,'')
*       REPORT FORM ALLTRIM(INT_116)+'B55' PREVIEW
        report form ALLTRIM(INT_116)+'B55' to print prompt 
     ENDIF  
ENDPROC
************************************************特殊輸入欄位的設定----料號
DEFINE CLASS TXTF08 AS TEXTBOX
  READONLY=.T.
  MAXLENGTH=43
  FONTSIZE=INT_015*9
  PROCEDURE INTERACTIVECHANGE   
         IF AT('?',ALLTRIM(THIS.VALUE))<>0
                   DO CASE
                         CASE AT('?',ALLTRIM(THIS.VALUE))>1 .AND. EMPTY(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE))                   
                                   SELECT E06.F02,E06.F01,E06.F03,E06.F04,E06.F06  FROM E06  INTO CURSOR OPT;
                                   ORDER BY E06.F02,E06.F03 WHERE E06.F05=THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE; 
                                   AND LEFT(E06.F02,AT('?',THIS.VALUE)-1)=LEFT(THIS.VALUE,AT('?',THIS.VALUE)-1);    
                                   AND  E06.F04-E06.F06>0 AND E06.F09='1'
                         CASE AT('?',ALLTRIM(THIS.VALUE))>1 .AND. !EMPTY(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE))                   
                                   SELECT E06.F02,E06.F01,E06.F03,E06.F04,E06.F06  FROM E06 INTO CURSOR OPT;
                                   ORDER BY E06.F02,E06.F03 WHERE E06.F05=THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE; 
                                   AND LEFT(E06.F02,AT('?',THIS.VALUE)-1)=LEFT(THIS.VALUE,AT('?',THIS.VALUE)-1);    
                                   AND  E06.F04-E06.F06>0 AND E06.F01=THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE AND E06.F09='1'
                         CASE AT('?',ALLTRIM(THIS.VALUE))=1 .AND. EMPTY(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE))                   
                                    SELECT E06.F02,E06.F01,E06.F03,E06.F04,E06.F06  FROM E06 INTO CURSOR OPT ORDER BY E06.F02,E06.F03 WHERE E06.F05=THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE;
                                    AND E06.F04-E06.F06>0 AND E06.F09='1'
                         CASE AT('?',ALLTRIM(THIS.VALUE))=1 .AND. !EMPTY(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE))                   
                                    SELECT E06.F02,E06.F01,E06.F03,E06.F04,E06.F06  FROM E06 INTO CURSOR OPT ORDER BY E06.F02,E06.F03 WHERE E06.F05=THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE;
                                    AND E06.F04-E06.F06>0 AND E06.F01=THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE AND E06.F09='1'
                   ENDCASE 

                   IF _TALLY>0  
                       OPT_SEEK=createobject("OPT_SEEK")  
                       OPT_SEEK.SHOW    
                       IF LEN(ALLTRIM(FLG))>1
                          THIS.VALUE=FLG
                          THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE=CHK_STR
                          THIS.REFRESH          
                          THISFORM.PAGEFRAME1.PAGE2.TXTF12.VALUE=QTY                              
                          FLG='0'           
                          CHK_STR=''
                          QTY=0    
                      ENDIF
                   ELSE
                      =MESSAGEBOX('此部門無未完工製令!請先至E04輸入製令',0+48,'提示訊息視窗')
                       THIS.SETFOCUS
                       RETURN   
                       THISFORM.SHRGROUP.ABANDON_BOTT.CLICK
                  ENDIF      
 
    ENDIF         
             IF !EMPTY(THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE)
                    THISFORM.PAGEFRAME1.PAGE2.LBLF111.CAPTION=IIF(SEEK(THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE ,'E06'),E06.F16,'000')                    
             ENDIF
            THISFORM.PAGEFRAME1.PAGE2.LBLF081.CAPTION=IIF(SEEK(THIS.VALUE,'B01'),B01.F02,'')      
  ENDPROC    
ENDDEFINE
*******************************************************************依製令號碼搜尋
DEFINE CLASS TXTF05 AS TEXTBOX   &&製令號碼
     READONLY=.T.
     MAXLENGTH=12
     FONTSIZE=INT_015*9  
     PROCEDURE INTERACTIVECHANGE
         IF AT('?',ALLTRIM(THIS.VALUE))<>0
                   DO CASE
                         CASE AT('?',ALLTRIM(THIS.VALUE))>1 .AND. EMPTY(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF08.VALUE))                   
                                   SELECT E06.F01,E06.F02,E06.F03,E06.F04,E06.F06  FROM E06  INTO CURSOR OQT;
                                   ORDER BY E06.F01,E06.F03 WHERE E06.F05=THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE; 
                                   AND LEFT(E06.F01,AT('?',THIS.VALUE)-1)=LEFT(THIS.VALUE,AT('?',THIS.VALUE)-1);    
                                   AND  E06.F04-E06.F06>0 AND E06.F09='1'
                         CASE AT('?',ALLTRIM(THIS.VALUE))>1 .AND. !EMPTY(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF08.VALUE))                   
                                   SELECT E06.F01,E06.F02,E06.F03,E06.F04,E04.F07  FROM E06 INTO CURSOR OQT;
                                   ORDER BY E06.F01,E06.F03 WHERE E06.F05=THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE; 
                                   AND LEFT(E06.F01,AT('?',THIS.VALUE)-1)=LEFT(THIS.VALUE,AT('?',THIS.VALUE)-1);    
                                   AND  E06.F04-E06.F06>0 AND E06.F02=THISFORM.PAGEFRAME1.PAGE2.TXTF08.VALUE AND E06.F09='1'
                         CASE AT('?',ALLTRIM(THIS.VALUE))=1 .AND. EMPTY(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF08.VALUE))                   
                                    SELECT E06.F01,E06.F02,E06.F03,E06.F04,E06.F06  FROM E06 INTO CURSOR OQT ORDER BY E06.F01,E06.F03 WHERE E06.F05=THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE;
                                    AND E06.F04-E06.F06>0 AND E06.F09='1'
                         CASE AT('?',ALLTRIM(THIS.VALUE))=1 .AND. !EMPTY(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF08.VALUE))                   
                                    SELECT E06.F01,E06.F02,E06.F03,E06.F04,E06.F06  FROM E06 INTO CURSOR OQT ORDER BY E06.F01,E06.F03 WHERE E06.F05=THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE;
                                    AND E06.F04-E06.F06>0 AND E06.F02=THISFORM.PAGEFRAME1.PAGE2.TXTF08.VALUE AND E06.F09='1'
                   ENDCASE 

                   IF _TALLY>0  
                       OQT_SEEK=createobject("OQT_SEEK")  
                       OQT_SEEK.SHOW    
                       IF LEN(ALLTRIM(FLG))>1
                          THIS.VALUE=FLG
                          THISFORM.PAGEFRAME1.PAGE2.TXTF08.VALUE=CHK_STR
                          THIS.REFRESH          
                          THISFORM.PAGEFRAME1.PAGE2.TXTF12.VALUE=QTY                              
                          FLG='0'           
                          CHK_STR=''
                          QTY=0    
                      ENDIF
                   ELSE
                      =MESSAGEBOX('此部門無此未完工製令!請先至E04輸入製令',0+64,'提示訊息視窗')
                       THIS.SETFOCUS
                       RETURN   
                       THISFORM.SHRGROUP.ABANDON_BOTT.CLICK
                  ENDIF       
       ENDIF         
            THISFORM.PAGEFRAME1.PAGE2.LBLF081.CAPTION=IIF(SEEK(THISFORM.PAGEFRAME1.PAGE2.TXTF08.VALUE,'B01'),B01.F02,'')      
            THISFORM.PAGEFRAME1.PAGE2.LBLF111.CAPTION=IIF(SEEK(THIS.VALUE ,'E06'),E06.F16,'000')                                
  ENDPROC     
ENDDEFINE

***************************************************特殊欄位------------------生產部門
DEFINE CLASS TXTF07 AS TEXTBOX
  READONLY=.T.
  MAXLENGTH=5 
  FONTSIZE=INT_015*9  
  PROCEDURE INTERACTIVECHANGE
    IF AT('?',ALLTRIM(THIS.VALUE))<>0
       IF AT('?',ALLTRIM(THIS.VALUE))>1             
          SELECT F01,F02 FROM A14 INTO CURSOR DEPART ORDER BY F01 WHERE LEFT(F01,AT('?',THIS.VALUE)-1)=LEFT(THIS.VALUE,AT('?',THIS.VALUE)-1) AND F04='*' AND F05='*' AND F13='*' AND LEN(ALLTRIM(F01))=4
       ELSE
          SELECT F01,F02 FROM A14 INTO CURSOR DEPART ORDER BY F01 WHERE F04='*' AND F05='*' AND F13='*' AND LEN(ALLTRIM(F01))=4
       ENDIF   
       IF _TALLY>0
          DEPART_SEEK=createobject("DEPART_SEEK")  
          DEPART_SEEK.SHOW    
          THIS.VALUE=FLG
          THIS.REFRESH
          FLG='0'
       ENDIF   
    ENDIF   
       THISFORM.PAGEFRAME1.PAGE1.LBLF071.CAPTION=IIF(SEEK(THIS.VALUE,'A14'),A14.F02,'')         
  ENDPROC
ENDDEFINE  
*************************************************特殊欄位------------------收料部門
DEFINE CLASS TXTF04 AS TEXTBOX
  READONLY=.T.
  MAXLENGTH=5 
  FONTSIZE=INT_015*9  
  PROCEDURE INTERACTIVECHANGE
    IF AT('?',ALLTRIM(THIS.VALUE))<>0
       IF AT('?',ALLTRIM(THIS.VALUE))>1             
          SELECT F01,F02 FROM A14 INTO CURSOR DEPART ORDER BY F01 WHERE LEFT(F01,AT('?',THIS.VALUE)-1)=LEFT(THIS.VALUE,AT('?',THIS.VALUE)-1) AND F04='*' AND F13='*'
       ELSE
          SELECT F01,F02 FROM A14 INTO CURSOR DEPART ORDER BY F01 WHERE F04='*' AND F13='*'
       ENDIF   
       IF _TALLY>0
          DEPART_SEEK=createobject("DEPART_SEEK")  
          DEPART_SEEK.SHOW    
          THIS.VALUE=FLG
          THIS.REFRESH
          FLG='0'
       ENDIF   
    ENDIF   
       THISFORM.PAGEFRAME1.PAGE1.LBLF041.CAPTION=IIF(SEEK(THIS.VALUE,'A14'),A14.F02,'')         
  ENDPROC
ENDDEFINE  
*********************************************************************產出計劃----依料號排列搜尋
define class OPT_SEEK as form
  autocenter=.t.
  caption='產出計劃'
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*320
  WIDTH=INT_015*522
  CONTROLBOX=.F.
  BORDERSTYLE=2
  SHOWTIPS=.T.
  showwindow=1
  windowtype=1
  name='OPT_SEEK'
  add object cmdgroup as cmdgroup with;      
      TOP=INT_015*290,;
      LEFT=INT_015*10
  add object GRID1 as GRID with;          
      AUTOCENTER=.T.,;
      WIDTH=INT_015*522,;      
      HEIGHT=INT_015*293,;      
      ROWHEIGHT=INT_015*18,;
      HEADERHEIGHT=INT_015*19,;
      deletemark=.f.,;
      READONLY=.T.,;
      recordsourcetype=1,;
      columncount=4,;            
      NAME='GRID1',;
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;      
      COLUMN3.NAME='COLUMN3',;      
      COLUMN4.NAME='COLUMN4' 
  add object cmnd1 as commandbutton with;
      LEFT=INT_015*183,;
      TOP=INT_015*295,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;
      caption='\<S.選取',;
      TOOLTIPTEXT='選取此筆資料!快速鍵->ALT+S'
      name='cmnd1'
  add object cmnd2 as commandbutton with;
      LEFT=INT_015*225,;
      TOP=INT_015*295,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;      
      caption='\<C.放棄',;
      TOOLTIPTEXT='取消此作業畫面!快速鍵->ALT+C'
      name='cmnd2'
      procedure init 
         AREA1='OPT' 
        SELE OPT
        THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'COLUMN')
        THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'HEADER')        
         THISFORM.GRID1.READONLY=.T. 
         thisform.grid1.recordsource='OPT'
         THISFORM.CMDGROUP.SEEK_BOTT.VISIBLE=.F.         
         thisform.setall('readonly',.t.,'textbox')
         THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='完成品號'
         THISFORM.GRID1.COLUMN1.WIDTH=INT_015*261
         THISFORM.GRID1.COLUMN1.CONTROLSOURCE='OPT.F02'
         THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='製令號碼'
         THISFORM.GRID1.COLUMN2.CONTROLSOURCE='OPT.F01'
         THISFORM.GRID1.COLUMN2.WIDTH=INT_015*83
         THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='預計完工'
         THISFORM.GRID1.COLUMN3.CONTROLSOURCE='OPT.F03'
         THISFORM.GRID1.COLUMN3.WIDTH=INT_015*74
         THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='完工數量'         
         THISFORM.GRID1.COLUMN4.CONTROLSOURCE='OPT.F04-OPT.F06'
         THISFORM.GRID1.COLUMN4.WIDTH=INT_015*74         
         THISFORM.GRID1.SETFOCUS
      ENDPROC
      PROC GRID1.AFTERROWCOLCHANGE
           LPARAMETERS XColIndex
           FCH='GRID1'
      ENDPROC 
      procedure cmnd1.click   
           FLG=OPT.F02         
           CHK_STR=OPT.F01
           QTY=OPT.F04-OPT.F06 
           AREA1='B55_1'
          SELE OPT
          USE
          THISFORM.RELEASE                                            
      endproc
      procedure cmnd2.click
          FLG='0'
          CHK_STR=''
          QTY=0
          AREA1='B55_1'
          SELE OPT
          USE
         thisform.release
      endproc    
enddefine            
***************************************產出計劃-------依製令號碼排列搜尋
define class OQT_SEEK as form
  autocenter=.t.
  caption='生產計劃'
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*320
  WIDTH=INT_015*522
  CONTROLBOX=.F.
  BORDERSTYLE=2
  SHOWTIPS=.T.
  showwindow=1
  windowtype=1
  name='OQT_SEEK'
  add object cmdgroup as cmdgroup with;      
      TOP=INT_015*290,;
      LEFT=INT_015*10
  add object GRID1 as GRID with;          
      AUTOCENTER=.T.,;
      WIDTH=INT_015*522,;      
      HEIGHT=INT_015*293,;      
      ROWHEIGHT=INT_015*18,;
      HEADERHEIGHT=INT_015*19,;
      deletemark=.f.,;
      READONLY=.T.,;
      recordsourcetype=1,;
      columncount=4,;            
      NAME='GRID1',;
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;      
      COLUMN3.NAME='COLUMN3',;      
      COLUMN4.NAME='COLUMN4'            
  add object cmnd1 as commandbutton with;
      LEFT=INT_015*183,;
      TOP=INT_015*295,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;      
      caption='\<S.選取',;
      TOOLTIPTEXT='選取此筆資料!快速鍵->ALT+S'
      name='cmnd1'
  add object cmnd2 as commandbutton with;
      LEFT=INT_015*225,;
      TOP=INT_015*295,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;            
      caption='\<C.放棄',;
      TOOLTIPTEXT='取消此作業畫面!快速鍵->ALT+C'
      name='cmnd2'
      procedure init 
         AREA1='OQT' 
        SELE OQT
         THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'COLUMN')
         THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'HEADER')         
         THISFORM.GRID1.READONLY=.T. 
         thisform.grid1.recordsource='OQT'
         THISFORM.CMDGROUP.SEEK_BOTT.VISIBLE=.F.         
         thisform.setall('readonly',.t.,'textbox')
         THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='製令號碼'
         THISFORM.GRID1.COLUMN1.CONTROLSOURCE='OQT.F01'
         THISFORM.GRID1.COLUMN1.WIDTH=INT_015*83
         THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='完成品號'
         THISFORM.GRID1.COLUMN2.WIDTH=INT_015*261
         THISFORM.GRID1.COLUMN2.CONTROLSOURCE='OQT.F02'         
         THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='預計完工'
         THISFORM.GRID1.COLUMN3.CONTROLSOURCE='OQT.F03'
         THISFORM.GRID1.COLUMN3.WIDTH=INT_015*74
         THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='完工數量'         
         THISFORM.GRID1.COLUMN4.CONTROLSOURCE='OQT.F04-OQT.F06'
         THISFORM.GRID1.COLUMN4.WIDTH=INT_015*74         
         THISFORM.GRID1.SETFOCUS
      ENDPROC
      PROC GRID1.AFTERROWCOLCHANGE
           LPARAMETERS XColIndex
           FCH='GRID1'
      ENDPROC 
      procedure cmnd1.click        
           FLG=OQT.F01         
           CHK_STR=OQT.F02
           QTY=OQT.F04-OQT.F06
          AREA1='B55_1'
          SELE OQT
          USE
          THISFORM.RELEASE                                            
      endproc
      procedure cmnd2.click
          FLG='0'
          CHK_STR=''
          QTY=0
          AREA1='B55_1'
          SELE OQT
          USE
         thisform.release
      endproc    
enddefine            
************************************過帳耗料程序
PROCEDURE XTU
        SELECT E16
        SEEK E07.F01+E07.F07
        IF FOUND()
             DO WHILE F01+F12=E07.F01+E07.F07
                    SELECT E11
                    SEEK E16.F01+E16.F02
                    IF FOUND()
                       IF IIF(SEEK(E11.F11,'E00'),E00.F05,'')='3'                 
                          REPLACE F09 WITH F09+CEILING(B55.F12*E11.F06*(1+E11.F20/100))
                       ELSE
                          IF IIF(SEEK(E11.F04,'B01'),B01.F39,'')='C'
                             REPLACE F09 WITH F09+CEILING(B55.F12*E11.F06^(-1))
                          ELSE
                             REPLACE F09 WITH F09+ROUND(B55.F12*E11.F06*(1+E11.F20/100),4)
                          ENDIF   
                       ENDIF  
                         SELECT B01
                         SEEK E11.F04
                         IF FOUND()  AND !EMPTY(F98)
                              SELECT E14
                              APPEND BLANK
                              REPLACE F01 WITH E16.F01
                              REPLACE F02 WITH E16.F02
                              REPLACE F03 WITH B55.F02
                              REPLACE F04 WITH B55.F01
                              IF IIF(SEEK(E11.F11,'E00'),E00.F05,'')='3' &&計數扣料
                                 REPLACE F05 WITH CEILING(B55.F12*E11.F06*(1+E11.F20/100))  &&強迫進位
                              ELSE
                                 IF IIF(SEEK(E11.F04,'B01'),B01.F39,'')='C'
                                    REPLACE F05 WITH CEILING(B55.F12*E11.F06^(-1))
                                 ELSE
                                    REPLACE F05 WITH ROUND(B55.F12*E11.F06*(1+E11.F20/100) ,4)
                                 ENDIF   
                              ENDIF   
                              REPLACE F06 WITH E16.F12
                              REPLACE F07 WITH B55.F07
                              REPLACE F08 WITH IIF(E11.F18='3',.T.,.F.)
                              SELECT B11
                              SEEK B55.F07+E11.F04+SPACE(5)
                              IF FOUND()                                 
                                 REPLACE F04 WITH F04+E14.F05*(-1)
                                 IF F04=0
                                    DELETE
                                 ELSE
                                    IF F05<CTOD(MTH_VLE+'/'+B55.F02)
                                       REPLACE  F05 WITH CTOD(MTH_VLE+'/'+B55.F02)
                                       REPLACE  F06 WITH B55.F05
                                    ENDIF                                                                                
                                 ENDIF
                              ELSE
                                   APPEND BLANK
                                   REPLACE  F01 WITH B55.F07
                                   REPLACE  F03 WITH E11.F04                                   
                                   REPLACE  F04 WITH E14.F05*(-1)                                   
                                   REPLACE  F05 WITH CTOD(MTH_VLE+'/'+B55.F02)
                                   REPLACE  F06 WITH B55.F05                               
                                   IF INT_028
                                      REPLACE F08 WITH IIF(SEEK('CA'+LEFT(B55.F05,8),'C03'),C03.F03,SPACE(5))                                   
                                   ENDIF                                                                                    
                              ENDIF    
                              SELECT B25                              
                              SEEK B55.F07+E11.F04
                              IF !FOUND()
                                  APPEND BLANK
                                  REPLACE F01 WITH B55.F07
                                  REPLACE F02 WITH E11.F04
                              ENDIF                                    
                              IF E11.F18='3'           &&如果是客提物料 
                                 
                                 REPLACE F09 WITH F09+E14.F05
                                 
                              ELSE               
                                                    
                                  REPLACE F11 WITH F11+E14.F05
                                 
                              ENDIF                        
                                                                                                          
                              REPLACE F15 WITH F15+E14.F05*(-1)       
                                                                                                                             
                              SELECT B26
                              APPEND BLANK
                              REPLACE  F01 WITH E11.F04
                              REPLACE  F02 WITH B55.F07
                              REPLACE  F03 WITH B55.F02
                              
                              REPLACE  F04 WITH  E14.F05*(-1)
                              
                              REPLACE  F06 WITH 'T'
                              REPLACE  F07 WITH B55.F01
                              REPLACE  F08 WITH '製'+B55.F05  
                         ENDIF
                         
                         SELECT E16
                        
                            REPLACE F04 WITH F04+E14.F05*(-1)
                           
                        
                         SELECT E08
                         SEEK E16.F02
                         IF FOUND()
                            REPLACE F20 WITH F20+E14.F05
                         ELSE
                            APPEND BLANK
                            REPLACE F01 WITH E16.F03
                            REPLACE F02 WITH E16.F02
                            REPLACE F20 WITH E14.F05
                         ENDIF
                         SELECT E16
                         IF F04<=0.005
                             DELETE
                         ENDIF    
                    ENDIF
                    SELECT E16
                    SKIP
             ENDDO
        ENDIF
ENDPROC        
*****************************************************還原領料計劃
PROCEDURE YUV
                                                SELECT E14
                                                SEEK E13.F01+E13.F04+E13.F02
                                                IF FOUND()                                                     
                                                     DO WHILE F01+F04+F06=E13.F01+E13.F04+E13.F02
                                                            SELECT E16
                                                            SEEK E14.F01+E14.F06+E14.F02
                                                            IF FOUND()
                                                                 REPLACE F04 WITH F04+E14.F05
                                                             ELSE
                                                                  APPEND BLANK
                                                                  REPLACE F01 WITH E14.F01
                                                                  REPLACE  F02 WITH E14.F02
                                                                  REPLACE F03 WITH B55.F19-IIF(SEEK(B55.F08,'B01'),B01.F28,0)-IIF(SEEK(F02,'B01'),B01.F31,0)
                                                                  REPLACE F04 WITH E14.F05
                                                                  REPLACE F06 WITH B55.F07
                                                                  REPLACE F07 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
                                                                  REPLACE F09 WITH B55.F08    &&完成品號
                                                                  REPLACE F12 WITH E14.F06
                                                            ENDIF
                                                            SELECT E08
                                                            SEEK E14.F02
                                                            IF FOUND()
                                                               REPLACE F20 WITH F20+E14.F05*(-1)
                                                            ELSE
                                                               APPEND BLANK
                                                               REPLACE F01 WITH E16.F03
                                                               REPLACE F02 WITH E14.F02
                                                               REPLACE F20 WITH E14.F05*(-1)
                                                            ENDIF
                                                            SELECT E11
                                                            SEEK E14.F01+E14.F02
                                                            IF FOUND()
                                                                 REPLACE F09 WITH F09+E14.F05*(-1)                                                                 
                                                            ENDIF
                                                            SELECT B11
                                                            SEEK B55.F07+E14.F02+SPACE(5)
                                                            IF FOUND()
                                                                REPLACE F04 WITH F04+E14.F05
                                                                IF F04=0
                                                                     DELETE
                                                                ELSE     
                                                                     IF F05<CTOD(MTH_VLE+'/'+B55.F02)
                                                                         REPLACE F05 WITH CTOD(MTH_VLE+'/'+B55.F02)
                                                                     ENDIF
                                                                ENDIF      
                                                            ELSE
                                                                APPEND BLANK
                                                                REPLACE F01 WITH B55.F07
                                                                REPLACE F03 WITH E14.F02
                                                                REPLACE F04 WITH E14.F05
                                                                REPLACE F05 WITH  CTOD(MTH_VLE+'/'+B55.F02)   
                                                                IF INT_028
                                                                   REPLACE F08 WITH IIF(SEEK('CA'+LEFT(B55.F05,8),'C03'),C03.F03,SPACE(5))
                                                                ENDIF
                                                            ENDIF
                                                             SELECT B25
                                                             SEEK B55.F07+E14.F02
                                                             IF !FOUND()
                                                                 APPEND BLANK
                                                                 REPLACE F01 WITH B55.F07
                                                                 REPLACE F02 WITH E14.F02
                                                             ENDIF                                                         
                                                             IF E14.F08=.T.            &&判斷是否為客提物料
                                                                 REPLACE F09 WITH F09+E14.F05*(-1)                                                             
                                                             ELSE 
                                                                 REPLACE F11 WITH F11+E14.F05*(-1)
                                                             ENDIF    
                                                             REPLACE F15 WITH F15+E14.F05
                                                             SELECT B26
                                                             APPEND BLANK
                                                             REPLACE F01 WITH E14.F02
                                                             REPLACE F02 WITH B55.F07
                                                             REPLACE F03 WITH B55.F02
                                                             REPLACE F04 WITH E14.F05
                                                             REPLACE F06 WITH 'T'
                                                             REPLACE F07 WITH B55.F01
                                                             REPLACE F08 WITH '反過帳'
                                                            SELECT E14
                                                            DELE
                                                            SKIP
                                                     ENDDO
                                                ENDIF        
ENDPROC                                                 
