**程式名稱:S02.所得稅表
SET EXCL OFF
CLOSE ALL
CLEAR 
SET CONFIRM ON 
AREA1='S02_TEMP'
FLG='0'
FCH=''
CHK=''
IF !USED('A01') 	&&操作人員資料設定
   SELE 0
   USE A01
ELSE 
   SELE A01
ENDIF
SET ORDER TO A01      
IF !USED('A02')	&&權限設定檔
   SELE 0
   USE A02 INDE A02
ELSE
   SELE A02
ENDIF
SET ORDER TO A021      
SEEK SYS_OPER+'S02'                  
IF !USED('S02')	&&所得稅表
   SELE 0
   USE S02 
ELSE
   SELE S02
ENDIF
SET ORDER TO S021
CREATE CURSOR S02_TEMP;
(F01 N(7),F02 N(7),F03 N(6),F04 N(6),F05 N(6),F06 N(6),F07 N(6),F08 N(6),F09 N(6),F10 N(6),F11 N(6),F12 N(6),F13 N(6),F14 N(6),F99 C(17))
INDE ON F01+F02 TAG S02_TEMP1
SELECT S02
GO TOP
DO WHILE !EOF()
   SELE S02_TEMP
   APPEND BLANK 
   REPL F01 WITH S02.F01  
   REPL F02 WITH S02.F02 
   REPL F03 WITH S02.F03
   REPL F04 WITH S02.F04
   REPL F05 WITH S02.F05
   REPL F06 WITH S02.F06
   REPL F07 WITH S02.F07
   REPL F08 WITH S02.F08
   REPL F09 WITH S02.F09
   REPL F10 WITH S02.F10
   REPL F11 WITH S02.F11
   REPL F12 WITH S02.F12
   REPL F13 WITH S02.F13
   REPL F14 WITH S02.F14
   REPL F99 WITH S02.F99   
   SELE S02
   SKIP   
ENDDO
SELECT S02_TEMP
SET ORDER TO S02_TEMP1
GO TOP
*********      SCROLLBARS=2
S02FORM=CREATEOBJECT("TKS02")
S02FORM.SHOW  
DEFINE CLASS TKS02 AS FORM
  CAPTION='S02.所得稅表'
*!*	  AUTOCENTER=.T.
  CONTROLBOX=.F.
  BORDERSTYLE=1  
  MAXBUTTON=.F.
  MINBUTTON=.F.
  MOVABLE=.F.
  CLOSABLE=.F.
  CONTROLCOUNT=57
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*550
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WIDTH=INT_015*791
  WINDOWTYPE=1 
 ADD OBJECT SHAPE_GIRD AS SHAPE WITH;
       TOP=INT_015*5,;
       LEFT=INT_015*5,;
       HEIGHT=INT_015*485,;
       WIDTH=INT_015*780,;
       SPECIALEFFECT=0,;
       TOOLTIPTEXT='所得稅表'     
       NAME='SHAPE_GIRD'             
  ADD OBJECT GRID1 AS GRID1 WITH;
      LEFT=INT_015*13,;
      TOP=INT_015*38,;
      HEIGHT=INT_015*445,;     
      WIDTH=INT_015*765,;    
      COLUMNCOUNT=14,;            
      RECORDSOURCE='S02_TEMP'
  ADD OBJECT LABEL01 AS LABEL WITH;     
      VISIBLE=.T.,;
      LEFT=INT_015*19,;
      TOP=INT_015*15,;
      AUTOSIZE=.T.,;
      FONTSIZE=INT_015*12,;
      CAPTION='每  月  薪  資  所  得',;       
      NAME='LABEL01'          
  ADD OBJECT LINE01 AS LINE WITH;     
      VISIBLE=.T.,;
      LEFT=INT_015*159,;
      TOP=INT_015*7,;
      HEIGHT=INT_015*32,;
      WIDTH=INT_015*0,;
      NAME='LINE01'            
  ADD OBJECT LABEL02 AS LABEL WITH;     
      VISIBLE=.T.,;
      LEFT=INT_015*360,;
      TOP=INT_015*15,;
      AUTOSIZE=.T.,;
      FONTSIZE=INT_015*12,;
      CAPTION='配 偶 及 受 撫 養 親 屬 人 數',;       
      NAME='LABEL02'          
 ADD OBJECT CMDGROUP AS CMDGROUP WITH;
      TOP=INT_015*490,;
      LEFT=INT_015*195                    
 ADD OBJECT ORPGROUP AS ORPGROUP WITH;      
      TOP=INT_015*490,;
      LEFT=INT_015*405   
 ADD OBJECT NEW_BOTT AS COMMANDBUTTON WITH;
     TOP=INT_015*495,;
      LEFT=INT_015*410,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\harrow.cur',;        
      CAPTION='\<N.新增',;
      NAME='NEW_BOTT'         
 ADD OBJECT SAVE_BOTT AS COMMANDBUTTON WITH;
     TOP=INT_015*495,;
      LEFT=INT_015*452,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\harrow.cur',;        
      CAPTION='\<S.儲存',;
      NAME='SAVE_BOTT'   
 ADD OBJECT CANCEL_BOTT AS COMMANDBUTTON WITH;
     TOP=INT_015*495,;
      LEFT=INT_015*536,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\harrow.cur',;        
      CAPTION='\<C.取消',;
      NAME='CANCEL_BOTT '                                     
 ******     
  PROCEDURE INIT
       THISFORM.ORPGROUP.NEW_BOTT.VISIBLE=.F.   
       THISFORM.ORPGROUP.EDIT_BOTT.VISIBLE=.F.   
       THISFORM.ORPGROUP.DEL_BOTT.VISIBLE=.T.   
       THISFORM.ORPGROUP.PNT_BOTT.VISIBLE=.F. 
       THISFORM.CMDGROUP.SEEK_BOTT.VISIBLE=.F. 
       THISFORM.GRID1.LOCKCOLUMNS=2
       THISFORM.GRID1.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'COLUMN')
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'HEADER')
       THISFORM.GRID1.SETALL('ALIGNMENT',2,'HEADER')
       THISFORM.GRID1.COLUMN1.HEADER1.ALIGNMENT=0
       THISFORM.GRID1.COLUMN2.HEADER1.ALIGNMENT=0
       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*67
       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*67
       THISFORM.GRID1.COLUMN3.WIDTH=INT_015*49
       THISFORM.GRID1.COLUMN4.WIDTH=INT_015*49
       THISFORM.GRID1.COLUMN5.WIDTH=INT_015*49
       THISFORM.GRID1.COLUMN6.WIDTH=INT_015*49
       THISFORM.GRID1.COLUMN7.WIDTH=INT_015*49
       THISFORM.GRID1.COLUMN8.WIDTH=INT_015*49
       THISFORM.GRID1.COLUMN9.WIDTH=INT_015*49
       THISFORM.GRID1.COLUMN10.WIDTH=INT_015*49  
       THISFORM.GRID1.COLUMN11.WIDTH=INT_015*49
       THISFORM.GRID1.COLUMN12.WIDTH=INT_015*49
       THISFORM.GRID1.COLUMN13.WIDTH=INT_015*49
       THISFORM.GRID1.COLUMN14.WIDTH=INT_015*49
           THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='所得上限'
	   THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='所得下限'
	   THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='0    人'
	   THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='1    人'
	   THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='2    人'   
  	   THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='3    人'
  	   THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='4    人'	   
  	   THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='5    人'
  	   THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='6    人'
  	   THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='7    人'
  	   THISFORM.GRID1.COLUMN11.HEADER1.CAPTION='8    人'
  	   THISFORM.GRID1.COLUMN12.HEADER1.CAPTION='9    人'
  	   THISFORM.GRID1.COLUMN13.HEADER1.CAPTION='10  人'
  	   THISFORM.GRID1.COLUMN14.HEADER1.CAPTION='11  人'
	   THISFORM.GRID1.COLUMN1.CONTROLSOURCE='S02_TEMP.F01'
	   THISFORM.GRID1.COLUMN2.CONTROLSOURCE='S02_TEMP.F02'
	   THISFORM.GRID1.COLUMN3.CONTROLSOURCE='S02_TEMP.F03'
	   THISFORM.GRID1.COLUMN4.CONTROLSOURCE='S02_TEMP.F04'
	   THISFORM.GRID1.COLUMN5.CONTROLSOURCE='S02_TEMP.F05'
	   THISFORM.GRID1.COLUMN6.CONTROLSOURCE='S02_TEMP.F06'
	   THISFORM.GRID1.COLUMN7.CONTROLSOURCE='S02_TEMP.F07'
  	   THISFORM.GRID1.COLUMN8.CONTROLSOURCE='S02_TEMP.F08'
	   THISFORM.GRID1.COLUMN9.CONTROLSOURCE='S02_TEMP.F09'
	   THISFORM.GRID1.COLUMN10.CONTROLSOURCE='S02_TEMP.F10'  
	   THISFORM.GRID1.COLUMN11.CONTROLSOURCE='S02_TEMP.F11'
	   THISFORM.GRID1.COLUMN12.CONTROLSOURCE='S02_TEMP.F12'
	   THISFORM.GRID1.COLUMN13.CONTROLSOURCE='S02_TEMP.F13'
	   THISFORM.GRID1.COLUMN14.CONTROLSOURCE='S02_TEMP.F14'
       THISFORM.GRID1.READONLY=.F.
       THISFORM.GRID1.SETFOCUS
        IF THISFORM.GRID1.ACTIVEROW=0 
	    THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
	    THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
	    THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
	    THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
	    THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
	    THISFORM.SAVE_BOTT.ENABLED=.F.
	    THISFORM.CANCEL_BOTT.ENABLED=.F.
	ELSE
	    THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)
	    THISFORM.SAVE_BOTT.ENABLED=IIF(A02.F08='*',.T.,.F.)  
	    THISFORM.CANCEL_BOTT.ENABLED=IIF(A02.F09='*',.T.,.F.)     
        ENDIF
        THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.)   
  ENDPROC     
  **********
PROCEDURE NEW_BOTT.CLICK 
    THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
    THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
    THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
    THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
    THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)
    THISFORM.SAVE_BOTT.ENABLED=IIF(A02.F08='*',.T.,.F.)  
    THISFORM.CANCEL_BOTT.ENABLED=IIF(A02.F09='*',.T.,.F.) 
     SELECT S02_TEMP
     APPEND BLANK 
     REPLACE  F01 WITH 0
     REPLACE  F02 WITH 0
     REPLACE  F03 WITH 0
     REPLACE  F04 WITH 0
     REPLACE  F05 WITH 0
     REPLACE  F06 WITH 0
     REPLACE  F07 WITH 0
     REPLACE  F08 WITH 0
     REPLACE  F09 WITH 0
     REPLACE  F10 WITH 0
     REPLACE  F11 WITH 0
     REPLACE  F12 WITH 0
     REPLACE  F13 WITH 0
     REPLACE  F14 WITH 0
     REPLACE  F99 WITH DTOC(DATE())+' '+IIF(SEEK(SYS_OPER,'A01'),A01.F03,'')    
     THISFORM.GRID1.COLUMN1.SETFOCUS
ENDPROC  
**********
PROCEDURE SAVE_BOTT.CLICK  
     F01_TEMP=0
     F02_TEMP=0
     DELETE FROM S02 
     SELECT S02_TEMP
     SET ORDER TO S02_TEMP1
     GO TOP
     DO WHILE !EOF()
            IF EMPTY(S02_TEMP.F01) OR EMPTY(S02_TEMP.F02)
                SELECT S02_TEMP
                DELETE 
            ELSE 
                IF F01_TEMP=S02_TEMP.F01 OR F02_TEMP=S02_TEMP.F02 
                    SELECT S02_TEMP
                    DELETE 
                ELSE
                    SELECT S02
		    APPEND BLANK 
		    REPLACE  F01 WITH S02_TEMP.F01  
		    REPLACE  F02 WITH S02_TEMP.F02 
		    REPLACE  F03 WITH S02_TEMP.F03
		    REPLACE  F04 WITH S02_TEMP.F04
		    REPLACE  F05 WITH S02_TEMP.F05
		    REPLACE  F06 WITH S02_TEMP.F06
		    REPLACE  F07 WITH S02_TEMP.F07
		    REPLACE  F08 WITH S02_TEMP.F08
		    REPLACE  F09 WITH S02_TEMP.F09
		    REPLACE  F10 WITH S02_TEMP.F10
		    REPLACE  F11 WITH S02_TEMP.F11
		    REPLACE  F12 WITH S02_TEMP.F12
		    REPLACE  F13 WITH S02_TEMP.F13
		    REPLACE  F14 WITH S02_TEMP.F14
		    REPLACE  F99 WITH S02_TEMP.F99               
		ENDIF    
	     ENDIF   
	     F01_TEMP=S02_TEMP.F01
	     F02_TEMP=S02_TEMP.F02
	     SELE S02_TEMP
	     SKIP   
     ENDDO	
     THISFORM.GRID1.SETFOCUS            
     IF THISFORM.GRID1.ACTIVEROW=0 
	 THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
	 THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
	 THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
	 THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
	 THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
	 THISFORM.SAVE_BOTT.ENABLED=.F.
	 THISFORM.CANCEL_BOTT.ENABLED=.F.
     ELSE
	 THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)
	 THISFORM.SAVE_BOTT.ENABLED=IIF(A02.F08='*',.T.,.F.)  
	 THISFORM.CANCEL_BOTT.ENABLED=IIF(A02.F09='*',.T.,.F.)     
     ENDIF 
     THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.)         
     SELECT S02_TEMP
     GO TOP     
ENDPROC
**********
PROCEDURE CANCEL_BOTT.CLICK
        DELETE FROM S02_TEMP
	SELE S02
	GO TOP
	DO WHILE !EOF()
	   SELE S02_TEMP
	   APPEND BLANK 
	   REPL F01 WITH S02.F01  
	   REPL F02 WITH S02.F02 
	   REPL F03 WITH S02.F03
	   REPL F04 WITH S02.F04
	   REPL F05 WITH S02.F05
	   REPL F06 WITH S02.F06
	   REPL F07 WITH S02.F07
	   REPL F08 WITH S02.F08
	   REPL F09 WITH S02.F09
	   REPL F10 WITH S02.F10
	   REPL F11 WITH S02.F11
	   REPL F12 WITH S02.F12
	   REPL F13 WITH S02.F13
	   REPL F14 WITH S02.F14
	   REPL F99 WITH S02.F99   
	   SELE S02
	   SKIP   
	ENDDO
        THISFORM.REFRESH
	THISFORM.GRID1.SETFOCUS	
        IF THISFORM.GRID1.ACTIVEROW=0 
	    THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
	    THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
	    THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
	    THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
	    THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
	    THISFORM.SAVE_BOTT.ENABLED=.F.
	    THISFORM.CANCEL_BOTT.ENABLED=.F.
	ELSE
	    THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)
	    THISFORM.SAVE_BOTT.ENABLED=IIF(A02.F08='*',.T.,.F.)  
	    THISFORM.CANCEL_BOTT.ENABLED=IIF(A02.F09='*',.T.,.F.)     
        ENDIF
        THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.)   
ENDPROC   
******
PROC ORPGROUP.DEL_BOTT.CLICK                    &&刪除資料程序
 IF  MESSAGEBOX('是否確定要刪除此筆資料',4+32+256,'請確認')=6 
      SELECT S02_TEMP
      LOCK()
      IF RLOCK()
           SELECT S02
           SEEK S02_TEMP.F01+S02_TEMP.F02
           IF FOUND()  
               DELETE  		       
          ENDIF   
          SELECT S02_TEMP  
          DELETE 
          UNLOCK
          SKIP -1
          IF BOF()
              GO TOP
          ENDIF  
      ELSE
           DO FILE_IMPACT
       ENDIF
  ENDIF      
  THISFORM.GRID1.SETFOCUS   
  IF THISFORM.GRID1.ACTIVEROW=0 
      THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
      THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
      THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
      THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
      THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
      THISFORM.SAVE_BOTT.ENABLED=.F.
      THISFORM.CANCEL_BOTT.ENABLED=.F.
  ELSE
      THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)
      THISFORM.SAVE_BOTT.ENABLED=IIF(A02.F08='*',.T.,.F.)  
      THISFORM.CANCEL_BOTT.ENABLED=IIF(A02.F09='*',.T.,.F.)     
  ENDIF
  THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.)   
ENDPROC		       
ENDDEFINE  

