***程式名稱:物料基本主檔
CLOSE ALL
CLEAR 
FLG='0'
FCH=''
AREA1='B01'
CHK=''
IF !USED('A01')
   SELE 0
   USE A01 INDE A01
ELSE
   SELE A01
ENDIF
SET ORDER TO A01      
IF !USED('A02')
   SELE 0
   USE A02 INDE A02
ELSE
   SELE A02
ENDIF
SET ORDER TO A021      
SEEK SYS_OPER+'B01'
IF !USED('A09')
   SELE 0
   USE A09 INDE A09
ELSE
   SELE A09
ENDIF
SET ORDER TO A091  
IF !USED('A14')
   SELE 0
   USE A14 INDE A14
ELSE 
   SELE A14
ENDIF
SET FILTER TO F04='*'
SET ORDER TO A141    
SET FILTER TO LEN(ALLTRIM(F01))=4 
IF !USED('A26')
   SELE 0
   USE A26 INDE A26
ELSE
   SELE A26
ENDIF
SET ORDER TO 1
IF !USED('E08')
   SELE 0
   USE E08
ELSE
   SELE E08
ENDIF
SET ORDER TO E083      
IF !USED('C02')
   SELE 0
   USE C02 INDE C02
ELSE
   SELE C02
ENDIF
SET ORDER TO C022 
IF !USED('C05')
   SELE 0
   USE C05 INDE C05
ELSE
   SELE C05
ENDIF
SET ORDER TO C055 
IF !USED('C20')
   SELE 0
   USE C20 INDE C20
ELSE
   SELE C20
ENDIF
SET ORDER TO C201 

IF !USED('D02')
   SELE 0
   USE D02 INDE D02
ELSE
   SELE D02
ENDIF
SET ORDER TO D022 
IF !USED('D07')
   SELE 0
   USE D07 INDE D07
ELSE
   SELE D07
ENDIF
SET ORDER TO D075 
IF !USED('P02')
   SELE 0
   USE P02 INDE P02
ELSE
   SELE P02
ENDIF
SET ORDER TO 2 
IF !USED('F01')
   SELE 0
   USE F01 INDE F01
ELSE
   SELE F01
ENDIF
SET ORDER TO F011 
IF !USED('F02')
   SELE 0
   USE F02 INDE F02
ELSE
   SELE F02
ENDIF
SET ORDER TO F022
IF !USED('H01')
   SELE 0
   USE H01
ELSE
   SELE H01
ENDIF
SET ORDER TO H014      
IF !USED('B0A')
   SELE 0
   USE B0A 
ELSE
   SELE B0A
ENDIF
SET ORDER TO B0A1
IF !USED('B11')
   SELE 0
   USE B11 
ELSE
   SELE B11
ENDIF
SET ORDER TO B112     
B25='B25'+LEFT(DTOS(DATE()),6)
B251='B251'+LEFT(DTOS(DATE()),6)
IF !USED('&B25')
   SELE 0
   USE (B25) ALIA B25
ELSE
   SELE B25
ENDIF
SET ORDER TO B251      
IF !USED('B01')
   SELE 0
   USE B01 INDE B01
ELSE
   SELE B01
ENDIF
SET ORDER TO B011
SET RELA TO F07 INTO A14,F34 INTO A01,F01+F07 INTO B11
SET RELATION TO F01 INTO C20 ADDI
SET RELATION TO F01 INTO B0A ADDI
B01FORM=CREATEOBJECT("TKB01")
B01FORM.SHOW  
DEFINE CLASS TKB01 AS FORM
  CAPTION='B01.物料基本主檔'
*!*	  AUTOCENTER=.T.
  CONTROLBOX=.F.
  BORDERSTYLE=1  
  MAXBUTTON=.F.
  MINBUTTON=.F.
  MOVABLE=.F.
  CLOSABLE=.F.
  CONTROLCOUNT=57
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*550
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WIDTH=INT_015*789
  WINDOWTYPE=1
  NAME='TKB01'
  ADD OBJECT SHAPE1 AS SHAPE1 WITH;
      AUTOCENTER=.T.
  ADD OBJECT SHAPE2 AS SHAPE2 WITH;
      AUTOCENTER=.T.
  ADD OBJECT SHAPE3 AS SHAPE3 WITH;
      AUTOCENTER=.T.
  ADD OBJECT LBL_REC AS LBL_REC WITH;
      LEFT=INT_015*660,;
      TOP=INT_015*55,;
      AUTOCENTER =.T.
  ADD OBJECT REC_COUNT AS REC_COUNT  WITH;
      CAPTION=STR(RECCOUNT()),;   
      TOP=INT_015*55
  ADD OBJECT ANS_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*490,;
      LEFT=INT_015*15,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*70,;
      CAPTION='\<A.MRP數據',;
      NAME='ANS_BOTT'
  ADD OBJECT INV_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*490,;
      LEFT=INT_015*87,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*70,;
      CAPTION='\<V.庫存明細',;
      NAME='INV_BOTT'
  ADD OBJECT CHG_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*490,;
      LEFT=INT_015*158,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*70,;
      CAPTION='\<M.改用新料',;
      NAME='CHG_BOTT'      
 
  ADD OBJECT LBLF01 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*27,;
      WIDTH=INT_015*50,;
      CAPTION='品        號'
  ADD OBJECT LBLF49 AS LABEL WITH;
      LEFT=INT_015*558,;
      TOP=INT_015*27,;
      WIDTH=INT_015*50,;
      CAPTION='產地代號' 
   ADD OBJECT LBLF491 AS LABEL WITH;
      LEFT=INT_015*643,;
      TOP=INT_015*27,;
       CAPTION='',; 
      AUTOSIZE=.T.
  ADD OBJECT LBLF02 AS LABEL WITH;      
      LEFT=INT_015*244,;
      TOP=INT_015*52,;
      WIDTH=INT_015*50,;
      CAPTION='品名規格'
  ADD OBJECT LBLF29 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*77,;
      WIDTH=INT_015*50,;
      CAPTION='備註說明'            
  ADD OBJECT LBLF205 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*102,;
      WIDTH=INT_015*50,;
      CAPTION='描 述 四'             
  ADD OBJECT LBLF206 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*127,;
      WIDTH=INT_015*50,;
      CAPTION='描 述 五'                
  ADD OBJECT LBLF06 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*152,;
      WIDTH=INT_015*50,;
      CAPTION='管理類別'
  ADD OBJECT LBLF98 AS LABEL WITH;
      LEFT=INT_015*558,;
      TOP=INT_015*152,;
      WIDTH=INT_015*50,;
      CAPTION='歸屬類別'
  ADD OBJECT LBLF03 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*177,;
      WIDTH=INT_015*50,;
      CAPTION='採購單位'  
  ADD OBJECT LBLF04 AS LABEL WITH;
      LEFT=INT_015*360,;
      TOP=INT_015*177,;
      WIDTH=INT_015*50,;
      CAPTION='計料單位'
  ADD OBJECT LBLF05 AS LABEL WITH;
      LEFT=INT_015*482,;
      TOP=INT_015*177,;
      WIDTH=INT_015*129,;
      CAPTION='採購單位/計料單位比例'                 
  ADD OBJECT LBLF07 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*202,;
      WIDTH=INT_015*50,;
      CAPTION='保管部門'
  ADD OBJECT LBLF071 AS LABEL WITH;
      LEFT=INT_015*345,;
      TOP=INT_015*202    
  ADD OBJECT LBLF34 AS LABEL WITH;
      LEFT=INT_015*558,;
      TOP=INT_015*202,;
      WIDTH=INT_015*50,;
      CAPTION='控管人員'               
  ADD OBJECT LBLF341 AS LABEL WITH;
      LEFT=INT_015*659,;
      TOP=INT_015*202    
  ADD OBJECT LBLF10 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*227,;
      WIDTH=INT_015*50,;
      CAPTION='庫存上限'
  ADD OBJECT LBLF11 AS LABEL WITH;
      LEFT=INT_015*558,;
      TOP=INT_015*227,;
      WIDTH=INT_015*50,;
      CAPTION='安全存量'
  ADD OBJECT LBLF12 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*252,;
      WIDTH=INT_015*50,;
      CAPTION='總庫存量'         
  ADD OBJECT LBLF22 AS LABEL WITH;
      LEFT=INT_015*558,;
      TOP=INT_015*252,;
      WIDTH=INT_015*50,;
      CAPTION='待驗數量'         
  ADD OBJECT LBLF13 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*277,;
      WIDTH=INT_015*50,;
      CAPTION='在庫數量'         
  ADD OBJECT LBLE08 AS LABEL WITH;
      LEFT=INT_015*558,;
      TOP=INT_015*277,;
      WIDTH=INT_015*50,;
      CAPTION='最後結餘'    
  ADD OBJECT LBLF97 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*302,;
      WIDTH=INT_015*50,;
      CAPTION='是否展開',;
      VISIBLE=.T.         
*!*	  ADD OBJECT LBLF26 AS LABEL WITH;
*!*	      LEFT=INT_015*558,;
*!*	      TOP=INT_015*352,;
*!*	      WIDTH=INT_015*50,;
*!*	      VISIBLE=.F.,;
*!*	      CAPTION='是否檢驗'         
  ADD OBJECT LBLF28 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*327,;
      WIDTH=INT_015*50,;
      CAPTION='採購前置'         
  ADD OBJECT LBLF281 AS LABEL WITH;
      AUTOSIZE=.T.,;
      LEFT=INT_015*335,;
      TOP=INT_015*327,;
      CAPTION='天'    
  ADD OBJECT LBLF31 AS LABEL WITH;
      LEFT=INT_015*558,;
      TOP=INT_015*327,;
      WIDTH=INT_015*50,;
      CAPTION='收料前置'         
  ADD OBJECT LBLF311 AS LABEL WITH;
      AUTOSIZE=.T.,;
      LEFT=INT_015*649,;
      TOP=INT_015*327,;
      CAPTION='天'               
  ADD OBJECT LBLF30 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*352,;
      WIDTH=INT_015*50,;
      CAPTION='計算方式'
  ADD OBJECT LBLF301 AS LABEL WITH;
      AUTOSIZE=.T.,;
      LEFT=INT_015*316,;
      TOP=INT_015*352

  ADD OBJECT LBLF39 AS LABEL WITH;
      LEFT=INT_015*558,;
      TOP=INT_015*352,;
      WIDTH=INT_015*50,;
      CAPTION='領料類別'         
  ADD OBJECT LBLF391 AS LABEL WITH;
      AUTOSIZE=.T.,;
      LEFT=INT_015*630,;
      TOP=INT_015*352
  ADD OBJECT LBLF41 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*377,;
      WIDTH=INT_015*50,;
      CAPTION=IIF(EMPTY(ALLTRIM(INT_021)),'自定一項',ALLTRIM(INT_021))       
  ADD OBJECT LBLF42 AS LABEL WITH;
      LEFT=INT_015*558,;
      TOP=INT_015*377,;
      WIDTH=INT_015*50,;
      CAPTION=IIF(EMPTY(ALLTRIM(INT_022)),'自定二項',ALLTRIM(INT_022))    
  ADD OBJECT LBLF43 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*402,;
      WIDTH=INT_015*50,;
      CAPTION=IIF(EMPTY(ALLTRIM(INT_023)),'自定三項',ALLTRIM(INT_023))    
  ADD OBJECT LBLPK1 AS LABEL WITH;
      LEFT=INT_015*558,;
      TOP=INT_015*402,;
      WIDTH=INT_015*50,;
      CAPTION='包裝基量'               
  ADD OBJECT LBLPK2 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*427,;
      WIDTH=INT_015*50,;
      CAPTION='包裝數量'      
  ADD OBJECT LBLPK3 AS LABEL WITH;
      LEFT=INT_015*558,;
      TOP=INT_015*427,;
      WIDTH=INT_015*50,;
      CAPTION='最少訂購'                     
  ADD OBJECT LBLPK4 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*452,;
      WIDTH=INT_015*50,;
      CAPTION='原廠編碼'                           
*!*	  ADD OBJECT LBLF35 AS LABEL WITH;
*!*	      LEFT=INT_015*244,;
*!*	      TOP=INT_015*402,;
*!*	      WIDTH=INT_015*50,;
*!*	      CAPTION='自定成本'         
  ADD OBJECT LBLF36 AS LABEL WITH;
      LEFT=INT_015*558,;
      TOP=INT_015*452,;
      WIDTH=INT_015*50,;
      CAPTION='標準成本'                           
  ADD OBJECT LBLF37 AS LABEL WITH;
      LEFT=INT_015*244,;
       TOP=INT_015*477,;
      WIDTH=INT_015*50,;
       CAPTION='平均成本'   
  ADD OBJECT LBLF38 AS LABEL WITH;
      LEFT=INT_015*558,;
      TOP=INT_015*477,;
      WIDTH=INT_015*129,;
      CAPTION='銷售成本'
   ADD OBJECT LBLF99 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*502,;
      WIDTH=INT_015*129,;
      CAPTION='流水總號'
  ADD OBJECT LBLF21 AS LABEL WITH;
      LEFT=INT_015*558,;
      TOP=INT_015*502,;
      WIDTH=INT_015*50,;
      CAPTION='安全資料'                    
  ADD OBJECT LBLF211 AS LABEL WITH;
      AUTOSIZE=.T.,; 
      LEFT=INT_015*610,;
      TOP=INT_015*502
  ADD OBJECT LBLCMT AS LABEL WITH;
      LEFT=INT_015*416,;
      TOP=INT_015*502,;
      WIDTH=INT_015*50,;
      CAPTION='改用新料',;
      VISIBLE=.F.                
  ADD OBJECT LBLFDT AS LABEL WITH;
      LEFT=INT_015*416,;
      TOP=INT_015*527,;
      WIDTH=INT_015*50,;
      CAPTION='改用月份',; 
      VISIBLE=.F.                         
  ADD OBJECT TXTE08 AS TEXTBOX WITH;
      LEFT=INT_015*609,;
      TOP=INT_015*273,;
      WIDTH=INT_015*118,;
      INPUTMASK='99999999999.9999',;
      FORMAT='9'
      NAME='TXTE08'      
  ADD OBJECT TXTF01 AS TEXTBOX WITH;      
      LEFT=INT_015*295,;
      TOP=INT_015*23,;
      WIDTH=INT_015*261,;
      MAXLENGTH=43,;
      NAME='TXTF01' 
   ADD OBJECT TXTF49 AS TEXTBOX WITH;      
      LEFT=INT_015*609,;
      TOP=INT_015*23,;
      WIDTH=INT_015*30,;
      MAXLENGTH=2,;
      NAME='TXTF49'       
  ADD OBJECT PRODUCTION_PLACE AS PRODUCTION_PLACE WITH;
      AUTOCENTER=.T. 
  ADD OBJECT TXTF02 AS TEXTBOX WITH;
      AUTOSIZE=.T.,;
      LEFT=INT_015*295,;
      TOP=INT_015*48,;
      WIDTH=INT_015*390,;
      MAXLENGTH=60,;
      NAME='TXTF02'                 
  ADD OBJECT TXTF29 AS TEXTBOX WITH;
      LEFT=INT_015*295,;
      TOP=INT_015*73,;
      WIDTH=INT_015*390,;
      HEIGHT=INT_015*25,;
      MAXLENGTH=60,;
      NAME='TXTF29'                    
  ADD OBJECT TXTF205 AS TEXTBOX WITH;
      LEFT=INT_015*295,;
      TOP=INT_015*98,;
      WIDTH=INT_015*390,;
      HEIGHT=INT_015*25,;
      MAXLENGTH=60,;
      NAME='TXTF205'              
  ADD OBJECT TXTF206 AS TEXTBOX WITH;
      LEFT=INT_015*295,;
      TOP=INT_015*123,;
      WIDTH=INT_015*390,;
      HEIGHT=INT_015*25,;
      MAXLENGTH=60,;
      NAME='TXTF206'                       
  ADD OBJECT TXTF06 AS TEXTBOX WITH;
      LEFT=INT_015*295,;
      TOP=INT_015*148,;
      WIDTH=INT_015*20,;      
      INPUTMASK='!',;
      FORMAT='A',;
      NAME='TXTF06'                      
  ADD OBJECT TXTF98 AS TEXTBOX WITH;      
      LEFT=INT_015*609,;
      TOP=INT_015*148,;
      WIDTH=INT_015*60,;
      NAME='TXTF98'          
  ADD OBJECT MT_TYPE AS COMBOBOX WITH;
      LEFT=INT_015*609,;
      TOP=INT_015*148,;
      WIDTH=INT_015*80,;
      FONTSIZE=INT_015*9,;
      HEIGHT=INT_015*25,;
      ROWSOURCETYPE=1,;
      STYLE=2,;
      VALUE=1,;      
      NAME='MT_TYPE'   
  ADD OBJECT TXTF03 AS TEXTBOX WITH;
      LEFT=INT_015*295,;
      TOP=INT_015*173,;
      WIDTH=INT_015*44,;
      MAXLENGTH=4,;
      NAME='TXTF03'                 
  ADD OBJECT TXTF04 AS TEXTBOX WITH;
      LEFT=INT_015*411,;
      TOP=INT_015*173,;
      WIDTH=INT_015*44,;
      MAXLENGTH=4,;
      NAME='TXTF04'
 ADD OBJECT TXTF05 AS TEXTBOX WITH;
      LEFT=INT_015*609, ;
      TOP=INT_015*173, ;
      WIDTH=INT_015*70,;
      INPUTMASK='99999.999',;
      NAME='TXTF05'
  ADD OBJECT TXTF07 AS TEXTBOX WITH;
      LEFT=INT_015*295,;
      TOP=INT_015*198,;
      WIDTH=INT_015*49,;
      MAXLENGTH=5,;
      NAME='TXTF07'                
  ADD OBJECT TXTF34 AS TEXTBOX WITH;
      LEFT=INT_015*609,;
      TOP=INT_015*198,;
      WIDTH=INT_015*49,;
      MAXLENGTH=5,;   
      NAME='TXTF34'
  ADD OBJECT TXTF10 AS TEXTBOX WITH;
      LEFT=INT_015*295,;
      TOP=INT_015*223,;
      WIDTH=INT_015*118,;
      INPUTMASK='99999999999.9999',;
      NAME='TXTF10'                       
  ADD OBJECT TXTF97 AS TEXTBOX WITH;
      LEFT=INT_015*295,;
      TOP=INT_015*298,;
      WIDTH=INT_015*20,;
      INPUTMASK='!',;
      FORMAT='A',;
      NAME='TXTF97'                   
  ADD OBJECT TXTF26 AS TEXTBOX WITH;
      LEFT=INT_015*609,;
      TOP=INT_015*298,;
      WIDTH=INT_015*20,;
      INPUTMASK='!',;
      FORMAT='A',;
      VISIBLE=.F.,;
      NAME='TXTF26'                   
  ADD OBJECT TXTF28 AS TEXTBOX WITH;
      LEFT=INT_015*295,;
      TOP=INT_015*323,;
      WIDTH=INT_015*39,;
      NAME='TXTF28'                        
  ADD OBJECT TXTF31 AS TEXTBOX WITH;
      LEFT=INT_015*609,;
      TOP=INT_015*323,;
      WIDTH=INT_015*38,;
      INPUTMASK='999',;
      NAME='TXTF31'     
  ADD OBJECT TXTF30 AS TEXTBOX WITH;
      LEFT=INT_015*295,;
      TOP=INT_015*348,;
      WIDTH=INT_015*20,;
      INPUTMASK='!',;
      FORMAT='A',;
      NAME='TXTF30'                         
              
  ADD OBJECT TXTF39 AS TEXTBOX WITH;
      LEFT=INT_015*609,;
      TOP=INT_015*348,;
      WIDTH=INT_015*20,;
      INPUTMASK='!',;
      FORMAT='A',;
      NAME='TXTF39'
  ADD OBJECT TXTF41 AS TEXTBOX WITH;
      LEFT=INT_015*295,;
      TOP=INT_015*373,;
      WIDTH=INT_015*257,;
      MAXLENGTH=40,;
      NAME='TXTF41'                         
  ADD OBJECT TXTF42 AS TEXTBOX WITH;
      LEFT=INT_015*609,;
      TOP=INT_015*373,;
      WIDTH=INT_015*115,;
      MAXLENGTH=15,;
      NAME='TXTF42'                   
  ADD OBJECT TXTF43 AS TEXTBOX WITH;
      LEFT=INT_015*295,;
      TOP=INT_015*398,;
      WIDTH=INT_015*115,;
      MAXLENGTH=15,;
      NAME='TXTF43'                        
  ADD OBJECT TXTPK1 AS TEXTBOX WITH;
      LEFT=INT_015*609,;
      TOP=INT_015*398,;
      WIDTH=INT_015*80,;
      NAME='TXTPK1'
                           
  ADD OBJECT TXTPK2 AS TEXTBOX WITH;
      LEFT=INT_015*295,;
      TOP=INT_015*423,;
      WIDTH=INT_015*80,;
      INPUTMASK='999999999',;
      NAME='TXTPK2'                         
  ADD OBJECT TXTPK3 AS TEXTBOX WITH;
      LEFT=INT_015*609,;
      TOP=INT_015*423,;
      WIDTH=INT_015*80,;
      INPUTMASK='999999999',;
      NAME='TXTPK3'                  
  ADD OBJECT TXTPK4 AS TEXTBOX WITH;
      LEFT=INT_015*295,;
      TOP=INT_015*448,;
      WIDTH=INT_015*100,;
      MAXLENGTH=13,;
      NAME='TXTPK4'                        
*!*	  ADD OBJECT TXTF35 AS TEXTBOX WITH;
*!*	      LEFT=INT_015*295,;
*!*	      TOP=INT_015*448,;
*!*	      WIDTH=INT_015*118,;
*!*	      INPUTMASK='999999999.999999',;
*!*	      NAME='TXTF35'                 
  ADD OBJECT TXTF36 AS TEXTBOX WITH;
      LEFT=INT_015*609,;
      TOP=INT_015*448,;
      WIDTH=INT_015*118,;
      INPUTMASK='999999999.999999',;
      NAME='TXTF36'                 
  ADD OBJECT TXTF37 AS TEXTBOX WITH;
      LEFT=INT_015*295,;
      TOP=INT_015*473,;
      WIDTH=INT_015*118,;
      INPUTMASK='999999999.999999',;
      NAME='TXTF37'                                   
  ADD OBJECT TXTF38 AS TEXTBOX WITH;
      LEFT=INT_015*609,;
      TOP=INT_015*473,;
      WIDTH=INT_015*118,;
      INPUTMASK='999999999.999999',;
      NAME='TXTF38' 
  ADD OBJECT TXTF11 AS TEXTBOX WITH;
      AUTOSIZE=.T.,;
      LEFT=INT_015*609,;
      TOP=INT_015*223,;      
      WIDTH=INT_015*118,;
      INPUTMASK='99999999999.9999',;      
      NAME='TXTF11'
  ADD OBJECT TXTF12 AS TEXTBOX WITH;
      LEFT=INT_015*295,;
      TOP=INT_015*248,;
      WIDTH=INT_015*118,;
      INPUTMASK='99999999999.9999',;
      NAME='TXTF12'                 
  ADD OBJECT TXTF22 AS TEXTBOX WITH;
      LEFT=INT_015*609,;
      TOP=INT_015*248,;
      WIDTH=INT_015*118,;
      INPUTMASK='99999999999.9999',;      
      NAME='TXTF22'                      
  ADD OBJECT TXTF13 AS TEXTBOX WITH;
      LEFT=INT_015*295,;
      TOP=INT_015*273,;
      WIDTH=INT_015*118,;
      INPUTMASK='99999999999.9999',;      
      NAME='TXTF13'                             
  ADD OBJECT TXTF99 AS TEXTBOX WITH;
      LEFT=INT_015*295,;
      TOP=INT_015*498,;
      WIDTH=INT_015*70,;
      MAXLENGTH=8,;
      NAME='TXTF99'       
   ADD OBJECT TXTCMT AS TEXTBOX WITH;
      LEFT=INT_015*466,;
      TOP=INT_015*498,;
      WIDTH=INT_015*261,;
      MAXLENGTH=43,;
      NAME='TXTCMT',;   
      VISIBLE=.F.          
    ADD OBJECT TXTFDT AS TEXTBOX WITH;
      LEFT=INT_015*466,;
      TOP=INT_015*523,;
      WIDTH=INT_015*70,;
      NAME='TXTFDT',;
      VISIBLE=.F.                                                  
  ADD OBJECT KEY_LIST AS KEY_LIST WITH;
      AUTOCENTER=.T.
  ADD OBJECT GRID1 AS GRID1 WITH;
      COLUMNCOUNT=2,;            
      RECORDSOURCE='B01',;      
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2'
  ADD OBJECT CMDGROUP AS CMDGROUP WITH;
      AUTOSIZE=.T.              
  ADD OBJECT ORPGROUP AS ORPGROUP WITH;    
      AUTOSIZE=.T.
  ADD OBJECT SHRGROUP AS SHRGROUP WITH;
      TOP=INT_015*485,;
      LEFT=INT_015*458          
  ADD OBJECT CHGGROUP AS COMMANDGROUP WITH;
      TOP=INT_015*455,;
      LEFT=INT_015*558,;
      AUTOSIZE=.T.,;
      BUTTONCOUNT=2,;  
      BACKSTYLE=0,;
      BORDERSTYLE=0,;
      VALUE=1,;       
      HEIGHT=INT_015*30,;
      NAME='CHGGROUP',;       
      COMMAND1.AUTOSIZE=.F.,;
      COMMAND1.TOP=INT_015*5,;
      COMMAND1.LEFT=INT_015*5,;   
      COMMAND1.HEIGHT=INT_015*25,;
      COMMAND1.WIDTH=INT_015*40,;
      COMMAND1.FONTSIZE=INT_015*9,;
      COMMAND1.CAPTION='\<S.確定',;
      COMMAND1.TOOLTIPTEXT='修改新料後確認儲存!快速鍵->ALT+S',;
      COMMAND1.NAME='SHURE_BOTT',;
      COMMAND2.AUTOSIZE=.F.,;
      COMMAND2.TOP=INT_015*5,;
      COMMAND2.LEFT=INT_015*47,;
      COMMAND2.HEIGHT=INT_015*25,;
      COMMAND2.WIDTH=INT_015*40,;
      COMMAND2.FONTSIZE=INT_015*9,;
      COMMAND2.CAPTION='\<Q.放棄',;
      COMMAND2.TOOLTIPTEXT='放棄此筆修改作業!快速鍵->ALT+A',;
      COMMAND2.NAME='NODO_BOTT' 
  PROC INIT
       THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.)   &&判斷有無新增的權限
*!*	       THISFORM.LBLF35.VISIBLE=!EMPTY(A02.F10)   &&判斷有無處理成本的權限
       THISFORM.LBLF36.VISIBLE=!EMPTY(A02.F10)   &&判斷有無處理成本的權限 
       THISFORM.LBLF37.VISIBLE=!EMPTY(A02.F10)   &&判斷有無處理成本的權限
       THISFORM.LBLF38.VISIBLE=!EMPTY(A02.F10)   &&判斷有無處理成本的權限
*!*	       THISFORM.LBLF99.VISIBLE=!EMPTY(A02.F11)   &&判斷有無處理總號的權限
*!*	       THISFORM.TXTF35.VISIBLE=!EMPTY(A02.F10)   &&判斷有無處理成本的權限
       THISFORM.TXTF36.VISIBLE=!EMPTY(A02.F10)   &&判斷有無處理成本的權限
       THISFORM.TXTF37.VISIBLE=!EMPTY(A02.F10)   &&判斷有無處理成本的權限
       THISFORM.TXTF38.VISIBLE=!EMPTY(A02.F10)   &&判斷有無處理成本的權限
*!*	       THISFORM.TXTF99.VISIBLE=!EMPTY(A02.F11)   &&判斷有無處理總號的權限
       THISFORM.CHG_BOTT.ENABLED=!EMPTY(A02.F09)         
       THISFORM.SHRGROUP.VISIBLE=.F.
       THISFORM.SHRGROUP.ENABLED=.F.
       THISFORM.CHGGROUP.VISIBLE=.F.
       THISFORM.CHGGROUP.ENABLED=.F.
       THISFORM.ORPGROUP.PNT_BOTT.CAPTION='轉EXCEL'
       THISFORM.MT_TYPE.ENABLED=.F.
       THISFORM.MT_TYPE.VISIBLE=.F.
       THISFORM.SETALL('HEIGHT',INT_015*25,'TEXTBOX')
       THISFORM.SETALL('HEIGHT',INT_015*17,'LABEL')
       THISFORM.SETALL('FONTSIZE',INT_015*9,'TEXTBOX')
       THISFORM.SETALL('FONTSIZE',INT_015*9,'LABEL')        
       THISFORM.SETALL('FONTSIZE',INT_015*9,'COMMANDBUTTON')       
       THISFORM.SETALL('READONLY',.T.,'TEXTBOX')
       THISFORM.GRID1.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)
       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*149
       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*288
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'COLUMN')
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'HEADER')         
       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='品               號'
	   THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='品名規格'
	   THISFORM.GRID1.COLUMN1.CONTROLSOURCE='B01.F01'
	   THISFORM.GRID1.COLUMN2.CONTROLSOURCE='B01.F02'
       THISFORM.GRID1.READONLY=.T.       
       THISFORM.GRID1.SETFOCUS
       IF THISFORM.GRID1.ACTIVEROW=0
            THISFORM.CMDGROUP.ENABLED=.F.
            THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
            THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
            THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.            
            THISFORM.SETALL('VALUE','','TEXTBOX')
            THISFORM.LBLF071.CAPTION=''
            THISFORM.LBLF211.CAPTION=''       
            THISFORM.LBLF301.CAPTION=''
            THISFORM.LBLF341.CAPTION=''
            THISFORM.LBLF391.CAPTION=''
         ELSE
            THISFORM.CMDGROUP.ENABLED=.T.         
            THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  &&判斷有無修改的權限
            THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)   &&判斷有無刪除的權限
            THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限                       
       ENDIF
       JK='品        號'
  ENDPROC     
  PROCEDURE MT_TYPE.INIT
      WITH THIS 
           .ADDITEM('外購原料')
           .ADDITEM('在製組件')
           .ADDITEM('買賣商品')
           .ADDITEM('自產銷售')
           .ADDITEM('間接材料')
           .ADDITEM('虛擬料號')                      
           .ADDITEM('無須定義')
           .ADDITEM('樣品製作')
       ENDWITH   
  ENDPROC     
  PROCEDURE TXTF07.INTERACTIVECHANGE
    IF AT('?',ALLTRIM(THIS.VALUE))<>0
       IF AT('?',ALLTRIM(THIS.VALUE))>1             
          SELECT F01,F02 FROM A14 INTO CURSOR DEPART ORDER BY F01 WHERE LEFT(F01,AT('?',THIS.VALUE)-1)=LEFT(THIS.VALUE,AT('?',THIS.VALUE)-1) AND LEN(ALLTRIM(F01))=4 AND F04='*'
       ELSE
          SELECT F01,F02 FROM A14 INTO CURSOR DEPART ORDER BY F01 WHERE LEN(ALLTRIM(F01))=4 AND F04='*'
       ENDIF   
       DEPART_SEEK=CREATEOBJECT("DEPART_SEEK")  
       DEPART_SEEK.SHOW    
       THIS.VALUE=FLG
       THIS.REFRESH
       FLG='0'
    ENDIF   
       THISFORM.LBLF071.CAPTION=IIF(SEEK(THIS.VALUE,'A14'),A14.F02,'')  
  ENDPROC
  
  PROCEDURE TXTF10.VALID
    LPARAMETERS  NINDEX
    IF THIS.VALUE>=THISFORM.TXTF11.VALUE
       NINDEX=.T.
    ELSE
       =MESSAGEBOX("庫存上限不得小於安全存量",0+64,"提示視窗")    
       NINDEX=.F.
    ENDIF
    RETURN NINDEX
  ENDPROC        
  PROCEDURE TXTF11.VALID
    LPARAMETERS  NINDEX
    IF THIS.VALUE<=THISFORM.TXTF10.VALUE
       NINDEX=.T.
    ELSE
       =MESSAGEBOX("安全存量不得大於庫存上限",0+64,"提示視窗")    
       NINDEX=.F.
    ENDIF
    RETURN NINDEX
  ENDPROC          
  PROCEDURE TXTF26.VALID
    LPARAMETERS  NINDEX
    IF ALLTRIM(THIS.VALUE)='Y'.OR. ALLTRIM(THIS.VALUE)='N'
       NINDEX=.T.
    ELSE
       =MESSAGEBOX("請輸入'Y'代表此料進貨時需做檢驗','N'代表進貨時直接入庫'!",0+64,"提示視窗")    
       NINDEX=.F.
    ENDIF
    RETURN NINDEX
  ENDPROC        
  PROCEDURE TXTF97.VALID
    LPARAMETERS  NINDEX
    IF ALLTRIM(THIS.VALUE)='Y' .OR. ALLTRIM(THIS.VALUE)='N'
       IF THISFORM.TXTF39.VALUE='C' AND THIS.VALUE='Y'
          =MESSAGEBOX("領料類別為'C'即表示包材類別之材料故無需建BOM,所以此欄請設為'N'或是更改領料類別後再修正!",0+48,"提示視窗")    
          THIS.VALUE='N'         
       ENDIF   
       NINDEX=.T.
    ELSE
       =MESSAGEBOX("請輸入'Y'代表需建BOM,'N'則表示純部品或買賣品!",0+64,"提示視窗")    
       NINDEX=.F.
    ENDIF
    RETURN NINDEX
  ENDPROC          
  PROCEDURE TXTF30.VALID
    LPARAMETERS  NINDEX
    IF ALLTRIM(THIS.VALUE)='M' .OR. ALLTRIM(THIS.VALUE)='R' .OR. ALLTRIM(THIS.VALUE)='J'
       NINDEX=.T.
    ELSE
       =MESSAGEBOX("請輸入'M'代表'以MRP計算需求','R'代表'採購點計算需求'!",0+64,"提示視窗")    
       NINDEX=.F.
    ENDIF
    RETURN NINDEX
  ENDPROC  
  PROCEDURE TXTF30.INTERACTIVECHANGE
    THISFORM.LBLF301.CAPTION=IIF(THIS.VALUE='M','MRP','採購點')        
  ENDPROC  
  PROCEDURE TXTF39.VALID
    LPARAMETERS  NINDEX
    IF ALLTRIM(THIS.VALUE)='A' .OR. ALLTRIM(THIS.VALUE)='B' .OR. ALLTRIM(THIS.VALUE)='C' 
       IF THISFORM.TXTF97.VALUE='Y' AND ALLTRIM(THIS.VALUE)='C'
          =MESSAGEBOX("是否展開設為'Y'者(表示需建BOM),領料類別不得設為'C'!",0+48,"提示視窗")    
          THIS.VALUE='A'
       ENDIF
       NINDEX=.T.         
    ELSE
       =MESSAGEBOX("請輸入'A'代表可以個別計數領料,'B'代表必須計量或整批領料!,'C'代表包材或模具類需以分母為基數",0+48,"提示視窗")    
       NINDEX=.F.
    ENDIF
    RETURN NINDEX
  ENDPROC            
  PROCEDURE TXTF39.INTERACTIVECHANGE
    THISFORM.LBLF391.CAPTION=ICASE(THIS.VALUE='A','個別領料',THIS.VALUE='B','整批領料','整套領料')        
  ENDPROC    
  PROCEDURE TXTF34.INTERACTIVECHANGE
    IF AT('?',ALLTRIM(THIS.VALUE))<>0
       IF AT('?',ALLTRIM(THIS.VALUE))>1             
          SELECT F01,F03 FROM A01 INTO CURSOR MAN ORDER BY F01 WHERE LEFT(F01,AT('?',THIS.VALUE)-1)=LEFT(THIS.VALUE,AT('?',THIS.VALUE)-1) NOWAIT
       ELSE
          SELECT F01,F03 FROM A01 INTO CURSOR MAN ORDER BY F01 NOWAIT  
       ENDIF   
       MAN_SEEK=CREATEOBJECT("MAN_SEEK")  
       MAN_SEEK.SHOW    
       THIS.VALUE=FLG
       THIS.REFRESH
       FLG='0'
    ENDIF   
       THISFORM.LBLF341.CAPTION=IIF(SEEK(THIS.VALUE,'A01'),A01.F03,'')  
  ENDPROC

  PROC KEY_LIST.INIT 
       WITH THIS 
           .ADDITEM('依品料編號排列')
           .ADDITEM('依品名規格排列')
           .ADDITEM('依流水總號排列')
           .ADDITEM('依系列別排列')
       ENDWITH      
  ENDPROC 
  PROC KEY_LIST.INTERACTIVECHANGE
       SELE B01
       DO CASE
          CASE THIS.DISPLAYVALUE='依品料編號排列'
               SET ORDER TO B011          
               THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='品               號'
               THISFORM.GRID1.COLUMN1.CONTROLSOURCE='B01.F01'
               THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='品名規格'
               THISFORM.GRID1.COLUMN2.CONTROLSOURCE='B01.F02'
		       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*149
		       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*288               
          CASE THIS.DISPLAYVALUE='依品名規格排列'
               SET ORDER TO B012          
               THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='品名規格'          
               THISFORM.GRID1.COLUMN1.CONTROLSOURCE='B01.F02'
               THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='品               號'
               THISFORM.GRID1.COLUMN2.CONTROLSOURCE='B01.F01'     
		       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*288
		       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*149                  
          CASE THIS.DISPLAYVALUE='依流水總號排列'
               SET ORDER TO B013         
               THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='總        號'          
               THISFORM.GRID1.COLUMN1.CONTROLSOURCE='B01.F99'
               THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='品               號'
               THISFORM.GRID1.COLUMN2.CONTROLSOURCE='B01.F01'    
		       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*70
		       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*149           
          CASE THIS.DISPLAYVALUE='依系列別排列'
               SET ORDER TO B014         
               THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='系列別'          
               THISFORM.GRID1.COLUMN1.CONTROLSOURCE='B01.F41'
               THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='品               號'
               THISFORM.GRID1.COLUMN2.CONTROLSOURCE='B01.F01'    
		       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*70
		       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*149           		                                      
       ENDCASE   
       JK=THISFORM.GRID1.COLUMN1.HEADER1.CAPTION       
       THISFORM.GRID1.SETFOCUS
  ENDPROC
  PROC GRID1.AFTERROWCOLCHANGE
       LPARAMETERS NCOLINDEX
       SELECT B01
       THISFORM.TXTF01.VALUE=F01
       THISFORM.TXTF49.VALUE=F49
       THISFORM.TXTF02.VALUE=F02
       THISFORM.TXTF29.VALUE=F29
       THISFORM.TXTF06.VALUE=F06
       THISFORM.TXTF98.VALUE=MTP(F98)
*!*	       DO CASE
*!*	          CASE F98='*  '
*!*	               THISFORM.TXTF98.VALUE='外購原料'
*!*	          CASE F98=' * '
*!*	               THISFORM.TXTF98.VALUE='在製組件'               
*!*	          CASE F98='* *'
*!*	               THISFORM.TXTF98.VALUE='買賣商品'               
*!*	          CASE F98=' **'
*!*	               THISFORM.TXTF98.VALUE='自產銷售'                              
*!*	          CASE F98='***'
*!*	               THISFORM.TXTF98.VALUE='無須定義'
*!*	          CASE F98='   '
*!*	               THISFORM.TXTF98.VALUE='虛擬料號'
*!*	          CASE F98='A'
*!*	               THISFORM.TXTF98.VALUE='間接材料'     
*!*	          CASE F98='S'
*!*	               THISFORM.TXTF98.VALUE='樣品製作'                    
*!*	       ENDCASE                                      
       THISFORM.TXTF03.VALUE=F03
       THISFORM.TXTF04.VALUE=F04
       THISFORM.TXTF05.VALUE=F05
       THISFORM.TXTF07.VALUE=F07
       THISFORM.TXTF34.VALUE=F34
       THISFORM.TXTF10.VALUE=F10
       THISFORM.TXTF11.VALUE=F11
       THISFORM.TXTF13.VALUE=ALTU(B01.F01) &&B11.F04
       THISFORM.TXTF22.VALUE=IQC_QTY(B01.F01)
       THISFORM.TXTF97.VALUE=F97
       THISFORM.TXTF26.VALUE=F26
       THISFORM.TXTF28.VALUE=F28
       THISFORM.TXTF31.VALUE=F31
       THISFORM.TXTF30.VALUE=F30
       THISFORM.TXTCMT.VALUE=B0A.F02
       THISFORM.TXTFDT.VALUE=B0A.F03
       THISFORM.TXTF39.VALUE=F39
       THISFORM.TXTF41.VALUE=F41
       THISFORM.TXTF42.VALUE=F42
       THISFORM.TXTF43.VALUE=F43
*!*	       THISFORM.TXTF35.VALUE=F35
       THISFORM.TXTF36.VALUE=F36
       THISFORM.TXTF37.VALUE=F37
       THISFORM.TXTF38.VALUE=F38
       THISFORM.TXTF99.VALUE=F99
       THISFORM.TXTF12.VALUE=ALTT(B01.F01,'0')              
       THISFORM.TXTE08.VALUE=IIF(SEEK(F01,'E08'),ALTT(B01.F01,'1')+E08.F20,ALTT(B01.F01,'1'))
       THISFORM.TXTF205.VALUE=C20.F05
       THISFORM.TXTF206.VALUE=C20.F06
       THISFORM.TXTPK1.VALUE=C20.F03
       THISFORM.TXTPK2.VALUE=C20.F11
       THISFORM.TXTPK3.VALUE=C20.F15
       THISFORM.TXTPK4.VALUE=C20.F16
       THISFORM.LBLF071.CAPTION=A14.F02       
       THISFORM.LBLF211.CAPTION=F21       
       THISFORM.LBLF301.CAPTION=IIF(F30='M','MRP','採購點')
       THISFORM.LBLF341.CAPTION=A01.F03
       THISFORM.LBLF391.CAPTION=ICASE(F39='A','個別領料',F39='B','整批領料','整套領料')
       THISFORM.LBLF491.CAPTION=BILL(F49)
       THISFORM.CHG_BOTT.CAPTION=IIF(EMPTY(THISFORM.TXTCMT.VALUE),'\<M.改用新料','\<R.取消新料')
       FCH=THISFORM.ACTIVECONTROL.NAME
       CHK=''
*       THISFORM.REFRESH
  ENDPROC       
  PROCEDURE ORPGROUP.NEW_BOTT.CLICK    
       THISFORM.ANS_BOTT.ENABLED=.F.
       THISFORM.INV_BOTT.ENABLED=.F.
  
       THISFORM.SETALL('READONLY',.F.,'TEXTBOX')  
       THISFORM.PRODUCTION_PLACE.VISIBLE=.T. 
       THISFORM.TXTF11.READONLY=EMPTY(A02.F08)
       THISFORM.TXTF12.READONLY=.T.
       THISFORM.TXTF13.READONLY=.T.
       THISFORM.TXTF22.READONLY=.T.
       THISFORM.TXTE08.READONLY=.T.
       THISFORM.TXTF99.READONLY=.T.
       THISFORM.TXTCMT.READONLY=.T.
       THISFORM.TXTFDT.READONLY=.T.
       THISFORM.TXTF01.VALUE='' 
       THISFORM.TXTF49.VALUE=LEFT(THISFORM.PRODUCTION_PLACE.DISPLAYVALUE,2)
       THISFORM.TXTF49.VALUE=''    
       THISFORM.LBLF491.CAPTION=BILL(THISFORM.PRODUCTION_PLACE.DISPLAYVALUE)   
       THISFORM.PRODUCTION_PLACE.VALUE=1
       THISFORM.TXTF02.VALUE=''
       THISFORM.TXTF29.VALUE=''
       THISFORM.TXTF06.VALUE='A'
       THISFORM.MT_TYPE.ENABLED=.T.
       THISFORM.MT_TYPE.VISIBLE=.T.
       THISFORM.MT_TYPE.VALUE=3
       THISFORM.TXTF03.VALUE=''
       THISFORM.TXTF04.VALUE=''
       THISFORM.TXTF05.VALUE=1
       THISFORM.TXTF07.VALUE='I000'
       THISFORM.LBLF071.CAPTION=''
       THISFORM.TXTF34.VALUE=''
       THISFORM.LBLF341.CAPTION=''
       THISFORM.TXTF10.VALUE=0
       THISFORM.TXTF11.VALUE=0
       THISFORM.TXTF12.VALUE=0
       THISFORM.TXTF22.VALUE=0
       THISFORM.TXTF13.VALUE=0
       THISFORM.TXTF97.VALUE='N'
       THISFORM.TXTF26.VALUE='N'
       THISFORM.TXTF28.VALUE=0
       THISFORM.TXTF31.VALUE=0
       THISFORM.TXTF30.VALUE='M'
       THISFORM.TXTCMT.VALUE=''
       THISFORM.TXTFDT.VALUE=''
       THISFORM.TXTF39.VALUE='A'
       THISFORM.TXTF41.VALUE=''
       THISFORM.TXTF42.VALUE=''
       THISFORM.TXTF43.VALUE=''
*!*	       THISFORM.TXTF35.VALUE=0
       THISFORM.TXTF36.VALUE=0
       THISFORM.TXTF37.VALUE=0
       THISFORM.TXTF38.VALUE=0
       THISFORM.TXTF98.VALUE='*'
       THISFORM.LBLF211.CAPTION=''
       THISFORM.TXTF01.SETFOCUS()
       THISFORM.GRID1.ENABLED=.F.
       THISFORM.TXTF205.VALUE=''
       THISFORM.TXTF206.VALUE=''
       THISFORM.TXTPK1.VALUE=''
       THISFORM.TXTPK2.VALUE=0
       THISFORM.TXTPK3.VALUE=0
       THISFORM.TXTPK4.VALUE=''
       SELECT A09
       SEEK 'B000 '
       IF FOUND()
       	  THISFORM.TXTF99.VALUE = PADL(ALLTRIM(STR(INT(VAL(ALLTRIM(A09.F08))) + 1)),8,'0')
       ELSE
       	  THISFORM.TXTF99.VALUE = '00000001'
       ENDIF
       FLG='1'
  ENDPROC  
  PROCEDURE ORPGROUP.EDIT_BOTT.CLICK
     THISFORM.ANS_BOTT.ENABLED=.F.
     THISFORM.INV_BOTT.ENABLED=.F.

     THISFORM.TXTF01.READONLY=.T.
     THISFORM.PRODUCTION_PLACE.VISIBLE=.T.
    * THISFORM.LBLF491.LEFT=INT_015*680
     THISFORM.TXTF11.READONLY=EMPTY(A02.F08)
     THISFORM.TXTF12.READONLY=.T.
     THISFORM.TXTF13.READONLY=.T.
     THISFORM.TXTE08.READONLY=.T.
*!*	     THISFORM.TXTF99.READONLY=EMPTY(A02.F11)   &&判斷有無處理總號的權限
	 THISFORM.TXTF99.READONLY=.T.
	 THISFORM.TXTCMT.READONLY=.T.
	 THISFORM.TXTCMT.READONLY=.T.
     THISFORM.MT_TYPE.ENABLED=.T.
     THISFORM.MT_TYPE.VISIBLE=.T. 
     THISFORM.MT_TYPE.DISPLAYVALUE=THISFORM.TXTF98.VALUE    
     THISFORM.TXTF22.READONLY=.T.
     THISFORM.PRODUCTION_PLACE.DISPLAYVALUE=THISFORM.TXTF49.VALUE+BILL(THISFORM.TXTF49.VALUE)
     THISFORM.GRID1.ENABLED=.F.
     THISFORM.TXTF02.SETFOCUS
     LOCK()
     IF !RLOCK()
        DO FILE_IMPACT
        THISFORM.SHRGROUP.ABANDON_BOTT.CLICK            
     *   RETURN
     ENDIF
  ENDPROC 
  PROCEDURE ORPGROUP.DEL_BOTT.CLICK
      IF MESSAGEBOX('是否確定要刪除此筆資料',4+32+256,'請確認') = 6	
     
         SELECT B0A
         SEEK B01.F01
         IF FOUND()
	        =MESSAGEBOX('此料號有代用之新料請先取消後再刪除',0+64,'注意')
	        SELE B01
	        RETURN
	     ENDIF  
             SELE C02   
	     SEEK B01.F01
	     IF FOUND()
	        =MESSAGEBOX('此料號在C02報價資料中已有報價資料,無法刪除',0+64,'注意')
	        SELE B01
	        RETURN
	     ENDIF  
	         SELE C05   
	     SEEK B01.F01
	     IF FOUND()
	        =MESSAGEBOX('目前的出貨計劃中已有此料號,無法刪除',0+64,'注意')
	        SELE B01
	        RETURN
	     ENDIF  
             SELE D02   
	     SEEK B01.F01
	     IF FOUND()
	        =MESSAGEBOX('此料號在D02.詢價資料中已有詢價資料,無法刪除',0+64,'注意')
	        SELE B01
	        RETURN
	     ENDIF  
             SELE D07   
	     SEEK B01.F01
	     IF FOUND()
	         =MESSAGEBOX('目前的進貨計劃中已有此料號,無法刪除',0+64,'注意')
	        SELE B01
	        RETURN
	     ENDIF   
             SELE P02   
	     SEEK B01.F01
	     IF FOUND()
	        =MESSAGEBOX('此料號在P02.外購詢價資料中已有詢價資料,無法刪除',0+64,'注意')
	        SELE B01
	        RETURN
	     ENDIF 
	     SELE F01   
	     SEEK B01.F01
	     IF FOUND()
	        =MESSAGEBOX('請先刪除 BOM資料',0+64,'注意')
	        SELE B01
	        RETURN
	     ENDIF
	      SELE F02   
	     SEEK B01.F01
	     IF FOUND()
	        =MESSAGEBOX('F02.各階組成表中已有此料號,無法刪除',0+64,'注意')
	        SELE B01
	        RETURN
	     ENDIF   
        IF THISFORM.TXTE08.VALUE<>0
           =MESSAGEBOX('仍有MRP數據無法刪除!',0+64,'注意')
           RETURN
        ENDIF         
        SELE B01
        IF ALTT(B01.F01,'0')<>0
            =MESSAGEBOX('仍有庫存帳無法刪除此筆資料',0+48,'注意')
            RETURN
        ENDIF    
        RLOCK()
        IF RLOCK()        
            SELECT C20
            SEEK THISFORM.TXTF01.VALUE
            IF FOUND()
                DELETE 
            ENDIF
           DELE FROM B25 WHERE B25.F02=B01.F01
           DELE FROM B11 WHERE B11.F03=B01.F01            
           SELE B01
           DELE
           UNLOCK
           SKIP -1
           IF BOF()
              GO TOP
           ENDIF   
        ELSE
          DO FILE_IMPACT    
        ENDIF        
        THISFORM.GRID1.SETFOCUS
        IF THISFORM.GRID1.ACTIVEROW=0
            THISFORM.CMDGROUP.ENABLED=.F.
            THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
            THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
            THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.            
            THISFORM.SETALL('VALUE','','TEXTBOX')
            THISFORM.LBLF071.CAPTION=''
            THISFORM.LBLF211.CAPTION=''       
            THISFORM.LBLF301.CAPTION=''
            THISFORM.LBLF341.CAPTION=''
            THISFORM.LBLF391.CAPTION=''
         ELSE
            THISFORM.CMDGROUP.ENABLED=.T.         
            THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  &&判斷有無修改的權限
            THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)   &&判斷有無刪除的權限
            THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限                
        ENDIF
     ENDIF   
  ENDPROC
  **
  PROCEDURE SHRGROUP.SHURE1_BOTT.CLICK
    IF LEFT(THISFORM.TXTF01.VALUE,1)=SPACE(1)
       =MESSAGEBOX('品號第一位元不得空白!',0+64,'提示視窗')
       THISFORM.TXTF01.SETFOCUS
       RETURN
    ENDIF 
    IF INDEXSEEK(THISFORM.TXTF01.VALUE,.F.,'B01','B011')=.T.
       =MESSAGEBOX('此料號已經建立!',0+64,'請注意')
       THISFORM.TXTF01.VALUE=''
       THISFORM.TXTF01.SETFOCUS  
       RETURN
    ENDIF
    IF EMPTY(THISFORM.TXTF02.VALUE)
       =MESSAGEBOX('品名不得空白!',0+64,'提示視窗')
       THISFORM.TXTF02.SETFOCUS
       RETURN
    ENDIF       
    IF SEEK(THISFORM.TXTF07.VALUE,'A14')=.F. .OR. EMPTY(THISFORM.TXTF07.VALUE)
       =MESSAGEBOX("請務必輸入正確之保管部門編號!",0+64,"忘記編號可在空格內打'?'查詢")    
       THISFORM.TXTF07.SETFOCUS
       RETURN
    ENDIF   
    IF EMPTY(THISFORM.TXTF99.VALUE)
       =MESSAGEBOX('總號不得空白!',0+64,'提示視窗')
       THISFORM.TXTF99.SETFOCUS
       RETURN
    ENDIF    
    IF LEN(ALLTRIM(THISFORM.TXTF99.VALUE)) < 8
       =MESSAGEBOX('總號長度需八碼!',0+64,'提示視窗')
       THISFORM.TXTF99.SETFOCUS
       RETURN
    ENDIF       
    IF INDEXSEEK(THISFORM.TXTF99.VALUE,.F.,'B01','B013')=.T.
       =MESSAGEBOX('此總號已存在,請洽系統管理人員!',0+64,'請注意')
       THISFORM.TXTF99.SETFOCUS  
       RETURN
    ENDIF    
    SELE B01
    APPEND BLANK
    RLOCK()
    IF RLOCK()
       REPLACE F01 WITH THISFORM.TXTF01.VALUE
       REPLACE F02 WITH ALLTRIM(THISFORM.TXTF02.VALUE)
       REPLACE F03 WITH THISFORM.TXTF03.VALUE
       REPLACE F04 WITH THISFORM.TXTF04.VALUE
       REPLACE F05 WITH THISFORM.TXTF05.VALUE
       REPLACE F06 WITH THISFORM.TXTF06.VALUE
       REPLACE F07 WITH THISFORM.TXTF07.VALUE
       REPLACE F10 WITH THISFORM.TXTF10.VALUE
       REPLACE F11 WITH THISFORM.TXTF11.VALUE
       REPLACE F21 WITH IIF(INT_012=1,PADL(ALLTRIM(STR(YEAR(DATE())-1911)),3,' ')+RIGHT(DTOC(DATE()),6),dtoc(DATE())+' ')+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
       REPLACE F26 WITH THISFORM.TXTF26.VALUE
       REPLACE F28 WITH THISFORM.TXTF28.VALUE
       REPLACE F29 WITH THISFORM.TXTF29.VALUE
       REPLACE F30 WITH THISFORM.TXTF30.VALUE
       REPLACE F31 WITH THISFORM.TXTF31.VALUE
       REPLACE F34 WITH THISFORM.TXTF34.VALUE
*!*	       REPLACE F35 WITH THISFORM.TXTF35.VALUE
       REPLACE F36 WITH THISFORM.TXTF36.VALUE
       REPLACE F37 WITH THISFORM.TXTF37.VALUE
       REPLACE F38 WITH THISFORM.TXTF38.VALUE
       REPLACE F39 WITH THISFORM.TXTF39.VALUE
       REPLACE F41 WITH THISFORM.TXTF41.VALUE
       REPLACE F42 WITH THISFORM.TXTF42.VALUE
       REPLACE F43 WITH THISFORM.TXTF43.VALUE
       REPLACE F49 WITH LEFT(THISFORM.PRODUCTION_PLACE.DISPLAYVALUE,2)
       REPLACE F97 WITH THISFORM.TXTF97.VALUE
       DO CASE
          CASE THISFORM.MT_TYPE.DISPLAYVALUE='外購原料'
               THISFORM.TXTF98.VALUE='*  '       
          CASE THISFORM.MT_TYPE.DISPLAYVALUE='在製組件'
               THISFORM.TXTF98.VALUE=' * '
          CASE THISFORM.MT_TYPE.DISPLAYVALUE='買賣商品'
               THISFORM.TXTF98.VALUE='* *'
          CASE THISFORM.MT_TYPE.DISPLAYVALUE='自產銷售'
               THISFORM.TXTF98.VALUE=' **'
          CASE THISFORM.MT_TYPE.DISPLAYVALUE='無須定義'
               THISFORM.TXTF98.VALUE='***'
          CASE THISFORM.MT_TYPE.DISPLAYVALUE='虛擬料號'
               THISFORM.TXTF98.VALUE=''
          CASE THISFORM.MT_TYPE.DISPLAYVALUE='間接材料'
               THISFORM.TXTF98.VALUE='A'    
          CASE THISFORM.MT_TYPE.DISPLAYVALUE='樣品製作'
               THISFORM.TXTF98.VALUE='S'                   
       ENDCASE       
       REPLACE F98 WITH THISFORM.TXTF98.VALUE
       REPLACE F99 WITH THISFORM.TXTF99.VALUE
       IF !EMPTY(THISFORM.TXTPK1.VALUE) OR THISFORM.TXTPK2.VALUE<>0 OR THISFORM.TXTPK3.VALUE<>0 OR !EMPTY(THISFORM.TXTPK4.VALUE) OR !EMPTY(THISFORM.TXTF205.VALUE) OR !EMPTY(THISFORM.TXTF206.VALUE)
            SELECT C20
            APPEND BLANK
            REPLACE F01 WITH THISFORM.TXTF01.VALUE
            REPLACE F03 WITH ALLTRIM(THISFORM.TXTPK1.VALUE)
            REPLACE F04 WITH ICASE(B01.F49='J ','JAPAN',B01.F49='B ','BELGIUM',B01.F49='C ','U.S.A.',B01.F49='F ','FRANCE',B01.F49='G ','CHINA',B01.F49='Q ','KOREA',B01.F49='W ','INDONESIA',B01.F49='Z ','JAPAN',B01.F49='D ','MALAYSIA',B01.F49='E ','UK','')
            REPLACE F05 WITH THISFORM.TXTF205.VALUE
            REPLACE F06 WITH THISFORM.TXTF206.VALUE
            REPLACE F11 WITH THISFORM.TXTPK2.VALUE
            REPLACE F15 WITH THISFORM.TXTPK3.VALUE
            REPLACE F16 WITH THISFORM.TXTPK4.VALUE
            REPLACE F99 WITH IIF(INT_012=1,PADL(ALLTRIM(STR(YEAR(DATE())-1911)),3,' ')+RIGHT(DTOC(DATE()),6),dtoc(DATE())+' ')+IIF(SEEK(sys_oper,'A01'),A01.F03,'')       
       ENDIF
    ENDIF
    UNLOCK  
    SELECT A09
    SEEK 'B000 '
    IF FOUND()
       REPLACE A09.F08 WITH THISFORM.TXTF99.VALUE
    ELSE
       SELECT A09
       APPEND BLANK 
       REPLACE A09.F01 WITH 'B000 '
       REPLACE A09.F06 WITH '基本料號主檔流水總號'
       REPLACE A09.F08 WITH THISFORM.TXTF99.VALUE
    ENDIF
    SELECT B01
    THISFORM.REC_COUNT.CAPTION=STR(RECCOUNT())  
*    SELE B01
*    SET ORDER TO 1
*    SEEK THISFORM.TXTF01.VALUE  
    THISFORM.GRID1.ENABLED=.T.
    THISFORM.REFRESH 
    THISFORM.GRID1.SETFOCUS   
    THISFORM.ORPGROUP.NEW_BOTT.CLICK            
  ENDPROC
  PROCEDURE SHRGROUP.SHURE2_BOTT.CLICK
    IF SEEK(THISFORM.TXTF07.VALUE,'A14')=.F.
       =MESSAGEBOX("請務必輸入正確之保管部門編號!",0+64,"忘記編號可在空格內打'?'查詢")    
       THISFORM.TXTF07.SETFOCUS
       RETURN
    ENDIF 
*!*	    IF EMPTY(THISFORM.TXTF99.VALUE)
*!*	       =MESSAGEBOX('總號不得空白!',0+64,'提示視窗')
*!*	       THISFORM.TXTF99.SETFOCUS
*!*	       RETURN
*!*	    ENDIF    
*!*	    IF LEN(ALLTRIM(THISFORM.TXTF99.VALUE)) < 8
*!*	       =MESSAGEBOX('總號長度需八碼!',0+64,'提示視窗')
*!*	       THISFORM.TXTF99.SETFOCUS
*!*	       RETURN
*!*	    ENDIF     
*!*	    IF B01.F99 <> THISFORM.TXTF99.VALUE
*!*	       IF INDEXSEEK(THISFORM.TXTF99.VALUE,.F.,'B01','B013')=.T.
*!*	          =MESSAGEBOX('此總號已存在,請洽系統管理人員!',0+64,'請注意')
*!*	          THISFORM.TXTF99.SETFOCUS  
*!*	          RETURN
*!*	       ENDIF   
*!*	    ENDIF      
    SELE B01
    IF RLOCK()
       REPLACE F02 WITH ALLTRIM(THISFORM.TXTF02.VALUE)
       REPLACE F03 WITH THISFORM.TXTF03.VALUE
       REPLACE F04 WITH THISFORM.TXTF04.VALUE
       REPLACE F05 WITH THISFORM.TXTF05.VALUE
       REPLACE F06 WITH THISFORM.TXTF06.VALUE
       REPLACE F07 WITH THISFORM.TXTF07.VALUE
       REPLACE F10 WITH THISFORM.TXTF10.VALUE
       REPLACE F11 WITH THISFORM.TXTF11.VALUE
       REPLACE F21 WITH IIF(INT_012=1,PADL(ALLTRIM(STR(YEAR(DATE())-1911)),3,' ')+RIGHT(DTOC(DATE()),6),dtoc(DATE())+' ')+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
       REPLACE F26 WITH THISFORM.TXTF26.VALUE
       REPLACE F28 WITH THISFORM.TXTF28.VALUE
       REPLACE F29 WITH THISFORM.TXTF29.VALUE
       REPLACE F30 WITH THISFORM.TXTF30.VALUE
       REPLACE F31 WITH THISFORM.TXTF31.VALUE
       REPLACE F34 WITH THISFORM.TXTF34.VALUE
*!*	       REPLACE F35 WITH THISFORM.TXTF35.VALUE
       REPLACE F36 WITH THISFORM.TXTF36.VALUE
       REPLACE F37 WITH THISFORM.TXTF37.VALUE
       REPLACE F38 WITH THISFORM.TXTF38.VALUE
       REPLACE F39 WITH THISFORM.TXTF39.VALUE
       REPLACE F41 WITH THISFORM.TXTF41.VALUE
       REPLACE F42 WITH THISFORM.TXTF42.VALUE
       REPLACE F43 WITH THISFORM.TXTF43.VALUE
       IF B01.F49<>LEFT(THISFORM.PRODUCTION_PLACE.DISPLAYVALUE,2)
           MAIL_TEXT =  '料品編號：' + B01.F01 + CHR(13) + CHR(10) ;     	        		   
     	        		+'產        地：' +B01.F49+BILL(B01.F49)+'  ＞＞  '+THISFORM.PRODUCTION_PLACE.DISPLAYVALUE+ CHR(13) + CHR(10)      	
     	  DIMENSION STAFFS(15)
     	  STAFFS(1)='LULU'
     	  STAFFS(2)='TERES'
     	  STAFFS(3)='13579'
     	  STAFFS(4)='JAY'
     	  STAFFS(5)='TONY'
     	  STAFFS(6)='LEE'
     	  STAFFS(7)='ERLIN'
     	  STAFFS(8)='10069'
     	  STAFFS(9)='LISA'
     	  STAFFS(10)='JENNY'
     	  STAFFS(11)='KOALA'
     	  STAFFS(12)='TSENG'
     	  STAFFS(13)='JNEYANG'
     	  STAFFS(14)='MICHAELLEE'    
     	  STAFFS(15)='JUDY' 		
     	  FOR I=1 TO 15        	
     	      FILE_NAME=ALLTRIM(INT_DAT)+STAFFS(I)+'.TXT'                  
             STRTOFILE('<TR><TD>'+MAIL_TEXT+'<TD>已變更產地<TD>'+TTOC(DATETIME())+ CHR(13) + CHR(10),FILE_NAME,1)     
          ENDFOR   
            		
       ENDIF
       REPLACE F49 WITH LEFT(THISFORM.PRODUCTION_PLACE.DISPLAYVALUE,2)
       REPLACE F97 WITH THISFORM.TXTF97.VALUE
       DO CASE
          CASE THISFORM.MT_TYPE.DISPLAYVALUE='外購原料'
               THISFORM.TXTF98.VALUE='*  '       
          CASE THISFORM.MT_TYPE.DISPLAYVALUE='在製組件'
               THISFORM.TXTF98.VALUE=' * '
          CASE THISFORM.MT_TYPE.DISPLAYVALUE='買賣商品'
               THISFORM.TXTF98.VALUE='* *'
          CASE THISFORM.MT_TYPE.DISPLAYVALUE='自產銷售'
               THISFORM.TXTF98.VALUE=' **'
          CASE THISFORM.MT_TYPE.DISPLAYVALUE='無須定義'
               THISFORM.TXTF98.VALUE='***'
          CASE THISFORM.MT_TYPE.DISPLAYVALUE='虛擬料號'
               THISFORM.TXTF98.VALUE=''
          CASE THISFORM.MT_TYPE.DISPLAYVALUE='間接材料'
               THISFORM.TXTF98.VALUE='A'     
          CASE THISFORM.MT_TYPE.DISPLAYVALUE='樣品製作'
               THISFORM.TXTF98.VALUE='S'                    
       ENDCASE       
       REPLACE F98 WITH THISFORM.TXTF98.VALUE
*!*	       REPLACE F99 WITH ALLTRIM(THISFORM.TXTF99.VALUE)

       IF !EMPTY(THISFORM.TXTPK1.VALUE) OR THISFORM.TXTPK2.VALUE<>0 OR THISFORM.TXTPK3.VALUE<>0 OR !EMPTY(THISFORM.TXTPK4.VALUE) OR LEFT(B01.F49,2)<>LEFT(THISFORM.PRODUCTION_PLACE.DISPLAYVALUE,2) OR !EMPTY(THISFORM.TXTF205.VALUE) OR !EMPTY(THISFORM.TXTF206.VALUE)
            SELECT C20
            SEEK THISFORM.TXTF01.VALUE
            IF !FOUND()
                APPEND BLANK
                REPLACE F01 WITH THISFORM.TXTF01.VALUE
            ENDIF 
            IF VAL(F03)<>VAL(THISFORM.TXTPK1.VALUE)
               REPLACE F03 WITH ALLTRIM(THISFORM.TXTPK1.VALUE)
            ENDIF
            *IF LEFT(B01.F49,2)<>LEFT(THISFORM.PRODUCTION_PLACE.DISPLAYVALUE,2)
             IF F04<>ICASE(B01.F49='J ','JAPAN',B01.F49='B ','BELGIUM',B01.F49='C ','U.S.A.',B01.F49='F ','FRANCE',B01.F49='G ','CHINA',B01.F49='Q ','KOREA',B01.F49='W ','INDONESIA',B01.F49='Z ','JAPAN',B01.F49='D ','MALAYSIA',B01.F49='E ','UK','')  
               REPLACE F04 WITH ICASE(B01.F49='J ','JAPAN',B01.F49='B ','BELGIUM',B01.F49='C ','U.S.A.',B01.F49='F ','FRANCE',B01.F49='G ','CHINA',B01.F49='Q ','KOREA',B01.F49='W ','INDONESIA',B01.F49='Z ','JAPAN',B01.F49='D ','MALAYSIA',B01.F49='E ','UK','')  
            ENDIF
            IF F05 <>THISFORM.TXTF205.VALUE
               REPLACE F05 WITH THISFORM.TXTF205.VALUE
            ENDIF
            IF F06 <>THISFORM.TXTF206.VALUE
               REPLACE F06 WITH THISFORM.TXTF206.VALUE
            ENDIF
            IF F11<>THISFORM.TXTPK2.VALUE
               REPLACE F11 WITH THISFORM.TXTPK2.VALUE
            ENDIF
            IF F15<>THISFORM.TXTPK3.VALUE   
               REPLACE F15 WITH THISFORM.TXTPK3.VALUE
            ENDIF
            IF F16<>THISFORM.TXTPK4.VALUE   
               REPLACE F16 WITH THISFORM.TXTPK4.VALUE
            ENDIF                   
            REPLACE F99 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')                                 
       ENDIF 
       
                   
    ELSE
      DO FILE_IMPACT
      RETURN   
    ENDIF   
    SELECT B01
    THISFORM.SHRGROUP.ABANDON_BOTT.CLICK    
  ENDPROC   
  PROCEDURE SHRGROUP.ABANDON_BOTT.CLICK
      THISFORM.SHRGROUP.ENABLED=.F.
      THISFORM.SHRGROUP.VISIBLE=.F.      
      THISFORM.ORPGROUP.ENABLED=.T.
      THISFORM.ANS_BOTT.ENABLED=.T.
      THISFORM.INV_BOTT.ENABLED=.T.
     
      THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.)   &&判斷有無新增的權限
      THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  &&判斷有無修改的權限
      THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)   &&判斷有無刪除的權限
      THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限
      THISFORM.ORPGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
      THISFORM.CMDGROUP.ENABLED=.T.
      THISFORM.CMDGROUP.SETALL('ENABLED',.T.,'COMMANDBUTTON')
      THISFORM.CMDGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
      THISFORM.KEY_LIST.ENABLED=.T.      
      THISFORM.MT_TYPE.ENABLED=.F.
      THISFORM.MT_TYPE.VISIBLE=.F.
      THISFORM.LBLF491.LEFT=INT_015*643
      THISFORM.PRODUCTION_PLACE.VISIBLE=.F.
      THISFORM.SETALL('READONLY',.T.,'TEXTBOX')
      UNLOCK ALL   
   *   SELE B01
      THISFORM.GRID1.ENABLED=.T.
      THISFORM.GRID1.SETFOCUS      
  ENDPROC
  PROCEDURE SHRGROUP.FINISH_BOTT.CLICK   
       THISFORM.SHRGROUP.ABANDON_BOTT.CLICK
  ENDPROC   
  PROC ANS_BOTT.CLICK
         THISFORM.CMDGROUP.SETALL('FORECOLOR',RGB(128,128,128),'COMMANDBUTTON')
         THISFORM.ORPGROUP.SETALL('FORECOLOR',RGB(128,128,128),'COMMANDBUTTON')
         THISFORM.ANS_BOTT.FORECOLOR=RGB(128,128,128)
         THISFORM.INV_BOTT.FORECOLOR=RGB(128,128,128)
       SELE F01,F05,F08,F11,F14,F17,F20+ALTT(B01.F01,'1') FROM E08 WHERE F02=B01.F01 INTO CURSOR MRP ORDER BY F01
         AREA1='MRP'
         MRP_SEEK=CREATEOBJECT("MRP_SEEK")  
         MRP_SEEK.SHOW                  
         AREA1='B01'
         THISFORM.CMDGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
         THISFORM.ORPGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
         THISFORM.ANS_BOTT.FORECOLOR=RGB(0,0,0)
         THISFORM.INV_BOTT.FORECOLOR=RGB(0,0,0)         
         THISFORM.GRID1.SETFOCUS
  ENDPROC      
  PROC INV_BOTT.CLICK
         IF !USED('B1A')
            SELECT 0
            USE B1A
         ELSE
            SELECT B1A
         ENDIF
         SET ORDER TO 1      
         THISFORM.CMDGROUP.SETALL('FORECOLOR',RGB(128,128,128),'COMMANDBUTTON')
         THISFORM.ORPGROUP.SETALL('FORECOLOR',RGB(128,128,128),'COMMANDBUTTON')
         THISFORM.ANS_BOTT.FORECOLOR=RGB(128,128,128)
         THISFORM.INV_BOTT.FORECOLOR=RGB(128,128,128)  
         IF !USED('C01')
            SELECT 0
            USE C01
         ELSE
            SELECT C01
         ENDIF
         SET ORDER TO C011      
         SELE B11.F01,B11.F03,A14.F02,B11.F04,B11.F05,B11.F08 FROM B11,A14 WHERE B11.F03=B01.F01 AND A14.F01=B11.F01  INTO CURSOR INV ORDER BY B11.F01
         INV_SEEK=CREATEOBJECT("INV_SEEK")  
         INV_SEEK.SHOW                 
         SELECT C01
         USE 
         SELECT B01 
         AREA1='B01'
         THISFORM.CMDGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
         THISFORM.ORPGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
         THISFORM.ANS_BOTT.FORECOLOR=RGB(0,0,0)
         THISFORM.INV_BOTT.FORECOLOR=RGB(0,0,0)                  
         THISFORM.GRID1.SETFOCUS
  ENDPROC        
  PROCEDURE CHG_BOTT.CLICK
      IF EMPTY(THISFORM.TXTCMT.VALUE)
         THISFORM.GRID1.ENABLED=.F.
         THISFORM.KEY_LIST.ENABLED=.F.
         THISFORM.ORPGROUP.ENABLED=.F.
         THISFORM.CMDGROUP.ENABLED=.F.
         THISFORM.ANS_BOTT.ENABLED=.F.
         THISFORM.INV_BOTT.ENABLED=.F.
         THISFORM.TXTCMT.READONLY=.F.     
         THISFORM.TXTFDT.READONLY=.F.     
         THISFORM.CHGGROUP.VISIBLE=.T.
         THISFORM.CHGGROUP.ENABLED=.T.
    
         THISFORM.TXTFDT.VALUE=DATE()
         THISFORM.TXTCMT.SETFOCUS
      ELSE
         IF MESSAGEBOX('是否確定取消所改用之新料',4+32+256,'請確認') = 6	 
            SELECT B0A
            RLOCK()
            LK1=B0A.F02
            LK2=B01.F01
            IF RLOCK()
               SELECT F04 FROM F02 WHERE F04=LK1
               IF _TALLY>0
                  UPDATE F01 SET F01.F05=.F. WHERE F01.F01=ANY(SELE F01 FROM F02 WHERE F04=LK2)
                  UPDATE F02 SET F02.F04=LK2 WHERE F02.F04=LK1 AND F02.F01<>LK2
                  UPDATE F03 SET F03.F04=LK2 WHERE F03.F04=LK1 AND F03.F01<>LK2
                  UPDATE F06 SET F06.F07=LK2 WHERE F06.F07=LK1 AND F06.F01<>LK2
                  =MESSAGEBOX('請記得再去執行F08 BOM總檢未確認部份',0+48,'務必要做!')               
               ENDIF
               SELECT B0A
               DELETE
               UNLOCK 
               SKIP -1
               IF BOF()
                 GO TOP
               ENDIF               
            ELSE
               DO file_impact
            ENDIF   
         ENDIF   
         UNLOCK ALL
         SELECT B01
         THISFORM.GRID1.SETFOCUS
      ENDIF
  ENDPROC
  PROCEDURE CHGGROUP.INTERACTIVECHANGE
         ORG=THISFORM.TXTF01.VALUE
         IF THIS.VALUE=1
             IF MESSAGEBOX('是否確定要以此新料替換',4+32+256,'請確認') = 6	  
                IF SEEK(THISFORM.TXTCMT.VALUE,'B01','B011') AND LEFT(THISFORM.TXTCMT.VALUE,1)<>SPACE(1) AND THISFORM.TXTCMT.VALUE<>THISFORM.TXTF01.VALUE                  
                   X=SEEK(ORG,'B01','B011')               
                   IF SEEK(THISFORM.TXTF01.VALUE+THISFORM.TXTCMT.VALUE,'B0A','B0A2')        
                     =MESSAGEBOX('已設'+THISFORM.TXTCMT.VALUE+'的新料為'+THISFORM.TXTF01.VALUE+'請確定何者為新料何者為舊料再做新料設定',0+48,'提示訊息視窗')                                                   
                   ELSE
                      SELECT B0A
                      APPEND BLANK
                      REPLACE F01 WITH B01.F01
                      REPLACE F02 WITH THISFORM.TXTCMT.VALUE
                      REPLACE F03 WITH THISFORM.TXTFDT.VALUE
                      SELECT F04 FROM F02 WHERE F04=ORG
                      IF _TALLY>0
                         UPDATE F01 SET F01.F05=.F. WHERE F01.F01=ANY(SELE F01 FROM F02 WHERE F04=ORG)
                         UPDATE F02 SET F02.F04=B0A.F02 WHERE F02.F04=ORG AND F02.F01<>THISFORM.TXTCMT.VALUE
                         UPDATE F03 SET F03.F04=B0A.F02 WHERE F03.F04=ORG AND F03.F01<>THISFORM.TXTCMT.VALUE
                         UPDATE F06 SET F06.F07=B0A.F02 WHERE F06.F07=ORG AND F06.F01<>THISFORM.TXTCMT.VALUE                        
                         =MESSAGEBOX('請記得再去執行F08 BOM總檢未確認部份',0+48,'務必要做!')
                      ENDIF   
                      SELECT B01 
                      X=SEEK(ORG,'B01','B011')
                   ENDIF                      
                ELSE
                      =MESSAGEBOX('所輸入料號錯誤不符合條件!',0+48,'提示訊息視窗')
                     X=SEEK(ORG,'B01','B011')
                ENDIF 
             ENDIF
         ELSE
                 
         ENDIF
      THISFORM.ANS_BOTT.ENABLED=.T.
      THISFORM.INV_BOTT.ENABLED=.T.
    
      THISFORM.GRID1.ENABLED=.T.
      THISFORM.KEY_LIST.ENABLED=.T.
      THISFORM.ORPGROUP.ENABLED=.T.
      THISFORM.CMDGROUP.ENABLED=.T.
      THISFORM.TXTCMT.READONLY=.T.
      THISFORM.TXTFDT.READONLY=.T.
      THIS.VISIBLE=.F.
      THIS.ENABLED=.F.
      SELECT B01
      THISFORM.GRID1.SETFOCUS
  ENDPROC

ENDDEFINE    
************************************************列印程序
PROC PNT_PRC
              ANS_RANGE=CREATEOBJECT("ANS_RANGE")  
   			  ANS_RANGE.SHOW                  
ENDPROC   
************************************************MRP數據
DEFINE CLASS MRP_SEEK AS FORM
  AUTOCENTER=.T.
  CAPTION='       MRP數據瀏覽視窗'+SPACE(40)+'計算週期：'+IIF(INT_005='1','日',IIF(INT_005='2','週','月'))
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*360
  WIDTH=INT_015*800
  FONTSIZE=INT_015*9
  CONTROLBOX=.F.
  BORDERSTYLE=2
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WINDOWTYPE=1
  NAME='MRP_SEEK'
  ADD OBJECT CMDGROUP AS CMDGROUP WITH;      
      TOP=INT_015*328,;
      LEFT=INT_015*570
  ADD OBJECT GRID1 AS GRID WITH;          
      AUTOCENTER=.T.,;
      TOP=INT_015*0,;
      WIDTH=INT_015*800,;      
      HEIGHT=INT_015*330,;  
      ROWHEIGHT=INT_015*18,;
      HEADERHEIGHT=INT_015*18,;   
      HIGHLIGHTROWLINEWIDTH=4,;
      DELETEMARK=.F.,;
      READONLY=.T.,;
      RECORDSOURCETYPE=1,;
      COLUMNCOUNT=7,;            
      NAME='GRID1',;
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;      
      COLUMN3.NAME='COLUMN3',;
      COLUMN4.NAME='COLUMN4',;
      COLUMN5.NAME='COLUMN5',;
      COLUMN6.NAME='COLUMN6',;      
      COLUMN7.NAME='COLUMN7'            
  ADD OBJECT CMND2 AS COMMANDBUTTON WITH;
      LEFT=INT_015*743,;
      TOP=INT_015*333,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;
      CAPTION='\<X.離開',;
      TOOLTIPTEXT='取消此搜尋畫面!快速鍵->ALT+C'
      NAME='CMND2'
  ADD OBJECT LBLF12 AS LABEL WITH;    
      TOP=INT_015*336,;
      LEFT=INT_015*10,;
      WIDTH=INT_015*50,;
      FONTSIZE=INT_015*9,;      
      CAPTION='實際庫存' 
  ADD OBJECT TXTF12 AS TEXTBOX WITH;
      LEFT=INT_015*60,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*118,;
      READONLY=.T.,;
      TOP=INT_015*333,;
      FONTSIZE=INT_015*9,;      
      NAME='TXTF12'      
  ADD OBJECT LBLF22 AS LABEL WITH;    
      TOP=INT_015*336,;
      LEFT=INT_015*386,;
      WIDTH=INT_015*50,;
      FONTSIZE=INT_015*9,;            
      CAPTION='待驗數量' 
  ADD OBJECT TXTF22 AS TEXTBOX WITH;
      LEFT=INT_015*436,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*118,;
      READONLY=.T.,;
      TOP=INT_015*333,;
      FONTSIZE=INT_015*9,;            
      NAME='TXTF22'                  
      PROCEDURE INIT 
         AREA1='MRP' 
         THISFORM.GRID1.READONLY=.T. 
         THISFORM.GRID1.RECORDSOURCE='MRP'         
         THISFORM.CMDGROUP.SEEK_BOTT.VISIBLE=.F.
         THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'COLUMN')
         THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'HEADER')
         THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='日        期'
         THISFORM.GRID1.COLUMN1.WIDTH=INT_015*73
         THISFORM.GRID1.COLUMN1.CONTROLSOURCE='MRP.F01'
         THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='採購在途'
         THISFORM.GRID1.COLUMN2.CONTROLSOURCE='MRP.F05'
         THISFORM.GRID1.COLUMN2.WIDTH=INT_015*118
         THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='預計產出'
         THISFORM.GRID1.COLUMN3.CONTROLSOURCE='MRP.F08'
         THISFORM.GRID1.COLUMN3.WIDTH=INT_015*118
         THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='預計領用'
         THISFORM.GRID1.COLUMN4.CONTROLSOURCE='MRP.F11'
         THISFORM.GRID1.COLUMN4.WIDTH=INT_015*118         
         THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='預計出貨'
         THISFORM.GRID1.COLUMN5.CONTROLSOURCE='MRP.F14'
         THISFORM.GRID1.COLUMN5.WIDTH=INT_015*118                  
         THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='預計損耗'
         THISFORM.GRID1.COLUMN6.CONTROLSOURCE='MRP.F17'
         THISFORM.GRID1.COLUMN6.WIDTH=INT_015*118                  
         THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='最後結餘'
         THISFORM.GRID1.COLUMN7.CONTROLSOURCE='MRP.EXP_7'
         THISFORM.GRID1.COLUMN7.WIDTH=INT_015*118                                    
         THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(MRP.EXP_7<0,RGB(255,0,0),'')","COLUMN")         
         THISFORM.GRID1.COLUMN7.BACKCOLOR=RGB(0,255,255)
         THISFORM.TXTF12.VALUE=ALTT(B01.F01,'1')
         THISFORM.TXTF22.VALUE=IQC_QTY(B01.F01)
         THISFORM.GRID1.SETFOCUS
      ENDPROC
      PROC GRID1.AFTERROWCOLCHANGE
       LPARAMETERS XCOLINDEX     
         FCH=THISFORM.ACTIVECONTROL.NAME  
      ENDPROC 
      PROCEDURE CMND2.CLICK
          THISFORM.RELEASE
      ENDPROC      
ENDDEFINE            
***********************************************轉EXCEL範圍選定
DEFINE CLASS ANS_RANGE AS FORM
  AUTOCENTER=.T.
  CAPTION='請輸入列印資料範圍'
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*110
  WIDTH=INT_015*600
  FONTSIZE=INT_015*9
  MAXBUTTON=.F.
  MINBUTTON=.F.
  MOVABLE=.F.
  CLOSABLE=.F.    
  CONTROLBOX=.F.
  BORDERSTYLE=2
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WINDOWTYPE=1
  NAME='ANS_RANGE'
  ADD OBJECT LABEL1 AS LABEL WITH;
      WIDTH=INT_015*60,;
      HEIGHT=INT_015*25,;
      LEFT=INT_015*25,;
      TOP=INT_015*25,;
      CAPTION='起始料號',;
      NAME='LABEL1'
  ADD OBJECT LABEL2 AS LABEL WITH;
      WIDTH=INT_015*60,;
      HEIGHT=INT_015*25,;
      LEFT=INT_015*321,;
      TOP=INT_015*25,;
      CAPTION='截止料號',;
      NAME='LABEL2'
  ADD OBJECT TEXT1 AS TEXTBOX WITH;
      WIDTH=INT_015*219,;
      TOP=INT_015*19,;
      LEFT=INT_015*85,;
      HEIGHT=INT_015*25,; 
      MAXLENGTH=43,; 
      NAME='TEXT1'
  ADD OBJECT TEXT2 AS TEXTBOX WITH;
      WIDTH=INT_015*219,;
      TOP=INT_015*19,;
      LEFT=INT_015*379,;
      HEIGHT=INT_015*25,;  
      MAXLENGTH=43,;        
      NAME='TEXT2'    
  ADD OBJECT CMND1 AS COMMANDBUTTON WITH;
      LEFT=INT_015*90,;    
      HEIGHT=INT_015*25,;   
      TOP=INT_015*70,;  
      WIDTH=INT_015*50,;
      CAPTION='\<Y.執行',;
      TOOLTIPTEXT='確認所輸入的範圍鍵值!快速鍵->ALT+Y',;
      NAME='CMND1'
  ADD OBJECT CMND2 AS COMMANDBUTTON WITH;
      LEFT=INT_015*215,;
      TOP=INT_015*70,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*50,;
      CAPTION='\<C.取消',;
      TOOLTIPTEXT='取消作業!快速鍵->ALT+C',;
      NAME='CMND2'
  PROCEDURE INIT 
      SELECT B01
      THISFORM.SETALL('FONTSIZE',INT_015*9,'TEXTBOX')
      THISFORM.SETALL('FONTSIZE',INT_015*9,'LABEL')      
      THISFORM.SETALL('FONTSIZE',INT_015*9,'COMMANDBUTTON')                                            
      THISFORM.TEXT1.VALUE=B01.F01
      THISFORM.TEXT2.VALUE=B01.F01     
  ENDPROC    
  PROCEDURE CMND1.CLICK         
        SELECT F01 料品編號,F02 品名規格,F03 採購單位,F04 計料單位,F05 單位換算,F06 管理類別,F07 保管部門,F10 庫存上限,F11 安全存量,ALTU(F01) 在庫數量,F37 平均成本,F39 領料類別,;
	    F26 是否檢驗,F28 採購前置,F97 是否展開,MTP(F98) 歸屬類別,F29 備註,IIF(SEEK(F01,'C20'),C20.F04,'') 產地;
	    ,VAL(IIF(SEEK(F01,'C20'),C20.F03,'')) 包裝基量,IIF(SEEK(F01,'C20'),C20.F11,0) 包裝數量 FROM B01 ORDER BY F01;   
	    WHERE F01>=THISFORM.TEXT1.VALUE AND F01<=THISFORM.TEXT2.VALUE 	   	    	  
	IF _TALLY>0
	     
	      FILENAME='物料基本主檔明細'
		 GCDELIMFILE=PUTFILE('儲存路徑',FILENAME,'XLS')
		 IF !EMPTY(GCDELIMFILE) 
		      ON ERROR DO FILE_IMPACT
		      COPY TO (GCDELIMFILE) TYPE XL5     
		       =MESSAGEBOX('儲存成功',0+64,'提示訊息視窗') 
		  ENDIF     
	    
	     THISFORM.CMND2.CLICK
	ELSE
	     =MESSAGEBOX('無此範圍資料',0+48,'警示')
      	     THISFORM.TEXT1.VALUE=''
      	     THISFORM.TEXT2.VALUE=''	     
	     THISFORM.TEXT1.SETFOCUS
	ENDIF         
  ENDPROC
  PROCEDURE CMND2.CLICK
      THISFORM.RELEASE
  ENDPROC        
ENDDEFINE       
***************************************************特殊輸入欄位設定-----------產地
DEFINE CLASS PRODUCTION_PLACE AS COMBOBOX 
        VISIBLE=.F.
        LEFT=INT_015*609
       TOP=INT_015*23
       HEIGHT=INT_015*25
       WIDTH=INT_015*80
       FONTSIZE=INT_015*9    
       MAXLENGTH=2
       ROWSOURCETYPE=1
       VALUE=1
       STYLE=2
       NAME='PRODUCTION_PLACE'
  *****     
PROCEDURE INIT
DECLARE B01A(20)
Y=0
X=1
STRF='' &&欄位內容
IF SEEK('INT_161','A26')
       PR=A26.F06
ENDIF
FOR I=1 TO LEN(ALLTRIM(PR))
	IF RIGHT(LEFT(ALLTRIM(PR),I),1)=','
	     Y=Y+1
	ENDIF  
ENDFOR	  
 FOR J=1 TO Y
         DO WHILE    RIGHT(LEFT(ALLTRIM(PR),X),1)!=','
                 STRF=STRF+RIGHT(LEFT(ALLTRIM(PR),X),1)
                 X=X+1
         ENDDO
         STORE STRF TO B01A(J)
         X=X+1
         STRF=''
  ENDFOR 
THIS.ADDITEM('') &&多增加一筆空白欄位
FOR K=1 TO  Y
       THIS.ADDITEM(ALLTRIM(B01A(K)))
    ENDFOR
ENDPROC      
*******
   PROCEDURE INTERACTIVECHANGE 	
       THISFORM.TXTF49.VALUE=THIS.DISPLAYVALUE
       THISFORM.TXTF49.REFRESH
       THISFORM.LBLF491.CAPTION=''
  ENDPROC       
ENDDEFINE
********產地別
     FUNC BILL
     PARA JUK
     JO=''
        DECLARE B01A(20)
	Y=0
	X=1
	STRF='' &&欄位內容
	IF SEEK('INT_161','A26')
	       PR=A26.F06
	ENDIF
	FOR I=1 TO LEN(ALLTRIM(PR))
		IF RIGHT(LEFT(ALLTRIM(PR),I),1)=','
		     Y=Y+1
		ENDIF  
	ENDFOR	  
	 FOR J=1 TO Y
	         DO WHILE    RIGHT(LEFT(ALLTRIM(PR),X),1)!=','
	                 STRF=STRF+RIGHT(LEFT(ALLTRIM(PR),X),1)
	                 X=X+1
	         ENDDO
	         STORE STRF TO B01A(J)
	         X=X+1
	         STRF=''
	  ENDFOR 
    JO=IIF(ASCAN(B01A,JUK)=0,'',RIGHT(B01A(ASCAN(B01A,JUK)),LEN(B01A(ASCAN(B01A,JUK)))-2))
    RETURN JO
*********************************產地別英文名稱
FUNCTION ORG_PLACE
   PARAMETERS JAK
   JO=''
   JO=ICASE(JAK='J ','JAPAN',JAK='B ','BELGIUM',JAK='C ','U.S.A.',JAK='F ','FRANCE',JAK='G ','CHINA',JAK='Q ','KOREA',JAK='W ','INDONESIA',JAK='Z ','JAPAN',JAK='D ','MALAYSIA',JAK='E ','UK','')
   RETURN JO
******************************** 計算在庫數量
FUNC ALTU
     PARA KL1
     KL2=0
     SELE B11
     SEEK KL1+B01.F07
     IF FOUND()
        DO WHILE F03+F01=KL1+B01.F07         
              KL2=KL2+F04
           SKIP               
        ENDDO
     ENDIF
     SELE &AREA1
     RETURN KL2               
*****************************  計算待驗數量
FUNC IQC_QTY
     PARA TL3
     TL4=0
     SELE H01
     SEEK  TL3
     IF FOUND()
        DO WHILE F01=B01.F01
           TL4=TL4+F06
           SKIP
        ENDDO
     ENDIF
     SELE &AREA1
     RETURN TL4       

****************************
FUNCTION MTP
 PARAMETERS TTP 
     TPT=''
       DO CASE
          CASE TTP='*  '
               TPT='外購原料'
          CASE TTP=' * '
               TPT='在製組件'               
          CASE TTP='* *'
               TPT='買賣商品'               
          CASE TTP=' **'
               TPT='自產銷售'                              
          CASE TTP='***'
               TPT='無須定義'
          CASE TTP='   '
               TPT='虛擬料號'
          CASE TTP='A'
               TPT='間接材料'     
          CASE TTP='S'
               TPT='樣品製作'                    
       ENDCASE               
       RETURN TPT                  
          