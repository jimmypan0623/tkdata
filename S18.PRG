*********S18.請假作業
CLOSE ALL
CLEAR 
PRG_NO='S18'
FLG='0'
FCH=''
AREA1='S18_1'
CHK='' 
DayCK=0			&&判斷是否超過年度請假數之變數
HK = ''
HD1='S018 '
HD2='SB'
HD3='請假作業'
IF !USED('A01')	&&操作人員資料設定
   SELE 0
   USE A01 INDE A01
ELSE 
   SELE A01
ENDIF
SET ORDER TO A01
IF !USED('A02')	&&權限設定檔
   SELE 0
   USE A02 INDE A02
ELSE 
   SELE A02
ENDIF
SET ORDER TO A021      
SEEK sys_oper+'S18'   
IF !USED('A09')
   SELE 0
   USE A09
ELSE
   SELE A09
ENDIF
SET ORDER TO A091 
IF !USED('A23')	&&月份檔
    SELECT  0
    USE A23
ELSE 
   SELECT  A23
ENDIF
SET ORDER TO A231
A24='A24'+LEFT(DTOS(DATE()),6)     &&單號暫存檔
IF !USED('&A24')
   SELE 0
   USE (A24) ALIA A24
ELSE
   SELE A24
ENDIF
SET ORDER TO 1     
IF !USED('S0A')	&&年度缺勤天數累計
    SELECT  0
    USE S0A 
ELSE
    SELECT  S0A
ENDIF
SET ORDER TO S0A1    
IF !USED('S00')	&&薪資參數設定
   SELE 0
   USE S00 
ELSE
   SELE S00
ENDIF
SET ORDER TO S005 
IF !USED('S05')  &&人事薪資基本檔
   SELE 0
   USE S05 
ELSE
   SELE S05
ENDIF
SET ORDER TO S052
IF !USED('S15')	&&年度假日設定檔
   SELE 0
   USE S15 
ELSE
   SELE S15
ENDIF
SET ORDER TO S151
IF !USED('S18')	&&請假作業檔
   SELE 0
   USE S18
ELSE 
   SELE S18
ENDIF
SET ORDER TO S181  
SELECT * FROM S18 WHERE IIF(A02.F10<>'*',ALLTRIM(S18.F19)=ALLTRIM(sys_oper) OR (S18.F03)=IIF(SEEK(ALLTRIM(sys_oper),'A01'),ALLTRIM(A01.F12),''),.T.) ;
               AND LEFT(ALLTRIM(S18.F02),2) = 'SB' ORDER BY F02 INTO CURSOR S18_1 READWRITE
INDE ON F02 TAG S18_11
INDE ON F03 TAG S18_12
SET ORDER TO S18_11
****
S18FORM=CREATEOBJECT("TKS18")
S18FORM.SHOW  
DEFINE CLASS TKS18 AS FORM
  CAPTION='S18.請假作業'
  CONTROLBOX=.F.
  BORDERSTYLE=1
  MAXBUTTON=.F.
  MINBUTTON=.F.
  MOVABLE=.F.
  CLOSABLE=.F.
  CONTROLCOUNT=57
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*550
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WIDTH=INT_015*791
  WINDOWTYPE=1
  NAME='TKS18'
  ADD OBJECT SHAPE1 AS SHAPE1 WITH;
      AUTOCENTER=.T.
  ADD OBJECT SHAPE2 AS SHAPE2 WITH;
      AUTOCENTER=.T.
  ADD OBJECT SHAPE3 AS SHAPE3 WITH;
      AUTOCENTER=.T.  
  ADD OBJECT ANS_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*490,;
      LEFT=INT_015*15,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*45,;      
      FONTSIZE=INT_015*9,;
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\harrow.cur',;        
      CAPTION='\<A.確認',;
      NAME='ANS_BOTT'                
  ADD OBJECT  INVERSE_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*490,;
      LEFT=INT_015*62,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*50,;      
      FONTSIZE=INT_015*9,;
      CAPTION='\<I.反確認',;
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\harrow.cur',;        
      NAME='INVERSE_BOTT'    
  ADD OBJECT LIST_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*490,;
      LEFT=INT_015*114,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*65,;      
      FONTSIZE=INT_015*9,;
      CAPTION='\<L.列印明細',;
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\harrow.cur',;        
      NAME='LIST_BOTT'      
  ADD OBJECT S16_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*490,;
      LEFT=INT_015*181,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*45,;      
      FONTSIZE=INT_015*9,;
      CAPTION='\<S.出勤',;
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\harrow.cur',;        
      NAME='S16_BOTT'             
  **********                   
  ADD OBJECT LBLF02 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*30,;
      WIDTH=INT_015*50,;
      CAPTION='單據編號'
  ADD OBJECT TXTF02 AS TEXTBOX WITH;      
      VISIBLE=.T.,;
      LEFT=INT_015*295,;
      TOP=INT_015*24,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*80,;
      MAXLENGTH=10,;
      NAME='TXTF02'        
  ADD OBJECT LBLF01 AS LABEL WITH;
      LEFT=INT_015*474,;
      TOP=INT_015*30,;
      WIDTH=INT_015*50,;
      CAPTION='填單日期'
  ADD OBJECT TXTF01 AS TEXTBOX WITH;      
      VISIBLE=.T.,;
      LEFT=INT_015*525,;
      TOP=INT_015*24,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*70,;
      NAME='TXTF01'              
  ADD OBJECT LBLF03 AS LABEL WITH;      
      LEFT=INT_015*244,;
      TOP=INT_015*55,;
      WIDTH=INT_015*50,;
      CAPTION='員工編號'
  ADD OBJECT TXTF03 AS TEXTBOX WITH;
      VISIBLE=.T.,;
      LEFT=INT_015*295,;
      TOP=INT_015*49,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*50,;
      MAXLENGTH=4,;
      NAME='TXTF03'       
 ADD OBJECT COMBOBOX03 AS COMBOBOX03 WITH;      
      VISIBLE=.F.,;
       LEFT=INT_015*295,; 
       TOP=INT_015*49          
  ADD OBJECT LBLF04 AS LABEL WITH;      
      LEFT=INT_015*244,;
      TOP=INT_015*80,;
      WIDTH=INT_015*50,;
      CAPTION='員工姓名'
  ADD OBJECT TXTF04 AS TEXTBOX WITH;
      VISIBLE=.T.,;
      LEFT=INT_015*295,;
      TOP=INT_015*74,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*80,;
      MAXLENGTH=8,;
      NAME='TXTF04'             
  ADD OBJECT LBLF05 AS LABEL WITH;      
      LEFT=INT_015*474,;
      TOP=INT_015*55,;
      WIDTH=INT_015*50,;
      CAPTION='部門編號'
  ADD OBJECT TXTF05 AS TEXTBOX WITH;
      VISIBLE=.T.,;
      LEFT=INT_015*525,;
      TOP=INT_015*49,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*50,;
      MAXLENGTH=4,;
      NAME='TXTF05'             
  ADD OBJECT LBLF06 AS LABEL WITH;      
      LEFT=INT_015*474,;
      TOP=INT_015*80,;
      WIDTH=INT_015*50,;
      CAPTION='部門名稱'
  ADD OBJECT TXTF06 AS TEXTBOX WITH;
      VISIBLE=.T.,;
      LEFT=INT_015*525,;
      TOP=INT_015*74,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*70,;
      MAXLENGTH=8,;
      NAME='TXTF06'     
  ADD OBJECT TXTF07 AS TEXTBOX WITH;	&&假別編號(隱藏)
      VISIBLE=.F.,;
      LEFT=INT_015*295,;
      TOP=INT_015*74,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*50,;
      MAXLENGTH=2,;
      NAME='TXTF07'   
  ADD OBJECT LBLF08 AS LABEL WITH;      
      LEFT=INT_015*244,;
      TOP=INT_015*105,;
      WIDTH=INT_015*50,;
      CAPTION='假別名稱'        
  ADD OBJECT TXTF08 AS TEXTBOX WITH;	
      VISIBLE=.T.,;
      LEFT=INT_015*295,;
      TOP=INT_015*99,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*171,;
      MAXLENGTH=30,;
      NAME='TXTF08'          
 ADD OBJECT COMBOBOX08 AS COMBOBOX08 WITH;      
      VISIBLE=.F.,;
       LEFT=INT_015*295,; 
       TOP=INT_015*99          
  ADD OBJECT LBLF09 AS LABEL WITH;      
      VISIBLE=.F.,;
      LEFT=INT_015*494,;
      TOP=INT_015*105,;
      AUTOSIZE=.T.,;
      BACKCOLOR=RGB(0,255,255),;
      CAPTION='計數單位：'          
  ADD OBJECT TXTF09 AS TEXTBOX WITH;	&&隱藏
      VISIBLE=.F.,;
      LEFT=INT_015*520,;
      TOP=INT_015*99,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*20,;
      MAXLENGTH=1,;
      NAME='TXTF09'            
  ADD OBJECT LBLF10 AS LABEL WITH;      
      LEFT=INT_015*244,;
      TOP=INT_015*130,;
      WIDTH=INT_015*50,;
      CAPTION='起始日期'       
  ADD OBJECT TXTF10 AS TEXTBOX WITH;	
      VISIBLE=.T.,;
      LEFT=INT_015*295,;
      TOP=INT_015*124,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*70,;
      NAME='TXTF10'      
  ADD OBJECT LBLF12 AS LABEL WITH;      
      LEFT=INT_015*370,;
      TOP=INT_015*130,;
      WIDTH=INT_015*50,;
      CAPTION='起始時間'            
  ADD OBJECT TXTF12 AS TEXTBOX WITH;	
      VISIBLE=.T.,;
      LEFT=INT_015*421,;
      TOP=INT_015*124,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*45,;
      MAXLENGTH=5,;
      INPUTMASK='99:99',;
      NAME='TXTF12'          
  ADD OBJECT LBLF11 AS LABEL WITH;      
      LEFT=INT_015*244,;
      TOP=INT_015*155,;
      WIDTH=INT_015*50,;
      CAPTION='截止日期'       
  ADD OBJECT TXTF11 AS TEXTBOX WITH;	
      VISIBLE=.T.,;
      LEFT=INT_015*295,;
      TOP=INT_015*149,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*70,;
      NAME='TXTF11'      
  ADD OBJECT LBLF13 AS LABEL WITH;      
      LEFT=INT_015*370,;
      TOP=INT_015*155,;
      WIDTH=INT_015*50,;
      CAPTION='截止時間'            
  ADD OBJECT TXTF13 AS TEXTBOX WITH;	
      VISIBLE=.T.,;
      LEFT=INT_015*421,;
      TOP=INT_015*149,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*45,;
      MAXLENGTH=5,;
      INPUTMASK='99:99',;
      NAME='TXTF13'               
  ADD OBJECT LBLF97 AS LABEL WITH;      
      VISIBLE=.F.,;
      LEFT=INT_015*494,;
      TOP=INT_015*130,;
      AUTOSIZE=.T.,;
      CAPTION='班別：'        
  ADD OBJECT LBLF98 AS LABEL WITH;      
      VISIBLE=.F.,;
      LEFT=INT_015*494,;
      TOP=INT_015*155,;
      AUTOSIZE=.T.,;
      CAPTION='休息：'               
  ADD OBJECT LBLF14 AS LABEL WITH;      
      LEFT=INT_015*244,;
      TOP=INT_015*180,;
      WIDTH=INT_015*50,;
      CAPTION='請假天數'      
  ADD OBJECT TXTF14 AS TEXTBOX WITH;	
      VISIBLE=.T.,;
      LEFT=INT_015*295,;
      TOP=INT_015*174,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*45,;
      MAXLENGTH=5,;
       INPUTMASK='999.9',;
      NAME='TXTF14'          
  ADD OBJECT LBLF15 AS LABEL WITH;      
      LEFT=INT_015*244,;
      TOP=INT_015*205,;
      WIDTH=INT_015*50,;
      CAPTION='請假時數'      
  ADD OBJECT TXTF15 AS TEXTBOX WITH;	
      VISIBLE=.T.,;
      LEFT=INT_015*295,;
      TOP=INT_015*199,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*45,;
      MAXLENGTH=5,;
       INPUTMASK='999.9',;
      NAME='TXTF15'          
  ADD OBJECT LBLF16 AS LABEL WITH;      
      LEFT=INT_015*244,;
      TOP=INT_015*230,;
      WIDTH=INT_015*50,;
      CAPTION='請假事由'      
  ADD OBJECT TXTF16 AS TEXTBOX WITH;	
      VISIBLE=.T.,;
      LEFT=INT_015*295,;
      TOP=INT_015*224,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*400,;
      MAXLENGTH=60,;
      NAME='TXTF16'      
  ADD OBJECT LBLF17 AS LABEL WITH;      
      LEFT=INT_015*244,;
      TOP=INT_015*255,;
      WIDTH=INT_015*50,; 
      CAPTION='附件張數'      
  ADD OBJECT TXTF17 AS TEXTBOX WITH;	
      VISIBLE=.T.,;
      LEFT=INT_015*295,;
      TOP=INT_015*249,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*30,;
      MAXLENGTH=2,;
      NAME='TXTF17'           
  ADD OBJECT LBLF011 AS LABEL WITH;
      LEFT=INT_015*360,;
      TOP=INT_015*255,;
      AUTOSIZE=.T.,;
      BACKCOLOR=RGB(0,255,255),;
      CAPTION='部門年假請假單號：'            
  ADD OBJECT LBLF18 AS LABEL WITH;      
      LEFT=INT_015*244,;
      TOP=INT_015*285,;
      WIDTH=INT_015*50,;
      CAPTION='狀        態'    
  ADD OBJECT LBLF181 AS LABEL WITH;      
      LEFT=INT_015*298,;
      TOP=INT_015*285,;
      AUTOSIZE=.T.,;
      CAPTION=''       
  ADD OBJECT LBLF99 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*315,;
      WIDTH=INT_015*50,;
      CAPTION='安全資料'
  ADD OBJECT LBLF991 AS LABEL WITH;
      LEFT=INT_015*298,;
      TOP=INT_015*315,;
      AUTOSIZE=.T.,;
      CAPTION=''                                                 
  ADD OBJECT KEY_LIST AS KEY_LIST WITH;
      AUTOCENTER=.T.
  ADD OBJECT GRID1 AS GRID1 WITH;
      COLUMNCOUNT=3,;            
      RECORDSOURCE='S18_1',;      
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;
      COLUMN3.NAME='COLUMN3'
  ADD OBJECT CMDGROUP AS CMDGROUP WITH;
      AUTOSIZE=.T.              
  ADD OBJECT ORPGROUP AS ORPGROUP WITH;    
      AUTOSIZE=.T.
  ADD OBJECT SHRGROUP AS SHRGROUP WITH;
      TOP=INT_015*260,;
      LEFT=INT_015*558          
  *****   
  PROCEDURE INIT  
       SELECT S18_1
       GO BOTTOM 
       THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(S18_1.F18<>'Y',RGB(255,0,0),'')","COLUMN")        
       THISFORM.SHRGROUP.VISIBLE=.F.
       THISFORM.SHRGROUP.ENABLED=.F.
       THISFORM.SETALL('HEIGHT',INT_015*25,'TEXTBOX')
       THISFORM.SETALL('FONTSIZE',INT_015*9,'LABEL')
       THISFORM.SETALL('FONTSIZE',INT_015*9,'TEXTBOX')
       THISFORM.SETALL('HEIGHT',INT_015*17,'LABEL')       
       THISFORM.SETALL('READONLY',.T.,'TEXTBOX')
       THISFORM.SETALL('FONTSIZE',INT_015*9,'COLUMN')
       THISFORM.SETALL('FONTSIZE',INT_015*9,'HEADER')       
       THISFORM.GRID1.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)   
       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*75
       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*50
       THISFORM.GRID1.COLUMN3.WIDTH=INT_015*60
       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='單據編號'
       THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='員工編號'
       THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='員工姓名'
       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='S18_1.F02'
       THISFORM.GRID1.COLUMN2.CONTROLSOURCE='S18_1.F03'
       THISFORM.GRID1.COLUMN3.CONTROLSOURCE='S18_1.F04'
       THISFORM.GRID1.READONLY=.T.       
       THISFORM.GRID1.SETFOCUS
       IF THISFORM.GRID1.ACTIVEROW=0
          THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
          THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
          THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
          THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.       
          THISFORM.CMDGROUP.ENABLED=.F.
          THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
          THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
          THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
          THISFORM.LIST_BOTT.ENABLED=.F.
          THISFORM.ANS_BOTT.ENABLED=.F.
          THISFORM.INVERSE_BOTT.ENABLED=.F.    
          THISFORM.S16_BOTT.ENABLED=.F.  
          THISFORM.TXTF01.VALUE=''
          THISFORM.TXTF02.VALUE=''
          THISFORM.TXTF03.VALUE=''
          THISFORM.TXTF04.VALUE=''  
          THISFORM.TXTF05.VALUE=''
          THISFORM.TXTF06.VALUE=''     
          THISFORM.TXTF07.VALUE=''
          THISFORM.TXTF08.VALUE=''
          THISFORM.TXTF09.VALUE=''
          THISFORM.TXTF10.VALUE=''
          THISFORM.TXTF11.VALUE=''
          THISFORM.TXTF12.VALUE=''
          THISFORM.TXTF13.VALUE=''
          THISFORM.TXTF14.VALUE=''
          THISFORM.TXTF15.VALUE=''
          THISFORM.TXTF16.VALUE=''
          THISFORM.TXTF17.VALUE=''
          THISFORM.LBLF011.CAPTION=''
          THISFORM.LBLF09.CAPTION=''
          THISFORM.LBLF181.CAPTION=''
          THISFORM.LBLF97.CAPTION=''
          THISFORM.LBLF98.CAPTION=''
          THISFORM.LBLF991.CAPTION=''
       ELSE
          THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
          THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
          THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
          THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.            
          THISFORM.CMDGROUP.ENABLED=.T.      
          THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  AND IIF(S18_1.F18<>'Y',.T.,.F.)  AND EMPTY(S18_1.F21) = .T. &&判斷有無修改的權限
          THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)   AND IIF(S18_1.F18<>'Y',.T.,.F.) &&判斷有無刪除的權限
          THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限
          THISFORM.LIST_BOTT.ENABLED=IIF(A02.F11='*',.T.,.F.)   &&判斷有無列印明細的權限          
          THISFORM.ANS_BOTT.ENABLED=IIF(A02.F08='*',.T.,.F.)  AND IIF(S18_1.F18<>'Y',.T.,.F.) AND IIF(EMPTY(S18_1.F21) = .T.,.T.,.F.)  &&判斷有無確認的權限
          THISFORM.INVERSE_BOTT.ENABLED=IIF(A02.F09='*',.T.,.F.)   AND IIF(S18_1.F18<>'Y',.F.,.T.) AND IIF(EMPTY(S18_1.F21) = .T.,.T.,.F.) &&判斷有反確認的權限
          THISFORM.S16_BOTT.ENABLED=IIF(A02.F12='*',.T.,.F.)   &&查看S16.出勤紀錄權限
       ENDIF      
       THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.)  &&判斷有無新增的權限 
       JK='單據編號'
  ENDPROC 
  ***********     
  PROCEDURE KEY_LIST.INIT 
       WITH THIS 
           .ADDITEM('依單據編號排列')
           .ADDITEM('依員工編號排列')
           .VALUE=1
       ENDWITH      
  ENDPROC 
********* 
  PROCEDURE KEY_LIST.INTERACTIVECHANGE         
       SELECT  S18_1 
       DO CASE
          CASE THIS.DISPLAYVALUE='依單據編號排列'
               SET ORDER TO S18_11 
		       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*75
		       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*50
		       THISFORM.GRID1.COLUMN3.WIDTH=INT_015*60                     
		       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='單據編號'
		       THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='員工編號'
		       THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='員工姓名'
		       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='S18_1.F02'
		       THISFORM.GRID1.COLUMN2.CONTROLSOURCE='S18_1.F03'
		       THISFORM.GRID1.COLUMN3.CONTROLSOURCE='S18_1.F04'
		       JK='單據編號'
          CASE THIS.DISPLAYVALUE='依員工編號排列'
               SET ORDER TO S18_12
			   THISFORM.GRID1.COLUMN1.WIDTH=INT_015*50
			   THISFORM.GRID1.COLUMN2.WIDTH=INT_015*60
			   THISFORM.GRID1.COLUMN3.WIDTH=INT_015*75 
			   THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='員工編號'
			   THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='員工姓名'
			   THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='單據編號'		     
			   THISFORM.GRID1.COLUMN1.CONTROLSOURCE='S18_1.F03'    
			   THISFORM.GRID1.COLUMN2.CONTROLSOURCE='S18_1.F04'	
			   THISFORM.GRID1.COLUMN3.CONTROLSOURCE='S18_1.F02'		
			   JK='員工編號'                                                  
       ENDCASE 
       THISFORM.GRID1.SETFOCUS          
  ENDPROC          
  *********
  PROCEDURE GRID1.AFTERROWCOLCHANGE
       LPARAMETERS nColIndex
       SELECT S18_1
       THISFORM.LBLF011.VISIBLE=IIF(EMPTY(F21),.F.,.T.)
       THISFORM.LBLF011.CAPTION='部門年假請假單號：'+F21
       THISFORM.TXTF01.VALUE=F01
       THISFORM.TXTF02.VALUE=F02
       THISFORM.TXTF03.VALUE=F03
       THISFORM.TXTF04.VALUE=F04
       THISFORM.TXTF05.VALUE=F05
       THISFORM.TXTF06.VALUE=F06
       THISFORM.TXTF07.VALUE=F07
       THISFORM.TXTF08.VALUE=F08
       THISFORM.TXTF09.VALUE=F09
       THISFORM.TXTF10.VALUE=F10
       THISFORM.TXTF11.VALUE=F11
       THISFORM.TXTF12.VALUE=F12
       THISFORM.TXTF13.VALUE=F13
       THISFORM.TXTF14.VALUE=F14
       THISFORM.TXTF15.VALUE=F15
       THISFORM.TXTF16.VALUE=F16
       THISFORM.TXTF17.VALUE=F17
       THISFORM.LBLF09.VISIBLE=.F.
       THISFORM.LBLF97.VISIBLE=.F.
       THISFORM.LBLF98.VISIBLE=.F.
       THISFORM.LBLF09.CAPTION='計數單位：' +ACC_BASE(S18_1.F09)+'，請假基數：'+ALLTRIM(TRANSFORM(IIF(INDEXSEEK('G'+S18_1.F07,.T.,'S00','S003'),S00.F62,0),'@R 999,999.9'))+' '+ACC_BASE(THISFORM.TXTF09.VALUE)
       THISFORM.LBLF181.CAPTION=IIF(S18_1.F18<>'Y','尚未確認','已確認') 
       THISFORM.LBLF181.BACKCOLOR=IIF(S18_1.F18<>'Y',RGB(255,0,0),RGB(58,186,152)) 
       THISFORM.LBLF991.CAPTION=F99    
       THISFORM.LBLF97.CAPTION=IIF(INDEXSEEK(S18_1.F03,.T.,'S05','S051'),IIF(INDEXSEEK('I'+S05.F29,.T.,'S00','S005'),'班別時段：'+S00.F50+'∼'+S00.F51,''),'')
       THISFORM.LBLF98.CAPTION=IIF(INDEXSEEK(S18_1.F03,.T.,'S05','S051'),IIF(INDEXSEEK('I'+S05.F29,.T.,'S00','S005'),'休息時段：'+S00.F52+'∼'+S00.F53,''),'')
       THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  AND IIF(S18_1.F18<>'Y',.T.,.F.) AND EMPTY(S18_1.F21) = .T. &&判斷有無修改的權限
       THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)   AND IIF(S18_1.F18<>'Y',.T.,.F.) &&判斷有無刪除的權限
       THISFORM.ANS_BOTT.ENABLED=IIF(A02.F08='*',.T.,.F.)  AND IIF(S18_1.F18<>'Y',.T.,.F.) AND IIF(EMPTY(S18_1.F21) = .T.,.T.,.F.)   &&判斷有無確認的權限
       THISFORM.INVERSE_BOTT.ENABLED=IIF(A02.F09='*',.T.,.F.)   AND IIF(S18_1.F18<>'Y',.F.,.T.) AND IIF(EMPTY(S18_1.F21) = .T.,.T.,.F.) &&判斷有反確認的權限 
       THISFORM.S16_BOTT.ENABLED=IIF(A02.F12='*',.T.,.F.)   &&查看S16.出勤紀錄權限
       FCH=THISFORM.ACTIVECONTROL.NAME
       CHK=''
       THISFORM.REFRESH
  ENDPROC      
  ********** 
  PROCEDURE ORPGROUP.NEW_BOTT.CLICK    
       THISFORM.KEY_LIST.ENABLED=.F. 
       THISFORM.LIST_BOTT.ENABLED=.F. 
       THISFORM.ANS_BOTT.ENABLED=.F.
       THISFORM.INVERSE_BOTT.ENABLED=.F.          
       THISFORM.S16_BOTT.ENABLED=.F.
       THISFORM.GRID1.ENABLED=.F.   
       HD='S018 '+SUBSTR(DTOS(DATE()),3,4)
       DO ODR_CRT  &&執行主程式中單據編號新增程序
       THISFORM.SETALL('READONLY',.F.,'TEXTBOX')
       THISFORM.LBLF011.VISIBLE=.F.
       THISFORM.LBLF09.VISIBLE=.T.
       THISFORM.LBLF97.VISIBLE=.T.
       THISFORM.LBLF98.VISIBLE=.T.
       THISFORM.TXTF01.READONLY=.T.  
       THISFORM.TXTF02.READONLY=.T.   
       THISFORM.TXTF03.READONLY=IIF(A02.F10<>'*',.T.,.F.)
       THISFORM.TXTF04.READONLY=IIF(A02.F10<>'*',.F.,.T.)
       THISFORM.TXTF05.READONLY=.T.
       THISFORM.TXTF06.READONLY=.T.  
       THISFORM.TXTF14.READONLY=IIF(A02.F12='*',.F.,.T.)
       THISFORM.TXTF15.READONLY=IIF(A02.F12='*',.F.,.T.)
       THISFORM.TXTF03.VISIBLE=IIF(A02.F10<>'*',.T.,.F.)
       THISFORM.COMBOBOX03.VISIBLE=IIF(A02.F10<>'*',.F.,.T.)
       THISFORM.COMBOBOX03.VALUE=1          
       THISFORM.COMBOBOX08.VISIBLE=.T.
       THISFORM.COMBOBOX08.VALUE=1   
       THISFORM.TXTF08.VISIBLE=.F.      
       THISFORM.TXTF09.VISIBLE=.F.
       THISFORM.LBLF97.VISIBLE=.T.
       THISFORM.LBLF98.VISIBLE=.T.
       THISFORM.TXTF01.VALUE=DATE()             
       THISFORM.TXTF02.VALUE=PO_NO
       THISFORM.TXTF04.VALUE=IIF(A02.F10<>'*',IIF(SEEK(sys_oper,'A01'),A01.F03,''),'')
       THISFORM.TXTF03.VALUE=IIF(A02.F10<>'*',IIF(INDEXSEEK(THISFORM.TXTF04.VALUE,.T.,'S05','S052'),S05.F01,''),'')
       THISFORM.TXTF05.VALUE=IIF(A02.F10<>'*',IIF(INDEXSEEK(THISFORM.TXTF04.VALUE,.T.,'S05','S052'),S05.F05,''),'')
       THISFORM.TXTF06.VALUE=IIF(A02.F10<>'*',IIF(INDEXSEEK(THISFORM.TXTF04.VALUE,.T.,'S05','S052'),S05.F06,''),'')
       THISFORM.TXTF07.VALUE=''
       THISFORM.TXTF08.VALUE=''
       THISFORM.TXTF09.VALUE=''
       THISFORM.TXTF10.VALUE=DATE()
       THISFORM.TXTF11.VALUE=DATE()
       THISFORM.TXTF12.VALUE=IIF(A02.F10<>'*',IIF(INDEXSEEK(THISFORM.TXTF04.VALUE,.T.,'S05','S052'),IIF(INDEXSEEK('I'+S05.F29,.T.,'S00','S005'),S00.F50,''),''),'')
       THISFORM.TXTF13.VALUE=IIF(A02.F10<>'*',IIF(INDEXSEEK(THISFORM.TXTF04.VALUE,.T.,'S05','S052'),IIF(INDEXSEEK('I'+S05.F29,.T.,'S00','S005'),S00.F51,''),''),'')
       THISFORM.TXTF14.VALUE=1
       THISFORM.TXTF15.VALUE=0
       THISFORM.TXTF16.VALUE=''
       THISFORM.TXTF17.VALUE=0
       THISFORM.LBLF09.CAPTION=''       
       THISFORM.LBLF181.CAPTION=''
       THISFORM.LBLF97.CAPTION=IIF(A02.F10<>'*','班別時段：'+ALLTRIM(THISFORM.TXTF12.VALUE)+' ∼ '+ALLTRIM(THISFORM.TXTF13.VALUE),'')
       THISFORM.LBLF98.CAPTION=IIF(A02.F10<>'*',IIF(INDEXSEEK(THISFORM.TXTF04.VALUE,.T.,'S05','S052'),IIF(INDEXSEEK('I'+S05.F29,.T.,'S00','S005'),'休息時段：'+S00.F52+' ∼ '+S00.F53,''),''),'')       
       THISFORM.LBLF991.CAPTION=''
       IF A02.F10<>'*'
          THISFORM.TXTF04.SETFOCUS()
       ELSE
          THISFORM.COMBOBOX03.SETFOCUS()
       ENDIF    
       FLG='1'
  ENDPROC  
************
  PROCEDURE SHRGROUP.SHURE1_BOTT.CLICK
    IF EMPTY(THISFORM.TXTF02.VALUE)
       =MESSAGEBOX('單據編號不得空白,請洽系統管理人員處裡!',0+64,'提示視窗')
       THISFORM.TXTF02.SETFOCUS
       RETURN
    ENDIF  
    IF INDEXSEEK(THISFORM.TXTF02.VALUE,.F.,'S18','S181') =.T.  &&單號如果重複
       SELECT MAX(F02) FROM S18 INTO ARRAY GB NOWAIT
       HD='S018 '+SUBSTR(DTOS(DATE()),3,4)+THISFORM.TXTF02.VALUE
       DO ODR_RPT
       THISFORM.TXTF02.VALUE=PO_NO
	   THISFORM.TXTF02.REFRESH      
    ENDIF   
    IF EMPTY(THISFORM.TXTF03.VALUE) OR EMPTY(THISFORM.TXTF05.VALUE)  OR EMPTY(THISFORM.TXTF06.VALUE) 
       =MESSAGEBOX('此員工姓名不存在,請至S05.人事薪資基本檔中新增人員資料後,在進行請假作業!',0+64,'提示視窗')
       THISFORM.TXTF04.SETFOCUS
       RETURN
    ENDIF  
    IF EMPTY(ALLTRIM(THISFORM.TXTF04.VALUE))
       =MESSAGEBOX('員工姓名不得空白!',0+64,'提示視窗')
       THISFORM.TXTF04.SETFOCUS
       RETURN
    ENDIF          
    IF EMPTY(ALLTRIM(THISFORM.TXTF07.VALUE)) OR EMPTY(ALLTRIM(THISFORM.TXTF08.VALUE))
       =MESSAGEBOX('假別名稱不得空白!',0+64,'提示視窗')
       THISFORM.COMBOBOX08.SETFOCUS
       RETURN
    ENDIF    
    ********
    IF EMPTY(THISFORM.TXTF10.VALUE)
	   =MESSAGEBOX('請假起始日期不得空白!',0+64,'提示視窗')
	   THISFORM.TXTF10.SETFOCUS
	   RETURN
    ENDIF     
    IF IIF(INDEXSEEK('G' + ALLTRIM(THISFORM.TXTF07.VALUE),.T.,'S00','S003'),IIF(S00.F68 <> '1',.T.,.F.),.T.) = .T.
       IF DOW(THISFORM.TXTF10.VALUE)=1 OR DOW(THISFORM.TXTF10.VALUE) = 7 
          IF IIF(INDEXSEEK(DTOS(THISFORM.TXTF10.VALUE),.T.,'S15','S151'),S15.F03 <> '2',.T.) = .T.
             =MESSAGEBOX('請假起始日期不得為假日,請查明後再輸入!',0+64,'提示視窗')
             THISFORM.TXTF10.SETFOCUS
	         RETURN 
          ENDIF
       ELSE
          IF IIF(INDEXSEEK(DTOS(THISFORM.TXTF10.VALUE),.T.,'S15','S151'),S15.F03 = '1',.F.) = .T.
             =MESSAGEBOX('請假起始日期不得為假日,請查明後再輸入!',0+64,'提示視窗')
             THISFORM.TXTF10.SETFOCUS
	         RETURN 
          ENDIF
       ENDIF       
    ENDIF
    IF EMPTY(THISFORM.TXTF11.VALUE)
       =MESSAGEBOX('請假截止日期不得空白!',0+64,'提示視窗')
	   THISFORM.TXTF11.SETFOCUS
	   RETURN
    ENDIF  	
    IF IIF(INDEXSEEK('G' + ALLTRIM(THISFORM.TXTF07.VALUE),.T.,'S00','S003'),IIF(S00.F68 <> '1',.T.,.F.),.T.) = .T.
       IF DOW(THISFORM.TXTF11.VALUE)=1 OR DOW(THISFORM.TXTF11.VALUE) = 7
          IF IIF(INDEXSEEK(DTOS(THISFORM.TXTF11.VALUE),.T.,'S15','S151'),S15.F03 <> '2',.T.) = .T.
             =MESSAGEBOX('請假截止日期不得為假日,請查明後再輸入!',0+64,'提示視窗')
             THISFORM.TXTF11.SETFOCUS
	         RETURN 
          ENDIF
       ELSE
          IF IIF(INDEXSEEK(DTOS(THISFORM.TXTF11.VALUE),.T.,'S15','S151'),S15.F03 = '1',.F.) = .T.
             =MESSAGEBOX('請假截止日期不得為假日,請查明後再輸入!',0+64,'提示視窗')
             THISFORM.TXTF11.SETFOCUS
	         RETURN 
	      ENDIF   
       ENDIF     
    ENDIF
    IF THISFORM.TXTF10.VALUE>THISFORM.TXTF11.VALUE
	   =MESSAGEBOX('請假起始日期不得大於請假截止日期,請重新輸入!',0+64,'提示視窗')
	   THISFORM.TXTF10.SETFOCUS
	   RETURN             
    ENDIF        
    IF THISFORM.TXTF11.VALUE<THISFORM.TXTF10.VALUE
	   =MESSAGEBOX('請假截止日期不得小於請假起始日期,請重新輸入!',0+64,'提示視窗')
	   THISFORM.TXTF11.SETFOCUS
	   RETURN            
    ENDIF     
   ****
   ON_WORK=IIF(INDEXSEEK(THISFORM.TXTF03.VALUE,.T.,'S05','S051'),IIF(INDEXSEEK('I'+S05.F29,.T.,'S00','S005'),S00.F50,''),'')	&&上班時段
   OFF_WORK=IIF(INDEXSEEK(THISFORM.TXTF03.VALUE,.T.,'S05','S051'),IIF(INDEXSEEK('I'+S05.F29,.T.,'S00','S005'),S00.F51,''),'')    &&下班時段	
   REST_STR=IIF(INDEXSEEK(THISFORM.TXTF03.VALUE,.T.,'S05','S051'),IIF(INDEXSEEK('I'+S05.F29,.T.,'S00','S005'),S00.F52,''),'')	&&中午休息時段起
   REST_END=IIF(INDEXSEEK(THISFORM.TXTF03.VALUE,.T.,'S05','S051'),IIF(INDEXSEEK('I'+S05.F29,.T.,'S00','S005'),S00.F53,''),'')      &&中午休息時段止
   IF EMPTY(ALLTRIM(LEFT(THISFORM.TXTF12.VALUE,2))) AND EMPTY(ALLTRIM(RIGHT(THISFORM.TXTF12.VALUE,2))) 
       =MESSAGEBOX('請假起始時間不得空白!',0+64,'提示視窗')
       THISFORM.TXTF12.SETFOCUS
       RETURN
   ENDIF         
   IF LEN(ALLTRIM(THISFORM.TXTF12.VALUE))<>5 OR ;
       LEN(ALLTRIM(LEFT(ALLTRIM(THISFORM.TXTF12.VALUE),2)))=1 OR;
       LEN(ALLTRIM(RIGHT(ALLTRIM(THISFORM.TXTF12.VALUE),2)))=1 OR;
       VAL(LEFT(ALLTRIM(THISFORM.TXTF12.VALUE),2))>23 OR;
       VAL(RIGHT(ALLTRIM(THISFORM.TXTF12.VALUE),2))>59
       =MESSAGEBOX('請假起始時間格式不正確!',0+64,'提示視窗')
       THISFORM.TXTF12.SETFOCUS
       RETURN
   ENDIF   
   IF IIF(INDEXSEEK('G' + ALLTRIM(THISFORM.TXTF07.VALUE),.T.,'S00','S003'),IIF(S00.F68 <> '1',.T.,.F.),.T.) = .T.
      IF BETWEEN(ALLTRIM(THISFORM.TXTF12.VALUE),ALLTRIM(ON_WORK),ALLTRIM(OFF_WORK))=.F.
         =MESSAGEBOX('請假起始時間並不再此人員之上班時段內,請查明後再輸入!'+ON_WORK,0+64,'提示視窗')
         THISFORM.TXTF12.SETFOCUS
	     RETURN
      ENDIF  
      IF !EMPTY(REST_STR) AND !EMPTY(REST_END) AND ALLTRIM(THISFORM.TXTF12.VALUE)<>ALLTRIM(REST_STR) AND;
         ALLTRIM(THISFORM.TXTF12.VALUE)<>ALLTRIM(REST_END) AND BETWEEN(ALLTRIM(THISFORM.TXTF12.VALUE),ALLTRIM(REST_STR),ALLTRIM(REST_END))
         =MESSAGEBOX('請假起始時間不可在休息時間範圍內,請查明後再輸入!',0+64,'提示視窗')
         THISFORM.TXTF12.SETFOCUS
	     RETURN
      ENDIF  
   ENDIF               	
   ****
   IF EMPTY(ALLTRIM(LEFT(THISFORM.TXTF13.VALUE,2))) AND EMPTY(ALLTRIM(RIGHT(THISFORM.TXTF13.VALUE,2))) 
       =MESSAGEBOX('請假截止時間不得空白!',0+64,'提示視窗')
       THISFORM.TXTF13.SETFOCUS
       RETURN
   ENDIF               
   IF LEN(ALLTRIM(THISFORM.TXTF13.VALUE))<>5 OR ;
       LEN(ALLTRIM(LEFT(ALLTRIM(THISFORM.TXTF13.VALUE),2)))=1 OR;
       LEN(ALLTRIM(RIGHT(ALLTRIM(THISFORM.TXTF13.VALUE),2)))=1 OR;    
       VAL(LEFT(ALLTRIM(THISFORM.TXTF13.VALUE),2))>23 OR;
       VAL(RIGHT(ALLTRIM(THISFORM.TXTF13.VALUE),2))>59
       =MESSAGEBOX('請假截止時間格式不正確!',0+64,'提示視窗')
       THISFORM.TXTF13.SETFOCUS
       RETURN
   ENDIF  
   IF IIF(INDEXSEEK('G' + ALLTRIM(THISFORM.TXTF07.VALUE),.T.,'S00','S003'),IIF(S00.F68 <> '1',.T.,.F.),.T.) = .T.
      IF BETWEEN(ALLTRIM(THISFORM.TXTF13.VALUE),ALLTRIM(ON_WORK),ALLTRIM(OFF_WORK))=.F.
         =MESSAGEBOX('請假截止時間並不再此人員之上班時段內,請查明後再輸入!',0+64,'提示視窗')
         THISFORM.TXTF13.SETFOCUS
	     RETURN
      ENDIF     	
      IF !EMPTY(REST_STR) AND !EMPTY(REST_END) AND ALLTRIM(THISFORM.TXTF13.VALUE)<>ALLTRIM(REST_STR) AND;
         ALLTRIM(THISFORM.TXTF13.VALUE)<>ALLTRIM(REST_END) AND BETWEEN(ALLTRIM(THISFORM.TXTF13.VALUE),ALLTRIM(REST_STR),ALLTRIM(REST_END))
         =MESSAGEBOX('請假截止時間不可在休息時間範圍內,請查明後再輸入!',0+64,'提示視窗')
         THISFORM.TXTF13.SETFOCUS
	     RETURN
	  ENDIF   
   ENDIF   
    *********
    Day_Hour1=IIF(INDEXSEEK(THISFORM.TXTF03.VALUE,.T.,'S05','S051'),IIF(INDEXSEEK('I'+S05.F29,.T.,'S00','S005'),S00.F57,0),0)	&&上班總時數
    IF THISFORM.TXTF14.VALUE=0 AND ALLTRIM(THISFORM.TXTF09.VALUE)='D'  AND THISFORM.TXTF15.VALUE<Day_Hour1*IIF(INDEXSEEK('G'+THISFORM.TXTF07.VALUE,.T.,'S00','S003'),S00.F62,0)
	 =MESSAGEBOX('請假基數為'+ALLTRIM(TRANSFORM(S00.F62,'@R 999.9'))+'天,故請假天數不得小於請假基數!',0+64,'提示視窗')
	THISFORM.TXTF14.SETFOCUS
	RETURN	    
   ENDIF	
   IF THISFORM.TXTF14.VALUE=0 AND ALLTRIM(THISFORM.TXTF09.VALUE)='H'  AND THISFORM.TXTF15.VALUE<IIF(INDEXSEEK('G'+THISFORM.TXTF07.VALUE,.T.,'S00','S003'),S00.F62,0)
       =MESSAGEBOX('請假基數為'+ALLTRIM(TRANSFORM(S00.F62,'@R 999.9'))+'小時,故請假時數不得小於請假基數!',0+64,'提示視窗')
       THISFORM.TXTF14.SETFOCUS
       RETURN
   ENDIF			        
    **************判斷是否超過年度可請假數
   DO CASE
      CASE ALLTRIM(THISFORM.TXTF09.VALUE)='D'	&&計數單位(D:日,H:小時,S:次)  
           IF THISFORM.TXTF15.VALUE<>0
              DayCK=IIF(Day_Hour1=0,0,ROUND(THISFORM.TXTF15.VALUE/Day_Hour1,1))+THISFORM.TXTF14.VALUE	
           ELSE
              DayCK=THISFORM.TXTF14.VALUE	                        
           ENDIF
      CASE ALLTRIM(THISFORM.TXTF09.VALUE)='H'          
           IF THISFORM.TXTF14.VALUE<>0
              DayCK=(THISFORM.TXTF14.VALUE*Day_Hour1)+THISFORM.TXTF15.VALUE
           ELSE
              DayCK=THISFORM.TXTF15.VALUE	 
           ENDIF   
      CASE ALLTRIM(THISFORM.TXTF09.VALUE)='S'      
           DayCK=1          
   ENDCASE
   IF THISFORM.TXTF07.VALUE='A1' &&判斷是否為年假
*!*	      SELECT S05
*!*	      SET ORDER TO S051
*!*	      SEEK THISFORM.TXTF03.VALUE
*!*	      IF FOUND() AND S05.F11<DayCK+S05.F12
*!*	         =MESSAGEBOX('請假'+ACC_BASE(THISFORM.TXTF09.VALUE)+'數已超過年假可休之'+ACC_BASE(THISFORM.TXTF09.VALUE)+'數!',0+64,'提示視窗')
*!*		     THISFORM.TXTF10.SETFOCUS
*!*		     RETURN         
*!*	      ENDIF
      SELECT S0A.F01,SUM(F07) FROM S0A WHERE F05='A1' AND LEFT(DTOS(F08),4)=LEFT(DTOS(DATE()),4)  GROUP BY S0A.F01 INTO CURSOR S0ABC
      INDE ON F01 TAG S0ABC1
      SET ORDER TO S0ABC1    
      SELECT S05
      SET ORDER TO S051
      SEEK THISFORM.TXTF03.VALUE
      IF FOUND() AND S05.F11 < (DayCK + IIF(SEEK(THISFORM.TXTF03.VALUE,'S0ABC'),S0ABC.SUM_F07,0))
         =MESSAGEBOX('請假'+ACC_BASE(THISFORM.TXTF09.VALUE)+'數已超過年假可休之'+ACC_BASE(THISFORM.TXTF09.VALUE)+'數,請重新輸入!',0+64,'提示視窗') 
         THISFORM.TXTF10.SETFOCUS 
         RETURN       	         
      ENDIF
   ELSE
      SELECT S0A.F05,S0A.F06,S0A.F07,LEFT(DTOS(F08),4) FROM S0A WHERE ALLTRIM(F01)=ALLTRIM(THISFORM.TXTF03.VALUE) INTO CURSOR S0AA
      SELECT S0AA.F05,S0AA.F06,SUM(S0AA.F07),S0AA.EXP_4 FROM S0AA GROUP BY F05,EXP_4 INTO CURSOR S0A_TEMP READWRITE 
      INDE ON EXP_4+F05 TAG S0A_TEMP1
      SELECT S0A_TEMP
      SET ORDER TO S0A_TEMP1
      SELECT S00
      SET ORDER TO S003
      SEEK 'G'+THISFORM.TXTF07.VALUE
      IF FOUND()
         IF YEAR(THISFORM.TXTF10.VALUE)=YEAR(THISFORM.TXTF11.VALUE)
            IF S00.F29<>0 AND S00.F29<IIF(SEEK(LEFT(DTOS(THISFORM.TXTF10.VALUE),4)+THISFORM.TXTF07.VALUE,'S0A_TEMP'),S0A_TEMP.SUM_F07,0)+DayCK
	           =MESSAGEBOX('請假'+ACC_BASE(THISFORM.TXTF09.VALUE)+'數已超過年度假別名稱('+ALLTRIM(THISFORM.TXTF08.VALUE)+')之可請假總'+ACC_BASE(THISFORM.TXTF09.VALUE)+'數,請查明後再輸入',0+64,'提示視窗')
		       THISFORM.TXTF10.SETFOCUS
		       RETURN   		 
	        ENDIF	
	     ENDIF                 
      ENDIF
      SELECT S0AA
      USE
      SELECT S0A_TEMP
      USE
   ENDIF    
   ****** 
   IF EMPTY(THISFORM.TXTF16.VALUE)
      =MESSAGEBOX('請假事由不得空白!',0+64,'提示視窗')
      THISFORM.TXTF16.SETFOCUS
      RETURN
   ENDIF         
   ***
   SELECT S18
   APPEND BLANK
   LOCK()
   IF RLOCK()
      REPLACE F01 WITH THISFORM.TXTF01.VALUE
      REPLACE F02 WITH THISFORM.TXTF02.VALUE
      REPLACE F03 WITH THISFORM.TXTF03.VALUE
      REPLACE F04 WITH THISFORM.TXTF04.VALUE
      REPLACE F05 WITH THISFORM.TXTF05.VALUE
      REPLACE F06 WITH THISFORM.TXTF06.VALUE
      REPLACE F07 WITH THISFORM.TXTF07.VALUE
      REPLACE F08 WITH THISFORM.TXTF08.VALUE
      REPLACE F09 WITH THISFORM.TXTF09.VALUE 
      REPLACE F10 WITH THISFORM.TXTF10.VALUE
      REPLACE F11 WITH THISFORM.TXTF11.VALUE
      REPLACE F12 WITH THISFORM.TXTF12.VALUE
      REPLACE F13 WITH THISFORM.TXTF13.VALUE	
      REPLACE F14 WITH THISFORM.TXTF14.VALUE
      REPLACE F15 WITH THISFORM.TXTF15.VALUE
      REPLACE F16 WITH THISFORM.TXTF16.VALUE
      REPLACE F17 WITH THISFORM.TXTF17.VALUE
      REPLACE F18 WITH 'N'
      REPLACE F19 WITH sys_oper
      REPLACE F20 WITH IIF(LEFT(DTOS(THISFORM.TXTF10.VALUE),6)<>LEFT(DTOS(THISFORM.TXTF11.VALUE),6),'1','')
      REPLACE F99 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
   ENDIF          
   SELECT  S18_1
   APPEND BLANK
   LOCK()
   IF RLOCK()
      REPLACE F01 WITH THISFORM.TXTF01.VALUE
      REPLACE F02 WITH THISFORM.TXTF02.VALUE
      REPLACE F03 WITH THISFORM.TXTF03.VALUE
      REPLACE F04 WITH THISFORM.TXTF04.VALUE
      REPLACE F05 WITH THISFORM.TXTF05.VALUE
      REPLACE F06 WITH THISFORM.TXTF06.VALUE
      REPLACE F07 WITH THISFORM.TXTF07.VALUE
      REPLACE F08 WITH THISFORM.TXTF08.VALUE
      REPLACE F09 WITH THISFORM.TXTF09.VALUE
      REPLACE F10 WITH THISFORM.TXTF10.VALUE
      REPLACE F11 WITH THISFORM.TXTF11.VALUE
      REPLACE F12 WITH THISFORM.TXTF12.VALUE
      REPLACE F13 WITH THISFORM.TXTF13.VALUE		
      REPLACE F14 WITH THISFORM.TXTF14.VALUE
      REPLACE F15 WITH THISFORM.TXTF15.VALUE
      REPLACE F16 WITH THISFORM.TXTF16.VALUE
      REPLACE F17 WITH THISFORM.TXTF17.VALUE
      REPLACE F18 WITH 'N'
      REPLACE F19 WITH sys_oper
      REPLACE F20 WITH IIF(LEFT(DTOS(THISFORM.TXTF10.VALUE),6)<>LEFT(DTOS(THISFORM.TXTF11.VALUE),6),'1','')
      REPLACE F99 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
   ENDIF
   UNLOCK
   THISFORM.GRID1.ENABLED=.T.
   THISFORM.REFRESH
   THISFORM.GRID1.SETFOCUS    
   THISFORM.SHRGROUP.ABANDON_BOTT.CLICK             
 ENDPROC
************  
  PROCEDURE ORPGROUP.EDIT_BOTT.CLICK
     SELECT S18_1
     THISFORM.KEY_LIST.ENABLED=.F. 
     THISFORM.LIST_BOTT.ENABLED=.F. 
     THISFORM.ANS_BOTT.ENABLED=.F.
     THISFORM.INVERSE_BOTT.ENABLED=.F.            
     THISFORM.S16_BOTT.ENABLED=.F.
     THISFORM.GRID1.ENABLED=.F.     
     THISFORM.SETALL('READONLY',.F.,'TEXTBOX')  
     THISFORM.LBLF011.VISIBLE=.F.
     THISFORM.LBLF09.VISIBLE=.T.
     THISFORM.LBLF97.VISIBLE=.T.
     THISFORM.LBLF98.VISIBLE=.T.     
     THISFORM.TXTF01.READONLY=.T.
     THISFORM.TXTF02.READONLY=.T.
     THISFORM.TXTF03.READONLY=.T.
     THISFORM.TXTF04.READONLY=.T.
     THISFORM.TXTF05.READONLY=.T.
     THISFORM.TXTF06.READONLY=.T.
     THISFORM.TXTF14.READONLY=IIF(A02.F12='*',.F.,.T.)
     THISFORM.TXTF15.READONLY=IIF(A02.F12='*',.F.,.T.)
     THISFORM.TXTF08.VISIBLE=.F.
     THISFORM.COMBOBOX08.VISIBLE=.T.
     THISFORM.COMBOBOX08.DISPLAYVALUE=S18_1.F07+SPACE(5)+ALLTRIM(S18_1.F08)       
     THISFORM.LBLF181.CAPTION=''  
     THISFORM.LBLF991.CAPTION=''     
     THISFORM.COMBOBOX08.SETFOCUS
     LOCK()
     IF !RLOCK()
        DO FILE_IMPACT
        RETURN
     ENDIF
  ENDPROC 
************  
  PROCEDURE SHRGROUP.SHURE2_BOTT.CLICK    
    IF EMPTY(ALLTRIM(THISFORM.TXTF07.VALUE)) OR EMPTY(ALLTRIM(THISFORM.TXTF08.VALUE))
       =MESSAGEBOX('假別名稱不得空白!',0+64,'提示視窗')
       THISFORM.COMBOBOX08.SETFOCUS
       RETURN
    ENDIF    
    ********
    IF EMPTY(THISFORM.TXTF10.VALUE)
	   =MESSAGEBOX('請假起始日期不得空白!',0+64,'提示視窗')
	   THISFORM.TXTF10.SETFOCUS
	   RETURN
    ENDIF   
    IF IIF(INDEXSEEK('G' + ALLTRIM(THISFORM.TXTF07.VALUE),.T.,'S00','S003'),IIF(S00.F68 <> '1',.T.,.F.),.T.) = .T.
       IF DOW(THISFORM.TXTF10.VALUE)=1 OR DOW(THISFORM.TXTF10.VALUE) = 7 
          IF IIF(INDEXSEEK(DTOS(THISFORM.TXTF10.VALUE),.T.,'S15','S151'),S15.F03 <> '2',.T.) = .T.
             =MESSAGEBOX('請假起始日期不得為假日,請查明後再輸入!',0+64,'提示視窗')
             THISFORM.TXTF10.SETFOCUS
	         RETURN 
          ENDIF
       ELSE
          IF IIF(INDEXSEEK(DTOS(THISFORM.TXTF10.VALUE),.T.,'S15','S151'),S15.F03 = '1',.F.) = .T.
             =MESSAGEBOX('請假起始日期不得為假日,請查明後再輸入!',0+64,'提示視窗')
             THISFORM.TXTF10.SETFOCUS
	         RETURN 
          ENDIF
       ENDIF       
    ENDIF      
   IF EMPTY(THISFORM.TXTF11.VALUE)
      =MESSAGEBOX('請假截止日期不得空白!',0+64,'提示視窗')
	  THISFORM.TXTF11.SETFOCUS
	  RETURN
   ENDIF  
    IF IIF(INDEXSEEK('G' + ALLTRIM(THISFORM.TXTF07.VALUE),.T.,'S00','S003'),IIF(S00.F68 <> '1',.T.,.F.),.T.) = .T.
       IF DOW(THISFORM.TXTF11.VALUE)=1 OR DOW(THISFORM.TXTF11.VALUE) = 7
          IF IIF(INDEXSEEK(DTOS(THISFORM.TXTF11.VALUE),.T.,'S15','S151'),S15.F03 <> '2',.T.) = .T.
             =MESSAGEBOX('請假截止日期不得為假日,請查明後再輸入!',0+64,'提示視窗')
             THISFORM.TXTF11.SETFOCUS
	         RETURN 
          ENDIF
       ELSE
          IF IIF(INDEXSEEK(DTOS(THISFORM.TXTF11.VALUE),.T.,'S15','S151'),S15.F03 = '1',.F.) = .T.
             =MESSAGEBOX('請假截止日期不得為假日,請查明後再輸入!',0+64,'提示視窗')
             THISFORM.TXTF11.SETFOCUS
	         RETURN 
	      ENDIF   
       ENDIF     
    ENDIF    
   IF THISFORM.TXTF10.VALUE>THISFORM.TXTF11.VALUE
	  =MESSAGEBOX('請假起始日期不得大於請假截止日期,請重新輸入!',0+64,'提示視窗')
	  THISFORM.TXTF10.SETFOCUS
	  RETURN             
   ENDIF        
   IF THISFORM.TXTF11.VALUE<THISFORM.TXTF10.VALUE
	  =MESSAGEBOX('請假截止日期不得小於請假起始日期,請重新輸入!',0+64,'提示視窗')
	  THISFORM.TXTF11.SETFOCUS
	  RETURN            
   ENDIF     
   ****
   ON_WORK=IIF(INDEXSEEK(THISFORM.TXTF03.VALUE,.T.,'S05','S051'),IIF(INDEXSEEK('I'+S05.F29,.T.,'S00','S005'),S00.F50,''),'')	&&上班時段
   OFF_WORK=IIF(INDEXSEEK(THISFORM.TXTF03.VALUE,.T.,'S05','S051'),IIF(INDEXSEEK('I'+S05.F29,.T.,'S00','S005'),S00.F51,''),'')    &&下班時段
   REST_STR=IIF(INDEXSEEK(THISFORM.TXTF03.VALUE,.T.,'S05','S051'),IIF(INDEXSEEK('I'+S05.F29,.T.,'S00','S005'),S00.F52,''),'')	&&中午休息時段起
   REST_END=IIF(INDEXSEEK(THISFORM.TXTF03.VALUE,.T.,'S05','S051'),IIF(INDEXSEEK('I'+S05.F29,.T.,'S00','S005'),S00.F53,''),'')      &&中午休息時段止
   IF EMPTY(ALLTRIM(LEFT(THISFORM.TXTF12.VALUE,2))) AND EMPTY(ALLTRIM(RIGHT(THISFORM.TXTF12.VALUE,2))) 
       =MESSAGEBOX('請假起始時間不得空白!',0+64,'提示視窗')
       THISFORM.TXTF12.SETFOCUS
       RETURN
   ENDIF   
   IF LEN(ALLTRIM(THISFORM.TXTF12.VALUE))<>5 OR ;
       LEN(ALLTRIM(LEFT(ALLTRIM(THISFORM.TXTF12.VALUE),2)))=1 OR;
       LEN(ALLTRIM(RIGHT(ALLTRIM(THISFORM.TXTF12.VALUE),2)))=1 OR;
       VAL(LEFT(ALLTRIM(THISFORM.TXTF12.VALUE),2))>23 OR;
       VAL(RIGHT(ALLTRIM(THISFORM.TXTF12.VALUE),2))>59
       =MESSAGEBOX('請假起始時間格式不正確!',0+64,'提示視窗')
       THISFORM.TXTF12.SETFOCUS
       RETURN
   ENDIF   
   IF IIF(INDEXSEEK('G' + ALLTRIM(THISFORM.TXTF07.VALUE),.T.,'S00','S003'),IIF(S00.F68 <> '1',.T.,.F.),.T.) = .T.
      IF BETWEEN(ALLTRIM(THISFORM.TXTF12.VALUE),ALLTRIM(ON_WORK),ALLTRIM(OFF_WORK))=.F.
         =MESSAGEBOX('請假起始時間並不再此人員之上班時段內,請查明後再輸入!',0+64,'提示視窗')
         THISFORM.TXTF12.SETFOCUS
	     RETURN
      ENDIF 
      IF !EMPTY(REST_STR) AND !EMPTY(REST_END) AND ALLTRIM(THISFORM.TXTF12.VALUE)<>ALLTRIM(REST_STR) AND;
         ALLTRIM(THISFORM.TXTF12.VALUE)<>ALLTRIM(REST_END) AND BETWEEN(ALLTRIM(THISFORM.TXTF12.VALUE),ALLTRIM(REST_STR),ALLTRIM(REST_END))
         =MESSAGEBOX('請假起始時間不可在休息時間範圍內,請查明後再輸入!',0+64,'提示視窗')
         THISFORM.TXTF12.SETFOCUS
	     RETURN
	  ENDIF   
   ENDIF        	
   ****
   IF EMPTY(ALLTRIM(LEFT(THISFORM.TXTF13.VALUE,2))) AND EMPTY(ALLTRIM(RIGHT(THISFORM.TXTF13.VALUE,2))) 
       =MESSAGEBOX('請假截止時間不得空白!',0+64,'提示視窗')
       THISFORM.TXTF13.SETFOCUS
       RETURN
   ENDIF               
   IF LEN(ALLTRIM(THISFORM.TXTF13.VALUE))<>5 OR ;
       LEN(ALLTRIM(LEFT(ALLTRIM(THISFORM.TXTF13.VALUE),2)))=1 OR;
       LEN(ALLTRIM(RIGHT(ALLTRIM(THISFORM.TXTF13.VALUE),2)))=1 OR;    
       VAL(LEFT(ALLTRIM(THISFORM.TXTF13.VALUE),2))>23 OR;
       VAL(RIGHT(ALLTRIM(THISFORM.TXTF13.VALUE),2))>59
       =MESSAGEBOX('請假截止時間格式不正確!',0+64,'提示視窗')
       THISFORM.TXTF13.SETFOCUS
       RETURN
   ENDIF  
   IF IIF(INDEXSEEK('G' + ALLTRIM(THISFORM.TXTF07.VALUE),.T.,'S00','S003'),IIF(S00.F68 <> '1',.T.,.F.),.T.) = .T.
      IF BETWEEN(ALLTRIM(THISFORM.TXTF13.VALUE),ALLTRIM(ON_WORK),ALLTRIM(OFF_WORK))=.F.
         =MESSAGEBOX('請假截止時間並不再此人員之上班時段內,請查明後再輸入!',0+64,'提示視窗')
         THISFORM.TXTF13.SETFOCUS
	     RETURN
      ENDIF     	
      IF !EMPTY(REST_STR) AND !EMPTY(REST_END) AND ALLTRIM(THISFORM.TXTF13.VALUE)<>ALLTRIM(REST_STR) AND;
         ALLTRIM(THISFORM.TXTF13.VALUE)<>ALLTRIM(REST_END) AND BETWEEN(ALLTRIM(THISFORM.TXTF13.VALUE),ALLTRIM(REST_STR),ALLTRIM(REST_END))
         =MESSAGEBOX('請假截止時間不可在休息時間範圍內,請查明後再輸入!',0+64,'提示視窗')
         THISFORM.TXTF13.SETFOCUS
	     RETURN
      ENDIF   
   ENDIF
    *********
   Day_Hour1=IIF(INDEXSEEK(THISFORM.TXTF03.VALUE,.T.,'S05','S051'),IIF(INDEXSEEK('I'+S05.F29,.T.,'S00','S005'),S00.F57,0),0)
   IF THISFORM.TXTF14.VALUE=0 AND ALLTRIM(THISFORM.TXTF09.VALUE)='D'  AND THISFORM.TXTF15.VALUE<Day_Hour1*IIF(INDEXSEEK('G'+THISFORM.TXTF07.VALUE,.T.,'S00','S003'),S00.F62,0)
	  =MESSAGEBOX('請假基數為'+ALLTRIM(TRANSFORM(S00.F62,'@R 999.9'))+'天,故請假天數不得小於請假基數!',0+64,'提示視窗')
	  THISFORM.TXTF14.SETFOCUS
	  RETURN	    
   ENDIF	
   IF THISFORM.TXTF14.VALUE=0 AND ALLTRIM(THISFORM.TXTF09.VALUE)='H'  AND THISFORM.TXTF15.VALUE<IIF(INDEXSEEK('G'+THISFORM.TXTF07.VALUE,.T.,'S00','S003'),S00.F62,0)
      =MESSAGEBOX('請假基數為'+ALLTRIM(TRANSFORM(S00.F62,'@R 999.9'))+'小時,故請假時數不得小於請假基數!',0+64,'提示視窗')
      THISFORM.TXTF14.SETFOCUS
      RETURN
   ENDIF	
   **************判斷是否超過年度可請假數
   DO CASE
      CASE ALLTRIM(THISFORM.TXTF09.VALUE)='D'	&&計數單位(D:日,H:小時,S:次)  
           IF THISFORM.TXTF15.VALUE<>0
              DayCK=IIF(Day_Hour1=0,0,ROUND(THISFORM.TXTF15.VALUE/Day_Hour1,1))+THISFORM.TXTF14.VALUE	
           ELSE
              DayCK=THISFORM.TXTF14.VALUE	                        
           ENDIF
      CASE ALLTRIM(THISFORM.TXTF09.VALUE)='H'          
           IF THISFORM.TXTF14.VALUE<>0
              DayCK=(THISFORM.TXTF14.VALUE*Day_Hour1)+THISFORM.TXTF15.VALUE
           ELSE
              DayCK=THISFORM.TXTF15.VALUE	 
           ENDIF   
      CASE ALLTRIM(THISFORM.TXTF09.VALUE)='S'      
           DayCK=1          
    ENDCASE 
    IF THISFORM.TXTF07.VALUE='A1' &&判斷是否為年假
*!*	       SELECT S05
*!*	       SET ORDER TO S051
*!*	       SEEK THISFORM.TXTF03.VALUE
*!*	       IF FOUND() AND S05.F11<DayCK+S05.F12
*!*	      	  =MESSAGEBOX('請假'+ACC_BASE(THISFORM.TXTF09.VALUE)+'數已超過年假可休之'+ACC_BASE(THISFORM.TXTF09.VALUE)+'數,請重新輸入!',0+64,'提示視窗')
*!*		      THISFORM.TXTF10.SETFOCUS
*!*		      RETURN         
*!*	       ENDIF
       SELECT S0A.F01,SUM(F07) FROM S0A WHERE F05='A1' AND LEFT(DTOS(F08),4)=LEFT(DTOS(DATE()),4)  GROUP BY S0A.F01 INTO CURSOR S0ABC
       INDE ON F01 TAG S0ABC1
       SET ORDER TO S0ABC1    
       SELECT S05
       SET ORDER TO S051
       SEEK THISFORM.TXTF03.VALUE
       IF FOUND() AND S05.F11 < (DayCK + IIF(SEEK(THISFORM.TXTF03.VALUE,'S0ABC'),S0ABC.SUM_F07,0))
      	  =MESSAGEBOX('請假'+ACC_BASE(THISFORM.TXTF09.VALUE)+'數已超過年假可休之'+ACC_BASE(THISFORM.TXTF09.VALUE)+'數,請重新輸入!',0+64,'提示視窗')   
      	  THISFORM.TXTF10.SETFOCUS 
      	  RETURN 
       ENDIF        
    ELSE
       SELECT S0A.F05,S0A.F06,S0A.F07,LEFT(DTOS(F08),4) FROM S0A WHERE ALLTRIM(F01)=ALLTRIM(THISFORM.TXTF03.VALUE) INTO CURSOR S0AA
       SELECT  S0AA.F05,S0AA.F06,SUM(S0AA.F07),S0AA.EXP_4 FROM S0AA GROUP BY F05,EXP_4 INTO CURSOR S0A_TEMP READWRITE 
       INDE ON EXP_4+F05 TAG S0A_TEMP1
       SELECT S0A_TEMP
       SET ORDER TO S0A_TEMP1
       SELECT S00
       SET ORDER TO S003
       SEEK 'G'+THISFORM.TXTF07.VALUE
       IF FOUND()
          IF YEAR(THISFORM.TXTF10.VALUE)=YEAR(THISFORM.TXTF11.VALUE)
             IF S00.F29<>0 AND S00.F29<IIF(SEEK(LEFT(DTOS(THISFORM.TXTF10.VALUE),4)+THISFORM.TXTF07.VALUE,'S0A_TEMP'),S0A_TEMP.SUM_F07,0)+DayCK
	 	        =MESSAGEBOX('請假'+ACC_BASE(THISFORM.TXTF09.VALUE)+'數已超過年度假別名稱('+ALLTRIM(THISFORM.TXTF08.VALUE)+')之可請假總'+ACC_BASE(THISFORM.TXTF09.VALUE)+'數,請查明後再輸入',0+64,'提示視窗')
		        THISFORM.TXTF10.SETFOCUS
		        RETURN   		 
	         ENDIF	
	      ENDIF                 
       ENDIF
       SELECT S0AA
       USE
       SELECT S0A_TEMP
       USE
    ENDIF      
    ******* 
    IF EMPTY(THISFORM.TXTF16.VALUE)
       =MESSAGEBOX('請假事由不得空白!',0+64,'提示視窗')
       THISFORM.TXTF16.SETFOCUS
       RETURN
    ENDIF      
    SELECT S18
    SET ORDER TO S181
    SEEK THISFORM.TXTF02.VALUE
    IF FOUND()
       REPLACE F07 WITH THISFORM.TXTF07.VALUE
       REPLACE F08 WITH THISFORM.TXTF08.VALUE
       REPLACE F09 WITH THISFORM.TXTF09.VALUE  
       REPLACE F10 WITH THISFORM.TXTF10.VALUE
       REPLACE F11 WITH THISFORM.TXTF11.VALUE
       REPLACE F12 WITH THISFORM.TXTF12.VALUE
	   REPLACE F13 WITH THISFORM.TXTF13.VALUE
       REPLACE F14 WITH THISFORM.TXTF14.VALUE
       REPLACE F15 WITH THISFORM.TXTF15.VALUE
       REPLACE F16 WITH THISFORM.TXTF16.VALUE
       REPLACE F17 WITH THISFORM.TXTF17.VALUE
       REPLACE F19 WITH sys_oper
       REPLACE F20 WITH IIF(LEFT(DTOS(THISFORM.TXTF10.VALUE),6)<>LEFT(DTOS(THISFORM.TXTF11.VALUE),6),'1','')
       REPLACE F99 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')       
    ENDIF
    SELECT S18_1
    IF RLOCK()
       REPLACE F07 WITH THISFORM.TXTF07.VALUE
       REPLACE F08 WITH THISFORM.TXTF08.VALUE
       REPLACE F09 WITH THISFORM.TXTF09.VALUE  
       REPLACE F10 WITH THISFORM.TXTF10.VALUE
       REPLACE F11 WITH THISFORM.TXTF11.VALUE
       REPLACE F12 WITH THISFORM.TXTF12.VALUE
	   REPLACE F13 WITH THISFORM.TXTF13.VALUE
       REPLACE F14 WITH THISFORM.TXTF14.VALUE
       REPLACE F15 WITH THISFORM.TXTF15.VALUE
       REPLACE F16 WITH THISFORM.TXTF16.VALUE
       REPLACE F17 WITH THISFORM.TXTF17.VALUE
       REPLACE F19 WITH sys_oper
       REPLACE F20 WITH IIF(LEFT(DTOS(THISFORM.TXTF10.VALUE),6)<>LEFT(DTOS(THISFORM.TXTF11.VALUE),6),'1','')
       REPLACE F99 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')          
    ELSE
       DO file_impact
       RETURN   
    ENDIF   
    THISFORM.SHRGROUP.ABANDON_BOTT.CLICK    
  ENDPROC
*******************
  PROCEDURE ORPGROUP.DEL_BOTT.CLICK
     IF MESSAGEBOX('是否確定要刪除此筆資料',4+32+256,'請確認') = 6	      
        SELECT S18_1
        LOCK()
        IF RLOCK()        
           SELECT S18_1
           PO_NO=S18_1.F02 
           SELECT S18
           SET ORDER TO S181   && F02
           SEEK PO_NO
           IF FOUND()
              SELECT S18
              DELETE 
              SELECT S18_1
	          DELETE 
	          UNLOCK
	          SKIP -1
	          IF BOF()
	             GO TOP
	          ENDIF                      
           ENDIF           
           IF SUBSTR(PO_NO,3,4)=SUBSTR(DTOS(DATE()),3,4)
              HD='S018 '+SUBSTR(PO_NO,3,4)+PO_NO
              DO ODR_RJT
           ENDIF   
           THISFORM.GRID1.SETFOCUS
           THISFORM.SHRGROUP.ABANDON_BOTT.CLICK
        ELSE
           DO file_impact    
        ENDIF
     ENDIF        
  ENDPROC
*************   
  PROCEDURE SHRGROUP.ABANDON_BOTT.CLICK
      SELECT S18_1
      THISFORM.SHRGROUP.ENABLED=.F.
      THISFORM.SHRGROUP.VISIBLE=.F.      
      THISFORM.ORPGROUP.ENABLED=.T.
      THISFORM.ORPGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
      THISFORM.CMDGROUP.ENABLED=.T.
      THISFORM.CMDGROUP.SETALL('ENABLED',.T.,'COMMANDBUTTON')
      THISFORM.CMDGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
      THISFORM.SETALL('READONLY',.T.,'TEXTBOX')   
      THISFORM.KEY_LIST.ENABLED=.T.     
      THISFORM.TXTF03.VISIBLE=.T.
      THISFORM.TXTF08.VISIBLE=.T.
      THISFORM.TXTF09.VISIBLE=.F.
      THISFORM.LBLF09.VISIBLE=.F.
      THISFORM.LBLF97.VISIBLE=.F.
      THISFORM.LBLF98.VISIBLE=.F.      
      THISFORM.COMBOBOX03.VISIBLE=.F.
      THISFORM.COMBOBOX08.VISIBLE=.F.
      THISFORM.GRID1.ENABLED=.T. 
      THISFORM.GRID1.SETFOCUS   
      IF THISFORM.GRID1.ACTIVEROW=0
          THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
          THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
          THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
          THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.       
          THISFORM.CMDGROUP.ENABLED=.F.
          THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
          THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
          THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
          THISFORM.LIST_BOTT.ENABLED=.F.   
          THISFORM.ANS_BOTT.ENABLED=.F.
	      THISFORM.INVERSE_BOTT.ENABLED=.F.
	      THISFORM.S16_BOTT.ENABLED=.F.
          THISFORM.LBLF10.VISIBLE=.T.
          THISFORM.LBLF12.VISIBLE=.T.
          THISFORM.TXTF10.VISIBLE=.T.
          THISFORM.TXTF11.VISIBLE=.T.
          THISFORM.TXTF12.VISIBLE=.T.
          THISFORM.TXTF13.VISIBLE=.T.	  
          THISFORM.TXTF01.VALUE=''
          THISFORM.TXTF02.VALUE=''
          THISFORM.TXTF03.VALUE=''
          THISFORM.TXTF04.VALUE=''  
          THISFORM.TXTF05.VALUE=''
          THISFORM.TXTF06.VALUE=''     
          THISFORM.TXTF07.VALUE=''
          THISFORM.TXTF08.VALUE=''
          THISFORM.TXTF09.VALUE=''
          THISFORM.TXTF10.VALUE=''
          THISFORM.TXTF11.VALUE=''
          THISFORM.TXTF12.VALUE=''
          THISFORM.TXTF13.VALUE=''
          THISFORM.TXTF14.VALUE=''
          THISFORM.TXTF15.VALUE=''
          THISFORM.TXTF16.VALUE=''
          THISFORM.TXTF17.VALUE=''
          THISFORM.LBLF011.CAPTION=''
          THISFORM.LBLF09.CAPTION=''
          THISFORM.LBLF181.CAPTION=''
          THISFORM.LBLF97.CAPTION=''
          THISFORM.LBLF98.CAPTION=''
          THISFORM.LBLF991.CAPTION=''
       ELSE
          THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
          THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
          THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
          THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.            
          THISFORM.CMDGROUP.ENABLED=.T.      
          THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  AND IIF(S18_1.F18<>'Y',.T.,.F.) AND EMPTY(S18_1.F21) = .T. &&判斷有無修改的權限
          THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)   AND IIF(S18_1.F18<>'Y',.T.,.F.) &&判斷有無刪除的權限
          THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限
          THISFORM.LIST_BOTT.ENABLED=IIF(A02.F11='*',.T.,.F.)   &&判斷有無列印明細的權限   
          THISFORM.ANS_BOTT.ENABLED=IIF(A02.F08='*',.T.,.F.)  AND IIF(S18_1.F18<>'Y',.T.,.F.) AND IIF(EMPTY(S18_1.F21) = .T.,.T.,.F.)   &&判斷有無確認的權限
          THISFORM.INVERSE_BOTT.ENABLED=IIF(A02.F09='*',.T.,.F.)   AND IIF(S18_1.F18<>'Y',.F.,.T.) AND IIF(EMPTY(S18_1.F21) = .T.,.T.,.F.) &&判斷有反確認的權限
          THISFORM.S16_BOTT.ENABLED=IIF(A02.F12='*',.T.,.F.)   &&查看S16.出勤紀錄權限
       ENDIF     
       UNLOCK ALL  
  ENDPROC
  ********
  PROCEDURE SHRGROUP.FINISH_BOTT.CLICK 
       IF SUBSTR(PO_NO,3,4)=SUBSTR(DTOS(DATE()),3,4)
          HD='S018 '+SUBSTR(PO_NO,3,4)+PO_NO
          DO ODR_RJT
       ENDIF   
       SELECT S18_1
       THISFORM.SHRGROUP.ABANDON_BOTT.CLICK
  ENDPROC     
********* 員工姓名  
  PROCEDURE  TXTF04.INTERACTIVECHANGE
       THISFORM.TXTF03.VALUE=IIF(INDEXSEEK(THIS.VALUE,.T.,'S05','S052'),S05.F01,'')
       THISFORM.TXTF05.VALUE=IIF(INDEXSEEK(THIS.VALUE,.T.,'S05','S052'),S05.F05,'')
       THISFORM.TXTF06.VALUE=IIF(INDEXSEEK(THIS.VALUE,.T.,'S05','S052'),S05.F06,'') 	
       THISFORM.TXTF12.VALUE=IIF(INDEXSEEK(THIS.VALUE,.T.,'S05','S052'),IIF(INDEXSEEK('I'+S05.F29,.T.,'S00','S005'),S00.F50,''),'')     
       THISFORM.TXTF13.VALUE=IIF(INDEXSEEK(THIS.VALUE,.T.,'S05','S052'),IIF(INDEXSEEK('I'+S05.F29,.T.,'S00','S005'),S00.F51,''),'')              
       THISFORM.LBLF97.CAPTION=IIF(INDEXSEEK(THIS.VALUE,.T.,'S05','S052'),IIF(INDEXSEEK('I'+S05.F29,.T.,'S00','S005'),'班別時段：'+S00.F50+' ∼ '+S00.F51,''),'')     
       THISFORM.LBLF98.CAPTION=IIF(INDEXSEEK(THIS.VALUE,.T.,'S05','S052'),IIF(INDEXSEEK('I'+S05.F29,.T.,'S00','S005'),'休息時段：'+S00.F52+' ∼ '+S00.F53,''),'')       
  ENDPROC 
  *****請假起始日期   
  PROCEDURE TXTF10.INTERACTIVECHANGE
       IF EMPTY(THIS.VALUE)=.F.
          Day_Hour=IIF(INDEXSEEK(THISFORM.TXTF03.VALUE,.T.,'S05','S051'),IIF(INDEXSEEK('I'+S05.F29,.T.,'S00','S005'),S00.F57,0),0)	&&上班總時數
          Base_No=IIF(INDEXSEEK('G'+THISFORM.TXTF07.VALUE,.T.,'S00','S003'),S00.F62,0)	&&請假基數  
          THISFORM.TXTF15.VALUE=DAY_NO(THISFORM.TXTF03.VALUE,THISFORM.TXTF10.VALUE,THISFORM.TXTF11.VALUE,THISFORM.TXTF12.VALUE,THISFORM.TXTF13.VALUE,THISFORM.TXTF07.VALUE)
          THISFORM.TXTF14.VALUE=IIF(Day_Hour=0,0,INT(THISFORM.TXTF15.VALUE/Day_Hour))
          **判斷是否超過請假基數
          Hour_F15=IIF(Day_Hour=0,0,MOD(THISFORM.TXTF15.VALUE,Day_Hour))
          IF Base_No=0
             THISFORM.TXTF15.VALUE=Hour_F15
          ELSE
             DO CASE
                CASE THISFORM.TXTF09.VALUE='D'	&&計數單位(D:日,H:小時,S:次)  
                     DO CASE
                        CASE Hour_F15<=(Base_No*Day_Hour) AND Hour_F15<>0
                             THISFORM.TXTF14.VALUE=THISFORM.TXTF14.VALUE+Base_No
                        CASE Hour_F15>(Base_No*Day_Hour) AND  Hour_F15<Day_Hour
                             THISFORM.TXTF14.VALUE=THISFORM.TXTF14.VALUE+Base_No
                        CASE Hour_F15>(Base_No*Day_Hour) 
                             THISFORM.TXTF14.VALUE=THISFORM.TXTF14.VALUE+1           
                     ENDCASE	
                     THISFORM.TXTF15.VALUE=0                                        
*!*	                     DO CASE 
*!*	                        CASE Base_No=0.5
*!*			                     IF BETWEEN(ALLTRIM(THISFORM.TXTF12.VALUE),ALLTRIM(S00_F50),ALLTRIM(S00_F52)) OR;
*!*			                        BETWEEN(ALLTRIM(THISFORM.TXTF13.VALUE),ALLTRIM(S00_F51),ALLTRIM(S00_F53))
*!*			                        THISFORM.TXTF15.VALUE=0.5 
*!*			                     ENDIF
*!*	                        CASE Base_No=1
*!*	                             IF ALLTRIM(THISFORM.TXTF12.VALUE)=ALLTRIM(S00_F50) AND ALLTRIM(THISFORM.TXTF13.VALUE)=ALLTRIM(S00_F51)
*!*	                                THISFORM.TXTF15.VALUE=1
*!*	                             ENDIF
*!*	                        OTHERWISE 
*!*	                             THISFORM.TXTF15.VALUE=Base_No       
*!*	                     ENDCASE
*!*	                     DO CASE
*!*	                        CASE Hour_F15<=(Base_No*Day_Hour) AND Hour_F15<>0
*!*	                             THISFORM.TXTF15.VALUE=Base_No*Day_Hour  
*!*	                        CASE Hour_F15>(Base_No*Day_Hour)
*!*	                             THISFORM.TXTF14.VALUE=THISFORM.TXTF14.VALUE+1
*!*	                             THISFORM.TXTF15.VALUE=0
*!*	                     ENDCASE
                CASE THISFORM.TXTF09.VALUE='H'  OR THISFORM.TXTF09.VALUE='S'          
                     DO CASE
                        CASE Hour_F15<=Base_No AND Hour_F15<>0
                             THISFORM.TXTF15.VALUE=Base_No    
                        CASE Hour_F15>Base_No
                             THISFORM.TXTF15.VALUE=Hour_F15
                     ENDCASE
             ENDCASE     
          ENDIF	
          IF Hour_F15=0
             THISFORM.TXTF15.VALUE=0
          ENDIF           
      ENDIF		
  ENDPROC   
  *****請假截止日期   
  PROCEDURE  TXTF11.INTERACTIVECHANGE         
       IF EMPTY(THIS.VALUE)=.F.
          Day_Hour=IIF(INDEXSEEK(THISFORM.TXTF03.VALUE,.T.,'S05','S051'),IIF(INDEXSEEK('I'+S05.F29,.T.,'S00','S005'),S00.F57,0),0)	&&上班總時數
          Base_No=IIF(INDEXSEEK('G'+THISFORM.TXTF07.VALUE,.T.,'S00','S003'),S00.F62,0)	&&請假基數  
          THISFORM.TXTF15.VALUE=DAY_NO(THISFORM.TXTF03.VALUE,THISFORM.TXTF10.VALUE,THISFORM.TXTF11.VALUE,THISFORM.TXTF12.VALUE,THISFORM.TXTF13.VALUE,THISFORM.TXTF07.VALUE)
          THISFORM.TXTF14.VALUE=IIF(Day_Hour=0,0,INT(THISFORM.TXTF15.VALUE/Day_Hour))
          **判斷是否超過請假基數
          Hour_F15=IIF(Day_Hour=0,0,MOD(THISFORM.TXTF15.VALUE,Day_Hour))
          IF Base_No=0
             THISFORM.TXTF15.VALUE=Hour_F15
          ELSE
             DO CASE
                CASE THISFORM.TXTF09.VALUE='D'	&&計數單位(D:日,H:小時,S:次)  
                     DO CASE
                        CASE Hour_F15<=(Base_No*Day_Hour) AND Hour_F15<>0
                             THISFORM.TXTF14.VALUE=THISFORM.TXTF14.VALUE+Base_No
                        CASE Hour_F15>(Base_No*Day_Hour) AND  Hour_F15<Day_Hour
                             THISFORM.TXTF14.VALUE=THISFORM.TXTF14.VALUE+Base_No
                        CASE Hour_F15>(Base_No*Day_Hour) 
                             THISFORM.TXTF14.VALUE=THISFORM.TXTF14.VALUE+1           
                     ENDCASE	
                     THISFORM.TXTF15.VALUE=0   
                CASE THISFORM.TXTF09.VALUE='H' OR THISFORM.TXTF09.VALUE='S'           
                     DO CASE
                        CASE Hour_F15<=Base_No AND Hour_F15<>0
                             THISFORM.TXTF15.VALUE=Base_No    
                        CASE Hour_F15>Base_No
                             THISFORM.TXTF15.VALUE=Hour_F15
                     ENDCASE        
             ENDCASE
          ENDIF	
          IF Hour_F15=0
             THISFORM.TXTF15.VALUE=0
          ENDIF           
       ENDIF	
  ENDPROC    
  *****請假起始時間    
  PROCEDURE TXTF12.INTERACTIVECHANGE
       Day_Hour=IIF(INDEXSEEK(THISFORM.TXTF03.VALUE,.T.,'S05','S051'),IIF(INDEXSEEK('I'+S05.F29,.T.,'S00','S005'),S00.F57,0),0)	&&上班總時數
       Base_No=IIF(INDEXSEEK('G'+THISFORM.TXTF07.VALUE,.T.,'S00','S003'),S00.F62,0)	&&請假基數  
       THISFORM.TXTF15.VALUE=DAY_NO(THISFORM.TXTF03.VALUE,THISFORM.TXTF10.VALUE,THISFORM.TXTF11.VALUE,THISFORM.TXTF12.VALUE,THISFORM.TXTF13.VALUE,THISFORM.TXTF07.VALUE)
       THISFORM.TXTF14.VALUE=IIF(Day_Hour=0,0,INT(THISFORM.TXTF15.VALUE/Day_Hour))
       **判斷是否超過請假基數
       Hour_F15=IIF(Day_Hour=0,0,MOD(THISFORM.TXTF15.VALUE,Day_Hour))
       IF Base_No=0
          THISFORM.TXTF15.VALUE=Hour_F15
       ELSE
          DO CASE
             CASE THISFORM.TXTF09.VALUE='D'	&&計數單位(D:日,H:小時,S:次)  
                  DO CASE
                     CASE Hour_F15<=(Base_No*Day_Hour) AND Hour_F15<>0
                          THISFORM.TXTF14.VALUE=THISFORM.TXTF14.VALUE+Base_No
                     CASE Hour_F15>(Base_No*Day_Hour) AND  Hour_F15<Day_Hour
                          THISFORM.TXTF14.VALUE=THISFORM.TXTF14.VALUE+Base_No
                     CASE Hour_F15>(Base_No*Day_Hour) 
                          THISFORM.TXTF14.VALUE=THISFORM.TXTF14.VALUE+1           
                  ENDCASE	
                  THISFORM.TXTF15.VALUE=0   	
             CASE THISFORM.TXTF09.VALUE='H'  OR THISFORM.TXTF09.VALUE='S'          
                  DO CASE
                     CASE Hour_F15<=Base_No AND Hour_F15<>0
                          THISFORM.TXTF15.VALUE=Base_No    
                     CASE Hour_F15>Base_No
                          THISFORM.TXTF15.VALUE=Hour_F15
                  ENDCASE        
          ENDCASE
       ENDIF	
       IF Hour_F15=0
          THISFORM.TXTF15.VALUE=0
       ENDIF           
 ENDPROC   
  *****請假截止時間   
  PROCEDURE TXTF13.INTERACTIVECHANGE         
       Day_Hour=IIF(INDEXSEEK(THISFORM.TXTF03.VALUE,.T.,'S05','S051'),IIF(INDEXSEEK('I'+S05.F29,.T.,'S00','S005'),S00.F57,0),0)	&&上班總時數
       Base_No=IIF(INDEXSEEK('G'+THISFORM.TXTF07.VALUE,.T.,'S00','S003'),S00.F62,0)	&&請假基數  
       THISFORM.TXTF15.VALUE=DAY_NO(THISFORM.TXTF03.VALUE,THISFORM.TXTF10.VALUE,THISFORM.TXTF11.VALUE,THISFORM.TXTF12.VALUE,THISFORM.TXTF13.VALUE,THISFORM.TXTF07.VALUE)
       THISFORM.TXTF14.VALUE=IIF(Day_Hour=0,0,INT(THISFORM.TXTF15.VALUE/Day_Hour))
       **判斷是否超過請假基數
       Hour_F15=IIF(Day_Hour=0,0,MOD(THISFORM.TXTF15.VALUE,Day_Hour))
       IF Base_No=0
          THISFORM.TXTF15.VALUE=Hour_F15
       ELSE
          DO CASE
             CASE THISFORM.TXTF09.VALUE='D'	&&計數單位(D:日,H:小時,S:次)  
                  DO CASE
                     CASE Hour_F15<=(Base_No*Day_Hour) AND Hour_F15<>0
                          THISFORM.TXTF14.VALUE=THISFORM.TXTF14.VALUE+Base_No
                     CASE Hour_F15>(Base_No*Day_Hour) AND  Hour_F15<Day_Hour
                          THISFORM.TXTF14.VALUE=THISFORM.TXTF14.VALUE+Base_No
                     CASE Hour_F15>(Base_No*Day_Hour) 
                          THISFORM.TXTF14.VALUE=THISFORM.TXTF14.VALUE+1           
                  ENDCASE	
                  THISFORM.TXTF15.VALUE=0   
             CASE THISFORM.TXTF09.VALUE='H' OR THISFORM.TXTF09.VALUE='S'         
                  DO CASE
                     CASE Hour_F15<=Base_No AND Hour_F15<>0
                          THISFORM.TXTF15.VALUE=Base_No    
                     CASE Hour_F15>Base_No
                          THISFORM.TXTF15.VALUE=Hour_F15
                  ENDCASE        
          ENDCASE
       ENDIF	
       IF Hour_F15=0
          THISFORM.TXTF15.VALUE=0
       ENDIF           	
  ENDPROC  
********** 確認程序 
****此請假作業確認後與S10.薪資計算作業中的缺勤項目不同,兩者將各自寫到S0A.年度缺勤紀錄中,但在S10中則可新增由S18所確認之請假資料
  PROCEDURE ANS_BOTT.CLICK
       IF MESSAGEBOX('是否要確認此筆資料?',4+32+256,'請確認') = 6
          SELECT S18_1
          IF S18_1.F13='Y'
             =MESSAGEBOX('此筆資料已確認過,請查明後再作確認!',0+64,'提示訊息視窗')
		     THISFORM.GRID1.SETFOCUS  
		     RETURN
          ELSE
             S05_F29 = IIF(INDEXSEEK(S18_1.F03,.T.,'S05','S051'),S05.F29,'')
             Day_Hour = IIF(INDEXSEEK('I'+S05_F29,.T.,'S00','S005'),S00.F57,0)	&&上班總時數
             IF S18_1.F07 = 'A1'	&&若為年假
		        SELECT S05
		        SET ORDER TO S051
		        SEEK S18_1.F03
		        IF FOUND() AND  (S05.F11 - (S05.F12 + S18_1.F14 + IIF(Day_Hour = 0,0,ROUND(S18_1.F15 / Day_Hour,1)))) < 0
		           =MESSAGEBOX('此人員可能已超過可請之年假天數,請至S05.人事薪資基本檔中查明!',0+64,'提示訊息視窗')
		           THISFORM.GRID1.SETFOCUS
		           RETURN
		        ENDIF
             ENDIF
             LOCK()
             IF RLOCK()
			    S05_F29 = IIF(INDEXSEEK(S18_1.F03,.T.,'S05','S051'),S05.F29,'')			&&班別
			    Day_Hour = IIF(INDEXSEEK('I' + S05_F29,.T.,'S00','S005'),S00.F57,0)		&&上班總時數
		   	    Base_No = IIF(INDEXSEEK('G' + THISFORM.TXTF07.VALUE,.T.,'S00','S003'),S00.F62,0)		&&請假基數
			    S00_F50 = IIF(INDEXSEEK('I' + S05_F29,.T.,'S00','S005'),S00.F50,'')		&&班別:上班時段
			    S00_F51 = IIF(INDEXSEEK('I' + S05_F29,.T.,'S00','S005'),S00.F51,'')		&&班別:下班時段
			    S00_F52 = IIF(INDEXSEEK('I' + S05_F29,.T.,'S00','S005'),S00.F52,'')		&&班別:休息時段起
			    S00_F53 = IIF(INDEXSEEK('I' + S05_F29,.T.,'S00','S005'),S00.F53,'')		&&班別:休息時段止
			    S16_F08 = IIF(INDEXSEEK('I' + S05_F29,.T.,'S00','S005'),S00.F54,'')		&&上班遲到緩衝時間
			    S16_F08_H = VAL(LEFT(ALLTRIM(S16_F08),2))		&&上班遲到緩衝時間(時)
			    S16_F08_M = VAL(RIGHT(ALLTRIM(S16_F08),2))   	&&上班遲到緩衝時間(分)
			    S16_F09 = IIF(INDEXSEEK('I' + S05_F29,.T.,'S00','S005'),S00.F55,'')		&&下班早退緩衝時間
			    S16_F09_H = VAL(LEFT(ALLTRIM(S16_F09),2))		&&下班早退緩衝時間(時)
			    S16_F09_M = VAL(RIGHT(ALLTRIM(S16_F09),2))   	&&下班早退緩衝時間(分)
		        ***判斷是否有跨月
		        IF S18_1.F20<>'1' 	&&無跨月
		           S10='S10'+LEFT(DTOS(S18_1.F10),6)
		           S101='S101'+LEFT(DTOS(S18_1.F10),6)
		           IF FILE(S10+'.DBF')=.T.
		              IF !USED('&S10')
		                 SELECT  0
			             USE (S10) ALIA S10
		              ELSE
			             SELECT  S10
			          ENDIF
			          SET ORDER TO S101
			          SEEK S18_1.F03
			          IF FOUND()
			             IF S10.F98='Y'
			                =MESSAGEBOX('此人員已在'+LEFT(DTCX(S18_1.F10),7-INT_012)+'之S10.薪資計算作業中已確認,故無法執行確認!',0+64,'提示視窗')
			                SELECT S10
			                USE
			                THISFORM.GRID1.SETFOCUS
			                RETURN
			             ELSE
			                =MESSAGEBOX('此人員已在'+LEFT(DTCX(S18_1.F10),7-INT_012)+'之S10 薪資計算作業中已有資料,故不得執行確認,請至S10刪除基本考勤資料後才可確認!',0+64,'提示視窗')
			                SELECT S10
			                USE
			                THISFORM.GRID1.SETFOCUS
			                RETURN
			             ENDIF
			          ENDIF
			          SELECT S10
			          USE
			       ENDIF
			       *******
		           S16='S16'+LEFT(DTOS(S18_1.F10),6)
			       S161='S161'+LEFT(DTOS(S18_1.F10),6)
			       IF FILE(S16+'.DBF')=.T.
			          IF !USED('&S16')	&&上下班紀錄檔
					     SELECT 0
					     USE (S16) ALIA S16
			          ELSE
				         SELECT S16
			          ENDIF
			          SET ORDER TO S161
			          SEEK S18_1.F03
			          IF FOUND() 
			             IF S16.F19='Y'
			                =MESSAGEBOX('此人員已在'+LEFT(DTCX(S18_1.F10),7-INT_012)+'之S16.上下班紀錄作業中已確認,故無法執行確認!',0+64,'提示視窗')
			                SELECT S16
			                USE
			                THISFORM.GRID1.SETFOCUS
			                RETURN
			             ELSE
		                    FOR I=0 TO DAY(S18_1.F11) - DAY(S18_1.F10)
		                        SELECT S16
		                        SEEK S18_1.F03+PADL(ALLTRIM(STR(I+DAY(S18_1.F10))),2,'0')
		                        IF FOUND() 
*!*			                           REPLACE S16.F13 WITH ''
*!*			                           REPLACE S16.F14 WITH ''
		                           REPLACE S16.F15 WITH 0
		                           REPLACE S16.F16 WITH 0
		                           REPLACE S16.F17 WITH 0
	                               REPLACE S16.F23 WITH S18_1.F02
	                               REPLACE S16.F24 WITH IIF(DAY(S18_1.F10)=(I+DAY(S18_1.F10)),S18_1.F12,ALLTRIM(S00_F50))	&&請假起始時間
	                               REPLACE S16.F25 WITH IIF((I+DAY(S18_1.F10))=DAY(S18_1.F11),S18_1.F13,ALLTRIM(S00_F51))	&&請假截止時間
*!*			                           REPLACE S16.F26 WITH ''
*!*		                               REPLACE S16.F27 WITH ''
*!*		                               REPLACE S16.F28 WITH ''
	                               REPLACE S16.F29 WITH S16.F11		&&請假前之上班時間
	                               REPLACE S16.F30 WITH S16.F12		&&請假前之下班時間
								   S16_F11_H = VAL(LEFT(ALLTRIM(S16.F11),2))		&&上班時間(時)
								   S16_F11_M = VAL(RIGHT(ALLTRIM(S16.F11),2))		&&上班時間(分)
								   S16_F12_H = VAL(LEFT(ALLTRIM(S16.F12),2))		&&下班時間(時)
								   S16_F12_M = VAL(RIGHT(ALLTRIM(S16.F12),2))		&&下班時間(分)
		                           *****調整上下班時間
						           DO CASE
						              CASE S16.F24 = S16.F06 AND S16.F25 = S16.F07	&&請整天
						                   REPLACE S16.F11 WITH ''
						                   REPLACE S16.F12 WITH ''
						              CASE S16.F24 <> S16.F06 AND S16.F25 = S16.F07
						                   REPLACE S16.F12 WITH S16.F24
						              CASE S16.F24 = S16.F06 AND S16.F25 <> S16.F07
						                   REPLACE S16.F11 WITH S16.F25
						           ENDCASE
						           IF !EMPTY(S16.F11) AND !EMPTY(S16.F12) AND !EMPTY(S00_F52) AND !EMPTY(S00_F53)
						              IF BETWEEN(S16.F11,S00_F52,S00_F53) AND S16.F12 > S00_F53
						                 REPLACE S16.F11 WITH S00_F53
						              ENDIF
						              IF BETWEEN(S16.F12,S00_F52,S00_F53) AND S16.F11 < S00_F52
						                 REPLACE S16.F12 WITH S00_F52
						              ENDIF
						           ENDIF
						           *****整理非假日補班之請假
						           HK = ALLTRIM(LEFT(DTCX(S18_1.F10),7-INT_012))
								   IF S16.F18 = 1 OR S16.F18 = 7			&&假日
								      IF IIF(INDEXSEEK(DTOS(CTOD(HK + '/' + S16.F01)),.T.,'S15','S151'),S15.F03 <> '2',.T.) = .T.		&&假日補班
							   	  	 	 IF !EMPTY(S16.F23)
							   	  	 	    REPLACE S16.F23 WITH ''
							   	  	 	    REPLACE S16.F24 WITH ''
							   	  	 	    REPLACE S16.F25 WITH ''
							   	  	 	 ENDIF
								      ENDIF
								   ENDIF
								   *****計算遲到分鐘數
								   IF S16.F11 >= S16.F08 AND !EMPTY(S16.F11) AND !EMPTY(S16.F08)
								      DO CASE
								         CASE S16_F11_M >= S16_F08_M
								              REPLACE S16.F15 WITH ((S16_F11_H - S16_F08_H) * 60) + (S16_F11_M - S16_F08_M)
								         CASE S16_F12_M < S16_F08_M
								              REPLACE S16.F15 WITH ((S16_F11_H - S16_F08_H) * 60) - (S16_F08_M - S16_F11_M)
								      ENDCASE
								   ENDIF
								   **判斷是否有請假
								   IF !EMPTY(S16.F23) AND S16.F11 >= S16.F25 AND !EMPTY(S16.F11)
								   	   REPLACE S16.F15 WITH 0
								   ENDIF
								   **無上班時間則遲到為零
								   IF EMPTY(S16.F11)
									  REPLACE S16.F15 WITH 0
								   ENDIF
								   *****計算早退分鐘數
								   IF S16.F12 <= S16.F09 AND !EMPTY(S16.F12) AND !EMPTY(S16.F09)
								      DO CASE
								         CASE S16_F12_M <= S16_F09_M
								              REPLACE S16.F16 WITH ((S16_F09_H - S16_F12_H) * 60) + (S16_F09_M - S16_F12_M)
								         CASE S16_F12_M > S16_F09_M
								              REPLACE S16.F16 WITH ((S16_F09_H - S16_F12_H) * 60) - (S16_F12_M - S16_F09_M)
								      ENDCASE
								   ENDIF
								   **無下班時間則早退為零
								   IF EMPTY(S16.F12)
									  REPLACE S16.F16 WITH 0
								   ENDIF
								   **判斷是否有請假
								   IF !EMPTY(S16.F23) AND S16.F12 <= S16.F25 AND !EMPTY(S16.F12)
								   	  REPLACE S16.F16 WITH 0
								   ENDIF
								ENDIF
		                    ENDFOR
		                 ENDIF
		              ENDIF
		              SELECT S16
		              USE
		           ENDIF
		       	   S0A_F08 = S18_1.F10
*!*		        	   **若為年假則判斷是否已扣完
*!*				       IF S18_1.F07 = 'A1'
*!*				          SELECT S05
*!*				          SET ORDER TO S051
*!*				          SEEK S18_1.F03
*!*				          IF FOUND()
*!*					         REPLACE S05.F12 WITH S05.F12 + S18_1.F14 + IIF(Day_Hour = 0,0,ROUND(S18_1.F15 / Day_Hour,1))
*!*					         IF (S05.F11 - S05.F12) < 0
*!*					             S0A_F08 =  CTOD(ALLTRIM(STR(YEAR(S18_1.F10) + 1)) + '/01/01')	&&若已無年假可扣,則扣到下各年度之1月份
*!*					         ENDIF
*!*			              ENDIF
*!*			           ENDIF
		           ***寫入缺勤紀錄檔
		           SELECT S0A
		           SET ORDER TO S0A1
		           SEEK S18_1.F03 + S18_1.F07 + ALLTRIM(LEFT(DTOS(S0A_F08),6) + '01') + S18_1.F09 + S18_1.F02
		           IF FOUND()
		              DO CASE		&&缺勤單位 D=日,H=小時,S=次
		                 CASE S0A.F09='D'
		                      REPLACE S0A.F07 WITH S0A.F07+S18_1.F14+IIF(Day_Hour=0,0,ROUND(S18_1.F15/Day_Hour,1))
		                 CASE S0A.F09='H'
		                      REPLACE S0A.F07 WITH S0A.F07+S18_1.F15+(Day_Hour*S18_1.F14)
		                 CASE S0A.F09='S'
		               	      REPLACE S0A.F07 WITH S0A.F07+1
		              ENDCASE
		           ELSE
		              SELECT S0A
			          APPEND BLANK 
			          REPLACE S0A.F01 WITH S18_1.F03
			          REPLACE S0A.F02 WITH S18_1.F04
			          REPLACE S0A.F03 WITH S18_1.F05
			          REPLACE S0A.F04 WITH S18_1.F06
			          REPLACE S0A.F05 WITH S18_1.F07
			          REPLACE S0A.F06 WITH S18_1.F08
			          REPLACE S0A.F08 WITH S0A_F08
			          REPLACE S0A.F09 WITH S18_1.F09
			          DO CASE		&&缺勤單位 D=日,H=小時,S=次
		                 CASE S0A.F09='D'
		                      REPLACE S0A.F07 WITH S0A.F07+S18_1.F14+IIF(Day_Hour=0,0,ROUND(S18_1.F15/Day_Hour,1))
		                 CASE S0A.F09='H'
		                      REPLACE S0A.F07 WITH S0A.F07+S18_1.F15+(Day_Hour*S18_1.F14)
		                 CASE S0A.F09='S'
		               	      REPLACE S0A.F07 WITH S0A.F07+1
		              ENDCASE
		              REPLACE S0A.F10 WITH S18_1.F02
		           ENDIF
		           REPLACE S0A.F99 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
*!*		               ***若為年假
*!*				       IF S18_1.F07='A1'
*!*				          SELECT S05
*!*				          SET ORDER TO S051
*!*				          SEEK S18_1.F03
*!*				          IF FOUND()
*!*					         REPLACE S05.F12 WITH S05.F12+S18_1.F14+IIF(Day_Hour=0,0,ROUND(S18_1.F15/Day_Hour,1))
*!*				          ENDIF
*!*				       ENDIF
		     **************************
	            ELSE  	&&有跨月
 		           IF (MONTH(S18_1.F11)+1)<13
 		              EndDate=ALLTRIM(STR(YEAR(S18_1.F11)))+PADL(ALLTRIM(STR(MONTH(S18_1.F11)+1)),2,'0')
 		           ELSE
 		              EndDate=ALLTRIM(STR(YEAR(S18_1.F11)+1))+'01'
 		           ENDIF
 		           StarDate=LEFT(DTOS(S18_1.F10),6)
 		           StarDate1=StarDate
 		           ***先判斷S10.薪資計算作業與S16.上下班紀錄作業中是否已有資料或確認
 		           DO WHILE ALLTRIM(StarDate1)<>ALLTRIM(EndDate)
                      S10='S10'+ALLTRIM(StarDate1)
                      S101='S101'+ALLTRIM(StarDate1)
                      IF FILE(S10+'.DBF')=.T.
                         IF !USED('&S10')
                            SELECT  0
	                        USE (S10) ALIA S10
                         ELSE
	                        SELECT  S10
	                     ENDIF
	                     SET ORDER TO S101
	                     SEEK S18_1.F03
		                 IF FOUND()
		                    IF S10.F98='Y'
		                       =MESSAGEBOX('此人員已在'+ALLTRIM(STR(VAL(LEFT(StarDate1,4))-1911))+'/'+RIGHT(StarDate1,2)+'之S10.薪資計算作業中已確認,故無法執行確認!',0+64,'提示視窗')
	                           SELECT S10
	                           USE
	                           THISFORM.GRID1.SETFOCUS
	                           RETURN	
	                        ELSE   
	                           =MESSAGEBOX('此人員已在'+ALLTRIM(STR(VAL(LEFT(StarDate1,4))-1911))+'/'+RIGHT(StarDate1,2)+'之S10.薪資計算作業中已有資料,故不得執行確認,請至S10刪除基本考勤資料後才可確認!',0+64,'提示視窗')
	                           SELECT S10
	                           USE
	                           THISFORM.GRID1.SETFOCUS
	                           RETURN
	                        ENDIF
		                 ENDIF
		                 SELECT S10
		                 USE
		              ENDIF
	                  S16='S16'+ALLTRIM(StarDate1)
		              S161='S161'+ALLTRIM(StarDate1)
		              IF FILE(S16+'.DBF')=.T.
		                 IF !USED('&S16')	&&上下班紀錄檔
			                SELECT  0
			                USE (S16) ALIA S16
		                 ELSE
			                SELECT  S16
		                 ENDIF
		                 SET ORDER TO S161
		                 SEEK S18_1.F03
		                 IF FOUND() AND S16.F19='Y'
		                    =MESSAGEBOX('此人員已在'+ALLTRIM(STR(VAL(LEFT(StarDate1,4))-1911))+'/'+RIGHT(StarDate1,2)+'之S16.上下班紀錄作業中已確認,故無法執行確認!',0+64,'提示視窗')
		                    SELECT S16
		                    USE
		                    THISFORM.GRID1.SETFOCUS
		                    RETURN	
		                 ENDIF
		                 SELECT S16
		                 USE
		              ENDIF
		 		      IF (VAL(RIGHT(StarDate1,2))+1)<13
		 		         StarDate1=LEFT(StarDate1,4)+PADL(ALLTRIM(STR((VAL(RIGHT(StarDate1,2))+1))),2,'0')
		 		      ELSE
		 		         StarDate1=ALLTRIM(STR(VAL(LEFT(StarDate1,4))+1))+'01'
		 		      ENDIF
 		           ENDDO
 		           ******************
	               DO WHILE ALLTRIM(StarDate)<>ALLTRIM(EndDate)
	                  S16='S16'+ALLTRIM(StarDate)
		              S161='S161'+ALLTRIM(StarDate)
		              IF FILE(S16+'.DBF')=.T.
		                 IF !USED('&S16')	&&上下班紀錄檔
			                SELECT  0
			                USE (S16) ALIA S16
		                 ELSE
			                SELECT  S16
		                 ENDIF
		                 SET ORDER TO S161
		                 SEEK S18_1.F03
		                 IF FOUND() 	&&人員是否存在
		                    DO CASE
	                           CASE ALLTRIM(StarDate)=ALLTRIM(LEFT(DTOS(S18_1.F10),6)) AND  ALLTRIM(StarDate)<>ALLTRIM(LEFT(DTOS(S18_1.F11),6))
			                        FOR I=0 TO DAY(S18_1.F10)
			                            SELECT S16
			                            SEEK S18_1.F03 + PADL(ALLTRIM(STR(I+DAY(S18_1.F10))),2,'0')
			                            IF FOUND()
*!*					                           REPLACE S16.F13 WITH ''
*!*					                           REPLACE S16.F14 WITH ''
				                           REPLACE S16.F15 WITH 0
				                           REPLACE S16.F16 WITH 0
				                           REPLACE S16.F17 WITH 0
		                               	   REPLACE S16.F23 WITH S18_1.F02
			                               REPLACE S16.F24 WITH IIF(I=0,S18_1.F12,ALLTRIM(S00_F50))	
			                               REPLACE S16.F25 WITH ALLTRIM(S00_F51)
*!*					                           REPLACE S16.F26 WITH ''
*!*					                           REPLACE S16.F27 WITH ''
*!*					                           REPLACE S16.F28 WITH ''
				                           REPLACE S16.F29 WITH S16.F11		&&請假前之上班時間
				                           REPLACE S16.F30 WITH S16.F12		&&請假前之下班時間
										   S16_F11_H = VAL(LEFT(ALLTRIM(S16.F11),2))		&&上班時間(時)
										   S16_F11_M = VAL(RIGHT(ALLTRIM(S16.F11),2))		&&上班時間(分)
										   S16_F12_H = VAL(LEFT(ALLTRIM(S16.F12),2))		&&下班時間(時)
										   S16_F12_M = VAL(RIGHT(ALLTRIM(S16.F12),2))		&&下班時間(分)
				                           *****調整上下班時間
								           DO CASE
								              CASE S16.F24 = S16.F06 AND S16.F25 = S16.F07	&&請整天
								                   REPLACE S16.F11 WITH ''
								                   REPLACE S16.F12 WITH ''
								              CASE S16.F24 <> S16.F06 AND S16.F25 = S16.F07
								                   REPLACE S16.F12 WITH S16.F24
								              CASE S16.F24 = S16.F06 AND S16.F25 <> S16.F07
								                   REPLACE S16.F11 WITH S16.F25
								           ENDCASE
								           IF !EMPTY(S16.F11) AND !EMPTY(S16.F12) AND !EMPTY(S00_F52) AND !EMPTY(S00_F53)
								              IF BETWEEN(S16.F11,S00_F52,S00_F53) AND S16.F12 > S00_F53
								                 REPLACE S16.F11 WITH S00_F53
								              ENDIF
								              IF BETWEEN(S16.F12,S00_F52,S00_F53) AND S16.F11 < S00_F52
								                 REPLACE S16.F12 WITH S00_F52
								              ENDIF
								           ENDIF
								           *****整理非假日補班之請假
								           HK = ALLTRIM(LEFT(DTCX(S18_1.F10),7-INT_012))
										   IF S16.F18 = 1 OR S16.F18 = 7			&&假日
										      IF IIF(INDEXSEEK(DTOS(CTOD(HK + '/' + S16.F01)),.T.,'S15','S151'),S15.F03 <> '2',.T.) = .T.		&&假日補班
									   	  	 	 IF !EMPTY(S16.F23)
									   	  	 	    REPLACE S16.F23 WITH ''
									   	  	 	    REPLACE S16.F24 WITH ''
									   	  	 	    REPLACE S16.F25 WITH ''
									   	  	 	 ENDIF
										      ENDIF
										   ENDIF
										   *****計算遲到分鐘數
										   IF S16.F11 >= S16.F08 AND !EMPTY(S16.F11) AND !EMPTY(S16.F08)
										      DO CASE
										         CASE S16_F11_M >= S16_F08_M
										              REPLACE S16.F15 WITH ((S16_F11_H - S16_F08_H) * 60) + (S16_F11_M - S16_F08_M)
										         CASE S16_F12_M < S16_F08_M
										              REPLACE S16.F15 WITH ((S16_F11_H - S16_F08_H) * 60) - (S16_F08_M - S16_F11_M)
										      ENDCASE
										   ENDIF
										   **判斷是否有請假
										   IF !EMPTY(S16.F23) AND S16.F11 >= S16.F25 AND !EMPTY(S16.F11)
										   	   REPLACE S16.F15 WITH 0
										   ENDIF
										   **無上班時間則遲到為零
										   IF EMPTY(S16.F11)
										     REPLACE S16.F15 WITH 0
										   ENDIF										   
										   *****計算早退分鐘數
										   IF S16.F12 <= S16.F09 AND !EMPTY(S16.F12) AND !EMPTY(S16.F09)
										      DO CASE
										         CASE S16_F12_M <= S16_F09_M
										              REPLACE S16.F16 WITH ((S16_F09_H - S16_F12_H) * 60) + (S16_F09_M - S16_F12_M)
										         CASE S16_F12_M > S16_F09_M
										              REPLACE S16.F16 WITH ((S16_F09_H - S16_F12_H) * 60) - (S16_F12_M - S16_F09_M)
										      ENDCASE
										   ENDIF
										   **判斷是否有請假
										   IF !EMPTY(S16.F23) AND S16.F12 <= S16.F25 AND !EMPTY(S16.F12)
										   	  REPLACE S16.F16 WITH 0
										   ENDIF
										   **無下班時間則早退為零
										   IF EMPTY(S16.F12)
										     REPLACE S16.F16 WITH 0
										   ENDIF										   
							            ENDIF
				                    ENDFOR
		                       CASE ALLTRIM(StarDate)=ALLTRIM(LEFT(DTOS(S18_1.F11),6)) AND ALLTRIM(StarDate)<>ALLTRIM(LEFT(DTOS(S18_1.F10),6))
				                    FOR I=0 TO DAY(S18_1.F11)
				                        SELECT S16
				                        SEEK S18_1.F03+PADL(ALLTRIM(STR(DAY(S18_1.F11)-I)),2,'0')
				                        IF FOUND() 
*!*						                       REPLACE S16.F13 WITH ''
*!*						                       REPLACE S16.F14 WITH ''
					                       REPLACE S16.F15 WITH 0
					                       REPLACE S16.F16 WITH 0
					                       REPLACE S16.F17 WITH 0
				                           REPLACE S16.F23 WITH  S18_1.F02
				                           REPLACE S16.F24 WITH  ALLTRIM(S00_F50)
				                           REPLACE S16.F25 WITH  IIF(I=DAY(S18_1.F11),S18_1.F13,ALLTRIM(S00_F51))
*!*						                       REPLACE S16.F26 WITH ''
*!*						                       REPLACE S16.F27 WITH ''
*!*						                       REPLACE S16.F28 WITH ''
					                       REPLACE S16.F29 WITH S16.F11		&&請假前之上班時間  
					                       REPLACE S16.F30 WITH S16.F12		&&請假前之下班時間 
										   S16_F11_H = VAL(LEFT(ALLTRIM(S16.F11),2))		&&上班時間(時)
										   S16_F11_M = VAL(RIGHT(ALLTRIM(S16.F11),2))		&&上班時間(分)
										   S16_F12_H = VAL(LEFT(ALLTRIM(S16.F12),2))		&&下班時間(時)
										   S16_F12_M = VAL(RIGHT(ALLTRIM(S16.F12),2))		&&下班時間(分)
				                           *****調整上下班時間
								           DO CASE
								              CASE S16.F24 = S16.F06 AND S16.F25 = S16.F07	&&請整天
								                   REPLACE S16.F11 WITH ''
								                   REPLACE S16.F12 WITH ''
								              CASE S16.F24 <> S16.F06 AND S16.F25 = S16.F07
								                   REPLACE S16.F12 WITH S16.F24
								              CASE S16.F24 = S16.F06 AND S16.F25 <> S16.F07
								                   REPLACE S16.F11 WITH S16.F25
								           ENDCASE
								           IF !EMPTY(S16.F11) AND !EMPTY(S16.F12) AND !EMPTY(S00_F52) AND !EMPTY(S00_F53)
								              IF BETWEEN(S16.F11,S00_F52,S00_F53) AND S16.F12 > S00_F53
								                 REPLACE S16.F11 WITH S00_F53
								              ENDIF
								              IF BETWEEN(S16.F12,S00_F52,S00_F53) AND S16.F11 < S00_F52
								                 REPLACE S16.F12 WITH S00_F52
								              ENDIF
								           ENDIF
								           *****整理非假日補班之請假
								           HK = ALLTRIM(LEFT(DTOC(S18_1.F11),5))
										   IF S16.F18 = 1 OR S16.F18 = 7			&&假日
										      IF IIF(INDEXSEEK(DTOS(CTOD(HK + '/' + S16.F01)),.T.,'S15','S151'),S15.F03 <> '2',.T.) = .T.		&&假日補班
									   	  	 	 IF !EMPTY(S16.F23)
									   	  	 	    REPLACE S16.F23 WITH ''
									   	  	 	    REPLACE S16.F24 WITH ''
									   	  	 	    REPLACE S16.F25 WITH ''
									   	  	 	 ENDIF
										      ENDIF
										   ENDIF
										   *****計算遲到分鐘數
										   IF S16.F11 >= S16.F08 AND !EMPTY(S16.F11) AND !EMPTY(S16.F08)
										      DO CASE
										         CASE S16_F11_M >= S16_F08_M
										              REPLACE S16.F15 WITH ((S16_F11_H - S16_F08_H) * 60) + (S16_F11_M - S16_F08_M)
										         CASE S16_F12_M < S16_F08_M
										              REPLACE S16.F15 WITH ((S16_F11_H - S16_F08_H) * 60) - (S16_F08_M - S16_F11_M)
										      ENDCASE
										   ENDIF
										   **判斷是否有請假
										   IF !EMPTY(S16.F23) AND S16.F11 >= S16.F25 AND !EMPTY(S16.F11)
										   	   REPLACE S16.F15 WITH 0
										   ENDIF	
										   **無上班時間則遲到為零
										   IF EMPTY(S16.F11)
										     REPLACE S16.F15 WITH 0
										   ENDIF
										   *****計算早退分鐘數
										   IF S16.F12 <= S16.F09 AND !EMPTY(S16.F12) AND !EMPTY(S16.F09)
										      DO CASE
										         CASE S16_F12_M <= S16_F09_M
										              REPLACE S16.F16 WITH ((S16_F09_H - S16_F12_H) * 60) + (S16_F09_M - S16_F12_M)
										         CASE S16_F12_M > S16_F09_M
										              REPLACE S16.F16 WITH ((S16_F09_H - S16_F12_H) * 60) - (S16_F12_M - S16_F09_M)
										      ENDCASE
										   ENDIF
										   **判斷是否有請假
										   IF !EMPTY(S16.F23) AND S16.F12 <= S16.F25 AND !EMPTY(S16.F12)
										   	  REPLACE S16.F16 WITH 0
										   ENDIF
										   **無下班時間則早退為零
										   IF EMPTY(S16.F12)
										     REPLACE S16.F16 WITH 0
										   ENDIF
							            ENDIF
				                    ENDFOR
		                       CASE ALLTRIM(StarDate)<>ALLTRIM(LEFT(DTOS(S18_1.F10),6)) AND  ALLTRIM(StarDate)<>ALLTRIM(LEFT(DTOS(S18_1.F11),6))
				                    FOR I=0 TO DAY_NUM(LEFT(StarDate,4)+'/'+RIGHT(StarDate,2))
				                        SELECT S16
				                        SEEK S18_1.F03+PADL(ALLTRIM(STR(I)),2,'0')
				                        IF FOUND() 
*!*						                       REPLACE S16.F13 WITH ''
*!*						                       REPLACE S16.F14 WITH ''
					                       REPLACE S16.F15 WITH 0
					                       REPLACE S16.F16 WITH 0
					                       REPLACE S16.F17 WITH 0
				                           REPLACE S16.F23 WITH  S18_1.F02
				                           REPLACE S16.F24 WITH  ALLTRIM(S00_F50)
				                           REPLACE S16.F25 WITH  ALLTRIM(S00_F51)
*!*						                       REPLACE S16.F26 WITH ''
*!*						                       REPLACE S16.F27 WITH ''
*!*						                       REPLACE S16.F28 WITH ''
					                       REPLACE S16.F29 WITH S16.F11		&&請假前之上班時間
					                       REPLACE S16.F30 WITH S16.F12		&&請假前之下班時間
										   S16_F11_H = VAL(LEFT(ALLTRIM(S16.F11),2))		&&上班時間(時)
										   S16_F11_M = VAL(RIGHT(ALLTRIM(S16.F11),2))		&&上班時間(分)
										   S16_F12_H = VAL(LEFT(ALLTRIM(S16.F12),2))		&&下班時間(時)
										   S16_F12_M = VAL(RIGHT(ALLTRIM(S16.F12),2))		&&下班時間(分)
				                           *****調整上下班時間
								           DO CASE
								              CASE S16.F24 = S16.F06 AND S16.F25 = S16.F07	&&請整天
								                   REPLACE S16.F11 WITH ''
								                   REPLACE S16.F12 WITH ''
								              CASE S16.F24 <> S16.F06 AND S16.F25 = S16.F07
								                   REPLACE S16.F12 WITH S16.F24
								              CASE S16.F24 = S16.F06 AND S16.F25 <> S16.F07
								                   REPLACE S16.F11 WITH S16.F25
								           ENDCASE
								           IF !EMPTY(S16.F11) AND !EMPTY(S16.F12) AND !EMPTY(S00_F52) AND !EMPTY(S00_F53)
								              IF BETWEEN(S16.F11,S00_F52,S00_F53) AND S16.F12 > S00_F53
								                 REPLACE S16.F11 WITH S00_F53
								              ENDIF
								              IF BETWEEN(S16.F12,S00_F52,S00_F53) AND S16.F11 < S00_F52
								                 REPLACE S16.F12 WITH S00_F52
								              ENDIF
								           ENDIF
								           *****整理非假日補班之請假
								           HK = ALLTRIM(StarDate)
										   IF S16.F18 = 1 OR S16.F18 = 7			&&假日
										      IF IIF(INDEXSEEK(DTOS(CTOD(HK + '/' + S16.F01)),.T.,'S15','S151'),S15.F03 <> '2',.T.) = .T.		&&假日補班
									   	  	 	 IF !EMPTY(S16.F23)
									   	  	 	    REPLACE S16.F23 WITH ''
									   	  	 	    REPLACE S16.F24 WITH ''
									   	  	 	    REPLACE S16.F25 WITH ''
									   	  	 	 ENDIF
										      ENDIF
										   ENDIF
										   *****計算遲到分鐘數
										   IF S16.F11 >= S16.F08 AND !EMPTY(S16.F11) AND !EMPTY(S16.F08)
										      DO CASE
										         CASE S16_F11_M >= S16_F08_M
										              REPLACE S16.F15 WITH ((S16_F11_H - S16_F08_H) * 60) + (S16_F11_M - S16_F08_M)
										         CASE S16_F12_M < S16_F08_M
										              REPLACE S16.F15 WITH ((S16_F11_H - S16_F08_H) * 60) - (S16_F08_M - S16_F11_M)
										      ENDCASE
										   ENDIF
										   **判斷是否有請假
										   IF !EMPTY(S16.F23) AND S16.F11 >= S16.F25 AND !EMPTY(S16.F11)
										   	   REPLACE S16.F15 WITH 0
										   ENDIF
										   **無上班時間則遲到為零
										   IF EMPTY(S16.F11)
										     REPLACE S16.F15 WITH 0
										   ENDIF										   
										   *****計算早退分鐘數
										   IF S16.F12 <= S16.F09 AND !EMPTY(S16.F12) AND !EMPTY(S16.F09)
										      DO CASE
										         CASE S16_F12_M <= S16_F09_M
										              REPLACE S16.F16 WITH ((S16_F09_H - S16_F12_H) * 60) + (S16_F09_M - S16_F12_M)
										         CASE S16_F12_M > S16_F09_M
										              REPLACE S16.F16 WITH ((S16_F09_H - S16_F12_H) * 60) - (S16_F12_M - S16_F09_M)
										      ENDCASE
										   ENDIF
										   **判斷是否有請假
										   IF !EMPTY(S16.F23) AND S16.F12 <= S16.F25 AND !EMPTY(S16.F12)
										   	  REPLACE S16.F16 WITH 0
										   ENDIF
										   **無下班時間則早退為零
										   IF EMPTY(S16.F12)
										     REPLACE S16.F16 WITH 0
										   ENDIF										   
							            ENDIF
				                    ENDFOR
		                    ENDCASE
		                 ENDIF
		                 SELECT S16
		                 USE
		              ENDIF 
		              ***紀錄缺勤值S0A
		              DO CASE
		                 CASE ALLTRIM(StarDate)=ALLTRIM(LEFT(DTOS(S18_1.F10),6)) AND  ALLTRIM(StarDate)<>ALLTRIM(LEFT(DTOS(S18_1.F11),6))
		                      S18_F15=DAY_NO(S18_1.F03,S18_1.F10,CTOD(LEFT(DTCX(S18_1.F10),7-INT_012)+ALLTRIM(STR(DAY_NUM(LEFT(DTCX(S18_1.F10),7-INT_012))))),S18_1.F12,ALLTRIM(IIF(INDEXSEEK(S18_1.F03,.T.,'S05','S051'),IIF(INDEXSEEK('I'+S05.F29,.T.,'S00','S005'),S00.F51,''),'')),S18_1.F07)
		                 CASE ALLTRIM(StarDate)=ALLTRIM(LEFT(DTOS(S18_1.F11),6)) AND ALLTRIM(StarDate)<>ALLTRIM(LEFT(DTOS(S18_1.F10),6))
		                      S18_F15=DAY_NO(S18_1.F03,CTOD(LEFT(DTCX(S18_1.F11),7-INT_012)+'/01'),S18_1.F11,ALLTRIM(IIF(INDEXSEEK(S18_1.F03,.T.,'S05','S051'),IIF(INDEXSEEK('I'+S05.F29,.T.,'S00','S005'),S00.F50,''),'')),S18_1.F13,S18_1.F07)
		                 CASE ALLTRIM(StarDate)<>ALLTRIM(LEFT(DTOS(S18_1.F10),6)) AND  ALLTRIM(StarDate)<>ALLTRIM(LEFT(DTOS(S18_1.F11),6))
		                      S18_F15=DAY_NO(S18_1.F03,CTOD(LEFT(StarDate,4)+'/'+RIGHT(StarDate,2)+'/01'),CTOD(ALLTRIM(LEFT(StarDate,4)+'/'+RIGHT(StarDate,2)+'/'+ALLTRIM(STR(DAY_NUM(LEFT(StarDate,4)+'/'+RIGHT(StarDate,2)))))),ALLTRIM(IIF(INDEXSEEK(S18_1.F03,.T.,'S05','S051'),IIF(INDEXSEEK('I'+S05.F29,.T.,'S00','S005'),S00.F50,''),'')),ALLTRIM(IIF(INDEXSEEK(S18_1.F03,.T.,'S05','S051'),IIF(INDEXSEEK('I'+S05.F29,.T.,'S00','S005'),S00.F51,''),'')),S18_1.F07)
		              ENDCASE
		              **判斷請假基數
       			      S18_F14=IIF(Day_Hour=0,0,INT(S18_F15/Day_Hour))  
       			      Hour_F15=IIF(Day_Hour=0,0,MOD(S18_F15,Day_Hour))
		              IF Base_No=0
		                 S18_F15=Hour_F15
		              ELSE
		                 DO CASE
		                    CASE S18_1.F09='D'
		                         DO CASE
                                    CASE Hour_F15<=(Base_No*Day_Hour) AND Hour_F15<>0
                                         S18_F14=S18_F14+Base_No  
                                    CASE Hour_F15>(Base_No*Day_Hour) AND  Hour_F15<Day_Hour
                                         S18_F14=S18_F14+Base_No 
                                    CASE Hour_F15>(Base_No*Day_Hour)
                                         S18_F14=S18_F14+1
                                 ENDCASE
                                
                                 S18_F15=0
*!*			                         DO CASE
*!*			                            CASE Hour_F15<=(Base_No*Day_Hour) AND Hour_F15<>0
*!*			                                 S18_F15=Base_No*Day_Hour  
*!*			                            CASE Hour_F15>(Base_No*Day_Hour)
*!*			                                 S18_F14=S18_F14+1
*!*			                                 S18_F15=0
*!*			                         ENDCASE
		                    CASE S18_1.F09='H'
		                         DO CASE
		                            CASE Hour_F15<=Base_No AND Hour_F15<>0
		                                 S18_F15=Base_No
		                            CASE Hour_F15>Base_No
		                                 S18_F15=Hour_F15
		                         ENDCASE
		                 ENDCASE
	                  ENDIF
		              IF Hour_F15=0
		                 S18_F15=0
		              ENDIF
     				  ***若為年假則判斷是否已扣完
	                  S0A_F08 = CTOD(ALLTRIM(LEFT(StarDate,4) + '/' + RIGHT(StarDate,2) + '/01'))
*!*				          IF S18_1.F07 = 'A1'
*!*				             SELECT S05
*!*				             SET ORDER TO S051
*!*				             SEEK S18_1.F03
*!*				             IF FOUND()	
*!*					            REPLACE S05.F12 WITH S05.F12 + S18_1.F14 + IIF(Day_Hour = 0,0,ROUND(S18_1.F15 / Day_Hour,1))
*!*				                IF (S05.F11 - S05.F12) < 0
*!*				                   S0A_F08 =  CTOD(ALLTRIM(STR(VAL(LEFT(StarDate,4)) + 1)) + '/01/01')	&&若已無年假可扣,則扣到下各年度之1月份
*!*				                ENDIF
*!*				             ENDIF
*!*				          ENDIF
			          ***寫入缺勤紀錄檔
			          SELECT S0A
			          SET ORDER TO S0A1
			          SEEK S18_1.F03 + S18_1.F07 + ALLTRIM(LEFT(DTOS(S0A_F08),6)) + '01' + S18_1.F09 + S18_1.F02
			          IF FOUND()
			             DO CASE		&&缺勤單位 D=日,H=小時,S=次
			                CASE S0A.F09='D'
			                	 REPLACE S0A.F07 WITH S18_F14+IIF(Day_Hour=0,0,ROUND(S18_F15/Day_Hour,1))   &&ERROR 
			                CASE S0A.F09='H'
			                     REPLACE S0A.F07 WITH S0A.F07+S18_F15+(Day_Hour*S18_F14)
			                CASE S0A.F09='S'
			                	 REPLACE S0A.F07 WITH S0A.F07+1
			             ENDCASE
			          ELSE
			             SELECT S0A
			             APPEND BLANK 
			             REPLACE S0A.F01 WITH S18_1.F03
			             REPLACE S0A.F02 WITH S18_1.F04
				         REPLACE S0A.F03 WITH S18_1.F05
				         REPLACE S0A.F04 WITH S18_1.F06
				         REPLACE S0A.F05 WITH S18_1.F07
				         REPLACE S0A.F06 WITH S18_1.F08
				         REPLACE S0A.F08 WITH S0A_F08
				         REPLACE S0A.F09 WITH S18_1.F09
				         DO CASE			&&缺勤單位 D=日,H=小時,S=次
				            CASE S0A.F09='D'
				                 REPLACE S0A.F07 WITH S0A.F07+S18_F14+IIF(Day_Hour=0,0,ROUND(S18_F15/Day_Hour,1))
				            CASE S0A.F09='H'
				                 REPLACE S0A.F07 WITH S0A.F07+S18_F15+(Day_Hour*S18_F14)
				            CASE S0A.F09='S'
				                 REPLACE S0A.F07 WITH S0A.F07+1
				         ENDCASE
			             REPLACE S0A.F10 WITH S18_1.F02
			          ENDIF
				      REPLACE S0A.F99 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
		 		      IF (VAL(RIGHT(StarDate,2))+1)<13
		 		          StarDate=LEFT(StarDate,4)+PADL(ALLTRIM(STR((VAL(RIGHT(StarDate,2))+1))),2,'0')
		 		      ELSE
	 		              StarDate=ALLTRIM(STR(VAL(LEFT(StarDate,4))+1))+'01'
	 		          ENDIF
	               ENDDO
*!*		               ***若為年假
*!*				       IF S18_1.F07='A1'
*!*				          SELECT S05
*!*				          SET ORDER TO S051
*!*				          SEEK S18_1.F03
*!*				          IF FOUND()
*!*					         REPLACE S05.F12 WITH S05.F12+S18_1.F14+IIF(Day_Hour=0,0,ROUND(S18_1.F15/Day_Hour,1))
*!*				          ENDIF
*!*				       ENDIF
		   		ENDIF
		   		*****
                SELECT S18
	            SET ORDER TO S181
	            SEEK S18_1.F02
	            IF FOUND() 
	               REPLACE F18 WITH 'Y'
	               REPLACE F99 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
	            ENDIF
	            SELECT S18_1
	            REPLACE F18 WITH 'Y'
	            REPLACE F99 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
		        =MESSAGEBOX('此確認作業已成功,薪資計算部分請至S10.薪資計算作業中新增!',0+64,'提示視窗')
             ELSE
                DO file_impact
                UNLOCK ALL
                RETURN
             ENDIF
             UNLOCK ALL
          ENDIF
       ENDIF
       THISFORM.GRID1.SETFOCUS
  ENDPROC
*********************  反確認程序
  PROCEDURE INVERSE_BOTT.CLICK
       IF MESSAGEBOX('是否要反確認此筆資料?',4+32+256,'請確認') = 6
           SELECT S18_1
           IF S18_1.F18 = 'N'
               =MESSAGEBOX('此筆資料尚未確認過,請查明後再作反確認!',0+64,'提示訊息視窗')
           ELSE
               LOCK()
               IF RLOCK()
               	  SELECT S0A.* FROM S0A WHERE S18_1.F02 = S0A.F10 AND !EMPTY(S0A.F10) AND S18_1.F03 = S0A.F01 ORDER BY S0A.F08 INTO CURSOR S0A_TEMP
               	  SELECT S0A_TEMP
               	  GO TOP
               	  DO WHILE !EOF()
	                 ***判斷S10.薪資計算作業中是否以確認或有資料,若已確認或有資料則不管跨不跨月請假皆不能反確認
	                 S10 = 'S10' + LEFT(DTOS(S0A_TEMP.F08),6)
	                 S101 = 'S101' + LEFT(DTOS(S0A_TEMP.F08),6)
	                 IF FILE(S10 + '.DBF') = .T.
	                    IF !USED('&S10')
	                       SELECT  0
		                   USE (S10) ALIAS S10
	                    ELSE
		                   SELECT S10
		                ENDIF
		                SET ORDER TO S101
		                SEEK S0A_TEMP.F01 + 'A'
			            IF FOUND()
			               IF S10.F98 = 'Y'
			                  =MESSAGEBOX('此人員已在' + LEFT(DTCX(S0A_TEMP.F08),7-INT_012) + '之S10.薪資計算作業中已確認,故無法執行反確認!',0+64,'提示視窗')
			                  SELECT S0A_TEMP
			                  USE
			                  SELECT S10
			                  USE
			                  THISFORM.GRID1.SETFOCUS
			                  RETURN
			               ELSE
			                  =MESSAGEBOX('此人員已在' + LEFT(DTCX(S0A_TEMP.F08),7-INT_012) + '之S10.薪資計算作業中已有資料,故不得執行反確認,請至S10刪除基本考勤資料後才可反確認!',0+64,'提示視窗')
			                  SELECT S0A_TEMP
			                  USE
			                  SELECT S10
			                  USE
			                  THISFORM.GRID1.SETFOCUS
			                  RETURN
			               ENDIF 
			            ENDIF
			            SELECT S10
			            USE
		             ENDIF
		             ***判斷S16.上下班紀錄作業中是否已確認,若已確認則不管跨不跨月請假皆不能反確認
	              	 S16 = 'S16' + LEFT(DTOS(S0A_TEMP.F08),6)
		       		 S161 ='S161' + LEFT(DTOS(S0A_TEMP.F08),6)
		       		 IF FILE(S16 + '.DBF') = .T.
		                IF !USED('&S16')	&&上下班紀錄檔
			               SELECT 0
			        	   USE (S16) ALIAS S16
		          		ELSE
			        	   SELECT S16
		           		ENDIF
		           		SET ORDER TO S161
		           		SEEK S0A_TEMP.F01
		           		IF FOUND()
		           		   IF S16.F19 = 'Y'
		                      =MESSAGEBOX('此人員已在' + LEFT(DTCX(S0A_TEMP.F08),7-INT_012) + '之S16.上下班紀錄作業中已確認,故無法執行反確認!',0+64,'提示視窗')
		                      SELECT S0A_TEMP
		                      USE
		                      SELECT S16
		                      USE
		                      THISFORM.GRID1.SETFOCUS
		                      RETURN
		                   ELSE
				              SELECT RECNO() FROM S16 WHERE S16.F23 = S0A_TEMP.F10 INTO ARRAY BK1
				              JJ1=''
				              IF _TALLY > 0
				                 FOR I = 1 TO ALEN(BK1)
				                     JJ1 = JJ1 + ALLTRIM(STR(BK1(I))) + ','
				                 ENDFOR
				                 KK1 = STUFF(JJ1,RAT(',',JJ1,1),1,'')
				                 RLOCK(KK1,'S16')
				                 LL1 = RLOCK(KK1,'S16')
				              ELSE
				                 LL1 = .T.
				              ENDIF
		                      IF LL1 = .T. AND LEN(ALLTRIM(JJ1)) > 0
		                         FOR I = 1 TO ALEN(BK1)
		                             SELECT S16
		                             GO BK1(I)
		                             REPLACE S16.F11 WITH S16.F29
		                             REPLACE S16.F12 WITH S16.F30
		                      	     REPLACE S16.F23 WITH ''
		                      	     REPLACE S16.F24 WITH ''
		                      	     REPLACE S16.F25 WITH ''
		                      	     REPLACE S16.F29 WITH ''
		                      	     REPLACE S16.F30 WITH ''
									 *****計算遲到分鐘數
									 S16_F08_H = VAL(LEFT(ALLTRIM(S16.F08),2))		&&班別:上班遲到緩衝時間(時)
									 S16_F08_M = VAL(RIGHT(ALLTRIM(S16.F08),2))   	&&班別:上班遲到緩衝時間(分)
									 S16_F09_H = VAL(LEFT(ALLTRIM(S16.F09),2))		&&班別:下班早退緩衝時間(時)
									 S16_F09_M = VAL(RIGHT(ALLTRIM(S16.F09),2))   	&&班別:下班早退緩衝時間(分)
									 S16_F11_H = VAL(LEFT(ALLTRIM(S16.F11),2))		&&上班時間(時)
									 S16_F11_M = VAL(RIGHT(ALLTRIM(S16.F11),2))		&&上班時間(分)
									 S16_F12_H = VAL(LEFT(ALLTRIM(S16.F12),2))		&&下班時間(時)
									 S16_F12_M = VAL(RIGHT(ALLTRIM(S16.F12),2))		&&下班時間(分)
									 IF S16.F11 >= S16.F08 AND !EMPTY(S16.F11) AND !EMPTY(S16.F08)
									    DO CASE
									       CASE S16_F11_M >= S16_F08_M
									            REPLACE S16.F15 WITH ((S16_F11_H - S16_F08_H) * 60) + (S16_F11_M - S16_F08_M)
									       CASE S16_F12_M < S16_F08_M
									            REPLACE S16.F15 WITH ((S16_F11_H - S16_F08_H) * 60) - (S16_F08_M - S16_F11_M)
									    ENDCASE
									 ENDIF
									 **判斷是否有請假
									 IF !EMPTY(S16.F23) AND S16.F11 >= S16.F25 AND !EMPTY(S16.F11)
									     REPLACE S16.F15 WITH 0
									 ENDIF
									 **無上班時間則遲到為零
									 IF EMPTY(S16.F11)
									    REPLACE S16.F15 WITH 0
									 ENDIF
									 *****計算早退分鐘數
									 IF S16.F12 <= S16.F09 AND !EMPTY(S16.F12) AND !EMPTY(S16.F09)
									    DO CASE
									       CASE S16_F12_M <= S16_F09_M
									            REPLACE S16.F16 WITH ((S16_F09_H - S16_F12_H) * 60) + (S16_F09_M - S16_F12_M)
									       CASE S16_F12_M > S16_F09_M
									            REPLACE S16.F16 WITH ((S16_F09_H - S16_F12_H) * 60) - (S16_F12_M - S16_F09_M)
									    ENDCASE
									 ENDIF
									 **判斷是否有請假
									 IF !EMPTY(S16.F23) AND S16.F12 <= S16.F25 AND !EMPTY(S16.F12)
									    REPLACE S16.F16 WITH 0
									 ENDIF
									 **無下班時間則早退為零
									 IF EMPTY(S16.F12)
									    REPLACE S16.F16 WITH 0
									 ENDIF
		                         ENDFOR
		                      ENDIF
		                      RELEASE ALL LIKE BK*
*!*							      ***若為年假
*!*					              IF S18_1.F07 = 'A1'
*!*		                             SELECT S05
*!*		                             SET ORDER TO S051
*!*		                             SEEK S18_1.F03
*!*		                             IF FOUND()
*!*			                           REPLACE S05.F12 WITH S05.F12- S0A_TEMP.F07
*!*		                             ENDIF
*!*		                          ENDIF
				              ***刪除S0A.年度缺勤紀錄檔之請假資料

		                      
		                   ENDIF
		           		ENDIF
		           	 ENDIF
		           	 SELECT S16
		           	 USE
		             SELECT S0A_TEMP
		             SKIP
               	  ENDDO
               	  SELECT S0A
		          DELETE FROM S0A WHERE F10=S18_1.F02             
               	  SELECT S0A_TEMP
               	  USE
	              SELECT S18
	              SET ORDER TO S181
	              SEEK S18_1.F02
	              IF FOUND()
	                 REPLACE F18 WITH 'N'
	                 REPLACE F99 WITH DTCX(DATE()) + IIF(SEEK(sys_oper,'A01'),A01.F03,'')
	              ENDIF
	              SELECT S18_1
	              REPLACE F18 WITH 'N'
	              REPLACE F99 WITH DTCX(DATE()) + IIF(SEEK(sys_oper,'A01'),A01.F03,'')
               	  =MESSAGEBOX('此反確認作業已成功!',0+64,'提示視窗')
               ELSE
                  DO file_impact
                  UNLOCK ALL
                  RETURN
               ENDIF
               UNLOCK ALL
           ENDIF
       ENDIF
       THISFORM.GRID1.SETFOCUS
  ENDPROC
****列印明細
  PROCEDURE  LIST_BOTT.CLICK     &&列印明細 
      SELECT  S18_1
      ANS_RANGE=CREATEOBJECT("ANS_RANGE")  
      ANS_RANGE.SHOW
      THISFORM.GRID1.SETFOCUS       
  ENDPROC
****S16.出勤明細
  PROCEDURE  S16_BOTT.CLICK    
       SELECT S18_1
       LK=S18_1.F03  
       S16='S16'+LEFT(DTOS(S18_1.F10),6)
       S161='S161'+LEFT(DTOS(S18_1.F10),6)
       IF FILE(S16+'.DBF')=.T.
           CREATE CURSOR MON (F01 C(7-INT_012))
           INDE ON F01 TAG MON1
           IF S18_1.F20 ='1'	&&跨月
 		IF (MONTH(S18_1.F11)+1)<13
 		      EndDate=LEFT(DTCX(S18_1.F11),5-INT_012)+PADL(ALLTRIM(STR(MONTH(S18_1.F11)+1)),2,'0')
 		ELSE
 		     EndDate=ALLTRIM(STR(LEFT(DTCX(S18_1.F11),4-INT_012)+1))+'/01'
 		ENDIF	              
 		StarDate=LEFT(DTCX(S18_1.F10),7-INT_012)
		DO WHILE ALLTRIM(StarDate)<>ALLTRIM(EndDate)      
		       SELECT MON
                       APPEND BLANK
                       REPLACE MON.F01 WITH  ALLTRIM(StarDate)
	 	       IF (VAL(RIGHT(StarDate,2))+1)<13
	 		    StarDate=LEFT(StarDate,3)+PADL(ALLTRIM(STR((VAL(RIGHT(StarDate,2))+1))),2,'0')
	 	       ELSE
	 	            StarDate=ALLTRIM(STR(VAL(LEFT(StarDate,2))+1))+'/01'
	 	       ENDIF	                          
		ENDDO
           ELSE
                SELECT MON
                APPEND BLANK
                REPLACE MON.F01 WITH LEFT(DTCX(S18_1.F10),7-INT_012)		
           ENDIF
           SELECT MON 
           SET ORDER TO MON1
           IF !USED('&S16')	&&上下班紀錄檔
                SELE 0
  	        USE (S16) ALIA S16
           ELSE
	        SELE S16
	   ENDIF
	   SET ORDER TO S161      
	   SELECT F01,F02,F03,F11,F12,F18 FROM S16 WHERE ALLTRIM(S16.F02) = ALLTRIM(LK) ORDER BY S16.F01 INTO CURSOR S16_TEMP 
	   SELECT S16
	   USE
	   SELECT S16_TEMP
	   GO TOP
	   IF _TALLY > 0
                S16_RANGE=CREATEOBJECT("S16_RANGE")  
                S16_RANGE.SHOW    
           ELSE
                =MESSAGEBOX('查無此人員之S16.上下班紀錄檔',0+48,'警示')
           ENDIF     
       ELSE
           =MESSAGEBOX('查無此人員之S16.上下班紀錄檔',0+48,'警示')
       ENDIF		            
       THISFORM.GRID1.SETFOCUS       
  ENDPROC  
ENDDEFINE    
***********************************************列印程序
PROCEDURE PNT_PRC  
         SELECT S18_1
         LK=S18_1.F02
         SELECT * FROM S18 WHERE S18.F02=LK  NOWAIT 	
         IF  _TALLY >0	
              REPORT FORM ALLTRIM(INT_116)+'S18' TO PRINT PROMPT  PREVIEW
              CLEAR
         ELSE
              =MESSAGEBOX('查無此資料可列印',0+48,'警示')
         ENDIF         
ENDPROC
**************************************S16.搜尋畫面         
DEFINE CLASS S16_RANGE AS FORM
*!*	  AUTOCENTER=.T.
  TOP=INT_015*110
  LEFT=INT_015*250      
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*350
  WIDTH=INT_015*331
  MAXBUTTON=.F.
  MINBUTTON=.F.    
  CLOSABLE=.F.
  CONTROLBOX=.F.
  BORDERSTYLE=2
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WINDOWTYPE=1
  NAME='S16_RANGE'
  ADD OBJECT GRDD01 AS GRID WITH;          
      AUTOCENTER=.T.,;
      TOP=37,;
      WIDTH=INT_015*330,;      
      HEIGHT=INT_015*320,;      
      ROWHEIGHT=INT_015*18,;
      HEADERHEIGHT=INT_015*19,;
      ALLOWCELLSELECTION=.F.,;
      DELETEMARK=.F.,;
      READONLY=.T.,;
      RECORDSOURCETYPE=1,;
      COLUMNCOUNT=4,;            
      RECORDSOURCE='S16_TEMP',;      
      NAME='GRDD01',;
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;      
      COLUMN3.NAME='COLUMN3',; 
      COLUMN4.NAME='COLUMN4'  
  ADD OBJECT CMND1 AS COMMANDBUTTON WITH;
      AUTOSIZE=.T.,;
      LEFT=INT_015*240,;
      TOP=INT_015*2,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*80,;
      FONTSIZE=INT_015*9,;     
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\HARROW.CUR',;         
      CAPTION='\<C.離開',;
      TOOLTIPTEXT='取消此搜尋畫面!快速鍵->ALT+C'
      NAME='CMND1'
  ADD OBJECT MTH_LIST1 AS MTH_LIST WITH;
      LEFT=INT_015*5,;
      TOP=INT_015*1   
 PROCEDURE INIT 
         THISFORM.CAPTION=ALLTRIM(S16_TEMP.F03)+SPACE(5)+'S16.上下班紀錄檔'
         THISFORM.SETALL('MOVABLE',.F.,'COLUMN')
         THISFORM.GRDD01.SETALL('FONTSIZE',INT_015*9,'COLUMN') 
         THISFORM.GRDD01.SETALL('FONTSIZE',INT_015*9,'HEADER')          
         THISFORM.GRDD01.SETALL("DYNAMICBACKCOLOR","IIF(S16_TEMP.F18=7 OR S16_TEMP.F18=1 OR INDEXSEEK(DTOS(CTOD(LEFT(ALLTRIM(THISFORM.MTH_LIST1.DISPLAYVALUE),5)+'/'+S16_TEMP.F01)),.F.,'S15','S151')=.T.,RGB(247,100,115),'')","COLUMN")                  
         THISFORM.GRDD01.COLUMN1.HEADER1.CAPTION='日期'
         THISFORM.GRDD01.COLUMN1.WIDTH=INT_015*25
         THISFORM.GRDD01.COLUMN1.CONTROLSOURCE='S16_TEMP.F01'
         THISFORM.GRDD01.COLUMN2.HEADER1.CAPTION='上班時間'
         THISFORM.GRDD01.COLUMN2.WIDTH=INT_015*60
         THISFORM.GRDD01.COLUMN2.CONTROLSOURCE='S16_TEMP.F11'
         THISFORM.GRDD01.COLUMN3.HEADER1.CAPTION='下班時間'
         THISFORM.GRDD01.COLUMN3.WIDTH=INT_015*60
         THISFORM.GRDD01.COLUMN3.CONTROLSOURCE='S16_TEMP.F12'
         THISFORM.GRDD01.COLUMN4.HEADER1.CAPTION='假日判斷'
         THISFORM.GRDD01.COLUMN4.WIDTH=INT_015*150
         THISFORM.GRDD01.COLUMN4.CONTROLSOURCE="DAY_WEEK(S16_TEMP.F18)+IIF(INDEXSEEK(DTOS(CTOD(LEFT(ALLTRIM(THISFORM.MTH_LIST1.DISPLAYVALUE),5)+'/'+S16_TEMP.F01)),.T.,'S15','S151'),SPACE(5)+ALLTRIM(S15.F02),'')"
         THISFORM.GRDD01.SETFOCUS
         IF THISFORM.GRDD01.ACTIVEROW<>0
              THISFORM.GRDD01.AFTERROWCOLCHANGE 
         ENDIF 
 ENDPROC
**************  
  PROC MTH_LIST1.INIT        
       WITH THIS
            SELECT  MON
            GO TOP
            K=0
            S=0
            DO WHILE !EOF()                
               K=K+1
               .ADDITEM(MON.F01)
               IF LEFT(DTCX(DATE()),7-INT_012)=ALLTRIM(MON.F01)
                  S=K  
               ENDIF       
               SKIP
            ENDDO   
            .VALUE=IIF(S = 0,K,S)
       ENDWITH   
  ENDPROC     
***********
  PROC MTH_LIST1.INTERACTIVECHANGE 
	THISFORM.GRDD01.RECORDSOURCE=''
	S16='S16'+LEFT(DTOS(CTOD(THIS.DISPLAYVALUE+'/01')),6)
	S161='S161'+LEFT(DTOS(CTOD(THIS.DISPLAYVALUE+'/01')),6)
	IF FILE(S16+'.DBF')=.T.
	    IF !USED('&S16')	&&出缺勤紀錄檔
	         SELE 0
	         USE (S16) ALIA S16
	    ELSE
	         SELE S16
	    ENDIF
	    SET ORDER TO S161  	
	    SEEK LK
	    IF FOUND()
	        SELECT S16_TEMP
	        USE
	        SELECT F01,F02,F03,F11,F12,F18 FROM S16 WHERE ALLTRIM(S16.F02) = ALLTRIM(LK) ORDER BY S16.F01 INTO CURSOR S16_TEMP 
	        SELECT S16_TEMP
	        GO TOP	
	    ELSE
	        =MESSAGEBOX('查無此月份之出勤紀錄',0+48,'警示')
	        THIS.VALUE = THIS.VALUE -1 	                
	    ENDIF
	    SELECT S16
	    USE
	ELSE
	      =MESSAGEBOX('查無此月份之出勤紀錄',0+48,'警示')
	      THIS.VALUE = THIS.VALUE -1 
	ENDIF    
	THISFORM.GRDD01.RECORDSOURCE='S16_TEMP'  
         THISFORM.GRDD01.SETALL("DYNAMICBACKCOLOR","IIF(S16_TEMP.F18=7 OR S16_TEMP.F18=1 OR INDEXSEEK(DTOS(CTOD(LEFT(ALLTRIM(THISFORM.MTH_LIST1.DISPLAYVALUE),5)+'/'+S16_TEMP.F01)),.F.,'S15','S151')=.T.,RGB(247,100,115),'')","COLUMN")                  
         THISFORM.GRDD01.COLUMN1.HEADER1.CAPTION='日期'
         THISFORM.GRDD01.COLUMN1.WIDTH=INT_015*25
         THISFORM.GRDD01.COLUMN1.CONTROLSOURCE='S16_TEMP.F01'
         THISFORM.GRDD01.COLUMN2.HEADER1.CAPTION='上班時間'
         THISFORM.GRDD01.COLUMN2.WIDTH=INT_015*60
         THISFORM.GRDD01.COLUMN2.CONTROLSOURCE='S16_TEMP.F11'
         THISFORM.GRDD01.COLUMN3.HEADER1.CAPTION='下班時間'
         THISFORM.GRDD01.COLUMN3.WIDTH=INT_015*60
         THISFORM.GRDD01.COLUMN3.CONTROLSOURCE='S16_TEMP.F12'
         THISFORM.GRDD01.COLUMN4.HEADER1.CAPTION='假日判斷'
         THISFORM.GRDD01.COLUMN4.WIDTH=INT_015*150
         THISFORM.GRDD01.COLUMN4.CONTROLSOURCE="DAY_WEEK(S16_TEMP.F18)+IIF(INDEXSEEK(DTOS(CTOD(LEFT(ALLTRIM(THISFORM.MTH_LIST1.DISPLAYVALUE),5)+'/'+S16_TEMP.F01)),.T.,'S15','S151'),SPACE(5)+ALLTRIM(S15.F02),'')"
	THISFORM.GRDD01.SETFOCUS
  ENDPROC  
  ***   
 PROCEDURE CMND1.CLICK
          SELECT MON
          USE
          SELECT S16_TEMP
          USE
          THISFORM.RELEASE
  ENDPROC      
ENDDEFINE  
***********************************************列印範圍選定
DEFINE CLASS ANS_RANGE AS FORM
*!*	  AUTOCENTER=.T.
  CAPTION='請輸入列印資料範圍'
  TOP=INT_015*200
  LEFT=INT_015*200   
  HEIGHT=INT_015*140
  WIDTH=INT_015*380
  FONTSIZE=INT_015*9
  MOVABLE=.F.
  MAXBUTTON=.F.
  MINBUTTON=.F.    
  CONTROLBOX=.F.
  BORDERSTYLE=2
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WINDOWTYPE=1
  NAME='ANS_RANGE'
  ADD OBJECT LABEL1 AS LABEL WITH;
      AUTOSIZE=.T.,;
      HEIGHT=INT_015*25,;
      LEFT=INT_015*30,;
      TOP=INT_015*30,;
      CAPTION='起始單據編號',;
      NAME='LABEL1'
  ADD OBJECT TEXT1 AS TEXTBOX WITH;
      TOP=INT_015*24,;
      LEFT=INT_015*110,;
      HEIGHT=INT_015*25,; 
      WIDTH=INT_015*80,; 
      MAXLENGTH=10,;
      NAME='TEXT1'      
  ADD OBJECT LABEL2 AS LABEL WITH;
      AUTOSIZE=.T.,;
      HEIGHT=INT_015*25,;
      LEFT=INT_015*200,;
      TOP=INT_015*30,;
      CAPTION='截止單據編號',;
      NAME='LABEL2'
  ADD OBJECT TEXT2 AS TEXTBOX WITH;
      TOP=INT_015*24,;
      LEFT=INT_015*280,;
      HEIGHT=INT_015*25,;   
      WIDTH=INT_015*80,;     
      MAXLENGTH=10,;   
      NAME='TEXT2'   
      **
  ADD OBJECT LABEL3 AS LABEL WITH;
      AUTOSIZE=.T.,;
      HEIGHT=INT_015*25,;
      LEFT=INT_015*30,;
      TOP=INT_015*61,;
      CAPTION='起始填單日期',;
      NAME='LABEL3'
  ADD OBJECT TEXT3 AS TEXTBOX WITH;
      TOP=INT_015*55,;
      LEFT=INT_015*110,;
      HEIGHT=INT_015*25,; 
      WIDTH=INT_015*70,;
      NAME='TEXT3'        
  ADD OBJECT LABEL4 AS LABEL WITH;
      AUTOSIZE=.T.,;
      HEIGHT=INT_015*25,;
      LEFT=INT_015*200,;
      TOP=INT_015*61,;
      CAPTION='截止填單日期',;
      NAME='LABEL4'
  ADD OBJECT TEXT4 AS TEXTBOX WITH;
      TOP=INT_015*55,;
      LEFT=INT_015*280,;
      HEIGHT=INT_015*25,; 
      WIDTH=INT_015*70,;
      NAME='TEXT4'             
  ADD OBJECT CMND1 AS COMMANDBUTTON WITH;
      LEFT=INT_015*100,;    
      TOP=INT_015*95,;        
      HEIGHT=INT_015*25,; 
      WIDTH=INT_015*55,;    
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\harrow.cur',;             
      CAPTION='\<Y.執行',;
      TOOLTIPTEXT='確認所輸入的範圍鍵值!快速鍵->ALT+Y',;
      NAME='CMND1'
  ADD OBJECT CMND2 AS COMMANDBUTTON WITH;
      LEFT=INT_015*215,;
      TOP=INT_015*95,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*55,; 
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\harrow.cur',;             
      CAPTION='\<C.取消',;
      TOOLTIPTEXT='取消作業!快速鍵->ALT+C',;
      NAME='CMND2'
  PROCEDURE INIT 
      THISFORM.SETALL('FONTSIZE',INT_015*10,'TEXTBOX')
      THISFORM.SETALL('FONTSIZE',INT_015*10,'LABEL')      
      THISFORM.SETALL('FONTSIZE',INT_015*10,'COMMANDBUTTON') 
      IF KEY()='F02'      
          THISFORM.LABEL1.CAPTION='起始單據編號'
          THISFORM.LABEL2.CAPTION='截止單據編號'
          THISFORM.TEXT1.MAXLENGTH=10
          THISFORM.TEXT2.MAXLENGTH=10
          THISFORM.TEXT1.WIDTH=INT_015*80 
          THISFORM.TEXT2.WIDTH=INT_015*80  
          THISFORM.TEXT1.VALUE=S18_1.F02
          THISFORM.TEXT2.VALUE=S18_1.F02    
          THISFORM.LABEL3.VISIBLE=.F.  
          THISFORM.LABEL4.VISIBLE=.F.   
          THISFORM.TEXT3.VISIBLE=.F.      
          THISFORM.TEXT4.VISIBLE=.F.    
          THISFORM.TEXT1.SETFOCUS 
      ELSE
          THISFORM.LABEL1.CAPTION='起始員工編號'
          THISFORM.LABEL2.CAPTION='截止員工編號'
          THISFORM.TEXT1.MAXLENGTH=4
          THISFORM.TEXT2.MAXLENGTH=4 
          THISFORM.TEXT1.WIDTH=INT_015*60
          THISFORM.TEXT2.WIDTH=INT_015*60      
          THISFORM.TEXT1.READONLY=IIF(A02.F10<>'*',.T.,.F.)
          THISFORM.TEXT2.READONLY=IIF(A02.F10<>'*',.T.,.F.)             
          THISFORM.TEXT1.VALUE=S18_1.F03
          THISFORM.TEXT2.VALUE=S18_1.F03    
          THISFORM.LABEL3.VISIBLE=.T.  
          THISFORM.LABEL4.VISIBLE=.T.   
          THISFORM.TEXT3.VISIBLE=.T.      
          THISFORM.TEXT4.VISIBLE=.T.   
          IF A02.F10<>'*'
              THISFORM.TEXT3.SETFOCUS       
          ELSE
              THISFORM.TEXT1.SETFOCUS
          ENDIF                              
      ENDIF
      THISFORM.TEXT3.VALUE=DATE()
      THISFORM.TEXT4.VALUE=DATE()
  ENDPROC    
  PROCEDURE CMND1.CLICK 
      IF KEY()='F02' 
          IF  EMPTY(THISFORM.TEXT1.VALUE)
               =MESSAGEBOX('起始單據編號不得為空白!',0+64,'提示訊息視窗')
               THISFORM.TEXT1.SETFOCUS
  	       RETURN 
          ENDIF
          IF  EMPTY(THISFORM.TEXT2.VALUE)
               =MESSAGEBOX('截止單據編號不得為空白!',0+64,'提示訊息視窗')
               THISFORM.TEXT2.SETFOCUS
  	       RETURN 
          ENDIF 
          SELECT  * FROM S18 WHERE F02>=THISFORM.TEXT1.VALUE AND F02<=THISFORM.TEXT2.VALUE AND  F18='Y' ;
                          AND  IIF(A02.F10<>'*',F14=sys_oper OR ALLTRIM(F04)=IIF(SEEK(sys_oper,'A01'),ALLTRIM(A01.F03),''),.T.);
                          ORDER BY F02,F03 NOWAIT     
          IF  _TALLY >0
                REPORT FORM ALLTRIM(INT_116)+'S18A_1' TO PRINT PROMPT   PREVIEW
                CLEAR  
          ELSE
                =MESSAGEBOX('查無此範圍資料',0+48,'警示')
               THISFORM.TEXT1.SETFOCUS
               RETURN     
          ENDIF          
      ELSE
          STAR_DATE=DTCX(THISFORM.TEXT3.VALUE)
          END_DATE=DTCX(THISFORM.TEXT4.VALUE)
          IF  EMPTY(THISFORM.TEXT1.VALUE)
               =MESSAGEBOX('起始人員編號不得為空白!',0+64,'提示訊息視窗')
               THISFORM.TEXT1.SETFOCUS
  	       RETURN 
          ENDIF
          IF  EMPTY(THISFORM.TEXT2.VALUE)
               =MESSAGEBOX('截止人員編號不得為空白!',0+64,'提示訊息視窗')
               THISFORM.TEXT2.SETFOCUS
  	       RETURN 
          ENDIF       
          IF  EMPTY(THISFORM.TEXT3.VALUE)
               =MESSAGEBOX('起始申請日期不得為空白!',0+64,'提示訊息視窗')
               THISFORM.TEXT3.SETFOCUS
  	       RETURN 
          ENDIF
          IF  EMPTY(THISFORM.TEXT4.VALUE)
               =MESSAGEBOX('截止申請日期不得為空白!',0+64,'提示訊息視窗')
               THISFORM.TEXT4.SETFOCUS
  	       RETURN 
          ENDIF    
          SELECT * FROM S18 WHERE S18.F03>=THISFORM.TEXT1.VALUE AND S18.F03<=THISFORM.TEXT2.VALUE AND  S18.F18='Y';
                       AND  S18.F01>=THISFORM.TEXT3.VALUE AND S18.F01<=THISFORM.TEXT4.VALUE  ORDER BY F03,F01 NOWAIT 
          IF  _TALLY >0
                REPORT FORM ALLTRIM(INT_116)+'S18A_2' TO PRINT PROMPT   PREVIEW
                CLEAR  
          ELSE
                =MESSAGEBOX('查無此範圍資料',0+48,'警示')
               THISFORM.TEXT1.SETFOCUS
               RETURN     
          ENDIF                        
      ENDIF             
      THISFORM.RELEASE
  ENDPROC     
  ***      
  PROCEDURE CMND2.CLICK
      THISFORM.RELEASE
  ENDPROC      
  PROC CMND1.MOUSEENTER      
       LPARAMETERS nButton, nShift, nXCoord, nYCoord 
             THISFORM.CMND1.FORECOLOR=RGB(255,0,0)
             THISFORM.CMND1.TOP=INT_015*96
             THISFORM.CMND1.LEFT=INT_015*101
  ENDPROC     
  PROC CMND1.MOUSELEAVE      
        LPARAMETERS nButton, nShift, nXCoord, nYCoord 
             THISFORM.CMND1.FORECOLOR=RGB(0,0,0)  
             THISFORM.CMND1.TOP=INT_015*95
             THISFORM.CMND1.LEFT=INT_015*100                  
  ENDPROC     
  PROC CMND2.MOUSEENTER      
       LPARAMETERS nButton, nShift, nXCoord, nYCoord 
             THISFORM.CMND2.FORECOLOR=RGB(255,0,0)
             THISFORM.CMND2.TOP=INT_015*96
             THISFORM.CMND2.LEFT=INT_015*216
  ENDPROC     
  PROC CMND2.MOUSELEAVE      
        LPARAMETERS nButton, nShift, nXCoord, nYCoord 
             THISFORM.CMND2.FORECOLOR=RGB(0,0,0)  
             THISFORM.CMND2.TOP=INT_015*95
             THISFORM.CMND2.LEFT=INT_015*215                  
  ENDPROC     
ENDDEFINE  
*********人員編號
DEFINE CLASS COMBOBOX03 AS COMBOBOX 
       VISIBLE=.F.
       HEIGHT=INT_015*25
       WIDTH=INT_015*115
       FONTSIZE=INT_015*9   
       BOUNDCOLUMN=1
       ROWSOURCETYPE=1
       STYLE=2    
       VALUE=1
       NAME='COMBOBOX03' 
   PROCEDURE INIT        
       SELECT F01,F02 FROM S05 ORDER BY F01 INTO CURSOR S05_TEMP
       GO TOP
       THIS.ADDITEM('')
       DO WHILE  !EOF()
              THIS.ADDITEM(F01+SPACE(5)+ALLTRIM(F02))
      	      SELECT  S05_TEMP
      	      SKIP
       ENDDO 
       SELECT S05_TEMP
       USE         
   ENDPROC  
   PROCEDURE INTERACTIVECHANGE
     THISFORM.TXTF03.VALUE=LEFT(ALLTRIM(THIS.DISPLAYVALUE),4)  
     THISFORM.TXTF04.VALUE=IIF(INDEXSEEK(THISFORM.TXTF03.VALUE,.T.,'S05','S051'),S05.F02,'')
     THISFORM.TXTF05.VALUE=IIF(INDEXSEEK(THISFORM.TXTF03.VALUE,.T.,'S05','S051'),S05.F05,'')
     THISFORM.TXTF06.VALUE=IIF(INDEXSEEK(THISFORM.TXTF03.VALUE,.T.,'S05','S051'),S05.F06,'')
     THISFORM.TXTF12.VALUE=IIF(INDEXSEEK(THISFORM.TXTF03.VALUE,.T.,'S05','S051'),IIF(INDEXSEEK('I'+S05.F29,.T.,'S00','S005'),S00.F50,''),'')
     THISFORM.TXTF13.VALUE=IIF(INDEXSEEK(THISFORM.TXTF03.VALUE,.T.,'S05','S051'),IIF(INDEXSEEK('I'+S05.F29,.T.,'S00','S005'),S00.F51,''),'')
     THISFORM.LBLF97.CAPTION=IIF(INDEXSEEK(THISFORM.TXTF03.VALUE,.T.,'S05','S051'),IIF(INDEXSEEK('I'+S05.F29,.T.,'S00','S005'),'班別時段：'+S00.F50+' ∼ '+S00.F51,''),'')     
     THISFORM.LBLF98.CAPTION=IIF(INDEXSEEK(THISFORM.TXTF03.VALUE,.T.,'S05','S051'),IIF(INDEXSEEK('I'+S05.F29,.T.,'S00','S005'),'休息時段：'+S00.F52+' ∼ '+S00.F53,''),'')
      Day_Hour=IIF(INDEXSEEK(THISFORM.TXTF03.VALUE,.T.,'S05','S051'),IIF(INDEXSEEK('I'+S05.F29,.T.,'S00','S005'),S00.F57,0),0)
     THISFORM.TXTF15.VALUE=DAY_NO(THISFORM.TXTF03.VALUE,THISFORM.TXTF10.VALUE,THISFORM.TXTF11.VALUE,THISFORM.TXTF12.VALUE,THISFORM.TXTF13.VALUE,THISFORM.TXTF07.VALUE)
     THISFORM.TXTF14.VALUE=IIF(Day_Hour=0,0,INT(THISFORM.TXTF15.VALUE/Day_Hour))
     THISFORM.TXTF15.VALUE=IIF(Day_Hour=0,0,MOD(THISFORM.TXTF15.VALUE,Day_Hour))	
     IF THIS.VALUE=1
         THISFORM.TXTF03.VALUE=''
         THISFORM.TXTF04.VALUE=''
         THISFORM.TXTF05.VALUE=''
         THISFORM.TXTF06.VALUE=''     
         THISFORM.TXTF12.VALUE='' 
         THISFORM.TXTF13.VALUE='' 
     ENDIF	     
     THISFORM.TXTF03.REFRESH      
     THISFORM.TXTF04.REFRESH 
     THISFORM.TXTF05.REFRESH 
     THISFORM.TXTF06.REFRESH 
     THISFORM.TXTF14.REFRESH
     THISFORM.TXTF15.REFRESH
  ENDPROC       
ENDDEFINE
*************************************************假別名稱
DEFINE CLASS COMBOBOX08 AS COMBOBOX 
       VISIBLE=.F.
       HEIGHT=INT_015*25
       WIDTH=INT_015*171
       FONTSIZE=INT_015*9   
       BOUNDCOLUMN=1
       ROWSOURCETYPE=1
       STYLE=2    
       VALUE=1
       NAME='COMBOBOX08'
 PROCEDURE INIT    
       SELECT F26,F27 FROM S00 WHERE F01='G' AND F26<>'A2' ORDER BY F26 INTO CURSOR S00_TEMP
       GO TOP
       THIS.ADDITEM('')
       DO WHILE  !EOF()
              THIS.ADDITEM(F26+SPACE(5)+ALLTRIM(F27))
      	      SELECT  S00_TEMP
      	      SKIP
       ENDDO 
       SELECT S00_TEMP
       USE   
  ENDPROC  
   PROCEDURE INTERACTIVECHANGE
      THISFORM.TXTF07.VALUE=LEFT(ALLTRIM(THIS.DISPLAYVALUE),2)
      THISFORM.TXTF08.VALUE=RIGHT(ALLTRIM(THIS.DISPLAYVALUE),LEN(ALLTRIM(THIS.DISPLAYVALUE))-7)
      THISFORM.TXTF09.VALUE=IIF(INDEXSEEK('G'+ALLTRIM(THISFORM.TXTF07.VALUE),.T.,'S00','S003'),S00.F28,'')
      IF THIS.Value=1
           THISFORM.TXTF09.VALUE=''
           THISFORM.LBLF09.CAPTION=''
      ENDIF    
      Day_Hour=IIF(INDEXSEEK(THISFORM.TXTF03.VALUE,.T.,'S05','S051'),IIF(INDEXSEEK('I'+S05.F29,.T.,'S00','S005'),S00.F57,0),0) &&上班總時數      
      Base_No=IIF(INDEXSEEK('G'+THISFORM.TXTF07.VALUE,.T.,'S00','S003'),S00.F62,0)	&&請假基數      
      THISFORM.LBLF09.CAPTION='計數單位：' +ACC_BASE(THISFORM.TXTF09.VALUE)+'，請假基數：'+ALLTRIM(TRANSFORM(Base_No,'@R 999,999.9'))+' '+ACC_BASE(THISFORM.TXTF09.VALUE)      
      THISFORM.TXTF15.VALUE=DAY_NO(THISFORM.TXTF03.VALUE,THISFORM.TXTF10.VALUE,THISFORM.TXTF11.VALUE,THISFORM.TXTF12.VALUE,THISFORM.TXTF13.VALUE,THISFORM.TXTF07.VALUE)
      THISFORM.TXTF14.VALUE=IIF(Day_Hour=0,0,INT(THISFORM.TXTF15.VALUE/Day_Hour))
      **判斷是否超過請假基數
       Hour_F15=IIF(Day_Hour=0,0,MOD(THISFORM.TXTF15.VALUE,Day_Hour))
       IF Base_No=0
           THISFORM.TXTF15.VALUE=Hour_F15
       ELSE
           DO CASE
                 CASE THISFORM.TXTF09.VALUE='D'	&&計數單位(D:日,H:小時,S:次)  
                            DO CASE
                                  CASE Hour_F15<=(Base_No*Day_Hour) AND Hour_F15<>0
                                             THISFORM.TXTF14.VALUE=THISFORM.TXTF14.VALUE+Base_No
                                  CASE Hour_F15>(Base_No*Day_Hour) AND  Hour_F15<Day_Hour
                                            THISFORM.TXTF14.VALUE=THISFORM.TXTF14.VALUE+Base_No
                                  CASE Hour_F15>(Base_No*Day_Hour) 
                                            THISFORM.TXTF14.VALUE=THISFORM.TXTF14.VALUE+1           
                            ENDCASE	
                            THISFORM.TXTF15.VALUE=0   
                 CASE THISFORM.TXTF09.VALUE='H'  OR THISFORM.TXTF09.VALUE='S'         
                            DO CASE
                                  CASE Hour_F15<=Base_No AND Hour_F15<>0
                                             THISFORM.TXTF15.VALUE=Base_No    
                                  CASE Hour_F15>Base_No
                                            THISFORM.TXTF15.VALUE=Hour_F15
                            ENDCASE        
           ENDCASE
      ENDIF	
      IF Hour_F15=0
          THISFORM.TXTF15.VALUE=0
      ENDIF              
*!*	      THISFORM.TXTF15.VALUE=IIF(Day_Hour=0,0,MOD(THISFORM.TXTF15.VALUE,Day_Hour))	      
      THISFORM.TXTF07.REFRESH  
      THISFORM.TXTF08.REFRESH
      THISFORM.TXTF09.REFRESH
      THISFORM.TXTF14.REFRESH
      THISFORM.TXTF15.REFRESH      
  ENDPROC       
ENDDEFINE
************************************************薪資/扣款類別    
FUNCTION ACC_BASE
     PARA JUK
     JO=''
     DO CASE
        CASE JUK='D'
             JO='天'     
        CASE JUK='H'
             JO='小時'
        CASE JUK='S'
             JO='次' 
     ENDCASE
     RETURN JO   
*****************************計算請假之天數與時數
FUNCTION DAY_NO
     PARA LK,DateStar,DateEnd,StarNo,EndNo,VacNo	&& LK:人員編號,DateStar:起始日期,DateEnd:截止日期,StarNo:起始時間,EndNo:截止時間,VacNo:假別編號
       Hour_No=0
       Holiday_No=0		&&假日天數
       Day_Hour=IIF(INDEXSEEK(LK,.T.,'S05','S051'),IIF(INDEXSEEK('I'+S05.F29,.T.,'S00','S005'),S00.F57,0),0)       
       WorkOn=ALLTRIM(IIF(INDEXSEEK(LK,.T.,'S05','S051'),IIF(INDEXSEEK('I'+S05.F29,.T.,'S00','S005'),S00.F50,''),''))	&&班別:上班時段
       WorkOff=ALLTRIM(IIF(INDEXSEEK(LK,.T.,'S05','S051'),IIF(INDEXSEEK('I'+S05.F29,.T.,'S00','S005'),S00.F51,''),''))	&&班別:下班時段
       RestOn=ALLTRIM(IIF(INDEXSEEK(LK,.T.,'S05','S051'),IIF(INDEXSEEK('I'+S05.F29,.T.,'S00','S005'),S00.F52,''),''))	&&班別:休息起始時段
       RestOff=ALLTRIM(IIF(INDEXSEEK(LK,.T.,'S05','S051'),IIF(INDEXSEEK('I'+S05.F29,.T.,'S00','S005'),S00.F53,''),''))	&&班別:休息截止時段
       WorkOn_H=VAL(LEFT(WorkOn,2))  					&&上班時間(時)
       WorkOn_M=VAL(RIGHT(WorkOn,2)) 	 				&&上班時間(分)
       WorkOff_H=VAL(LEFT(WorkOff,2))  					&&下班時間(時)
       WorkOff_M=VAL(RIGHT(WorkOff,2))  				&&下班時間(分)
        RestOn_H=VAL(LEFT(RestOn,2)) 						&&休息時間起(時)
        RestOn_M=VAL(RIGHT(RestOn,2)) 					&&休息時間起(分)
        RestOff_H=VAL(LEFT(RestOff,2))  					&&休息時間止(時)  
        RestOff_M=VAL(RIGHT(RestOff,2))  					&&休息時間止(分)      
        Star_H=VAL(LEFT(ALLTRIM(StarNo),2)) 				&&請假起始時間(時)
        Star_M=VAL(RIGHT(ALLTRIM(StarNo),2)) 			&&請假起始時間(分)
        End_H=VAL(LEFT(ALLTRIM(EndNo),2)) 				&&請假截止時間(時)
        End_M=VAL(RIGHT(ALLTRIM(EndNo),2)) 			&&請假截止時間(分)        
        IF  LEN(ALLTRIM(StarNo))=5 AND LEN(ALLTRIM(LEFT(ALLTRIM(StarNo),2)))<>1 AND;
	     LEN(ALLTRIM(RIGHT(ALLTRIM(StarNo),2)))<>1 AND  Star_H<23 AND Star_M<59  AND;
             LEN(ALLTRIM(EndNo))=5 AND LEN(ALLTRIM(LEFT(ALLTRIM(EndNo),2)))<>1 AND;
	     LEN(ALLTRIM(RIGHT(ALLTRIM(EndNo),2)))<>1 AND  End_H<23 AND  End_M<59 
	     IF  EMPTY(RestOn) AND EMPTY(RestOff)			&&判斷此班別是否有設定休息時間       
	          IF DateEnd=DateStar
	              Hour_No=ROUND(((((End_H-Star_H)*60)+(End_M-Star_M))/60),1)
	          ELSE
	              Hour_No=ROUND(((((WorkOff_H-Star_H)*60)+(WorkOff_M-Star_M))/60)+((((WorkOn_H-End_H)*60)+(WorkOn_M-End_M))/60),1)
	          ENDIF          
	     ELSE
                  DO CASE 
                         CASE BETWEEN(ALLTRIM(StarNo),WorkOn,RestOn)=.T. AND BETWEEN(ALLTRIM(EndNo),RestOff,WorkOff)=.T.
                                    IF DateEnd=DateStar
                                         Hour_No=ROUND(((((RestOn_H-Star_H)*60)+(RestOn_M-Star_M))/60)+((((End_H-RestOff_H)*60)+(End_M-RestOff_M))/60),1)
                                    ELSE
                                         Hour_No=ROUND(((((RestOn_H-Star_H)*60)+(RestOn_M-Star_M))/60)+((((WorkOff_H-RestOff_H)*60)+(WorkOff_M-RestOff_M))/60)+;
                                       				      ((((RestOn_H-WorkOn_H)*60)+(RestOn_M-WorkOn_M))/60)+((((End_H-RestOff_H)*60)+(End_M-RestOff_M))/60),1)
                                    ENDIF     
                         CASE BETWEEN(ALLTRIM(StarNo),WorkOn,RestOn)=.T. AND BETWEEN(ALLTRIM(EndNo),WorkOn,RestOn)=.T.
                                    IF DateEnd=DateStar
                                        Hour_No=ROUND((((End_H-Star_H)*60)+(End_M-Star_M))/60,1)   
                                    ELSE
                                        Hour_No=ROUND(((((RestOn_H-Star_H)*60)+(RestOn_M-Star_M))/60)+((((WorkOff_H-RestOff_H)*60)+(WorkOff_M-RestOff_M))/60)+;
                                       				      ((((End_H-WorkOn_H)*60)+(End_M-WorkOn_M))/60),1)                                         
                                    ENDIF                                                                      
                         CASE BETWEEN(ALLTRIM(StarNo),RestOff,WorkOff)=.T. AND BETWEEN(ALLTRIM(EndNo),RestOff,WorkOff)=.T.
				    IF DateEnd=DateStar
				         Hour_No=ROUND((((End_H-Star_H)*60)+(End_M-Star_M))/60,1)       
				    ELSE
                                        Hour_No=ROUND(((((WorkOff_H-Star_H)*60)+(WorkOff_M-Star_M))/60)+;
                                                                      ((((RestOn_H-WorkOn_H)*60)+(RestOn_M-WorkOn_M))/60)+((((End_H-RestOff_H)*60)+(End_M-RestOff_M))/60),1)                                         
				    ENDIF
                         CASE BETWEEN(ALLTRIM(StarNo),RestOff,WorkOff)=.T. AND BETWEEN(ALLTRIM(EndNo),WorkOn,RestOn)=.T.
				    IF DateEnd=DateStar
				         Hour_No=0
				    ELSE
				         Hour_No=ROUND(((((WorkOff_H-Star_H)*60)+(WorkOff_M-Star_M))/60)+((((End_H-WorkOn_H)*60)+(End_M-WorkOn_M))/60),1)       				         
				    ENDIF     
		         **************
                         CASE BETWEEN(ALLTRIM(StarNo),RestOn,RestOff)=.T. AND BETWEEN(ALLTRIM(EndNo),RestOn,RestOff)=.T.
		                    IF DateEnd=DateStar
				         Hour_No=0
				    ELSE
				         Hour_No=ROUND(((((WorkOff_H-RestOff_H)*60)+(WorkOff_M-RestOff_M))/60)+((((WorkOn_H-RestOn_H)*60)+(WorkOn_M-RestOn_M))/60),1)
				    ENDIF		
                         CASE BETWEEN(ALLTRIM(StarNo),RestOn,RestOff)=.T. AND BETWEEN(ALLTRIM(EndNo),RestOn,RestOff)=.F.
                                    IF BETWEEN(ALLTRIM(EndNo),WorkOn,RestOn)=.T.
		                        IF DateEnd=DateStar
				             Hour_No=0
				        ELSE
				             Hour_No=ROUND(((((WorkOff_H-RestOff_H)*60)+(WorkOff_M-RestOff_M))/60)+((((End_H-WorkOn_H)*60)+(End_M-WorkOn_M))/60),1)
				        ENDIF    
				    ELSE
		                        IF DateEnd=DateStar
				             Hour_No=ROUND(((((End_H-RestOff_H)*60)+(End_M-RestOff_M))/60),1)
				        ELSE
				             Hour_No=ROUND(((((WorkOff_H-RestOff_H)*60)+(WorkOff_M-RestOff_M))/60)+;
				                                           ((((RestOn_H-WorkOn_H)*60)+(RestOn_M-WorkOn_M))/60)+((((End_H-RestOff_H)*60)+(End_M-RestOff_M))/60),1)
				        ENDIF    				             
				    ENDIF		
                         CASE BETWEEN(ALLTRIM(StarNo),RestOn,RestOff)=.F. AND BETWEEN(ALLTRIM(EndNo),RestOn,RestOff)=.T.
                                    IF BETWEEN(ALLTRIM(StarNo),WorkOn,RestOn)=.T.
		                        IF DateEnd=DateStar
				             Hour_No=ROUND(((((RestOn_H-Star_H)*60)+(RestOn_M-Star_M))/60),1)
				        ELSE
				             Hour_No=ROUND(((((RestOn_H-Star_H)*60)+(RestOn_M-Star_M))/60)+((((WorkOff_H-RestOff_H)*60)+(WorkOff_M-RestOff_M))/60)+;
				              		                   ((((RestOn_H-WorkOn_H)*60)+(RestOn_M-WorkOn_M))/60),1)
				        ENDIF    
				    ELSE
		                        IF DateEnd=DateStar
				             Hour_No=0
				        ELSE
				             Hour_No=ROUND(((((WorkOff_H-Star_H)*60)+(WorkOff_M-Star_M))/60)+((((RestOn_H-WorkOn_H)*60)+(RestOn_M-WorkOn_M))/60),1)
				        ENDIF    				             
				    ENDIF					    			    		    
                  ENDCASE
            ENDIF    
            ****** 
            IF (DateEnd-DateStar+1)>2
                Hour_No=(DateEnd-DateStar-1)*Day_Hour+Hour_No
            ENDIF
       ENDIF
              **判斷假別是否要包含假日
      IF IIF(INDEXSEEK('G' + VacNo,.T.,'S00','S003'),IIF(S00.F68 <> '1',.T.,.F.),.T.) = .T.
         *****判斷日期範圍是否有假日
         IF Hour_No<>0 AND DateStar<=DateEnd
            DS=0
            DO WHILE (DateStar+DS)<>(DateEnd+1)
           	   IF DOW(DateStar+DS)=1 OR DOW(DateStar+DS)=7 OR IIF(INDEXSEEK(DTOS(DateStar+DS),.T.,'S15','S151'),S15.F03='1',.F.)
           	      Holiday_No = Holiday_No + 1
           	   ENDIF
           	   IF IIF(INDEXSEEK(DTOS(DateStar+DS),.T.,'S15','S151'),S15.F03='2',.F.) =.T.
           	       Holiday_No = Holiday_No - 1
           	   ENDIF
               DS=DS+1
            ENDDO
            Hour_No=Hour_No-(Holiday_No*Day_Hour)
         ENDIF
     ENDIF	
     *****	     
     RETURN Hour_No      
*****假日判斷
FUNCTION DAY_WEEK
     PARA JUK4
     JO4=''
     DO CASE
        CASE JUK4=2
             JO4='星期一'     
        CASE JUK4=3
             JO4='星期二'   
        CASE JUK4=4
             JO4='星期三'   
        CASE JUK4=5
             JO4='星期四'   
        CASE JUK4=6
             JO4='星期五'   
        CASE JUK4=7
             JO4='星期六'   
        CASE JUK4=1
             JO4='星期日' 
     ENDCASE
     RETURN JO4      