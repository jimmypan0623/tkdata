**程式名稱:S15.年度假日設定檔
SET EXCL OFF
CLOSE ALL
CLEAR 
AREA1='S15_TEMP'
FLG='0'
FCH=''
CHK=''
R=0
PO=CTOD('')
IF !USED('A01')	&&操作人員資料設定
   SELE 0
   USE A01
ELSE 
   SELE A01
ENDIF
SET ORDER TO A01      
IF !USED('A02')	&&權限設定檔
   SELE 0
   USE A02 INDE A02
ELSE
   SELE A02
ENDIF
SET ORDER TO A021      
SEEK SYS_OPER+'S15'    
IF !USED('S15')	&&年度假日設定檔
   SELE 0
   USE S15 
ELSE
   SELE S15
ENDIF
SET ORDER TO S151
CREATE CURSOR S15_TEMP (F01 D(8),F02 C(30),F03 C(1),F99 C(17)) 
INDE ON DTOS(F01)+F02 TAG S15_TEMP1
SELECT * FROM S15 WHERE  LEFT(DTOS(F01),4)=LEFT(DTOS(DATE()),4) ORDER BY F01 INTO CURSOR S15A 
SELE S15A
GO TOP
DO WHILE !EOF()
   SELE S15_TEMP
   APPEND BLANK
   REPL F01 WITH S15A.F01
   REPL F02 WITH ALLTRIM(S15A.F02)
   REPL F03 WITH S15A.F03
   REPL F99 WITH S15A.F99
   SELE S15A
   SKIP   
ENDDO
SELE S15A
USE
SELECT S15_TEMP
SET ORDER TO S15_TEMP1
GO TOP
********
S15FORM=CREATEOBJECT("TKS15")
S15FORM.SHOW  
DEFINE CLASS TKS15 AS FORM
  CAPTION='S15.年度假日檔設定'
*!*	  AUTOCENTER=.T.
  CONTROLBOX=.F.
  BORDERSTYLE=1  
  MAXBUTTON=.F.
  MINBUTTON=.F.
  MOVABLE=.F.
  CLOSABLE=.F.
  CONTROLCOUNT=57
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*550
  WIDTH=INT_015*791
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WINDOWTYPE=1
  NAME='TKS15'
  ADD OBJECT CMND1 AS COMMANDBUTTON WITH;
      VISIBLE=.F.,;
      LEFT=INT_015*131,;
      TOP=INT_015*340,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\harrow.cur',;        
      CAPTION='\<C.選擇',;
      TOOLTIPTEXT='選擇此作業畫面!快速鍵->ALT+A'
      NAME='CMND1'        
  PROCEDURE  INIT       
      v_scrx=SYSMETRIC(1)
      v_scry=SYSMETRIC(2)
      DO CASE
           CASE  v_scrx=640 AND v_scry=480 
                      THISFORM.PICTURE='BMPS\XP800600.JPG' 
           CASE  v_scrx=800 AND v_scry=600 
                      THISFORM.PICTURE='BMPS\XP800600.JPG' 
           CASE  v_scrx=1024 AND v_scry=768
  	              THISFORM.PICTURE='BMPS\XP1024768.JPG' 
           OTHERWISE
     	              THISFORM.PICTURE='BMPS\XP1024768.JPG' 
      ENDCASE  
 ENDPROC
 PROCEDURE ACTIVATE
       THISFORM.CMND1.SETFOCUS
       THISFORM.CMND1.CLICK	
 ENDPROC
 PROCEDURE CMND1.CLICK  
      TKS15_TEMP=CREATEOBJECT("TKS15_TEMP")  
      TKS15_TEMP.SHOW    
      THISFORM.RELEASE      
      IF !USED('A05')
           SELE 0
           USE A05 
      ELSE
           SELE A05
      ENDIF   
      SET ORDER TO 1
      SEEK SYS_OPER+'S15'
      IF FOUND()
         DELETE 
      ENDIF   
      UNLOCK ALL                  
      CLOSE TABLE ALL
      THISFORM.RELEASE 
      RETURN  
ENDPROC                  
ENDDEFINE
***********
***********
DEFINE CLASS TKS15_TEMP AS FORM
  CAPTION='S15.年度假日檔設定'
*!*	  AUTOCENTER=.T.
  TOP=INT_015*70
  LEFT=INT_015*250
  CONTROLBOX=.F.
  BORDERSTYLE=1  
  MAXBUTTON=.F.
  MINBUTTON=.F.
  MOVABLE=.F.
  CLOSABLE=.F.
  CONTROLCOUNT=57
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*420
  WIDTH=INT_015*280
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WINDOWTYPE=1
  NAME='TKS15_TEMP'
  ADD OBJECT SHAPE1 AS SHAPE1 WITH;
      LEFT=INT_015*3,;
      WIDTH=INT_015*273,;
      HEIGHT=INT_015*115
  ADD OBJECT SHAPE2 AS SHAPE2 WITH;    
      LEFT=INT_015*3,;
      TOP=INT_015*117,;
      WIDTH=INT_015*273,;
      HEIGHT=INT_015*238
  ADD OBJECT SHAPE3 AS SHAPE3 WITH;
      LEFT=INT_015*3,;
      TOP=INT_015*356,;
      WIDTH=INT_015*273,;
      HEIGHT=INT_015*61    
  ADD OBJECT CMDGROUP AS CMDGROUP WITH;      
      TOP=INT_015*355,;
      LEFT=INT_015*50
  ADD OBJECT ORPGROUP AS ORPGROUP WITH;    
      TOP=INT_015*383,;
      LEFT=INT_015*50  
  ADD OBJECT LBLF01 AS LABEL WITH;
      TOP=INT_015*11,;
      LEFT=INT_015*10,;
      AUTOSIZE=.T.,;
      CAPTION='假日日期                    年                月                 日'   
  ADD OBJECT YEAR_LIST AS YEAR_LIST WITH;
     TOP=INT_015*5,;
      LEFT=INT_015*61      
  ADD OBJECT SPINNER011 AS SPINNER WITH;      
     TOP=INT_015*5,;
     LEFT=INT_015*133,; 
     HEIGHT=INT_015*25,;
     WIDTH=INT_015*40,;
     VALUE=1,;
     KEYBOARDLOWVALUE=1,;
     KEYBOARDHIGHVALUE=12,;
     SPINNERLOWVALUE=1,;
     SPINNERHIGHVALUE=12,;
     INPUTMASK='99'       
  ADD OBJECT SPINNER012 AS SPINNER WITH;      
     TOP=INT_015*5,;
     LEFT=INT_015*196,; 
     HEIGHT=INT_015*25,;
     WIDTH=INT_015*40,;
     VALUE=1,;
     KEYBOARDLOWVALUE=1,;
     KEYBOARDHIGHVALUE=31,;
     SPINNERLOWVALUE=1,;
     SPINNERHIGHVALUE=31,;
     INPUTMASK='99'              
  ADD OBJECT LBLF02 AS LABEL WITH;
      TOP=INT_015*36,;
      LEFT=INT_015*10,;
      WIDTH=INT_015*50,;
      CAPTION='假日名稱'         
  ADD OBJECT TXTF02 AS TEXTBOX WITH;
      TOP=INT_015*32,;
      LEFT=INT_015*61,;
      WIDTH=INT_015*200,;
      HEIGHT=INT_015*25,;
      MAXLENGTH=30,;
      NAME='TXTF02'                      
  ADD OBJECT LBLF03 AS LABEL WITH;
      TOP=INT_015*65,;
      LEFT=INT_015*10,;
      WIDTH=INT_015*50,;
      CAPTION='加班類別'        
  ADD OBJECT OPTIONGROUP03 AS OPTIONGROUP WITH;       
      TOP=INT_015*58,;
      LEFT=INT_015*61,; 
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*160,;      
      BUTTONCOUNT=2,;
      VALUE=1,;
      ENABLED=.F.,;
      NAME='OPTIONGROUP03',;
      OPTION1.CAPTION='假日加班',;
      OPTION1.TOP=INT_015*5,;
      OPTION1.FONTSIZE=INT_015*9,;
      OPTION1.AUTOSIZE=.T.,;
      OPTION1.LEFT=INT_015*5,;
      OPTION1.NAME='OPTION1',;
      OPTION2.CAPTION='一般上班',;
      OPTION2.TOP=INT_015*5,;
      OPTION2.FONTSIZE=INT_015*9,;	  
      OPTION2.AUTOSIZE=.T.,;
      OPTION2.LEFT=INT_015*80,;
      OPTION2.NAME='OPTION2'         
  ADD OBJECT LBLF99 AS LABEL WITH;
      TOP=INT_015*92,;
      LEFT=INT_015*10,;
      WIDTH=INT_015*50,;
      CAPTION='安全資料'         
  ADD OBJECT LBLF991 AS LABEL WITH;
      TOP=INT_015*92,;
      LEFT=INT_015*63,;
      AUTOSIZE=.T.,;
      CAPTION=''               
  ADD OBJECT KEY_LIST AS KEY_LIST WITH;
      VISIBLE=.F.          
  ADD OBJECT SHRGROUP AS SHRGROUP WITH;
      TOP=INT_015*82,;
      LEFT=INT_015*180                        
  ADD OBJECT GRID1 AS GRID WITH;        
      AUTOCENTER=.T.,;
      LEFT=INT_015*10,;
      TOP=INT_015*121,;
      WIDTH=INT_015*260,;      
      HEIGHT=INT_015*230,;      
      ROWHEIGHT=INT_015*18,;
      HEADERHEIGHT=INT_015*19,;      
      DELETEMARK=.F.,;
      READONLY=.T.,;
      RECORDSOURCETYPE=1,;
      COLUMNCOUNT=2,;            
      NAME='GRID1',;
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2'
  ADD OBJECT CMND2 AS COMMANDBUTTON WITH;
      LEFT=INT_015*181,;
      TOP=INT_015*388,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\harrow.cur',;        
      CAPTION='\<X.離開',;
      TOOLTIPTEXT='取消此作業畫面!快速鍵->ALT+X'
      NAME='CMND2'        
   ********   
  PROCEDURE INIT 
      SELECT S15_TEMP 
      GO TOP
      THISFORM.SETALL('FONTSIZE',INT_015*9,'TEXTBOX') 
      THISFORM.SETALL('FONTSIZE',INT_015*9,'LABEL') 
      THISFORM.SETALL('FONTSIZE',INT_015*9,'SPINNER') 
      THISFORM.SETALL('READONLY',.T.,'TEXTBOX')    
      THISFORM.SETALL('READONLY',.T.,'SPINNER')        
      THISFORM.GRID1.READONLY=.T. 
      THISFORM.GRID1.RECORDSOURCE='S15_TEMP'   
      THISFORM.CMDGROUP.SEEK_BOTT.VISIBLE=.F.
      THISFORM.ORPGROUP.PNT_BOTT.VISIBLE=.F.
      THISFORM.ORPGROUP.ESC_BOTT.VISIBLE=.F.
      THISFORM.SHRGROUP.VISIBLE=.F.
      THISFORM.SHRGROUP.ENABLED=.F.         
      THISFORM.SETALL('READONLY',.T.,'TEXTBOX')
      THISFORM.GRID1.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)   
      THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(S15_TEMP.F03='2',RGB(255,255,0),'')","COLUMN")  
      THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'COLUMN')
      THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'HEADER')         
      THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='假日日期'
      THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='假日名稱'
      THISFORM.GRID1.COLUMN1.WIDTH=INT_015*60
      THISFORM.GRID1.COLUMN2.WIDTH=INT_015*160
      THISFORM.GRID1.COLUMN1.CONTROLSOURCE="TRANSFORM(DTOS(S15_TEMP.F01),'@R ####/##/##')"
      THISFORM.GRID1.COLUMN2.CONTROLSOURCE='S15_TEMP.F02'
      THISFORM.GRID1.SETFOCUS    
      IF THISFORM.GRID1.ACTIVEROW=0
           THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
	   THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
	   THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
	   THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
	   THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.   
	   THISFORM.CMDGROUP.ENABLED=.F.             
           THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
           THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
           THISFORM.SPINNER011.VALUE=0
           THISFORM.SPINNER012.VALUE=0 
           THISFORM.TXTF02.VALUE=''            
           THISFORM.LBLF991.CAPTION=''
       ELSE
           THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
	   THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
	   THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
	   THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
	   THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.             
           THISFORM.CMDGROUP.ENABLED=.T.         
           THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.) &&判斷有無修改的權限                          
           THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.) &&判斷有無刪除的權限
        ENDIF                     
        THISFORM.CMND2.ENABLED=.T.       
        THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.)  &&判斷有無新增的權限
         FCH='GRID1'                   
        THISFORM.YEAR_LIST.INTERACTIVECHANGE
  ENDPROC
   *************   
  PROC GRID1.AFTERROWCOLCHANGE
         LPARAMETERS XColIndex 
         THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(S15_TEMP.F03='2',RGB(255,255,0),'')","COLUMN") 
         THISFORM.GRID1.TOOLTIPTEXT=IIF(S15_TEMP.F03='2','一般上班','假日加班') 
         THISFORM.SPINNER011.VALUE=VAL(SUBSTR(DTOS(S15_TEMP.F01),5,2))
         THISFORM.SPINNER012.VALUE=VAL(RIGHT(DTOS(S15_TEMP.F01),2))
         THISFORM.TXTF02.VALUE=S15_TEMP.F02
         THISFORM.OPTIONGROUP03.VALUE=VAL(S15_TEMP.F03)
         THISFORM.LBLF991.CAPTION=S15_TEMP.F99
  ENDPROC 
  PROC YEAR_LIST.INTERACTIVECHANGE
	THISFORM.GRID1.RECORDSOURCE=''
        SELECT S15_TEMP
        USE
	CREATE CURSOR S15_TEMP (F01 D(8),F02 C(30),F03 C(1),F99 C(17)) 
	INDE ON DTOS(F01)+F02 TAG S15_TEMP1
	SELECT * FROM S15 WHERE  LEFT(DTOS(F01),4)=ALLTRIM(THISFORM.YEAR_LIST.DISPLAYVALUE) ORDER BY F01 INTO CURSOR S15A 
	SELE S15A
	GO TOP
	DO WHILE !EOF()
	   SELE S15_TEMP
	   APPEND BLANK
	   REPL F01 WITH S15A.F01
	   REPL F02 WITH ALLTRIM(S15A.F02)
	   REPL F03 WITH S15A.F03
	   REPL F99 WITH S15A.F99
	   SELE S15A
	   SKIP   
	ENDDO
	SELE S15A
	USE
	SELECT S15_TEMP
	SET ORDER TO S15_TEMP1
	GO TOP     
       THISFORM.GRID1.READONLY=.T. 
       THISFORM.GRID1.RECORDSOURCE='S15_TEMP'   	
       THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(S15_TEMP.F03='2',RGB(255,255,0),'')","COLUMN") 
       THISFORM.GRID1.COLUMN1.CONTROLSOURCE="TRANSFORM(DTOS(S15_TEMP.F01),'@R ####/##/##')"
       THISFORM.GRID1.COLUMN2.CONTROLSOURCE='S15_TEMP.F02'      
       THISFORM.GRID1.SETFOCUS
        IF THISFORM.GRID1.ACTIVEROW=0
            THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
	    THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
	    THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
	    THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
	    THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.   
	    THISFORM.CMDGROUP.ENABLED=.F.             
            THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
            THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
            THISFORM.SPINNER011.VALUE=0
            THISFORM.SPINNER012.VALUE=0 
            THISFORM.TXTF02.VALUE=''            
            THISFORM.LBLF991.CAPTION=''
        ELSE
            THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
	    THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
	    THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
	    THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
	    THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.             
            THISFORM.CMDGROUP.ENABLED=.T.         
            THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.) &&判斷有無修改的權限                          
            THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.) &&判斷有無刪除的權限
        ENDIF                     
        THISFORM.CMND2.ENABLED=.T.       
        THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.)  &&判斷有無新增的權限 	
  ENDPROC    
  PROCEDURE CMND2.CLICK
      IF MESSAGEBOX('您真的要結束此作業嗎',4+48+0,'請確定')=6
           THISFORM.RELEASE 
      ELSE
           THISFORM.GRID1.SETFOCUS     
      ENDIF       
  ENDPROC
  ****
  PROCEDURE SPINNER011.INTERACTIVECHANGE
     DO CASE 
            CASE THISFORM.SPINNER011.VALUE=1 OR THISFORM.SPINNER011.VALUE=3 OR THISFORM.SPINNER011.VALUE=5 OR ; 
                       THISFORM.SPINNER011.VALUE=7  OR THISFORM.SPINNER011.VALUE=8 OR THISFORM.SPINNER011.VALUE=10 OR THISFORM.SPINNER011.VALUE=12
                       THISFORM.SPINNER012.KEYBOARDHIGHVALUE=31
      		       THISFORM.SPINNER012.SPINNERHIGHVALUE=31
      		       THISFORM.SPINNER012.VALUE=1
            CASE THISFORM.SPINNER011.VALUE=4 OR THISFORM.SPINNER011.VALUE=6 OR ;
                       THISFORM.SPINNER011.VALUE=09  OR THISFORM.SPINNER011.VALUE=11
                       THISFORM.SPINNER012.KEYBOARDHIGHVALUE=30
      		       THISFORM.SPINNER012.SPINNERHIGHVALUE=30
      		       THISFORM.SPINNER012.VALUE=1                       
            CASE THISFORM.SPINNER011.VALUE=2       
              	       CS_DATE=ALLTRIM(ALLTRIM(THISFORM.YEAR_LIST.DISPLAYVALUE)+'/'+;
		                           IIF(THISFORM.SPINNER011.VALUE<10,'0'+ALLTRIM(STR(THISFORM.SPINNER011.VALUE)),ALLTRIM(STR(THISFORM.SPINNER011.VALUE)))+'/'+;
		                           IIF(THISFORM.SPINNER012.VALUE<10,'0'+ALLTRIM(STR(THISFORM.SPINNER012.VALUE)),ALLTRIM(STR(THISFORM.SPINNER012.VALUE))))  
                       IF MOD(YEAR(CTOD(CS_DATE)),4)=0          &&如果是潤年
			   NMAXDAYS=29             			           &&每月最多天數是29
		       ELSE
			   NMAXDAYS=28            				   &&不潤年的天數是28天
		       ENDIF   
                       THISFORM.SPINNER012.KEYBOARDHIGHVALUE=NMAXDAYS
      		       THISFORM.SPINNER012.SPINNERHIGHVALUE=NMAXDAYS  
      		       THISFORM.SPINNER012.VALUE=1       
     ENDCASE 
  ENDPROC  
  ******
  PROCEDURE  ORPGROUP.NEW_BOTT.CLICK
        THISFORM.CMND2.ENABLED=.F.  
        THISFORM.GRID1.ENABLED=.F.
        THISFORM.YEAR_LIST.ENABLED=.F.
        THISFORM.SETALL('READONLY',.F.,'SPINNER') 
        THISFORM.TXTF02.READONLY=.F.
        THISFORM.OPTIONGROUP03.ENABLED=.T. 
        THISFORM.SPINNER011.VALUE=1     
        THISFORM.SPINNER012.VALUE=1  
        THISFORM.TXTF02.VALUE=''
        THISFORM.OPTIONGROUP03.VALUE=1 
        THISFORM.LBLF991.CAPTION=''          
        THISFORM.SPINNER011.SETFOCUS     
  ENDPROC
  PROCEDURE  SHRGROUP.SHURE1_BOTT.CLICK
        IF INDEXSEEK(DTOS( CTOD(ALLTRIM(THISFORM.YEAR_LIST.DISPLAYVALUE)+'/'+;
                       				IIF(THISFORM.SPINNER011.VALUE<10,'0'+ALLTRIM(STR(THISFORM.SPINNER011.VALUE)),ALLTRIM(STR(THISFORM.SPINNER011.VALUE)))+'/'+;
                       				IIF(THISFORM.SPINNER012.VALUE<10,'0'+ALLTRIM(STR(THISFORM.SPINNER012.VALUE)),ALLTRIM(STR(THISFORM.SPINNER012.VALUE))))),.F.,'S15','S151')=.T.
             =MESSAGEBOX('此假日日期已存在,請重新輸入!',0+64,'提示訊息視窗')
             THISFORM.SPINNER011.SETFOCUS
             RETURN              
       ENDIF             
        IF EMPTY(THISFORM.TXTF02.VALUE)=.T.
             =MESSAGEBOX('假日名稱不得空白!',0+64,'提示訊息視窗')
            THISFORM.TXTF02.SETFOCUS
            RETURN              
        ENDIF       
        IF INDEXSEEK(DTOS( CTOD(ALLTRIM(THISFORM.YEAR_LIST.DISPLAYVALUE)+'/'+;
                       				IIF(THISFORM.SPINNER011.VALUE<10,'0'+ALLTRIM(STR(THISFORM.SPINNER011.VALUE)),ALLTRIM(STR(THISFORM.SPINNER011.VALUE)))+'/'+;
                       				IIF(THISFORM.SPINNER012.VALUE<10,'0'+ALLTRIM(STR(THISFORM.SPINNER012.VALUE)),ALLTRIM(STR(THISFORM.SPINNER012.VALUE)))))+;
                       			        THISFORM.TXTF02.VALUE,.F.,'S15','S151')=.T.
             =MESSAGEBOX('此假日日期及假日名稱已存在,請重新輸入!',0+64,'提示訊息視窗')
             THISFORM.TXTF02.SETFOCUS
             RETURN              
       ENDIF           
       SELECT  S15
       APPEND BLANK
       RLOCK()
       IF RLOCK()
           REPLACE  F01 WITH CTOD(ALLTRIM(THISFORM.YEAR_LIST.DISPLAYVALUE)+'/'+;
                       				IIF(THISFORM.SPINNER011.VALUE<10,'0'+ALLTRIM(STR(THISFORM.SPINNER011.VALUE)),ALLTRIM(STR(THISFORM.SPINNER011.VALUE)))+'/'+;
                       				IIF(THISFORM.SPINNER012.VALUE<10,'0'+ALLTRIM(STR(THISFORM.SPINNER012.VALUE)),ALLTRIM(STR(THISFORM.SPINNER012.VALUE))))
           REPLACE  F02 WITH THISFORM.TXTF02.VALUE
           REPLACE  F03 WITH ALLTRIM(STR(THISFORM.OPTIONGROUP03.VALUE))
           REPLACE  F99 WITH IIF(INT_012=1,PADL(ALLTRIM(STR(YEAR(DATE())-1911)),3,' ')+RIGHT(DTOC(DATE()),6),dtoc(DATE())+' ')+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
       ENDIF    
       SELECT  S15_TEMP
       APPEND BLANK
       RLOCK()
       IF RLOCK()
           REPLACE  F01 WITH CTOD(ALLTRIM(THISFORM.YEAR_LIST.DISPLAYVALUE)+'/'+;
                       				IIF(THISFORM.SPINNER011.VALUE<10,'0'+ALLTRIM(STR(THISFORM.SPINNER011.VALUE)),ALLTRIM(STR(THISFORM.SPINNER011.VALUE)))+'/'+;
                       				IIF(THISFORM.SPINNER012.VALUE<10,'0'+ALLTRIM(STR(THISFORM.SPINNER012.VALUE)),ALLTRIM(STR(THISFORM.SPINNER012.VALUE))))
           REPLACE  F02 WITH THISFORM.TXTF02.VALUE
           REPLACE  F03 WITH ALLTRIM(STR(THISFORM.OPTIONGROUP03.VALUE))
           REPLACE  F99 WITH IIF(INT_012=1,PADL(ALLTRIM(STR(YEAR(DATE())-1911)),3,' ')+RIGHT(DTOC(DATE()),6),dtoc(DATE())+' ')+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
       ENDIF          
       UNLOCK
       THISFORM.SHRGROUP.ABANDON_BOTT.CLICK      
  ENDPROC
  PROCEDURE  ORPGROUP.EDIT_BOTT.CLICK
       THISFORM.CMND2.ENABLED=.F.     
       THISFORM.GRID1.ENABLED=.F. 
       SELECT  S15_TEMP
       RLOCK()
       IF !RLOCK()
            DO file_impact
            THISFORM.GRID1.SETFOCUS
            THISFORM.SHRGROUP.ABANDON_BOTT.CLICK 
       ELSE
            THISFORM.YEAR_LIST.ENABLED=.F.
            THISFORM.TXTF02.READONLY=.F.
            THISFORM.OPTIONGROUP03.ENABLED=.T. 
            THISFORM.TXTF02.SETFOCUS   
        ENDIF       
  ENDPROC
  PROCEDURE  SHRGROUP.SHURE2_BOTT.CLICK
        IF EMPTY(THISFORM.TXTF02.VALUE)=.T.
             =MESSAGEBOX('假日名稱不得空白!',0+64,'提示訊息視窗')
            THISFORM.TXTF02.SETFOCUS
            RETURN              
        ENDIF  
        SELECT  S15
        SET ORDER TO S151
        SEEK DTOS(S15_TEMP.F01)+S15_TEMP.F02
        IF FOUND()
             REPLACE  F02 WITH THISFORM.TXTF02.VALUE
             REPLACE  F03 WITH ALLTRIM(STR(THISFORM.OPTIONGROUP03.VALUE))
             REPLACE  F99 WITH IIF(INT_012=1,PADL(ALLTRIM(STR(YEAR(DATE())-1911)),3,' ')+RIGHT(DTOC(DATE()),6),dtoc(DATE())+' ')+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
        ENDIF
        SELECT S15_TEMP
        REPLACE  F02 WITH THISFORM.TXTF02.VALUE
        REPLACE  F03 WITH ALLTRIM(STR(THISFORM.OPTIONGROUP03.VALUE))
        REPLACE  F99 WITH IIF(INT_012=1,PADL(ALLTRIM(STR(YEAR(DATE())-1911)),3,' ')+RIGHT(DTOC(DATE()),6),dtoc(DATE())+' ')+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
        THISFORM.SHRGROUP.ABANDON_BOTT.CLICK        
  ENDPROC   
  PROCEDURE  ORPGROUP.DEL_BOTT.CLICK
       IF MESSAGEBOX('是否確定要刪除此筆資料',4+32+256,'請確認') = 6	            
            SELECT  S15_TEMP            
            IF RLOCK()    
                 SELECT S15
                 SET ORDER TO S151
                 SEEK DTOS(S15_TEMP.F01)+S15_TEMP.F02  
                 IF FOUND()          
                      DELETE 
                 ENDIF
                 SELECT  S15_TEMP
                 DELETE 
                 UNLOCK             
                 IF BOF()
                      GO TOP
                 ELSE
                      SKIP -1   
                  ENDIF   
            ELSE
                   DO file_impact                             
            ENDIF         
            THISFORM.GRID1.SETFOCUS
            IF THISFORM.GRID1.ACTIVEROW=0
	        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
		THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
		THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
		THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
		THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.   
                THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
                THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.   
                THISFORM.ORPGROUP.NEW_BOTT.ENABLED=.T.            
                THISFORM.SETALL('VALUE','','TEXTBOX')
                THISFORM.SPINNER011.VALUE=0
                THISFORM.SPINNER012.VALUE=0 
                THISFORM.TXTF02.VALUE=''            
                THISFORM.LBLF991.CAPTION=''
            ELSE      
	        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
		THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
		THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
		THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
		THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.   
                THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.) &&判斷有無修改的權限                          
                THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.) &&判斷有無刪除的權限     
            ENDIF           
       ENDIF     
  ENDPROC 
  PROCEDURE  SHRGROUP.ABANDON_BOTT.CLICK
       THISFORM.SHRGROUP.ENABLED=.F.
       THISFORM.SHRGROUP.VISIBLE=.F.      
       THISFORM.ORPGROUP.ENABLED=.T.
       THISFORM.ORPGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
       THISFORM.CMDGROUP.ENABLED=.T.
       THISFORM.CMDGROUP.SETALL('ENABLED',.T.,'COMMANDBUTTON')
       THISFORM.CMDGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
       THISFORM.SETALL('READONLY',.T.,'TEXTBOX')   
       THISFORM.SETALL('READONLY',.T.,'SPINNER') 
       THISFORM.YEAR_LIST.ENABLED=.T.
       THISFORM.OPTIONGROUP03.ENABLED=.F.
       THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.T.                  
       THISFORM.CMND2.ENABLED=.T.                                                                  
       THISFORM.GRID1.ENABLED=.T.
       THISFORM.GRID1.SETFOCUS     
       IF THISFORM.GRID1.ACTIVEROW=0
            THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
	    THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
	    THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
	    THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
	    THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.   
            THISFORM.CMDGROUP.ENABLED=.F.
            THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
            THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
            THISFORM.SPINNER011.VALUE=0
            THISFORM.SPINNER012.VALUE=0 
            THISFORM.TXTF02.VALUE=''            
            THISFORM.LBLF991.CAPTION=''
       ELSE
            THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
	    THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
	    THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
	    THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
	    THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.             
            THISFORM.CMDGROUP.ENABLED=.T.         
            THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.) &&判斷有無修改的權限                          
            THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.) &&判斷有無刪除的權限     
       ENDIF              
       UNLOCK ALL      
  ENDPROC 
  PROCEDURE  SHRGROUP.FINISH_BOTT.CLICK
            THISFORM.SHRGROUP.ABANDON_BOTT.CLICK
  ENDPROC          
ENDDEFINE   
*******
DEFINE CLASS YEAR_LIST AS COMBOBOX 
      HEIGHT=INT_015*25
      WIDTH=INT_015*50
      FONTSIZE=INT_015*9 
      ROWSOURCETYPE=1
      SPECIALEFFECT=0
      STYLE=2
      VALUE=1
      NAME='YEAR_LIST '
      TOOLTIPTEXT='目前資料年度'   
   PROCEDURE INIT
   	K=0
   	S=0
   	SELECT LEFT(DTOS(F01),4) FROM S15 ORDER BY F01 INTO CURSOR S15B
   	SELECT  S15B.EXP_1 FROM S15B GROUP BY S15B.EXP_1 ORDER BY S15B.EXP_1 INTO CURSOR S15A
   	SELECT S15A
   	GO TOP
   	IF  _TALLY >0
	     DO WHILE !EOF()
	            PO=S15A.EXP_1   	
	            K=K+1
	            THIS.ADDITEM(ALLTRIM(S15A.EXP_1))
	            IF ALLTRIM(S15A.EXP_1) = ALLTRIM(STR(YEAR(DATE())))
	                 S=K
	            ENDIF
	            SELECT S15A
	   	    SKIP
	     ENDDO
   	     THIS.ADDITEM(ALLTRIM(STR(VAL(PO)+1)))
   	     THIS.ADDITEM(ALLTRIM(STR(VAL(PO)+2)))
   	ELSE
   	     THIS.ADDITEM(ALLTRIM(LEFT(DTOS(DATE()),4)))
   	     THIS.ADDITEM(ALLTRIM(STR(VAL(LEFT(DTOS(DATE()),4))+1)))
   	     THIS.ADDITEM(ALLTRIM(STR(VAL(LEFT(DTOS(DATE()),4))+2)))
   	ENDIF  
   	THIS.VALUE = S
   	SELECT S15B
   	USE
   	SELECT S15A
   	USE   
   ENDPROC               
ENDDEFINE       
          
         