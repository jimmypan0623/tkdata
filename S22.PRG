***程式名稱:S22.部門上下班變更作業
CLOSE ALL
CLEAR 
PRG_NO='S22'
FLG='0'
FCH=''
AREA1='S22_1'
CHK=''
CHK_IN=''
HK=''
IF !USED('A01')	&&操作人員資料設定
   SELE 0
   USE A01 INDE A01
ELSE 
   SELE A01
ENDIF
SET ORDER TO A01
IF !USED('A02')	&&權限設定檔
   SELE 0
   USE A02 INDE A02
ELSE 
   SELE A02
ENDIF
SET ORDER TO A021      
SEEK sys_oper+'S22'   
IF !USED('A09')
   SELE 0
   USE A09
ELSE
   SELE A09
ENDIF
SET ORDER TO A091 
IF !USED('A14')
   SELE 0
   USE A14 INDE A14
ELSE 
   SELE A14
ENDIF
SET ORDER TO A141   
IF !USED('A23')	&&月份檔
    SELECT  0
    USE A23
ELSE 
   SELECT  A23
ENDIF
SET ORDER TO A231
A24='A24'+LEFT(DTOS(DATE()),6)     &&單號暫存檔
IF !USED('&A24')
   SELE 0
   USE (A24) ALIA A24
ELSE
   SELE A24
ENDIF
SET ORDER TO 1     
IF !USED('S0A')	&&年度缺勤天數累計
    SELECT  0
    USE S0A 
ELSE
    SELECT  S0A
ENDIF
SET ORDER TO S0A1    
IF !USED('S00')	&&薪資參數設定
   SELE 0
   USE S00 
ELSE
   SELE S00
ENDIF
SET ORDER TO S005 
IF !USED('S05')  &&人事薪資基本檔
   SELE 0
   USE S05 
ELSE
   SELE S05
ENDIF
SET ORDER TO S051
IF !USED('S13')	&&各項部門作業人員檔
   SELE 0
   USE S13 
ELSE
   SELE S13
ENDIF
SET ORDER TO S131
IF !USED('S15')	&&年度假日設定檔
   SELE 0
   USE S15 
ELSE
   SELE S15
ENDIF
SET ORDER TO S151
IF !USED('S17')	&&請假作業檔
   SELE 0
   USE S17
ELSE 
   SELE S17
ENDIF
SET ORDER TO S171  
SELECT * FROM S17 WHERE SUBSTR(S17.F02,3,4)=SUBSTR(DTOS(DATE()),3,4) ;
               AND LEFT(ALLTRIM(S17.F02),2) = 'SZ'  ORDER BY F02 INTO CURSOR S22_1 READWRITE
INDE ON F02 TAG S22_11
INDE ON F05 TAG S22_12
SET ORDER TO S22_11
****
S22FORM=CREATEOBJECT("TKS22")
S22FORM.SHOW  
DEFINE CLASS TKS22 AS FORM
  CAPTION='S22.部門上下班變更作業'
*!*	  AUTOCENTER=.T.
  CONTROLBOX=.F.
  BORDERSTYLE=1
  MAXBUTTON=.F.
  MINBUTTON=.F.
  MOVABLE=.F.
  CLOSABLE=.F.
  CONTROLCOUNT=57
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*550
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WIDTH=INT_015*791
  WINDOWTYPE=1
  NAME='TKS22'
  ADD OBJECT SHAPE1 AS SHAPE1 WITH;
      AUTOCENTER=.T.
  ADD OBJECT SHAPE2 AS SHAPE2 WITH;
      AUTOCENTER=.T.
  ADD OBJECT SHAPE3 AS SHAPE3 WITH;
      AUTOCENTER=.T.  
  ADD OBJECT ANS_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*490,;
      LEFT=INT_015*15,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*45,;      
      FONTSIZE=INT_015*9,;
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\harrow.cur',;        
      CAPTION='\<A.確認',;
      NAME='ANS_BOTT'                
  ADD OBJECT OLIST_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*490,;
      LEFT=INT_015*62,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*95,;      
      FONTSIZE=INT_015*9,;
      CAPTION='\<O.修改作業員工',;
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\harrow.cur',;        
      NAME='OLIST_BOTT'            
  **********                   
  ADD OBJECT LBLF02 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*30,;
      WIDTH=INT_015*50,;
      CAPTION='單據編號'
  ADD OBJECT TXTF02 AS TEXTBOX WITH;      
      VISIBLE=.T.,;
      LEFT=INT_015*295,;
      TOP=INT_015*24,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*80,;
      MAXLENGTH=10,;
      NAME='TXTF02'        
  ADD OBJECT LBLF01 AS LABEL WITH;
      LEFT=INT_015*464,;
      TOP=INT_015*30,;
      WIDTH=INT_015*50,;
      CAPTION='填單日期'
  ADD OBJECT TXTF01 AS TEXTBOX WITH;      
      VISIBLE=.T.,;
      LEFT=INT_015*515,;
      TOP=INT_015*24,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*70,;
      NAME='TXTF01'              
  ADD OBJECT LBLF05 AS LABEL WITH;      
      LEFT=INT_015*244,;
      TOP=INT_015*55,;
      WIDTH=INT_015*50,;
      CAPTION='部門編號'
  ADD OBJECT TXTF05 AS TEXTBOX WITH;
      VISIBLE=.T.,;
      LEFT=INT_015*295,;
      TOP=INT_015*49,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*50,;
      BACKCOLOR=RGB(255,255,100),;
      MAXLENGTH=4,;
      NAME='TXTF05'             
  ADD OBJECT LBLF06 AS LABEL WITH;      
      LEFT=INT_015*244,;
      TOP=INT_015*80,;
      WIDTH=INT_015*50,;
      CAPTION='部門名稱'
  ADD OBJECT TXTF06 AS TEXTBOX WITH;
      VISIBLE=.T.,;
      LEFT=INT_015*295,;
      TOP=INT_015*74,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*70,;
      MAXLENGTH=8,;
      NAME='TXTF06'     
  ADD OBJECT LBLF07 AS LABEL WITH;      
      LEFT=INT_015*244,;
      TOP=INT_015*105,;
      WIDTH=INT_015*50,;
      CAPTION='變更方式'        
  ADD OBJECT OPTIONGROUP07 AS OPTIONGROUP07 WITH;       
      VISIBLE=.T.,;
      LEFT=INT_015*295,;
      TOP=INT_015*99              
  ADD OBJECT LBLF08 AS LABEL WITH;      
      LEFT=INT_015*244,;
      TOP=INT_015*130,;
      WIDTH=INT_015*50,;
      CAPTION='補登事由'       
  ADD OBJECT TXTF08 AS TEXTBOX WITH;	
      VISIBLE=.T.,;
      LEFT=INT_015*295,;
      TOP=INT_015*124,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*400,;
      MAXLENGTH=60,;
      NAME='TXTF08'       
  ADD OBJECT LBLF09 AS LABEL WITH;      
      LEFT=INT_015*244,;
      TOP=INT_015*155,;
      AUTOSIZE=.T.,;
      CAPTION='補登日期                         至'     
  ADD OBJECT LBLF091 AS LABEL WITH;      
      LEFT=INT_015*300,;
      TOP=INT_015*155,;
      AUTOSIZE=.T.,;
      CAPTION=''              
  ADD OBJECT TXTF091 AS TEXTBOX WITH;	
      VISIBLE=.F.,;
      LEFT=INT_015*347,;
      TOP=INT_015*153,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*21,;
      BORDERSTYLE=0,;
      MAXLENGTH=2,;
      INPUTMASK='99',;
      NAME='TXTF091'          
  ADD OBJECT LBLF101 AS LABEL WITH;      
      LEFT=INT_015*400,;
      TOP=INT_015*155,;
      AUTOSIZE=.T.,;
      CAPTION=''                 
  ADD OBJECT TXTF101 AS TEXTBOX WITH;	
      VISIBLE=.F.,;
      LEFT=INT_015*447,;
      TOP=INT_015*153,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*21,;
      BORDERSTYLE=0,;
      MAXLENGTH=2,;
      INPUTMASK='99',;
      NAME='TXTF101'       
  ADD OBJECT LBLF111 AS LABEL WITH;      
      LEFT=INT_015*244,;
      TOP=INT_015*180,;
      WIDTH=INT_015*50,;
      CAPTION='修改時段'             
  ADD OBJECT OPTIONGROUP11 AS OPTIONGROUP11 WITH;       
      VISIBLE=.T.,;
      LEFT=INT_015*295,;
      TOP=INT_015*174          
  ADD OBJECT LBLF11 AS LABEL WITH;      
      LEFT=INT_015*244,;
      TOP=INT_015*206,;
      WIDTH=INT_015*75,;
      CAPTION='修改上班時間'      
  ADD OBJECT TXTF11 AS TEXTBOX WITH;	
      VISIBLE=.T.,;
      LEFT=INT_015*320,;
      TOP=INT_015*200,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*45,;
      MAXLENGTH=5,;
      INPUTMASK='99:99',;
      NAME='TXTF11'      
  ADD OBJECT LBLF12 AS LABEL WITH;      
      LEFT=INT_015*244,;
      TOP=INT_015*231,;
      WIDTH=INT_015*75,;
      CAPTION='修改下班時間'      
  ADD OBJECT TXTF12 AS TEXTBOX WITH;	
      VISIBLE=.T.,;
      LEFT=INT_015*320,;
      TOP=INT_015*225,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*45,;
      MAXLENGTH=5,;
      INPUTMASK='99:99',;
      NAME='TXTF12'                        
  ADD OBJECT LBLF13 AS LABEL WITH;      
      LEFT=INT_015*444,;
      TOP=INT_015*231,;
      WIDTH=INT_015*50,;
      CAPTION='狀        態'    
  ADD OBJECT LBLF131 AS LABEL WITH;      
      LEFT=INT_015*498,;
      TOP=INT_015*231,;
      AUTOSIZE=.T.,;
      CAPTION=''       
  ADD OBJECT LBLF99 AS LABEL WITH;
      LEFT=INT_015*444,;
      TOP=INT_015*255,;
      WIDTH=INT_015*50,;
      CAPTION='安全資料'
  ADD OBJECT LBLF991 AS LABEL WITH;
      LEFT=INT_015*498,;
      TOP=INT_015*255,;
      AUTOSIZE=.T.,;
      CAPTION=''                  
  ADD OBJECT LBLFS13 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*275,;
      AUTOSIZE=.T.,;
      CAPTION='欲帶入此作業之員工'                                         
  ADD OBJECT KEY_LIST AS KEY_LIST WITH;
      AUTOCENTER=.T.,;
      WIDTH=INT_015*130
  ADD OBJECT MTH_LIST AS MTH_LIST WITH;
      AUTOCENTER=.T.
  ADD OBJECT GRID1 AS GRID1 WITH;
      COLUMNCOUNT=3,;            
      RECORDSOURCE='S22_1',;      
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;
      COLUMN3.NAME='COLUMN3'
  ADD OBJECT GRID2 AS GRID2 WITH; 
      TOP=INT_015*295,;
      LEFT=INT_015*245,;
      HEIGHT=INT_015*220,;
      WIDTH=INT_015*320,;
      COLUMNCOUNT=4,;              
      RECORDSOURCE='S13',;
      LINKMASTER='S22_1',;
      RELATIONALEXPR='F02',;
      CHILDORDER='S131',;
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',; 
      COLUMN3.NAME='COLUMN3',;
      COLUMN4.NAME='COLUMN4'          
  ADD OBJECT CMDGROUP AS CMDGROUP WITH;
      AUTOSIZE=.T.              
  ADD OBJECT ORPGROUP AS ORPGROUP WITH;    
      AUTOSIZE=.T.
  ADD OBJECT SHRGROUP AS SHRGROUP WITH;
      TOP=INT_015*230,;
      LEFT=INT_015*590          
   *****   
  PROC INIT  
       SELECT S22_1
       GO BOTTOM 
       HK=ALLTRIM(LEFT(ALLTRIM(THISFORM.MTH_LIST.DISPLAYVALUE),7))
       THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(S22_1.F13<>'Y',RGB(255,0,0),'')","COLUMN")        
       THISFORM.SHRGROUP.VISIBLE=.F.
       THISFORM.SHRGROUP.ENABLED=.F.
       THISFORM.SETALL('HEIGHT',INT_015*25,'TEXTBOX')
       THISFORM.SETALL('FONTSIZE',INT_015*9,'LABEL')
       THISFORM.SETALL('FONTSIZE',INT_015*9,'TEXTBOX')
       THISFORM.SETALL('HEIGHT',INT_015*17,'LABEL')       
       THISFORM.SETALL('READONLY',.T.,'TEXTBOX')
       THISFORM.SETALL('FONTSIZE',INT_015*9,'COLUMN')
       THISFORM.SETALL('FONTSIZE',INT_015*9,'HEADER')  
       THISFORM.TXTF091.HEIGHT=INT_015*18   
       THISFORM.TXTF101.HEIGHT=INT_015*18         
       THISFORM.GRID1.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)    
       THISFORM.GRID2.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)   
       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*75
       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*50
       THISFORM.GRID1.COLUMN3.WIDTH=INT_015*60
       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='單據編號'
       THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='部門編號'
       THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='部門名稱'
       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='S22_1.F02'
       THISFORM.GRID1.COLUMN2.CONTROLSOURCE='S22_1.F05'
       THISFORM.GRID1.COLUMN3.CONTROLSOURCE='S22_1.F06'
       THISFORM.GRID2.COLUMN1.WIDTH=INT_015*50
       THISFORM.GRID2.COLUMN2.WIDTH=INT_015*65
       THISFORM.GRID2.COLUMN3.WIDTH=INT_015*55
       THISFORM.GRID2.COLUMN4.WIDTH=INT_015*120
       THISFORM.GRID2.COLUMN1.HEADER1.CAPTION='員工編號'
       THISFORM.GRID2.COLUMN2.HEADER1.CAPTION='員工姓名'
       THISFORM.GRID2.COLUMN3.HEADER1.CAPTION='任職狀況'
       THISFORM.GRID2.COLUMN4.HEADER1.CAPTION='班別時段'
       THISFORM.GRID2.COLUMN1.CONTROLSOURCE='S13.F04'
       THISFORM.GRID2.COLUMN2.CONTROLSOURCE='S13.F05'   
       THISFORM.GRID2.COLUMN3.CONTROLSOURCE="IIF(SEEK(S13.F04,'S05'),BILL_MODE(S05.F28),'')"   
       THISFORM.GRID2.COLUMN4.CONTROLSOURCE="IIF(SEEK(S13.F04,'S05'),IIF(SEEK('I' + S05.F29,'S00'),S05.F29 + SPACE(2) + S00.F50 + ' ∼ ' + S00.F51,''),'')"
       THISFORM.GRID1.READONLY=.T.       
       THISFORM.GRID1.SETFOCUS
       IF THISFORM.GRID1.ACTIVEROW=0
          THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
          THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
          THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
          THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.       
          THISFORM.CMDGROUP.ENABLED=.F.
          THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
          THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
          THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
          THISFORM.ANS_BOTT.ENABLED=.F.
          THISFORM.OLIST_BOTT.ENABLED=.F. 
          THISFORM.LBLF11.VISIBLE=.T.
          THISFORM.TXTF11.VISIBLE=.T.
          THISFORM.LBLF12.VISIBLE=.F.
          THISFORM.TXTF12.VISIBLE=.F.              
          THISFORM.TXTF01.VALUE=''
          THISFORM.TXTF02.VALUE=''
          THISFORM.TXTF05.VALUE=''
          THISFORM.TXTF06.VALUE=''     
          THISFORM.TXTF08.VALUE=''
          THISFORM.TXTF091.VALUE=''
          THISFORM.TXTF101.VALUE=''
          THISFORM.TXTF11.VALUE=''
          THISFORM.TXTF12.VALUE=''
          THISFORM.OPTIONGROUP07.VALUE=1
          THISFORM.OPTIONGROUP11.VALUE=1
          THISFORM.LBLF091.CAPTION=''
          THISFORM.LBLF101.CAPTION=''
          THISFORM.LBLF991.CAPTION=''
       ELSE
          THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
          THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
          THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
          THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.            
          THISFORM.CMDGROUP.ENABLED=.T.      
          THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  AND IIF(S22_1.F13<>'Y',.T.,.F.) &&判斷有無修改的權限
          THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)   AND IIF(S22_1.F13<>'Y',.T.,.F.) &&判斷有無刪除的權限
          THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限
          THISFORM.ANS_BOTT.ENABLED=IIF(A02.F08='*',.T.,.F.)  AND IIF(S22_1.F13<>'Y',.T.,.F.)   &&判斷有無確認的權限
          THISFORM.OLIST_BOTT.ENABLED=IIF(A02.F08='*',.T.,.F.)  AND IIF(S22_1.F13<>'Y',.T.,.F.)
       ENDIF      
       THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.)  &&判斷有無新增的權限 
       JK='單據編號'
  ENDPROC
  ***********     
  PROC KEY_LIST.INIT 
       WITH THIS 
           .ADDITEM('依單據編號排列')
           .ADDITEM('依部門編號排列')
           .VALUE=1
       ENDWITH      
  ENDPROC 
********* 
  PROC KEY_LIST.INTERACTIVECHANGE         
       SELECT  S22_1 
       DO CASE
          CASE THIS.DISPLAYVALUE='依單據編號排列'
               SET ORDER TO S22_11 
		       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*75
		       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*50
		       THISFORM.GRID1.COLUMN3.WIDTH=INT_015*60                     
		       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='單據編號'
		       THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='部門編號'
		       THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='部門名稱'
		       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='S22_1.F02'
		       THISFORM.GRID1.COLUMN2.CONTROLSOURCE='S22_1.F05'
		       THISFORM.GRID1.COLUMN3.CONTROLSOURCE='S22_1.F06'
		       JK='單據編號'
          CASE THIS.DISPLAYVALUE='依部門編號排列'
               SET ORDER TO S22_12
		       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*50
		       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*60
		       THISFORM.GRID1.COLUMN3.WIDTH=INT_015*75 
		       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='部門編號'
		       THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='部門名稱'
		       THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='單據編號'		     
		       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='S22_1.F05'    
		       THISFORM.GRID1.COLUMN2.CONTROLSOURCE='S22_1.F06'	
		       THISFORM.GRID1.COLUMN3.CONTROLSOURCE='S22_1.F02'		
		       JK='部門編號'                                                  
       ENDCASE 
       THISFORM.GRID1.SETFOCUS          
  ENDPROC   
***********
  PROC MTH_LIST.INTERACTIVECHANGE
       HK=ALLTRIM(LEFT(ALLTRIM(THISFORM.MTH_LIST.DISPLAYVALUE),7))
       THISFORM.GRID1.RECORDSOURCE=''  
       THISFORM.GRID2.RECORDSOURCE=''
       THISFORM.GRID2.LINKMASTER=''
       THISFORM.GRID2.RELATIONALEXPR=''
       THISFORM.GRID2.CHILDORDER=''       
       SELECT A24
       USE 
       SELECT S22_1
       USE
	   A24='A24'+LEFT(DTOS(CTOD(THIS.DISPLAYVALUE+'/01')),6)     &&單號暫存檔
	   IF !USED('&A24')
	      SELECT 0
	      USE (A24) ALIA A24
	   ELSE
	      SELE A24
	   ENDIF
	   SET ORDER TO 1      
	   SELECT * FROM S17 WHERE  SUBSTR(F02,3,4)=SUBSTR(DTOS(CTOD(HK+'/01')),3,4) AND LEFT(ALLTRIM(S17.F02),2) = 'SZ'  ORDER BY F02 INTO CURSOR S22_1 READWRITE
	   INDE ON F02 TAG S22_11
	   INDE ON F05 TAG S22_12
	   SET ORDER TO S22_11
	   GO BOTTOM      
       THISFORM.GRID1.RECORDSOURCE='S22_1' 
       THISFORM.GRID2.RECORDSOURCE='S13'
       THISFORM.GRID2.LINKMASTER='S22_1'
       THISFORM.GRID2.RELATIONALEXPR='F02'      
       THISFORM.GRID2.CHILDORDER='S131'         
       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*75
       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*50
       THISFORM.GRID1.COLUMN3.WIDTH=INT_015*60
       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='單據編號'
       THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='部門編號'
       THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='部門名稱'
       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='S22_1.F02'
       THISFORM.GRID1.COLUMN2.CONTROLSOURCE='S22_1.F05'
       THISFORM.GRID1.COLUMN3.CONTROLSOURCE='S22_1.F06'
       THISFORM.GRID2.COLUMN1.CONTROLSOURCE='S13.F04'
       THISFORM.GRID2.COLUMN2.CONTROLSOURCE='S13.F05'  
       THISFORM.GRID2.COLUMN3.CONTROLSOURCE="IIF(SEEK(S13.F04,'S05'),BILL_MODE(S05.F28),'')"      
       THISFORM.GRID2.COLUMN4.CONTROLSOURCE="IIF(SEEK(S13.F04,'S05'),IIF(SEEK('I' + S05.F29,'S00'),S05.F29 + SPACE(2) + S00.F50 + ' ∼ ' + S00.F51,''),'')"          
       THISFORM.GRID1.READONLY=.T.       
       THISFORM.GRID1.SETFOCUS
       THISFORM.KEY_LIST.INTERACTIVECHANGE 
       IF THISFORM.GRID1.ACTIVEROW=0
          THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
          THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
          THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
          THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.       
          THISFORM.CMDGROUP.ENABLED=.F.
          THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
          THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
          THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
          THISFORM.ANS_BOTT.ENABLED=.F.
          THISFORM.OLIST_BOTT.ENABLED=.F.
          THISFORM.LBLF11.VISIBLE=.T.
          THISFORM.TXTF11.VISIBLE=.T.
          THISFORM.LBLF12.VISIBLE=.F.
          THISFORM.TXTF12.VISIBLE=.F.              
          THISFORM.TXTF01.VALUE=''
          THISFORM.TXTF02.VALUE=''
          THISFORM.TXTF05.VALUE=''
          THISFORM.TXTF06.VALUE=''     
          THISFORM.TXTF08.VALUE=''
          THISFORM.TXTF091.VALUE=''
          THISFORM.TXTF101.VALUE=''
          THISFORM.TXTF11.VALUE=''
          THISFORM.TXTF12.VALUE=''
          THISFORM.OPTIONGROUP07.VALUE=1
          THISFORM.OPTIONGROUP11.VALUE=1
          THISFORM.LBLF091.CAPTION=''
          THISFORM.LBLF101.CAPTION=''
          THISFORM.LBLF131.CAPTION=''
          THISFORM.LBLF991.CAPTION=''
       ELSE
          THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
          THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
          THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
          THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.            
          THISFORM.CMDGROUP.ENABLED=.T.      
          THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  AND IIF(S22_1.F13<>'Y',.T.,.F.) &&判斷有無修改的權限
          THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)   AND IIF(S22_1.F13<>'Y',.T.,.F.) &&判斷有無刪除的權限
          THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限
          THISFORM.ANS_BOTT.ENABLED=IIF(A02.F08='*',.T.,.F.)  AND IIF(S22_1.F13<>'Y',.T.,.F.)   &&判斷有無確認的權限
          THISFORM.OLIST_BOTT.ENABLED=IIF(A02.F08='*',.T.,.F.)  AND IIF(S22_1.F13<>'Y',.T.,.F.)
       ENDIF      
       THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.)  &&判斷有無新增的權限    
       THISFORM.REFRESH 
  *********
  PROC GRID1.AFTERROWCOLCHANGE
       LPARAMETERS nColIndex
       SELECT S22_1     
       THISFORM.TXTF01.VALUE=F01
       THISFORM.TXTF02.VALUE=F02
       THISFORM.TXTF05.VALUE=F05
       THISFORM.TXTF06.VALUE=F06
       THISFORM.OPTIONGROUP07.VALUE=IIF(F07='1',2,1)
       THISFORM.TXTF08.VALUE=F08
       THISFORM.LBLF091.CAPTION=ALLTRIM(DTOC(F09))
       THISFORM.LBLF101.CAPTION=ALLTRIM(DTOC(F10))
       THISFORM.TXTF091.VALUE=RIGHT(ALLTRIM(DTOC(F09)),2)
       THISFORM.TXTF101.VALUE=RIGHT(ALLTRIM(DTOC(F10)),2)
       DO CASE
          CASE !EMPTY(F11) AND EMPTY(F12)
               THISFORM.LBLF11.VISIBLE=.T.
               THISFORM.TXTF11.VISIBLE=.T.
               THISFORM.LBLF12.VISIBLE=.F.
               THISFORM.TXTF12.VISIBLE=.F.
               THISFORM.OPTIONGROUP11.VALUE=1
          CASE EMPTY(F11) AND !EMPTY(F12)
               THISFORM.LBLF11.VISIBLE=.F.
               THISFORM.TXTF11.VISIBLE=.F.
               THISFORM.LBLF12.VISIBLE=.T.
               THISFORM.TXTF12.VISIBLE=.T.
               THISFORM.OPTIONGROUP11.VALUE=2
          CASE !EMPTY(F11) AND !EMPTY(F12)
               THISFORM.LBLF11.VISIBLE=.T.
               THISFORM.TXTF11.VISIBLE=.T.
               THISFORM.LBLF12.VISIBLE=.T.
               THISFORM.TXTF12.VISIBLE=.T.
               THISFORM.OPTIONGROUP11.VALUE=3
       ENDCASE
       THISFORM.TXTF11.VALUE=F11
       THISFORM.TXTF12.VALUE=F12
       THISFORM.LBLF131.CAPTION=IIF(S22_1.F13<>'Y','尚未確認','已確認') 
       THISFORM.LBLF131.BACKCOLOR=IIF(S22_1.F13<>'Y',RGB(255,0,0),RGB(58,186,152)) 
       THISFORM.LBLF991.CAPTION=F99    
       IF F07='1'
       	   THISFORM.LBLF08.CAPTION='補登事由'
       	   THISFORM.LBLF09.CAPTION='補登日期                         至'
       	   THISFORM.LBLF11.CAPTION='補登上班時間'
       	   THISFORM.LBLF111.CAPTION='補登時段'
       	   THISFORM.LBLF12.CAPTION='補登下班時間'
       ELSE
       	   THISFORM.LBLF08.CAPTION='修改事由'
       	   THISFORM.LBLF09.CAPTION='修改日期                         至'
       	   THISFORM.LBLF11.CAPTION='修改上班時間'
       	   THISFORM.LBLF111.CAPTION='修改時段'
       	   THISFORM.LBLF12.CAPTION='修改下班時間'       
       ENDIF            
       THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  AND IIF(S22_1.F13<>'Y',.T.,.F.) &&判斷有無修改的權限
       THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)   AND IIF(S22_1.F13<>'Y',.T.,.F.) &&判斷有無刪除的權限
       THISFORM.ANS_BOTT.ENABLED=IIF(A02.F08='*',.T.,.F.)  AND IIF(S22_1.F13<>'Y',.T.,.F.)   &&判斷有無確認的權限
       THISFORM.OLIST_BOTT.ENABLED=IIF(A02.F08='*',.T.,.F.)  AND IIF(S22_1.F13<>'Y',.T.,.F.)
       FCH=THISFORM.ACTIVECONTROL.NAME
       CHK=''
       THISFORM.REFRESH
  ENDPROC      
  ********** 
  PROCEDURE ORPGROUP.NEW_BOTT.CLICK    
       THISFORM.KEY_LIST.ENABLED=.F. 
       THISFORM.MTH_LIST.ENABLED=.F. 
       THISFORM.ANS_BOTT.ENABLED=.F.  
       THISFORM.OLIST_BOTT.ENABLED=.F.  
       THISFORM.GRID2.COLUMN1.CONTROLSOURCE=''
       THISFORM.GRID2.COLUMN2.CONTROLSOURCE=''   
       THISFORM.GRID2.COLUMN3.CONTROLSOURCE='' 
       THISFORM.GRID2.COLUMN4.CONTROLSOURCE=''         
       THISFORM.GRID1.ENABLED=.F.   
       THISFORM.GRID2.ENABLED=.F. 
       H='S022 '+SUBSTR(DTOS(CTOD(HK+'/01')),3,4)
       SELECT  A24   
       SET ORDER TO 1
       SEEK H           
       IF FOUND() 
          PO_NO=F08
          RLOCK()
          DELETE 
          UNLOCK
       ELSE
          SELECT A09
          SEEK H            
          IF !FOUND()                                                  &&如果為本月第一張訂單則重頭開始編號
		     APPEND BLANK                                                
		     REPLACE F01 WITH 'S022 '
		     REPLACE F02 WITH SUBSTR(DTOS(CTOD(HK+'/01')),3,4)
		     REPLACE F05 WITH 'SZ'+F02
		     REPLACE F06 WITH '部門上下班變更作業'
		     REPLACE F08 WITH ALLTRIM(F05)+'0000'
	      ENDIF
	      LOCK()
	      HX=VAL(RIGHT(F08,4))+1
	      PO_NO=LEFT(F08,6)+PADL(ALLTRIM(STR(HX)),4,'0')
	      REPLACE  F08 WITH PO_NO                                             &&記錄本訂單號碼,本月份後續的訂單號碼將以此往下編
	      UNLOCK
       ENDIF 
       THISFORM.SETALL('READONLY',.F.,'TEXTBOX')
       THISFORM.LBLF08.CAPTION='修改事由'
       THISFORM.LBLF09.CAPTION='修改日期                         至'
       THISFORM.LBLF11.CAPTION='修改上班時間'
       THISFORM.LBLF12.CAPTION='修改下班時間'
       THISFORM.TXTF01.READONLY=.T.  
       THISFORM.TXTF02.READONLY=.T.   
       THISFORM.TXTF06.READONLY=.T.  
       THISFORM.TXTF11.READONLY=.F.
       THISFORM.TXTF12.READONLY=.T.        
       THISFORM.OPTIONGROUP07.ENABLED=.T.
       THISFORM.OPTIONGROUP11.ENABLED=.T.
       THISFORM.TXTF091.VISIBLE=.T.
       THISFORM.TXTF101.VISIBLE=.T.
       THISFORM.TXTF12.VISIBLE=.F.
       THISFORM.LBLF12.VISIBLE=.F.
       THISFORM.OPTIONGROUP07.VALUE=1     
       THISFORM.OPTIONGROUP11.VALUE=1  
       THISFORM.TXTF01.VALUE=DATE()             
       THISFORM.TXTF02.VALUE=PO_NO
       THISFORM.TXTF05.VALUE=''
       THISFORM.TXTF06.VALUE=''
       THISFORM.TXTF08.VALUE=''
       THISFORM.LBLF091.CAPTION=ALLTRIM(HK+'/')
       THISFORM.LBLF101.CAPTION=ALLTRIM(HK+'/')      
       THISFORM.TXTF091.VALUE=''
       THISFORM.TXTF101.VALUE=''
       THISFORM.TXTF11.VALUE=''
       THISFORM.TXTF12.VALUE=''
       THISFORM.LBLF131.CAPTION=''
       THISFORM.LBLF991.CAPTION=''
       THISFORM.TXTF05.SETFOCUS() 
       FLG='1'
  ENDPROC  
************
  PROCEDURE SHRGROUP.SHURE1_BOTT.CLICK
    IF EMPTY(THISFORM.TXTF02.VALUE)
       =MESSAGEBOX('單據編號不得空白,請洽系統管理人員處裡!',0+64,'提示視窗')
       THISFORM.TXTF02.SETFOCUS
       RETURN
    ENDIF      
    IF INDEXSEEK(THISFORM.TXTF02.VALUE,.F.,'S17','S171') =.T.       &&如果單據編號重複
       SELECT A24
       SEEK 'S022 '+SUBSTR(DTOS(CTOD(HK+'/01')),3,4)+THISFORM.TXTF02.VALUE
       IF FOUND()
          DO WHILE F01+F02+F08='S022 '+SUBSTR(DTOS(CTOD(HK+'/01')),3,4)+THISFORM.TXTF02.VALUE
             RLOCK()
             DELETE 
             UNLOCK
             SKIP
          ENDDO   
       ENDIF                    
       SELECT A09
       SEEK 'S022 '+SUBSTR(DTOS(CTOD(HK+'/01')),3,4)
       IF FOUND()
          RLOCK()
          HX=VAL(RIGHT(F08,4))+1
   	      PO_NO=LEFT(F08,6)+PADL(ALLTRIM(STR(HX)),4,'0')
	      REPLACE F08 WITH PO_NO                                             &&記錄本訂單號碼,本月份後續的訂單號碼將以此往下編
		  UNLOCK
          THISFORM.TXTF02.VALUE=PO_NO
	      THISFORM.TXTF02.REFRESH
       ENDIF   	       
    ENDIF    
    MES_NAME = IIF(THISFORM.OPTIONGROUP07.VALUE=2,'補登','修改')    
    IF EMPTY(ALLTRIM(THISFORM.TXTF05.VALUE)) OR EMPTY(ALLTRIM(THISFORM.TXTF06.VALUE))
       =MESSAGEBOX('部門編號不得空白!',0+64,'提示視窗')
       THISFORM.TXTF05.SETFOCUS
       RETURN
    ENDIF   
    IF INDEXSEEK(ALLTRIM(THISFORM.TXTF05.VALUE),.F.,'S05','S053') = .F.
       =MESSAGEBOX('此部門編號中無任何員工資料!',0+64,'提示視窗')
       THISFORM.TXTF05.SETFOCUS
       RETURN
    ENDIF     
    IF EMPTY(ALLTRIM(THISFORM.TXTF08.VALUE))
       =MESSAGEBOX(MES_NAME + '事由不得空白!',0+64,'提示視窗')
       THISFORM.TXTF08.SETFOCUS
       RETURN
    ENDIF    
    ****
    STA_DATE=CTOD(HK+'/'+ALLTRIM(THISFORM.TXTF091.VALUE))
    END_DATE=CTOD(HK+'/'+ALLTRIM(THISFORM.TXTF101.VALUE))
    IF EMPTY(THISFORM.TXTF091.VALUE)
	   =MESSAGEBOX(MES_NAME + '起始日期不得空白!',0+64,'提示視窗')
	   THISFORM.TXTF091.SETFOCUS
	   RETURN
    ENDIF
    IF EMPTY(STA_DATE)
	   =MESSAGEBOX(MES_NAME + '起始日期格式不正確!',0+64,'提示視窗')
	   THISFORM.TXTF091.SETFOCUS
	   RETURN
    ENDIF    
    IF DOW(STA_DATE)=1 OR DOW(STA_DATE)=7 
       IF IIF(INDEXSEEK(DTOS(STA_DATE),.T.,'S15','S151'),S15.F03 <> '2',.T.) = .T.
          =MESSAGEBOX(MES_NAME + '起始日期不得為假日,請查明後再輸入!',0+64,'提示視窗')
          THISFORM.TXTF091.SETFOCUS
	      RETURN  
	   ENDIF
	ELSE
       IF IIF(INDEXSEEK(DTOS(STA_DATE),.T.,'S15','S151'),S15.F03 = '1',.F.) = .T.
          =MESSAGEBOX(MES_NAME + '起始日期不得為假日,請查明後再輸入!',0+64,'提示視窗')
          THISFORM.TXTF091.SETFOCUS
	      RETURN  
	   ENDIF	               
    ENDIF    
    IF EMPTY(END_DATE)
	   =MESSAGEBOX(MES_NAME + '截止日期不得空白!',0+64,'提示視窗')
	   THISFORM.TXTF101.SETFOCUS
	   RETURN
    ENDIF    
    IF EMPTY(THISFORM.TXTF101.VALUE)
	   =MESSAGEBOX(MES_NAME + '截止日期格式不正確!',0+64,'提示視窗')
	   THISFORM.TXTF101.SETFOCUS
	   RETURN
    ENDIF         
    IF DOW(END_DATE)=1 OR DOW(END_DATE)=7 
       IF IIF(INDEXSEEK(DTOS(END_DATE),.T.,'S15','S151'),S15.F03 <> '2',.T.) = .T.
          =MESSAGEBOX(MES_NAME + '截止日期不得為假日,請查明後再輸入!',0+64,'提示視窗')
          THISFORM.TXTF101.SETFOCUS
	      RETURN  
	   ENDIF
	ELSE
       IF IIF(INDEXSEEK(DTOS(END_DATE),.T.,'S15','S151'),S15.F03 = '1',.F.) = .T.
          =MESSAGEBOX(MES_NAME + '截止日期不得為假日,請查明後再輸入!',0+64,'提示視窗')
          THISFORM.TXTF101.SETFOCUS
	      RETURN  
	   ENDIF	               
    ENDIF     
    IF STA_DATE>END_DATE
	   =MESSAGEBOX(MES_NAME + '起始日期不得大於' + MES_NAME + '截止日期,請重新輸入!',0+64,'提示視窗')
	   THISFORM.TXTF091.SETFOCUS
	   RETURN            
    ENDIF        
    IF END_DATE<STA_DATE
	   =MESSAGEBOX(MES_NAME + '截止日期不得小於' + MES_NAME + '起始日期,請重新輸入!',0+64,'提示視窗')
       THISFORM.TXTF101.SETFOCUS
       RETURN            
    ENDIF 
    IF THISFORM.OPTIONGROUP11.VALUE = 1 OR THISFORM.OPTIONGROUP11.VALUE = 3  
	   IF EMPTY(ALLTRIM(LEFT(THISFORM.TXTF11.VALUE,2))) AND EMPTY(ALLTRIM(RIGHT(THISFORM.TXTF11.VALUE,2))) 
	      =MESSAGEBOX(MES_NAME + '上班時間不得空白!',0+64,'提示視窗')     
	      THISFORM.TXTF11.SETFOCUS
	      RETURN       
	   ENDIF                 
	   IF LEN(ALLTRIM(THISFORM.TXTF11.VALUE))>1  
	      IF LEN(ALLTRIM(THISFORM.TXTF11.VALUE))<>5 OR ;
	         LEN(ALLTRIM(LEFT(ALLTRIM(THISFORM.TXTF11.VALUE),2)))=1 OR;
	         LEN(ALLTRIM(RIGHT(ALLTRIM(THISFORM.TXTF11.VALUE),2)))=1 OR;
	         VAL(LEFT(ALLTRIM(THISFORM.TXTF11.VALUE),2))>23 OR;
	         VAL(RIGHT(ALLTRIM(THISFORM.TXTF11.VALUE),2))>59
	         =MESSAGEBOX(MES_NAME + '上班時間格式不正確!',0+64,'提示視窗')     
	         THISFORM.TXTF11.SETFOCUS
	         RETURN
	      ENDIF 
	   ENDIF
	ENDIF 
	IF THISFORM.OPTIONGROUP11.VALUE = 2 OR THISFORM.OPTIONGROUP11.VALUE = 3                
	   IF EMPTY(ALLTRIM(LEFT(THISFORM.TXTF12.VALUE,2))) AND EMPTY(ALLTRIM(RIGHT(THISFORM.TXTF12.VALUE,2))) 
	      =MESSAGEBOX(MES_NAME + '下班時間不得空白!',0+64,'提示視窗')     
	      THISFORM.TXTF12.SETFOCUS
		  RETURN       
	   ENDIF  		    
	   IF LEN(ALLTRIM(THISFORM.TXTF12.VALUE))>1 
	      IF LEN(ALLTRIM(THISFORM.TXTF12.VALUE))<>5 OR ;
		     LEN(ALLTRIM(LEFT(ALLTRIM(THISFORM.TXTF12.VALUE),2)))=1 OR;
		     LEN(ALLTRIM(RIGHT(ALLTRIM(THISFORM.TXTF12.VALUE),2)))=1 OR;
		     VAL(LEFT(ALLTRIM(THISFORM.TXTF12.VALUE),2))>23 OR;
		     VAL(RIGHT(ALLTRIM(THISFORM.TXTF12.VALUE),2))>59
		     =MESSAGEBOX(MES_NAME + '下班時間格式不正確!',0+64,'提示視窗')     
		     THISFORM.TXTF12.SETFOCUS
		     RETURN
		  ENDIF 
	   ENDIF
	ENDIF
	IF THISFORM.OPTIONGROUP11.VALUE = 3    
	   IF ALLTRIM(THISFORM.TXTF11.VALUE)>=ALLTRIM(THISFORM.TXTF12.VALUE)
	      =MESSAGEBOX(MES_NAME + '上班時間不可大於或等於下班時間!',0+64,'提示視窗')  
	      THISFORM.TXTF11.SETFOCUS
	      RETURN
	   ENDIF	    
    ENDIF	      
    ***     
    SELECT S17
    APPEND BLANK
    LOCK()
    IF RLOCK()
       REPLACE F01 WITH THISFORM.TXTF01.VALUE
       REPLACE F02 WITH THISFORM.TXTF02.VALUE
       REPLACE F05 WITH THISFORM.TXTF05.VALUE
       REPLACE F06 WITH THISFORM.TXTF06.VALUE
       REPLACE F07 WITH IIF(THISFORM.OPTIONGROUP07.VALUE=1,'2','1')
       REPLACE F08 WITH THISFORM.TXTF08.VALUE
       REPLACE F09 WITH STA_DATE
       REPLACE F10 WITH END_DATE
       DO CASE
          CASE THISFORM.OPTIONGROUP11.VALUE=1
               REPLACE F11 WITH IIF(LEN(ALLTRIM(THISFORM.TXTF11.VALUE))=1,'',THISFORM.TXTF11.VALUE)
          CASE THISFORM.OPTIONGROUP11.VALUE=2
               REPLACE F12 WITH IIF(LEN(ALLTRIM(THISFORM.TXTF12.VALUE))=1,'',THISFORM.TXTF12.VALUE)
          CASE THISFORM.OPTIONGROUP11.VALUE=3
		       REPLACE F11 WITH IIF(LEN(ALLTRIM(THISFORM.TXTF11.VALUE))=1,'',THISFORM.TXTF11.VALUE)
		       REPLACE F12 WITH IIF(LEN(ALLTRIM(THISFORM.TXTF12.VALUE))=1,'',THISFORM.TXTF12.VALUE)             
       ENDCASE
       REPLACE F13 WITH 'N'
       REPLACE F14 WITH sys_oper
       REPLACE F99 WITH DTOC(DATE())+' '+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
    ENDIF          
    SELECT S22_1
    APPEND BLANK
    LOCK()
    IF RLOCK()
       REPLACE F01 WITH THISFORM.TXTF01.VALUE
       REPLACE F02 WITH THISFORM.TXTF02.VALUE
       REPLACE F05 WITH THISFORM.TXTF05.VALUE
       REPLACE F06 WITH THISFORM.TXTF06.VALUE
       REPLACE F07 WITH IIF(THISFORM.OPTIONGROUP07.VALUE=1,'2','1')
       REPLACE F08 WITH THISFORM.TXTF08.VALUE
       REPLACE F09 WITH STA_DATE
       REPLACE F10 WITH END_DATE
       DO CASE
          CASE THISFORM.OPTIONGROUP11.VALUE=1
               REPLACE F11 WITH IIF(LEN(ALLTRIM(THISFORM.TXTF11.VALUE))=1,'',THISFORM.TXTF11.VALUE)
          CASE THISFORM.OPTIONGROUP11.VALUE=2
               REPLACE F12 WITH IIF(LEN(ALLTRIM(THISFORM.TXTF12.VALUE))=1,'',THISFORM.TXTF12.VALUE)
          CASE THISFORM.OPTIONGROUP11.VALUE=3
		       REPLACE F11 WITH IIF(LEN(ALLTRIM(THISFORM.TXTF11.VALUE))=1,'',THISFORM.TXTF11.VALUE)
		       REPLACE F12 WITH IIF(LEN(ALLTRIM(THISFORM.TXTF12.VALUE))=1,'',THISFORM.TXTF12.VALUE)             
       ENDCASE
       REPLACE F13 WITH 'N'
       REPLACE F14 WITH sys_oper
       REPLACE F99 WITH DTOC(DATE())+' '+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
    ENDIF
    ****
    SELECT F01,F02 FROM S05 WHERE ALLTRIM(F05) = ALLTRIM(THISFORM.TXTF05.VALUE) AND S05.F28 <> '1' AND S05.F28 <> '3' AND S05.F28 <> '7' AND S05.F28 <> '8' AND S05.F28 <> '9' ORDER BY F01 INTO CURSOR S05_TEMP
    SELECT S05_TEMP
    GO TOP
    DO WHILE !EOF()
       SELECT S13
       APPEND BLANK
       REPLACE S13.F01 WITH 'S22'
       REPLACE S13.F02 WITH THISFORM.TXTF02.VALUE
       REPLACE S13.F03 WITH THISFORM.TXTF05.VALUE
       REPLACE S13.F04 WITH S05_TEMP.F01
       REPLACE S13.F05 WITH S05_TEMP.F02
       SELECT S05_TEMP
       SKIP
    ENDDO
    SELECT S05_TEMP 
    USE   
*!*	    SELECT S13
*!*	    SEEK THISFORM.TXTF02.VALUE + 'S22' 
*!*	    IF !FOUND()
*!*	       SELECT S17
*!*	       SET ORDER TO S171   && F02 
*!*	       SEEK THISFORM.TXTF02.VALUE
*!*	       IF FOUND()
*!*	          DELETE 
*!*	       ENDIF
*!*	       SELECT S22_1
*!*	       SET ORDER TO S22_11
*!*	       IF FOUND()
*!*	          SELECT 
*!*	       ENDIF
*!*	       SELECT  A24         
*!*	       SEEK 'S022 '+ SUBSTR(DTOS(CTOD(HK+'/01')),3,4) + THISFORM.TXTF02.VALUE
*!*	       IF !FOUND()
*!*	           APPEND BLANK
*!*	           RLOCK()
*!*	           REPLACE F01 WITH 'S022 '
*!*	           REPLACE F02 WITH SUBSTR(DTOS(CTOD(HK+'/01')),3,4)
*!*	           REPLACE F05 WITH 'SZ'+F02
*!*	           REPLACE F06 WITH '部門上下班變更作業'
*!*	           REPLACE F08 WITH THISFORM.TXTF02.VALUE
*!*	           UNLOCK  
*!*	       ENDIF        
*!*	    ENDIF
    UNLOCK
    THISFORM.GRID1.ENABLED=.T.
    THISFORM.REFRESH
    THISFORM.GRID1.SETFOCUS    
    THISFORM.SHRGROUP.ABANDON_BOTT.CLICK             
  ENDPROC
************  
  PROCEDURE ORPGROUP.EDIT_BOTT.CLICK
     SELECT S22_1
     THISFORM.KEY_LIST.ENABLED=.F. 
     THISFORM.MTH_LIST.ENABLED=.F.  
     THISFORM.ANS_BOTT.ENABLED=.F.  
     THISFORM.OLIST_BOTT.ENABLED=.F.
     THISFORM.GRID1.ENABLED=.F.     
     THISFORM.GRID2.ENABLED=.F. 
     THISFORM.SETALL('READONLY',.F.,'TEXTBOX')   
     THISFORM.OPTIONGROUP07.ENABLED=.T.
     THISFORM.OPTIONGROUP11.ENABLED=.T.
     THISFORM.TXTF091.VISIBLE=.T.
     THISFORM.TXTF101.VISIBLE=.T.
     THISFORM.TXTF01.READONLY=.T.
     THISFORM.TXTF02.READONLY=.T.
     THISFORM.TXTF05.READONLY=.T.
     THISFORM.TXTF06.READONLY=.T.
     THISFORM.LBLF091.CAPTION=ALLTRIM(HK+'/')
     THISFORM.LBLF101.CAPTION=ALLTRIM(HK+'/')      
     THISFORM.TXTF091.VALUE=ALLTRIM(RIGHT(DTOC(F09),2))
     THISFORM.TXTF101.VALUE=ALLTRIM(RIGHT(DTOC(F10),2))      
     THISFORM.LBLF131.CAPTION=''  
     THISFORM.LBLF991.CAPTION=''     
     THISFORM.TXTF08.SETFOCUS
     LOCK()
     IF !RLOCK()
        DO FILE_IMPACT
        RETURN
     ENDIF
  ENDPROC 
************  
  PROCEDURE SHRGROUP.SHURE2_BOTT.CLICK     
    MES_NAME = IIF(THISFORM.OPTIONGROUP07.VALUE=2,'補登','修改')
    IF EMPTY(ALLTRIM(THISFORM.TXTF08.VALUE))
       =MESSAGEBOX(MES_NAME + '事由不得空白!',0+64,'提示視窗')
       THISFORM.TXTF08.SETFOCUS
       RETURN
    ENDIF    
    ****
    STA_DATE=CTOD(HK+'/'+ALLTRIM(THISFORM.TXTF091.VALUE))
    END_DATE=CTOD(HK+'/'+ALLTRIM(THISFORM.TXTF101.VALUE))
    IF EMPTY(THISFORM.TXTF091.VALUE)
	   =MESSAGEBOX(MES_NAME + '起始日期不得空白!',0+64,'提示視窗')
	   THISFORM.TXTF091.SETFOCUS
	   RETURN
    ENDIF
    IF EMPTY(STA_DATE)
	   =MESSAGEBOX(MES_NAME + '起始日期格式不正確!',0+64,'提示視窗')
	   THISFORM.TXTF091.SETFOCUS
	   RETURN
    ENDIF    
    IF DOW(STA_DATE)=1 OR DOW(STA_DATE)=7 
       IF IIF(INDEXSEEK(DTOS(STA_DATE),.T.,'S15','S151'),S15.F03 <> '2',.T.) = .T.
          =MESSAGEBOX(MES_NAME + '起始日期不得為假日,請查明後再輸入!',0+64,'提示視窗')
          THISFORM.TXTF091.SETFOCUS
	      RETURN  
	   ENDIF
	ELSE
       IF IIF(INDEXSEEK(DTOS(STA_DATE),.T.,'S15','S151'),S15.F03 = '1',.F.) = .T.
          =MESSAGEBOX(MES_NAME + '起始日期不得為假日,請查明後再輸入!',0+64,'提示視窗')
          THISFORM.TXTF091.SETFOCUS
	      RETURN  
	   ENDIF	               
    ENDIF        
    IF EMPTY(END_DATE)
	   =MESSAGEBOX(MES_NAME + '截止日期不得空白!',0+64,'提示視窗')
	   THISFORM.TXTF101.SETFOCUS
	   RETURN
    ENDIF    
    IF EMPTY(THISFORM.TXTF101.VALUE)
	   =MESSAGEBOX(MES_NAME + '截止日期格式不正確!',0+64,'提示視窗')
	   THISFORM.TXTF101.SETFOCUS
	   RETURN
    ENDIF      
    IF DOW(END_DATE)=1 OR DOW(END_DATE)=7 
       IF IIF(INDEXSEEK(DTOS(END_DATE),.T.,'S15','S151'),S15.F03 <> '2',.T.) = .T.
          =MESSAGEBOX(MES_NAME + '截止日期不得為假日,請查明後再輸入!',0+64,'提示視窗')
          THISFORM.TXTF101.SETFOCUS
	      RETURN  
	   ENDIF
	ELSE
       IF IIF(INDEXSEEK(DTOS(END_DATE),.T.,'S15','S151'),S15.F03 = '1',.F.) = .T.
          =MESSAGEBOX(MES_NAME + '截止日期不得為假日,請查明後再輸入!',0+64,'提示視窗')
          THISFORM.TXTF101.SETFOCUS
	      RETURN  
	   ENDIF	               
    ENDIF         
    IF STA_DATE>END_DATE
	   =MESSAGEBOX(MES_NAME + '起始日期不得大於' + MES_NAME + '截止日期,請重新輸入!',0+64,'提示視窗')
	   THISFORM.TXTF091.SETFOCUS
	   RETURN            
    ENDIF        
    IF END_DATE<STA_DATE
	   =MESSAGEBOX(MES_NAME + '截止日期不得小於' + MES_NAME + '起始日期,請重新輸入!',0+64,'提示視窗')
       THISFORM.TXTF101.SETFOCUS
       RETURN            
    ENDIF
    IF THISFORM.OPTIONGROUP11.VALUE = 1 OR THISFORM.OPTIONGROUP11.VALUE = 3
	   IF EMPTY(ALLTRIM(LEFT(THISFORM.TXTF11.VALUE,2))) AND EMPTY(ALLTRIM(RIGHT(THISFORM.TXTF11.VALUE,2))) 
	      =MESSAGEBOX(MES_NAME + '上班時間不得空白!',0+64,'提示視窗')     
	      THISFORM.TXTF11.SETFOCUS
	      RETURN       
	   ENDIF             
	   IF LEN(ALLTRIM(THISFORM.TXTF11.VALUE))>1  
	      IF LEN(ALLTRIM(THISFORM.TXTF11.VALUE))<>5 OR ;
	         LEN(ALLTRIM(LEFT(ALLTRIM(THISFORM.TXTF11.VALUE),2)))=1 OR;
	         LEN(ALLTRIM(RIGHT(ALLTRIM(THISFORM.TXTF11.VALUE),2)))=1 OR;
	         VAL(LEFT(ALLTRIM(THISFORM.TXTF11.VALUE),2))>23 OR;
	         VAL(RIGHT(ALLTRIM(THISFORM.TXTF11.VALUE),2))>59
	         =MESSAGEBOX(MES_NAME + '上班時間格式不正確!',0+64,'提示視窗')     
	         THISFORM.TXTF11.SETFOCUS
	         RETURN
	      ENDIF 
	   ENDIF 
	ENDIF 
	IF THISFORM.OPTIONGROUP11.VALUE = 2 OR THISFORM.OPTIONGROUP11.VALUE = 3     
	   IF EMPTY(ALLTRIM(LEFT(THISFORM.TXTF12.VALUE,2))) AND EMPTY(ALLTRIM(RIGHT(THISFORM.TXTF12.VALUE,2))) 
		  =MESSAGEBOX(MES_NAME + '下班時間不得空白!',0+64,'提示視窗')     
		  THISFORM.TXTF12.SETFOCUS
		  RETURN       
	   ENDIF  		             
	   IF LEN(ALLTRIM(THISFORM.TXTF12.VALUE))>1 
	   	  IF LEN(ALLTRIM(THISFORM.TXTF12.VALUE))<>5 OR ;
			 LEN(ALLTRIM(LEFT(ALLTRIM(THISFORM.TXTF12.VALUE),2)))=1 OR;
			 LEN(ALLTRIM(RIGHT(ALLTRIM(THISFORM.TXTF12.VALUE),2)))=1 OR;
			 VAL(LEFT(ALLTRIM(THISFORM.TXTF12.VALUE),2))>23 OR;
			 VAL(RIGHT(ALLTRIM(THISFORM.TXTF12.VALUE),2))>59
			 =MESSAGEBOX(MES_NAME + '下班時間格式不正確!',0+64,'提示視窗')     
			 THISFORM.TXTF12.SETFOCUS
			 RETURN
	      ENDIF 
	   ENDIF	
    ENDIF
    IF THISFORM.OPTIONGROUP11.VALUE = 3	   
	   IF ALLTRIM(THISFORM.TXTF11.VALUE)>=ALLTRIM(THISFORM.TXTF12.VALUE)
          =MESSAGEBOX(MES_NAME + '上班時間不可大於或等於下班時間!',0+64,'提示視窗')  
		  THISFORM.TXTF11.SETFOCUS
		  RETURN
	   ENDIF
	ENDIF	   	            
    *******
    SELECT  S17
    SET ORDER TO S171
    SEEK THISFORM.TXTF02.VALUE
    IF FOUND()
       REPLACE F07 WITH IIF(THISFORM.OPTIONGROUP07.VALUE=1,'2','1')
       REPLACE F08 WITH THISFORM.TXTF08.VALUE
       REPLACE F09 WITH STA_DATE
       REPLACE F10 WITH END_DATE
       DO CASE
          CASE THISFORM.OPTIONGROUP11.VALUE=1
               REPLACE F11 WITH IIF(LEN(ALLTRIM(THISFORM.TXTF11.VALUE))=1,'',THISFORM.TXTF11.VALUE)
               REPLACE F12 WITH ''
          CASE THISFORM.OPTIONGROUP11.VALUE=2
               REPLACE F11 WITH ''
               REPLACE F12 WITH IIF(LEN(ALLTRIM(THISFORM.TXTF12.VALUE))=1,'',THISFORM.TXTF12.VALUE)
          CASE THISFORM.OPTIONGROUP11.VALUE=3
		       REPLACE F11 WITH IIF(LEN(ALLTRIM(THISFORM.TXTF11.VALUE))=1,'',THISFORM.TXTF11.VALUE)
		       REPLACE F12 WITH IIF(LEN(ALLTRIM(THISFORM.TXTF12.VALUE))=1,'',THISFORM.TXTF12.VALUE)             
       ENDCASE
       REPLACE F14 WITH sys_oper      
       REPLACE F99 WITH DTOC(DATE())+' '+IIF(SEEK(sys_oper,'A01'),A01.F03,'')  
    ENDIF
    SELECT S22_1
    IF RLOCK()
       REPLACE F07 WITH IIF(THISFORM.OPTIONGROUP07.VALUE=1,'2','1')
       REPLACE F08 WITH THISFORM.TXTF08.VALUE
       REPLACE F09 WITH STA_DATE
       REPLACE F10 WITH END_DATE
       DO CASE
          CASE THISFORM.OPTIONGROUP11.VALUE=1
               REPLACE F11 WITH IIF(LEN(ALLTRIM(THISFORM.TXTF11.VALUE))=1,'',THISFORM.TXTF11.VALUE)
               REPLACE F12 WITH ''
          CASE THISFORM.OPTIONGROUP11.VALUE=2
               REPLACE F11 WITH ''
               REPLACE F12 WITH IIF(LEN(ALLTRIM(THISFORM.TXTF12.VALUE))=1,'',THISFORM.TXTF12.VALUE)
          CASE THISFORM.OPTIONGROUP11.VALUE=3
		       REPLACE F11 WITH IIF(LEN(ALLTRIM(THISFORM.TXTF11.VALUE))=1,'',THISFORM.TXTF11.VALUE)
		       REPLACE F12 WITH IIF(LEN(ALLTRIM(THISFORM.TXTF12.VALUE))=1,'',THISFORM.TXTF12.VALUE)             
       ENDCASE
       REPLACE F14 WITH sys_oper      
       REPLACE F99 WITH DTOC(DATE())+' '+IIF(SEEK(sys_oper,'A01'),A01.F03,'')       
    ELSE
       DO file_impact
       RETURN   
    ENDIF   
    THISFORM.SHRGROUP.ABANDON_BOTT.CLICK    
ENDPROC
*******************
  PROCEDURE ORPGROUP.DEL_BOTT.CLICK
     IF MESSAGEBOX('是否確定要刪除此筆資料',4+32+256,'請確認') = 6	      
        SELECT S22_1
        LOCK()
        IF RLOCK()        
           SELECT  S22_1
           PO_NO=S22_1.F02 
           SELECT S17
           SET ORDER TO S171   && F02
           SEEK PO_NO
           IF FOUND()
              SELECT S17
              DELETE 
              SELECT S22_1
	          DELETE 
	          UNLOCK
	          SKIP -1
	          IF BOF()
	             GO TOP
	          ENDIF                      
           ENDIF
           SELECT  A24
           SEEK 'S022 '+SUBSTR(DTOS(CTOD(HK+'/01')),3,4)+PO_NO
           IF !FOUND()
              APPEND BLANK
              RLOCK()
              REPLACE F01 WITH 'S022 '
              REPLACE F02 WITH SUBSTR(DTOS(CTOD(HK+'/01')),3,4)
              REPLACE F05 WITH 'SZ'+F02
              REPLACE F06 WITH '部門上下班變更作業'
              REPLACE F08 WITH PO_NO
              UNLOCK           
           ENDIF   
           THISFORM.GRID1.SETFOCUS
           THISFORM.SHRGROUP.ABANDON_BOTT.CLICK
        ELSE
           DO file_impact    
        ENDIF
     ENDIF        
  ENDPROC
*************   
  PROCEDURE SHRGROUP.ABANDON_BOTT.CLICK
      SELECT S22_1
      THISFORM.GRID2.COLUMN1.CONTROLSOURCE='S13.F04'
      THISFORM.GRID2.COLUMN2.CONTROLSOURCE='S13.F05'  
      THISFORM.GRID2.COLUMN3.CONTROLSOURCE="IIF(SEEK(S13.F04,'S05'),BILL_MODE(S05.F28),'')"  
      THISFORM.GRID2.COLUMN4.CONTROLSOURCE="IIF(SEEK(S13.F04,'S05'),IIF(SEEK('I' + S05.F29,'S00'),S05.F29 + SPACE(2) + S00.F50 + ' ∼ ' + S00.F51,''),'')"           
      THISFORM.SHRGROUP.ENABLED=.F.
      THISFORM.SHRGROUP.VISIBLE=.F.      
      THISFORM.ORPGROUP.ENABLED=.T.
      THISFORM.ORPGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
      THISFORM.CMDGROUP.ENABLED=.T.
      THISFORM.CMDGROUP.SETALL('ENABLED',.T.,'COMMANDBUTTON')
      THISFORM.CMDGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
      THISFORM.SETALL('READONLY',.T.,'TEXTBOX')   
      THISFORM.KEY_LIST.ENABLED=.T.     
      THISFORM.MTH_LIST.ENABLED=.T.  
      THISFORM.TXTF091.VISIBLE=.F.
      THISFORM.TXTF101.VISIBLE=.F.     
      THISFORM.OPTIONGROUP07.ENABLED=.F.   
      THISFORM.OPTIONGROUP11.ENABLED=.F.
      THISFORM.GRID1.ENABLED=.T. 
      THISFORM.GRID2.ENABLED=.T.
      THISFORM.GRID1.SETFOCUS   
      IF THISFORM.GRID1.ACTIVEROW=0
          THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
          THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
          THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
          THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.       
          THISFORM.CMDGROUP.ENABLED=.F.
          THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
          THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
          THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
          THISFORM.ANS_BOTT.ENABLED=.F.
          THISFORM.OLIST_BOTT.ENABLED=.F.
          THISFORM.TXTF01.VALUE=''
          THISFORM.TXTF02.VALUE=''
          THISFORM.TXTF05.VALUE=''
          THISFORM.TXTF06.VALUE=''     
          THISFORM.TXTF08.VALUE=''
          THISFORM.TXTF091.VALUE=''
          THISFORM.TXTF101.VALUE=''
          THISFORM.TXTF11.VALUE=''
          THISFORM.TXTF12.VALUE=''
          THISFORM.OPTIONGROUP07.VALUE=1
          THISFORM.OPTIONGROUP11.VALUE=1
          THISFORM.LBLF091.CAPTION=''
          THISFORM.LBLF101.CAPTION=''     
          THISFORM.LBLF131.CAPTION=''       
          THISFORM.LBLF991.CAPTION=''       
       ELSE
          THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
          THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
          THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
          THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.            
          THISFORM.CMDGROUP.ENABLED=.T.      
          THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  AND IIF(S22_1.F13<>'Y',.T.,.F.) &&判斷有無修改的權限
          THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)   AND IIF(S22_1.F13<>'Y',.T.,.F.) &&判斷有無刪除的權限
          THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限
          THISFORM.ANS_BOTT.ENABLED=IIF(A02.F08='*',.T.,.F.)  AND IIF(S22_1.F13<>'Y',.T.,.F.)   &&判斷有無確認的權限
          THISFORM.OLIST_BOTT.ENABLED=IIF(A02.F08='*',.T.,.F.)  AND IIF(S22_1.F13<>'Y',.T.,.F.)
       ENDIF     
       UNLOCK ALL  
  ENDPROC
  ********
  PROCEDURE SHRGROUP.FINISH_BOTT.CLICK 
       SELECT  A24         
       SEEK 'S022 '+SUBSTR(DTOS(CTOD(HK+'/01')),3,4)+PO_NO
       IF !FOUND()
           APPEND BLANK
           RLOCK()
           REPLACE F01 WITH 'S022 '
           REPLACE F02 WITH SUBSTR(DTOS(CTOD(HK+'/01')),3,4)
           REPLACE F05 WITH 'SZ'+F02
           REPLACE F06 WITH '部門上下班變更作業'
           REPLACE F08 WITH PO_NO
           UNLOCK  
       ENDIF    
       SELECT S22_1
       THISFORM.SHRGROUP.ABANDON_BOTT.CLICK
  ENDPROC    
  ***部門編號
  PROCEDURE TXTF05.DBLCLICK
      IF THIS.ReadOnly =.F.
          SELECT F01,F02 FROM A14 WHERE LEN(ALLTRIM(F01))=4 ORDER BY F01 INTO CURSOR DEPART          
          DEPART_SEEK=CREATEOBJECT("DEPART_SEEK")  
          DEPART_SEEK.SHOW    
          THIS.VALUE=FLG
          THIS.REFRESH
          FLG='0'
          THISFORM.TXTF06.VALUE=IIF(SEEK(THIS.VALUE,'A14'),A14.F02,'')  
      ENDIF 
  ENDPROC      
  PROCEDURE TXTF05.INTERACTIVECHANGE
    IF AT('?',ALLTRIM(THIS.VALUE))<>0
       IF AT('?',ALLTRIM(THIS.VALUE))>1             
          SELECT F01,F02 FROM A14 INTO CURSOR DEPART ORDER BY F01 WHERE LEFT(F01,AT('?',THIS.VALUE)-1)=LEFT(THIS.VALUE,AT('?',THIS.VALUE)-1) AND LEN(ALLTRIM(F01))=4
       ELSE
          SELECT F01,F02 FROM A14 INTO CURSOR DEPART ORDER BY F01 WHERE LEN(ALLTRIM(F01))=4
       ENDIF   
       DEPART_SEEK=CREATEOBJECT("DEPART_SEEK")  
       DEPART_SEEK.SHOW    
       THIS.VALUE=FLG
       THIS.REFRESH
       FLG='0'
    ENDIF   
       THISFORM.TXTF06.VALUE=IIF(SEEK(THIS.VALUE,'A14'),A14.F02,'')  
  ENDPROC        
******* 確認程序
  PROCEDURE ANS_BOTT.CLICK
    IF MESSAGEBOX('是否要確認此筆資料?',4+32+256,'請確認') = 6
       SELECT S22_1
       IF S22_1.F13 = 'Y'
          =MESSAGEBOX('此筆資料已確認過,請查明後再作確認!',0+64,'提示訊息視窗')
       ELSE
          LOCK()
          IF RLOCK()
	         SELECT S13.* FROM S13 WHERE S13.F01 = 'S22' AND S13.F02 = ALLTRIM(THISFORM.TXTF02.VALUE) ORDER BY S13.F04  INTO CURSOR S13_TEMP READWRITE
		     INDE ON F04 TAG S13_TEMP1
		     SELECT S13_TEMP
		     SET ORDER TO S13_TEMP1
		     GO TOP
		     IF _TALLY > 0
		        CREATE CURSOR S22_TEMP (F01 C(4),F02 C(8),F03 C(40))
		        INDE ON F01 TAG S22_TEMP1
	            S10='S10'+LEFT(DTOS(CTOD(HK+'/01')),6)
	            S101='S101'+LEFT(DTOS(CTOD(HK+'/01')),6)
	            IF FILE(S10+'.DBF') = .T.
	               IF !USED('&S10')
	                  SELECT  0
		              USE (S10) ALIA S10
	               ELSE
		              SELECT  S10
		           ENDIF
		           SET ORDER TO S101
		           SELECT S13_TEMP
		           GO TOP
		           DO WHILE !EOF()
				      SELECT S10	
				      SEEK S13_TEMP.F04
				      IF FOUND()
					     SELECT S22_TEMP
					     APPEND BLANK 	
					     REPLACE S22_TEMP.F01 WITH S13_TEMP.F04
					     REPLACE S22_TEMP.F02 WITH S13_TEMP.F05
					     IF S10.F98 =' Y'
					        REPLACE S22_TEMP.F03 WITH 'S10.薪資計算作業中已確認'
					     ELSE
					        REPLACE S22_TEMP.F03 WITH 'S10.薪資計算作業中已有資料'
					     ENDIF
				       ENDIF
				       SELECT S13_TEMP
				       SKIP
			       ENDDO
		           SELECT S10
		           USE
		        ENDIF
			    SELECT  S22_TEMP
			    GO TOP
			    DO WHILE !EOF()
			       SELECT S13_TEMP
			       SEEK S22_TEMP.F01
			       IF FOUND()
			          SELECT S13_TEMP
			          DELETE
			       ENDIF
			       SELECT S22_TEMP
			       SKIP
			    ENDDO
		        *****
		        S16='S16'+LEFT(DTOS(CTOD(HK+'/01')),6)
		        S161='S161'+LEFT(DTOS(CTOD(HK+'/01')),6)
	            IF FILE(S16+'.DBF')=.T.
	               IF !USED('&S16')	&&上下班紀錄檔
	                  SELECT 0
	                  USE (S16) ALIA S16
	               ELSE
	                  SELE S16
	               ENDIF
	               SET ORDER TO S161
	               SELECT S13_TEMP
	               SET ORDER TO S13_TEMP1
	               GO TOP
	               DO WHILE !EOF()
			          SELECT S16
			          SEEK S13_TEMP.F04
	                  IF FOUND() AND S16.F19 = 'Y'
					     SELECT S22_TEMP
					     APPEND BLANK
					     REPLACE S22_TEMP.F01 WITH S13_TEMP.F04
					     REPLACE S22_TEMP.F02 WITH S13_TEMP.F05
					     REPLACE S22_TEMP.F03 WITH 'S16.上下班紀錄作業中已確認'
			          ENDIF
			          SELECT S13_TEMP
			          SKIP
	               ENDDO
	            ENDIF
			    SELECT S22_TEMP
			    GO TOP
			    DO WHILE !EOF()
			       SELECT S13_TEMP
			       SEEK S22_TEMP.F01
			       IF FOUND()
			          SELECT S13_TEMP
			          DELETE
			       ENDIF
			       SELECT S22_TEMP
			       SKIP
			    ENDDO
			    *****
		        SELECT S05.* FROM S05,S13_TEMP WHERE S05.F01 = S13_TEMP.F04 AND S05.F05 = S13_TEMP.F03 ORDER BY S05.F05 INTO CURSOR S05_TEMP READWRITE
		        SELECT S13_TEMP
		        USE
		        SELECT S05_TEMP
		        GO TOP
		        DO WHILE !EOF()
				   S00_F63 = IIF(SEEK('Y','S00'),S00.F63,'F')		&&加班時間不滿時則以30分鐘計算
			       S00_F64 = IIF(SEEK('Y','S00'),S00.F64,'F')		&&加班時間若滿時則以60分鐘計算
		           S00_F65 = IIF(SEEK('Y','S00'),S00.F65,'2')		&&加班資料是否依S19加班申請(修改)作業為主(1:是 2:否)
				   ******
				   H = 'S017 ' + SUBSTR(DTOS(DATE()),3,4)
				   SELECT A24
				   SET ORDER TO 1
				   SEEK H
				   IF FOUND()
				      PO_NO = F08
				      RLOCK()
				      DELETE
				      UNLOCK
				   ELSE
				      SELECT A09
				      SEEK H
				      IF !FOUND()                                                  &&如果為本月第一張訂單則重頭開始編號
				         APPEND BLANK
				         REPLACE F01 WITH 'S017 '
					     REPLACE F02 WITH  SUBSTR(DTOS(DATE()),3,4)
					     REPLACE F05 WITH 'SA'+F02
					     REPLACE F06 WITH '上下班變更作業'
					     REPLACE F08 WITH ALLTRIM(F05)+'0000'
				      ENDIF
				      LOCK()
				      HX = VAL(RIGHT(F08,4)) + 1
				      PO_NO = LEFT(F08,6) + PADL(ALLTRIM(STR(HX)),4,'0')
				      REPLACE  F08 WITH PO_NO                                             &&記錄本訂單號碼,本月份後續的訂單號碼將以此往下編
				      UNLOCK
				   ENDIF
		           FOR I = 0 TO S22_1.F10 - S22_1.F09
		               D = VAL(RIGHT(DTOC(S22_1.F09),2)) + I
		               SELECT S16
		               SEEK S05_TEMP.F01 + PADL(ALLTRIM(STR(D)),2,'0')
		               IF FOUND() AND EMPTY(S16.F23)
						  DO CASE
							 CASE !EMPTY(S22_1.F11) AND !EMPTY(S22_1.F12)		&&變更上下班
							      REPLACE S16.F21 WITH S16.F11	&&變更前上班時間
								  REPLACE S16.F22 WITH S16.F12	&&變更前下班時間
					              REPLACE S16.F11 WITH S22_1.F11
				                  REPLACE S16.F12 WITH S22_1.F12
				             CASE !EMPTY(S22_1.F11) AND EMPTY(S22_1.F12)		&&變更上班
				                  REPLACE S16.F21 WITH S16.F11
				                  REPLACE S16.F11 WITH S22_1.F11
				             CASE EMPTY(S22_1.F11) AND !EMPTY(S22_1.F12)		&&變更下班
				                  REPLACE S16.F22 WITH S16.F12
				                  REPLACE S16.F12 WITH S22_1.F12
				          ENDCASE
				       	  REPLACE S16.F20 WITH PO_NO			&&S17.上下班修改補登作業單號
				       	  *****計算遲到、早退、加班時數
						  S00_F52 = ALLTRIM(IIF(INDEXSEEK(S16.F02,.T.,'S05','S051'),IIF(INDEXSEEK('I' + S05.F29,.T.,'S00','S005'),S00.F52,''),''))	&&班別:休息時段起
						  S00_F53 = ALLTRIM(IIF(INDEXSEEK(S16.F02,.T.,'S05','S051'),IIF(INDEXSEEK('I' + S05.F29,.T.,'S00','S005'),S00.F53,''),''))	&&班別:休息時段止
						  S00_F52_H = VAL(LEFT(ALLTRIM(S00_F52),2))		&&班別:休息時段起(時)
						  S00_F52_M = VAL(RIGHT(ALLTRIM(S00_F52),2))	&&班別:休息時段起(分)
						  S00_F53_H = VAL(LEFT(ALLTRIM(S00_F53),2))		&&班別:休息時段止(時)
						  S00_F53_M = VAL(RIGHT(ALLTRIM(S00_F53),2))	&&班別:休息時段止(分)
						  S16_F07_H = VAL(LEFT(ALLTRIM(S16.F07),2))		&&班別:下班時段(時)
						  S16_F07_M = VAL(RIGHT(ALLTRIM(S16.F07),2))   	&&班別:下班時段(分)
						  S16_F08_H = VAL(LEFT(ALLTRIM(S16.F08),2))		&&班別:上班遲到緩衝時間(時)
						  S16_F08_M = VAL(RIGHT(ALLTRIM(S16.F08),2))   	&&班別:上班遲到緩衝時間(分)
						  S16_F09_H = VAL(LEFT(ALLTRIM(S16.F09),2))		&&班別:下班早退緩衝時間(時)
						  S16_F09_M = VAL(RIGHT(ALLTRIM(S16.F09),2))   	&&班別:下班早退緩衝時間(分)
						  S16_F10_H = VAL(LEFT(ALLTRIM(S16.F10),2))		&&班別:加班上班緩衝時間(時)
						  S16_F10_M = VAL(RIGHT(ALLTRIM(S16.F10),2))   	&&班別:加班上班緩衝時間(分)
						  S16_F11_H = VAL(LEFT(ALLTRIM(S16.F11),2))		&&上班時間(時)
						  S16_F11_M = VAL(RIGHT(ALLTRIM(S16.F11),2))	&&上班時間(分)
						  S16_F12_H = VAL(LEFT(ALLTRIM(S16.F12),2))		&&下班時間(時)
						  S16_F12_M = VAL(RIGHT(ALLTRIM(S16.F12),2))	&&下班時間(分)
						  S16_F13_H = VAL(LEFT(ALLTRIM(S16.F13),2))		&&加班上班時間(時)
						  S16_F13_M = VAL(RIGHT(ALLTRIM(S16.F13),2))	&&加班上班時間(分)
						  S16_F14_H = VAL(LEFT(ALLTRIM(S16.F14),2)) + IIF(LEFT(ALLTRIM(S16.F14),2) = '00',24,0)	&&加班下班時間(時)
						  S16_F14_M = VAL(RIGHT(ALLTRIM(S16.F14),2))	&&加班下班時間(分)
						  *****計算遲到分鐘數
						  IF S16.F11 >= S16.F08 AND !EMPTY(S16.F11) AND !EMPTY(S16.F08)
						     DO CASE
						        CASE S16_F11_M >= S16_F08_M
						             REPLACE S16.F15 WITH ((S16_F11_H - S16_F08_H) * 60) + (S16_F11_M - S16_F08_M)
						        CASE S16_F12_M < S16_F08_M
						             REPLACE S16.F15 WITH ((S16_F11_H - S16_F08_H) * 60) - (S16_F08_M - S16_F11_M)
						     ENDCASE
						  ENDIF
						  **判斷是否有請假
						  IF !EMPTY(S16.F23) AND S16.F11 >= S16.F25 AND !EMPTY(S16.F11)
						     REPLACE S16.F15 WITH 0
						  ENDIF
						  **無上班時間則遲到為零
						  IF EMPTY(S16.F11)
						     REPLACE S16.F15 WITH 0
						  ENDIF
						  *****計算早退分鐘數
						  IF S16.F12 <= S16.F09 AND !EMPTY(S16.F12) AND !EMPTY(S16.F09)
						     DO CASE
						        CASE S16_F12_M <= S16_F09_M
						             REPLACE S16.F16 WITH ((S16_F09_H - S16_F12_H) * 60) + (S16_F09_M - S16_F12_M)
						        CASE S16_F12_M > S16_F09_M
						             REPLACE S16.F16 WITH ((S16_F09_H - S16_F12_H) * 60) - (S16_F12_M - S16_F09_M)
						     ENDCASE
						  ENDIF
						  **判斷是否有請假
						  IF !EMPTY(S16.F23) AND S16.F12 <= S16.F25 AND !EMPTY(S16.F12)
						     REPLACE S16.F16 WITH 0
						  ENDIF	
						  **無下班時間則早退為零
						  IF EMPTY(S16.F12)
						     REPLACE S16.F16 WITH 0
						  ENDIF
						  *****計算加班小時數
						  S16_F171 = 0
						  IF S16.F13 < S16.F14
						     IF S16.F18 = 7 OR S16.F18 = 1 OR IIF(INDEXSEEK(DTOS(CTOD(HK + '/' + S16.F01)),.F.,'S15','S151'),S15.F03 = '1',.F.)	&&假日加班
						        IF S16.F14 <= S16.F10
						  	 	   DO CASE
						          	  CASE S16_F13_M <= S16_F14_H
						                   S16_F171 = ((S16_F14_H - S16_F13_H) * 60) + (S16_F14_M - S16_F13_M)
						           	  CASE S16_F13_M > S16_F14_H
						                   S16_F171 = ((S16_F14_H - S16_F13_H) * 60) - (S16_F13_M - S16_F14_M)
						           ENDCASE
						        ELSE
						   		   DO CASE 
						         	  CASE S16_F13_M <= S16_F07_H
						                   S16_F171 = ((S16_F07_H - S16_F13_H) * 60) + (S16_F07_M - S16_F13_M)
						          	  CASE S16_F13_M > S16_F07_H
						                   S16_F171 = ((S16_F07_H - S16_F13_H) * 60) - (S16_F13_M - S16_F07_M)
						           ENDCASE
							       DO CASE 
							          CASE S16_F10_M <= S16_F14_H
							               S16_F171 = S16_F171 + ((S16_F14_H - S16_F10_H) * 60) + (S16_F14_M - S16_F10_M)
							          CASE S16_F10_M > S16_F14_H
							               S16_F171 = S16_F171 + ((S16_F14_H - S16_F10_H) * 60) - (S16_F10_M - S16_F14_M)
							       ENDCASE
						        ENDIF
						        IF S16.F13 < S00_F52 AND S16.F14 > S00_F53
						           S16_F171 = S16_F171 - ((S00_F53_H - S00_F52_H) * 60) + (S00_F53_M - S00_F52_M)
						        ENDIF
						     ELSE		&&一般上班之加班
						        DO CASE
						           CASE S16.F13 >= S16.F10
						                DO CASE 
						                   CASE S16_F13_M <= S16_F14_H
						                        S16_F171 = ((S16_F14_H - S16_F13_H) * 60) + (S16_F14_M - S16_F13_M)
						                   CASE S16_F13_M > S16_F14_H
						                     	S16_F171 = ((S16_F14_H - S16_F13_H) * 60) - (S16_F13_M - S16_F14_M)
						                ENDCASE
						           CASE S16.F13 < S16.F10
						                DO CASE
						                   CASE S16_F10_M <= S16_F14_H
						                        S16_F171 = ((S16_F14_H - S16_F10_H) * 60) + (S16_F14_M - S16_F10_M)
						                   CASE S16_F10_M > S16_F14_H
						                   	    S16_F171 = ((S16_F14_H - S16_F10_H) * 60) - (S16_F10_M - S16_F14_M)
						                ENDCASE
						       ENDCASE
						     ENDIF
						     *****判斷加班計算範圍
							 IF MOD(S16_F171,60) = 0
								REPLACE S16.F17 WITH ROUND(S16_F171 / 60,1)
							 ELSE
							 	DO CASE
						           CASE S00_F63 <> 'F' AND S00_F64 <> 'F'
						          		IF MOD(S16_F171,60) >= VAL(S00_F63) AND MOD(S16_F171,60) < VAL(S00_F64)
						              	   REPLACE S16.F17 WITH INT(S16_F171 / 60) + 0.5
							            ELSE
							               IF MOD(S16_F171,60) >= VAL(S00_F64) AND MOD(S16_F171,60) < 60
							            	  REPLACE S16.F17 WITH INT(S16_F171 / 60) + 1
							               ELSE
							             	  REPLACE S16.F17 WITH INT(S16_F171 / 60)
						               	   ENDIF
						            	ENDIF
							       CASE S00_F63 <> 'F' AND S00_F64 = 'F'
								        IF MOD(S16_F171,60) >= VAL(S00_F63) AND MOD(S16_F171,60) < 60
							               REPLACE S16.F17 WITH INT(S16_F171 / 60) + 0.5
							            ELSE
							               REPLACE S16.F17 WITH INT(S16_F171 / 60)
							            ENDIF
							       CASE S00_F63 = 'F' AND S00_F64 <> 'F'
							            IF MOD(S16_F171,60) >= VAL(S00_F64) AND MOD(S16_F171,60) < 60
							               REPLACE S16.F17 WITH INT(S16_F171 / 60) + 1
							            ELSE
							               REPLACE S16.F17 WITH INT(S16_F171 / 60)
							            ENDIF
							       CASE S00_F63 = 'F' AND S00_F64 = 'F'
							            REPLACE S16.F17 WITH ROUND(S16_F171 / 60,1)
							    ENDCASE
							 ENDIF  
				      	  ENDIF
						  ***判斷加班小時數是否為零
						  IF S16.F17 = 0
						     REPLACE S16.F13 WITH ''
						     REPLACE S16.F14 WITH ''
						  ENDIF
						  ***無加班上下班時間加班小時數也為零
						  IF EMPTY(S16.F13) AND EMPTY(S16.F14)
						     REPLACE S16.F17 WITH 0
						  ENDIF
					   ENDIF
				   ENDFOR
	               ***
	               SELECT S17
                   APPEND BLANK
                   REPLACE S17.F01 WITH S22_1.F01
                   REPLACE S17.F02 WITH PO_NO
                   REPLACE S17.F03 WITH S05_TEMP.F01
                   REPLACE S17.F04 WITH S05_TEMP.F02
                   REPLACE S17.F05 WITH S22_1.F05
                   REPLACE S17.F06 WITH S22_1.F06
                   REPLACE S17.F07 WITH S22_1.F07
                   REPLACE S17.F08 WITH S22_1.F08
                   REPLACE S17.F09 WITH S22_1.F09
                   REPLACE S17.F10 WITH S22_1.F10
                   REPLACE S17.F11 WITH S22_1.F11
                   REPLACE S17.F12 WITH S22_1.F12
				   REPLACE S17.F13 WITH 'Y'
			  	   REPLACE S17.F14 WITH sys_oper
				   REPLACE S17.F15 WITH S22_1.F02
				   REPLACE S17.F99 WITH DTOC(DATE())+' '+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
		           SELECT S05_TEMP
		           SKIP
			   ENDDO
		    ELSE
		       =MESSAGEBOX('S05.人事薪資基本檔中無此部門之人員,請查明後在確認!',0+64,'提示訊息視窗')
		       THISFORM.GRID1.SETFOCUS 
		       RETURN
		    ENDIF
		    ******
		    SELECT S16
		    USE 
		    SELECT S05_TEMP
		    USE
	        SELECT S17
	        SET ORDER TO S171
	        SEEK S22_1.F02
	        IF FOUND()
	           REPLACE S17.F13 WITH 'Y'
	           REPLACE S17.F99 WITH DTOC(DATE())+' '+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
	        ENDIF
	        SELECT S22_1
	        REPLACE S22_1.F13 WITH 'Y'
	        REPLACE S22_1.F99 WITH DTOC(DATE())+' '+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
	        SELECT S22_TEMP
	        SET ORDER TO S22_TEMP1
	        GO TOP
            IF RECCOUNT('S22_TEMP') > 0
               =MESSAGEBOX('此確認作業已成功,尚有人員未符合確認條件,請按確定後查看!',0+64,'提示視窗')
               NO_SEEK=CREATEOBJECT("NO_SEEK")  
               NO_SEEK.SHOW
            ELSE
               =MESSAGEBOX('此確認作業已成功,薪資計算部分請至S10.薪資計算作業中新增!',0+64,'提示視窗')
            ENDIF    
            SELECT S22_TEMP
            USE
            SELECT S22_1
	     ELSE
            DO file_impact
            UNLOCK ALL
            RETURN
	     ENDIF
	     UNLOCK ALL
         ENDIF
      ENDIF
      THISFORM.GRID1.SETFOCUS
  ENDPROC  
 ***********************修改作業人員
  PROC OLIST_BOTT.CLICK    
    SELECT 0,F01,F02,F28,F29 FROM S05 WHERE ALLTRIM(F05) = ALLTRIM(THISFORM.TXTF05.VALUE) ORDER BY F01 INTO CURSOR S05_TEMP READWRITE 
    INDE ON F01 TAG S05_TEMP1
    SELECT S05_TEMP
    SET ORDER TO S05_TEMP1
    SELECT F04 FROM S13 WHERE F02 =THISFORM.TXTF02.VALUE AND F01 = 'S22' ORDER BY F01 INTO CURSOR S13_TEMP
    SELECT S13_TEMP
    GO TOP
    DO WHILE !EOF()
       SELECT S05_TEMP
       SEEK S13_TEMP.F04
       IF FOUND()
          REPLACE S05_TEMP.EXP_1 WITH 1
       ENDIF
       SELECT S13_TEMP
       SKIP
    ENDDO
    SELECT S13_TEMP
    USE
    SELECT S05_TEMP
    GO TOP
    IF !EOF()
       OLIST_SEEK=CREATEOBJECT("OLIST_SEEK")  
       OLIST_SEEK.SHOW  
       IF CHK_IN=''  
          SELECT S05_TEMP
          GO TOP
          DO WHILE !EOF()
             SELECT S13
             SET ORDER TO S131   && F02+F01+F04
             SEEK THISFORM.TXTF02.VALUE + 'S22' + S05_TEMP.F01
             IF FOUND()
                IF S05_TEMP.EXP_1 = 0
                   SELECT S13
                   DELETE  
                ENDIF
             ELSE
                IF S05_TEMP.EXP_1 = 1
                   SELECT S13
                   APPEND BLANK
                   REPLACE S13.F01 WITH 'S22'
                   REPLACE S13.F02 WITH THISFORM.TXTF02.VALUE
                   REPLACE S13.F03 WITH THISFORM.TXTF05.VALUE
                   REPLACE S13.F04 WITH S05_TEMP.F01
                   REPLACE S13.F05 WITH S05_TEMP.F02
                ENDIF 
             ENDIF
             SELECT S05_TEMP
             SKIP
          ENDDO 
       ENDIF
    ELSE
       =MESSAGEBOX('查無此部門之員工!',0+64,'提示視窗') 
    ENDIF
    SELECT S05_TEMP
    USE
    SELECT S13
    GO TOP
    THISFORM.GRID2.SETFOCUS  
    THISFORM.GRID1.SETFOCUS       
  ENDPROC     
ENDDEFINE    
***********************************************列印程序
PROCEDURE PNT_PRC  
      
ENDPROC
*****變更方式
DEFINE CLASS OPTIONGROUP07 AS OPTIONGROUP
     VISIBLE=.T.
     HEIGHT=INT_015*25
     WIDTH=INT_015*150 
     BUTTONCOUNT=2
     VALUE=1
     ENABLED=.F.
     NAME='OPTIONGROUP07'
     OPTION1.CAPTION='修改'
     OPTION1.TOP=INT_015*5
     OPTION1.FONTSIZE=INT_015*9
     OPTION1.AUTOSIZE=.T.
     OPTION1.LEFT=INT_015*5
     OPTION1.NAME='OPTION1'
     OPTION2.CAPTION='補登'
     OPTION2.TOP=INT_015*5
     OPTION2.FONTSIZE=INT_015*9
     OPTION2.AUTOSIZE=.T.
     OPTION2.LEFT=INT_015*80
     OPTION2.NAME='OPTION2'     
   PROCEDURE INTERACTIVECHANGE  
       IF THIS.VALUE=2
       	   THISFORM.LBLF08.CAPTION='補登事由'
       	   THISFORM.LBLF09.CAPTION='補登日期                         至'
       	   THISFORM.LBLF11.CAPTION='補登上班時間'
       	   THISFORM.LBLF111.CAPTION='補登時段'
       	   THISFORM.LBLF12.CAPTION='補登下班時間'
       ELSE
       	   THISFORM.LBLF08.CAPTION='修改事由'
       	   THISFORM.LBLF09.CAPTION='修改日期                         至'
       	   THISFORM.LBLF11.CAPTION='修改上班時間'
       	   THISFORM.LBLF111.CAPTION='修改時段'
       	   THISFORM.LBLF12.CAPTION='修改下班時間'       
       ENDIF    
   ENDPROC       
ENDDEFINE
*****修改/補登時段
DEFINE CLASS OPTIONGROUP11 AS OPTIONGROUP
     VISIBLE=.T.
     HEIGHT=INT_015*25
     WIDTH=INT_015*250 
     BUTTONCOUNT=3
     VALUE=1
     ENABLED=.F.
     NAME='OPTIONGROUP11'
     OPTION1.CAPTION='上班時段'
     OPTION1.TOP=INT_015*5
     OPTION1.FONTSIZE=INT_015*9
     OPTION1.AUTOSIZE=.T.
     OPTION1.LEFT=INT_015*5
     OPTION1.NAME='OPTION1'
     OPTION2.CAPTION='下班時段'
     OPTION2.TOP=INT_015*5
     OPTION2.FONTSIZE=INT_015*9
     OPTION2.AUTOSIZE=.T.
     OPTION2.LEFT=INT_015*80
     OPTION2.NAME='OPTION2'     
     OPTION3.CAPTION='上下班時段'
     OPTION3.TOP=INT_015*5
     OPTION3.FONTSIZE=INT_015*9
     OPTION3.AUTOSIZE=.T.
     OPTION3.LEFT=INT_015*155
     OPTION3.NAME='OPTION3'          
   PROCEDURE INTERACTIVECHANGE  
       DO CASE
          CASE THIS.VALUE=1
               THISFORM.LBLF11.VISIBLE=.T.
               THISFORM.TXTF11.VISIBLE=.T.
               THISFORM.LBLF12.VISIBLE=.F.
               THISFORM.TXTF12.VISIBLE=.F.                
               THISFORM.TXTF11.READONLY=.F.
               THISFORM.TXTF12.READONLY=.T.
          CASE THIS.VALUE=2
               THISFORM.LBLF11.VISIBLE=.F.
               THISFORM.TXTF11.VISIBLE=.F.
               THISFORM.LBLF12.VISIBLE=.T.
               THISFORM.TXTF12.VISIBLE=.T.                 
               THISFORM.TXTF11.READONLY=.T.
               THISFORM.TXTF12.READONLY=.F.             
   	      CASE THIS.VALUE=3
               THISFORM.LBLF11.VISIBLE=.T.
               THISFORM.TXTF11.VISIBLE=.T.
               THISFORM.LBLF12.VISIBLE=.T.
               THISFORM.TXTF12.VISIBLE=.T.           	     
               THISFORM.TXTF11.READONLY=.F.
               THISFORM.TXTF12.READONLY=.F.       	     
       ENDCASE 
   ENDPROC       
ENDDEFINE
*************************************確認未符合條件之員工畫面
DEFINE CLASS NO_SEEK AS FORM
*!*	  AUTOCENTER=.T.
  CAPTION='無法確認之員工一欄表'
  TOP=INT_015*150
  LEFT=INT_015*200      
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*250
  WIDTH=INT_015*350
  MAXBUTTON=.F.
  MINBUTTON=.F.    
  CLOSABLE=.F.
  CONTROLBOX=.F.
  BORDERSTYLE=2
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WINDOWTYPE=1
  NAME='NO_SEEK'
  ADD OBJECT GRDD01 AS GRID WITH;          
      AUTOCENTER=.T.,;
      TOP=0,;
      WIDTH=INT_015*350,;      
      HEIGHT=INT_015*220,;      
      ROWHEIGHT=INT_015*18,;
      HEADERHEIGHT=INT_015*19,;
      ALLOWCELLSELECTION=.F.,;
      DELETEMARK=.F.,;
      READONLY=.T.,;
      RECORDSOURCETYPE=1,;
      COLUMNCOUNT=3,;            
      RECORDSOURCE='S22_TEMP',;      
      NAME='GRDD01',;
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;      
      COLUMN3.NAME='COLUMN3'  
  ADD OBJECT CMND1 AS COMMANDBUTTON WITH;
      AUTOSIZE=.T.,;
      LEFT=INT_015*75,;    
      HEIGHT=INT_015*25,;   
      TOP=INT_015*223,;        
      WIDTH=INT_015*80,;
      FONTSIZE=INT_015*9,;
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\HARROW.CUR',;        
      CAPTION='\<E.轉EXCEL',;
      TOOLTIPTEXT='選擇游標所指的紀錄!快速鍵->ALT+S'
      NAME='CMND1'
  ADD OBJECT CMND2 AS COMMANDBUTTON WITH;
      AUTOSIZE=.T.,;
      LEFT=INT_015*200,;
      TOP=INT_015*223,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*80,;
      FONTSIZE=INT_015*9,;     
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\HARROW.CUR',;         
      CAPTION='\<C.取   消',;
      TOOLTIPTEXT='取消此搜尋畫面!快速鍵->ALT+C'
      NAME='CMND2'
 PROCEDURE INIT 
         THISFORM.SETALL('MOVABLE',.F.,'COLUMN')
         THISFORM.GRDD01.SETALL('FONTSIZE',INT_015*9,'COLUMN') 
         THISFORM.GRDD01.SETALL('FONTSIZE',INT_015*9,'HEADER')          
         THISFORM.GRDD01.COLUMN1.HEADER1.CAPTION='員工編號'
         THISFORM.GRDD01.COLUMN1.WIDTH=INT_015*50
         THISFORM.GRDD01.COLUMN1.CONTROLSOURCE='S22_TEMP.F01'
         THISFORM.GRDD01.COLUMN2.HEADER1.CAPTION='員工姓名'
         THISFORM.GRDD01.COLUMN2.WIDTH=INT_015*50
         THISFORM.GRDD01.COLUMN2.CONTROLSOURCE='S22_TEMP.F02'
         THISFORM.GRDD01.COLUMN3.HEADER1.CAPTION='無法確認之原因'
         THISFORM.GRDD01.COLUMN3.WIDTH=INT_015*210
         THISFORM.GRDD01.COLUMN3.CONTROLSOURCE='S22_TEMP.F03'
         THISFORM.GRDD01.SETFOCUS
         IF THISFORM.GRDD01.ACTIVEROW<>0
            THISFORM.GRDD01.AFTERROWCOLCHANGE 
         ENDIF 
 ENDPROC
 PROCEDURE  GRDD01.AFTERROWCOLCHANGE
     LPARAMETERS NCOLINDEX
 ENDPROC 
 PROCEDURE CMND1.CLICK                               
	  FILE_NAME = 'S22 無法確認之員工清單'
	  GCDELIMFILE=PUTFILE('儲存路徑',FILE_NAME,'XLS')
	  IF EMPTY(GCDELIMFILE)  && ESC PRESSED
	     RETURN
	  ELSE
	     SELECT S22_TEMP
	     COPY TO (GCDELIMFILE) TYPE XL5   
	     =MESSAGEBOX('儲存成功',0+64,'提示訊息視窗')                           
	  ENDIF         
	  THISFORM.CMND2.SETFOCUS
 ENDPROC
 PROCEDURE CMND2.CLICK
      THISFORM.RELEASE
  ENDPROC      
ENDDEFINE  
****
DEFINE CLASS OLIST_SEEK AS FORM
  CAPTION='修改欲帶入此作業之員工 >> 部門：' + S22_1.F05 + SPACE(2) + S22_1.F06
  TOP=INT_015*150
  LEFT=INT_015*150      
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*230
  WIDTH=INT_015*450
  MAXBUTTON=.F.
  MINBUTTON=.F.  
  CLOSABLE=.F.
  CONTROLBOX=.F.
  BORDERSTYLE=2
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WINDOWTYPE=1
  NAME='OLIST_SEEK'
  ADD OBJECT GRDD01 AS GRID WITH;     
      AUTOCENTER=.T.,;
      HIGHLIGHTROWLINEWIDTH=4,;
      TOP=INT_015*3,;      
      WIDTH=INT_015*355,;      
      HEIGHT=INT_015*220,;      
      ROWHEIGHT=INT_015*18,;
      HEADERHEIGHT=INT_015*19,;
      DELETEMARK=.F.,;
      READONLY=.T.,;
      RECORDSOURCETYPE=1,;
      COLUMNCOUNT=5,;            
      RECORDSOURCE='S05_TEMP',;    
      NAME='GRDD01',;
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;  
      COLUMN3.NAME='COLUMN3',;
      COLUMN4.NAME='COLUMN4',;
      COLUMN5.NAME='COLUMN5'      
  ADD OBJECT CMND1 AS COMMANDBUTTON WITH;
      AUTOSIZE=.T.,;
      LEFT=INT_015*370,;    
      HEIGHT=INT_015*25,;   
      TOP=INT_015*120,;        
      WIDTH=INT_015*80,;    
      FONTSIZE=INT_015*9,;
      CAPTION='\<S.確定',;
      TOOLTIPTEXT='選擇游標所指的紀錄!快速鍵->ALT+S'
      NAME='CMND1'
  ADD OBJECT CMND2 AS COMMANDBUTTON WITH;
      AUTOSIZE=.T.,;
      LEFT=INT_015*370,;
      TOP=INT_015*170,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*80,;     
      FONTSIZE=INT_015*9,;      
      CAPTION='\<X.離開',;
      TOOLTIPTEXT='取消此搜尋畫面!快速鍵->ALT+X'
      NAME='CMND2'
  ADD OBJECT CMND3 AS COMMANDBUTTON WITH;
      AUTOSIZE=.T.,;
      LEFT=INT_015*370,;    
      HEIGHT=INT_015*25,;   
      TOP=INT_015*20,;        
      WIDTH=INT_015*80,;    
      FONTSIZE=INT_015*9,;
      CAPTION='\<A.全選',;
      TOOLTIPTEXT='全選所有資料!快速鍵->ALT+A'
      NAME='CMND3'
  ADD OBJECT CMND4 AS COMMANDBUTTON WITH;
      AUTOSIZE=.T.,;
      LEFT=INT_015*370,;    
      HEIGHT=INT_015*25,;   
      TOP=INT_015*70,;        
      WIDTH=INT_015*80,;  
      FONTSIZE=INT_015*9,;
      CAPTION='\<C.清除',;
      TOOLTIPTEXT='清除已全選之資料!快速鍵->ALT+C'
      NAME='CMND4'            
 PROCEDURE INIT 
         CHK_IN=''
         THISFORM.SETALL('HEIGHT',INT_015*25,'TEXTBOX')
         THISFORM.SETALL('HEIGHT',INT_015*17,'LABEL')
         THISFORM.SETALL('FONTSIZE',INT_015*9,'TEXTBOX')
         THISFORM.SETALL('FONTSIZE',INT_015*9,'LABEL')       
         THISFORM.SETALL('READONLY',.T.,'TEXTBOX')
         THISFORM.SETALL('MOUSEPOINTER',99,'COMMANDBUTTON')
         THISFORM.SETALL('MOUSEICON','BMPS\harrow.cur','COMMANDBUTTON')                
         THISFORM.GRDD01.SETALL('FONTSIZE',INT_015*9,'COLUMN') 
         THISFORM.GRDD01.SETALL('FONTSIZE',INT_015*9,'HEADER')
         THISFORM.SETALL('MOVABLE',.F.,'COLUMN')   
         THISFORM.GRDD01.SETALL("DYNAMICBACKCOLOR","IIF(S05_TEMP.EXP_1=1,RGB(255,255,128),'')","COLUMN") 
         THISFORM.GRDD01.COLUMN1.HEADER1.CAPTION=''
         THISFORM.GRDD01.COLUMN1.WIDTH=INT_015*20
         THISFORM.GRDD01.COLUMN1.CONTROLSOURCE='S05_TEMP.EXP_1'
         THISFORM.GRDD01.COLUMN2.HEADER1.CAPTION='員工編號'
         THISFORM.GRDD01.COLUMN2.WIDTH=INT_015*50
         THISFORM.GRDD01.COLUMN2.CONTROLSOURCE='S05_TEMP.F01'
         THISFORM.GRDD01.COLUMN3.HEADER1.CAPTION='員工姓名'
         THISFORM.GRDD01.COLUMN3.WIDTH=INT_015*80
         THISFORM.GRDD01.COLUMN3.CONTROLSOURCE='S05_TEMP.F02' 
         THISFORM.GRDD01.COLUMN4.HEADER1.CAPTION='任職狀況'
         THISFORM.GRDD01.COLUMN4.WIDTH=INT_015*55
         THISFORM.GRDD01.COLUMN4.CONTROLSOURCE="BILL_MODE(S05_TEMP.F28)"     
         THISFORM.GRDD01.COLUMN5.HEADER1.CAPTION='班別時段'
         THISFORM.GRDD01.COLUMN5.WIDTH=INT_015*120
         THISFORM.GRDD01.COLUMN5.CONTROLSOURCE="IIF(SEEK('I' + S05_TEMP.F29,'S00'),S05.F29 + SPACE(2) + S00.F50 + ' ∼ ' + S00.F51,'')"
         THISFORM.GRDD01.SETFOCUS                  
         SELECT S05_TEMP
         GO TOP
 ENDPROC 
 PROC GRDD01.INIT
	THISFORM.GRDD01.COLUMN1.READONLY=.F.
	THISFORM.GRDD01.COLUMN2.READONLY=.T.
	THISFORM.GRDD01.COLUMN3.READONLY=.T.
	THISFORM.GRDD01.COLUMN1.removeobject("TEXT1")
	THISFORM.GRDD01.COLUMN1.AddObject("CheckBox1","CheckBox1") 
	THISFORM.GRDD01.COLUMN1.CurrentControl="CheckBox1" 
	THISFORM.GRDD01.COLUMN1.Sparse=.F.
	THISFORM.GRDD01.COLUMN1.CheckBox1.Visible=.T.
	THISFORM.GRDD01.COLUMN1.CheckBox1.CAPTION=''
	THISFORM.GRDD01.COLUMN1.CheckBox1.AUTOSIZE=.T.
	THISFORM.GRDD01.COLUMN1.CheckBox1.CENTERED=.T.
	THISFORM.GRDD01.COLUMN1.CheckBox1.BACKSTYLE=0
	THISFORM.GRDD01.COLUMN1.CheckBox1.LEFT=5
  ENDPROC 
  PROC GRDD01.AFTERROWCOLCHANGE
       LPARAMETERS NCOLINDEX
   ENDPROC 
   **
 PROCEDURE CMND1.CLICK
     THISFORM.RELEASE
 ENDPROC
 PROCEDURE CMND2.CLICK
      CHK_IN='0'
      THISFORM.RELEASE
 ENDPROC  
 **
 PROCEDURE CMND3.CLICK     
      SELECT S05_TEMP
      RE=RECNO('S05_TEMP')
      REPLACE S05_TEMP.EXP_1 WITH 1  ALL 
      GO RE 
      THISFORM.GRDD01.SETFOCUS 
 ENDPROC      
  PROCEDURE CMND4.CLICK
      SELECT S05_TEMP
      RE=RECNO('S05_TEMP')
      REPLACE S05_TEMP.EXP_1 WITH 0  ALL 
      GO RE 
     THISFORM.GRDD01.SETFOCUS 
 ENDPROC 
ENDDEFINE 
****
DEFINE CLASS CheckBox1 AS CheckBox
      PROCEDURE CLICK
         SELECT S05_TEMP
         IF THIS.VALUE=1
            REPLACE S05_TEMP.EXP_1 WITH 1
         ELSE
            REPLACE S05_TEMP.EXP_1 WITH 0
         ENDIF
         THISFORM.GRDD01.SETFOCUS     
   ENDPROC 
ENDDEFINE 


