
AREA1='ANSPT2'

SELE ANSPT2
ANSPT2form=createobject("TKANSPT2")
ANSPT2form.show  
define class TKANSPT2 as form
  caption='資料分析'
  autocenter=.t.
  BORDERSTYLE=3  
  MAXBUTTON=.F.
  MINBUTTON=.F.
  MOVABLE=.F.
  CONTROLBOX=.F.
  controlcount=57
  fontsize=9
  height=550
  showtips=.t.
  showwindow=1
  width=789
  windowtype=1
  NAME='TKANSPT2'
  add object shape2 as shape2 with;
      autocenter=.t.,;
      WIDTH=780
  add object shape3 as shape3 with;  
      autocenter=.t.
  ADD OBJECT SHAPE1 AS SHAPE1 WITH;
      LEFT=590,;
      TOP=30,;
      WIDTH=190,;
      HEIGHT=415    
  ADD OBJECT LBLF011 AS LABEL WITH;
      LEFT=118,;
      TOP=10,;
      AUTOSIZE=.T.,;
      FONTUNDERLINE=.T.,;
      CAPTION='料品編號:'    
  ADD OBJECT LBLF01 AS LABEL WITH;
      LEFT=170,;
      TOP=10,;
      AUTOSIZE=.T.,;
      FORECOLOR=RGB(0,0,255)

   ADD OBJECT LBLF02 AS LABEL WITH;
      LEFT=320,;
      TOP=10,;
      AUTOSIZE=.T.,;
      FORECOLOR=RGB(0,0,255)
  ADD OBJECT LBLRNG AS LABEL WITH;
      LEFT=618,;
      TOP=10,;
      AUTOSIZE=.T.,;
      FONTUNDERLINE=.T.,;
      CAPTION='資料範圍:'    
  ADD OBJECT LBLDTE AS LABEL WITH;
      LEFT=669,;
      TOP=10,;
      AUTOSIZE=.T.     
  ADD OBJECT LBLTAVG AS LABEL WITH; 
      LEFT=125,;
      TOP=420,;
      AUTOSIZE=.T.,;
      HEIGHT=17,;
      CAPTION='各數據總合:'        
  ADD OBJECT TXTAVG1 AS TEXTBOX WITH; 
      READONLY=.T.,;
      LEFT=195,;
      TOP=415,;
      DISABLEDBACKCOLOR=RGB(128,255,255)
  ADD OBJECT TXTAVG2 AS TEXTBOX WITH; 
      LEFT=271,;
      TOP=415,;
      DISABLEDBACKCOLOR=RGB(128,255,255)
  ADD OBJECT TXTAVG3 AS TEXTBOX WITH; 
      LEFT=347,;
      TOP=415,;
      DISABLEDBACKCOLOR=RGB(128,255,255)


  ADD OBJECT LBLSAY2 AS LABEL WITH; 
      LEFT=595,;
      TOP=242,;
      FONTUNDERLINE=.T.,;
      AUTOSIZE=.T.                     
  ADD OBJECT LBLAVGXU AS LABEL WITH; 
      LEFT=595,;
      TOP=295,;
      AUTOSIZE=.T.
  ADD OBJECT LBLAVGXC AS LABEL WITH; 
      LEFT=595,;
      TOP=320,;
      AUTOSIZE=.T.
  ADD OBJECT LBLAVGXL AS LABEL WITH; 
      LEFT=595,;
      TOP=345,;
      AUTOSIZE=.T.
  ADD OBJECT TXTAVGXU AS TEXTBOX WITH; 
      LEFT=700,;
      TOP=292,;
      INPUTMASK='99999999.99',;
      DISABLEDBACKCOLOR=RGB(255,0,0)
  ADD OBJECT TXTAVGXC AS TEXTBOX WITH; 
      LEFT=700,;
      TOP=317,;
      INPUTMASK='99999999.99',;
      DISABLEDBACKCOLOR=RGB(255,255,128)
  ADD OBJECT TXTAVGXL AS TEXTBOX WITH; 
      LEFT=700,;
      TOP=342,;
      INPUTMASK='99999999.99',;
      DISABLEDBACKCOLOR=RGB(255,0,0)
  ADD OBJECT GRID1 AS GRID1 WITH;
      columncount=7,;            
      RECORDSOURCE='ANSPT2',;
      WIDTH=580,;  
      SCROLLBARS=2,;
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;
      COLUMN3.NAME='COLUMN3',;
      COLUMN4.NAME='COLUMN4',;
      COLUMN5.NAME='COLUMN5',;
      COLUMN6.NAME='COLUMN6',;
      COLUMN7.NAME='COLUMN7',;
      COLUMN6.backcolor=rgb(255,255,128)
   ADD OBJECT CMDGROUP AS CMDGROUP WITH;
      TOP=455,;
      LEFT=10,;
      ENABLED=.T.,;
      VISIBLE=.T.      
   ADD OBJECT DRW_BOTT AS COMMANDBUTTON WITH;
      TOP=490,;
      LEFT=99,;
      HEIGHT=25,;
      WIDTH=40,;
      CAPTION='\<L.做圖',;
      NAME='DRW_BOTT'                                  
   ADD OBJECT PNT_BOTT AS COMMANDBUTTON WITH;
      TOP=490,;
      LEFT=141,;
      HEIGHT=25,;
      WIDTH=40,;
      CAPTION='\<P.列印',;
      NAME='PNT_BOTT'                           
   ADD OBJECT OUT_BOTT AS COMMANDBUTTON WITH;
      TOP=490,;
      LEFT=183,;
      HEIGHT=25,;
      WIDTH=40,;
      CAPTION='\<X.離開',;
      NAME='OUT_BOTT'                                
  PROC INIT
       THISFORM.SETALL('READONLY',.T.,'TEXTBOX')
       THISFORM.SETALL('HEIGHT',25,'TEXTBOX')
       THISFORM.SETALL('WIDTH',75,'TEXTBOX')
       THISFORM.SETALL('HEIGHT',17,'LABEL')
       thisform.cmdgroup.seek_bott.enabled=.f.
       THISFORM.LBLF01.CAPTION=B01.F01
       THISFORM.LBLF02.CAPTION=B01.F02
       THISFORM.LBLDTE.CAPTION=LK
       THISFORM.LBLSAY2.CAPTION='抽驗不良率%管制界線'              
       THISFORM.LBLAVGXU.CAPTION='不良率管制上限:'
       THISFORM.LBLAVGXC.CAPTION='不良率管制中線:'
       THISFORM.LBLAVGXL.CAPTION='不良率管制下限:'
       THISFORM.TXTAVG1.VALUE=TMP('F04')
       THISFORM.TXTAVG2.VALUE=TMP('F05')
       THISFORM.TXTAVG3.VALUE=TMP('exp_6')       
       IF CHK_STR>0          
          FTR_STR=CHK_STR/100
       ELSE
          FTR_STR=TMP('F05')/TMP('F04')          
       ENDIF   
       THISFORM.TXTAVGXC.VALUE=FTR_STR*100
       THISFORM.TXTAVGXU.VALUE=(FTR_STR+3*SQRT((FTR_STR-FTR_STR^2)/RECCOUNT()))*100
       THISFORM.TXTAVGXL.VALUE=(FTR_STR-3*SQRT((FTR_STR-FTR_STR^2)/RECCOUNT()))*100
       thisform.grid1.column1.width=25
       THISFORM.GRID1.COLUMN2.WIDTH=70
       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='組別'       
	   THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='抽檢日期'
  	   THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='抽檢時間'
	   THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='抽檢數量'
	   THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='不良數量'
	   THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='不良率%'	   
  	   THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='備註說明'
  	   THISFORM.GRID1.COLUMN7.WIDTH=149
	   THISFORM.GRID1.COLUMN1.CONTROLSOURCE='RECNO()'
	   THISFORM.GRID1.COLUMN2.CONTROLSOURCE='ANSPT2.F02'
	   THISFORM.GRID1.COLUMN3.CONTROLSOURCE='ANSPT2.F03'	   	   
	   THISFORM.GRID1.COLUMN4.CONTROLSOURCE='ANSPT2.F04'
	   THISFORM.GRID1.COLUMN5.CONTROLSOURCE='ANSPT2.F05'	   	   	   
	   THISFORM.GRID1.COLUMN6.CONTROLSOURCE='ANSPT2.exp_6'	   	   	   
	   THISFORM.GRID1.COLUMN7.CONTROLSOURCE='ANSPT2.F07'	   	   	   	     	      
       THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(exp_6>THISFORM.TXTAVGXU.VALUE .OR. exp_6<THISFORM.TXTAVGXL.VALUE,RGB(255,0,0),'')","COLUMN")  	      
       THISFORM.GRID1.READONLY=.T.       
       THISFORM.GRID1.SETFOCUS
       THISFORM.REFRESH
  ENDPROC     


  PROC GRID1.AFTERROWCOLCHANGE
       LPARAMETERS nColIndex
       FCH=THISFORM.ACTIVECONTROL.NAME
       thisform.refresh
  ENDPROC
  PROCEDURE DRW_BOTT.CLICK
     R2=RECNO()
     DO Q0D
     GO R2
     THISFORM.GRID1.SETFOCUS      
  ENDPROC
  PROCEDURE PNT_BOTT.CLICK  
     REPORT FORM ANSPT2 PREVIEW 
     THISFORM.GRID1.SETFOCUS      
  ENDPROC    
      
  PROCEDURE OUT_BOTT.CLICK
     CLEAR
     AREA1='B01'
     THISFORM.RELEASE
  ENDPROC          
ENDDEFINE  
******************自定函數--各數據總合
FUNCTION TMP
PARAMETERS maverage
   K=maverage
   SELECT SUM(&K) INTO ARRAY TMP1 FROM ANSPT2 
  return tmp1(1) 


  