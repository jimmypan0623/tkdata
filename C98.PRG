***程式名稱:C98.營業預估表
CLOSE ALL
CLEAR 
FLG='0'
FCH=''
CHK=''
CHK_STR=''
R=0
QTY=0
TQTY=0
AREA1='C01_1'
AREA2='C98'
IF !USED('A01')
   SELE 0
   USE A01 INDE A01
ELSE
   SELE A01
ENDIF
SET ORDER TO A01
SEEK sys_oper
IF FOUND()
sys_name=A01.F03
ENDIF
IF !USED('A02')
   SELE 0
   USE A02 INDE A02
ELSE
   SELE A02
ENDIF
SET ORDER TO A021      
SEEK sys_oper+'C98'
IF !USED('A23')
    SELE 0
    USE A23
ELSE 
   SELE A23
ENDIF
SET ORDER TO A231          

C10='C10'+LEFT(DTOS(DATE()),6)   &&出貨日報表檔
C102='C102'+LEFT(DTOS(DATE()),6)   &&出貨日報表檔
IF !USED('&C10')
   SELE 0
   USE (C10) ALIA C10
ELSE
   SELE C10
ENDIF
SET ORDER TO C102          
B04='B04'+LEFT(DTOS(DATE()),6)   &&出貨單檔
IF !USED('&B04')
   SELE 0
   USE (B04) ALIA B04
ELSE
   SELE B04
ENDIF
SET FILTER TO EMPTY(F10)
SET ORDER TO 1             
B05='B05'+LEFT(DTOS(DATE()),6)   &&出貨退回單檔
IF !USED('&B05')
   SELE 0
   USE (B05) ALIA B05
ELSE
   SELE B05
ENDIF
SET FILTER TO EMPTY(F12)
SET ORDER TO 1             
IF !USED('C98')         
   SELE 0
   USE C98
ELSE
   SELE C98
ENDIF
SET ORDER TO C981      
IF !USED('C01')         
   SELE 0
   USE C01
ELSE
   SELE C01
ENDIF

SET ORDER TO C019
CREATE CURSOR C01_1; 
(F01 C(5),F04 C(40),F05 C(8),F33 C(8),FOT N(14,2),FTT N(14,2),FIT N(14,2))
INDE ON F01 TAG C01_11
INDE ON F05 TAG C01_12
SELECT C01.F44 FROM C01 GROUP BY C01.F44 INTO CURSOR C01_TEMP NOWAIT
               
               
SELECT C01
SET ORDER TO 1
SELECT C01_TEMP 
GO TOP
DO WHILE !EOF()
   SELECT  C01_1
   APPEND BLANK
   REPLACE  C01_1.F01 WITH C01_TEMP.F44
   REPLACE  C01_1.F04 WITH IIF(SEEK(F01,'C01'),C01.F04,'')
   REPLACE  C01_1.F05 WITH IIF(SEEK(F01,'C01'),C01.F05,'')
   REPLACE  C01_1.F33 WITH IIF(SEEK(IIF(SEEK(F01,'C01'),C01.F33,''),'A01'),A01.F03,'')
   
 
   SELECT  C01_TEMP
   SKIP   
ENDDO
SELECT  C01_TEMP
USE 

SELECT C01_1
SET ORDER TO C01_11
GO TOP
DO WHILE !EOF()
   SELECT C01
   SEEK C01_1.F01
   IF FOUND()
      DO WHILE C01.F44=C01_1.F01
         SELECT C10
         SEEK C01.F01
         IF FOUND()
            DO WHILE C10.F02=C01.F01
               SELECT C01_1
               REPLACE FOT WITH FOT+C10.F07*C10.F08 
               SELECT C10
               SKIP
            ENDDO
         ENDIF
        
         SELECT C01
         SKIP
      ENDDO
   ENDIF
   SELECT C01_1
   SKIP
ENDDO
SELECT C01
SET ORDER TO C011
SELECT B04
GO TOP
DO WHILE !EOF()
   SELECT C01
   SEEK B04.F06
   IF FOUND()
      SELECT C01_1
      SEEK C01.F44
      IF FOUND()
         REPLACE FTT WITH FTT+B04.F17
      ENDIF
   ENDIF
   SELECT B04
   SKIP
ENDDO
SELECT B05
GO TOP
DO WHILE !EOF()
   SELECT C01
   SEEK B05.F10
   IF FOUND()
      SELECT C01_1
      SEEK C01.F44
      IF FOUND()
         REPLACE FIT WITH FIT+B05.F04*B05.F17*B05.F18
      ENDIF
   ENDIF
   SELECT B05
   SKIP
ENDDO
SELECT B05
USE
SELECT B04
USE
SELECT C10
USE
SELECT C01
SET ORDER TO C019
SELECT C01_1
*SET RELATION TO F01 INTO C01
C98FORM=CREATEOBJECT("TKC98")
C98FORM.SHOW  
DEFINE CLASS TKC98 AS FORM
  CAPTION='C98.營業預估表'
*!*	  AUTOCENTER=.T.
  CONTROLBOX=.F.
  BORDERSTYLE=1  
  MAXBUTTON=.F.
  MINBUTTON=.F.
  MOVABLE=.F.
  CLOSABLE=.F.
  CONTROLCOUNT=57
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*550
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WIDTH=INT_015*789
  WINDOWTYPE=1
  NAME='TKC98'
  ADD OBJECT SHAPE1 AS SHAPE1 WITH;
      AUTOCENTER=.T.
  ADD OBJECT LBL_REC AS LBL_REC WITH;
      AUTOCENTER =.T.
  ADD OBJECT REC_COUNT AS REC_COUNT  WITH;
      CAPTION=STR(RECCOUNT())        
  ADD OBJECT SHAPE2 AS SHAPE2 WITH;
      AUTOCENTER=.T.
  ADD OBJECT SHAPE3 AS SHAPE3 WITH;
      AUTOCENTER=.T.
  ADD OBJECT PAGEFRAME1 AS PAGEFRAME WITH;
      LEFT=INT_015*236,;
      WIDTH=INT_015*540,;
      HEIGHT=INT_015*200,;
      FONTSIZE=INT_015*9,;
      PAGECOUNT=2,;
      TABSTRETCH=1,;
      ACTIVEPAGE=1,;
      VISIBLE=.T.,;
      PAGE1.NAME='PAGE1',;
      PAGE1.VISIBLE=.T.,;
      PAGE1.CAPTION='表頭資料',;
      PAGE2.NAME='PAGE2',;
      PAGE2.VISIBLE=.T.,;
      PAGE2.CAPTION='表身詳細資料內容'   
  ADD OBJECT KEY_LIST AS KEY_LIST WITH;
      AUTOCENTER=.T.
  ADD OBJECT GRID1 AS GRID1 WITH;
      COLUMNCOUNT=3,;            
      RECORDSOURCE='C01_1',;      
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;      
      COLUMN3.NAME='COLUMN3'
  ADD OBJECT GRID2 AS GRID2 WITH;
      COLUMNCOUNT=3,;            
      RECORDSOURCE='C98',; 
      LINKMASTER='C01_1',;
      RELATIONALEXPR='F01',;
      CHILDORDER='C981',;  
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;
      COLUMN3.NAME='COLUMN3'
  ADD OBJECT CMDGROUP AS CMDGROUP WITH;
      AUTOSIZE=.T.              
  ADD OBJECT ORPGROUP AS ORPGROUP WITH;    
      AUTOSIZE=.T.              
  ADD OBJECT SHRGROUP AS SHRGROUP WITH;
      TOP=INT_015*165,;
      LEFT=INT_015*558         
  ADD OBJECT COMPARE_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*490,;
      LEFT=INT_015*15,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*88,;      
      FONTSIZE=INT_015*9,;
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\HAND.CUR',;
      CAPTION='\<T.營業預估比較',;
      NAME='COMPARE_BOTT'               
***************              
  PROCEDURE PAGEFRAME1.PAGE1.INIT     
     THIS.ADDOBJECT('LBLF01','LABEL')
     WITH THIS.LBLF01
          .VISIBLE=.T.
          .LEFT=INT_015*14
          .TOP=INT_015*13
          .WIDTH=INT_015*50
          .CAPTION='客戶編號'          
     ENDWITH
     THIS.ADDOBJECT('TXTF01','TEXTBOX')          
     WITH THIS.TXTF01
          .VISIBLE=.T.
          .LEFT=INT_015*64
          .TOP=INT_015*9
          .WIDTH=INT_015*60
          .HEIGHT=INT_015*25
          .MAXLENGTH=5
     ENDWITH       
     THIS.ADDOBJECT('LBLF04','LABEL')     
     WITH THIS.LBLF04
          .VISIBLE=.T.
          .LEFT=INT_015*14
          .TOP=INT_015*38
          .WIDTH=INT_015*50  
          .CAPTION='客戶名稱'
     ENDWITH                   
     THIS.ADDOBJECT('LBLF041','LABEL')     
     WITH THIS.LBLF041
          .VISIBLE=.T.
          .LEFT=INT_015*65
          .TOP=INT_015*38
          .AUTOSIZE=.T.
     ENDWITH                 
     THIS.ADDOBJECT('LBLF33','LABEL')
     WITH THIS.LBLF33
         .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*63
         .WIDTH=INT_015*50
         .CAPTION='負責業務'
     ENDWITH                                     
     THIS.ADDOBJECT('TXTF33','TEXTBOX')          
     WITH THIS.TXTF33
          .VISIBLE=.T.
          .LEFT=INT_015*64
          .TOP=INT_015*59
          .WIDTH=INT_015*60
          .HEIGHT=INT_015*25
          .MAXLENGTH=8
     ENDWITH       
     THIS.ADDOBJECT('LBLFOT','LABEL')
     WITH THIS.LBLFOT
         .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*95
         .WIDTH=INT_015*50
         .CAPTION='本月已出'
     ENDWITH   
     THIS.ADDOBJECT('LBLFOT1','LABEL')
     WITH THIS.LBLFOT1
         .VISIBLE=.T.
         .LEFT=INT_015*64
         .TOP=INT_015*95
         .AUTOSIZE=.T.
         .CAPTION='0'
     ENDWITH                
     THIS.ADDOBJECT('LBLFTT','LABEL')
     WITH THIS.LBLFTT
         .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*120
         .WIDTH=INT_015*50
         .CAPTION='開單未出'
     ENDWITH   
     THIS.ADDOBJECT('LBLFTT1','LABEL')
     WITH THIS.LBLFTT1
         .VISIBLE=.T.
         .LEFT=INT_015*64
         .TOP=INT_015*120
         .AUTOSIZE=.T.
         .CAPTION='0'
     ENDWITH                     
     THIS.ADDOBJECT('LBLFIT','LABEL')
     WITH THIS.LBLFIT
         .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*145
         .WIDTH=INT_015*50
         .CAPTION='開單未退'
     ENDWITH   
     THIS.ADDOBJECT('LBLFIT1','LABEL')
     WITH THIS.LBLFIT1
         .VISIBLE=.T.
         .LEFT=INT_015*64
         .TOP=INT_015*145
         .AUTOSIZE=.T.
         .CAPTION='0'
     ENDWITH                     
  ENDPROC   
***********  
  PROCEDURE PAGEFRAME1.PAGE2.INIT
   THIS.ADDOBJECT('LBLF02','LABEL')
	WITH THIS.LBLF02  
	   .VISIBLE=.T.
           .LEFT=INT_015*14
           .TOP=INT_015*13
	   .WIDTH=INT_015*50
           .CAPTION='預估年月'
        ENDWITH    
   THIS.ADDOBJECT('TXTF02','TEXTBOX')
	WITH THIS.TXTF02      
	  .VISIBLE=.T.
	  .LEFT=INT_015*65
	  .TOP=INT_015*9
	  .WIDTH=INT_015*60
	  .HEIGHT=INT_015*25
	  .MAXLENGTH=7
	  .INPUTMASK='9999/99'
	  .NAME='TXTF02'  
	ENDWITH     	
    THIS.ADDOBJECT('LBLF03','LABEL')
    WITH THIS.LBLF03
         .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*38
         .WIDTH=INT_015*50
         .CAPTION='預估金額'         
    ENDWITH     
    THIS.ADDOBJECT('TXTF03','TEXTBOX')
	WITH THIS.TXTF03
	     .VISIBLE=.T.
	     .LEFT=INT_015*65
	     .TOP=INT_015*34
	     .WIDTH=INT_015*75
	     .HEIGHT=INT_015*25
	     .MAXLENGTH=10
	     .NAME='TXTF03'	    
    ENDWITH     
    THIS.ADDOBJECT('LBLF04','LABEL')
    WITH THIS.LBLF04
         .VISIBLE=.T.
         .LEFT=INT_015*200
         .TOP=INT_015*13
         .WIDTH=INT_015*50
         .CAPTION='備       註'         
    ENDWITH     
 
    THIS.ADDOBJECT('EDITF04','EDITBOX')
	WITH THIS.EDITF04
	     .VISIBLE=.T.
	     .LEFT=INT_015*250
	     .TOP=INT_015*9
	     .WIDTH=INT_015*200
	     .HEIGHT=INT_015*120
	     .NAME='EDITF04'	    
    ENDWITH       
    THIS.ADDOBJECT('LBLF05','LABEL')
    WITH THIS.LBLF05
        .VISIBLE=.T.           
        .LEFT=INT_015*14
        .TOP=INT_015*140
        .WIDTH=INT_015*50
        .CAPTION='安全資料'         
    ENDWITH    
    THIS.ADDOBJECT('LBLF051','LABEL')
    WITH THIS.LBLF051
        .VISIBLE=.T.           
        .LEFT=INT_015*65
        .TOP=INT_015*140
        .AUTOSIZE=.T.
    ENDWITH    
  ENDPROC       
  ***********
  PROC INIT   
       THISFORM.PAGEFRAME1.PAGE1.FONTSIZE=INT_015*9
       THISFORM.PAGEFRAME1.PAGE2.FONTSIZE=INT_015*9      
       THISFORM.SETALL('HEIGHT',INT_015*25,'TEXTBOX')
       THISFORM.SETALL('HEIGHT',INT_015*17,'LABEL')     
       THISFORM.SETALL('FONTSIZE',INT_015*9,'TEXTBOX')
       THISFORM.SETALL('FONTSIZE',INT_015*9,'LABEL')         
       THISFORM.SETALL('READONLY',.T.,'TEXTBOX')
       THISFORM.SETALL('READONLY',.T.,'EDITBOX')
       THISFORM.SHRGROUP.VISIBLE=.F.
       THISFORM.SHRGROUP.ENABLED=.F.
       THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
       THISFORM.ORPGROUP.PNT_BOTT.VISIBLE=.F.
       THISFORM.GRID1.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)
       THISFORM.GRID2.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'COLUMN')
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'HEADER')         
       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='客戶編號'
       THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='客戶簡稱'
       THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='負責業務'
       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='C01_1.F01'
       THISFORM.GRID1.COLUMN2.CONTROLSOURCE='C01_1.F05'
       THISFORM.GRID1.COLUMN3.CONTROLSOURCE='C01_1.F33'
       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*50
       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*60
       THISFORM.GRID1.COLUMN3.WIDTH=INT_015*60
              
       THISFORM.GRID2.SETALL('FONTSIZE',INT_015*9,'COLUMN')
       THISFORM.GRID2.SETALL('FONTSIZE',INT_015*9,'HEADER')       
       THISFORM.GRID2.COLUMN1.HEADER1.CAPTION='預估年月'       
       THISFORM.GRID2.COLUMN2.HEADER1.CAPTION='預估金額'
       THISFORM.GRID2.COLUMN3.HEADER1.CAPTION='安全資料'
       THISFORM.GRID2.LINKMASTER='C98'
       THISFORM.GRID2.RELATIONALEXPR='F01'
       THISFORM.GRID2.COLUMN1.CONTROLSOURCE="IIF(INT_012=1,LEFT(PADL(DTCX(C98.F02),10,'0'),7),LEFT(DTOS(C98.F02),4)+'/'+SUBSTR(DTOS(C98.F02),5,2))"
       THISFORM.GRID2.COLUMN2.CONTROLSOURCE='C98.F03'
       THISFORM.GRID2.COLUMN3.CONTROLSOURCE='C98.F05'
       THISFORM.GRID2.COLUMN1.WIDTH=INT_015*60
       THISFORM.GRID2.COLUMN2.WIDTH=INT_015*80
       THISFORM.GRID2.COLUMN3.WIDTH=INT_015*100
       THISFORM.GRID1.READONLY=.T.      
       THISFORM.GRID2.READONLY=.T.            
       THISFORM.GRID1.SETFOCUS
       IF THISFORM.GRID1.ACTIVEROW=0
          THISFORM.CMDGROUP.ENABLED=.F.
          THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
          THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.         
          THISFORM.COMPARE_BOTT.ENABLED=.F.
       ELSE
          THISFORM.CMDGROUP.ENABLED=.T.      

          THISFORM.COMPARE_BOTT.ENABLED=IIF(A02.F09='*',.T.,.F.) .AND. !THISFORM.SHRGROUP.ENABLED
       ENDIF          
       JK='客戶編號'
       SELECT C01_1
       THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=C01_1.F01
  ENDPROC        
****************  
  PROCEDURE PAGEFRAME1.PAGE1.ACTIVATE
     R=0
     SELE C01        
     IF THISFORM.SHRGROUP.VISIBLE=.F.
             
        THISFORM.GRID1.ENABLED=.T.   
        THISFORM.GRID1.SETFOCUS 
        THISFORM.KEY_LIST.ENABLED=.T.
     ELSE
       THISFORM.KEY_LIST.ENABLED=.F.   
     ENDIF              
    IF THISFORM.GRID1.ACTIVEROW=0 .AND. THISFORM.SHRGROUP.ENABLED=.F.
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
        
        THISFORM.COMPARE_BOTT.ENABLED=.F.
        THISFORM.PAGEFRAME1.PAGE1.SETALL('VALUE','','TEXTBOX')        
        THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=' '
        THISFORM.PAGEFRAME1.PAGE1.TXTF33.VALUE=' '      
        THISFORM.PAGEFRAME1.PAGE1.LBLF041.CAPTION=' '  
        
        THISFORM.PAGEFRAME1.PAGE2.ENABLED=.F.      
     ELSE
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.
        THISFORM.COMPARE_BOTT.ENABLED=IIF(A02.F09='*',.T.,.F.) .AND. !THISFORM.SHRGROUP.ENABLED
        THISFORM.PAGEFRAME1.PAGE2.ENABLED=.T.
     ENDIF  
        THISFORM.ORPGROUP.NEW_BOTT.ENABLED=.F.
        THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
        THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.     
  ENDPROC
 *********** 
  PROCEDURE PAGEFRAME1.PAGE2.ACTIVATE
       SELE C98
     IF THISFORM.SHRGROUP.ENABLED=.F.
        THISFORM.GRID2.READONLY=.T.   
        THISFORM.GRID2.SETFOCUS   
     ENDIF
     IF THISFORM.GRID2.ACTIVEROW=0 .AND. THISFORM.SHRGROUP.ENABLED=.F.
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
        THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
        THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
        THISFORM.PAGEFRAME1.PAGE2.SETALL('VALUE','','TEXTBOX')
        THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE=' '
        THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=' '
        THISFORM.PAGEFRAME1.PAGE2.EDITF04.VALUE=' '
        THISFORM.PAGEFRAME1.PAGE2.LBLF051.CAPTION=' '
     ELSE
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.
        THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)   &&判斷有無修改的權限
        THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)   &&判斷有無刪除的權限
        THISFORM.COMPARE_BOTT.ENABLED=IIF(A02.F09='*',.T.,.F.) .AND. !THISFORM.SHRGROUP.ENABLED
     ENDIF   
     R=RECNO('&AREA1')
     THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(RECNO('&AREA1')=R,RGB(255,255,0),'')","COLUMN")
     THISFORM.GRID1.ENABLED=.F.     
     THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.)  &&判斷有無新增的權限
     THISFORM.KEY_LIST.ENABLED=.F.     
  ENDPROC  
********            
  PROC KEY_LIST.INIT 
       WITH THIS 
           .ADDITEM('依客戶編號排列')
           .ADDITEM('依客戶簡稱排列')
           .VALUE=1
       ENDWITH             
  ENDPROC 
 ********* 
 PROC KEY_LIST.INTERACTIVECHANGE                 
       SELE C01_1
       DO CASE
          CASE THIS.DISPLAYVALUE='依客戶編號排列'
               SET ORDER TO C01_11
	       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='客戶編號'
	       THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='客戶簡稱'
	       THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='負責業務'
	       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='C01_1.F01'
	       THISFORM.GRID1.COLUMN2.CONTROLSOURCE='C01_1.F05'
	       THISFORM.GRID1.COLUMN3.CONTROLSOURCE='C01_1.F33'
	       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*50
	       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*60
	       THISFORM.GRID1.COLUMN3.WIDTH=INT_015*60
          CASE THIS.DISPLAYVALUE='依客戶簡稱排列'
               SET ORDER TO C01_12
	       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='客戶簡稱'               
	       THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='客戶編號'
	       THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='負責業務'
	       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='C01_1.F05'	       
	       THISFORM.GRID1.COLUMN2.CONTROLSOURCE='C01_1.F01'
	       THISFORM.GRID1.COLUMN3.CONTROLSOURCE='C01_1.F33'
	       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*60	       
	       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*50
	       THISFORM.GRID1.COLUMN3.WIDTH=INT_015*60                                                                
       ENDCASE 
        THISFORM.GRID1.SETFOCUS
  ENDPROC      
******   
  PROC GRID1.AFTERROWCOLCHANGE
       LPARAMETERS NCOLINDEX
       THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=C01_1.F01
       THISFORM.PAGEFRAME1.PAGE1.TXTF33.VALUE=C01_1.F33
       
       THISFORM.PAGEFRAME1.PAGE1.LBLF041.CAPTION=C01_1.F04   
       THISFORM.PAGEFRAME1.PAGE1.LBLFOT1.CAPTION=TRANSFORM(C01_1.FOT,'@R 999,999,999,999.00')
       THISFORM.PAGEFRAME1.PAGE1.LBLFTT1.CAPTION=TRANSFORM(C01_1.FTT,'@R 999,999,999,999.00')
       THISFORM.PAGEFRAME1.PAGE1.LBLFIT1.CAPTION=TRANSFORM(C01_1.FIT,'@R 999,999,999,999.00')
             
       FCH=THISFORM.ACTIVECONTROL.NAME
       JK=THIS.COLUMN1.HEADER1.CAPTION  
       IF THIS.ACTIVEROW=0
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
       ELSE
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.
       ENDIF   
       CHK=''     
*       THISFORM.REFRESH
  ENDPROC     
  *********
  PROC GRID2.AFTERROWCOLCHANGE
       LPARAMETERS NCOLINDEX
       THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE=IIF(INT_012=1,LEFT(PADL(DTCX(C98.F02),10,'0'),7),LEFT(DTOS(C98.F02),4)+'/'+SUBSTR(DTOS(C98.F02),5,2))
       THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=C98.F03
       THISFORM.PAGEFRAME1.PAGE2.EDITF04.VALUE=C98.F04    
       THISFORM.PAGEFRAME1.PAGE2.LBLF051.CAPTION=C98.F05
       FCH=THISFORM.ACTIVECONTROL.NAME
       JK=THIS.COLUMN1.HEADER1.CAPTION
       CHK=THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
       IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
       ENDIF   
*       THISFORM.REFRESH
  ENDPROC 
  ****
  PROCEDURE ORPGROUP.NEW_BOTT.CLICK    
    THISFORM.PAGEFRAME1.PAGE1.ENABLED=.F.   
    THISFORM.COMPARE_BOTT.ENABLED=.F.    
    THISFORM.KEY_LIST.ENABLED=.F. 
    THISFORM.GRID1.ENABLED=.F.   
    THISFORM.GRID2.ENABLED=.F.               
    THISFORM.PAGEFRAME1.PAGE2.SETALL('READONLY',.F.,'TEXTBOX')
    THISFORM.PAGEFRAME1.PAGE2.SETALL('READONLY',.F.,'EDITBOX')       
    THISFORM.PAGEFRAME1.PAGE2.TXTF03.READONLY=.F.
    THISFORM.PAGEFRAME1.PAGE2.TXTF02.SETFOCUS
    
    THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE=IIF(INT_012=1,PADL(LEFT(DTCX(DATE()),6),7,'0'),TRANSFORM(LEFT(DTOS(DATE()),6),'@R ####/##'))
    THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=0                
    THISFORM.PAGEFRAME1.PAGE2.EDITF04.VALUE=' ' 
    THISFORM.PAGEFRAME1.PAGE2.LBLF051.CAPTION=' '     
  ENDPROC               
*****
  PROCEDURE SHRGROUP.SHURE1_BOTT.CLICK               &&新增確認
       IF EMPTY(CTOD(THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE+'/01'))
           =MESSAGEBOX('預估年月格式不正確,請重新輸入!',0+48,'提示訊息視窗')          
           THISFORM.PAGEFRAME1.PAGE2.TXTF02.SETFOCUS
           RETURN
       ENDIF         
       IF IIF(SEEK(DTOS(CTOD(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE+'/01'))),'A23'),A23.F07=.T.,.F.)
           =MESSAGEBOX('此預估年月已做庫存結轉,故不得預估此年月,請重新輸入!',0+48,'提示訊息視窗')          
           THISFORM.PAGEFRAME1.PAGE2.TXTF02.SETFOCUS
           RETURN       
       ENDIF
       IF SEEK(THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE+DTOS(CTOD(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE+'/01'))),'C98')=.T.
           =MESSAGEBOX('此預估年月已存在,請重新輸入!',0+48,'提示訊息視窗')          
           THISFORM.PAGEFRAME1.PAGE2.TXTF02.SETFOCUS
           RETURN
       ENDIF           
*!*	       IF EMPTY(THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE)
*!*	           =MESSAGEBOX('預估金額不得空白!',0+48,'提示訊息視窗')          
*!*	           THISFORM.PAGEFRAME1.PAGE2.TXTF03.SETFOCUS
*!*	           RETURN
*!*	       ENDIF        
       SELE C98
       APPEND BLANK
       LOCK()
       IF RLOCK()
          REPLACE F01 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
          REPLACE F02 WITH CTOD(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE)+'/01')
          REPLACE F03 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE
          REPLACE F04 WITH THISFORM.PAGEFRAME1.PAGE2.EDITF04.VALUE
          REPLACE F05 WITH DTCX(DATE())+IIF(SEEK(SYS_OPER,'A01'),A01.F03,'')
       ENDIF

       UNLOCK ALL         
       
       THISFORM.GRID2.ENABLED=.T.
       THISFORM.GRID2.SETFOCUS  
       THISFORM.ORPGROUP.NEW_BOTT.CLICK      
  ENDPROC
******
  PROCEDURE ORPGROUP.EDIT_BOTT.CLICK
     IF IIF(SEEK(DTOS(CTOD(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE+'/01'))),'A23'),A23.F07=.T.,.F.)
           =MESSAGEBOX('此預估年月已做庫存結轉,故不得修改!',0+48,'提示訊息視窗')          
           RETURN    
           THISFORM.SHRGROUP.ABANDON_BOTT.CLICK 
     ELSE           
          THISFORM.PAGEFRAME1.PAGE1.ENABLED=.F.   
          THISFORM.KEY_LIST.ENABLED=.F. 
	  THISFORM.COMPARE_BOTT.ENABLED=.F.	  
	  THISFORM.GRID1.ENABLED=.F.   
	  THISFORM.GRID2.ENABLED=.F.                        
	  SELECT  C98                                                     
	  IF RLOCK('C98') 
	      THISFORM.PAGEFRAME1.PAGE2.TXTF02.READONLY=.T.
	      THISFORM.PAGEFRAME1.PAGE2.TXTF03.READONLY=.F.
	      THISFORM.PAGEFRAME1.PAGE2.EDITF04.READONLY=.F.
	      THISFORM.PAGEFRAME1.PAGE2.TXTF03.SETFOCUS
	  ELSE  
	      DO FILE_IMPACT 
	      UNLOCK ALL
	      THISFORM.SHRGROUP.ABANDON_BOTT.CLICK                 
	 ENDIF   
     ENDIF
  ENDPROC    
*******  
  PROCEDURE SHRGROUP.SHURE2_BOTT.CLICK                          &&修改確認   	         
*!*	       IF EMPTY(THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE)
*!*	           =MESSAGEBOX('預估金額不得空白!',0+48,'提示訊息視窗')          
*!*	           THISFORM.PAGEFRAME1.PAGE2.TXTF03.SETFOCUS
*!*	           RETURN
*!*	       ENDIF        
       SELE C98
       REPLACE F03 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE
       REPLACE F04 WITH THISFORM.PAGEFRAME1.PAGE2.EDITF04.VALUE
       REPLACE F05 WITH DTCX(DATE())+IIF(SEEK(SYS_OPER,'A01'),A01.F03,'')             
       UNLOCK ALL
       THISFORM.SHRGROUP.ABANDON_BOTT.CLICK    
  ENDPROC   
*********
  PROC ORPGROUP.DEL_BOTT.CLICK                    &&刪除資料程序
     IF IIF(SEEK(DTOS(CTOD(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE+'/01'))),'A23'),A23.F07=.T.,.F.)
           =MESSAGEBOX('此預估年月已做庫存結轉,故不得刪除!',0+48,'提示訊息視窗')          
           RETURN    
     ELSE           
           IF MESSAGEBOX('是否確定要刪除此筆資料',4+32+256,'請確認')=6	

               SELECT  C98                                                 
               IF RLOCK('C98')                            
                  SELECT  C98
                  DELE
                  SKIP -1
                  IF BOF()
                     GO TOP
                  ENDIF   
               ELSE
                 DO FILE_IMPACT                  
               ENDIF     
              THISFORM.GRID2.SETFOCUS
            ENDIF
            UNLOCK ALL
       ENDIF
       THISFORM.SHRGROUP.ABANDON_BOTT.CLICK
  ENDPROC  
*******
  PROCEDURE SHRGROUP.ABANDON_BOTT.CLICK
      THISFORM.SHRGROUP.ENABLED=.F.
      THISFORM.SHRGROUP.VISIBLE=.F.      
      THISFORM.ORPGROUP.ENABLED=.T.
      THISFORM.ORPGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
      THISFORM.CMDGROUP.ENABLED=.T.
      THISFORM.CMDGROUP.SETALL('ENABLED',.T.,'COMMANDBUTTON')
      THISFORM.CMDGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
      THISFORM.SETALL('READONLY',.T.,'TEXTBOX')  
      THISFORM.SETALL('READONLY',.T.,'EDITBOX')
      THISFORM.PAGEFRAME1.PAGE1.SETALL('READONLY',.T.,'TEXTBOX')  
      THISFORM.PAGEFRAME1.PAGE2.SETALL('READONLY',.T.,'TEXTBOX')  
      THISFORM.PAGEFRAME1.PAGE1.ENABLED=.T.
      THISFORM.PAGEFRAME1.PAGE2.ENABLED=.T.
      UNLOCK ALL
      SELECT C98
      THISFORM.GRID1.ENABLED=.F.
      THISFORM.GRID2.ENABLED=.T.
      THISFORM.GRID2.SETFOCUS
      IF THISFORM.GRID2.ACTIVEROW<>0
           THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)   &&判斷有無修改的權限
           THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)   &&判斷有無刪除的權限
      ELSE
            THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
            THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
            THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE=' '
            THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=' '
            THISFORM.PAGEFRAME1.PAGE2.EDITF04.VALUE=' '
            THISFORM.PAGEFRAME1.PAGE2.LBLF051.CAPTION=' ' 
      ENDIF
      THISFORM.COMPARE_BOTT.ENABLED=IIF(A02.F09='*',.T.,.F.) .AND. !THISFORM.SHRGROUP.ENABLED             
  ENDPROC
  ********
  PROCEDURE SHRGROUP.FINISH_BOTT.CLICK
       SELE C98
       THISFORM.SHRGROUP.ABANDON_BOTT.CLICK
  ENDPROC     
 ******* 
  PROC COMPARE_BOTT.CLICK     &&出貨金額比較
        SELECT C98
     	COMPARE_CHK=CREATEOBJECT("COMPARE_CHK")  
   	COMPARE_CHK.SHOW
  ENDPROC
ENDDEFINE    
********************************************************
DEFINE CLASS COMPARE_CHK AS FORM
  AUTOCENTER=.T.
  CAPTION='請輸入列印條件'+IIF(INT_012=1,'(民國年)','(西元年)')
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*140
  WIDTH=INT_015*320
  CONTROLBOX=.F.
  BORDERSTYLE=1
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WINDOWTYPE=1
  NAME='COMPARE_CHK'
  ADD OBJECT LBLF01 AS LABEL WITH;
      LEFT=INT_015*80,;
      TOP=INT_015*25,;
      WIDTH=INT_015*50,;
      CAPTION='預估年月'
  ADD OBJECT TXTF01 AS TEXTBOX WITH;
      LEFT=INT_015*155,;
      TOP=INT_015*20,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*70,;    
      NAME='TXTF01'      
  ADD OBJECT OUTTYPE_OPTION AS OPTIONGROUP WITH;
      LEFT=INT_015*70,;
      TOP=INT_015*55,;
      HEIGHT=INT_015*25,;    
      WIDTH=INT_015*185,;      
      BUTTONCOUNT=2,;
      OPTION1.CAPTION='列印報表',;
      OPTION1.FONTSIZE=INT_015*9,;
      OPTION1.LEFT=INT_015*4,;
      OPTION1.TOP=INT_015*3,;
      OPTION1.AUTOSIZE=.T.,;
      OPTION2.CAPTION='轉EXCEL',;
      OPTION2.FONTSIZE=INT_015*9,;
      OPTION2.LEFT=INT_015*100,;
      OPTION2.TOP=INT_015*3,;
      OPTION2.AUTOSIZE=.T.,;      
      NAME='OUTTYPE_OPTION'                
  ADD OBJECT CMND1 AS COMMANDBUTTON WITH;
      LEFT=INT_015*65,;
      TOP=INT_015*100,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*50,;
      FONTSIZE=INT_015*10,;
      CAPTION='\<Y.確認',;
      TOOLTIPTEXT='確認所輸入之內容->ALT+Y',;
      NAME='CMND1'
 ADD OBJECT CMND2 AS COMMANDBUTTON WITH;
      LEFT=INT_015*200,;
      TOP=INT_015*100,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*50,;
      FONTSIZE=INT_015*10,; 
      CAPTION='\<C.取消',;
      TOOLTIPTEXT='取消此畫面!快速鍵->ALT+C'
      NAME='CMND2'
********************
 PROCEDURE INIT 
         THISFORM.SETALL('FONTSIZE',INT_015*10,'LABEL')
         THISFORM.SETALL('FONTSIZE',INT_015*10,'TEXTBOX')
         THISFORM.SETALL('FONTSIZE',INT_015*10,'COMMANDBUTTON')
         THISFORM.SETALL('MOUSEPOINTER',99,'COMMANDBUTTON')
         THISFORM.SETALL('MOUSEICON','BMPS\HARROW.CUR','COMMANDBUTTON')     
         THISFORM.TXTF01.VALUE=IIF(INT_012=1,PADL(LEFT(DTCX(DATE()),6),7,'0'),TRANSFORM(LEFT(DTOS(DATE()),6),'@R ####/##'))
         THISFORM.TXTF01.SETFOCUS
 ENDPROC      
********    
 PROC CMND1.MOUSEENTER      
       LPARAMETERS nButton, nShift, nXCoord, nYCoord 
             THISFORM.CMND1.FORECOLOR=RGB(255,0,0)
             THISFORM.CMND1.TOP=INT_015*101
             THISFORM.CMND1.LEFT=INT_015*66
  ENDPROC     
  PROC CMND1.MOUSELEAVE      
        LPARAMETERS nButton, nShift, nXCoord, nYCoord 
             THISFORM.CMND1.FORECOLOR=RGB(0,0,0)  
             THISFORM.CMND1.TOP=INT_015*100
             THISFORM.CMND1.LEFT=INT_015*65               
  ENDPROC 
 PROC CMND2.MOUSEENTER      
       LPARAMETERS nButton, nShift, nXCoord, nYCoord 
             THISFORM.CMND2.FORECOLOR=RGB(255,0,0)
             THISFORM.CMND2.TOP=INT_015*101
             THISFORM.CMND2.LEFT=INT_015*201
  ENDPROC     
  PROC CMND2.MOUSELEAVE      
        LPARAMETERS nButton, nShift, nXCoord, nYCoord 
             THISFORM.CMND2.FORECOLOR=RGB(0,0,0)  
             THISFORM.CMND2.TOP=INT_015*100
             THISFORM.CMND2.LEFT=INT_015*200                
  ENDPROC    
  *****    
 PROCEDURE CMND1.CLICK   
     IF EMPTY(CTOD(THISFORM.TXTF01.VALUE+'/01'))
        =MESSAGEBOX('輸入月份格式錯誤',0+48,'提示訊息視窗')
        THISFORM.TXTF01.SETFOCUS
        RETURN
     ENDIF
     CREATE CURSOR CIH (客戶編號 C(5),客戶名稱 C(8),擔當業務 C(8),業務預估 N(14,2),已出金額 N(14,2),開單未出 N(14,2),開單未退 N(14,2),預計可出 N(14,2),尚未確認 N(14,2),合計預估 N(14,2))
     INDE ON 客戶編號 TAG CIH1
     SET ORDER TO 1
     IF !USED('C00')
        SELECT 0
        USE C00
     ELSE
       SELECT C00
     ENDIF  
     SET ORDER TO 1      
     IF !USED('C04')
        SELECT 0
        USE C04
     ELSE
        SELECT C04
     ENDIF
     SET ORDER TO 1    
     
     IF !USED('C05')
         SELECT 0
          USE C05
     ELSE
         SELECT C05
     ENDIF
     SET ORDER TO C053      
     SET FILTER TO F15='1' AND F04-F05>0
     SELECT C01
     SET ORDER TO 1
     GO TOP
     DO WHILE !EOF()         
         SELECT C05
         SEEK C01.F01
         IF FOUND() 
            DO WHILE C05.F06=C01.F01
               IF  (MONTH(CTOD(THISFORM.TXTF01.VALUE+'/01'))=MONTH(C05.F03) AND EMPTY(C05.F10)) OR (MONTH(CTOD(THISFORM.TXTF01.VALUE+'/01'))=MONTH(C05.F10))  &&如果希望交期或確認交期都在範圍內
                  SELECT CIH
                  SEEK C01.F44
                  IF !FOUND()
                      APPEND BLANK
                      REPLACE 客戶編號 WITH C01.F44
                      REPLACE 客戶名稱 WITH C01.F05
                      REPLACE 擔當業務 WITH IIF(SEEK(C01.F33,'A01'),A01.F03,'')
                  ENDIF
                  IF MONTH(CTOD(THISFORM.TXTF01.VALUE+'/01'))=MONTH(C05.F10)
                      REPLACE 預計可出 WITH 預計可出+(C05.F04-C05.F05)*IIF(SEEK(C05.F01+C05.F02,'C04'),C04.F07,0)*IIF(SEEK(C04.F06,'C00'),C00.F02,1) 
                  ELSE   
                  
                    
                     
                     REPLACE 尚未確認 WITH 尚未確認+(C05.F04-C05.F05)*IIF(SEEK(C05.F01+C05.F02,'C04'),C04.F07,0)*IIF(SEEK(C04.F06,'C00'),C00.F02,1) 
                     
                     
                 ENDIF
                  
               ENDIF
               SELECT C05
               SKIP
            ENDDO
         ENDIF
         
         SELECT C01
         SKIP
     ENDDO
     
     IF SEEK(DTOS(CTOD(THISFORM.TXTF01.VALUE+'/01')),'A23')
        C10='C10'+LEFT(DTOS(CTOD(THISFORM.TXTF01.VALUE+'/01')),6)   &&出貨日報表檔
        C102='C102'+LEFT(DTOS(CTOD(THISFORM.TXTF01.VALUE+'/01')),6)   &&出貨日報表檔
        IF !USED('&C10')
           SELE 0
           USE (C10) ALIA C10
        ELSE
           SELE C10
        ENDIF
        SET ORDER TO C102          
        SELECT C01
        GO TOP
        DO WHILE !EOF()
           SELECT C10
           SEEK C01.F01
           IF FOUND()
              DO WHILE F02=C01.F01
                 SELECT CIH
                 SEEK C01.F44
                 IF !FOUND()
                     APPEND BLANK
                     REPLACE 客戶編號 WITH C01.F44
                     REPLACE 客戶名稱 WITH C01.F05
                     REPLACE 擔當業務 WITH IIF(SEEK(C01.F33,'A01'),A01.F03,'')
                ENDIF
                REPLACE 已出金額 WITH 已出金額+C10.F07*C10.F08
                SELECT C10
                SKIP
              ENDDO   
           ENDIF
           SELECT C01
           SKIP
        ENDDO
        B04='B04'+LEFT(DTOS(CTOD(THISFORM.TXTF01.VALUE+'/01')),6)   &&出貨單檔
        IF !USED('&B04')
           SELE 0
           USE (B04) ALIA B04
        ELSE
           SELE B04
        ENDIF
        SET FILTER TO EMPTY(F10)
        SET ORDER TO 1             
        GO TOP
        DO WHILE !EOF()
           SELECT C01
           SEEK B04.F06
           IF FOUND()
              SELECT CIH
              SEEK C01.F44
              IF !FOUND()
                 APPEND BLANK
                 REPLACE 客戶編號 WITH C01.F44
                 REPLACE 客戶名稱 WITH C01.F05
                 REPLACE 擔當業務 WITH IIF(SEEK(C01.F33,'A01'),A01.F03,'')
              ENDIF
              REPLACE 開單未出 WITH 開單未出+B04.F17
           ENDIF
           SELECT B04
           SKIP
        ENDDO
        B05='B05'+LEFT(DTOS(CTOD(THISFORM.TXTF01.VALUE+'/01')),6)   &&出貨退回單檔
        IF !USED('&B05')
           SELE 0
           USE (B05) ALIA B05
        ELSE
           SELE B05
        ENDIF
        SET FILTER TO EMPTY(F12)
        SET ORDER TO 1             
        GO TOP
        DO WHILE !EOF()
           SELECT C01
           SEEK B05.F10
           IF FOUND()
              SELECT CIH
              SEEK C01.F44
              IF !FOUND()
                 APPEND BLANK
                 REPLACE 客戶編號 WITH C01.F44
                 REPLACE 客戶名稱 WITH C01.F05
                 REPLACE 擔當業務 WITH IIF(SEEK(C01.F33,'A01'),A01.F03,'')
              ENDIF
              REPLACE 開單未退 WITH 開單未退+B05.F04*B05.F17*B05.F18      
           ENDIF
           SELECT B05
           SKIP
        ENDDO
        ********************

        SELECT B05
        USE
        SELECT B04
        USE
        SELECT C10
        USE
     ENDIF
     SELECT C00
     USE
     SELECT C04
     USE
     SELECT C98
     GO TOP
     DO WHILE !EOF()
        IF DTOS(F02)=DTOS(CTOD(THISFORM.TXTF01.VALUE+'/01'))
           SELECT CIH
           SEEK C98.F01
           IF !FOUND()
              APPEND BLANK
              REPLACE 客戶編號 WITH C98.F01
              REPLACE 客戶名稱 WITH IIF(SEEK(C98.F01,'C01'),C01.F05,'')
              REPLACE 擔當業務 WITH IIF(SEEK(C01.F33,'A01'),A01.F03,'')
           ENDIF
           REPLACE 業務預估 WITH 業務預估+C98.F03
        ENDIF
        SELECT C98
        SKIP
     ENDDO
     
     SELECT CIH
     GO TOP
     DO WHILE !EOF()
        REPLACE 合計預估 WITH MAX(業務預估,已出金額+開單未出-開單未退+預計可出+尚未確認)
        SELECT CIH
        SKIP
     ENDDO
     FILE_NAME=LEFT(DTOS(CTOD(THISFORM.TXTF01.VALUE+'/01')),6)+'銷售預估比較表'
     IF THISFORM.OUTTYPE_OPTION.VALUE=1
        REPORT FORM ALLTRIM(INT_116)+'C98' TO PRINT PROMPT PREVIEW  
     ELSE
         
         GCDELIMFILE=PUTFILE('儲存路徑',FILE_NAME,'XLS')
               COPY TO (GCDELIMFILE) TYPE XL5   
	            =MESSAGEBOX('儲存成功',0+48,'提示訊息視窗')
           
     ENDIF       
     SELECT CIH
     USE
     THISFORM.CMND2.CLICK            
 ENDPROC
 ***** 
  PROCEDURE CMND2.CLICK
      THISFORM.RELEASE
  ENDPROC      
ENDDEFINE    
***********************************************列印程序
PROCEDURE PNT_PRC  
  
ENDPROC
*****
********************************************************
