close all
clear 
FLG='0'
FCH=''
AREA1='A01'
CHK=''
sys_name=''
IF !USED('A02')
   SELE 0
   USE A02 INDE A02
ELSE 
   SELE A02
ENDIF
SET ORDER TO A021      
SEEK sys_oper+'A02'   
IF !USED('A14')
   SELE 0
   USE A14 INDE A14
ELSE 
   SELE A14
ENDIF
SET ORDER TO A141      
SET FILTER TO LEN(ALLTRIM(F01))=4
IF !USED('S05')
   SELE 0
   USE S05 
ELSE
   SELE S05
ENDIF
SET ORDER TO S051 
IF !USED('S50')
   SELE 0
   USE S50 
ELSE
   SELE S50
ENDIF
SET ORDER TO S501 
IF !USED('A01')
   SELE 0
   USE A01 INDE A01
ELSE
   SELE A01
ENDIF
SET ORDER TO A01  
SEEK sys_oper
IF FOUND()
    sys_name=A01.F03
ENDIF
IF A02.F08<>'*'
    SET FILTER TO A01.F01=sys_oper
ENDIF    
SET RELA TO F04 INTO A14
A01FORM=CREATEOBJECT("TKA01")
A01FORM.SHOW  
DEFINE CLASS TKA01 AS FORM
  CAPTION='A02.操作人員資料管理'
*!*	  AUTOCENTER=.T.
  CONTROLBOX=.F.
  BORDERSTYLE=1 
  MAXBUTTON=.F.
  MINBUTTON=.F.
  MOVABLE=.F.
  CLOSABLE=.F.
  CONTROLCOUNT=57
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*550
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WIDTH=INT_015*789
  WINDOWTYPE=1
  NAME='TKA01'
  ADD OBJECT SHAPE1 AS SHAPE1 WITH;
      AUTOCENTER=.T.
  ADD OBJECT SHAPE2 AS SHAPE2 WITH;
      AUTOCENTER=.T.
  ADD OBJECT SHAPE3 AS SHAPE3 WITH;
      AUTOCENTER=.T.
  ADD OBJECT LBL_REC AS LBL_REC WITH;
      AUTOCENTER =.T.
  ADD OBJECT REC_COUNT AS REC_COUNT  WITH;
      CAPTION=STR(RECCOUNT())      
  ADD OBJECT IMAGE1 AS IMAGE WITH;
      STRETCH=2,;
      LEFT=INT_015*244,;    
      TOP=INT_015*225,;
      WIDTH=INT_015*525,;  
      HEIGHT=INT_015*285         
  ADD OBJECT LBLF01 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*27,;
      WIDTH=INT_015*50,;
      CAPTION='個人編號'
  ADD OBJECT LBLF12 AS LABEL WITH;
      LEFT=INT_015*390,;
      TOP=INT_015*27,;
      WIDTH=INT_015*80,;
      CAPTION='S05.員工編號'      
  ADD OBJECT LBLF02 AS LABEL WITH;      
      LEFT=INT_015*244,;
      TOP=INT_015*52,;
      WIDTH=INT_015*50,;
      CAPTION='密        碼'
  ADD OBJECT LBLF03 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*77,;
      WIDTH=INT_015*50,;
      CAPTION='姓        名'            
  ADD OBJECT LBLF04 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*102,;
      WIDTH=INT_015*50,;
      CAPTION='部門編號'
  ADD OBJECT LBLF041 AS LABEL WITH;
      LEFT=INT_015*350,;
      TOP=INT_015*102,;
      AUTOSIZE=.T.    
  ADD OBJECT LBLF07 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*127,;
      WIDTH=INT_015*50,;
      CAPTION='聯絡電話'
  ADD OBJECT LBLF08 AS LABEL WITH;
      LEFT=INT_015*418,;
      TOP=INT_015*127,;
      WITH=INT_015*50,;
      CAPTION='行動電話'
  ADD OBJECT LBLF09 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*152,;
      WIDTH=INT_015*50,;
      CAPTION='聯絡地址'
  ADD OBJECT LBLF10 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*177,;
      WITH=INT_015*50,;
      CAPTION='E-MAIL'          
  ADD OBJECT LBLF05 AS LABEL WITH;
      LEFT=INT_015*244,;
      TOP=INT_015*202,;
      WIDTH=INT_015*50,;
      CAPTION='作業畫面'
  ADD OBJECT LBLF06 AS LABEL WITH;
      LEFT=INT_015*400,;
      TOP=INT_015*202,;
      WIDTH=INT_015*100,;
      CAPTION='是否接收系統郵件'          
  ADD OBJECT LBLF11 AS LABEL WITH;
      LEFT=INT_015*125,;
      TOP=INT_015*495,;
      AUTOSIZE=.T.,;
      CAPTION='資料背景顏色'                    
  ADD OBJECT LBLF99 AS LABEL WITH;
      LEFT=INT_015*600,;
      TOP=INT_015*177,;
      WIDTH=INT_015*50,;
      CAPTION='安全資料'               
  ADD OBJECT LBLF991 AS LABEL WITH;
      LEFT=INT_015*655,;
      TOP=INT_015*177,;
      AUTOSIZE=.T.,;
      CAPTION=''            
  ADD OBJECT TXTF01 AS TEXTBOX WITH;      
      LEFT=INT_015*295,;
      TOP=INT_015*23,;
      WIDTH=INT_015*49,;
      MAXLENGTH=5,;
      NAME='TXTF01'  
  ADD OBJECT TXTF12 AS TEXTBOX WITH;      
      LEFT=INT_015*470,;
      TOP=INT_015*23,;
      WIDTH=INT_015*49,;
      MAXLENGTH=4,;
      NAME='TXTF12'        
  ADD OBJECT TXTF02 AS TEXTBOX WITH;
      AUTOSIZE=.T.,;
      LEFT=INT_015*295,;
      TOP=INT_015*48,;
      WIDTH=INT_015*49,;
      MAXLENGTH=5,;
      PASSWORDCHAR='*',;
      NAME='TXTF02'                 
  ADD OBJECT TXTF03 AS TEXTBOX WITH;
      LEFT=INT_015*295,;
      TOP=INT_015*73,;
      WIDTH=INT_015*68,;
      HEIGHT=INT_015*25,;
      MAXLENGTH=8,;
      NAME='TXTF03'                    
  ADD OBJECT TXTF04 AS TEXTBOX WITH;
      LEFT=INT_015*295,;
      TOP=INT_015*98,;
      WIDTH=INT_015*49,;
      MAXLENGTH=5,;
      NAME='TXTF04'                                
  ADD OBJECT TXTF07 AS TEXTBOX WITH;
      LEFT=INT_015*295,;
      TOP=INT_015*123,;
      WIDTH=INT_015*115,;
      MAXLENGTH=15,;
      NAME='TXTF07' 
  ADD OBJECT TXTF08 AS TEXTBOX WITH;
      LEFT=INT_015*468,;
      TOP=INT_015*123,;
      WIDTH=INT_015*115,;
      MAXLENGTH=15,;
      NAME='TXTF08' 
  ADD OBJECT TXTF09 AS TEXTBOX WITH;
      LEFT=INT_015*295,;
      TOP=INT_015*148,;
      WIDTH=INT_015*288,;
      MAXLENGTH=40,;
      NAME='TXTF09' 
  ADD OBJECT TXTF10 AS TEXTBOX WITH;
      LEFT=INT_015*295,;
      TOP=INT_015*173,;
      WIDTH=INT_015*288,;
      MAXLENGTH=50,;
      NAME='TXTF10'      
  ADD OBJECT TXTF05 AS TEXTBOX WITH;      
      LEFT=INT_015*295,;
      TOP=INT_015*198,;
      WIDTH=INT_015*94,;
      NAME='TXTF05'     
  ADD OBJECT OPTIONGROUP06 AS OPTIONGROUP WITH;
      VISIBLE=.T.,;
   	  TOP=INT_015*198,;
   	  LEFT=INT_015*503,;    
	  HEIGHT=INT_015*25,;
	  WIDTH=INT_015*80,;
	  BUTTONCOUNT=2,;
	  VALUE=1,;
	  ENABLED=.F.,;
	  NAME='OPTIONGROUP06',;
	  OPTION1.CAPTION='是',;
	  OPTION1.FONTSIZE=INT_015*9,;      
	  OPTION1.TOP=INT_015*5,;
	  OPTION1.AUTOSIZE=.T.,;
	  OPTION1.LEFT=INT_015*5,;
	  OPTION1.NAME='OPTION1',;
	  OPTION2.CAPTION='否',;
	  OPTION2.FONTSIZE=INT_015*9,;    
	  OPTION2.TOP=INT_015*5,;
	  OPTION2.AUTOSIZE=.T.,;
	  OPTION2.LEFT=INT_015*45,;
	  OPTION2.NAME='OPTION2'   	                   
  ADD OBJECT TXTF11 AS TEXTBOX WITH;      &&資料列背景色'
      VISIBLE=.F.,;
      LEFT=INT_015*295,;
      TOP=INT_015*23,;
      WIDTH=INT_015*100,;
      NAME='TXTF11'        
  ADD OBJECT MENU_TYPE AS COMBOBOX WITH;
      HEIGHT=INT_015*25,;
      TOP=INT_015*198,;
      LEFT=INT_015*295,;
      WIDTH=INT_015*94,;
      FONTSIZE=INT_015*9,;
      BOUNDCOLUMN=1,;
      COLUMNCOUNT=1,;   
      ROWSOURCETYPE=1,;
      STYLE=2,;
      NAME='MENU_TYPE'                
  ADD OBJECT COLOR_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*490,;
      LEFT=INT_015*15,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*100,;      
      FONTSIZE=INT_015*9,;
      TOOLTIPTEXT='選擇背景顏色!快速鍵->ALT+A',;
      CAPTION='\<C.選擇資料背景色',;
      NAME='COLOR_BOTT'            
  ADD OBJECT KEY_LIST AS KEY_LIST WITH;
      AUTOCENTER=.T.
  ADD OBJECT GRID1 AS GRID1 WITH;
      COLUMNCOUNT=2,;            
      RECORDSOURCE='A01',; 
      FONTSIZE=INT_015*9,;           
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2'
  ADD OBJECT CMDGROUP AS CMDGROUP WITH;
      AUTOCENTER=.T.        
  ADD OBJECT ORPGROUP AS ORPGROUP WITH;    
      AUTOCENTER=.T.
  ADD OBJECT SHRGROUP AS SHRGROUP WITH;
      TOP=INT_015*195,;
      LEFT=INT_015*600           
  PROC INIT
       THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.) AND IIF(A02.F08='*',.T.,.F.)  &&判斷有無新增的權限
       THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.) &&判斷有無修改的權限
       THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)  AND IIF(A02.F08='*',.T.,.F.)&&判斷有無刪除的權限
       THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.) AND IIF(A02.F08='*',.T.,.F.)&&判斷有無列印的權限
       THISFORM.SHRGROUP.VISIBLE=.F.
       THISFORM.SHRGROUP.ENABLED=.F. 
       THISFORM.SETALL('HEIGHT',25*INT_015,'TEXTBOX')
       THISFORM.SETALL('HEIGHT',17*INT_015,'LABEL')
       THISFORM.SETALL('READONLY',.T.,'TEXTBOX')
       THISFORM.SETALL('FONTSIZE',INT_015*9,'TEXTBOX')         
       THISFORM.SETALL('FONTSIZE',INT_015*9,'LABEL')       
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'COLUMN')  
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'HEADER')     
       THISFORM.GRID1.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)
       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*49
       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*68
       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='個人編號'
	   THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='姓        名'
	   THISFORM.GRID1.COLUMN1.CONTROLSOURCE='A01.F01'
	   THISFORM.GRID1.COLUMN2.CONTROLSOURCE='A01.F03'
       THISFORM.GRID1.READONLY=.T.       
       THISFORM.GRID1.SETFOCUS
       IF THISFORM.GRID1.ACTIVEROW=0
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
       ELSE
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.      
       ENDIF       
       JK='個人編號'
  ENDPROC     
  PROCEDURE TXTF04.INTERACTIVECHANGE
    IF AT('?',ALLTRIM(THIS.VALUE))<>0
       IF AT('?',ALLTRIM(THIS.VALUE))>1             
          SELECT F01,F02 FROM A14 INTO CURSOR DEPART ORDER BY F01 WHERE LEFT(F01,AT('?',THIS.VALUE)-1)=LEFT(THIS.VALUE,AT('?',THIS.VALUE)-1) AND LEN(ALLTRIM(F01))=4
       ELSE
          SELECT F01,F02 FROM A14 INTO CURSOR DEPART ORDER BY F01 WHERE LEN(ALLTRIM(F01))=4
       ENDIF   
       DEPART_SEEK=createobject("DEPART_SEEK")  
       DEPART_SEEK.SHOW    
       THIS.VALUE=FLG
       THIS.REFRESH
       FLG='0'
    ENDIF   
       THISFORM.LBLF041.CAPTION=IIF(SEEK(THIS.VALUE,'A14'),A14.F02,'')  
  ENDPROC
  PROC KEY_LIST.INIT 
       WITH THIS 
           .ADDITEM('依個人編號排列')
       ENDWITH      
  ENDPROC 
  PROC GRID1.AFTERROWCOLCHANGE
       LPARAMETERS nColIndex
       THISFORM.TXTF01.VALUE=F01
       THISFORM.TXTF02.VALUE=F02
       THISFORM.TXTF03.VALUE=F03
       THISFORM.TXTF04.VALUE=F04
       THISFORM.TXTF05.VALUE=F05
       THISFORM.OPTIONGROUP06.VALUE = IIF(ALLTRIM(F06) = 'Y',1,2)
       THISFORM.TXTF07.VALUE=F07
       THISFORM.TXTF08.VALUE=F08
       THISFORM.TXTF09.VALUE=F09
       THISFORM.TXTF10.VALUE=F10
       THISFORM.TXTF11.VALUE=F11
       THISFORM.TXTF12.VALUE=F12
       THISFORM.LBLF041.CAPTION=A14.F02     
       THISFORM.LBLF991.CAPTION=A01.F99
       THISFORM.LBLF11.BACKCOLOR=IIF(A01.F11=0,10009146,A01.F11)
       
 
              IF F05='MENU1'
                         THISFORM.IMAGE1.PICTURE='BMPS\MENU1.JPG'
              ELSE
                        THISFORM.IMAGE1.PICTURE='BMPS\HYTS-6.JPG'     
              ENDIF
       FCH=THISFORM.ACTIVECONTROL.NAME
       CHK=''
       THISFORM.REFRESH
  ENDPROC   
  PROCEDURE COLOR_BOTT.CLICK 
        LK=A01.F01
        IF THISFORM.TXTF11.VALUE<>10009146
            IF  MESSAGEBOX('是否要恢復系統預設之顏色',4+32+256,'請確認') = 6	
                  THISFORM.TXTF11.VALUE=10009146
            ELSE
                  GB=GETCOLOR()
                  IF GB>0
                      THISFORM.TXTF11.VALUE=GB
                  ENDIF
            ENDIF 
        ELSE    
            GB=GETCOLOR()
            IF GB>0
                THISFORM.TXTF11.VALUE=GB
            ENDIF        
        ENDIF 
        SELECT A01
        LOCK()
        IF RLOCK() 
            REPLACE A01.F11 WITH THISFORM.TXTF11.VALUE
            THISFORM.GRID1.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),A01.F11,10009146)
            THISFORM.LBLF11.BACKCOLOR=A01.F11
        ENDIF
        UNLOCK        
        SELECT A01 
        SEEK LK
        THISFORM.GRID1.SETFOCUS 
*!*	        THISFORM.REFRESH
  ENDPROC   
  PROCEDURE ORPGROUP.NEW_BOTT.CLICK 
       THISFORM.SETALL('READONLY',.F.,'TEXTBOX')    
       THISFORM.TXTF01.VALUE=''
       THISFORM.TXTF02.VALUE=''
       THISFORM.TXTF03.VALUE=''
       THISFORM.TXTF04.VALUE=''
       THISFORM.MENU_TYPE.VISIBLE=.T.
       THISFORM.MENU_TYPE.VALUE=1
       THISFORM.TXTF05.VALUE=THISFORM.MENU_TYPE.DISPLAYVALUE  
       THISFORM.IMAGE1.PICTURE='MIS_MENU.JPG'
       THISFORM.OPTIONGROUP06.ENABLED = .T.
       THISFORM.OPTIONGROUP06.VALUE = 2
       THISFORM.TXTF07.VALUE=''
       THISFORM.TXTF08.VALUE=''
       THISFORM.TXTF09.VALUE=''
       THISFORM.TXTF10.VALUE=''
       THISFORM.TXTF12.VALUE=''
       THISFORM.LBLF041.CAPTION=''
       THISFORM.TXTF01.SETFOCUS()
       THISFORM.GRID1.ENABLED=.F.
       FLG='1'
  ENDPROC  
  PROCEDURE ORPGROUP.EDIT_BOTT.CLICK
     THISFORM.GRID1.ENABLED=.F.
     THISFORM.OPTIONGROUP06.ENABLED = .T.
     IF  A02.F08='*'
         THISFORM.SETALL('READONLY',.F.,'TEXTBOX')
         THISFORM.TXTF01.READONLY=.T.        
         THISFORM.TXTF02.SETFOCUS
     ELSE    
          THISFORM.SETALL('READONLY',.T.,'TEXTBOX')
          THISFORM.TXTF07.READONLY=.F.
          THISFORM.TXTF08.READONLY=.F.
          THISFORM.TXTF09.READONLY=.F.
          THISFORM.TXTF10.READONLY=.F.
          THISFORM.TXTF07.SETFOCUS
     ENDIF
     THISFORM.MENU_TYPE.VISIBLE=.T.
     THISFORM.MENU_TYPE.DISPLAYVALUE=THISFORM.TXTF05.VALUE     
     LOCK()
     IF !RLOCK()
        DO file_impact
        RETURN
     ENDIF
  ENDPROC 
  PROCEDURE ORPGROUP.DEL_BOTT.CLICK
     IF MESSAGEBOX('是否確定要刪除此筆資料',4+32+256,'請確認') = 6	        
        SELE A01
        LOCK()
        IF RLOCK()   
           SELE A02 
           DELE FROM A02 WHERE A02.F01=THISFORM.TXTF01.VALUE    
           SEEK sys_oper+'A02'
           SELE A01
           DELETE 
           UNLOCK
           SKIP -1
           IF BOF()
              GO TOP
           ENDIF   
           THISFORM.GRID1.SETFOCUS
           IF THISFORM.GRID1.ACTIVEROW=0
              THISFORM.SETALL('VALUE','','TEXTBOX')
              THISFORM.LBLF041.CAPTION=''
              THISFORM.CMDGROUP.ENABLED=.F.
              THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
              THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
              THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
           ELSE
              THISFORM.CMDGROUP.ENABLED=.T.
              THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.)  AND IIF(A02.F08='*',.T.,.F.) &&判斷有無新增的權限
              THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  &&判斷有無修改的權限
              THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.) AND IIF(A02.F08='*',.T.,.F.)  &&判斷有無刪除的權限
              THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.) AND IIF(A02.F08='*',.T.,.F.)  &&判斷有無列印的權限              
           ENDIF
        ELSE
          DO file_impact    
        ENDIF     
     ENDIF   
  ENDPROC
  PROCEDURE SHRGROUP.SHURE1_BOTT.CLICK
    IF EMPTY(THISFORM.TXTF01.VALUE)
       =MESSAGEBOX('個人編號不得空白!',0+64,'提示視窗')
       THISFORM.TXTF01.SETFOCUS
       RETURN
    ENDIF   
    IF SEEK(THISFORM.TXTF04.VALUE,'A14')=.F. .OR. EMPTY(THISFORM.TXTF04.VALUE)
       =MESSAGEBOX("請務必輸入正確之部門編號!",0+64,"忘記編號可在空格內打'?'查詢")    
       THISFORM.TXTF04.SETFOCUS
       RETURN
    ENDIF   
   IF EMPTY(THISFORM.TXTF10.VALUE) <> .T.  AND AT('@',THISFORM.TXTF10.VALUE) = 0
       =MESSAGEBOX("E-MAIL格式不正確!",0+64,"提示訊息視窗")    
       THISFORM.TXTF10.SETFOCUS
       RETURN
    ENDIF    
    SELE A01
    SET ORDER TO A01
    IF SEEK(THISFORM.TXTF01.VALUE,'A01')=.T.
       =MESSAGEBOX('此個人編號已經建立!',0+64,'請注意')
       THISFORM.TXTF01.VALUE=''
       THISFORM.TXTF01.SETFOCUS  
       RETURN
    ENDIF
    SELECT A01
    APPEND BLANK
    IF RLOCK()
       REPLACE F01 WITH THISFORM.TXTF01.VALUE
       REPLACE F02 WITH THISFORM.TXTF02.VALUE
       REPLACE F03 WITH THISFORM.TXTF03.VALUE
       REPLACE F04 WITH THISFORM.TXTF04.VALUE
       REPLACE F05 WITH THISFORM.TXTF05.VALUE
       REPLACE F06 WITH IIF(THISFORM.OPTIONGROUP06.VALUE = 1,'Y','N')
       REPLACE F07 WITH THISFORM.TXTF07.VALUE
       REPLACE F08 WITH THISFORM.TXTF08.VALUE
       REPLACE F09 WITH THISFORM.TXTF09.VALUE
       REPLACE F10 WITH THISFORM.TXTF10.VALUE 
       REPLACE F11 WITH 10009146
       REPLACE F99 WITH DTOC(DATE())+' '+sys_name    
       SELECT S05
       LOCATE FOR ALLTRIM(S05.F02) = ALLTRIM(THISFORM.TXTF03.VALUE)
       IF FOUND()
           REPLACE A01.F12 WITH S05.F01
       ELSE
           SELECT S50
           LOCATE FOR ALLTRIM(S50.F02) = ALLTRIM(THISFORM.TXTF03.VALUE)
           IF FOUND()
               REPLACE A01.F12 WITH S50.F01
           ELSE
               REPLACE A01.F12 WITH THISFORM.TXTF12.VALUE 
           ENDIF    
       ENDIF
    ENDIF                
    SELECT A01   
    THISFORM.REC_COUNT.CAPTION=STR(RECCOUNT())
    THISFORM.GRID1.ENABLED=.T.
    THISFORM.REFRESH
    THISFORM.GRID1.SETFOCUS    
    THISFORM.ORPGROUP.NEW_BOTT.CLICK            
  ENDPROC
  PROCEDURE SHRGROUP.SHURE2_BOTT.CLICK
   IF SEEK(THISFORM.TXTF04.VALUE,'A14')=.F.
       =MESSAGEBOX("請務必輸入正確之部門編號!",0+64,"忘記編號可在空格內打'?'查詢")    
       THISFORM.TXTF04.SETFOCUS
       RETURN
    ENDIF  
   IF EMPTY(THISFORM.TXTF10.VALUE) <> .T.  AND AT('@',THISFORM.TXTF10.VALUE) = 0
       =MESSAGEBOX("E-MAIL格式不正確!",0+64,"提示訊息視窗")    
       THISFORM.TXTF10.SETFOCUS
       RETURN
    ENDIF      
    SELE A01
    IF RLOCK()
       REPLACE F02 WITH THISFORM.TXTF02.VALUE
       REPLACE F03 WITH THISFORM.TXTF03.VALUE
       REPLACE F04 WITH THISFORM.TXTF04.VALUE
       REPLACE F05 WITH THISFORM.TXTF05.VALUE
       REPLACE F06 WITH IIF(THISFORM.OPTIONGROUP06.VALUE = 1,'Y','N')
       REPLACE F07 WITH THISFORM.TXTF07.VALUE
       REPLACE F08 WITH THISFORM.TXTF08.VALUE
       REPLACE F09 WITH THISFORM.TXTF09.VALUE
       REPLACE F10 WITH THISFORM.TXTF10.VALUE 
       REPLACE F99 WITH DTOC(DATE())+' '+sys_name   
       SELECT S05
       LOCATE FOR ALLTRIM(S05.F02) = ALLTRIM(THISFORM.TXTF03.VALUE)
       IF FOUND()
           REPLACE A01.F12 WITH S05.F01
       ELSE
           SELECT S50
           LOCATE FOR ALLTRIM(S50.F02) = ALLTRIM(THISFORM.TXTF03.VALUE)
           IF FOUND()
               REPLACE A01.F12 WITH S50.F01
           ELSE
               REPLACE A01.F12 WITH THISFORM.TXTF12.VALUE 
           ENDIF    
       ENDIF       
    ELSE
      DO file_impact
      RETURN   
    ENDIF   
    UNLOCK ALL
    THISFORM.SHRGROUP.ABANDON_BOTT.CLICK    
  ENDPROC   
  PROCEDURE SHRGROUP.ABANDON_BOTT.CLICK
      THISFORM.SHRGROUP.ENABLED=.F.
      THISFORM.SHRGROUP.VISIBLE=.F.      
      THISFORM.ORPGROUP.ENABLED=.T.
      THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.) AND IIF(A02.F08='*',.T.,.F.)   &&判斷有無新增的權限      
      THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.) &&判斷有無修改的權限
      THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)  AND IIF(A02.F08='*',.T.,.F.)  &&判斷有無刪除的權限
      THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.) AND IIF(A02.F08='*',.T.,.F.)  &&判斷有無列印的權限      
      THISFORM.ORPGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
      THISFORM.CMDGROUP.ENABLED=.T.
      THISFORM.CMDGROUP.SETALL('ENABLED',.T.,'COMMANDBUTTON')
      THISFORM.CMDGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
      THISFORM.OPTIONGROUP06.ENABLED = .F.
      THISFORM.KEY_LIST.ENABLED=.T.      
      THISFORM.SETALL('READONLY',.T.,'TEXTBOX')   
      THISFORM.MENU_TYPE.VISIBLE=.F.
      UNLOCK ALL
      SELE A01
      THISFORM.GRID1.ENABLED=.T.
      THISFORM.GRID1.SETFOCUS      
  ENDPROC
  PROCEDURE SHRGROUP.FINISH_BOTT.CLICK   
       THISFORM.SHRGROUP.ABANDON_BOTT.CLICK
  ENDPROC     
  PROCEDURE MENU_TYPE.INIT
        IF A02.F08 <> '*'
           WITH THIS 
             .VISIBLE=.F.
             .VALUE=1
             .ADDITEM('LIST_MENU')
             .ADDITEM('MENU1   ')  
           ENDWITH          
        ELSE
           WITH THIS 
             .VISIBLE=.F.
             .VALUE=1
             .ADDITEM('MENU1   ')        
             .ADDITEM('MENU6   ')    
           ENDWITH      
        ENDIF   
  ENDPROC  
  PROCEDURE MENU_TYPE.INTERACTIVECHANGE
     THISFORM.TXTF05.VALUE=THIS.DISPLAYVALUE
  
 
             IF THIS.DISPLAYVALUE = 'MENU1   '
                         THISFORM.IMAGE1.PICTURE='BMPS\MENU1.JPG'                     
            ELSE
                         THISFORM.IMAGE1.PICTURE='BMPS\HYTS-6.JPG'                     
       ENDIF
  ENDPROC  
ENDDEFINE    

