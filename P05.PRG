****程式名稱:P05 採購異動單
CLOSE ALL
CLEAR 
ASSIS_NO=''
SALES_B_NO=''
HD1='P005 '
HD2='PC'
HD3='採購異動處理單'
FLG='0'
FCH=''
CHK=''
CUS=''
DTE=CTOD('')
R=0
QTY=0
TQTY=0
AREA1='P08'
AREA2='P09'
IF !USED('A09')
   SELE 0
   USE A09
ELSE
   SELE A09
ENDIF
SET ORDER TO 1
A24='A24'+LEFT(DTOS(DATE()),6)
IF !USED('&A24')
   SELE 0
   USE (A24) ALIA A24
ELSE
   SELE A24
ENDIF
SET ORDER TO 1      
IF ! USED('A01')
   SELE 0
   USE A01 INDE A01
ELSE
   SELE A01
ENDIF      
SET ORDER TO A01
IF !USED('A02')
   SELE 0
   USE A02 INDE A02
ELSE
   SELE A02
ENDIF
SET ORDER TO A021      
SEEK SYS_OPER+'P05'
IF !USED('A14')
   SELE 0
   USE A14
ELSE
   SELE A14
ENDIF
SET ORDER TO 1      
IF !USED('D07')
   SELECT 0
   USE D07
ELSE
   SELECT D07
ENDIF
SET ORDER TO D074       
IF !USED('B01')
   SELE 0
   USE B01 INDE B01
ELSE
   SELE B01
ENDIF
SET ORDER TO 1      
IF !USED('D01')
   SELE 0
   USE D01 INDE D01
ELSE
   SELE D01
ENDIF
SET ORDER TO D011

IF !USED('C01')
   SELE 0
   USE C01 INDE C01
ELSE
   SELE C01
ENDIF
SET ORDER TO C011

IF !USED('P08')
   SELE 0
   USE P08 INDE P08
ELSE
   SELE P08
ENDIF
SET ORDER TO P081
SET RELA TO F07 INTO A01 ADDI
SET RELATION TO F04 INTO D01 ADDITIVE 
IF !USED('P09')
   SELE 0
   USE P09 INDE P09
ELSE
   SELE P09
ENDIF
SET ORDER TO P091      
SET RELA TO F02 INTO B01
SET RELATION TO F11 INTO C01 ADDITIVE  
P05FORM=CREATEOBJECT("TKP05")
P05FORM.SHOW  
DEFINE CLASS TKP05 AS FORM
  CAPTION='P05.'+HD3
*!*	  AUTOCENTER=.T.
  CONTROLBOX=.F.
  BORDERSTYLE=1 
  MAXBUTTON=.F.
  MINBUTTON=.F.
  MOVABLE=.F.
  CLOSABLE=.F.
  CONTROLCOUNT=57
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*550
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WIDTH=INT_015*789
  WINDOWTYPE=1
  NAME='TKP05'
  ADD OBJECT SHAPE1 AS SHAPE1 WITH;
      AUTOCENTER=.T.
  ADD OBJECT LBL_REC AS LBL_REC WITH;
      AUTOCENTER =.T.
  ADD OBJECT REC_COUNT AS REC_COUNT  WITH;
      CAPTION=STR(RECCOUNT())        
  ADD OBJECT SHAPE2 AS SHAPE2 WITH;
      AUTOCENTER=.T.
  ADD OBJECT SHAPE3 AS SHAPE3 WITH;
      AUTOCENTER=.T.
  ADD OBJECT PAGEFRAME1 AS PAGEFRAME WITH;
      LEFT=INT_015*236,;
      WIDTH=INT_015*540,;
      HEIGHT=INT_015*200,;
      FONTSIZE=INT_015*9,;      
      PAGECOUNT=2,;
      TABSTRETCH=1,;
      ACTIVEPAGE=1,;
      VISIBLE=.T.,;
      PAGE1.NAME='PAGE1',;
      PAGE1.VISIBLE=.T.,;
      PAGE1.CAPTION='表頭資料',;
      PAGE2.NAME='PAGE2',;
      PAGE2.VISIBLE=.T.,;
      PAGE2.CAPTION='表身詳細資料內容'   
  ADD OBJECT KEY_LIST AS KEY_LIST WITH;
      AUTOCENTER=.T.
  ADD OBJECT GRID1 AS GRID1 WITH;
      COLUMNCOUNT=4,;            
      RECORDSOURCE='P08',;
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;      
      COLUMN3.NAME='COLUMN3',;      
      COLUMN4.NAME='COLUMN4'      
  ADD OBJECT GRID2 AS GRID2 WITH;
      COLUMNCOUNT=7,;            
      RECORDSOURCE='P09',;
      LINKMASTER='P08',;
      RELATIONALEXPR='F01',;
      CHILDORDER='P091',;
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;
      COLUMN3.NAME='COLUMN3',;
      COLUMN4.NAME='COLUMN4',;
      COLUMN5.NAME='COLUMN5',;
      COLUMN6.NAME='COLUMN6',;
      COLUMN7.NAME='COLUMN7'
  ADD OBJECT CMDGROUP AS CMDGROUP WITH;
      AUTOSIZE=.T.              
  ADD OBJECT ORPGROUP AS ORPGROUP WITH;    
      AUTOSIZE=.T.              
  ADD OBJECT SHRGROUP AS SHRGROUP WITH;
      TOP=INT_015*168,;
      LEFT=INT_015*680          
  ADD OBJECT ANS_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*490,;
      LEFT=INT_015*12,;
      HEIGHT=INT_015*25,;
      FONTSIZE=INT_015*9,;
      WIDTH=INT_015*40,;
      CAPTION='\<Z.確認',;
      NAME='ANS_BOTT'                  
  ADD OBJECT EXCEL_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*490,;
      LEFT=INT_015*158,;
      HEIGHT=INT_015*25,;
      FONTSIZE=INT_015*9,;
      WIDTH=INT_015*65,;
      CAPTION='\<T.轉EXCEL',;
      NAME='EXCEL_BOTT'               

  PROCEDURE PAGEFRAME1.PAGE1.INIT     
     THIS.ADDOBJECT('LBLF01','LABEL')
     WITH THIS.LBLF01
          .VISIBLE=.T.
          .LEFT=INT_015*14
          .TOP=INT_015*13
          .WIDTH=INT_015*50
          .CAPTION='異動單號'          
     ENDWITH
     THIS.ADDOBJECT('LBLF02','LABEL')     
     WITH THIS.LBLF02
          .VISIBLE=.T.
          .LEFT=INT_015*14
          .TOP=INT_015*38
          .WIDTH=INT_015*50  
          .CAPTION='異動日期'
     ENDWITH            
     THIS.ADDOBJECT('LBLF03','LABEL')
     WITH THIS.LBLF03
         .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*63
         .WIDTH=INT_015*50
         .CAPTION='異動類別'
     ENDWITH
     THIS.ADDOBJECT('LBLF031','LABEL')
     WITH THIS.LBLF031
         .VISIBLE=.T.
         .LEFT=INT_015*90
         .TOP=INT_015*63
         .AUTOSIZE=.T.
     ENDWITH
     THIS.ADDOBJECT('LBLF04','LABEL')
     WITH THIS.LBLF04
         .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*88
         .WIDTH=INT_015*50
         .CAPTION='廠商編號'
     ENDWITH    
     THIS.ADDOBJECT('LBLF041','LABEL')
     WITH THIS.LBLF041
         .VISIBLE=.T.
         .LEFT=INT_015*115
         .TOP=INT_015*88
         .AUTOSIZE=.T.        
     ENDWITH
     THIS.ADDOBJECT('LBLF06','LABEL')
     WITH THIS.LBLF06
         .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*113
         .WIDTH=INT_015*50
         .CAPTION='異動原因'
     ENDWITH    
     THIS.ADDOBJECT('LBLF12','LABEL')
     WITH THIS.LBLF12
         .VISIBLE=.T.
         .LEFT=INT_015*154
         .TOP=INT_015*113
         .WIDTH=INT_015*50
         .AUTOSIZE=.T.
         .CAPTION=''
     ENDWITH    
     THIS.ADDOBJECT('LBLF10','LABEL')
     WITH THIS.LBLF10
         .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*138
         .WIDTH=INT_015*50
         .CAPTION='備註說明'
     ENDWITH         
     THIS.ADDOBJECT('LBLF07','LABEL')
     WITH THIS.LBLF07
         .VISIBLE=.T.
         .LEFT=INT_015*318
         .TOP=INT_015*13
         .WIDTH=INT_015*50
         .CAPTION='異動人員'         
     ENDWITH    
     THIS.ADDOBJECT('LBLF071','LABEL')
     WITH THIS.LBLF071
         .VISIBLE=.T.
         .LEFT=INT_015*440
         .TOP=INT_015*13
         .AUTOSIZE=.T.
     ENDWITH 
     THIS.ADDOBJECT('LBLF05','LABEL')
     WITH THIS.LBLF05
         .VISIBLE=.T.
         .LEFT=INT_015*318
         .TOP=INT_015*38
         .WIDTH=INT_015*50
         .CAPTION='聯 絡 人'
     ENDWITH        
     
     THIS.ADDOBJECT('LBLF09','LABEL')
     WITH THIS.LBLF09
         .VISIBLE=.T.
         .LEFT=INT_015*318
         .TOP=INT_015*92
         .WIDTH=INT_015*50
         .CAPTION='安全資料'
     ENDWITH    
     THIS.ADDOBJECT('LBLF091','LABEL')
     WITH THIS.LBLF091
         .VISIBLE=.T.
         .LEFT=INT_015*369
         .TOP=INT_015*92
         .AUTOSIZE=.T.
     ENDWITH         
    THIS.ADDOBJECT('LBLF11','LABEL')
     WITH THIS.LBLF11
         .VISIBLE=.T.
         .LEFT=INT_015*318
         .TOP=INT_015*117
         .WIDTH=INT_015*50
         .CAPTION='列印次數'
     ENDWITH    
     THIS.ADDOBJECT('LBLF111','LABEL')
     WITH THIS.LBLF111
         .VISIBLE=.T.
         .LEFT=INT_015*369
         .TOP=INT_015*117
         .AUTOSIZE=.T.
     ENDWITH              
     THIS.ADDOBJECT('TXTF01','TEXTBOX')          
     WITH THIS.TXTF01
          .VISIBLE=.T.
          .LEFT=INT_015*64
          .TOP=INT_015*9
          .WIDTH=INT_015*81
          .HEIGHT=INT_015*25
          .MAXLENGTH=10
     ENDWITH        
     THIS.ADDOBJECT('TXTF02','TEXTBOX')          
     WITH THIS.TXTF02
          .VISIBLE=.T.
          .LEFT=INT_015*64
          .TOP=INT_015*34
          .WIDTH=INT_015*75
          .HEIGHT=INT_015*25          
     ENDWITH        
     THIS.ADDOBJECT('TXTF03','TEXTBOX')          
     WITH THIS.TXTF03
          .VISIBLE=.T.
          .LEFT=INT_015*64
          .TOP=INT_015*59
          .WIDTH=INT_015*20
          .HEIGHT=INT_015*25
          .MAXLENGTH=1
     ENDWITH        
     THIS.ADDOBJECT('UPDMNT_TYPE','UPDMNT')
     
     THIS.ADDOBJECT('TXTF04','TXTF04')          
     WITH THIS.TXTF04
          .VISIBLE=.T.
          .LEFT=INT_015*64
          .TOP=INT_015*84
          .WIDTH=INT_015*49
          .HEIGHT=INT_015*25
          .MAXLENGTH=5
     ENDWITH     
     THIS.ADDOBJECT('TXTF06','TEXTBOX')          
     WITH THIS.TXTF06
          .VISIBLE=.T.
          .LEFT=INT_015*64
          .TOP=INT_015*109
          .WIDTH=INT_015*81
          .HEIGHT=INT_015*25
          .MAXLENGTH=20
     ENDWITH           
     THIS.ADDOBJECT('TXTF10','TEXTBOX')          
     WITH THIS.TXTF10
          .VISIBLE=.T.
          .LEFT=INT_015*64
          .TOP=INT_015*134
          .WIDTH=INT_015*370
          .HEIGHT=INT_015*25
          .MAXLENGTH=80
     ENDWITH                
     THIS.ADDOBJECT('TXTF07','TXTF07')          
     WITH THIS.TXTF07
          .VISIBLE=.T.
          .LEFT=INT_015*370
          .TOP=INT_015*9
          .WIDTH=INT_015*65
          .HEIGHT=INT_015*25
          .MAXLENGTH=5
     ENDWITH 
     THIS.ADDOBJECT('TXTF05','TEXTBOX')          
     WITH THIS.TXTF05
          .VISIBLE=.T.
          .LEFT=INT_015*370
          .TOP=INT_015*34
          .WIDTH=INT_015*120
          .HEIGHT=INT_015*25
          .MAXLENGTH=20
     ENDWITH        
         
  ENDPROC 
  ************  
  PROCEDURE PAGEFRAME1.PAGE2.INIT
	THIS.ADDOBJECT('LBLF02','LABEL')
	WITH THIS.LBLF02  
	     .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*13
	     .WIDTH=INT_015*50
         .CAPTION='料品編號'
    ENDWITH  
    THIS.ADDOBJECT('LBLF021','LABEL')
    WITH THIS.LBLF021
         .VISIBLE=.T.
         .LEFT=INT_015*327
	     .TOP=INT_015*13
	     .AUTOSIZE=.T.
	ENDWITH     
   THIS.ADDOBJECT('LBLF07','LABEL')
	WITH THIS.LBLF07
	     .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*38
	     .WIDTH=INT_015*50
         .CAPTION='採購單號'
    ENDWITH  
    THIS.ADDOBJECT('LBLF11','LABEL')
    WITH THIS.LBLF11
         .VISIBLE=.T.
	     .LEFT=INT_015*214
	     .TOP=INT_015*38
	     .WIDTH=INT_015*50
	     .CAPTION='使用客戶'
	ENDWITH  
    THIS.ADDOBJECT('LBLF111','LABEL')
    WITH THIS.LBLF111
         .VISIBLE=.T.
	     .LEFT=INT_015*330
	     .TOP=INT_015*38
	     .AUTOSIZE=.T.
	     .CAPTION=''
	ENDWITH  	
    THIS.ADDOBJECT('LBLF08','LABEL')
    WITH THIS.LBLF08
         .VISIBLE=.T.
	     .LEFT=INT_015*214
	     .TOP=INT_015*63
	     .WIDTH=INT_015*50
	     .CAPTION='運貨方式'
	ENDWITH  
    THIS.ADDOBJECT('LBLF081','LABEL')
    WITH THIS.LBLF081
         .VISIBLE=.T.
	     .LEFT=INT_015*265
	     .TOP=INT_015*63
	     .AUTOSIZE=.T.
	     .CAPTION=''
	ENDWITH  	
    THIS.ADDOBJECT('LBLF04','LABEL')
    WITH THIS.LBLF04
         .VISIBLE=.T.
         .LEFT=INT_015*14
         .TOP=INT_015*63
         .WIDTH=INT_015*50
         .CAPTION='原訂交期'         
    ENDWITH      
    THIS.ADDOBJECT('LBLF05','LABEL')
    WITH THIS.LBLF05
         .VISIBLE=.T.    
         .LEFT=INT_015*14
         .TOP=INT_015*88
         .WIDTH=INT_015*50
         .CAPTION='希望交期'       
    ENDWITH        
    THIS.ADDOBJECT('LBLF03','LABEL')
    WITH THIS.LBLF03
         .VISIBLE=.T.
	     .LEFT=INT_015*14
	     .TOP=INT_015*113
	     .WIDTH=INT_015*50
	     .CAPTION='採購數量'
	ENDWITH     
    THIS.ADDOBJECT('LBLF09','LABEL')
     WITH THIS.LBLF09
         .VISIBLE=.T.
         .LEFT=INT_015*214
         .TOP=INT_015*88
         .WIDTH=INT_015*50
         .CAPTION='回        覆'
     ENDWITH              
     THIS.ADDOBJECT('LBLF091','LABEL')
     WITH THIS.LBLF091
         .VISIBLE=.T.
         .LEFT=INT_015*265
         .TOP=INT_015*88
         .AUTOSIZE=.T.
     ENDWITH             
     THIS.ADDOBJECT('LBLF12','LABEL')
     WITH THIS.LBLF12
         .VISIBLE=.T.
         .LEFT=INT_015*214
         .TOP=INT_015*113
         .WIDTH=INT_015*50
         .CAPTION='備註說明'
     ENDWITH              
    
    THIS.ADDOBJECT('LBLF10','LABEL')
     WITH THIS.LBLF10
         .VISIBLE=.T.
         .LEFT=INT_015*364
         .TOP=INT_015*88
         .WIDTH=INT_015*50
         .CAPTION='確認狀態'
     ENDWITH              
     THIS.ADDOBJECT('LBLF101','LABEL')
     WITH THIS.LBLF101
         .VISIBLE=.T.
         .LEFT=INT_015*415
         .TOP=INT_015*88
         .AUTOSIZE=.T.
     ENDWITH         
    THIS.ADDOBJECT('LBLF06','LABEL')      
    WITH THIS.LBLF06
         .VISIBLE=.T.       
         .LEFT=INT_015*14
         .TOP=INT_015*138
         .WIDTH=INT_015*50
         .CAPTION='安全資料'
    ENDWITH     
    THIS.ADDOBJECT('LBLF061','LABEL')      
    WITH THIS.LBLF061
         .VISIBLE=.T.       
         .LEFT=INT_015*64
         .TOP=INT_015*138
         .AUTOSIZE=.T.
    ENDWITH         
    THIS.ADDOBJECT('LBLF90','LABEL')      
    WITH THIS.LBLF90
         .VISIBLE=.T.       
         .LEFT=INT_015*14
         .TOP=INT_015*160
         .WIDTH=INT_015*50
         .CAPTION='確認人員'
    ENDWITH     
    THIS.ADDOBJECT('LBLF901','LABEL')      
    WITH THIS.LBLF901
         .VISIBLE=.T.       
         .LEFT=INT_015*64
         .TOP=INT_015*160
         .AUTOSIZE=.T.
    ENDWITH      
  
	THIS.ADDOBJECT('TXTF02','TXTF02')
	WITH THIS.TXTF02      
	     .VISIBLE=.T.
	     .LEFT=INT_015*65
	     .TOP=INT_015*9
	     .WIDTH=INT_015*261
	     .HEIGHT=INT_015*25
	     .MAXLENGTH=43
	     .NAME='TXTF02'              	     
	ENDWITH     
	THIS.ADDOBJECT('TXTF07','TXTF0G')
    WITH THIS.TXTF07
         .VISIBLE=.T.           
         .LEFT=INT_015*65
         .TOP=INT_015*34
         .WIDTH=INT_015*85
         .HEIGHT=INT_015*25
         .MAXLENGTH=10
         .NAME='TXTF07'                            
    ENDWITH     
	THIS.ADDOBJECT('TXTF11','TEXTBOX')
    WITH THIS.TXTF11
         .VISIBLE=.T.           
         .LEFT=INT_015*265
         .TOP=INT_015*34
         .WIDTH=INT_015*60
         .HEIGHT=INT_015*25
         .MAXLENGTH=10
         .NAME='TXTF11'                            
    ENDWITH     
    THIS.ADDOBJECT('TXTF04','TEXTBOX')
    WITH THIS.TXTF04
         .VISIBLE=.T.           
         .LEFT=INT_015*65
         .TOP=INT_015*59
         .WIDTH=INT_015*75      
         .NAME='TXTF04'
    ENDWITH     
    THIS.ADDOBJECT('TXTF05','TEXTBOX')
    WITH THIS.TXTF05
         .VISIBLE=.T.           
         .LEFT=INT_015*65
         .TOP=INT_015*84
         .WIDTH=INT_015*75
         .HEIGHT=INT_015*25
         .NAME='TXTF05'                            
    ENDWITH     
	THIS.ADDOBJECT('TXTF03','TEXTBOX')
	WITH THIS.TXTF03
	     .VISIBLE=.T.
	     .LEFT=INT_015*65
	     .TOP=INT_015*109
	     .WIDTH=INT_015*100
	     .HEIGHT=INT_015*25
	     .INPUTMASK='99999999999'
	     .NAME='TXTF03'	    
	ENDWITH          
    THIS.ADDOBJECT('RESPONSE_TYPE','RESPONSE') 
    THIS.ADDOBJECT('TRANSPORT_TYPE','TRANSPORT') 
    THIS.ADDOBJECT('TXTF12','TEXTBOX')
    WITH THIS.TXTF12
         .VISIBLE=.T.           
         .LEFT=INT_015*265
         .TOP=INT_015*109
         .WIDTH=INT_015*268
         .HEIGHT=INT_015*25
         .MAXLENGTH=40
         .NAME='TXTF12'                            
    ENDWITH     
  ENDPROC       
  PROCEDURE PAGEFRAME1.PAGE1.ACTIVATE
     R=0
     SELE P08      
     IF THISFORM.SHRGROUP.VISIBLE=.F.
        THISFORM.GRID1.ENABLED=.T.   
        THISFORM.GRID1.SETFOCUS 
        THISFORM.KEY_LIST.ENABLED=.T.
                        
     ELSE
       THISFORM.KEY_LIST.ENABLED=.F.   
     ENDIF          
    IF THISFORM.GRID1.ACTIVEROW=0 .AND. THISFORM.SHRGROUP.ENABLED=.F.
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
        THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
        THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
        THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.         
      
        THISFORM.EXCEL_BOTT.ENABLED=.F. 
        THISFORM.PAGEFRAME1.PAGE1.SETALL('VALUE','','TEXTBOX')        
        THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=''
        THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE=''
        THISFORM.PAGEFRAME1.PAGE1.TXTF03.VALUE=''
        THISFORM.PAGEFRAME1.PAGE1.LBLF031.CAPTION=''
        THISFORM.PAGEFRAME1.PAGE1.TXTF04.VALUE=''
        THISFORM.PAGEFRAME1.PAGE1.LBLF041.CAPTION=''
        THISFORM.PAGEFRAME1.PAGE1.TXTF06.VALUE=''
        THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE=''        
        THISFORM.PAGEFRAME1.PAGE1.LBLF071.CAPTION=''
               
        THISFORM.PAGEFRAME1.PAGE1.LBLF091.CAPTION=''  
        THISFORM.PAGEFRAME1.PAGE1.LBLF111.CAPTION=''    
        THISFORM.PAGEFRAME1.PAGE1.LBLF12.CAPTION=''  
        THISFORM.PAGEFRAME1.PAGE1.TXTF05.VALUE=''
        THISFORM.PAGEFRAME1.PAGE2.ENABLED=.F.      
     ELSE
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.
        THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.) AND P08.F08=0   &&判斷有無修改的權限
        THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)  AND P08.F08=0   &&判斷有無刪除的權限
        THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限            
                
        THISFORM.EXCEL_BOTT.ENABLED=.T.
        THISFORM.PAGEFRAME1.PAGE2.ENABLED=.T.
        
     ENDIF   
     THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.)   
       
      
  ENDPROC
  PROCEDURE PAGEFRAME1.PAGE2.ACTIVATE
       SELE P09
     IF THISFORM.SHRGROUP.ENABLED=.F.
         THISFORM.GRID2.READONLY=.T.      
         THISFORM.GRID2.SETFOCUS   
*        THISFORM.ANS_BOTT.ENABLED=IIF(F23=0,.T.,.F.) .AND. IIF(F10=0,.F.,.T.)
     ENDIF   	
     IF THISFORM.GRID2.ACTIVEROW=0 .AND. THISFORM.SHRGROUP.ENABLED=.F.
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
        THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
        THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
        THISFORM.PAGEFRAME1.PAGE2.SETALL('VALUE','','TEXTBOX')
        THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE=''
        THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=0
        THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE=CTOD('')       
        THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE=0    
        THISFORM.PAGEFRAME1.PAGE2.TXTF11.VALUE=''            
        THISFORM.PAGEFRAME1.PAGE2.LBLF061.CAPTION=''
        THISFORM.PAGEFRAME1.PAGE2.LBLF111.CAPTION=''
        THISFORM.PAGEFRAME1.PAGE2.LBLF901.CAPTION=''
        
        THISFORM.ANS_BOTT.ENABLED=.F.
       
     ELSE
        THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
        THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
        THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.
        THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  .AND. !P09.F10  &&判斷有無修改的權限
        THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)   .AND. !P09.F10  &&判斷有無刪除的權限
        THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限  
         
        
     ENDIF   
     R=RECNO('&AREA1')
     THISFORM.GRID1.SETALL("DYNAMICBACKCOLOR","IIF(RECNO('&AREA1')=R,RGB(255,255,0),'')","COLUMN")
     THISFORM.GRID1.ENABLED=.F.     
     THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.)    &&判斷有無新增的權限
     THISFORM.KEY_LIST.ENABLED=.F.     
     THISFORM.EXCEL_BOTT.ENABLED=.F.
  ENDPROC   
  PROC INIT    
        SELECT P08
        GO BOTTOM       
       THISFORM.ORPGROUP.NEW_BOTT.ENABLED=IIF(A02.F04='*',.T.,.F.)   &&判斷有無新增的權限
       THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限  
       THISFORM.PAGEFRAME1.PAGE1.FONTSIZE=INT_015*10
       THISFORM.PAGEFRAME1.PAGE2.FONTSIZE=INT_015*10       
       THISFORM.SETALL('HEIGHT',INT_015*25,'TEXTBOX')
       THISFORM.SETALL('HEIGHT',INT_015*17,'LABEL')
       THISFORM.SETALL('FONTSIZE',INT_015*9,'TEXTBOX')
       THISFORM.SETALL('FONTSIZE',INT_015*9,'LABEL')       
       THISFORM.SETALL('READONLY',.T.,'TEXTBOX')
       THISFORM.SHRGROUP.VISIBLE=.F.
       THISFORM.SHRGROUP.ENABLED=.F.
       THISFORM.GRID1.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)
       THISFORM.GRID2.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'COLUMN')
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'HEADER')         
                            
       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='異動單號'
       THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='對象代號'
       THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='對象簡稱'
       THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='需求單號'
       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='P08.F01'
       THISFORM.GRID1.COLUMN2.CONTROLSOURCE='P08.F04'
       THISFORM.GRID1.COLUMN3.CONTROLSOURCE='D01.F04'
       THISFORM.GRID1.COLUMN4.CONTROLSOURCE='P08.F06'
       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*81
       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*49
       THISFORM.GRID1.COLUMN3.WIDTH=INT_015*68
       THISFORM.GRID1.COLUMN4.WIDTH=INT_015*81
       THISFORM.GRID2.SETALL('FONTSIZE',INT_015*9,'COLUMN')
       THISFORM.GRID2.SETALL('FONTSIZE',INT_015*9,'HEADER')       
       THISFORM.GRID2.SETALL("DYNAMICBACKCOLOR","IIF(EMPTY(P09.F10)=.F.,RGB(0,255,255),'')","COLUMN")                        
       THISFORM.GRID2.COLUMN1.HEADER1.CAPTION='料品編號'
       THISFORM.GRID2.COLUMN2.HEADER1.CAPTION='品名規格'
	   THISFORM.GRID2.COLUMN3.HEADER1.CAPTION='採購數量'
	   THISFORM.GRID2.COLUMN4.HEADER1.CAPTION='原訂交期'
	   THISFORM.GRID2.COLUMN5.HEADER1.CAPTION='希望交期'
	   THISFORM.GRID2.COLUMN6.HEADER1.CAPTION='運貨方式'
	   THISFORM.GRID2.COLUMN7.HEADER1.CAPTION='安全資料'
	   THISFORM.GRID2.COLUMN1.CONTROLSOURCE='P09.F02'
	   THISFORM.GRID2.COLUMN2.CONTROLSOURCE='B01.F02'
	   THISFORM.GRID2.COLUMN3.CONTROLSOURCE="P09.F03"
	   THISFORM.GRID2.COLUMN4.CONTROLSOURCE="P09.F04"	   
	   THISFORM.GRID2.COLUMN5.CONTROLSOURCE='P09.F05'
	   THISFORM.GRID2.COLUMN6.CONTROLSOURCE='P09.F08'
	   THISFORM.GRID2.COLUMN7.CONTROLSOURCE='P09.F06'
	   THISFORM.GRID2.COLUMN1.WIDTH=INT_015*149
	   THISFORM.GRID2.COLUMN2.WIDTH=INT_015*100
       THISFORM.GRID2.COLUMN3.WIDTH=INT_015*85
       THISFORM.GRID2.COLUMN4.WIDTH=INT_015*75
       THISFORM.GRID2.COLUMN5.WIDTH=INT_015*75
       THISFORM.GRID2.COLUMN3.ALIGNMENT=1
       THISFORM.GRID2.COLUMN4.ALIGNMENT=1
       THISFORM.GRID2.COLUMN5.ALIGNMENT=1
       THISFORM.GRID2.COLUMN6.WIDTH=INT_015*70
       THISFORM.GRID2.COLUMN7.WIDTH=INT_015*100
       THISFORM.GRID1.READONLY=.T.       
       THISFORM.GRID2.READONLY=.T.    
       THISFORM.GRID1.SETFOCUS
       IF THISFORM.GRID1.ACTIVEROW=0
          THISFORM.CMDGROUP.ENABLED=.F.
          THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
          THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.
          THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
          THISFORM.EXCEL_BOTT.ENABLED=.F.
       ELSE
          THISFORM.CMDGROUP.ENABLED=.T.      
          THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.) AND P08.F08=0  &&判斷有無修改的權限
          THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)  AND P08.F08=0 &&判斷有無刪除的權限
          THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限 
          THISFORM.EXCEL_BOTT.ENABLED=.T. 
       ENDIF          
        
       THISFORM.KEY_LIST.DISPLAYVALUE='依異動單號排列'       
       JK='異動單號'
       SELE P08
       THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE=P08.F02
  ENDPROC            
  PROC KEY_LIST.INIT 
       WITH THIS 
           .ADDITEM('依異動單號排列')            
       ENDWITH      
  ENDPROC 
  
  PROC GRID1.AFTERROWCOLCHANGE
       LPARAMETERS NCOLINDEX
       
       THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=P08.F01
       THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE=P08.F02
       THISFORM.PAGEFRAME1.PAGE1.TXTF03.VALUE=P08.F03
       THISFORM.PAGEFRAME1.PAGE1.LBLF031.CAPTION=IIF(P08.F03='1','取消訂單',IIF(P08.F03='2','交期變更','詢問交期'))       
       THISFORM.PAGEFRAME1.PAGE1.TXTF04.VALUE=P08.F04       
       THISFORM.PAGEFRAME1.PAGE1.LBLF041.CAPTION=D01.F04      
       THISFORM.PAGEFRAME1.PAGE1.TXTF05.VALUE=P08.F05  
       THISFORM.PAGEFRAME1.PAGE1.TXTF06.VALUE=P08.F06              
       THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE=P08.F07
       THISFORM.PAGEFRAME1.PAGE1.LBLF071.CAPTION=IIF(SEEK(P08.F07,'A01'),A01.F03,'')

           
       THISFORM.PAGEFRAME1.PAGE1.LBLF091.CAPTION=P08.F09
       THISFORM.PAGEFRAME1.PAGE1.LBLF111.CAPTION=ALLTRIM(STR(P08.F11))
        
       THISFORM.PAGEFRAME1.PAGE1.TXTF10.VALUE=P08.F10

        
       THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  AND P08.F08=0  &&判斷有無修改的權限
       THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)  AND P08.F08=0  &&判斷有無刪除的權限     
       PO_NO=THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE  
       FCH=THISFORM.ACTIVECONTROL.NAME
       JK=THIS.COLUMN1.HEADER1.CAPTION  
       IF THIS.ACTIVEROW=0
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
       ELSE
          THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.
       ENDIF   
       CHK=''     
*       THISFORM.REFRESH
  ENDPROC     
  PROC GRID2.AFTERROWCOLCHANGE
       LPARAMETERS NCOLINDEX
       THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE=P09.F02
       THISFORM.PAGEFRAME1.PAGE2.LBLF021.CAPTION=B01.F02
       THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=P09.F03       
       THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE=P09.F04
       THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE=P09.F05
       THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE=P09.F07
       THISFORM.PAGEFRAME1.PAGE2.TXTF11.VALUE=P09.F11
       THISFORM.PAGEFRAME1.PAGE2.TXTF12.VALUE=P09.F12
       THISFORM.PAGEFRAME1.PAGE2.LBLF061.CAPTION=P09.F06
       THISFORM.PAGEFRAME1.PAGE2.LBLF081.CAPTION=P09.F08
       THISFORM.PAGEFRAME1.PAGE2.LBLF901.CAPTION=P09.F90       
       THISFORM.PAGEFRAME1.PAGE2.LBLF111.CAPTION=C01.F05    
       THISFORM.PAGEFRAME1.PAGE2.LBLF091.CAPTION=IIF(P09.F09='1','OK','NG') 
       THISFORM.PAGEFRAME1.PAGE2.LBLF101.BACKCOLOR=IIF(!P09.F10,RGB(255,255,0),RGB(0,255,0))   
       THISFORM.PAGEFRAME1.PAGE2.LBLF101.CAPTION=IIF(!P09.F10,'否','是')  
       FCH=THISFORM.ACTIVECONTROL.NAME
       JK=THIS.COLUMN1.HEADER1.CAPTION
       CHK=THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
       IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
          THISFORM. CMDGROUP.SEEK_BOTT.ENABLED=.F.
       ENDIF   
       THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.) AND !P09.F10
       THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.) AND !P09.F10
       THISFORM.ANS_BOTT.ENABLED=!P09.F10       
*       THISFORM.REFRESH
  ENDPROC 
  PROCEDURE ORPGROUP.NEW_BOTT.CLICK    
    THISFORM.KEY_LIST.ENABLED=.F. 
    THISFORM.ANS_BOTT.ENABLED=.F.    
    IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1       
       THISFORM.GRID2.RECORDSOURCE=''
       THISFORM.GRID2.CHILDORDER=''
       THISFORM.PAGEFRAME1.PAGE1.SETALL('READONLY',.F.,'TEXTBOX')     &&處理表頭新增
       THISFORM.GRID1.ENABLED=.F.   
       THISFORM.GRID2.ENABLED=.F.          
       IF INT_112=.T.
          HD='P005 '+SUBSTR(DTOS(DATE()),3,4)
          DO ODR_CRT   &&執行主程式新增單號程序
          THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=PO_NO
          THISFORM.PAGEFRAME1.PAGE1.TXTF01.REFRESH
          THISFORM.PAGEFRAME1.PAGE1.TXTF01.READONLY=.T.
          THISFORM.PAGEFRAME1.PAGE1.TXTF02.SETFOCUS    
       ELSE
          THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=''
          THISFORM.PAGEFRAME1.PAGE1.TXTF01.SETFOCUS
       ENDIF                 
        THISFORM.PAGEFRAME1.PAGE2.ENABLED=.F.               
        THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE=DATE()            
        THISFORM.PAGEFRAME1.PAGE1.UPDMNT_TYPE.VISIBLE=.T.    
        THISFORM.PAGEFRAME1.PAGE1.UPDMNT_TYPE.VALUE=2    
        THISFORM.PAGEFRAME1.PAGE1.TXTF03.VALUE=LEFT(THISFORM.PAGEFRAME1.PAGE1.UPDMNT_TYPE.DISPLAYVALUE,1)
        THISFORM.PAGEFRAME1.PAGE1.LBLF031.CAPTION=''  
        
        THISFORM.PAGEFRAME1.PAGE1.TXTF04.READONLY=.F.  
        THISFORM.PAGEFRAME1.PAGE1.TXTF04.VALUE='V0093'
        THISFORM.PAGEFRAME1.PAGE1.LBLF041.CAPTION=IIF(SEEK('V0093','D01'),D01.F04,'')
        THISFORM.PAGEFRAME1.PAGE1.TXTF05.VALUE=IIF(SEEK('V0093','D01'),D01.F08,'')
        THISFORM.PAGEFRAME1.PAGE1.TXTF06.VALUE=''
        THISFORM.PAGEFRAME1.PAGE1.TXTF06.READONLY=.F.
        THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE=SYS_OPER
        THISFORM.PAGEFRAME1.PAGE1.TXTF07.READONLY=.F.          
        THISFORM.PAGEFRAME1.PAGE1.LBLF071.CAPTION=IIF(SEEK(SYS_OPER,'A01'),A01.F03,'')           
  
        THISFORM.PAGEFRAME1.PAGE1.LBLF091.CAPTION='' 
        THISFORM.PAGEFRAME1.PAGE1.LBLF111.CAPTION='' 
        THISFORM.PAGEFRAME1.PAGE1.LBLF12.CAPTION=''
        
        THISFORM.PAGEFRAME1.PAGE1.TXTF10.VALUE=''     

     ELSE
        THISFORM.PAGEFRAME1.PAGE1.ENABLED=.F.              &&處理表身新增
        THISFORM.GRID2.ENABLED=.F.   
        THISFORM.PAGEFRAME1.PAGE2.SETALL('READONLY',.F.,'TEXTBOX')        
        THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE=DATE()
             THISFORM.PAGEFRAME1.PAGE2.TXTF02.READONLY = .F.
              THISFORM.PAGEFRAME1.PAGE2.TXTF02.SETFOCUS
             THISFORM.PAGEFRAME1.PAGE2.TXTF07.READONLY = .F.
             THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE=CTOD('')
        
        
       
        THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE=''          
        THISFORM.PAGEFRAME1.PAGE2.LBLF021.CAPTION=''          
        THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=0
        THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE=CTOD('')
        THISFORM.PAGEFRAME1.PAGE2.LBLF061.CAPTION=''
        
        THISFORM.PAGEFRAME1.PAGE2.LBLF101.CAPTION=''
        THISFORM.PAGEFRAME1.PAGE2.LBLF111.CAPTION=''
        THISFORM.PAGEFRAME1.PAGE2.LBLF901.CAPTION=''
        THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE=''
        THISFORM.PAGEFRAME1.PAGE2.TXTF11.VALUE=''
        THISFORM.PAGEFRAME1.PAGE2.TXTF12.VALUE=''
        THISFORM.PAGEFRAME1.PAGE2.TRANSPORT_TYPE.VISIBLE=.T.    
        THISFORM.PAGEFRAME1.PAGE2.TRANSPORT_TYPE.VALUE=1    
        THISFORM.PAGEFRAME1.PAGE2.RESPONSE_TYPE.VISIBLE=.T.    
        THISFORM.PAGEFRAME1.PAGE2.RESPONSE_TYPE.VALUE=1    
     ENDIF   
  ENDPROC  
  PROCEDURE ORPGROUP.EDIT_BOTT.CLICK
     THISFORM.KEY_LIST.ENABLED=.F. 
     THISFORM.GRID1.ENABLED=.F.   
     THISFORM.GRID2.ENABLED=.F.   
     THISFORM.ANS_BOTT.ENABLED=.F.     
     IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
        SELE P08
        LOCK()
        IF !RLOCK()
           DO FILE_IMPACT
           THISFORM.SHRGROUP.ABANDON_BOTT.CLICK
*           RETURN
        ELSE        
           THISFORM.PAGEFRAME1.PAGE1.SETALL('READONLY',.F.,'TEXTBOX')     &&處理表頭修改
           THISFORM.PAGEFRAME1.PAGE1.UPDMNT_TYPE.VISIBLE=.T.  
           THISFORM.PAGEFRAME1.PAGE1.UPDMNT_TYPE.VALUE=VAL(P08.F03)
           THISFORM.PAGEFRAME1.PAGE1.TXTF01.READONLY=.T.
           THISFORM.PAGEFRAME1.PAGE1.TXTF03.READONLY=.T.
           THISFORM.PAGEFRAME1.PAGE1.TXTF04.READONLY=.T.
           THISFORM.PAGEFRAME1.PAGE1.TXTF07.READONLY=.F.
           THISFORM.PAGEFRAME1.PAGE2.ENABLED=.F.
           THISFORM.PAGEFRAME1.PAGE1.TXTF02.SETFOCUS
        ENDIF   
     ELSE                                                                &&處理表身修改
         
        SELE P09
        RLOCK()
        IF RLOCK()  
           THISFORM.PAGEFRAME1.PAGE2.SETALL('READONLY',.F.,'TEXTBOX') 
           THISFORM.PAGEFRAME1.PAGE2.TXTF04.READONLY=.T.
           THISFORM.PAGEFRAME1.PAGE2.TXTF11.READONLY=.T.
           THISFORM.PAGEFRAME1.PAGE2.RESPONSE_TYPE.VISIBLE=.T. 
           THISFORM.PAGEFRAME1.PAGE2.RESPONSE_TYPE.VALUE=VAL(P09.F09)
           IF P08.F03<>'1'
              THISFORM.PAGEFRAME1.PAGE2.TRANSPORT_TYPE.VISIBLE=.T.  
              THISFORM.PAGEFRAME1.PAGE2.TRANSPORT_TYPE.VALUE=ICASE(F08='海運',1,F08='空運',2,F08='快遞',3,F08='自取',4,F08='直寄',5)
              
              THISFORM.PAGEFRAME1.PAGE2.TXTF05.SETFOCUS   
           ELSE
              THISFORM.PAGEFRAME1.PAGE2.TXTF05.READONLY=.T.
              THISFORM.PAGEFRAME1.PAGE2.TXTF03.SETFOCUS      
           ENDIF   
           
                  
        ELSE
           DO FILE_IMPACT 
           THISFORM.SHRGROUP.ABANDON_BOTT.CLICK
       ENDIF        
     ENDIF   
  ENDPROC    
  PROC ORPGROUP.DEL_BOTT.CLICK                    &&刪除資料程序
       IF MESSAGEBOX('是否確定要刪除此筆資料',4+32+256,'請確認') = 6	        
          IF ALIA()='P08'           &&刪除整張訂單
             SELE P08              
             PO_NO=P08.F01
             SELE RECNO() FROM P09 WHERE P09.F01=P08.F01  INTO ARRAY BK1              
             JJ1=''                
             IF _TALLY>0   
                FOR I= 1 TO ALEN(BK1)
                    JJ1=JJ1+ALLTRIM(STR(BK1(I)))+','
                ENDFOR    
                KK1=STUFF(JJ1,RAT(',',JJ1,1),1,'')              
                RLOCK(KK1,'P09')
                LL1=RLOCK(KK1,'P09')
             ELSE
                   LL1=.T.   
             ENDIF                                            
             IF RLOCK('P08') .AND. LL1  
                PO_NO=P08.F01                    
                DELE FROM P09 WHERE P09.F01=PO_NO
                SELE P08
                DELE
                UNLOCK ALL
                IF INT_112=.T. .AND. SUBSTR(PO_NO,3,4)=SUBSTR(DTOS(DATE()),3,4)                     
                   HD=HD1+SUBSTR(DTOS(DATE()),3,4)+PO_NO
                   DO ODR_RJT
                ENDIF  
             ELSE
                DO FILE_IMPACT 
                RETURN                 
             ENDIF
                    
             THISFORM.GRID1.SETFOCUS
             IF THISFORM.GRID1.ACTIVEROW=0
                THISFORM.CMDGROUP.ENABLED=.F.
                THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=.F.
                THISFORM.ORPGROUP.DEL_BOTT.ENABLED=.F.               
                THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.
             ELSE      
                THISFORM.CMDGROUP.ENABLED=.T.
                THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)  AND P08.F08=0 &&判斷有無修改的權限
                THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)   AND P08.F08=0&&判斷有無刪除的權限
                THISFORM.ORPGROUP.PNT_BOTT.ENABLED=IIF(A02.F07='*',.T.,.F.)   &&判斷有無列印的權限
             ENDIF     
          ELSE        
                 
              IF RLOCK('P09') .AND.  RLOCK('P08')  
                       
                 SELE P09
                 DELE
                 SKIP -1
                 IF BOF()
                    GO TOP
                 ENDIF   
                 THISFORM.ORPGROUP.EDIT_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.) AND !P09.F10   &&判斷有無修改的權限
                THISFORM.ORPGROUP.DEL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)  AND !P09.F10 &&判斷有無刪除的權限
              ELSE
                 DO FILE_IMPACT                  
              ENDIF     
              THISFORM.GRID2.SETFOCUS
              IF THISFORM.GRID2.ACTIVEROW=0
                 SELE P08
                 PO_NO=P08.F01
                 DELETE
                 IF INT_112=.T. .AND. SUBSTR(PO_NO,3,4)=SUBSTR(DTOS(DATE()),3,4)  
                    HD=HD1+SUBSTR(DTOS(DATE()),3,4)+PO_NO
                    DO ODR_RJT  
                 ENDIF
                 SELECT P08
                 SKIP -1
                 IF BOF()
                    GO TOP
                 ENDIF 
                 THISFORM.PAGEFRAME1.ACTIVEPAGE=1 
                 THISFORM.REFRESH          
              ENDIF
          ENDIF
       ENDIF  
       RELEASE ALL LIKE BK* 
  ENDPROC  
  PROCEDURE SHRGROUP.SHURE1_BOTT.CLICK               &&新增確認
    IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
       THISFORM.GRID2.RECORDSOURCE='P09'
       THISFORM.GRID2.CHILDORDER='P091'
	   THISFORM.GRID2.COLUMN1.CONTROLSOURCE='P09.F02'
	   THISFORM.GRID2.COLUMN2.CONTROLSOURCE='B01.F02'
	   THISFORM.GRID2.COLUMN3.CONTROLSOURCE='P09.F03'
	   THISFORM.GRID2.COLUMN4.CONTROLSOURCE='P09.F04'
	   THISFORM.GRID2.COLUMN5.CONTROLSOURCE='P09.F05'
	   THISFORM.GRID2.COLUMN6.CONTROLSOURCE='P09.F06'
       SELE P08 
       COD=SYS(21)
       SET ORDER TO P081
       IF SEEK(THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE,'P08','P081')   &&若有發生單號重複
          IF INT_112=.T.
             SELECT MAX(F01) FROM P08 INTO ARRAY GB NOWAIT           
             HD='P005 '+SUBSTR(DTOS(DATE()),3,4)+THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
             DO ODR_RPT &&執行主程式單據編號重複程序
		     THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE=PO_NO
		     THISFORM.PAGEFRAME1.PAGE1.TXTF01.REFRESH     
		  ELSE
		     =MESSAGEBOX('採購單號重複!',0+48,'提示訊息視窗')
             THISFORM.PAGEFRAME1.PAGE1.TXTF01.SETFOCUS             
             RETURN
		  ENDIF             
       ENDIF
       
         IF  SEEK(THISFORM.PAGEFRAME1.PAGE1.TXTF04.VALUE,'D01')=.F. 
            =MESSAGEBOX('無此廠商編號請先建立!',0+64,'提示訊息視窗')
            THISFORM.PAGEFRAME1.PAGE1.TXTF04.SETFOCUS
            SET ORDER TO &COD
            RETURN                         
          ENDIF   
       IF SEEK(THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE,'A01')=.F.
          =MESSAGEBOX('無此人員編號請重新輸入!',0+64,'提示訊息視窗')
          THISFORM.PAGEFRAME1.PAGE1.TXTF07.SETFOCUS
          SET ORDER TO &COD          
          RETURN
       ENDIF   
       IF EMPTY(THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE)
          =MESSAGEBOX('異動日期不得空白!',0+64,'提示訊息視窗') 
          THISFORM.PAGEFRAME1.PAGE1.TXTF02.SETFOCUS
          SET ORDER TO &COD          
          RETURN
       ENDIF   
       IF EMPTY(THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE)
          =MESSAGEBOX('異動人員不得空白!',0+64,'提示訊息視窗') 
          THISFORM.PAGEFRAME1.PAGE1.TXTF07.SETFOCUS
          SET ORDER TO &COD          
          RETURN
       ENDIF        
       SELE P08          
       APPEND BLANK
       LOCK()
       IF RLOCK()
          REPLACE F01 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
          REPLACE F02 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE
          REPLACE F03 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF03.VALUE
          REPLACE F04 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF04.VALUE
          REPLACE F05 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF05.VALUE
          REPLACE F06 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF06.VALUE
          REPLACE F07 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE
          REPLACE F09 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
          REPLACE F10 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF10.VALUE
         
       ENDIF
*       UNLOCK
       SEEK THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
       SET ORDER TO &COD
       THISFORM.PAGEFRAME1.PAGE1.ENABLED=.F.
       THISFORM.PAGEFRAME1.PAGE2.ENABLED=.T.  
       THISFORM.PAGEFRAME1.ACTIVEPAGE=2
       THISFORM.ORPGROUP.NEW_BOTT.CLICK
       THISFORM.REFRESH
    ELSE                                                                            &&表身新增確認
       
          IF SEEK(THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE+;
             THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE+DTOS(THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE),'D07','D074')=.F.
             =MESSAGEBOX('進貨計劃無此筆資料!',0+48,'提示訊息視窗')
             THISFORM.PAGEFRAME1.PAGE2.TXTF02.SETFOCUS
             RETURN
          ENDIF       
         
       IF SEEK(THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE,'B01')=.F.
          =MESSAGEBOX('物料基本主檔中無此料號!',0+48,'提示訊息視窗')
          THISFORM.PAGEFRAME1.PAGE2.TXTF02.SETFOCUS
          RETURN
       ENDIF   
       IF SEEK(THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE+DTOS(THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE)+DTOS(THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE),'P09')=.T. 
          =MESSAGEBOX('此進貨計劃與希望交期在此張異動單重複!',0+48,'提示訊息視窗')
          THISFORM.PAGEFRAME1.PAGE2.TXTF05.SETFOCUS
          RETURN            
       ENDIF    
       
       IF EMPTY(THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE)
          =MESSAGEBOX('原進貨日不得為空白',0+64,'提示訊息視窗')
          THISFORM.PAGEFRAME1.PAGE2.TXTF04.SETFOCUS
          RETURN
       ENDIF         
       IF EMPTY(THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE)
          =MESSAGEBOX('希望交期不得為空白',0+64,'提示訊息視窗')
          THISFORM.PAGEFRAME1.PAGE2.TXTF05.SETFOCUS
          RETURN
       ENDIF             

       SELE P09
       APPEND BLANK
       LOCK()
       IF RLOCK()
          REPLACE F01 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE
          REPLACE F02 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE
          REPLACE F03 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE
          REPLACE F04 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE
          REPLACE F05 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE
          REPLACE F06 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
          REPLACE F07 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE          
          REPLACE F08 WITH THISFORM.PAGEFRAME1.PAGE2.TRANSPORT_TYPE.DISPLAYVALUE
          REPLACE F09 WITH ALLTRIM(STR(THISFORM.PAGEFRAME1.PAGE2.RESPONSE_TYPE.VALUE))
          REPLACE F11 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF11.VALUE     
          REPLACE F12 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF12.VALUE   
      ENDIF
      SELECT P09
      UNLOCK ALL          
      SEEK THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE+DTOS(THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE)+DTOS(THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE)                   
      THISFORM.GRID2.ENABLED=.T.
      THISFORM.GRID2.SETFOCUS    
      THISFORM.ORPGROUP.NEW_BOTT.CLICK        
     ENDIF
  ENDPROC
  PROCEDURE SHRGROUP.SHURE2_BOTT.CLICK                          &&修改確認
     IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
        IF SEEK(THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE,'A01')=.F.
           =MESSAGEBOX('無此人員編號請重新輸入!',0+48,'提示訊息視窗')
           THISFORM.PAGEFRAME1.PAGE1.TXTF07.SETFOCUS
           RETURN
        ENDIF        
        IF EMPTY(THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE)
           =MESSAGEBOX('異動日期不得空白!',0+48,'提示訊息視窗') 
           THISFORM.PAGEFRAME1.PAGE1.TXTF02.SETFOCUS
           RETURN
        ENDIF   
        SELE P08
        IF RLOCK() 
           REPL F02 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF02.VALUE
           REPLACE F03 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF03.VALUE
           REPL F07 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF07.VALUE
           REPL F09 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')           
           REPL F10 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF10.VALUE
           REPL F05 WITH THISFORM.PAGEFRAME1.PAGE1.TXTF05.VALUE
           UNLOCK ALL
        ELSE
           DO FILE_IMPACT
          RETURN   
       ENDIF    
     ELSE                                                        &&表身修改確認
       IF EMPTY(THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE)
          =MESSAGEBOX('原進貨日不得為空白',0+64,'提示訊息視窗')
          THISFORM.PAGEFRAME1.PAGE2.TXTF04.SETFOCUS
          RETURN
       ENDIF                 
       IF EMPTY(THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE)
          =MESSAGEBOX('希望交期不得為空白',0+64,'提示訊息視窗')
          THISFORM.PAGEFRAME1.PAGE2.TXTF05.SETFOCUS
          RETURN
       ENDIF                
       IF THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE<>P09.F05 
          DTE=P09.F05
          IF SEEK(P08.F01+THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE+DTOS(THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE)+DTOS(THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE),'P09') =.T.
            =MESSAGEBOX('此進貨計劃與希望交期在此張異動單重複!',0+48,'提示訊息視窗')
            THISFORM.PAGEFRAME1.PAGE2.TXTF05.SETFOCUS
            RETURN            
          ENDIF    
          SEEK THISFORM.PAGEFRAME1.PAGE1.TXTF01.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE+THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE+DTOS(THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE)+DTOS(DTE)
       ENDIF 
       IF THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE>P09.F03
          =MESSAGEBOX('異動數量不得大於原進貨計劃數量!',0+48,'提示訊息視窗')
          THISFORM.PAGEFRAME1.PAGE2.TXTF03.SETFOCUS
          RETURN
       ENDIF
       SELE P09   
           REPLACE F03 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE
           REPLACE F05 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE
           REPLACE F08 WITH THISFORM.PAGEFRAME1.PAGE2.TRANSPORT_TYPE.DISPLAYVALUE
           REPLACE F06 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')    
           REPLACE F07 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE       
           REPLACE F09 WITH ALLTRIM(STR(THISFORM.PAGEFRAME1.PAGE2.RESPONSE_TYPE.VALUE))     
           REPLACE F12 WITH THISFORM.PAGEFRAME1.PAGE2.TXTF12.VALUE       
           UNLOCK ALL
                         
    ENDIF   
    THISFORM.SHRGROUP.ABANDON_BOTT.CLICK    
  ENDPROC   
  PROCEDURE SHRGROUP.ABANDON_BOTT.CLICK
      THISFORM.SHRGROUP.ENABLED=.F.
      THISFORM.SHRGROUP.VISIBLE=.F.      
      THISFORM.ORPGROUP.ENABLED=.T.
      THISFORM.ORPGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
      THISFORM.CMDGROUP.ENABLED=.T.
      THISFORM.CMDGROUP.SETALL('ENABLED',.T.,'COMMANDBUTTON')
      THISFORM.CMDGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
      THISFORM.SETALL('READONLY',.T.,'TEXTBOX')  
      THISFORM.PAGEFRAME1.PAGE1.SETALL('READONLY',.T.,'TEXTBOX')  
      THISFORM.PAGEFRAME1.PAGE2.SETALL('READONLY',.T.,'TEXTBOX') 
      THISFORM.PAGEFRAME1.PAGE1.UPDMNT_TYPE.VISIBLE=.F.
      THISFORM.PAGEFRAME1.PAGE2.TRANSPORT_TYPE.VISIBLE=.F.
      THISFORM.PAGEFRAME1.PAGE2.RESPONSE_TYPE.VISIBLE=.F.
      THISFORM.PAGEFRAME1.PAGE1.TXTF04.READONLY=.T.
      THISFORM.PAGEFRAME1.PAGE1.TXTF06.READONLY=.T.
      THISFORM.PAGEFRAME1.PAGE1.TXTF07.READONLY=.T.
      THISFORM.PAGEFRAME1.PAGE2.TXTF02.READONLY=.T.
      THISFORM.PAGEFRAME1.PAGE2.TXTF07.READONLY=.T.
       
      THISFORM.PAGEFRAME1.PAGE1.ENABLED=.T.
      THISFORM.PAGEFRAME1.PAGE2.ENABLED=.T.
      IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1    
          THISFORM.GRID1.ENABLED=.T.
          THISFORM.GRID2.ENABLED=.T.       
         THISFORM.GRID1.SETFOCUS
         THISFORM.KEY_LIST.ENABLED=.T.
      ELSE
          THISFORM.GRID1.ENABLED=.F.
          THISFORM.GRID2.ENABLED=.T.       
         THISFORM.GRID2.SETFOCUS
         IF THISFORM.GRID2.ACTIVEROW=0         
            IF INT_112=.T.
               HD='P005 '+SUBSTR(DTOS(DATE()),3,4)+P08.F01
               DO ODR_RJT
            ENDIF   
            SELE P08               
            DELE
            SKIP -1
            IF BOF()
               GO TOP
            ENDIF               
            THISFORM.PAGEFRAME1.ACTIVEPAGE=1
            THISFORM.REFRESH
         ENDIF   
      ENDIF       
      UNLOCK ALL
  ENDPROC
  PROCEDURE SHRGROUP.FINISH_BOTT.CLICK
      IF THISFORM.PAGEFRAME1.ACTIVEPAGE=1
         IF THISFORM.GRID2.RECORDSOURCE<>'P09'
            THISFORM.GRID2.RECORDSOURCE='P09'
            THISFORM.GRID2.CHILDORDER='P091'
            THISFORM.GRID2.COLUMN1.CONTROLSOURCE='P09.F02'
	        THISFORM.GRID2.COLUMN2.CONTROLSOURCE='B01.F02'
	        THISFORM.GRID2.COLUMN3.CONTROLSOURCE='P09.F03'
	        THISFORM.GRID2.COLUMN4.CONTROLSOURCE='P09.F04'
	        THISFORM.GRID2.COLUMN5.CONTROLSOURCE='P09.F05'
	        THISFORM.GRID2.COLUMN6.CONTROLSOURCE='P09.F06'
	     ENDIF                   
	      IF INT_112=.T.
             HD='P005 '+SUBSTR(DTOS(DATE()),3,4)+PO_NO
             DO ODR_RJT
          ENDIF  
          SELE P08
         DO CASE 
            CASE THISFORM.KEY_LIST.DISPLAYVALUE='依異動單號排列'
                 SET ORDER TO P081
            CASE THISFORM.KEY_LIST.DISPLAYVALUE='依需求對象排列'
                 SET ORDER TO P082
            CASE THISFORM.KEY_LIST.DISPLAYVALUE='依需求單號排列'
                 SET ORDER TO P083
         ENDCASE   

       ENDIF  
       THISFORM.SHRGROUP.ABANDON_BOTT.CLICK
  ENDPROC     
  PROC ANS_BOTT.CLICK                  &&確認此張異動單
       IF MESSAGEBOX('是否確認資料無誤?',4+32+256,'請確認') = 6	 
          SELE P09
          IF RLOCK()        
             FNTCHG1="<font color='blue'>"
             FNTCHG2="</font>"
             IF !USED('P05')
                SELECT 0
                USE P05
             ELSE
                SELECT P05
             ENDIF
             SET ORDER TO 1    
             IF P09.F09='1'   &&如果是OK
                SELECT D07
                SEEK P09.F07+P09.F02+DTOS(P09.F04)
                IF FOUND() AND F04>=P09.F03 AND F06=0    
                       
                   IF !USED('P07')
                      SELECT 0
                      USE P07
                   ELSE
                      SELECT P07
                   ENDIF
                   SET ORDER TO 1      
                   IF !USED('P03')
                      SELECT 0
                      USE P03
                   ELSE
                      SELECT P03
                   ENDIF
                   SET ORDER TO 1               
                   IF !USED('P38')
                      SELECT 0
                      USE P38
                   ELSE
                      SELECT P38
                   ENDIF
                   SET ORDER TO 1         
                   IF P08.F03='1'  &&如果是取消                                
                      IF !USED('P04')   &&寫入採購訂單
                         SELECT 0
                         USE P04
                      ELSE
                         SELECT P04
                      ENDIF
                      SET ORDER TO 1                                                      
                      SEEK P09.F07+P09.F02
                      IF FOUND()
                         REPLACE F09 WITH F09+P09.F03*(-1)
                         REPLACE F16 WITH F16+P09.F03
                      ENDIF       
                      SELECT P04
                      USE               
                   ENDIF                      
                   SELECT D07
                   IF P08.F03='1'   &&如果是取消
                      IF F09='1'    &&而且已回覆過
                         SELECT P38
                         APPEND BLANK                      
                         REPLACE F01 WITH P09.F07
                         REPLACE F02 WITH P09.F02
                         REPLACE F03 WITH P09.F04
                         REPLACE F04 WITH D07.F04
                         REPLACE F05 WITH P09.F05
                         REPLACE F06 WITH D07.F04-P09.F03
                         REPLACE F07 WITH D07.F07
                         REPLACE F08 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'') 
                         REPLACE F09 WITH D07.F11
                         REPLACE F10 WITH P09.F01
                         IF ALLTRIM(INT_DNS) <> 'FALSE' AND ALLTRIM(INT_MAI) <> 'FALSE' AND !EMPTY(P09.F11)
                            MAIL_TEXT = ''
                            TMPCHR='<br/>'
                            WAIT WINDOW "傳送郵件,請稍後!" AT 0,150 NOWAIT NOCLEAR                             
                            MAIL_TEXT = '採購單號：' + D07.F01 + TMPCHR + ;
     	           		                '料品編號：' + D07.F02 + TMPCHR + ;
     	         	   	                '進貨日期：' + DTCX(D07.F03) + TMPCHR + ;
     	        		                '進貨數量：' + FNTCHG1 + ALLTRIM(TRANSFORM(D07.F04,'@R 999,999,999,999'))  + '  ＞＞  ' + ALLTRIM(TRANSFORM(D07.F04-P09.F03,'@R 999,999,999,999')) + FNTCHG2 + TMPCHR + ;
     	         		                '運貨方式：' + D07.F13 + TMPCHR + ;
     	         	   	                '備註說明：' + ALLTRIM(D07.F17) + TMPCHR + ;
     	         		                '來源單號：' + IIF(SEEK(LEFT(D07.F07,10),'P05'),P05.F06,'') + TMPCHR + ;
     	         		                '採購用途：' + ALLTRIM(D07.F07) + SPACE(2) + P09.F11 + CHR(13) + CHR(10)
     	       
     	                    ***傳送給業務助理                            
                            IF SEEK(P09.F11,'C01') AND SEEK(C01.F23,'A01') = .T. AND ALLTRIM(A01.F06) = 'Y' AND AT('@',A01.F10) <> 0  AND EMPTY(MAIL_TEXT) = .F.                                                                      
                                  FILE_NAME=ALLTRIM(INT_DAT)+ALLTRIM(C01.F23)+'.TXT'                                                    
                                  STRTOFILE('<TR><TD>'+MAIL_TEXT+'<TD>已取消數量<TD>'+TTOC(DATETIME())+ CHR(13) + CHR(10) ,FILE_NAME,1)
                            ENDIF    		  
                            ***傳送給業務B 
                            IF  SEEK(P09.F11,'C01') AND SEEK(C01.F33,'A01') = .T. AND ALLTRIM(A01.F06) = 'Y' AND AT('@',A01.F10) <> 0 AND EMPTY(MAIL_TEXT) = .F.                                      
                               IF C01.F23<>C01.F33                                                                    
                                     FILE_NAME=ALLTRIM(INT_DAT)+ALLTRIM(C01.F33)+'.TXT'                                                       
                                     STRTOFILE('<TR><TD>'+MAIL_TEXT+'<TD>已取消數量<TD>'+TTOC(DATETIME())+ CHR(13) + CHR(10) ,FILE_NAME,1)                                                                       
                               ENDIF                                
                            ENDIF   
                            WAIT CLEAR 
                         ENDIF   
                      ENDIF   
                      SELECT D07
                      IF F04=P09.F03  &&而且異動單數量與該筆進貨計劃數量相同
                         DELETE
                      ELSE
                         REPLACE F04 WITH F04+P09.F03*(-1)  &&如果小於原進貨計劃數量則扣除刪除量                          
                         REPLACE F17 WITH SUBSTR(P09.F01,5,6)+' '+ALLTRIM(P09.F12)+' '+ALLTRIM(F17)                          
                      ENDIF                         
                   ELSE              &&如果非取消
                      IF D07.F09<>'1'   &&如果未回覆過交期
                         IF !USED('P04')   &&寫入採購訂單
                            SELECT 0
                            USE P04
                         ELSE
                            SELECT P04
                         ENDIF
                         SET ORDER TO 1                                                      
                         SEEK P09.F07+P09.F02
                         IF FOUND()                             
                            REPLACE F22 WITH F22+P09.F03   &&寫入採購單表身已回覆量
                         ENDIF       
                         SELECT P04
                         USE                                                     
                         SELE P07
                         SEEK LEFT(D07.F07,10)+D07.F02    &&刪除待處理請購明細資料
                         IF FOUND()
                            REPL F07 WITH F07+P09.F03*(-1)
                            REPL F11 WITH F11+P09.F03*(-1)  
                            IF F07<=0
                               DELE
                            ENDIF   
                         ENDIF
                      ENDIF   
                      IF ALLTRIM(INT_DNS) <> 'FALSE' AND ALLTRIM(INT_MAI) <> 'FALSE' AND !EMPTY(P09.F11)
                         MAIL_TEXT = ''
                         TMPCHR='<br/>'
                         WAIT WINDOW "傳送郵件,請稍後!" AT 0,150 NOWAIT NOCLEAR                             
                         MAIL_TEXT = '採購單號：' + D07.F01 + TMPCHR + ;
     	           		             '料品編號：' + D07.F02 + TMPCHR + ;
     	         	   	             '進貨日期：' + IIF(D07.F03<>P09.F05 AND D07.F04=P09.F03,FNTCHG1+DTCX(D07.F03)+ '  ＞＞  ','')+IIF(D07.F04<>P09.F03 AND D07.F09='1',DTCX(D07.F03),DTCX(P09.F05))+IIF(D07.F03<>P09.F05 AND D07.F04=P09.F03,FNTCHG2,'') + TMPCHR + ;
     	        		             '進貨數量：' + IIF(D07.F04<>P09.F03,FNTCHG1+ALLTRIM(TRANSFORM(D07.F04,'@R 999,999,999,999')) + '  ＞＞  ','')+ALLTRIM(TRANSFORM(IIF((D07.F04<>P09.F03 AND D07.F09='1'),D07.F04-P09.F03,P09.F03),'@R 999,999,999,999'))+IIF(D07.F04<>P09.F03,FNTCHG2,'')  + TMPCHR + ;
     	         		             '運貨方式：' + IIF(D07.F09='1' AND D07.F04<>P09.F03,D07.F13,IIF(D07.F13<>P09.F08 AND D07.F04=P09.F03 ,FNTCHG1+D07.F13+ '  ＞＞  ','')+ P09.F08+IIF(D07.F13<>P09.F08,FNTCHG2,''))+ TMPCHR + ;
     	         	   	             '備註說明：' + ALLTRIM(D07.F17) + TMPCHR + ;
     	         		             '來源單號：' + IIF(SEEK(LEFT(D07.F07,10),'P05'),P05.F06,'') + TMPCHR + ;
     	         		             '採購用途：' + ALLTRIM(D07.F07) + SPACE(2) + P09.F11 + CHR(13) + CHR(10)     	       
     	                 ***傳送給業務助理                            
                         IF SEEK(P09.F11,'C01') AND SEEK(C01.F23,'A01') = .T. AND ALLTRIM(A01.F06) = 'Y' AND AT('@',A01.F10) <> 0  AND EMPTY(MAIL_TEXT) = .F.                                                                      
                            FILE_NAME=ALLTRIM(INT_DAT)+ALLTRIM(C01.F23)+'.TXT'                                                    
                            STRTOFILE('<TR><TD>'+MAIL_TEXT+'<TD'+IIF(D07.F09='1' AND D07.F03<P09.F05,' bgcolor="#FF0000"' ,'')+'>'+IIF(D07.F09='1','已更新計劃','已確認交期')+'<TD>'+TTOC(DATETIME())+ CHR(13) + CHR(10) ,FILE_NAME,1)
                            
                         ENDIF    		  
                         ***傳送給業務B 
                         IF SEEK(P09.F11,'C01') AND SEEK(C01.F33,'A01') = .T. AND ALLTRIM(A01.F06) = 'Y' AND AT('@',A01.F10) <> 0 AND EMPTY(MAIL_TEXT) = .F.                                      
                            IF C01.F23<>C01.F33                                                                    
                               FILE_NAME=ALLTRIM(INT_DAT)+ALLTRIM(C01.F33)+'.TXT'                                                       
                              ** STRTOFILE('<TR><TD>'+MAIL_TEXT+'<TD>'+IIF(D07.F09='1','已更新計劃','已確認交期')+'<TD>'+TTOC(DATETIME())+ CHR(13) + CHR(10) ,FILE_NAME,1)        
                               STRTOFILE('<TR><TD>'+MAIL_TEXT+'<TD'+IIF(D07.F09='1' AND D07.F03<P09.F05,' bgcolor="#FF0000"' ,'')+'>'+IIF(D07.F09='1','已更新計劃','已確認交期')+'<TD>'+TTOC(DATETIME())+ CHR(13) + CHR(10) ,FILE_NAME,1)                                                               
                            ENDIF                                
                         ENDIF   
                         WAIT CLEAR 
                      ENDIF 
                         
                       
                         
                      
                      SELECT D07
                      IF F04=P09.F03        &&原進貨計劃量與異動數量相同
                         SEEK P09.F07+P09.F02+DTOS(P09.F05)                         
                         IF FOUND()
                            REPLACE F04 WITH F04+P09.F03                                   
                            REPLACE F08 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')  
                            IF !EMPTY(ALLTRIM(P09.F12))
                                REPLACE F17 WITH SUBSTR(P09.F01,5,6)+' '+ALLTRIM(P09.F12)+' '+ALLTRIM(F17)
                            ENDIF                                        
                            SEEK P09.F07+P09.F02+DTOS(P09.F04)
                            IF FOUND()
                               DELETE
                            ENDIF
                         ELSE
                            SEEK P09.F07+P09.F02+DTOS(P09.F04)
                            IF FOUND()
                               REPLACE F03 WITH P09.F05    &&判定為只改交期
                               REPLACE F09 WITH '1'
                               REPLACE F08 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
                               REPLACE F13 WITH P09.F08
                               REPLACE F14 WITH IIF(P08.F03<>'3','4','')
                               REPLACE F15 WITH DATE()                                
                               REPLACE F17 WITH SUBSTR(P09.F01,5,6)+' '+ALLTRIM(P09.F12)+' '+ALLTRIM(F17)
                                
                            ENDIF   
                         ENDIF   
                         SEEK P09.F07+P09.F02+DTOS(P09.F05) 
                         IF P08.F03<>'3'                  &&如果非詢問交期
                            SELECT P38
                            APPEND BLANK                      
                            REPLACE F01 WITH P09.F07
                            REPLACE F02 WITH P09.F02
                            REPLACE F03 WITH P09.F04
                            REPLACE F04 WITH P09.F03
                            REPLACE F05 WITH P09.F05
                            REPLACE F06 WITH P09.F03
                            REPLACE F07 WITH D07.F07
                            REPLACE F08 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'') 
                            REPLACE F09 WITH D07.F11
                            REPLACE F10 WITH P09.F01
                         ENDIF   
                      ELSE                           &&異動量小於原進貨計劃量
                         IF D07.F09='1'   &&如果已回覆過交期
                            SELECT P38
                            APPEND BLANK                      
                            REPLACE F01 WITH P09.F07
                            REPLACE F02 WITH P09.F02
                            REPLACE F03 WITH P09.F04
                            REPLACE F04 WITH D07.F04
                            REPLACE F05 WITH P09.F04
                            REPLACE F06 WITH D07.F04-P09.F03
                            REPLACE F07 WITH D07.F07
                            REPLACE F08 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'') 
                            REPLACE F09 WITH D07.F11
                            REPLACE F10 WITH P09.F01                         
                         ENDIF   
                         SELECT D07                         
                         REPLACE F04 WITH F04+P09.F03*(-1)   &&則縮減原進貨計劃數量                          
                         FLG=F09                                                
                         CHK_STR=F07
                         UKEF=F10
                         DTE=F11
                         SEEK P09.F07+P09.F02+DTOS(P09.F05)   
                         IF FOUND()
                            IF F09='1'
                               SELECT P38
                               APPEND BLANK                      
                               REPLACE F01 WITH P09.F07
                               REPLACE F02 WITH P09.F02
                               REPLACE F03 WITH P09.F04
                               REPLACE F04 WITH D07.F04
                               REPLACE F05 WITH P09.F05
                               REPLACE F06 WITH D07.F04+P09.F03
                               REPLACE F07 WITH D07.F07
                               REPLACE F08 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'') 
                               REPLACE F09 WITH D07.F11
                               REPLACE F10 WITH P09.F01                               
                            ENDIF                               
                            SELECT D07
                            REPLACE F04 WITH F04+P09.F03    &&並加入到別筆與異動日期相同之進貨計劃      
                            IF F09='0'
                               REPLACE F09 WITH '1'
                               REPLACE F08 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')    
                               REPLACE F13 WITH P09.F08                                       
                               REPLACE F17 WITH SUBSTR(P09.F01,5,6)+' '+ALLTRIM(P09.F12)+' '+ALLTRIM(F17)                                                                             
                            ENDIF                         
                         ELSE                               &&若無別筆與異動日期相同之進貨計劃                            
                            SELECT D07
                            APPEND BLANK                    &&新增一筆進貨計劃                            
                            REPLACE F01 WITH P09.F07
                            REPLACE F02 WITH P09.F02
                            REPLACE F03 WITH P09.F05
                            REPLACE F04 WITH P09.F03
                            REPLACE F16 WITH P09.F11
                            REPLACE F05 WITH P08.F04
                            REPLACE F07 WITH CHK_STR
                            REPLACE F08 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'') 
                            REPLACE F09 WITH '1'
                            REPLACE F10 WITH UKEF
                            REPLACE F11 WITH DTE
                            REPLACE F13 WITH P09.F08
                            REPLACE F14 WITH IIF(P08.F03<>'3','4','')
                            REPLACE F15 WITH DATE()                            
                            REPLACE F17 WITH SUBSTR(P09.F01,5,6)+' '+ALLTRIM(P09.F12)+' '+ALLTRIM(F17)                                                   
                            IF FLG='1'
                               SELECT P38
                               APPEND BLANK                      
                               REPLACE F01 WITH P09.F07
                               REPLACE F02 WITH P09.F02
                               REPLACE F03 WITH P09.F04
                               REPLACE F04 WITH P09.F03
                               REPLACE F05 WITH P09.F05
                               REPLACE F06 WITH P09.F03
                               REPLACE F07 WITH CHK_STR
                               REPLACE F08 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'') 
                               REPLACE F09 WITH DTE
                               REPLACE F10 WITH P09.F01       
                               IF ALLTRIM(INT_DNS) <> 'FALSE' AND ALLTRIM(INT_MAI) <> 'FALSE' AND !EMPTY(P09.F11)
                                  MAIL_TEXT = ''
                                  TMPCHR='<br/>'
                                  WAIT WINDOW "傳送郵件,請稍後!" AT 0,150 NOWAIT NOCLEAR                             
                                  MAIL_TEXT = '採購單號：' + D07.F01 + TMPCHR + ;
     	           		                      '料品編號：' + D07.F02 + TMPCHR + ;
     	         	   	                      '進貨日期：' + FNTCHG1+DTCX(P09.F04)+ '  ＞＞  '+DTCX(P09.F05)+FNTCHG2 + TMPCHR + ;
     	        		                      '進貨數量：' + ALLTRIM(TRANSFORM(P09.F03,'@R 999,999,999,999')) + TMPCHR + ;
     	         		                      '運貨方式：' + P09.F08 + TMPCHR + ;
     	         	   	                      '備註說明：' + ALLTRIM(D07.F17) + TMPCHR + ;
     	         		                      '來源單號：' + IIF(SEEK(LEFT(D07.F07,10),'P05'),P05.F06,'') + TMPCHR + ;
     	         		                      '異動備註：' + P09.F01+' '+ALLTRIM(P09.F12)+ TMPCHR + ;
     	         		                      '採購用途：' + ALLTRIM(D07.F07) + SPACE(2) + P09.F11 + CHR(13) + CHR(10)     	       
     	                          ***傳送給業務助理                            
                                  IF SEEK(P09.F11,'C01') AND SEEK(C01.F23,'A01') = .T. AND ALLTRIM(A01.F06) = 'Y' AND AT('@',A01.F10) <> 0  AND EMPTY(MAIL_TEXT) = .F.                                                                      
                                     FILE_NAME=ALLTRIM(INT_DAT)+ALLTRIM(C01.F23)+'.TXT'                                                    
                                     STRTOFILE('<TR><TD>'+MAIL_TEXT+'<TD>已新增進貨計劃<TD>'+TTOC(DATETIME())+ CHR(13) + CHR(10) ,FILE_NAME,1)
                                  ENDIF    		  
                                  ***傳送給業務B 
                                  IF SEEK(P09.F11,'C01') AND SEEK(C01.F33,'A01') = .T. AND ALLTRIM(A01.F06) = 'Y' AND AT('@',A01.F10) <> 0 AND EMPTY(MAIL_TEXT) = .F.                                      
                                     IF C01.F23<>C01.F33                                                                    
                                        FILE_NAME=ALLTRIM(INT_DAT)+ALLTRIM(C01.F33)+'.TXT'                                                       
                                        STRTOFILE('<TR><TD>'+MAIL_TEXT+'<TD>已新增進貨計劃<TD>'+TTOC(DATETIME())+ CHR(13) + CHR(10) ,FILE_NAME,1)                                                                       
                                     ENDIF                                
                                  ENDIF   
                                  WAIT CLEAR 
                               ENDIF                                                                                
                            ENDIF   
                         ENDIF
                      ENDIF
                   ENDIF   
                   SELECT P07
                   USE
                   SELECT P03
                   USE
                   SELECT P38
                   USE      
                   SELECT P08
                   REPLACE F08 WITH F08+1
                   SELE P09
                   REPLACE F10 WITH .T.
                   REPLACE F90 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'') 
                ELSE
                   =MESSAGEBOX('此筆進貨計劃已被異動過或是有開單未進量，請刪除此筆再新增以抓取相關進貨計劃異動',0+48,'提示訊息是窗')
                      
                ENDIF
             ELSE   &&如果不OK
                SELECT D07
                SEEK P09.F07+P09.F02+DTOS(P09.F04)
                IF FOUND()                   
                   
                   IF ALLTRIM(INT_DNS) <> 'FALSE' AND ALLTRIM(INT_MAI) <> 'FALSE' AND !EMPTY(P09.F11)
                            MAIL_TEXT = ''
                            TMPCHR='<br/>'
                            WAIT WINDOW "傳送郵件,請稍後!" AT 0,150 NOWAIT NOCLEAR                             
                            MAIL_TEXT = '採購單號：' + D07.F01 + TMPCHR + ;
     	           		                '料品編號：' + D07.F02 + TMPCHR + ;
     	         	   	                '進貨日期：' + DTCX(D07.F03) + TMPCHR + ;
     	        		                '進貨數量：' + ALLTRIM(TRANSFORM(D07.F04,'@R 999,999,999,999'))  + TMPCHR + ;
     	         		                '運貨方式：' + D07.F13 + TMPCHR + ;
     	         	   	                '備註說明：' + ALLTRIM(D07.F17) + TMPCHR + ;
     	         		                '來源單號：' + IIF(SEEK(LEFT(D07.F07,10),'P05'),P05.F06,'') + TMPCHR + ;
     	         		                '異動備註：' + P09.F01+' '+ALLTRIM(P09.F12)+ TMPCHR + ;
     	         		                '採購用途：' + ALLTRIM(D07.F07) + SPACE(2) + P09.F11 + CHR(13) + CHR(10)
     	       
     	                    ***傳送給業務助理                            
                            IF SEEK(P09.F11,'C01') AND SEEK(C01.F23,'A01') = .T. AND ALLTRIM(A01.F06) = 'Y' AND AT('@',A01.F10) <> 0  AND EMPTY(MAIL_TEXT) = .F.                                                                      
                                  FILE_NAME=ALLTRIM(INT_DAT)+ALLTRIM(C01.F23)+'.TXT'                                                    
                                  STRTOFILE('<TR><TD>'+MAIL_TEXT+'<TD>'+ICASE(D07.F14='1','提前',D07.F14='2','延後',D07.F14='3','取消','')+'異動申請NG'+'<TD>'+TTOC(DATETIME())+ CHR(13) + CHR(10) ,FILE_NAME,1)
                            ENDIF    		  
                            ***傳送給業務B 
                            IF  SEEK(P09.F11,'C01') AND SEEK(C01.F33,'A01') = .T. AND ALLTRIM(A01.F06) = 'Y' AND AT('@',A01.F10) <> 0 AND EMPTY(MAIL_TEXT) = .F.                                      
                               IF C01.F23<>C01.F33                                                                    
                                     FILE_NAME=ALLTRIM(INT_DAT)+ALLTRIM(C01.F33)+'.TXT'                                                       
                                     STRTOFILE('<TR><TD>'+MAIL_TEXT+'<TD>'+ICASE(D07.F14='1','提前',D07.F14='2','延後',D07.F14='3','取消','')+'異動申請NG'+'<TD>'+TTOC(DATETIME())+ CHR(13) + CHR(10) ,FILE_NAME,1)                                                                       
                               ENDIF                                
                            ENDIF   
                            WAIT CLEAR 
                         ENDIF   
                    SELECT D07     
                    REPLACE F08 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
                    REPLACE F14 WITH '4'
                    REPLACE F15 WITH DATE()    
                    IF !EMPTY(ALLTRIM(P09.F12))
                        REPLACE F17 WITH SUBSTR(P09.F01,5,6)+' '+ALLTRIM(P09.F12)+' '+ALLTRIM(F17)
                    ENDIF
                ENDIF
                SELECT P08
                REPLACE F08 WITH F08+1
                SELE P09
                REPLACE F10 WITH .T.
                REPLACE F90 WITH DTCX(DATE())+IIF(SEEK(sys_oper,'A01'),A01.F03,'')
             ENDIF
             SELECT P05
             USE
          ELSE    
               DO FILE_IMPACT
               RETURN
          ENDIF    
       ENDIF   
       UNLOCK ALL
       SELECT P09
       THISFORM.GRID2.SETFOCUS
   ENDPROC
   PROC EXCEL_BOTT.CLICK
       PO_NO=P08.F01
         
        FILENAME='採購異動'+PO_NO
           SELECT P08.F01 異動單號,P08.F02 異動日期,ICASE(P08.F03='1','取消訂單',P08.F03='2','交期變更',P08.F03='3','詢問交期') 異動類別,P08.F04 廠商編號,D01.F04 廠商簡稱,P08.F05 連絡人,;
           P08.F06 異動原因,P08.F10 備註說明,P09.F02 料品編號,P09.F03 數量,P09.F04 原定交期,P09.F05 希望交期,P09.F07 採購單號,P09.F08 運送方式,P09.F11 客戶編號,C01.F05 客戶簡稱,;
           P09.F12 表身備註 FROM P08,P09,D01,C01 WHERE P08.F01=PO_NO AND P09.F01=PO_NO AND D01.F01=P08.F04 AND C01.F01=P09.F11;
           INTO CURSOR P05_K ORDER BY P08.F01,P09.F02 NOWAIT
           IF _TALLY>0
	    	   GCDELIMFILE=PUTFILE('儲存路徑',FILENAME,'XLS')
		       IF !EMPTY(GCDELIMFILE) 
		          ON ERROR DO FILE_IMPACT
		          COPY TO (GCDELIMFILE) TYPE XL5     
		           =MESSAGEBOX('儲存成功',0+48,'提示訊息視窗') 
		       ENDIF 
		   
		   ENDIF        
        	  
       SELECT P08                       
       THISFORM.GRID1.SETFOCUS
   ENDPROC        
 
ENDDEFINE    

***********************************************列印程序
PROCEDURE PNT_PRC  
     LK=P08.F01     
     SELECT P09.F01,;
            P09.F02,;
            P09.F03,;
            P09.F04,;
            P09.F05,;     
            P09.F07,;
            P09.F08,;      
            P08.F02,;
            P08.F03,;
            P08.F04,;                    
            P08.F05,;           
            P08.F10;           
     FROM P09,P08 WHERE P09.F01=LK AND P08.F01=LK  ;
     ORDER BY P09.F02,P09.F07,P09.F04,P09.F05 NOWAIT
     IF _TALLY >0
	 *     REPORT FORM ALLTRIM(INT_116)+'P05' PREVIEW
         REPORT FORM ALLTRIM(INT_116)+'P05' TO PRINTER PROMPT     
       SELECT P08
       REPLACE F11 WITH F11+1
     ENDIF  
 
ENDPROC
************************************************特殊輸入欄位的設定----料號    
DEFINE CLASS TXTF02 AS TEXTBOX
  READONLY=.T.
  MAXLENGTH=43
  FONTSIZE=INT_015*9
  PROCEDURE INTERACTIVECHANGE
    IF AT('?',ALLTRIM(THIS.VALUE))<>0
       DO CASE
          CASE AT('?',ALLTRIM(THIS.VALUE))>1 .AND. EMPTY(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE))                   
               SELECT F01,F02,F03,F04,F13,F16,F07,F17 FROM D07 INTO CURSOR OQT; 
               WHERE LEFT(D07.F02,AT('?',THIS.VALUE)-1)=LEFT(THIS.VALUE,AT('?',THIS.VALUE)-1) AND F05=THISFORM.PAGEFRAME1.PAGE1.TXTF04.VALUE AND F09=IIF(P08.F03='3','0','1') ORDER BY F02,F03             
          CASE AT('?',ALLTRIM(THIS.VALUE))>1 .AND. !EMPTY(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE))                
               SELECT D07.F01,D07.F02,D07.F03,D07.F04,D07.F13,D07.F16,D07.F07,D07.F17 FROM D07 INTO CURSOR OQT; 
               WHERE D07.F05=THISFORM.PAGEFRAME1.PAGE1.TXTF04.VALUE  AND D07.F01=THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE;
               AND LEFT(D07.F02,AT('?',THIS.VALUE)-1)=LEFT(THIS.VALUE,AT('?',THIS.VALUE)-1) AND F09=IIF(P08.F03='3','0','1') ORDER BY F02,F03                              
          CASE AT('?',ALLTRIM(THIS.VALUE))=1 .AND. EMPTY(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE))                   
               SELECT F01,F02,F03,F04,F13,F16,F07,F17 FROM D07 INTO CURSOR OQT WHERE F05=P08.F04 AND F09=IIF(P08.F03='3','0','1')  ORDER BY F02,F03                
          CASE AT('?',ALLTRIM(THIS.VALUE))=1 .AND. !EMPTY(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE))                  
               SELECT D07.F01,D07.F02,D07.F03,D07.F04,D07.F13,D07.F16,D07.F07,D07.F17 FROM D07 INTO CURSOR OQT; 
               WHERE  D07.F01=THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE AND F09=IIF(P08.F03='3','0','1') ORDER BY F02,F03
                           
       ENDCASE 
       IF _TALLY>0  
          OQT_SEEK=CREATEOBJECT("OQT_SEEK")  
          OQT_SEEK.SHOW    
          IF LEN(ALLTRIM(CHK_STR))>1
             THIS.VALUE=CHK_STR
             THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE=FLG
             THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=QTY
             THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE=DTE
             THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE=DTE
             THISFORM.PAGEFRAME1.PAGE2.TXTF11.VALUE=CUS
             THISFORM.PAGEFRAME1.PAGE2.LBLF081.CAPTION=UKEF
             THISFORM.PAGEFRAME1.PAGE2.TRANSPORT_TYPE.VALUE=ICASE(UKEF='海運',1,UKEF='空運',2,UKEF='快遞',3,UKEF='自取',4,UKEF='直寄',5)
             THISFORM.PAGEFRAME1.PAGE2.LBLF111.CAPTION=IIF(SEEK(CUS,'C01'),C01.F05,'')
             THIS.REFRESH                    
              
             FLG='0'      
             DTE=CTOD('')     
             CHK_STR=''
             UKEF=''
             QTY=0    
             CUS=''
          ENDIF   
       ENDIF
    ELSE
       IF !EMPTY(THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE)
          THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=IIF(SEEK(THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE+THIS.Value,'D07'),D07.F04,0)
          THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE=IIF(SEEK(THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE+THIS.Value,'D07'),D07.F03,CTOD('')) 
          THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE=IIF(SEEK(THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE+THIS.Value,'D07'),D07.F03,CTOD('')) 
          THISFORM.PAGEFRAME1.PAGE2.TXTF11.VALUE=IIF(SEEK(THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE+THIS.Value,'D07'),D07.F16,'') 
          UKEF=IIF(SEEK(THISFORM.PAGEFRAME1.PAGE2.TXTF07.VALUE+THIS.Value,'D07'),D07.F13,'') 
          THISFORM.PAGEFRAME1.PAGE2.LBLF081.CAPTION=UKEF
          THISFORM.PAGEFRAME1.PAGE2.TRANSPORT_TYPE.VALUE=ICASE(UKEF='海運',1,UKEF='空運',2,UKEF='快遞',3,UKEF='自取',4,UKEF='直寄',5)
          THISFORM.PAGEFRAME1.PAGE2.LBLF111.CAPTION=IIF(SEEK(THISFORM.PAGEFRAME1.PAGE2.TXTF11.VALUE,'C01'),C01.F05,'')
          THIS.REFRESH
       ENDIF       
    ENDIF  

  ENDPROC     
ENDDEFINE
***************************************************特殊輸入欄位設定-----------廠商
DEFINE CLASS TXTF04 AS TEXTBOX
  READONLY=.T.
  MAXLENGTH=5
  FONTSIZE=INT_015*9  
  PROCEDURE INTERACTIVECHANGE

             IF AT('?',ALLTRIM(THIS.VALUE))<>0 
                IF AT('?',ALLTRIM(THIS.VALUE))>1             
                   SELECT F02,F01,F04 FROM D01 INTO CURSOR VDR ORDER BY F02 WHERE LEFT(F02,AT('?',THIS.VALUE)-1)=LEFT(THIS.VALUE,AT('?',THIS.VALUE)-1)
                ELSE
                  SELECT F02,F01,F04 FROM D01 INTO CURSOR VDR ORDER BY F02 
                ENDIF          
                VDR_SEEK=CREATEOBJECT("VDR_SEEK")  
                VDR_SEEK.SHOW    
                THIS.VALUE=FLG
                THIS.REFRESH
                FLG='0'        
             ELSE
                IF LEN(ALLTRIM(THIS.VALUE))=4
                   SELECT F02,F01,F04 FROM D01 INTO CURSOR VDR ORDER BY F02 WHERE F02=ALLTRIM(THIS.VALUE)
                   DO CASE
                      CASE _TALLY=1
                           THIS.VALUE=VDR.F01
                           THIS.REFRESH
                      CASE _TALLY>1
                           VDR_SEEK=CREATEOBJECT("VDR_SEEK")  
                           VDR_SEEK.SHOW    
                           THIS.VALUE=FLG
                           THIS.REFRESH
                           FLG='0'        
                    ENDCASE      
                ENDIF
             ENDIF      
            THISFORM.PAGEFRAME1.PAGE1.LBLF041.CAPTION=IIF(SEEK(THIS.VALUE,'D01'),D01.F04,'')  
            THISFORM.PAGEFRAME1.PAGE1.TXTF05.VALUE=IIF(SEEK(THIS.VALUE,'D01'),D01.F08,'')  
 
  ENDPROC
ENDDEFINE
***************************************************特殊輸入欄位設定-----------請購人員
DEFINE CLASS TXTF07 AS TEXTBOX
   READONLY=.T.
   MAXLENGTH=5
   FONTSIZE=INT_015*9   
   PROCEDURE INTERACTIVECHANGE
     IF AT('?',ALLTRIM(THIS.VALUE))<>0
        IF AT('?',ALLTRIM(THIS.VALUE))>1             
           SELECT F01,F03 FROM A01 INTO CURSOR MAN ORDER BY F01 WHERE LEFT(F01,AT('?',THIS.VALUE)-1)=LEFT(THIS.VALUE,AT('?',THIS.VALUE)-1)
        ELSE
           SELECT F01,F03 FROM A01 INTO CURSOR MAN ORDER BY F01    
        ENDIF   
        VDR_SEEK=CREATEOBJECT("MAN_SEEK")  
        VDR_SEEK.SHOW    
        THIS.VALUE=FLG
        THIS.REFRESH
        FLG='0'        
     ENDIF  
      THISFORM.PAGEFRAME1.PAGE1.LBLF071.CAPTION=IIF(SEEK(THIS.VALUE,'A01'),A01.F03,'')  
  ENDPROC
ENDDEFINE
***************************************************特殊欄位-----------------採購單號
DEFINE CLASS TXTF0G AS TEXTBOX
  READONLY=.T.
  MAXLENGTH=10
  FONTSIZE=INT_015*9  
  PROCEDURE INTERACTIVECHANGE
    IF AT('?',ALLTRIM(THIS.VALUE))<>0
       DO CASE
          CASE AT('?',ALLTRIM(THIS.VALUE))>1 .AND. EMPTY(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE))                   
               SELECT F01,F02,F03,F04,F13,F16,F07,F17 FROM D07 INTO CURSOR OQT; 
               WHERE LEFT(D07.F01,AT('?',THIS.VALUE)-1)=LEFT(THIS.VALUE,AT('?',THIS.VALUE)-1) AND F05=THISFORM.PAGEFRAME1.PAGE1.TXTF04.VALUE AND F09=IIF(P08.F03='3','0','1') ORDER BY F02,F03             
          CASE AT('?',ALLTRIM(THIS.VALUE))>1 .AND. !EMPTY(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE))                
               SELECT D07.F01,D07.F02,D07.F03,D07.F04,D07.F13,D07.F16,D07.F07,D07.F17 FROM D07 INTO CURSOR OQT; 
               WHERE D07.F05=THISFORM.PAGEFRAME1.PAGE1.TXTF04.VALUE  AND D07.F02=THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE;
               AND LEFT(D07.F01,AT('?',THIS.VALUE)-1)=LEFT(THIS.VALUE,AT('?',THIS.VALUE)-1) AND F09=IIF(P08.F03='3','0','1') ORDER BY F02,F03                              
          CASE AT('?',ALLTRIM(THIS.VALUE))=1 .AND. EMPTY(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE))                   
               SELECT F01,F02,F03,F04,F13,F16,F07,F17 FROM D07 INTO CURSOR OQT WHERE F05=P08.F04 AND F09=IIF(P08.F03='3','0','1') ORDER BY F02,F03                
          CASE AT('?',ALLTRIM(THIS.VALUE))=1 .AND. !EMPTY(ALLTRIM(THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE))                  
               SELECT D07.F01,D07.F02,D07.F03,D07.F04,D07.F13,D07.F16,D07.F07,D07.F17 FROM D07 INTO CURSOR OQT; 
               WHERE  D07.F02=THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE AND F09=IIF(P08.F03='3','0','1') ORDER BY F02,F03
                           
       ENDCASE 
       IF _TALLY>0  
          OQT_SEEK=CREATEOBJECT("OQT_SEEK")  
          OQT_SEEK.SHOW    
          IF LEN(ALLTRIM(FLG))>1
             THIS.VALUE=FLG
             THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE=CHK_STR
             THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=QTY
             THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE=DTE
             THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE=DTE
             THISFORM.PAGEFRAME1.PAGE2.TXTF11.VALUE=CUS
             THISFORM.PAGEFRAME1.PAGE2.LBLF081.CAPTION=UKEF
             THISFORM.PAGEFRAME1.PAGE2.TRANSPORT_TYPE.VALUE=ICASE(UKEF='海運',1,UKEF='空運',2,UKEF='快遞',3,UKEF='自取',4,UKEF='直寄',5)
             THISFORM.PAGEFRAME1.PAGE2.LBLF111.CAPTION=IIF(SEEK(CUS,'C01'),C01.F05,'')
             THIS.REFRESH                    
             CUS=''
             FLG='0'      
             DTE=CTOD('')     
             CHK_STR=''
             UKEF=''
             QTY=0    
          ENDIF   
       ENDIF    
    ELSE
       IF !EMPTY(THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE)
          THISFORM.PAGEFRAME1.PAGE2.TXTF03.VALUE=IIF(SEEK(THIS.Value+THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE,'D07'),D07.F04,0)
          THISFORM.PAGEFRAME1.PAGE2.TXTF04.VALUE=IIF(SEEK(THIS.Value+THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE,'D07'),D07.F03,CTOD('')) 
          THISFORM.PAGEFRAME1.PAGE2.TXTF05.VALUE=IIF(SEEK(THIS.Value+THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE,'D07'),D07.F03,CTOD('')) 
          THISFORM.PAGEFRAME1.PAGE2.TXTF11.VALUE=IIF(SEEK(THIS.Value+THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE,'D07'),D07.F16,'') 
          UKEF=IIF(SEEK(THIS.Value+THISFORM.PAGEFRAME1.PAGE2.TXTF02.VALUE,'D07'),D07.F13,'') 
          THISFORM.PAGEFRAME1.PAGE2.LBLF081.CAPTION=UKEF
          THISFORM.PAGEFRAME1.PAGE2.TRANSPORT_TYPE.VALUE=ICASE(UKEF='海運',1,UKEF='空運',2,UKEF='快遞',3,UKEF='自取',4,UKEF='直寄',5)
          THISFORM.PAGEFRAME1.PAGE2.LBLF111.CAPTION=IIF(SEEK(THISFORM.PAGEFRAME1.PAGE2.TXTF11.VALUE,'C01'),C01.F05,'')
          THIS.REFRESH
       ENDIF      
    ENDIF  

  ENDPROC     
ENDDEFINE
***************************************************異動類別設定
DEFINE CLASS UPDMNT AS COMBOBOX
  HEIGHT=INT_015*25
  FONTSIZE=INT_015*9  
  AUTOSIZE=.T.
  TOP=INT_015*59
  LEFT=INT_015*65
  BOUNDCOLUMN=1
  COLUMNCOUNT=1
  WIDTH=INT_015*90
  ROWSOURCETYPE=1
  STYLE=2
  NAME='UPDMNT'
  PROCEDURE INIT
     WITH THIS 
         .ADDITEM('1.取消訂單')
         .ADDITEM('2.交期變更')
         .ADDITEM('3.詢問交期')         
         .VALUE=1
     ENDWITH        
  ENDPROC
  PROCEDURE INTERACTIVECHANGE              
    THISFORM.PAGEFRAME1.PAGE1.TXTF03.VALUE=ALLTRIM(STR(THIS.VALUE))
    THISFORM.PAGEFRAME1.PAGE1.TXTF03.REFRESH
  ENDPROC  
ENDDEFINE 
***************************************************回覆狀態
DEFINE CLASS RESPONSE AS OPTIONGROUP
  HEIGHT=INT_015*25
  FONTSIZE=INT_015*9  
  TOP=INT_015*84
  LEFT=INT_015*265
  Curvature = 99
  BUTTONCOUNT=2  
  WIDTH=INT_015*80
  FONTSIZE=INT_015*9
  BUTTONCOUNT=2
  VALUE=1 
  NAME='RESPONSE'
  OPTION1.CAPTION='OK'
  OPTION1.TOP=INT_015*5
  OPTION1.WIDTH=INT_015*72
  OPTION1.AUTOSIZE=.T.
  OPTION1.LEFT=INT_015*5
  OPTION1.FONTSIZE=INT_015*9
  OPTION1.NAME='OPTION1'  
  OPTION2.CAPTION='NG'
  OPTION2.TOP=INT_015*5
  OPTION2.WIDTH=INT_015*72
  OPTION2.LEFT=INT_015*40
  OPTION2.FONTSIZE=INT_015*9
  OPTION2.AUTOSIZE=.T.
  OPTION2.NAME='OPTION2'    
ENDDEFINE   
***************************************************入貨方式設定
DEFINE CLASS TRANSPORT AS COMBOBOX
  HEIGHT=INT_015*25
  FONTSIZE=INT_015*9  
  TOP=INT_015*59
  LEFT=INT_015*265
  BOUNDCOLUMN=1
  COLUMNCOUNT=1
  WIDTH=INT_015*66
  ROWSOURCETYPE=1
  STYLE=2
  NAME='TRANSPORT'
  PROCEDURE INIT
     WITH THIS 
         .ADDITEM('海運')
         .ADDITEM('空運')
         .ADDITEM('快遞')   
         .ADDITEM('自取')
         .ADDITEM('直寄')      
         .VALUE=1
     ENDWITH        
  ENDPROC
  PROCEDURE INTERACTIVECHANGE              
    THISFORM.PAGEFRAME1.PAGE2.LBLF081.CAPTION=ICASE(THIS.VALUE=1,'海運',THIS.VALUE=2,'空運',THIS.Value=3,'快遞',THIS.Value=4,'自取',THIS.Value=5,'直寄','')
    
  ENDPROC
ENDDEFINE   
***************************************訂單號碼
DEFINE CLASS OQT_SEEK AS FORM
  AUTOCENTER=.T.
  CAPTION='出貨計劃'
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*320
  WIDTH=INT_015*770
  FONTSIZE=INT_015*9  
  CONTROLBOX=.F.
  BORDERSTYLE=2
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WINDOWTYPE=1
  NAME='OQT_SEEK'
  ADD OBJECT CMDGROUP AS CMDGROUP WITH;      
      TOP=INT_015*290,;
      LEFT=INT_015*10
  ADD OBJECT GRID1 AS GRID WITH;          
      AUTOCENTER=.T.,;
      ALLOWCELLSELECTION=.F.,;
      WIDTH=INT_015*770,;      
      HEIGHT=INT_015*293,;      
      ROWHEIGHT=INT_015*18,;
      HEADERHEIGHT=INT_015*19,;
      DELETEMARK=.F.,;
      READONLY=.T.,;
      RECORDSOURCETYPE=1,;
      COLUMNCOUNT=6,;            
      NAME='GRID1',;
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;
      COLUMN3.NAME='COLUMN3',;
      COLUMN4.NAME='COLUMN4',;
      COLUMN5.NAME='COLUMN5',;
      COLUMN6.NAME='COLUMN6'
  ADD OBJECT CMND1 AS COMMANDBUTTON WITH;
      LEFT=INT_015*183,;
      TOP=INT_015*295,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;
      CAPTION='\<S.選取',;
      TOOLTIPTEXT='選取此筆資料!快速鍵->ALT+S'
      NAME='CMND2'
  ADD OBJECT CMND2 AS COMMANDBUTTON WITH;
      LEFT=INT_015*225,;
      TOP=INT_015*295,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*40,;
      FONTSIZE=INT_015*9,;      
      CAPTION='\<C.放棄',;
      TOOLTIPTEXT='取消此作業畫面!快速鍵->ALT+C'
      NAME='CMND2'
      PROCEDURE INIT 
         AREA1='OQT' 
        SELE OQT
         THISFORM.GRID1.READONLY=.T. 
         THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'COLUMN')
         THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'HEADER')         
         THISFORM.GRID1.RECORDSOURCE='OQT'
         THISFORM.CMDGROUP.SEEK_BOTT.VISIBLE=.F.         
         THISFORM.SETALL('READONLY',.T.,'TEXTBOX')
         THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='採購單號'
         THISFORM.GRID1.COLUMN1.CONTROLSOURCE='OQT.F01'
         THISFORM.GRID1.COLUMN1.WIDTH=INT_015*83
         THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='料品編號'
         THISFORM.GRID1.COLUMN2.WIDTH=INT_015*225
         THISFORM.GRID1.COLUMN2.CONTROLSOURCE='OQT.F02'         
         THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='進貨日期'
         THISFORM.GRID1.COLUMN3.CONTROLSOURCE='OQT.F03'
         THISFORM.GRID1.COLUMN3.WIDTH=INT_015*70
         THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='進貨數量'
         THISFORM.GRID1.COLUMN4.CONTROLSOURCE='OQT.F04'
         THISFORM.GRID1.COLUMN4.WIDTH=INT_015*75
         THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='運貨方式'
         THISFORM.GRID1.COLUMN5.CONTROLSOURCE="OQT.F13 + IIF(EMPTY(OQT.F17),'','(' + ALLTRIM(OQT.F17) + ')')"
         THISFORM.GRID1.COLUMN5.WIDTH=INT_015*180
         THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='採購用途'
         THISFORM.GRID1.COLUMN6.CONTROLSOURCE='OQT.F07'
         THISFORM.GRID1.COLUMN6.WIDTH=INT_015*114
         THISFORM.GRID1.SETFOCUS
         IF THISFORM.GRID1.ACTIVEROW<>0
              THISFORM.GRID1.AFTERROWCOLCHANGE 
         ENDIF         
      ENDPROC
      PROC GRID1.AFTERROWCOLCHANGE
           LPARAMETERS XCOLINDEX
           FCH='GRID1'
           FLG=OQT.F01         
           CHK_STR=OQT.F02        
           DTE=OQT.F03
           QTY=OQT.F04   
           CUS=OQT.F16
           UKEF=ALLTRIM(OQT.F13)
      ENDPROC 
      PROCEDURE CMND1.CLICK            
          AREA1='P08'
          THISFORM.RELEASE                                            
      ENDPROC
      PROCEDURE CMND2.CLICK
          FLG='0'
          CHK_STR=''
          QTY=0
          DTE=CTOD('')
          CUS=''
          AREA1='P08'
         THISFORM.RELEASE
      ENDPROC    
ENDDEFINE            


*********     

 