**程式名稱:單據編號暫存檔
set excl off
close all
clear 
PRG_NO='BK4'
AREA1='A24'
FLG='0'
FCH=''
CHK=''
IF !USED('A02')
   SELE 0
   USE A02 INDE A02
ELSE
   SELE A02
ENDIF
SET ORDER TO A021      
SEEK sys_oper+'A24'      
IF !USED('A23')
    SELE 0
    USE A23
ELSE 
   SELE A23
ENDIF
SET ORDER TO 1             
A24='A24'+LEFT(DTOS(DATE()),6)   &&單據暫存檔
IF !USED('&A24')
   SELE 0
   USE (A24) ALIA A24 INDE (A24)
ELSE
   SELE A24
ENDIF
SET ORDER TO 1                

TKA24form=createobject("tKA24")
TKA24form.show  
define class tKA24 as form
  caption='A24.單據暫存檔'
  autocenter=.t.
  controlbox=.F.
  BORDERSTYLE=3  
  MAXBUTTON=.F.
  MINBUTTON=.F.
  MOVABLE=.F.
  CLOSABLE=.F.
  controlcount=57
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*550
  showtips=.t.
  showwindow=1
  WIDTH=INT_015*789
  windowtype=1

  ADD OBJECT MTH_LIST AS MTH_LIST WITH;
      autocenter=.t.      
  ADD OBJECT GRID1 AS GRID1 WITH;
      columncount=11,;            
      RECORDSOURCE='A24',; 
      HEIGHT=INT_015*500,;     
      WIDTH=INT_015*780,;     
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;
      COLUMN3.NAME='COLUMN3',; 
      COLUMN4.NAME='COLUMN4',; 
      COLUMN5.NAME='COLUMN5'
  ADD OBJECT ORPGROUP AS ORPGROUP WITH;      
      TOP=INT_015*0,;
      LEFT=INT_015*450              
  ADD OBJECT CMDGROUP AS CMDGROUP WITH;
      TOP=INT_015*0,;
      LEFT=INT_015*350,;
      ENABLED=.T.,;
      VISIBLE=.T.                 

  PROCEDURE INIT
       SELE A24
       go top
       CHK_STR=IIF(SEEK(DTOS(CTOD((THISFORM.MTH_LIST.DISPLAYVALUE+'/01'))),'A23','A231'),LEFT(DTOC(A23.F01),5),'')
       THISFORM.CMDGROUP.SEEK_BOTT.VISIBLE=.F.
       THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.
       THISFORM.ORPGROUP.NEW_BOTT.VISIBLE=.F.
       THISFORM.ORPGROUP.EDIT_BOTT.VISIBLE=.F.
       THISFORM.ORPGROUP.pnt_BOTT.VISIBLE=.F.
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'COLUMN')
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'HEADER')   
       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*149
       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*85
       THISFORM.GRID1.COLUMN3.WIDTH=INT_015*85
       THISFORM.GRID1.COLUMN4.WIDTH=INT_015*85
       THISFORM.GRID1.COLUMN5.WIDTH=INT_015*85

       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='類別'	          
       THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='月份'	                 
	   THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='起始編號'
	   THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='單據編號'	   	   
  	   THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='可用編號'      	     	   
       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='A24.F01'
       THISFORM.GRID1.COLUMN2.CONTROLSOURCE='A24.F02'
       THISFORM.GRID1.COLUMN3.CONTROLSOURCE='A24.F05'
       THISFORM.GRID1.COLUMN4.CONTROLSOURCE='A24.F06'
       THISFORM.GRID1.COLUMN5.CONTROLSOURCE='A24.F08'
       THISFORM.GRID1.READONLY=.T.       
       JK='類別'
       THISFORM.GRID1.SETFOCUS       
  ENDPROC       

  PROC MTH_LIST.INTERACTIVECHANGE
       CHK_STR=IIF(SEEK(DTOS(CTOD((THIS.DISPLAYVALUE+'/01'))),'A23','A231'),LEFT(DTOC(A23.F01),5),'')
       THISFORM.GRID1.RECORDSOURCE=''
       SELE A24
       USE
       A24='A24'+LEFT(DTOS(CTOD(THIS.DISPLAYVALUE+'/01')),6)
       IF !USED('&A24')
          SELE 0
          USE (A24) ALIA A24
       ELSE
          SELE A24
       ENDIF
       SET ORDER TO 1  
       THISFORM.GRID1.RECORDSOURCE='A24'            	   
       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='A24.F01'
       THISFORM.GRID1.COLUMN2.CONTROLSOURCE='A24.F02'
       THISFORM.GRID1.COLUMN3.CONTROLSOURCE='A24.F05'
       THISFORM.GRID1.COLUMN4.CONTROLSOURCE='A24.F06'
       THISFORM.GRID1.COLUMN5.CONTROLSOURCE='A24.F08'
	   thisform.grid1.setfocus        
	   THISFORM.REFRESH
       IF THISFORM.GRID1.ACTIVEROW=0
          THISFORM.CMDGROUP.ENABLED=.F.
       ELSE
          THISFORM.CMDGROUP.ENABLED=.T.      
       ENDIF          
  ENDPROC      
  PROC GRID1.AFTERROWCOLCHANGE
       LPARAMETERS nColIndex       
       FCH=THISFORM.ACTIVECONTROL.NAME
       CHK=''
       thisform.refresh
  ENDPROC      
  PROC ORPGROUP.DEL_BOTT.CLICK
       SELE A24
       DELE 
       SKIP -1
       IF BOF()
         GO TOP
       ENDIF
       SELE A24
       THISFORM.GRID1.SETFOCUS  
enddefine            