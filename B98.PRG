***程式名稱:B98.查詢入貨未出明細
CLOSE ALL
CLEAR 
AREA1='B98'
FLG='0'
FCH=''
CHK=''
B98_F99=''
KEY_NOW=''
IF ! USED('A01')
   SELE 0
   USE A01 INDE A01
ELSE
   SELE A01
ENDIF      
SET ORDER TO A01
IF !USED('A02')	&&權限設定檔
   SELE 0
   USE A02 INDE A02
ELSE
   SELE A02
ENDIF
SET ORDER TO A021      
SEEK sys_oper + 'B98'    
IF !USED('C01')
   SELE 0
   USE C01
ELSE
   SELE C01
ENDIF
SET ORDER TO C011
IF !USED('B98')
   SELE 0
   USE B98
ELSE
   SELE B98
ENDIF
SET ORDER TO B981
SEEK 'A'
IF FOUND()
    B98_F99 = B98.F99
ENDIF
SET FILTER TO F90='B'
SET ORDER TO B982
GO TOP
*******
B98FORM=CREATEOBJECT("TKB98")
B98FORM.SHOW  
DEFINE CLASS TKB98 AS FORM
  CAPTION='B98.查詢入貨未出明細'
*!*	  AUTOCENTER=.T.
  CONTROLBOX=.F.
  BORDERSTYLE=1  
  MAXBUTTON=.F.
  MINBUTTON=.F.
  MOVABLE=.F.
  CLOSABLE=.F.
  CONTROLCOUNT=57
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*550
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WIDTH=INT_015*791
  WINDOWTYPE=1
  ADD OBJECT KEY_LIST AS KEY_LIST WITH;
      AUTOCENTER=.T.,;
      WIDTH=INT_015*120
  ADD OBJECT GRID1 AS GRID1 WITH;
      COLUMNCOUNT=15,;            
      RECORDSOURCE='B98',; 
      TOP=INT_015*115,;  
      HEIGHT=INT_015*410,;     
      WIDTH=INT_015*780,;      
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;
      COLUMN3.NAME='COLUMN3',; 
      COLUMN4.NAME='COLUMN4',; 
      COLUMN5.NAME='COLUMN5',;             
      COLUMN6.NAME='COLUMN6',;       
      COLUMN7.NAME='COLUMN7',;       
      COLUMN8.NAME='COLUMN8',;
      COLUMN9.NAME='COLUMN9',;
      COLUMN10.NAME='COLUMN10',;
      COLUMN11.NAME='COLUMN11',;
      COLUMN12.NAME='COLUMN12',;
      COLUMN13.NAME='COLUMN13',;
      COLUMN14.NAME='COLUMN14',;
      COLUMN15.NAME='COLUMN15'
  ADD OBJECT ORPGROUP AS ORPGROUP WITH;      
      TOP=INT_015*0,;
      LEFT=INT_015*511             
  ADD OBJECT CMDGROUP AS CMDGROUP WITH;
      TOP=INT_015*0,;
      LEFT=INT_015*130,;
      ENABLED=.T.,;
     VISIBLE=.T.           
  ADD OBJECT AGAIN_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*5,;
      LEFT=INT_015*345,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*90,;
      CAPTION='\<Z.重算入貨未出'         
  ADD OBJECT EXCEL_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*5,;
      LEFT=INT_015*438,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*65,;
      CAPTION='\<T.轉EXCEL'            
  ADD OBJECT MONTH_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*5,;
      LEFT=INT_015*506,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*90,;
      CAPTION='\<M.當月入貨未出'             
  ADD OBJECT ED_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*5,;
      LEFT=INT_015*598,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*40,;
      CAPTION='\<E.修改'           
  ADD OBJECT DL_BOTT AS COMMANDBUTTON WITH;
      TOP=INT_015*5,;
      LEFT=INT_015*641,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*40,;
      CAPTION='\<D.刪除'             
  ADD OBJECT LBLF10 AS LABEL WITH;
      TOP=INT_015*41,;
      LEFT=INT_015*20,;
      HEIGHT=INT_015*23,;      
      WIDTH=INT_015*40,;
      CAPTION='備註一'     
  ADD OBJECT TXTF10 AS TEXTBOX WITH;
      TOP=INT_015*33,;
      LEFT=INT_015*60,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*350,;
      MAXLENGTH=60
  ADD OBJECT LBLF11 AS LABEL WITH;
      TOP=INT_015*65,;
      LEFT=INT_015*20,;
      HEIGHT=INT_015*23,;      
      WIDTH=INT_015*40,;
      CAPTION='備註二'     
  ADD OBJECT TXTF11 AS TEXTBOX WITH;
      TOP=INT_015*58,;
      LEFT=INT_015*60,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*350,;
      MAXLENGTH=60 
  ADD OBJECT LBLF12 AS LABEL WITH;
      TOP=INT_015*90,;
      LEFT=INT_015*20,;
      HEIGHT=INT_015*23,;      
      WIDTH=INT_015*40,;
      CAPTION='備註三'     
  ADD OBJECT TXTF12 AS TEXTBOX WITH;
      TOP=INT_015*83,;
      LEFT=INT_015*60,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*350,;
      MAXLENGTH=60       
  ****    
  ADD OBJECT LBLF13 AS LABEL WITH;
      TOP=INT_015*41,;
      LEFT=INT_015*430,;
      HEIGHT=INT_015*23,;      
      WIDTH=INT_015*50,;
      CAPTION='客戶編號'     
  ADD OBJECT LBLF131 AS LABEL WITH;
      TOP=INT_015*40,;
      LEFT=INT_015*540,;
      HEIGHT=INT_015*23,;      
      AUTOSIZE=.T.,;
      CAPTION=''           
  ADD OBJECT TXTF13 AS TEXTBOX WITH;
      TOP=INT_015*33,;
      LEFT=INT_015*482,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*50,;
      MAXLENGTH=5  
  ADD OBJECT LBLF15 AS LABEL WITH;
      TOP=INT_015*65,;
      LEFT=INT_015*430,;
      HEIGHT=INT_015*23,;      
      WIDTH=INT_015*50,;
      CAPTION='業務編號'     
  ADD OBJECT LBLF151 AS LABEL WITH;
      TOP=INT_015*65,;
      LEFT=INT_015*540,;
      HEIGHT=INT_015*23,;      
      AUTOSIZE=.T.,;
      CAPTION=''            
  ADD OBJECT TXTF15 AS TEXTBOX WITH;
      TOP=INT_015*58,;
      LEFT=INT_015*482,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*50,;
      MAXLENGTH=5 
  ADD OBJECT LBLF17 AS LABEL WITH;
      TOP=INT_015*90,;
      LEFT=INT_015*430,;
      HEIGHT=INT_015*23,;      
      WIDTH=INT_015*50,;
      CAPTION='業助編號'     
  ADD OBJECT LBLF171 AS LABEL WITH;
      TOP=INT_015*90,;
      LEFT=INT_015*540,;
      HEIGHT=INT_015*23,;      
      AUTOSIZE=.T.,;
      CAPTION=''            
  ADD OBJECT TXTF17 AS TEXTBOX WITH;
      TOP=INT_015*83,;
      LEFT=INT_015*482,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*50,;
      MAXLENGTH=5                       
   ADD OBJECT LBLF19 AS LABEL WITH;
      TOP=INT_015*41,;
      LEFT=INT_015*630,;
      HEIGHT=INT_015*17,;      
      AUTOSIZE=.T.,;
       CAPTION='重算日期'               
   ADD OBJECT LBLF99 AS LABEL WITH;
      TOP=INT_015*65,;
      LEFT=INT_015*630,;
      HEIGHT=INT_015*17,;      
      WIDTH=INT_015*50,;
       CAPTION='安全資料'         
   ADD OBJECT LBLF991 AS LABEL WITH;
      TOP=INT_015*65,;
      LEFT=INT_015*680,;
      HEIGHT=INT_015*17,;      
      AUTOSIZE=.T.,;
      CAPTION=''                              
  ADD OBJECT YES AS COMMANDBUTTON WITH;
      TOP=INT_015*85,;
      LEFT=INT_015*630,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*40,;
      CAPTION='\<Y.確定'
  ADD OBJECT NO AS COMMANDBUTTON WITH;
      TOP=INT_015*85,;
      LEFT=INT_015*672,;
      HEIGHT=INT_015*25,;      
      WIDTH=INT_015*40,;
      CAPTION='\<N.取消'                                      
  PROCEDURE INIT
       THISFORM.ORPGROUP.NEW_BOTT.VISIBLE=.F.
       THISFORM.ORPGROUP.EDIT_BOTT.VISIBLE=.F.
       THISFORM.ORPGROUP.DEL_BOTT.VISIBLE=.F.
       THISFORM.ORPGROUP.PNT_BOTT.VISIBLE=.F.
       THISFORM.YES.VISIBLE=.F.
       THISFORM.NO.VISIBLE=.F.
       THISFORM.GRID1.LOCKCOLUMNS=2
       THISFORM.SETALL('MOUSEPOINTER',99,'COMMANDBUTTON')        
       THISFORM.SETALL('MOUSEICON','BMPS\HAND.CUR','COMMANDBUTTON')               
       THISFORM.SETALL('READONLY',.T.,'TEXTBOX') 
       THISFORM.SETALL('FONTSIZE',INT_015*9,'COMMANDBUTTON')
       THISFORM.SETALL('FONTSIZE',INT_015*9,'LABEL')
       THISFORM.SETALL('FONTSIZE',INT_015*9,'TEXTBOX')
       THISFORM.GRID1.BACKCOLOR=IIF(SEEK(sys_oper,'A01'),IIF(A01.F11=0,10009146,A01.F11),10009146)
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'COLUMN')
       THISFORM.GRID1.SETALL('FONTSIZE',INT_015*9,'HEADER')
       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*165
       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*150      
       THISFORM.GRID1.COLUMN3.WIDTH=INT_015*75
       THISFORM.GRID1.COLUMN4.WIDTH=INT_015*65
       THISFORM.GRID1.COLUMN5.WIDTH=INT_015*65
       THISFORM.GRID1.COLUMN6.WIDTH=INT_015*70
       THISFORM.GRID1.COLUMN7.WIDTH=INT_015*55
       THISFORM.GRID1.COLUMN8.WIDTH=INT_015*70
       THISFORM.GRID1.COLUMN9.WIDTH=INT_015*65
       THISFORM.GRID1.COLUMN10.WIDTH=INT_015*50
       THISFORM.GRID1.COLUMN11.WIDTH=INT_015*60 
       THISFORM.GRID1.COLUMN12.WIDTH=INT_015*50 
       THISFORM.GRID1.COLUMN13.WIDTH=INT_015*60
       THISFORM.GRID1.COLUMN14.WIDTH=INT_015*50       
       THISFORM.GRID1.COLUMN15.WIDTH=INT_015*60 
       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='料品編號'
       THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='品名規格'
       THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='庫存數量'
       THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='成本單價'	   
       THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='最後異動日'
       THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='請購單號'  	   
       THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='呆滯天數'
       THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='存貨週轉率'
       THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='最後進貨日'
       THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='客戶編號'
       THISFORM.GRID1.COLUMN11.HEADER1.CAPTION='客戶簡稱'
       THISFORM.GRID1.COLUMN12.HEADER1.CAPTION='業務編號' 
       THISFORM.GRID1.COLUMN13.HEADER1.CAPTION='業務姓名' 
       THISFORM.GRID1.COLUMN14.HEADER1.CAPTION='業助編號'   	   
       THISFORM.GRID1.COLUMN15.HEADER1.CAPTION='業助姓名'   
       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='B98.F02'
       THISFORM.GRID1.COLUMN2.CONTROLSOURCE='B98.F03'
       THISFORM.GRID1.COLUMN3.CONTROLSOURCE='B98.F04'
       THISFORM.GRID1.COLUMN4.CONTROLSOURCE='B98.F05'
       THISFORM.GRID1.COLUMN5.CONTROLSOURCE='B98.F06'
       THISFORM.GRID1.COLUMN6.CONTROLSOURCE='B98.F07'
       THISFORM.GRID1.COLUMN7.CONTROLSOURCE='B98.F08'
       THISFORM.GRID1.COLUMN8.CONTROLSOURCE='B98.F09'
       THISFORM.GRID1.COLUMN9.CONTROLSOURCE='B98.F19'
       THISFORM.GRID1.COLUMN10.CONTROLSOURCE='B98.F13'
       THISFORM.GRID1.COLUMN11.CONTROLSOURCE='B98.F14'
       THISFORM.GRID1.COLUMN12.CONTROLSOURCE='B98.F15'
       THISFORM.GRID1.COLUMN13.CONTROLSOURCE='B98.F16'
       THISFORM.GRID1.COLUMN14.CONTROLSOURCE='B98.F17'	   
       THISFORM.GRID1.COLUMN15.CONTROLSOURCE='B98.F18'	  
       THISFORM.GRID1.COLUMN4.VISIBLE=!EMPTY(A02.F10)
       THISFORM.GRID1.READONLY=.T.       
       THISFORM.GRID1.SETFOCUS
       IF  THISFORM.GRID1.ACTIVEROW=0 
              THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
	      THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
	      THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
	      THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.    
	      THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.	        
	      THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.   
              THISFORM.EXCEL_BOTT.ENABLED=.F. 
              THISFORM.ED_BOTT.ENABLED=.F.
              THISFORM.DL_BOTT.ENABLED=.F.
        ELSE
              THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
	      THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
	      THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
	      THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.    
	      THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.	        
              THISFORM.EXCEL_BOTT.ENABLED=IIF(A02.F09='*',.T.,.F.)
              THISFORM.ED_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)
              THISFORM.DL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)
        ENDIF  
        THISFORM.AGAIN_BOTT.ENABLED=IIF(A02.F08='*',.T.,.F.)           
        THISFORM.MONTH_BOTT.ENABLED=IIF(A02.F11='*',.T.,.F.)   
        JK='料品編號'
  ENDPROC       
  PROC KEY_LIST.INIT 
       WITH THIS 
           .ADDITEM('依料品編號排列')
           .ADDITEM('依客戶編號排列')           
           .ADDITEM('依業務編號排列')           
           .ADDITEM('依業助編號排列')  
           .VALUE=1          
       ENDWITH      
  ENDPROC 
  PROC KEY_LIST.INTERACTIVECHANGE                 
       SELECT  B98
       DO CASE
              CASE THIS.DISPLAYVALUE='依料品編號排列'
                         SET ORDER TO B982
		       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*165
		       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*150      
		       THISFORM.GRID1.COLUMN3.WIDTH=INT_015*75
		       THISFORM.GRID1.COLUMN4.WIDTH=INT_015*65
		       THISFORM.GRID1.COLUMN5.WIDTH=INT_015*65
		       THISFORM.GRID1.COLUMN6.WIDTH=INT_015*70
		       THISFORM.GRID1.COLUMN7.WIDTH=INT_015*55
		       THISFORM.GRID1.COLUMN8.WIDTH=INT_015*70
		       THISFORM.GRID1.COLUMN9.WIDTH=INT_015*65
		       THISFORM.GRID1.COLUMN10.WIDTH=INT_015*50
		       THISFORM.GRID1.COLUMN11.WIDTH=INT_015*60 
		       THISFORM.GRID1.COLUMN12.WIDTH=INT_015*50 
		       THISFORM.GRID1.COLUMN13.WIDTH=INT_015*60
		       THISFORM.GRID1.COLUMN14.WIDTH=INT_015*50       
		       THISFORM.GRID1.COLUMN15.WIDTH=INT_015*60 
		       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='料品編號'
		       THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='品名規格'
		       THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='庫存數量'
		       THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='成本單價'	   
		       THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='最後異動日'
		       THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='請購單號'  	   
		       THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='呆滯天數'
		       THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='存貨週轉率'
		       THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='最後進貨日'
		       THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='客戶編號'
		       THISFORM.GRID1.COLUMN11.HEADER1.CAPTION='客戶簡稱'
		       THISFORM.GRID1.COLUMN12.HEADER1.CAPTION='業務編號' 
		       THISFORM.GRID1.COLUMN13.HEADER1.CAPTION='業務姓名' 
		       THISFORM.GRID1.COLUMN14.HEADER1.CAPTION='業助編號'   	   
		       THISFORM.GRID1.COLUMN15.HEADER1.CAPTION='業助姓名'   
		       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='B98.F02'
		       THISFORM.GRID1.COLUMN2.CONTROLSOURCE='B98.F03'
		       THISFORM.GRID1.COLUMN3.CONTROLSOURCE='B98.F04'
		       THISFORM.GRID1.COLUMN4.CONTROLSOURCE='B98.F05'
		       THISFORM.GRID1.COLUMN5.CONTROLSOURCE='B98.F06'
		       THISFORM.GRID1.COLUMN6.CONTROLSOURCE='B98.F07'
		       THISFORM.GRID1.COLUMN7.CONTROLSOURCE='B98.F08'
		       THISFORM.GRID1.COLUMN8.CONTROLSOURCE='B98.F09'
		       THISFORM.GRID1.COLUMN9.CONTROLSOURCE='B98.F19'
		       THISFORM.GRID1.COLUMN10.CONTROLSOURCE='B98.F13'
		       THISFORM.GRID1.COLUMN11.CONTROLSOURCE='B98.F14'
		       THISFORM.GRID1.COLUMN12.CONTROLSOURCE='B98.F15'
		       THISFORM.GRID1.COLUMN13.CONTROLSOURCE='B98.F16'
		       THISFORM.GRID1.COLUMN14.CONTROLSOURCE='B98.F17'	   
		       THISFORM.GRID1.COLUMN15.CONTROLSOURCE='B98.F18'	      
		       THISFORM.GRID1.COLUMN4.VISIBLE=!EMPTY(A02.F10)                     
              CASE THIS.DISPLAYVALUE='依客戶編號排列'
                         SET ORDER TO B983
		       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*70
		       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*50                         
		       THISFORM.GRID1.COLUMN3.WIDTH=INT_015*165
		       THISFORM.GRID1.COLUMN4.WIDTH=INT_015*150      
		       THISFORM.GRID1.COLUMN5.WIDTH=INT_015*75
		       THISFORM.GRID1.COLUMN6.WIDTH=INT_015*65
		       THISFORM.GRID1.COLUMN7.WIDTH=INT_015*65
		       THISFORM.GRID1.COLUMN8.WIDTH=INT_015*70
		       THISFORM.GRID1.COLUMN9.WIDTH=INT_015*55
		       THISFORM.GRID1.COLUMN10.WIDTH=INT_015*60 
		       THISFORM.GRID1.COLUMN11.WIDTH=INT_015*65
		       THISFORM.GRID1.COLUMN12.WIDTH=INT_015*50 
		       THISFORM.GRID1.COLUMN13.WIDTH=INT_015*60
		       THISFORM.GRID1.COLUMN14.WIDTH=INT_015*50       
		       THISFORM.GRID1.COLUMN15.WIDTH=INT_015*60 
		       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='客戶編號'
		       THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='客戶簡稱'		       
		       THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='料品編號'
		       THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='品名規格'
		       THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='庫存數量'
		       THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='成本單價'	   
		       THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='最後異動日'
		       THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='請購單號'  	   
		       THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='呆滯天數'
		       THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='存貨週轉率'
		       THISFORM.GRID1.COLUMN11.HEADER1.CAPTION='最後進貨日'
		       THISFORM.GRID1.COLUMN12.HEADER1.CAPTION='業務編號' 
		       THISFORM.GRID1.COLUMN13.HEADER1.CAPTION='業務姓名' 
		       THISFORM.GRID1.COLUMN14.HEADER1.CAPTION='業助編號'   	   
		       THISFORM.GRID1.COLUMN15.HEADER1.CAPTION='業助姓名'   
		       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='B98.F13'
		       THISFORM.GRID1.COLUMN2.CONTROLSOURCE='B98.F14'		       
		       THISFORM.GRID1.COLUMN3.CONTROLSOURCE='B98.F02'
		       THISFORM.GRID1.COLUMN4.CONTROLSOURCE='B98.F03'
		       THISFORM.GRID1.COLUMN5.CONTROLSOURCE='B98.F04'
		       THISFORM.GRID1.COLUMN6.CONTROLSOURCE='B98.F05'
		       THISFORM.GRID1.COLUMN7.CONTROLSOURCE='B98.F06'
		       THISFORM.GRID1.COLUMN8.CONTROLSOURCE='B98.F07'
		       THISFORM.GRID1.COLUMN9.CONTROLSOURCE='B98.F08'
		       THISFORM.GRID1.COLUMN10.CONTROLSOURCE='B98.F09'
		       THISFORM.GRID1.COLUMN11.CONTROLSOURCE='B98.F19'
		       THISFORM.GRID1.COLUMN12.CONTROLSOURCE='B98.F15'
		       THISFORM.GRID1.COLUMN13.CONTROLSOURCE='B98.F16'
		       THISFORM.GRID1.COLUMN14.CONTROLSOURCE='B98.F17'	   
		       THISFORM.GRID1.COLUMN15.CONTROLSOURCE='B98.F18'	       
		       THISFORM.GRID1.COLUMN6.VISIBLE=!EMPTY(A02.F10)                      
              CASE THIS.DISPLAYVALUE='依業務編號排列'
                         SET ORDER TO B984
		       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*50 
		       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*60                         
		       THISFORM.GRID1.COLUMN3.WIDTH=INT_015*165
		       THISFORM.GRID1.COLUMN4.WIDTH=INT_015*150      
		       THISFORM.GRID1.COLUMN5.WIDTH=INT_015*75
		       THISFORM.GRID1.COLUMN6.WIDTH=INT_015*65
		       THISFORM.GRID1.COLUMN7.WIDTH=INT_015*65
		       THISFORM.GRID1.COLUMN8.WIDTH=INT_015*70
		       THISFORM.GRID1.COLUMN9.WIDTH=INT_015*55
		       THISFORM.GRID1.COLUMN10.WIDTH=INT_015*70
		       THISFORM.GRID1.COLUMN11.WIDTH=INT_015*65
		       THISFORM.GRID1.COLUMN12.WIDTH=INT_015*50
		       THISFORM.GRID1.COLUMN13.WIDTH=INT_015*60 
		       THISFORM.GRID1.COLUMN14.WIDTH=INT_015*50       
		       THISFORM.GRID1.COLUMN15.WIDTH=INT_015*60 
		       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='業務編號' 
		       THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='業務姓名' 		       
		       THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='料品編號'
		       THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='品名規格'
		       THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='庫存數量'
		       THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='成本單價'	   
		       THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='最後異動日'
		       THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='請購單號'  	   
		       THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='呆滯天數'
		       THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='存貨週轉率'
		       THISFORM.GRID1.COLUMN11.HEADER1.CAPTION='最後進貨日'
		       THISFORM.GRID1.COLUMN12.HEADER1.CAPTION='客戶編號'
		       THISFORM.GRID1.COLUMN13.HEADER1.CAPTION='客戶簡稱'
		       THISFORM.GRID1.COLUMN14.HEADER1.CAPTION='業助編號'   	   
		       THISFORM.GRID1.COLUMN15.HEADER1.CAPTION='業助姓名'   
		       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='B98.F15'
		       THISFORM.GRID1.COLUMN2.CONTROLSOURCE='B98.F16'		       
		       THISFORM.GRID1.COLUMN3.CONTROLSOURCE='B98.F02'
		       THISFORM.GRID1.COLUMN4.CONTROLSOURCE='B98.F03'
		       THISFORM.GRID1.COLUMN5.CONTROLSOURCE='B98.F04'
		       THISFORM.GRID1.COLUMN6.CONTROLSOURCE='B98.F05'
		       THISFORM.GRID1.COLUMN7.CONTROLSOURCE='B98.F06'
		       THISFORM.GRID1.COLUMN8.CONTROLSOURCE='B98.F07'
		       THISFORM.GRID1.COLUMN9.CONTROLSOURCE='B98.F08'
		       THISFORM.GRID1.COLUMN10.CONTROLSOURCE='B98.F09'
		       THISFORM.GRID1.COLUMN11.CONTROLSOURCE='B98.F19'
		       THISFORM.GRID1.COLUMN12.CONTROLSOURCE='B98.F13'
		       THISFORM.GRID1.COLUMN13.CONTROLSOURCE='B98.F14'
		       THISFORM.GRID1.COLUMN14.CONTROLSOURCE='B98.F17'	   
		       THISFORM.GRID1.COLUMN15.CONTROLSOURCE='B98.F18'	     
		       THISFORM.GRID1.COLUMN6.VISIBLE=!EMPTY(A02.F10)                         
              CASE THIS.DISPLAYVALUE='依業助編號排列'
                         SET ORDER TO B985
		       THISFORM.GRID1.COLUMN1.WIDTH=INT_015*50       
		       THISFORM.GRID1.COLUMN2.WIDTH=INT_015*60                          
		       THISFORM.GRID1.COLUMN3.WIDTH=INT_015*165
		       THISFORM.GRID1.COLUMN4.WIDTH=INT_015*150      
		       THISFORM.GRID1.COLUMN5.WIDTH=INT_015*75
		       THISFORM.GRID1.COLUMN6.WIDTH=INT_015*65
		       THISFORM.GRID1.COLUMN7.WIDTH=INT_015*65
		       THISFORM.GRID1.COLUMN8.WIDTH=INT_015*70
		       THISFORM.GRID1.COLUMN9.WIDTH=INT_015*55
		       THISFORM.GRID1.COLUMN10.WIDTH=INT_015*70
		       THISFORM.GRID1.COLUMN11.WIDTH=INT_015*65
		       THISFORM.GRID1.COLUMN12.WIDTH=INT_015*50
		       THISFORM.GRID1.COLUMN13.WIDTH=INT_015*60 
		       THISFORM.GRID1.COLUMN14.WIDTH=INT_015*50 
		       THISFORM.GRID1.COLUMN15.WIDTH=INT_015*60
		       THISFORM.GRID1.COLUMN1.HEADER1.CAPTION='業助編號'   	   
		       THISFORM.GRID1.COLUMN2.HEADER1.CAPTION='業助姓名'   		       
		       THISFORM.GRID1.COLUMN3.HEADER1.CAPTION='料品編號'
		       THISFORM.GRID1.COLUMN4.HEADER1.CAPTION='品名規格'
		       THISFORM.GRID1.COLUMN5.HEADER1.CAPTION='庫存數量'
		       THISFORM.GRID1.COLUMN6.HEADER1.CAPTION='成本單價'	   
		       THISFORM.GRID1.COLUMN7.HEADER1.CAPTION='最後異動日'
		       THISFORM.GRID1.COLUMN8.HEADER1.CAPTION='請購單號'  	   
		       THISFORM.GRID1.COLUMN9.HEADER1.CAPTION='呆滯天數'
		       THISFORM.GRID1.COLUMN10.HEADER1.CAPTION='存貨週轉率'
		       THISFORM.GRID1.COLUMN11.HEADER1.CAPTION='最後進貨日'
		       THISFORM.GRID1.COLUMN12.HEADER1.CAPTION='客戶編號'
		       THISFORM.GRID1.COLUMN13.HEADER1.CAPTION='客戶簡稱'
		       THISFORM.GRID1.COLUMN14.HEADER1.CAPTION='業務編號' 
		       THISFORM.GRID1.COLUMN15.HEADER1.CAPTION='業務姓名' 
		       THISFORM.GRID1.COLUMN1.CONTROLSOURCE='B98.F17'	   
		       THISFORM.GRID1.COLUMN2.CONTROLSOURCE='B98.F18'	  		       
		       THISFORM.GRID1.COLUMN3.CONTROLSOURCE='B98.F02'
		       THISFORM.GRID1.COLUMN4.CONTROLSOURCE='B98.F03'
		       THISFORM.GRID1.COLUMN5.CONTROLSOURCE='B98.F04'
		       THISFORM.GRID1.COLUMN6.CONTROLSOURCE='B98.F05'
		       THISFORM.GRID1.COLUMN7.CONTROLSOURCE='B98.F06'
		       THISFORM.GRID1.COLUMN8.CONTROLSOURCE='B98.F07'
		       THISFORM.GRID1.COLUMN9.CONTROLSOURCE='B98.F08'
		       THISFORM.GRID1.COLUMN10.CONTROLSOURCE='B98.F09'
		       THISFORM.GRID1.COLUMN11.CONTROLSOURCE='B98.F19'
		       THISFORM.GRID1.COLUMN12.CONTROLSOURCE='B98.F13'
		       THISFORM.GRID1.COLUMN13.CONTROLSOURCE='B98.F14'
		       THISFORM.GRID1.COLUMN14.CONTROLSOURCE='B98.F15'
		       THISFORM.GRID1.COLUMN15.CONTROLSOURCE='B98.F16'
		       THISFORM.GRID1.COLUMN6.VISIBLE=!EMPTY(A02.F10)
       ENDCASE                                                                                             
       JK=THISFORM.GRID1.COLUMN1.HEADER1.CAPTION
       THISFORM.GRID1.REFRESH
       THISFORM.GRID1.SETFOCUS
  ENDPROC                
  PROC GRID1.AFTERROWCOLCHANGE
       LPARAMETERS NCOLINDEX
       THISFORM.LBLF19.CAPTION='重算日期 ' + B98_F99
       THISFORM.LBLF991.CAPTION=B98.F99
       THISFORM.TXTF10.VALUE=B98.F10
       THISFORM.TXTF11.VALUE=B98.F11
       THISFORM.TXTF12.VALUE=B98.F12
       THISFORM.TXTF13.VALUE=B98.F13
       THISFORM.LBLF131.CAPTION=B98.F14
       THISFORM.TXTF15.VALUE=B98.F15
       THISFORM.LBLF151.CAPTION=B98.F16
       THISFORM.TXTF17.VALUE=B98.F17
       THISFORM.LBLF171.CAPTION=B98.F18
       IF  THISFORM.GRID1.ACTIVEROW=0 
              THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
	      THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
	      THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
	      THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.    
	      THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F.	        
	      THISFORM.ORPGROUP.PNT_BOTT.ENABLED=.F.   
              THISFORM.EXCEL_BOTT.ENABLED=.F. 
              THISFORM.ED_BOTT.ENABLED=.F.
              THISFORM.DL_BOTT.ENABLED=.F.
        ELSE
              THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
	      THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
	      THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
	      THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.    
	      THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T.	        
              THISFORM.EXCEL_BOTT.ENABLED=IIF(A02.F09='*',.T.,.F.)
              THISFORM.ED_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)
              THISFORM.DL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)
        ENDIF           
       JK=THISFORM.GRID1.COLUMN1.HEADER1.CAPTION
       FCH=THISFORM.ACTIVECONTROL.NAME
       CHK=''
       THISFORM.REFRESH
  ENDPROC  
  ***
  PROCEDURE TXTF13.INTERACTIVECHANGE
    IF AT('?',ALLTRIM(THIS.VALUE))<>0
       IF AT('?',ALLTRIM(THIS.VALUE))>1             
           IF EMPTY(A02.F12)
               SELECT F02,F01,F04 FROM C01 INTO CURSOR VDR ORDER BY F02 WHERE LEFT(F02,AT('?',THIS.VALUE)-1)=LEFT(THIS.VALUE,AT('?',THIS.VALUE)-1) AND F18=SYS_OPER
           ELSE
               SELECT F02,F01,F04 FROM C01 INTO CURSOR VDR ORDER BY F02 WHERE LEFT(F02,AT('?',THIS.VALUE)-1)=LEFT(THIS.VALUE,AT('?',THIS.VALUE)-1)
           ENDIF
       ELSE
           SELECT F02,F01,F04 FROM C01 INTO CURSOR VDR ORDER BY F02 
       ENDIF
       IF _TALLY>0          
           VDR_SEEK=CREATEOBJECT("VDR_SEEK")  
           VDR_SEEK.SHOW    
           THIS.VALUE=FLG
           THIS.REFRESH
           FLG='0'        
       ENDIF   
    ELSE
       IF LEN(ALLTRIM(THIS.VALUE))=4
          SELECT F02,F01,F04 FROM C01 INTO CURSOR VDR ORDER BY F02 WHERE F02=ALLTRIM(THIS.VALUE)
          DO CASE
                CASE _TALLY=1
                         THIS.VALUE=VDR.F01
                         THIS.REFRESH
                CASE _TALLY>1
                           VDR_SEEK=CREATEOBJECT("VDR_SEEK")  
                           VDR_SEEK.SHOW    
                           THIS.VALUE=FLG
                           THIS.REFRESH
                           FLG='0'        
          ENDCASE      
      ENDIF    
   ENDIF       
   THISFORM.LBLF131.CAPTION=IIF(SEEK(THIS.VALUE,'C01'),C01.F05,'')  
  ENDPROC    
  ***
  PROCEDURE TXTF15.INTERACTIVECHANGE
    IF AT('?',ALLTRIM(THIS.VALUE))<>0
       IF AT('?',ALLTRIM(THIS.VALUE))>1             
          SELECT F01,F03 FROM A01 INTO CURSOR MAN ORDER BY F01 WHERE EMPTY(F06) AND LEFT(F01,AT('?',THIS.VALUE)-1)=LEFT(THIS.VALUE,AT('?',THIS.VALUE)-1)
       ELSE
          SELECT F01,F03 FROM A01 INTO CURSOR MAN ORDER BY F01 WHERE EMPTY(F06)   
       ENDIF   
       MAN_SEEK=CREATEOBJECT("MAN_SEEK")  
       MAN_SEEK.SHOW    
       THIS.VALUE=FLG
       THIS.REFRESH
       FLG='0'
    ENDIF   
       THISFORM.LBLF151.CAPTION=IIF(SEEK(THIS.VALUE,'A01'),A01.F03,'')
  ENDPROC    
  ***
  PROCEDURE TXTF17.INTERACTIVECHANGE
    IF AT('?',ALLTRIM(THIS.VALUE))<>0
       IF AT('?',ALLTRIM(THIS.VALUE))>1             
          SELECT F01,F03 FROM A01 INTO CURSOR MAN ORDER BY F01 WHERE EMPTY(F06) AND LEFT(F01,AT('?',THIS.VALUE)-1)=LEFT(THIS.VALUE,AT('?',THIS.VALUE)-1)
       ELSE
          SELECT F01,F03 FROM A01 INTO CURSOR MAN ORDER BY F01 WHERE EMPTY(F06)   
       ENDIF   
       MAN_SEEK=CREATEOBJECT("MAN_SEEK")  
       MAN_SEEK.SHOW    
       THIS.VALUE=FLG
       THIS.REFRESH
       FLG='0'
    ENDIF   
       THISFORM.LBLF171.CAPTION=IIF(SEEK(THIS.VALUE,'A01'),A01.F03,'')
  ENDPROC  
  **********重算入貨未出
  PROC AGAIN_BOTT.CLICK
	 SELECT B98
	 KEY_NOW = ALLTRIM(TAG())
	 THISFORM.CMDGROUP.SETALL('FORECOLOR',RGB(128,128,128),'COMMANDBUTTON')
         THISFORM.ORPGROUP.SETALL('FORECOLOR',RGB(128,128,128),'COMMANDBUTTON')
         THISFORM.AGAIN_BOTT.FORECOLOR=RGB(128,128,128)
         THISFORM.MONTH_BOTT.FORECOLOR=RGB(128,128,128)
         THISFORM.EXCEL_BOTT.FORECOLOR=RGB(128,128,128)
         THISFORM.ED_BOTT.FORECOLOR=RGB(128,128,128)
         THISFORM.DL_BOTT.FORECOLOR=RGB(128,128,128)
         AGAIN_SEEK=CREATEOBJECT("AGAIN_SEEK")  
         AGAIN_SEEK.SHOW                  
         THISFORM.CMDGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON')
         THISFORM.ORPGROUP.SETALL('FORECOLOR',RGB(0,0,0),'COMMANDBUTTON') 
         THISFORM.AGAIN_BOTT.FORECOLOR=RGB(0,0,0)   
         THISFORM.MONTH_BOTT.FORECOLOR=RGB(0,0,0)  
         THISFORM.EXCEL_BOTT.FORECOLOR=RGB(0,0,0)
         THISFORM.ED_BOTT.FORECOLOR=RGB(0,0,0)
         THISFORM.DL_BOTT.FORECOLOR=RGB(0,0,0)
         THISFORM.GRID1.SETFOCUS
  ENDPROC   
****當月入貨未出
PROC MONTH_BOTT.CLICK
	IF !USED('A23')	&&月份檔
	    SELECT  0
	    USE A23
	ELSE 
	   SELECT  A23
	ENDIF
	SET ORDER TO A231
	IF !USED('D04')
	   SELE 0
	   USE D04
	ELSE
	   SELE D04
	ENDIF
	SET ORDER TO D041
	IF !USED('P04')
	   SELE 0
	   USE P04
	ELSE
	   SELE P04
	ENDIF
	SET ORDER TO P041
	IF !USED('P06')
	   SELE 0
	   USE P06
	ELSE
	   SELE P06
	ENDIF
	SET ORDER TO P061	
	B26='B26'+LEFT(DTOS(DATE()),6)   &&庫存異動記錄檔 
	B261='B261'+LEFT(DTOS(DATE()),6)
	IF !USED('&B26')
	   SELE 0
	   USE (B26) ALIA B26 INDE (B26)
	ELSE
	   SELE B26
	ENDIF
	SET ORDER TO B261 
        D11='D11'+LEFT(DTOS(DATE()),6)   &&出貨日報表檔
	D111='D111'+LEFT(DTOS(DATE()),6)
	IF !USED('&D11')
	   SELE 0
	   USE (D11) ALIA D11 INDE (D11)
	ELSE
	   SELE D11
	ENDIF
	SET ORDER TO D111  
	SELECT F01 FROM B26 WHERE F02='I000 ' AND (LEFT(ALLTRIM(F07),2)='BC' OR LEFT(ALLTRIM(F07),2)='CZ' OR LEFT(ALLTRIM(F07),2)='BP') ORDER BY F01 INTO CURSOR B26_TEMP READWRITE 
	INDE ON F01 TAG B26_TEMP1
	SELECT F01,F03,F04,F05,F08,F09,F10,F11,F12 FROM D11 WHERE !EMPTY(D11.F12)  INTO CURSOR D11_TEMP READWRITE 
	ALTER TABLE D11_TEMP ADD P03NO  C(20)
	ALTER TABLE D11_TEMP ADD C04NO  C(10)
	INDE ON  F01 + F03 + F12 TAG B26_TEMP1
	SELECT D11_TEMP
	GO TOP
	DO WHILE !EOF()
	       SELECT B26_TEMP
	       SEEK D11_TEMP.F03
	       IF FOUND() 
		    SELECT D11_TEMP
		    DELETE  
	       ENDIF
	       SELECT D11_TEMP
	       SKIP
	ENDDO	
	SELECT B26_TEMP  
	USE
	SELECT D11_TEMP
	GO TOP
	DO WHILE !EOF()
	       SELECT D04
	       SEEK D11_TEMP.F05 + D11_TEMP.F03
	       IF FOUND()
	            REPLACE D11_TEMP.P03NO WITH D04.F11
	       ELSE
	            SELECT P04
	            SEEK D11_TEMP.F05 + D11_TEMP.F03
	            IF FOUND()
	                 REPLACE D11_TEMP.P03NO WITH P04.F11	                 
	            ENDIF     
	       ENDIF
	       IF !EMPTY(D11_TEMP.P03NO) AND LEFT(D11_TEMP.P03NO,2) = 'PA'
	            SELECT P06
	            SEEK LEFT(ALLTRIM(D11_TEMP.P03NO),10) + D11_TEMP.F03
	            IF FOUND()
   			 REPLACE D11_TEMP.C04NO WITH P06.F07
	            ENDIF
	       ENDIF
	       SELECT D11_TEMP
	       SKIP
	ENDDO
	SELECT D11_TEMP
	GO TOP
        MONTH_SEEK=CREATEOBJECT("MONTH_SEEK")  
        MONTH_SEEK.SHOW 
        SELECT B98
        THISFORM.GRID1.SETFOCUS  
ENDPROC    
****************轉EXCEL
  PROC EXCEL_BOTT.CLICK    
      FLG='0'
      SELECT B98
      EXCEL_RANGE=CREATEOBJECT("EXCEL_RANGE")  
      EXCEL_RANGE.SHOW    
      IF FLG<>'1'
          =MESSAGEBOX('無此範圍資料',0+48,'警示')
      ENDIF   
      FLG='0'   
      THISFORM.GRID1.SETFOCUS
  ENDPROC
*****************刪除  
 PROC DL_BOTT.CLICK
     IF MESSAGEBOX('是否確定要刪除此筆資料',4+32+256,'請確認') = 6
          SELECT B98
          DELETE 
     ENDIF
     THISFORM.GRID1.SETFOCUS
 ENDPROC  
*****************修改  
 PROC ED_BOTT.CLICK
     THISFORM.YES.VISIBLE=.T.
     THISFORM.NO.VISIBLE=.T.	
     THISFORM.KEY_LIST.ENABLED=.F.
     THISFORM.GRID1.ENABLED=.F.
     THISFORM.AGAIN_BOTT.ENABLED=.F.
     THISFORM.MONTH_BOTT.ENABLED=.F.
     THISFORM.EXCEL_BOTT.ENABLED=.F.
     THISFORM.ED_BOTT.ENABLED=.F.
     THISFORM.DL_BOTT.ENABLED=.F.
     THISFORM.ORPGROUP.ESC_BOTT.ENABLED=.F.
     THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.F.      
     THISFORM.CMDGROUP.UP_BOTT.ENABLED=.F.
     THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.F.
     THISFORM.CMDGROUP.END_BOTT.ENABLED=.F.
     THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.F. 
     THISFORM.SETALL('READONLY',.F.,'TEXTBOX') 
     THISFORM.TXTF10.SETFOCUS
     SELECT B98
     LOCK()
 ENDPROC
*********** 
 PROC YES.CLICK &&修改確認
     IF SEEK(THISFORM.TXTF13.VALUE,'C01')=.F. AND !EMPTY(THISFORM.TXTF13.VALUE)
         =MESSAGEBOX('客戶編號不存在,請查明後再輸入!',0+64,'提示視窗')   
         THISFORM.TXTF13.SETFOCUS
         RETURN
     ENDIF    
     IF SEEK(THISFORM.TXTF15.VALUE,'A01')=.F. AND !EMPTY(THISFORM.TXTF15.VALUE)
         =MESSAGEBOX('業務編號不存在,請查明後再輸入!',0+64,'提示視窗')   
         THISFORM.TXTF15.SETFOCUS
         RETURN
     ENDIF          
     IF SEEK(THISFORM.TXTF17.VALUE,'A01')=.F. AND !EMPTY(THISFORM.TXTF17.VALUE)
         =MESSAGEBOX('業助編號不存在,請查明後再輸入!',0+64,'提示視窗')   
         THISFORM.TXTF17.SETFOCUS
         RETURN
     ENDIF    
     SELECT B98      
     IF  RLOCK()
     	  REPLACE B98.F10 WITH THISFORM.TXTF10.VALUE
     	  REPLACE B98.F11 WITH THISFORM.TXTF11.VALUE
     	  REPLACE B98.F12 WITH THISFORM.TXTF12.VALUE
     	  REPLACE B98.F13 WITH THISFORM.TXTF13.VALUE
     	  REPLACE B98.F14 WITH IIF(SEEK(B98.F13,'C01'),C01.F05,'') 
     	  REPLACE B98.F15 WITH THISFORM.TXTF15.VALUE
     	  REPLACE B98.F16 WITH IIF(SEEK(B98.F15,'A01'),A01.F03,'') 
     	  REPLACE B98.F17 WITH THISFORM.TXTF17.VALUE
     	  REPLACE B98.F18 WITH IIF(SEEK(B98.F17,'A01'),A01.F03,'') 
     	  REPLACE B98.F99 WITH DTOC(DATE())+' '+IIF(SEEK(SYS_OPER,'A01'),A01.F03,'')
     ELSE 
          DO FILE_IMPACT
         RETURN
     ENDIF	  
    THISFORM.NO.CLICK
 ENDPROC
 *********
 PROC NO.CLICK &&修改取消
   UNLOCK ALL 
   THISFORM.SETALL('READONLY',.T.,'TEXTBOX') 
   THISFORM.YES.VISIBLE=.F.
   THISFORM.NO.VISIBLE=.F.
   THISFORM.KEY_LIST.ENABLED=.T.
   THISFORM.CMDGROUP.TOP_BOTT.ENABLED=.T.      
   THISFORM.CMDGROUP.UP_BOTT.ENABLED=.T.
   THISFORM.CMDGROUP.NEXT_BOTT.ENABLED=.T.
   THISFORM.CMDGROUP.END_BOTT.ENABLED=.T.
   THISFORM.CMDGROUP.SEEK_BOTT.ENABLED=.T. 
   THISFORM.ORPGROUP.ESC_BOTT.ENABLED=.T.
   THISFORM.AGAIN_BOTT.ENABLED=IIF(A02.F08='*',.T.,.F.)
   THISFORM.MONTH_BOTT.ENABLED=IIF(A02.F11='*',.T.,.F.)
   THISFORM.EXCEL_BOTT.ENABLED=IIF(A02.F09='*',.T.,.F.)
   THISFORM.ED_BOTT.ENABLED=IIF(A02.F05='*',.T.,.F.)
   THISFORM.DL_BOTT.ENABLED=IIF(A02.F06='*',.T.,.F.)
   THISFORM.GRID1.ENABLED=.T.     
   THISFORM.GRID1.SETFOCUS
   THISFORM.REFRESH
 ENDPROC
ENDDEFINE        
***********************************************重算入貨未出畫面
DEFINE CLASS AGAIN_SEEK AS FORM
*!*	  AUTOCENTER=.T.
  CAPTION='重算入貨未出'
  FONTSIZE=INT_015*9
  TOP=INT_015*200
  LEFT=INT_015*225
  HEIGHT=INT_015*100
  WIDTH=INT_015*310
  MOVABLE=.F.
  MAXBUTTON=.F.
  MINBUTTON=.F.
  CONTROLBOX=.F.
  BORDERSTYLE=1
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WINDOWTYPE=1
  NAME='AGAIN_SEEK'
  ADD OBJECT LBLF01 AS LABEL WITH;
      LEFT=INT_015*10,;
      TOP=INT_015*43,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*200,;
      FONTSIZE=INT_015*10,;
      CAPTION='請輸入入貨未出之天數：               天',;
      NAME='LBLF01'
  ADD OBJECT TXTF01 AS TEXTBOX WITH;
      LEFT=INT_015*150,;
      TOP=INT_015*37,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*35,;
      FONTSIZE=INT_015*10,;
      INPUTMASK='999',;
      MAXLENGTH=3,;
      NAME='TXTF01'      
  ADD OBJECT CMND1 AS COMMANDBUTTON WITH;
      LEFT=INT_015*230,;
      TOP=INT_015*20,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*50,;
      FONTSIZE=INT_015*10,;
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\harrow.cur',;  
      CAPTION='\<Y.確認',;
      TOOLTIPTEXT='確認所輸入之內容->ALT+Y',;
      NAME='CMND1'
 ADD OBJECT CMND2 AS COMMANDBUTTON WITH;
      LEFT=INT_015*230,;
      TOP=INT_015*55,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*50,;
      FONTSIZE=INT_015*10,;
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\harrow.cur',;        
      CAPTION='\<C.取消',;
      TOOLTIPTEXT='取消此畫面!快速鍵->ALT+C'
      NAME='CMND2'  
 PROCEDURE INIT 
         THISFORM.SETALL('FONTSIZE',INT_015*10,'COMMANDBUTTON')   
         THISFORM.TXTF01.VALUE = 15       
 ENDPROC            
********確認鍵******
PROCEDURE CMND1.CLICK    
  WAIT WINDOW "資料重算中,請稍後!" AT 0,150 NOWAIT NOCLEAR
   ***存貨週轉率
   CREATE CURSOR INVRT;
   (F01 C(5),F02 C(43),FIN N(16,4),FQY N(16,4),FND N(16,4),RTE N(11,6))
   INDEX ON F01+F02 TAG INVRT
   B25='B25'+LEFT(DTOS(DATE()),6)   &&本月庫存月報表檔
   B251='B251'+LEFT(DTOS(DATE()),6)
   IF !USED('&B25')
       SELE 0
       USE (B25) ALIA B25 INDE (B25) 
   ELSE
       SELE B25
   ENDIF
   SET ORDER TO B251     
   GO TOP
   DO WHILE !EOF()
         SELECT INVRT
         APPEND BLANK
         REPLACE INVRT.FIN  WITH B25.F03
         REPLACE INVRT.F01 WITH B25.F01
         REPLACE INVRT.F02 WITH B25.F02
         REPLACE INVRT.FQY WITH B25.F05+B25.F06+B25.F09+B25.F11+B25.F14+B25.F17+B25.F19+B25.F20
         REPLACE INVRT.FND WITH B25.F15
         SELECT B25
         SKIP
   ENDDO
   SELECT B25
   USE
   IF !USED('A23')	
        SELE 0
        USE A23 
   ELSE
        SELE A23
   ENDIF
   SET ORDER TO A231    
   SEEK LEFT(DTOS(DATE()),6)+'01'
   SKIP -1 
   IF !BOF()  
        B25='B25'+LEFT(DTOS(A23.F01),6)
        B251='B251'+LEFT(DTOS(A23.F01),6)
        IF !USED('&B25')
             SELE 0
             USE (B25) ALIA B25 INDE (B25) 
        ELSE
              SELE B25
        ENDIF
        SET ORDER TO B251      
        SELECT INVRT
        GO TOP
        DO WHILE !EOF()
               SELECT B25
               SEEK INVRT.F01+INVRT.F02
               IF FOUND()
                   SELECT INVRT
                   REPLACE INVRT.FIN  WITH B25.F03
                   REPLACE INVRT.FQY WITH INVRT.FQY+(B25.F05+B25.F06+B25.F09+B25.F11+B25.F14+B25.F17+B25.F19+B25.F20)
                   REPLACE INVRT.FND WITH INVRT.FND+B25.F15        
               ELSE
                   SELECT INVRT
                   REPLACE FIN WITH 0             
               ENDIF     
               SELECT INVRT
               SKIP
         ENDDO
         SELECT B25
         USE
         SELECT A23
         SKIP -1
         IF BOF()
             USE
         ELSE
             B25='B25'+LEFT(DTOS(A23.F01),6)
             B251='B251'+LEFT(DTOS(A23.F01),6)
             IF !USED('&B25')
                  SELE 0
                  USE (B25) ALIA B25 INDE (B25) 
             ELSE
                  SELE B25
             ENDIF
             SET ORDER TO B251      
             SELECT INVRT
             GO TOP
             DO WHILE !EOF()
                    SELECT B25
                    SEEK INVRT.F01+INVRT.F02
                    IF FOUND()
                        SELECT INVRT
                        REPLACE INVRT.FIN  WITH B25.F03
                        REPLACE INVRT.FQY WITH INVRT.FQY+(B25.F05+B25.F06+B25.F09+B25.F11+B25.F14+B25.F17+B25.F19+B25.F20)
                        REPLACE INVRT.FND WITH INVRT.FND+B25.F15    
                    ELSE
                        SELECT INVRT
                        REPLACE INVRT.FIN WITH 0                                      
                    ENDIF     
                    SELECT INVRT
                    SKIP
              ENDDO
              SELECT B25
              USE      
              SELECT A23
              USE      
          ENDIF    
    ELSE
          SELECT A23
          USE
    ENDIF
    SELECT INVRT
    REPLACE INVRT.RTE WITH INVRT.FQY / IIF(INVRT.FIN + INVRT.FND <> 0,(INVRT.FIN + INVRT.FND) / 4,1)  ALL
    ****
    IF !USED('B01')
         SELE 0
         USE B01 INDE B01
    ELSE
         SELE B01
    ENDIF
    SET ORDER TO B011        
    IF !USED('C03')
        SELE 0
        USE C03
    ELSE
        SELE C03
    ENDIF
    SET ORDER TO C031    
    IF !USED('C20')
        SELE 0
        USE C20
    ELSE
        SELE C20
    ENDIF
    SET ORDER TO C201
    IF !USED('B11')
        SELE 0
        USE B11
    ELSE
        SELE B11
    ENDIF
    SET ORDER TO B111    
    IF !USED('D10')
        SELE 0
        USE D10
    ELSE
       SELE D10
    ENDIF
    SET ORDER TO D101
    IF !USED('P05')
        SELE 0
        USE P05
    ELSE
        SELE P05
    ENDIF
    SET ORDER TO P051    
    ***
    SELECT  B11.F03,B01.F02,B11.F04,B01.F37,B11.F05,LEFT(B11.F06,10),B11.F06,DATE()-B11.F05,INVRT.RTE FROM B11,B01,INVRT;
                    WHERE B11.F01='I000 ' AND B01.F01=B11.F03 AND B11.F04 > 0 AND INVRT.F01+INVRT.F02=B11.F01+B11.F03 ORDER BY B11.F01,B11.F03  INTO CURSOR B11_TEMP READWRITE 
                    ALTER TABLE B11_TEMP ADD CusNo  C(5)		&&客戶編號
                    ALTER TABLE B11_TEMP ADD CusName  C(8)	&&客戶簡稱
                    ALTER TABLE B11_TEMP ADD SalesNo  C(5)	&&業務編號
                    ALTER TABLE B11_TEMP ADD SalesName  C(8)	&&業務姓名
                    ALTER TABLE B11_TEMP ADD AssiNo  C(5)		&&業助編號
                    ALTER TABLE B11_TEMP ADD AssiName  C(8)    &&業務姓名
                    ALTER TABLE B11_TEMP ADD Dte  D(8)              &&最後進貨日
                    INDE ON F03 TAG B11_TEMP1 
     SELECT B11_TEMP
     SET ORDER TO B11_TEMP1               
    ****進貨日報表
    SELECT D10.* FROM D10 INTO CURSOR D10_TEMP READWRITE 
    INDE ON F02 + DTOS(F03) TAG D10_TEMP1 DESCENDING
    SELECT D10_TEMP
    SET ORDER TO D10_TEMP1
    *****
    SELECT B11_TEMP
    GO TOP
    DO WHILE !EOF()
          SELECT D10_TEMP
          SEEK B11_TEMP.F03
          IF FOUND()
               REPLACE B11_TEMP.DTE WITH D10_TEMP.F03
          ENDIF
          SELECT B11_TEMP
          SKIP
    ENDDO
    SELECT D10_TEMP
    USE
    SELECT B11_TEMP
    DELETE  FOR DATE()-DTE < THISFORM.TXTF01.VALUE
    ***小於包裝基量則刪除
    SELECT B11_TEMP
    GO TOP
    DO WHILE !EOF()
           SELECT C20
           SEEK B11_TEMP.F03
           IF FOUND()
                IF B11_TEMP.F04 < VAL(C20.F03)
                     SELECT B11_TEMP
                     DELETE 
                ENDIF
           ENDIF
           SELECT B11_TEMP
           SKIP
    ENDDO 
    ****帶入客戶編號,簡稱
    SELECT B11_TEMP
    GO TOP
    DO WHILE !EOF()
           DO CASE
                CASE LEFT(B11_TEMP.EXP_6,2) = "BD"	&&出貨退回
                          REPLACE B11_TEMP.CusNo  WITH SUBSTR(B11_TEMP.F06,13,5)
                          REPLACE B11_TEMP.CusName WITH SUBSTR(B11_TEMP.F06,20,10)
                CASE  LEFT(B11_TEMP.EXP_6,2) = "CA"	&&客戶訂單
                          SELECT C03
                          SEEK B11_TEMP.EXP_6
                          IF FOUND()
                              REPLACE B11_TEMP.CusNo  WITH C03.F03
                              REPLACE B11_TEMP.CusName WITH IIF(SEEK(C03.F03,'C01'),C01.F05,"")
                         ENDIF                       
                OTHERWISE
                          SELECT P05
                          SEEK B11_TEMP.EXP_6
                          IF FOUND()
                              REPLACE B11_TEMP.CusNo  WITH P05.F04
                              REPLACE B11_TEMP.CusName WITH P05.F05
                         ENDIF
           ENDCASE   
           SELECT B11_TEMP
           SKIP                      
    ENDDO
    ****帶入負責業務及業助
    SELECT B11_TEMP
    GO TOP
    DO WHILE !EOF()
           SELECT C01
           SEEK B11_TEMP.CusNo  
           IF FOUND()
                REPLACE B11_TEMP.SalesNo WITH C01.F33
                REPLACE B11_TEMP.SalesName  WITH IIF(SEEK(C01.F33,'A01'),A01.F03,'')
                REPLACE B11_TEMP.AssiNo  WITH C01.F23
                REPLACE B11_TEMP.AssiName WITH IIF(SEEK(C01.F23,'A01'),A01.F03,'')      
           ENDIF
           SELECT B11_TEMP
           SKIP
    ENDDO   
    SELECT B11
    USE
    SELECT C20
    USE
    SELECT D10
    USE
    SELECT P05
    USE
    ****新增B98不存再之資料
    SELECT B98
    SET FILTER TO 
    SET ORDER TO B981
    SEEK 'A'
    IF FOUND()
         REPLACE B98.F99 WITH DTOC(DATE())+' '+IIF(SEEK(SYS_OPER,'A01'),A01.F03,'')
    ELSE
         SELECT B98
         APPEND BLANK 
         REPLACE B98.F90 WITH 'A'
         REPLACE B98.F99 WITH DTOC(DATE())+' '+IIF(SEEK(SYS_OPER,'A01'),A01.F03,'')
    ENDIF
    B98_F99 = DTOC(DATE())+' '+IIF(SEEK(SYS_OPER,'A01'),A01.F03,'')
    SELECT B98
    SET FILTER TO B98.F90 = 'B'
    SET ORDER TO B982
    GO TOP
    DO WHILE !EOF()
           SELECT B11_TEMP
           SEEK B98.F02
           IF !FOUND()
                SELECT B98
                DELETE 
           ENDIF
           SELECT B98
           SKIP
    ENDDO
    SELECT B11_TEMP
    GO TOP
    DO WHILE !EOF()
           SELECT B98
           SEEK B11_TEMP.F03
           IF !FOUND()
                SELECT B98
                APPEND BLANK
           ENDIF      
           REPLACE B98.F01 WITH 'I000 '
           REPLACE B98.F02 WITH B11_TEMP.F03
           REPLACE B98.F03 WITH B11_TEMP.F02
           REPLACE B98.F04 WITH B11_TEMP.F04
           REPLACE B98.F05 WITH B11_TEMP.F37
           REPLACE B98.F06 WITH B11_TEMP.F05
           REPLACE B98.F07 WITH B11_TEMP.EXP_6
           REPLACE B98.F08 WITH B11_TEMP.EXP_8
           REPLACE B98.F09 WITH B11_TEMP.RTE
           REPLACE B98.F13 WITH B11_TEMP.CusNo  
           REPLACE B98.F14 WITH B11_TEMP.CusName  
           REPLACE B98.F15 WITH B11_TEMP.SalesNo  
           REPLACE B98.F16 WITH B11_TEMP.SalesName  
           REPLACE B98.F17 WITH B11_TEMP.AssiNo  
           REPLACE B98.F18 WITH B11_TEMP.AssiName  
           REPLACE B98.F19 WITH B11_TEMP.Dte  
           REPLACE B98.F90 WITH 'B'
           REPLACE B98.F99 WITH DTOC(DATE())+' '+IIF(SEEK(SYS_OPER,'A01'),A01.F03,'')
           SELECT B11_TEMP
           SKIP
    ENDDO
    SELECT B11_TEMP
    USE
    WAIT CLEAR
    THISFORM.CMND2.CLICK
 ENDPROC   
********離開鍵***********
 PROCEDURE CMND2.CLICK     
     SELECT B98
     SET FILTER TO B98.F90 = 'B'
     SET ORDER TO KEY_NOW 
     GO TOP
     THISFORM.RELEASE 
     RETURN  
 ENDPROC   
ENDDEFINE       
***********************************當月入貨未出
DEFINE CLASS MONTH_SEEK AS FORM
*!*	  AUTOCENTER=.T.
  TOP=INT_015*100
  LEFT=INT_015*25      
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*350
  WIDTH=INT_015*740
  MAXBUTTON=.F.
  MINBUTTON=.F.    
  CLOSABLE=.F.
  CONTROLBOX=.F.
  BORDERSTYLE=2
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WINDOWTYPE=1
  NAME='MONTH_SEEK'
  ADD OBJECT GRDD01 AS GRID WITH;          
      AUTOCENTER=.T.,;
      TOP=37,;
      WIDTH=INT_015*739,;      
      HEIGHT=INT_015*320,;      
      ROWHEIGHT=INT_015*18,;
      HEADERHEIGHT=INT_015*19,;
      ALLOWCELLSELECTION=.F.,;
      DELETEMARK=.F.,;
      READONLY=.T.,;
      RECORDSOURCETYPE=1,;
      COLUMNCOUNT=10,;            
      RECORDSOURCE='D11_TEMP',;      
      NAME='GRDD01',;
      COLUMN1.NAME='COLUMN1',;
      COLUMN2.NAME='COLUMN2',;      
      COLUMN3.NAME='COLUMN3',; 
      COLUMN4.NAME='COLUMN4',; 
      COLUMN5.NAME='COLUMN5',; 
      COLUMN6.NAME='COLUMN6',; 
      COLUMN7.NAME='COLUMN7',; 
      COLUMN8.NAME='COLUMN8',; 
      COLUMN9.NAME='COLUMN9',; 
      COLUMN10.NAME='COLUMN10'  
  ADD OBJECT CMND1 AS COMMANDBUTTON WITH;
      LEFT=INT_015*420,;
      TOP=INT_015*2,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*70,;
      FONTSIZE=INT_015*9,;     
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\HARROW.CUR',;         
      CAPTION='\<C.離開',;
      TOOLTIPTEXT='取消此搜尋畫面!快速鍵->ALT+C'
      NAME='CMND1'
  ADD OBJECT CMND2 AS COMMANDBUTTON WITH;
      LEFT=INT_015*330,;
      TOP=INT_015*2,;
      HEIGHT=INT_015*25,;
      WIDTH=INT_015*80,;
      FONTSIZE=INT_015*9,;     
      MOUSEPOINTER=99,;
      MOUSEICON='BMPS\HARROW.CUR',;         
      CAPTION='\<E.轉EXCEL',;
      TOOLTIPTEXT='轉EXCEL!快速鍵->ALT+E'
      NAME='CMND2'      
  ADD OBJECT MTH_LIST1 AS MTH_LIST WITH;
      LEFT=INT_015*5,;
      TOP=INT_015*1   
 PROCEDURE INIT 
         THISFORM.CAPTION='當月入貨未出'
         THISFORM.SETALL('MOVABLE',.F.,'COLUMN')
         THISFORM.CMND2.ENABLED=.T.
         THISFORM.GRDD01.SETALL('FONTSIZE',INT_015*9,'COLUMN') 
         THISFORM.GRDD01.SETALL('FONTSIZE',INT_015*9,'HEADER')          
         THISFORM.GRDD01.COLUMN1.HEADER1.CAPTION='日期'
         THISFORM.GRDD01.COLUMN2.HEADER1.CAPTION='料號'        
         THISFORM.GRDD01.COLUMN3.HEADER1.CAPTION='採購單號'     
         THISFORM.GRDD01.COLUMN4.HEADER1.CAPTION='訂單編號'    
         THISFORM.GRDD01.COLUMN5.HEADER1.CAPTION='進貨數量'    
         THISFORM.GRDD01.COLUMN6.HEADER1.CAPTION='採購用途'    
         THISFORM.GRDD01.COLUMN7.HEADER1.CAPTION='客戶編號'  
         THISFORM.GRDD01.COLUMN8.HEADER1.CAPTION='客戶簡稱'      
         THISFORM.GRDD01.COLUMN9.HEADER1.CAPTION='業務編號'    
         THISFORM.GRDD01.COLUMN10.HEADER1.CAPTION='業務姓名'    
         THISFORM.GRDD01.COLUMN1.WIDTH=INT_015*25
         THISFORM.GRDD01.COLUMN2.WIDTH=INT_015*200
         THISFORM.GRDD01.COLUMN3.WIDTH=INT_015*80
         THISFORM.GRDD01.COLUMN4.WIDTH=INT_015*80
         THISFORM.GRDD01.COLUMN5.WIDTH=INT_015*65
         THISFORM.GRDD01.COLUMN6.WIDTH=INT_015*150
         THISFORM.GRDD01.COLUMN7.WIDTH=INT_015*50
         THISFORM.GRDD01.COLUMN8.WIDTH=INT_015*55
         THISFORM.GRDD01.COLUMN9.WIDTH=INT_015*50
         THISFORM.GRDD01.COLUMN10.WIDTH=INT_015*55
         THISFORM.GRDD01.COLUMN1.CONTROLSOURCE='D11_TEMP.F01'
	 THISFORM.GRDD01.COLUMN2.CONTROLSOURCE='D11_TEMP.F03'
	 THISFORM.GRDD01.COLUMN3.CONTROLSOURCE='D11_TEMP.F05'
	 THISFORM.GRDD01.COLUMN4.CONTROLSOURCE='D11_TEMP.C04NO'
	 THISFORM.GRDD01.COLUMN5.CONTROLSOURCE='D11_TEMP.F08'
	 THISFORM.GRDD01.COLUMN6.CONTROLSOURCE='D11_TEMP.P03NO'
	 THISFORM.GRDD01.COLUMN7.CONTROLSOURCE='D11_TEMP.F09'
	 THISFORM.GRDD01.COLUMN8.CONTROLSOURCE='D11_TEMP.F10'
	 THISFORM.GRDD01.COLUMN9.CONTROLSOURCE='D11_TEMP.F12'
	 THISFORM.GRDD01.COLUMN10.CONTROLSOURCE='D11_TEMP.F11'
         THISFORM.GRDD01.SETFOCUS
         IF THISFORM.GRDD01.ACTIVEROW=0
              THISFORM.CMND2.ENABLED=.F.
         ENDIF 
 ENDPROC  
***********
  PROC MTH_LIST1.INTERACTIVECHANGE 
	THISFORM.GRDD01.RECORDSOURCE=''
	SELECT D11_TEMP
	USE
        SELECT B26
        USE
        B26='B26'+LEFT(DTOS(CTOD(THIS.DISPLAYVALUE+'/01')),6)    &&庫存異動記錄檔 
        B261='B261'+LEFT(DTOS(CTOD(THIS.DISPLAYVALUE+'/01')),6) 
        IF !USED('&B26')
	    SELE 0
	    USE (B26) ALIA B26 INDE (B26)
        ELSE
	    SELE B26
        ENDIF
        SET ORDER TO B261 	
        SELECT D11
        USE 
        D11='D11'+LEFT(DTOS(CTOD(THIS.DISPLAYVALUE+'/01')),6)   &&出貨日報表檔
        D111='D111'+LEFT(DTOS(CTOD(THIS.DISPLAYVALUE+'/01')),6)
        IF !USED('&D11')
            SELECT  0
            USE (D11) ALIA D11 INDE (D11)
        ELSE
            SELE D11
        ENDIF
        SET ORDER TO D111 	
	SELECT F01 FROM B26 WHERE F02='I000 ' AND (LEFT(ALLTRIM(F07),2)='BC' OR LEFT(ALLTRIM(F07),2)='CZ' OR LEFT(ALLTRIM(F07),2)='BP') ORDER BY F01 INTO CURSOR B26_TEMP READWRITE 
	INDE ON F01 TAG B26_TEMP1
	SELECT F01,F03,F04,F05,F08,F09,F10,F11,F12 FROM D11 WHERE  !EMPTY(D11.F12)  INTO CURSOR D11_TEMP READWRITE 
	ALTER TABLE D11_TEMP ADD P03NO  C(20)
	ALTER TABLE D11_TEMP ADD C04NO  C(10)
	INDE ON  F01 + F03 + F12 TAG B26_TEMP1
	SELECT D11_TEMP
	GO TOP
	DO WHILE !EOF()
	       SELECT B26_TEMP
	       SEEK D11_TEMP.F03
	       IF FOUND() 
		    SELECT D11_TEMP
		    DELETE  
	       ENDIF
	       SELECT D11_TEMP
	       SKIP
	ENDDO	
	SELECT B26_TEMP  
	USE
	SELECT D11_TEMP
	GO TOP
	DO WHILE !EOF()
	       SELECT D04
	       SEEK D11_TEMP.F05 + D11_TEMP.F03
	       IF FOUND()
	            REPLACE D11_TEMP.P03NO WITH D04.F11
	       ELSE
	            SELECT P04
	            SEEK D11_TEMP.F05 + D11_TEMP.F03
	            IF FOUND()
	                 REPLACE D11_TEMP.P03NO WITH P04.F11	                 
	            ENDIF     
	       ENDIF
	       IF !EMPTY(D11_TEMP.P03NO) AND LEFT(D11_TEMP.P03NO,2) = 'PA'
	            SELECT P06
	            SEEK LEFT(ALLTRIM(D11_TEMP.P03NO),10) + D11_TEMP.F03
	            IF FOUND()
   			 REPLACE D11_TEMP.C04NO WITH P06.F07
	            ENDIF
	       ENDIF
	       SELECT D11_TEMP
	       SKIP
	ENDDO
	SELECT D11_TEMP
	GO TOP        
	THISFORM.CMND2.ENABLED=.T.
	THISFORM.GRDD01.RECORDSOURCE='D11_TEMP'  
         THISFORM.GRDD01.COLUMN1.CONTROLSOURCE='D11_TEMP.F01'
	 THISFORM.GRDD01.COLUMN2.CONTROLSOURCE='D11_TEMP.F03'
	 THISFORM.GRDD01.COLUMN3.CONTROLSOURCE='D11_TEMP.F05'
	 THISFORM.GRDD01.COLUMN4.CONTROLSOURCE='D11_TEMP.C04NO'
	 THISFORM.GRDD01.COLUMN5.CONTROLSOURCE='D11_TEMP.F08'
	 THISFORM.GRDD01.COLUMN6.CONTROLSOURCE='D11_TEMP.P03NO'
	 THISFORM.GRDD01.COLUMN7.CONTROLSOURCE='D11_TEMP.F09'
	 THISFORM.GRDD01.COLUMN8.CONTROLSOURCE='D11_TEMP.F10'
	 THISFORM.GRDD01.COLUMN9.CONTROLSOURCE='D11_TEMP.F12'
	 THISFORM.GRDD01.COLUMN10.CONTROLSOURCE='D11_TEMP.F11'	
	 THISFORM.GRDD01.SETFOCUS
	  IF THISFORM.GRDD01.ACTIVEROW=0
	       THISFORM.CMND2.ENABLED=.F.
	  ENDIF
  ENDPROC  
  ***   
 PROCEDURE CMND1.CLICK
        SELECT A23
        USE   
        SELECT D04
        USE
        SELECT P04
        USE
        SELECT P06
        USE        
        SELECT B26
        USE
        SELECT D11
        USE
        SELECT D11_TEMP
        USE
        THISFORM.RELEASE
  ENDPROC    
  ****  
 PROCEDURE CMND2.CLICK
   SELECT D11_TEMP.F01 日期,D11_TEMP.F03 料號,D11_TEMP.F04 進貨單號,D11_TEMP.F05 採購單號,D11_TEMP.C04NO 訂單編號,D11_TEMP.F08 進貨數量,D11_TEMP.P03NO 採購用途,D11_TEMP.F09 客戶編號,D11_TEMP.F10 客戶簡稱,D11_TEMP.F12 業務編號,D11_TEMP.F11 業務姓名,B01.F37 平均成本 FROM D11_TEMP,B01 WHERE B01.F01=D11_TEMP.F03 ORDER BY D11_TEMP.F01,D11_TEMP.F03,D11_TEMP.F12 NOWAIT
   FILENAME=LEFT(ALLTRIM(THISFORM.MTH_LIST1.DISPLAYVALUE),2) + '年' + RIGHT(ALLTRIM(THISFORM.MTH_LIST1.DISPLAYVALUE),2) +'月 入貨未出明細'
   GCDELIMFILE=PUTFILE('儲存路徑',FILENAME,'XLS')
   IF !EMPTY(GCDELIMFILE) 
	ON ERROR DO FILE_IMPACT
	COPY TO (GCDELIMFILE) TYPE XL5     
	=MESSAGEBOX('儲存成功',0+64,'提示訊息視窗') 
   ENDIF      
  ENDPROC     
ENDDEFINE  
***********************************************列印範圍選定
DEFINE CLASS EXCEL_RANGE AS FORM
  AUTOCENTER=.T.
  CAPTION='請輸入轉EXCEL資料範圍'
  FONTSIZE=INT_015*9
  HEIGHT=INT_015*150
  WIDTH=INT_015*400
  FONTSIZE=INT_015*9
  MAXBUTTON=.F.
  MINBUTTON=.F.
  MOVABLE=.F.
  CLOSABLE=.F.    
  CONTROLBOX=.F.
  BORDERSTYLE=2
  SHOWTIPS=.T.
  SHOWWINDOW=1
  WINDOWTYPE=1
  NAME='EXCEL_RANGE'
  ADD OBJECT LABEL1 AS LABEL WITH;
      AUTOSIZE=.T.,;
      HEIGHT=INT_015*25,;
      LEFT=INT_015*25,;
      TOP=INT_015*40,;
      NAME='LABEL1'
  ADD OBJECT TEXT1 AS TEXTBOX WITH;
      AUTOSIZE=.T.,;
      TOP=INT_015*34,;
      LEFT=INT_015*78,;
      HEIGHT=INT_015*25,; 
      NAME='TEXT1'
  ADD OBJECT LABEL2 AS LABEL WITH;
      AUTOSIZE=.T.,;
      HEIGHT=INT_015*25,;
      LEFT=INT_015*25,;
      TOP=INT_015*90,;
      NAME='LABEL2'      
  ADD OBJECT TEXT2 AS TEXTBOX WITH;
      AUTOSIZE=.T.,;
      TOP=INT_015*84,;
      LEFT=INT_015*78,;
      HEIGHT=INT_015*25,;         
      NAME='TEXT2'    
  ADD OBJECT CMND1 AS COMMANDBUTTON WITH;
      LEFT=INT_015*300,;     
      TOP=INT_015*20,;  
      HEIGHT=INT_015*25,;    
      WIDTH=INT_015*70,;
      FONTSIZE=INT_015*10,;
      CAPTION='\<A確   定',;
      TOOLTIPTEXT='確認所選擇的鍵值!快速鍵->ALT+Y',;
      NAME='CMND1'
  ADD OBJECT CMND2 AS COMMANDBUTTON WITH;
      LEFT=INT_015*300,;
      TOP=INT_015*100,;
      HEIGHT=INT_015*25,;    
      WIDTH=INT_015*70,;
      FONTSIZE=INT_015*10,;
      CAPTION='\<C.取   消',;
      TOOLTIPTEXT='取消作業!快速鍵->ALT+C',;
      NAME='CMND2'    
  PROCEDURE INIT 
      SELECT B98
      THISFORM.SETALL('FONTSIZE',INT_015*9,'TEXTBOX')
      THISFORM.SETALL('FONTSIZE',INT_015*9,'LABEL')      
      THISFORM.SETALL('FONTSIZE',INT_015*9,'COMMANDBUTTON')            
      DO CASE
         CASE KEY()='F02'    
              THISFORM.LABEL1.CAPTION='起始料號'
              THISFORM.LABEL2.CAPTION='截止料號'
              THISFORM.TEXT1.WIDTH=INT_015*200
              THISFORM.TEXT2.WIDTH=INT_015*200   
              THISFORM.TEXT1.MAXLENGTH=43        
              THISFORM.TEXT2.MAXLENGTH=43                                       
              THISFORM.TEXT1.VALUE=B98.F02
              THISFORM.TEXT2.VALUE=B98.F02              
         CASE KEY()='F13'
              THISFORM.LABEL1.CAPTION='起始客戶'
              THISFORM.LABEL2.CAPTION='截止客戶'
              THISFORM.TEXT1.WIDTH=INT_015*60
              THISFORM.TEXT2.WIDTH=INT_015*60 
              THISFORM.TEXT1.MAXLENGTH=5
              THISFORM.TEXT2.MAXLENGTH=5
              THISFORM.TEXT1.VALUE=B98.F13
              THISFORM.TEXT2.VALUE=B98.F13               
         CASE KEY()='F15'       
              THISFORM.LABEL1.CAPTION='起始業務'
              THISFORM.LABEL2.CAPTION='截止業務'
              THISFORM.TEXT1.WIDTH=INT_015*60
              THISFORM.TEXT2.WIDTH=INT_015*60   
              THISFORM.TEXT1.MAXLENGTH=20              
              THISFORM.TEXT2.MAXLENGTH=20                                       
              THISFORM.TEXT1.VALUE=B98.F15
              THISFORM.TEXT2.VALUE=B98.F15               
         CASE KEY()='F17'   
              THISFORM.LABEL1.CAPTION='起始業助'
              THISFORM.LABEL2.CAPTION='截止業助'
              THISFORM.TEXT1.WIDTH=INT_015*60
              THISFORM.TEXT2.WIDTH=INT_015*60              
              THISFORM.TEXT1.MAXLENGTH=5              
              THISFORM.TEXT2.MAXLENGTH=5                            
              THISFORM.TEXT1.VALUE=B98.F17
              THISFORM.TEXT2.VALUE=B98.F17                                                                                   
      ENDCASE   
  ENDPROC    
  PROCEDURE CMND1.CLICK     
     FILENAME='入貨未出(B98)'
     DO CASE 
            CASE KEY()='F02'  
                       IF A02.F10 = '*'
                           SELECT F02 料品編號,F03 品名規格,F04 庫存數量,F05 成本單價,F06 最後異動日,F07 請購單號,;
                                          F08 呆滯天數,F09 存貨週轉率,F19 最後進貨日,F13 客戶編號,F14 客戶簡稱,F15 業務編號,F16 業務姓名,;
                                          F17 業助編號,F18 業助姓名,F99 安全資料 FROM B98 WHERE B98.F02 >= THISFORM.TEXT1.VALUE AND B98.F02 <= THISFORM.TEXT2.VALUE ORDER BY B98.F02 NOWAIT
                       ELSE
                           SELECT F02 料品編號,F03 品名規格,F04 庫存數量,F06 最後異動日,F07 請購單號,;
                                          F08 呆滯天數,F09 存貨週轉率,F19 最後進貨日,F13 客戶編號,F14 客戶簡稱,F15 業務編號,F16 業務姓名,;
                                          F17 業助編號,F18 業助姓名,F99 安全資料 FROM B98 WHERE B98.F02 >= THISFORM.TEXT1.VALUE AND B98.F02 <= THISFORM.TEXT2.VALUE ORDER BY B98.F02 NOWAIT                       
                       ENDIF                   
            CASE KEY()='F13'  
                       IF A02.F10 = '*'
                           SELECT F13 客戶編號,F14 客戶簡稱,F02 料品編號,F03 品名規格,F04 庫存數量,F05 成本單價,;
                                          F06 最後異動日,F07 請購單號,F08 呆滯天數,F09 存貨週轉率,F19 最後進貨日,F15 業務編號,F16 業務姓名,;
                                          F17 業助編號,F18 業助姓名,F99 安全資料 FROM B98 WHERE B98.F13 >= THISFORM.TEXT1.VALUE AND B98.F13 <= THISFORM.TEXT2.VALUE ORDER BY B98.F13 NOWAIT
                       ELSE
                           SELECT F13 客戶編號,F14 客戶簡稱,F02 料品編號,F03 品名規格,F04 庫存數量,F06 最後異動日,;
                                          F07 請購單號,F08 呆滯天數,F09 存貨週轉率,F19 最後進貨日,F15 業務編號,F16 業務姓名,;
                                          F17 業助編號,F18 業助姓名,F99 安全資料 FROM B98 WHERE B98.F13 >= THISFORM.TEXT1.VALUE AND B98.F13 <= THISFORM.TEXT2.VALUE ORDER BY B98.F13 NOWAIT                       
                       ENDIF                    	            
            CASE KEY()='F15'  
                       IF A02.F10 = '*'
                           SELECT F15 業務編號,F16 業務姓名,F02 料品編號,F03 品名規格,F04 庫存數量,F05 成本單價,;
                                          F06 最後異動日,F07 請購單號,F08 呆滯天數,F09 存貨週轉率,F19 最後進貨日,F13 客戶編號,F14 客戶簡稱,;
                                          F17 業助編號,F18 業助姓名,F99 安全資料 FROM B98 WHERE B98.F15 >= THISFORM.TEXT1.VALUE AND B98.F15 <= THISFORM.TEXT2.VALUE ORDER BY B98.F15 NOWAIT
                       ELSE
                           SELECT F15 業務編號,F16 業務姓名,F02 料品編號,F03 品名規格,F04 庫存數量,F06 最後異動日,;
                                          F07 請購單號,F08 呆滯天數,F09 存貨週轉率,F19 最後進貨日,F13 客戶編號,F14 客戶簡稱,;
                                          F17 業助編號,F18 業助姓名,F99 安全資料 FROM B98 WHERE B98.F15 >= THISFORM.TEXT1.VALUE AND B98.F15 <= THISFORM.TEXT2.VALUE ORDER BY B98.F15 NOWAIT                       
                       ENDIF                    	            
            CASE KEY()='F17'  
                       IF A02.F10 = '*'
                           SELECT F17 業助編號,F18 業助姓名,F02 料品編號,F03 品名規格,F04 庫存數量,F05 成本單價,;
                                          F06 最後異動日,F07 請購單號,F08 呆滯天數,F09 存貨週轉率,F19 最後進貨日,F13 客戶編號,F14 客戶簡稱,F15 業務編號,F16 業務姓名,;
                                          F99 安全資料 FROM B98 WHERE B98.F17 >= THISFORM.TEXT1.VALUE AND B98.F17 <= THISFORM.TEXT2.VALUE ORDER BY B98.F17 NOWAIT
                       ELSE
                           SELECT F17 業助編號,F18 業助姓名,F02 料品編號,F03 品名規格,F04 庫存數量,F06 最後異動日,;
                                          F07 請購單號,F08 呆滯天數,F09 存貨週轉率,F19 最後進貨日,F13 客戶編號,F14 客戶簡稱,F15 業務編號,F16 業務姓名,;
                                          F99 安全資料 FROM B98 WHERE B98.F17 >= THISFORM.TEXT1.VALUE AND B98.F17 <= THISFORM.TEXT2.VALUE ORDER BY B98.F17 NOWAIT                       
                       ENDIF                                  
     ENDCASE 
     IF _TALLY >0   
	 GCDELIMFILE=PUTFILE('儲存路徑',FILENAME,'XLS')
	 IF !EMPTY(GCDELIMFILE) 
	     ON ERROR DO FILE_IMPACT
	     COPY TO (GCDELIMFILE) TYPE XL5     
	     =MESSAGEBOX('儲存成功',0+64,'提示訊息視窗') 
	ENDIF  
	 FLG='1' 
      ELSE
         FLG='0' 
      ENDIF	
     THISFORM.RELEASE
  ENDPROC
****
  PROCEDURE CMND2.CLICK
      FLG='1'   
      THISFORM.RELEASE
  ENDPROC        
ENDDEFINE       